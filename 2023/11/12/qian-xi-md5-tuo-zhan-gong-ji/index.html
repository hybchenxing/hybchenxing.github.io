<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>浅析md5拓展攻击 | hybcx</title><meta name="keywords" content="基本知识"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="浅析md5拓展攻击"><meta name="application-name" content="浅析md5拓展攻击"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="浅析md5拓展攻击"><meta property="og:url" content="http://hybcx.xyz/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="0x01 前言 最近刷CTF题目的时候遇到了md5拓展攻击的知识点，由于不太清楚原理，故此来学习一番 0x02 md5加密算法 2.1 加密原理 为了更好地理解改攻击，首先了解一下MD5的加密算法，加密过程的示意图如下：  图有点抽象啊，还是看佬们的解释吧： 通俗来讲，就是MD5把每512位当作一组"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="0x01 前言 最近刷CTF题目的时候遇到了md5拓展攻击的知识点，由于不太清楚原理，故此来学习一番 0x02 md5加密算法 2.1 加密原理 为了更好地理解改攻击，首先了解一下MD5的加密算法，加密过程的示意图如下：  图有点抽象啊，还是看佬们的解释吧： 通俗来讲，就是MD5把每512位当作一组"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: '浅析md5拓展攻击',
  postAI: '',
  pageFillDescription: '0x01 前言, 0x02 md5加密算法, 2.1 加密原理, 2.2 填充过程简要说明, 0x03 md5加密再理解, 3.1 题目样例, 3.2 md5算法原理, 3.2.1 基本介绍, 3.3.2 计算步骤, 第一步、填充, 第二步、记录信息长度, 第三步、装入标准的幻数（四个整数）, 第四步、四轮循环运算, 3.2.3 计算的例子, 0x04 md5的hash扩展攻击, 4.1 解决的问题, 4.2 攻击原理, 4.2.1 正常的计算步骤, 4.2.2 发现问题, 知道的条件, 计算str的过程, 0x05 CTF实例, 0x06 代码实现, my_md5.py, , 0x07 参考文章前言最近刷题目的时候遇到了拓展攻击的知识点由于不太清楚原理故此来学习一番加密算法加密原理为了更好地理解改攻击首先了解一下的加密算法加密过程的示意图如下图有点抽象啊还是看佬们的解释吧通俗来讲就是把每位当作一组进行加密计算首先有一个初始序列的值该值是固定的这个初始序列与信息的第一组位进行运算得到一个结果该结果作为下一组位的初始序列再进行同样的运算依此类推需要注意的是最后一个分组的后位用来显示原消息的总长是预留的也就是说最后一个分组只能有位有一个问题就是如果要是加密的信息长度并不是的整数倍怎么办呢的策略是最后一个分组如果不足则进行填充填充的策略是在原消息和原消息总长之间填充字符串第一位为剩下的全部填充这样其实就有了一个漏洞如果给出一个和该经过加密后的值我们可以通过手动填充把消息长度填充到的整数倍再根据这个新的字符串自己计算出值因为有原的值相当于知道了加密的初始序列同样可以成功填充过程简要说明比如原信息为也就是说原信息只有位我们要填充位的十六进制是十六进制每个字符可以转成个二进制位根据我们上文提到的策略填充后应该是注意中的填充都是小端序也就是说数据的高位字节存放在地址的高端低位字节存放在地址低端比如十六进制的后位是表示信息长度是位就是如果我们想要添加字符串比如添加就可以利用已经算出来的结果当作字符串加密运算的初始化序列继续填充的过程算出来的结果就是字符串加密的结果加密再理解经过上述的解释我还是有点不理解那我们在找点其他文章来分析题目样例在一道题目中遇到了以下判断在该题目中我们可以掌握的参数有的值的值和长度我们需要想办法让这个判断通过由此想到了的长度扩展攻击算法原理基本介绍是对一段信息产生信息摘要所谓信息就是指我们需要加密的原数据信息摘要是数据经过一系列计算得出来的一个长度固定的数据可以说是源数据的一个独一无二的指纹计算步骤以位分组来处理输入的信息且每一分组又被划分为个位子分组经过了一系列的处理后算法的输出由四个位分组组成将这四个位分组级联后将生成一个位散列值第一步填充如果输入信息的长度对求余的结果不等于就需要填充使得对求余的结果等于填充的方法是填充一个和个填充完后信息的长度就为第二步记录信息长度用位来存储填充前信息长度这位加在第一步结果的后面这样信息长度就变为位第三步装入标准的幻数四个整数标准的幻数物理顺序是如果在程序中定义应该是标准的初幻数是算法固定的不会变化但是幻数本身是随着每一轮计算不断变动的第四步四轮循环运算复杂运算具体计算方法可以一下代码计算的例子比如计算字符串的值十六进制二进制这里十六进制与模不同余需补位满足二进制长度位的倍数补位后的数据如下十六进制这里后面补充是因为补位时二进制第一位要补那么转换成进制就是后面都补上以十六进制表示一共是个字符十六进制每个字符能够转换成位二进制这就是一组正好是并且可以看到上述最后二十个字符是以开头的这或许是由于我们采用位加密故为而的十六进制就是即最后四字节也就是代表前面的长度二进制将补位后的数据进行一次复杂的运算计算出数据小于位所以将通过小端规则转换就是值小端规则数据的高位字节存放在地址的高端低位字节存放在地址低端比如十六进制的后位是表示信息长度是位就是如果我输入的数据不是而是一串很长的字符换算出来大于小于就需要计算两次第一次先计算前位的的值算出来后再用这个去计算后面位的的的值最后算出来的经过拼接就是这串字符的了这里还是有点懵逼的于是直接看题目来感受吧的扩展攻击解决的问题如文章最初遇到的问题由两个字符串组成一个字符串第一个字符串不知道也不可控只可控第二个字符串同时知道第一个字符串的值和长度这时候将第二个字符串精心构造一下便可以算出合成的字符串的的值攻击原理要明白攻击的原理需要对计算方法稍微了解一下就是上边的几个步骤我们先来看一下以上问题正常计算的步骤正常的计算步骤假如第一个字符串为了方便转为十六进制构造第二个字符串首先手动将补成一个标准的可以直接计算的位这样子这时候再在后面追加一个这时候再将大于位程序会先将这串数据补为位补充完如下这时将分为两部分和这时候程序计算前一部分的的值由于和之前算的的数值是相同的所以到了第二部分第二部分的计算是用的第一部分的去计算计算新的如下最后算出来的是发现问题我们看到了将原数据按长度拆分后第一轮计算的结果会作为幻数用在第二轮计算中而在我们的问题中第一轮计算的结果我们是已知的也就是说我们知道了第二轮计算的幻数可以进行接下来的运算因为知道了第一个字符串的长度我们可以构造第二个字符串的值也就是说我们手动在第二个字符串的前端添加一些特定数据使得第一轮计算因为我们添加数据后符合一轮计算的原数据长度而只计算出第一个字符串的值这样我们就可以利用这个结果作为我们二轮计算的幻数进行下面的计算从而预测最终的结果具体的操作步骤看一下例子我们作为攻击者来复现一下刚才正常计算的那个过程知道的条件的的长度我们可以任意控制由我们可以逆推算出其的值我们构造的值在前面添加特定长度的补全值其中这一类的数据是在计算的补位过程中填充的数据我们手动来填充一下长度视已知的的长度决定此时如下由于不知道我们假设计算的过程由于大于位先补全为位将其分为两部分计算第一部分的的值再用第一部分算出来的拿来算第二部分的值这里由于第一部分的我们可以逆推出来我们可以直接跳过前三部分直接进行第四部分的计算只需要将标准的的源码里面的初始的的值改为逆推出来的那个值我们用假的初始的计算一下得到发现是和上面正向计算出来的一样到此的扩展攻击结束实例这里也懒得找环境了就直接看着代码分析吧通过阅读源码我们可以知道如果想要得到需要几个条件字段的不能为空发送过去的并且的值的值前两个条件都很容易满足关键是第三个因为我们不知道的内容只知道长度为不过继续阅读后面的内容可以获得一个信息是已知也就是请求头中的那么如果则问题则转化成已知求的值然后只要把该值赋给即可综上可以利用扩展长度攻击由于算法较为复杂我使用了一个工具附上安装方法用法输入已知的字符串和结果在这里是和输入密钥的长度再输入你想要在后面添加的字符串它会自动给你返回后的结果以及填充数据把数据在中填入后重发即可得到代码实现这里附上实现源码定义函数用来产生常数常数有可能超过位同样需要操作注意返回的是十进制的数定义每轮中用到的函数为循环左移注意左移之后可能会超过位所以要和做与运算确保结果为位填充完的数据为扩充完的数据为进制截取最后分组的数据进制最终填充结果为填充后的为参考文章的长度扩展攻击拓展长度攻击原理剖析扩展长度攻击实验吧让我进去',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2023-12-22 21:14:07',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" itemprop="url">web知识总结</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>基本知识</span></a></span></div></div><h1 class="post-title" itemprop="name headline">浅析md5拓展攻击</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-11-12T07:15:47.618Z" title="发表于 2023-11-12 15:15:47">2023-11-12</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-12-22T13:14:07.238Z" title="更新于 2023-12-22 21:14:07">2023-12-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">4.6k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="浅析md5拓展攻击"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/"><header><a class="post-meta-categories" href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" itemprop="url">web知识总结</a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url">基本知识</a><h1 id="CrawlerTitle" itemprop="name headline">浅析md5拓展攻击</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2023-11-12T07:15:47.618Z" title="发表于 2023-11-12 15:15:47">2023-11-12</time><time itemprop="dateCreated datePublished" datetime="2023-12-22T13:14:07.238Z" title="更新于 2023-12-22 21:14:07">2023-12-22</time></header><h1 id="0x01-前言">0x01 前言</h1>
<p>最近刷CTF题目的时候遇到了md5拓展攻击的知识点，由于不太清楚原理，故此来学习一番</p>
<h1 id="0x02-md5加密算法">0x02 md5加密算法</h1>
<h2 id="21-加密原理">2.1 加密原理</h2>
<p>为了更好地理解改攻击，首先了解一下MD5的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95&amp;spm=1001.2101.3001.7020">加密算法</a>，加密过程的示意图如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231112152137679.png" alt="image-20231112152137679"></p>
<p>图有点抽象啊，还是看佬们的解释吧：</p>
<p>通俗来讲，就是MD5把每512位当作一组进行加密计算，首先有一个初始序列的值（该值是固定的），这个初始序列与信息的第一组512位进行运算，得到一个结果，该结果作为下一组512位的初始序列，再进行同样的运算，依此类推。需要注意的是，最后一个分组的后64位用来显示原消息的总长，是预留的，也就是说，最后一个分组只能有448位。</p>
<p>有一个问题就是，如果要是（加密的信息长度+64）并不是512的整数倍怎么办呢？</p>
<p>MD5的策略是：</p>
<p>最后一个分组如果不足512，则进行填充，填充的策略是：在原消息和原消息总长之间填充01字符串，第一位为1，剩下的全部填充0。</p>
<p>这样其实就有了一个漏洞：</p>
<p>如果给出一个message和该message经过md5加密后的值，我们可以通过手动填充，把消息长度填充到512的整数倍，再根据这个新的字符串，自己计算出md5值（因为有原message的md5值，相当于知道了加密的初始序列），同样可以成功。</p>
<h2 id="22-填充过程简要说明">2.2 填充过程简要说明</h2>
<p>比如原信息为test，md5(‘test’) = 098f6bcd4621d373cade4e832627b4f6；也就是说原信息只有4*8=32位，我们要填充448 - 32 = 416位。</p>
<p>‘test’的十六进制是0x74673574（十六进制每个字符可以转成4个二进制位），根据我们上文提到的策略，填充后应该是：80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000</p>
<p>注意：MD5中的填充都是小端序，也就是说，数据的高位字节存放在地址的高端 低位字节存放在地址低端，比如十六进制的后16位（64/4）是32，表示信息长度是32位，就是2000000000000000；</p>
<p>如果我们想要添加字符串（比如添加wn），就可以利用‘test’已经算出来的md5结果，当作 ‘wn’ 字符串加密运算的初始化序列，继续填充的过程，算出来的结果就是 ‘testwn’ 字符串加密的结果。</p>
<h1 id="0x03-md5加密再理解">0x03 md5加密再理解</h1>
<p>经过上述的解释我还是有点不理解，那我们在找点其他文章来分析</p>
<h2 id="31-题目样例">3.1 题目样例</h2>
<p>在一道web题目中遇到了以下判断: <code>if ($COOKIE["md5hash"] === md5($secret . $input))</code></p>
<p>在该题目中我们可以掌握的参数有<code>md5hash</code>、<code>input</code>的值，<code>secret</code>的md5值和长度，我们需要想办法让这个判断通过。</p>
<p>由此想到了md5的hash长度扩展攻击。</p>
<h2 id="32-md5算法原理">3.2 md5算法原理</h2>
<h3 id="321-基本介绍">3.2.1 基本介绍</h3>
<p>md5是对一段信息（Message）产生信息摘要（Message-Digest），所谓信息就是指我们需要加密的原数据，信息摘要是数据经过一系列计算得出来的一个长度固定的数据（可以说是源数据的一个独一无二的指纹）。</p>
<h3 id="332-计算步骤">3.3.2 计算步骤</h3>
<p>MD5以512位分组来处理输入的信息，且每一分组又被划分为16个32位子分组，经过了一系列的处理后，算法的输出由四个32位分组组成，将这四个32位分组级联后将生成一个128位散列值。</p>
<h4 id="第一步-填充">第一步、填充</h4>
<p>如果输入信息的长度(bit)对512求余的结果不等于448，就需要填充使得对512求余的结果等于448。填充的方法是填充一个1和n个0。填充完后，信息的长度就为N*512+448(bit)；</p>
<h4 id="第二步-记录信息长度">第二步、记录信息长度</h4>
<p>用64位来存储填充前信息长度。这64位加在第一步结果的后面，这样信息长度就变为N*512+448+64=(N+1)*512位。</p>
<h4 id="第三步-装入标准的幻数四个整数">第三步、装入标准的幻数（四个整数）</h4>
<p>标准的幻数（物理顺序）是</p>
<pre><code class="hljs plaintext">（A=(01234567)16，B=(89ABCDEF)16，C=(FEDCBA98)16，D=(76543210)16）。如果在程序中定义应该是（A=0X67452301L，B=0XEFCDAB89L，C=0X98BADCFEL，D=0X10325476L）</code></pre>
<p>标准的初幻数是Md5算法固定的，不会变化，但是幻数本身是随着每一轮计算不断变动的。</p>
<h4 id="第四步-四轮循环运算">第四步、四轮循环运算</h4>
<p>复杂运算，具体计算方法可以google一下代码。</p>
<h3 id="323-计算的例子">3.2.3 计算的例子</h3>
<p>比如计算字符串<code>test</code>的md5值。</p>
<p>十六进制<code>0x74657374</code> 二进制<code>0b1110100011001010111001101110100</code></p>
<p>这里十六进制与448模512不同余，需补位满足二进制长度位512的倍数，补位后的数据如下：</p>
<p>十六进制：</p>
<pre><code class="hljs plaintext">0x74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000</code></pre>
<p>这里后面补充8是因为：补位时二进制第一位要补1，那么1000转换成16进制就是8，后面都补上0</p>
<p>以十六进制表示一共是128个字符，十六进制每个字符能够转换成4位二进制，128*4=512这就是一组，正好是512bit。</p>
<p>并且可以看到上述最后二十个字符是以20开头的，这或许是由于我们md5采用32位加密，故<code>test</code>为4*8=32，而32的十六进制就是20</p>
<p>即：最后四字节也就是2000000000000000代表前面’test’的长度</p>
<p>二进制：</p>
<pre><code class="hljs plaintext">0b1110100011001010111001101110100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000</code></pre>
<p>将补位后的数据进行一次复杂的运算，计算出</p>
<pre><code class="hljs plaintext">A=0xcd6b8f09
B=0x73d32146
C=0x834edeca
D=0xf6b42726</code></pre>
<p>数据小于512位，所以将ABCD通过小端规则转换就是MD5值：<code>098f6bcd4621d373cade4e832627b4f6</code></p>
<pre><code class="hljs plaintext">小端规则：
数据的高位字节存放在地址的高端 低位字节存放在地址低端，比如十六进制的后16位（64/4）是32，表示信息长度是32位，就是2000000000000000；</code></pre>
<p>如果我输入的数据不是test而是一串很长的字符，换算出来大于512小于1024，就需要计算两次，第一次先计算前512位的ABCD的值，算出来后再用这个ABCD去计算后面512位的的ABCD的值，最后算出来的ABCD经过拼接就是这串字符的MD5了</p>
<p>这里还是有点懵逼的，于是直接看题目来感受吧。</p>
<h1 id="0x04-md5的hash扩展攻击">0x04 md5的hash扩展攻击</h1>
<h2 id="41-解决的问题">4.1 解决的问题</h2>
<p>如文章最初遇到的问题，由两个字符串组成一个字符串<code>$str=$a+$b</code>，第一个字符串<code>$a</code>不知道也不可控，只可控第二个字符串<code>$b</code>，同时知道第一个字符串<code>$a</code>的MD5值和长度，这时候将第二个字符串精心构造一下，便可以算出合成的字符串<code>$str</code>的MD5的值</p>
<h2 id="42-攻击原理">4.2 攻击原理</h2>
<p>要明白攻击的原理，需要对md5计算方法稍微了解一下，就是上边的几个步骤，我们先来看一下以上问题正常计算的步骤。</p>
<h3 id="421-正常的计算步骤">4.2.1 正常的计算步骤</h3>
<p>假如第一个字符串<code>$a=“test”</code>,为了方便转为十六进制<code>0x74657374</code></p>
<p>构造第二个字符串首先手动将<code>$str</code>补成一个标准的可以直接计算的512位</p>
<pre><code class="hljs plaintext">$str=0x74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000</code></pre>
<p>这样子，这时候再在后面追加一个<code>0x746573748</code></p>
<pre><code class="hljs plaintext">$str=0x74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000746573748</code></pre>
<p>这时候再将<code>$str</code>大于512位，程序会先将这串数据补为1024位，补充完如下</p>
<pre><code class="hljs plaintext">$str=0x7465737480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000074657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002002000000000000</code></pre>
<p>这时将<code>$str</code>分为两部分</p>
<pre><code class="hljs plaintext">74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000</code></pre>
<p>和</p>
<pre><code class="hljs plaintext">74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002002000000000000</code></pre>
<p>这时候程序计算前一部分的ABCD的值，由于和之前算的test的数值是相同的所以</p>
<pre><code class="hljs plaintext">A=0xcd6b8f09
B=0x73d32146
C=0x834edeca
D=0xf6b42726</code></pre>
<p>到了第二部分，第二部分的计算是用的第一部分的ABCD去计算，计算新的ABCD如下</p>
<pre><code class="hljs plaintext">A=0x226359e5
b=0x99df12eb
C=0x6853f59e
D=0xf5406385</code></pre>
<p>最后算出来的MD5是<code>e5596322eb12df999ef55368856340f5</code></p>
<h3 id="422-发现问题">4.2.2 发现问题</h3>
<p>我们看到了，将原数据按长度拆分后，第一轮计算的结果会作为幻数用在第二轮计算中。而在我们的问题中，第一轮计算的结果我们是已知的，也就是说，我们知道了第二轮计算的幻数，可以进行接下来的运算。</p>
<p>因为知道了第一个字符串<code>$a</code>的长度，我们可以构造第二个字符串<code>$b</code>的值，也就是说我们手动在第二个字符串<code>$b</code>的前端添加一些特定数据，使得第一轮计算因为我们添加数据后符合一轮计算的原数据长度而只计算出第一个字符串的hash值。这样我们就可以利用这个结果作为我们二轮计算的幻数进行下面的计算，从而预测最终的md结果。</p>
<p>具体的操作步骤看一下例子。</p>
<p>我们作为攻击者来复现一下刚才正常计算的那个过程。</p>
<h4 id="知道的条件">知道的条件</h4>
<pre><code class="hljs plaintext">1.$a的MD5(098f6bcd4621d373cade4e832627b4f6)
2.$a的长度=4
3.$b我们可以任意控制</code></pre>
<p>由1我们可以逆推算出其ABCD的值</p>
<pre><code class="hljs plaintext">A=0xcd6b8f09
B=0x73d32146
C=0x834edeca
D=0xf6b42726</code></pre>
<p>我们构造<code>$b</code>的值，在前面添加特定长度的补全值： <code>$b='\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\x00\x00\x00\x00\x00\x00\x00'+'test'</code></p>
<p>其中<code>\x80\x00\x00\x00\x00\x00\x00\x00</code>这一类的数据是在md5计算的补位过程中填充的数据，我们手动来填充一下，长度视已知的<code>$a的长度=4</code>决定。</p>
<p>此时$str如下，由于不知道$a，我们假设$a=“aaaa”</p>
<pre><code class="hljs plaintext">$str='aaaa'+'\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\x00\x00\x00\x00\x00\x00\x00'+'test'</code></pre>
<h4 id="计算str的过程">计算str的过程</h4>
<pre><code class="hljs plaintext">1.由于大于512位，先补全为1024位，
2.将其分为两部分
3.计算第一部分的ABCD的值
4.再用第一部分算出来的ABCD拿来算第二部分的值。</code></pre>
<p>这里由于第一部分的ABCD我们可以逆推出来，我们可以直接跳过前三部分直接进行第四部分的计算，只需要将标准的MD5的源码里面的初始的ABCD的值改为逆推出来的那个值</p>
<p>我们用假的初始的ABCD计算一下</p>
<pre><code class="hljs plaintext">0x74657374800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002002000000000000</code></pre>
<p>得到MD5，发现是<code>e5596322eb12df999ef55368856340f5</code>，和上面正向计算出来的一样！</p>
<p>到此，md5的hash扩展攻击结束。</p>
<h1 id="0x05-ctf实例">0x05 CTF实例</h1>
<p>这里也懒得找环境了，就直接看着代码分析吧</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 

<span class="hljs-variable">$flag</span> = <span class="hljs-string">"flag{flag is here}"</span>;
<span class="hljs-variable">$secret</span> = <span class="hljs-string">"aaaaabbbbbccccc"</span>; <span class="hljs-comment">// This secret is 15 characters long for security!</span>

@<span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">"username"</span>];
@<span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">"password"</span>];
<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">"getmein"</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$username</span>) === <span class="hljs-string">"admin"</span> &amp;&amp; <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$password</span>) != <span class="hljs-string">"admin"</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">"getmein"</span>] === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$secret</span> . <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$username</span> . <span class="hljs-variable">$password</span>))) {
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Congratulations! You are a registered user.\n"</span>;
            <span class="hljs-keyword">die</span> (<span class="hljs-string">"The flag is "</span>. <span class="hljs-variable">$flag</span>);
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">die</span> (<span class="hljs-string">"Your cookies don't match up! STOP HACKING THIS SITE."</span>);
        }
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">die</span> (<span class="hljs-string">"You are not an admin! LEAVE."</span>);
    }
}

<span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">"sample-hash"</span>, <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$secret</span> . <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">"admin"</span> . <span class="hljs-string">"admin"</span>)), <span class="hljs-title function_ invoke__">time</span>() + (<span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span>));

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">"source"</span>])) {
    <span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">"source"</span>, <span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">time</span>() + (<span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span>));
}
<span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">"source"</span>] != <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// This source code is outputted here</span>
    }
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>通过阅读源码，我们可以知道，如果想要得到flag，需要几个条件：</p>
<pre><code class="hljs plaintext">cookei字段的getmein不能为空
发送过去的username = admin，并且，password != admin
getmein的值 = $secret + $username + $password 的md5值</code></pre>
<p>前两个条件都很容易满足，关键是第三个，因为我们不知道$secret的内容，只知道长度为15，不过继续阅读后面的内容，可以获得一个信息是：</p>
<pre><code>md5($secret + adminadmin)已知，也就是请求头中的sample-hash
</code></pre>
<p>那么，</p>
<p>如果 $username = admin，$password = adminwn，则问题则转化成：</p>
<p>已知md5(‘xxxxxxxxxxxxxxxadminadmin’)，求md5(‘xxxxxxxxxxxxxxxadminadminwn’)的值，然后只要把该值赋给getmein即可。综上，可以利用md5扩展长度攻击。</p>
<p>由于md5算法较为复杂，我使用了一个工具hashpump：</p>
<p>附上安装方法：</p>
<pre><code class="hljs plaintext">git clone https://github.com/bwall/HashPump
apt-get install g++ libssl-dev
cd HashPump
make
make install</code></pre>
<p>用法：</p>
<p>输入已知的字符串和md5结果（在这里是adminadmin和571580b26c65f306376d4f64e53cb5c7），输入密钥的长度（15)，再输入你想要在后面添加的字符串，它会自动给你返回md5后的结果，以及填充数据：</p>
<p>把数据在burpsuite中填入后重发即可得到flag。</p>
<h1 id="0x06-代码实现">0x06 代码实现</h1>
<p>这里附上实现源码</p>
<h2 id="my_md5py">my_md5.py</h2>
<pre><code class="hljs py"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-comment"># @Author：DshtAnger</span>
<span class="hljs-comment"># theory reference:</span>
<span class="hljs-comment">#   blog：</span>
<span class="hljs-comment">#       http://blog.csdn.net/adidala/article/details/28677393</span>
<span class="hljs-comment">#       http://blog.csdn.net/forgotaboutgirl/article/details/7258109</span>
<span class="hljs-comment">#       http://blog.sina.com.cn/s/blog_6fe0eb1901014cpl.html</span>
<span class="hljs-comment">#   RFC1321：</span>
<span class="hljs-comment">#       https://www.rfc-editor.org/rfc/pdfrfc/rfc1321.txt.pdf</span>
<span class="hljs-comment">##############################################################################</span>
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">def</span> <span class="hljs-title function_">genMsgLengthDescriptor</span>(<span class="hljs-params">msg_bitsLenth</span>):
    <span class="hljs-string">'''</span>
<span class="hljs-string">    ---args:</span>
<span class="hljs-string">            msg_bitsLenth : the bits length of raw message</span>
<span class="hljs-string">    --return:</span>
<span class="hljs-string">            16 hex-encoded string , i.e.64bits,8bytes which used to describe the bits length of raw message added after padding</span>
<span class="hljs-string">    '''</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">__import__</span>(<span class="hljs-string">"struct"</span>).pack(<span class="hljs-string">"&gt;Q"</span>,msg_bitsLenth).encode(<span class="hljs-string">"hex"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse_hex_8bytes</span>(<span class="hljs-params">hex_str</span>):
    <span class="hljs-string">'''</span>
<span class="hljs-string">    --args:</span>
<span class="hljs-string">            hex_str: a hex-encoded string with length 16 , i.e.8bytes</span>
<span class="hljs-string">    --return:</span>
<span class="hljs-string">            transform raw message descriptor to little-endian </span>
<span class="hljs-string">    '''</span>
    hex_str = <span class="hljs-string">"%016x"</span>%<span class="hljs-built_in">int</span>(hex_str,<span class="hljs-number">16</span>)
    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(hex_str)==<span class="hljs-number">16</span>    
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">__import__</span>(<span class="hljs-string">"struct"</span>).pack(<span class="hljs-string">"&lt;Q"</span>,<span class="hljs-built_in">int</span>(hex_str,<span class="hljs-number">16</span>)).encode(<span class="hljs-string">"hex"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse_hex_4bytes</span>(<span class="hljs-params">hex_str</span>):
    <span class="hljs-string">'''</span>
<span class="hljs-string">    --args:</span>
<span class="hljs-string">            hex_str: a hex-encoded string with length 8 , i.e.4bytes</span>
<span class="hljs-string">    --return:</span>
<span class="hljs-string">            transform 4 bytes message block to little-endian</span>
<span class="hljs-string">    '''</span>    
    hex_str = <span class="hljs-string">"%08x"</span>%<span class="hljs-built_in">int</span>(hex_str,<span class="hljs-number">16</span>)
    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(hex_str)==<span class="hljs-number">8</span>    
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">__import__</span>(<span class="hljs-string">"struct"</span>).pack(<span class="hljs-string">"&lt;L"</span>,<span class="hljs-built_in">int</span>(hex_str,<span class="hljs-number">16</span>)).encode(<span class="hljs-string">"hex"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">deal_rawInputMsg</span>(<span class="hljs-params">input_msg</span>):
    <span class="hljs-string">'''</span>
<span class="hljs-string">    --args:</span>
<span class="hljs-string">            input_msg : inputed a ascii-encoded string</span>
<span class="hljs-string">    --return:</span>
<span class="hljs-string">            a hex-encoded string which can be inputed to mathematical transformation function.</span>
<span class="hljs-string">    '''</span>
    ascii_list = [x.encode(<span class="hljs-string">"hex"</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> input_msg]
    length_msg_bytes = <span class="hljs-built_in">len</span>(ascii_list)
    length_msg_bits = <span class="hljs-built_in">len</span>(ascii_list)*<span class="hljs-number">8</span>
    <span class="hljs-comment">#padding</span>
    ascii_list.append(<span class="hljs-string">'80'</span>)  
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">len</span>(ascii_list)*<span class="hljs-number">8</span>+<span class="hljs-number">64</span>)%<span class="hljs-number">512</span> != <span class="hljs-number">0</span>:  
        ascii_list.append(<span class="hljs-string">'00'</span>)
    <span class="hljs-comment">#add Descriptor</span>
    ascii_list.append(reverse_hex_8bytes(genMsgLengthDescriptor(length_msg_bits)))
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>.join(ascii_list)



<span class="hljs-keyword">def</span> <span class="hljs-title function_">getM16</span>(<span class="hljs-params">hex_str,operatingBlockNum</span>):
    <span class="hljs-string">'''</span>
<span class="hljs-string">    --args:</span>
<span class="hljs-string">            hex_str : a hex-encoded string with length in integral multiple of 512bits</span>
<span class="hljs-string">            operatingBlockNum : message block number which is being operated , greater than 1</span>
<span class="hljs-string">    --return:</span>
<span class="hljs-string">            M : result of splited 64bytes into 4*16 message blocks with little-endian</span>
<span class="hljs-string"></span>
<span class="hljs-string">    '''</span>
    M = [<span class="hljs-built_in">int</span>(reverse_hex_4bytes(hex_str[i:(i+<span class="hljs-number">8</span>)]),<span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">128</span>*(operatingBlockNum-<span class="hljs-number">1</span>),<span class="hljs-number">128</span>*operatingBlockNum,<span class="hljs-number">8</span>)]
    <span class="hljs-keyword">return</span> M

<span class="hljs-comment">#定义函数，用来产生常数T[i]，常数有可能超过32位，同样需要&amp;0xffffffff操作。注意返回的是十进制的数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">T</span>(<span class="hljs-params">i</span>):
    result = (<span class="hljs-built_in">int</span>(<span class="hljs-number">4294967296</span>*<span class="hljs-built_in">abs</span>(<span class="hljs-built_in">__import__</span>(<span class="hljs-string">"math"</span>).sin(i))))&amp;<span class="hljs-number">0xffffffff</span>
    <span class="hljs-keyword">return</span> result   

<span class="hljs-comment">#定义每轮中用到的函数</span>
<span class="hljs-comment">#RL为循环左移，注意左移之后可能会超过32位，所以要和0xffffffff做与运算，确保结果为32位</span>
F = <span class="hljs-keyword">lambda</span> x,y,z:((x&amp;y)|((~x)&amp;z))
G = <span class="hljs-keyword">lambda</span> x,y,z:((x&amp;z)|(y&amp;(~z)))
H = <span class="hljs-keyword">lambda</span> x,y,z:(x^y^z)
I = <span class="hljs-keyword">lambda</span> x,y,z:(y^(x|(~z)))
RL = L = <span class="hljs-keyword">lambda</span> x,n:(((x&lt;&lt;n)|(x&gt;&gt;(<span class="hljs-number">32</span>-n)))&amp;(<span class="hljs-number">0xffffffff</span>))

<span class="hljs-keyword">def</span> <span class="hljs-title function_">FF</span>(<span class="hljs-params">a, b, c, d, x, s, ac</span>):  
    a = (a+F ((b), (c), (d)) + (x) + (ac)&amp;<span class="hljs-number">0xffffffff</span>)&amp;<span class="hljs-number">0xffffffff</span>;  
    a = RL ((a), (s))&amp;<span class="hljs-number">0xffffffff</span>;  
    a = (a+b)&amp;<span class="hljs-number">0xffffffff</span>  
    <span class="hljs-keyword">return</span> a  
<span class="hljs-keyword">def</span> <span class="hljs-title function_">GG</span>(<span class="hljs-params">a, b, c, d, x, s, ac</span>):  
    a = (a+G ((b), (c), (d)) + (x) + (ac)&amp;<span class="hljs-number">0xffffffff</span>)&amp;<span class="hljs-number">0xffffffff</span>;  
    a = RL ((a), (s))&amp;<span class="hljs-number">0xffffffff</span>;  
    a = (a+b)&amp;<span class="hljs-number">0xffffffff</span>  
    <span class="hljs-keyword">return</span> a  
<span class="hljs-keyword">def</span> <span class="hljs-title function_">HH</span>(<span class="hljs-params">a, b, c, d, x, s, ac</span>):  
    a = (a+H ((b), (c), (d)) + (x) + (ac)&amp;<span class="hljs-number">0xffffffff</span>)&amp;<span class="hljs-number">0xffffffff</span>;  
    a = RL ((a), (s))&amp;<span class="hljs-number">0xffffffff</span>;  
    a = (a+b)&amp;<span class="hljs-number">0xffffffff</span>  
    <span class="hljs-keyword">return</span> a  
<span class="hljs-keyword">def</span> <span class="hljs-title function_">II</span>(<span class="hljs-params">a, b, c, d, x, s, ac</span>):  
    a = (a+I ((b), (c), (d)) + (x) + (ac)&amp;<span class="hljs-number">0xffffffff</span>)&amp;<span class="hljs-number">0xffffffff</span>;  
    a = RL ((a), (s))&amp;<span class="hljs-number">0xffffffff</span>;  
    a = (a+b)&amp;<span class="hljs-number">0xffffffff</span>  
    <span class="hljs-keyword">return</span> a      

<span class="hljs-keyword">def</span> <span class="hljs-title function_">show_md5</span>(<span class="hljs-params">A,B,C,D</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>.join( [  <span class="hljs-string">""</span>.join(<span class="hljs-built_in">__import__</span>(<span class="hljs-string">"re"</span>).findall(<span class="hljs-string">r".."</span>,<span class="hljs-string">"%08x"</span>%i)[::-<span class="hljs-number">1</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (A,B,C,D)  ]  )

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_md5</span>(<span class="hljs-params">A=<span class="hljs-number">0x67452301</span>,B=<span class="hljs-number">0xefcdab89</span>,C=<span class="hljs-number">0x98badcfe</span>,D=<span class="hljs-number">0x10325476</span>,readyMsg=<span class="hljs-string">""</span></span>):
    
    a = A
    b = B
    c = C
    d = D

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(readyMsg)/<span class="hljs-number">128</span>):
        M = getM16(readyMsg,i+<span class="hljs-number">1</span>)
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">16</span>):
            <span class="hljs-built_in">exec</span> <span class="hljs-string">"M"</span>+<span class="hljs-built_in">str</span>(i)+<span class="hljs-string">"=M["</span>+<span class="hljs-built_in">str</span>(i)+<span class="hljs-string">"]"</span>
        <span class="hljs-comment">#First round</span>
        a=FF(a,b,c,d,M0,<span class="hljs-number">7</span>,<span class="hljs-number">0xd76aa478L</span>)
        d=FF(d,a,b,c,M1,<span class="hljs-number">12</span>,<span class="hljs-number">0xe8c7b756L</span>)
        c=FF(c,d,a,b,M2,<span class="hljs-number">17</span>,<span class="hljs-number">0x242070dbL</span>)
        b=FF(b,c,d,a,M3,<span class="hljs-number">22</span>,<span class="hljs-number">0xc1bdceeeL</span>)
        a=FF(a,b,c,d,M4,<span class="hljs-number">7</span>,<span class="hljs-number">0xf57c0fafL</span>)
        d=FF(d,a,b,c,M5,<span class="hljs-number">12</span>,<span class="hljs-number">0x4787c62aL</span>)
        c=FF(c,d,a,b,M6,<span class="hljs-number">17</span>,<span class="hljs-number">0xa8304613L</span>)
        b=FF(b,c,d,a,M7,<span class="hljs-number">22</span>,<span class="hljs-number">0xfd469501L</span>)
        a=FF(a,b,c,d,M8,<span class="hljs-number">7</span>,<span class="hljs-number">0x698098d8L</span>)
        d=FF(d,a,b,c,M9,<span class="hljs-number">12</span>,<span class="hljs-number">0x8b44f7afL</span>)
        c=FF(c,d,a,b,M10,<span class="hljs-number">17</span>,<span class="hljs-number">0xffff5bb1L</span>)
        b=FF(b,c,d,a,M11,<span class="hljs-number">22</span>,<span class="hljs-number">0x895cd7beL</span>)
        a=FF(a,b,c,d,M12,<span class="hljs-number">7</span>,<span class="hljs-number">0x6b901122L</span>)
        d=FF(d,a,b,c,M13,<span class="hljs-number">12</span>,<span class="hljs-number">0xfd987193L</span>)
        c=FF(c,d,a,b,M14,<span class="hljs-number">17</span>,<span class="hljs-number">0xa679438eL</span>)
        b=FF(b,c,d,a,M15,<span class="hljs-number">22</span>,<span class="hljs-number">0x49b40821L</span>)
        <span class="hljs-comment">#Second round</span>
        a=GG(a,b,c,d,M1,<span class="hljs-number">5</span>,<span class="hljs-number">0xf61e2562L</span>)
        d=GG(d,a,b,c,M6,<span class="hljs-number">9</span>,<span class="hljs-number">0xc040b340L</span>)
        c=GG(c,d,a,b,M11,<span class="hljs-number">14</span>,<span class="hljs-number">0x265e5a51L</span>)
        b=GG(b,c,d,a,M0,<span class="hljs-number">20</span>,<span class="hljs-number">0xe9b6c7aaL</span>)
        a=GG(a,b,c,d,M5,<span class="hljs-number">5</span>,<span class="hljs-number">0xd62f105dL</span>)
        d=GG(d,a,b,c,M10,<span class="hljs-number">9</span>,<span class="hljs-number">0x02441453L</span>)
        c=GG(c,d,a,b,M15,<span class="hljs-number">14</span>,<span class="hljs-number">0xd8a1e681L</span>)
        b=GG(b,c,d,a,M4,<span class="hljs-number">20</span>,<span class="hljs-number">0xe7d3fbc8L</span>)
        a=GG(a,b,c,d,M9,<span class="hljs-number">5</span>,<span class="hljs-number">0x21e1cde6L</span>)
        d=GG(d,a,b,c,M14,<span class="hljs-number">9</span>,<span class="hljs-number">0xc33707d6L</span>)
        c=GG(c,d,a,b,M3,<span class="hljs-number">14</span>,<span class="hljs-number">0xf4d50d87L</span>)
        b=GG(b,c,d,a,M8,<span class="hljs-number">20</span>,<span class="hljs-number">0x455a14edL</span>)
        a=GG(a,b,c,d,M13,<span class="hljs-number">5</span>,<span class="hljs-number">0xa9e3e905L</span>)
        d=GG(d,a,b,c,M2,<span class="hljs-number">9</span>,<span class="hljs-number">0xfcefa3f8L</span>)
        c=GG(c,d,a,b,M7,<span class="hljs-number">14</span>,<span class="hljs-number">0x676f02d9L</span>)
        b=GG(b,c,d,a,M12,<span class="hljs-number">20</span>,<span class="hljs-number">0x8d2a4c8aL</span>)
        <span class="hljs-comment">#Third round</span>
        a=HH(a,b,c,d,M5,<span class="hljs-number">4</span>,<span class="hljs-number">0xfffa3942L</span>)
        d=HH(d,a,b,c,M8,<span class="hljs-number">11</span>,<span class="hljs-number">0x8771f681L</span>)
        c=HH(c,d,a,b,M11,<span class="hljs-number">16</span>,<span class="hljs-number">0x6d9d6122L</span>)
        b=HH(b,c,d,a,M14,<span class="hljs-number">23</span>,<span class="hljs-number">0xfde5380c</span>)
        a=HH(a,b,c,d,M1,<span class="hljs-number">4</span>,<span class="hljs-number">0xa4beea44L</span>)
        d=HH(d,a,b,c,M4,<span class="hljs-number">11</span>,<span class="hljs-number">0x4bdecfa9L</span>)
        c=HH(c,d,a,b,M7,<span class="hljs-number">16</span>,<span class="hljs-number">0xf6bb4b60L</span>)
        b=HH(b,c,d,a,M10,<span class="hljs-number">23</span>,<span class="hljs-number">0xbebfbc70L</span>)
        a=HH(a,b,c,d,M13,<span class="hljs-number">4</span>,<span class="hljs-number">0x289b7ec6L</span>)
        d=HH(d,a,b,c,M0,<span class="hljs-number">11</span>,<span class="hljs-number">0xeaa127faL</span>)
        c=HH(c,d,a,b,M3,<span class="hljs-number">16</span>,<span class="hljs-number">0xd4ef3085L</span>)
        b=HH(b,c,d,a,M6,<span class="hljs-number">23</span>,<span class="hljs-number">0x04881d05L</span>)
        a=HH(a,b,c,d,M9,<span class="hljs-number">4</span>,<span class="hljs-number">0xd9d4d039L</span>)
        d=HH(d,a,b,c,M12,<span class="hljs-number">11</span>,<span class="hljs-number">0xe6db99e5L</span>)
        c=HH(c,d,a,b,M15,<span class="hljs-number">16</span>,<span class="hljs-number">0x1fa27cf8L</span>)
        b=HH(b,c,d,a,M2,<span class="hljs-number">23</span>,<span class="hljs-number">0xc4ac5665L</span>)
        <span class="hljs-comment">#Fourth round</span>
        a=II(a,b,c,d,M0,<span class="hljs-number">6</span>,<span class="hljs-number">0xf4292244L</span>)
        d=II(d,a,b,c,M7,<span class="hljs-number">10</span>,<span class="hljs-number">0x432aff97L</span>)
        c=II(c,d,a,b,M14,<span class="hljs-number">15</span>,<span class="hljs-number">0xab9423a7L</span>)
        b=II(b,c,d,a,M5,<span class="hljs-number">21</span>,<span class="hljs-number">0xfc93a039L</span>)
        a=II(a,b,c,d,M12,<span class="hljs-number">6</span>,<span class="hljs-number">0x655b59c3L</span>)
        d=II(d,a,b,c,M3,<span class="hljs-number">10</span>,<span class="hljs-number">0x8f0ccc92L</span>)
        c=II(c,d,a,b,M10,<span class="hljs-number">15</span>,<span class="hljs-number">0xffeff47dL</span>)
        b=II(b,c,d,a,M1,<span class="hljs-number">21</span>,<span class="hljs-number">0x85845dd1L</span>)
        a=II(a,b,c,d,M8,<span class="hljs-number">6</span>,<span class="hljs-number">0x6fa87e4fL</span>)
        d=II(d,a,b,c,M15,<span class="hljs-number">10</span>,<span class="hljs-number">0xfe2ce6e0L</span>)
        c=II(c,d,a,b,M6,<span class="hljs-number">15</span>,<span class="hljs-number">0xa3014314L</span>)
        b=II(b,c,d,a,M13,<span class="hljs-number">21</span>,<span class="hljs-number">0x4e0811a1L</span>)
        a=II(a,b,c,d,M4,<span class="hljs-number">6</span>,<span class="hljs-number">0xf7537e82L</span>)
        d=II(d,a,b,c,M11,<span class="hljs-number">10</span>,<span class="hljs-number">0xbd3af235L</span>)
        c=II(c,d,a,b,M2,<span class="hljs-number">15</span>,<span class="hljs-number">0x2ad7d2bbL</span>)
        b=II(b,c,d,a,M9,<span class="hljs-number">21</span>,<span class="hljs-number">0xeb86d391L</span>)


        A += a
        B += b
        C += c
        D += d

        A = A&amp;<span class="hljs-number">0xffffffff</span>
        B = B&amp;<span class="hljs-number">0xffffffff</span>
        C = C&amp;<span class="hljs-number">0xffffffff</span>
        D = D&amp;<span class="hljs-number">0xffffffff</span>

        a = A
        b = B
        c = C
        d = D
        <span class="hljs-built_in">print</span> <span class="hljs-string">"%x,%x,%x,%x"</span>%(a,b,c,d)

    <span class="hljs-keyword">return</span> show_md5(a,b,c,d)</code></pre>
<h2 id="testpy"><a target="_blank" rel="noopener" href="http://test.py">test.py</a></h2>
<pre><code class="hljs py"><span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">import</span> my_md5
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> six
MD5_Hash=sys.argv[<span class="hljs-number">1</span>]
length=<span class="hljs-built_in">int</span>(sys.argv[<span class="hljs-number">2</span>])
text=sys.argv[<span class="hljs-number">3</span>]

s1=<span class="hljs-built_in">eval</span>(<span class="hljs-string">'0x'</span>+MD5_Hash[:<span class="hljs-number">8</span>].decode(<span class="hljs-string">'hex'</span>)[::-<span class="hljs-number">1</span>].encode(<span class="hljs-string">'hex'</span>))
s2=<span class="hljs-built_in">eval</span>(<span class="hljs-string">'0x'</span>+MD5_Hash[<span class="hljs-number">8</span>:<span class="hljs-number">16</span>].decode(<span class="hljs-string">'hex'</span>)[::-<span class="hljs-number">1</span>].encode(<span class="hljs-string">'hex'</span>))
s3=<span class="hljs-built_in">eval</span>(<span class="hljs-string">'0x'</span>+MD5_Hash[<span class="hljs-number">16</span>:<span class="hljs-number">24</span>].decode(<span class="hljs-string">'hex'</span>)[::-<span class="hljs-number">1</span>].encode(<span class="hljs-string">'hex'</span>))
s4=<span class="hljs-built_in">eval</span>(<span class="hljs-string">'0x'</span>+MD5_Hash[<span class="hljs-number">24</span>:<span class="hljs-number">32</span>].decode(<span class="hljs-string">'hex'</span>)[::-<span class="hljs-number">1</span>].encode(<span class="hljs-string">'hex'</span>))

secret = <span class="hljs-string">"a"</span>*length
test=secret+<span class="hljs-string">'\x80'</span>+<span class="hljs-string">'\x00'</span>*((<span class="hljs-number">512</span>-length*<span class="hljs-number">8</span>-<span class="hljs-number">8</span>-<span class="hljs-number">8</span>*<span class="hljs-number">8</span>)/<span class="hljs-number">8</span>)+six.int2byte(length*<span class="hljs-number">8</span>)+<span class="hljs-string">'\x00\x00\x00\x00\x00\x00\x00'</span>+text
s = my_md5.deal_rawInputMsg(test)
r = my_md5.deal_rawInputMsg(secret)
inp = s[<span class="hljs-built_in">len</span>(r):]
<span class="hljs-built_in">print</span> <span class="hljs-string">'填充完的数据为:'</span>+test+<span class="hljs-string">'\n'</span>
<span class="hljs-built_in">print</span> <span class="hljs-string">'----------------------------------------------------------'</span>
<span class="hljs-built_in">print</span> <span class="hljs-string">'扩充完的数据为(16进制):'</span>+s
<span class="hljs-built_in">print</span> <span class="hljs-string">'----------------------------------------------------------'</span>
<span class="hljs-built_in">print</span> <span class="hljs-string">'截取最后分组的数据(16进制):'</span>+inp
<span class="hljs-built_in">print</span> <span class="hljs-string">'----------------------------------------------------------'</span>

<span class="hljs-built_in">print</span>  <span class="hljs-string">'最终填充结果为:'</span>+<span class="hljs-built_in">bytes</span>(test).encode(<span class="hljs-string">'hex'</span>)
<span class="hljs-built_in">print</span> <span class="hljs-string">"填充后的md5为:"</span>+my_md5.run_md5(s1,s2,s3,s4,inp)</code></pre>
<h1 id="0x07-参考文章">0x07 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://zu1k.com/posts/security/crypto/md5-hash-length-extension-attack/#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D">MD5的Hash长度扩展攻击</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/database/164019.html">Hash拓展长度攻击原理剖析</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/destiny1507/article/details/100543233">MD5扩展长度攻击（实验吧 —— 让我进去）</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/')">浅析md5拓展攻击</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=浅析md5拓展攻击&amp;url=http://hybcx.xyz/2023/11/12/qian-xi-md5-tuo-zhan-gong-ji/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>基本知识<span class="tagsPageCount">21</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/12/wen-jian-shang-chuan-zhi-pearcmd/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">浅析pearcmd.php漏洞</div></div></a></div><div class="next-post pull-right"><a href="/2023/11/12/flask-pin-ma-xue-xi/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Flask-PIN码学习</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/07/27/ajax-xiang-jie/" title="Ajax详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-07-27</div><div class="title">Ajax详解</div></div></a></div><div><a href="/2023/08/06/docker-jian-jie/" title="docker基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-08-06</div><div class="title">docker基础</div></div></a></div><div><a href="/2023/11/12/flask-pin-ma-xue-xi/" title="Flask-PIN码学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-12</div><div class="title">Flask-PIN码学习</div></div></a></div><div><a href="/2024/02/27/jwt-gong-ji-xue-xi/" title="JWT攻击学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-27</div><div class="title">JWT攻击学习</div></div></a></div><div><a href="/2024/04/09/php-opcachegetshell/" title="PHP-OPcacheGetshell学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-04-09</div><div class="title">PHP-OPcacheGetshell学习</div></div></a></div><div><a href="/2023/11/13/phar-fan-xu-lie-hua-xue-xi/" title="Phar反序列化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-13</div><div class="title">Phar反序列化</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-md5%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">0x02 md5加密算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 加密原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E5%A1%AB%E5%85%85%E8%BF%87%E7%A8%8B%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 填充过程简要说明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-md5%E5%8A%A0%E5%AF%86%E5%86%8D%E7%90%86%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">0x03 md5加密再理解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#31-%E9%A2%98%E7%9B%AE%E6%A0%B7%E4%BE%8B"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 题目样例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-md5%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 md5算法原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#321-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#332-%E8%AE%A1%E7%AE%97%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.3.2 计算步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%A1%AB%E5%85%85"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">第一步、填充</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF%E9%95%BF%E5%BA%A6"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">第二步、记录信息长度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5-%E8%A3%85%E5%85%A5%E6%A0%87%E5%87%86%E7%9A%84%E5%B9%BB%E6%95%B0%E5%9B%9B%E4%B8%AA%E6%95%B4%E6%95%B0"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">第三步、装入标准的幻数（四个整数）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5-%E5%9B%9B%E8%BD%AE%E5%BE%AA%E7%8E%AF%E8%BF%90%E7%AE%97"><span class="toc-number">3.2.2.4.</span> <span class="toc-text">第四步、四轮循环运算</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#323-%E8%AE%A1%E7%AE%97%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 计算的例子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-md5%E7%9A%84hash%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB"><span class="toc-number">4.</span> <span class="toc-text">0x04 md5的hash扩展攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#41-%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 解决的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 攻击原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#421-%E6%AD%A3%E5%B8%B8%E7%9A%84%E8%AE%A1%E7%AE%97%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1 正常的计算步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#422-%E5%8F%91%E7%8E%B0%E9%97%AE%E9%A2%98"><span class="toc-number">4.2.2.</span> <span class="toc-text">4.2.2 发现问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%A5%E9%81%93%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">知道的条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97str%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">计算str的过程</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-ctf%E5%AE%9E%E4%BE%8B"><span class="toc-number">5.</span> <span class="toc-text">0x05 CTF实例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.</span> <span class="toc-text">0x06 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#my_md5py"><span class="toc-number">6.1.</span> <span class="toc-text">my_md5.py</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#testpy"><span class="toc-number">6.2.</span> <span class="toc-text">test.py</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">7.</span> <span class="toc-text">0x07 参考文章</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>