<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="渗透测试流程&amp;外网打点, hybcx&#39;s blog">
    <meta name="description" content="0x01 前言
终于抽出时间来学习了，看了看st3pby师傅给的资料，对于渗透测试流程不熟悉的我，感觉需要学的挺多的，估计又是一场恶战，话不多说直接开卷！！
0x02 渗透测试基本流程
这里先学习一下大致测试的框架流程：
大致可分为三个阶段">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BYTY196ENH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-BYTY196ENH');
    </script>


    <title>渗透测试流程&amp;外网打点 | hybcx&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span diyFont">hybcx&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">hybcx&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hybchenxing/" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hybchenxing/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/11.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">渗透测试流程&amp;外网打点</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">
                                <span class="chip bg-color">内网渗透</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" class="post-category">
                                内网渗透
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-12-31
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-03-17
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    20.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    78 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1>0x01 前言</h1>
<p>终于抽出时间来学习了，看了看st3pby师傅给的资料，对于渗透测试流程不熟悉的我，感觉需要学的挺多的，估计又是一场恶战，话不多说直接开卷！！</p>
<h1>0x02 渗透测试基本流程</h1>
<p>这里先学习一下大致测试的框架流程：</p>
<p>大致可分为三个阶段：信息搜集、漏洞发现、漏洞利用。但放到实战中，这三个方面又可以有很多的细节优化，进一步深入明确测试流程，这里主要通过9个阶段来学习一下整个测试流程。</p>
<p>渗透测试一般就是典型的<strong>黑盒测试</strong>，就是模拟黑客的入侵；还有一种叫<strong>白盒渗透</strong>，是在了解了一些内部的情况之后再挖掘漏洞。一般性黑盒测试的东西多一点。</p>
<h2 id="2-1-确定目标">2.1 确定目标</h2>
<h3 id="范围的确定">范围的确定</h3>
<p>测试的范围：我们要知道当前测试的范围是IP、域名、内网和外网、整个网站还是网站的某个功能模块？</p>
<p>一般来说可能测试的是一个公司或企业的内部网络，针对的大部分是服务器。或者是一个网站或网站群，或者是一些软件应用或者APP，这类的话一般都是获取应用的后台服务器的权限。</p>
<h3 id="规则的确定">规则的确定</h3>
<p>我们需要知道我们可以测试到什么程度：是发现漏洞即可，还是要进一步利用漏洞；是否有时间限制、是否可以修改上传、能否提权等等等等，也就是确定问我们可以做什么不可以做什么。这里填充一下文章给的：</p>
<ul>
<li>目标系统介绍、重点保护对象及特性。</li>
<li>是否允许数据破坏？</li>
<li>是否允许阻断业务正常运行？</li>
<li>测试之前是否应当知会相关部门接口人？</li>
<li>接入方式？外网和内网？</li>
<li>测试是发现问题就算成功，还是尽可能的发现多的问题？</li>
<li>渗透过程是否需要考虑社会工程？</li>
</ul>
<h3 id="需求的确定">需求的确定</h3>
<p>我们需要明确让我们测试的需求具体是什么：web应用的漏洞(新上线程序)？业务逻辑漏洞（针对业务的）？人员权限管理漏洞（针对人员、权限）？根据需求和自己技术能力来确定能不能做、能做多少，点到为止。</p>
<h2 id="2-2-分析风险，获得授权">2.2 分析风险，获得授权</h2>
<p>这里的知识就不懂了，没了解过。。。直接cv加自己的浅薄理解了</p>
<p>分析渗透测试过程中可能产生的风险，如大量测试数据的处理、影响正常业务开展、服务器发生异常的应急、数据备份和恢复、测试人力物力成本…</p>
<p>由测试方书写实施方案初稿并提交给客户（or本公司内部领导）进行审核。在审核完成后，从客户（or本公司内部领导）获取对测试方进行书面委托授权书，授权测试方进行渗透测试。（不授权不测试~~~）</p>
<h2 id="2-3-信息搜集">2.3 信息搜集</h2>
<p>这里一块可以说是奠定了一次渗透测试是否会成功的基础，虽然之前有所总结，但现在也几乎忘了，因此这一块得重点温习一下（令起一部分）。</p>
<p>首先明确一下信息搜集阶段的目的：尽可能多的获取到目标web应用的各种信息。</p>
<p>信息包括：脚本语言类型、服务器类型、目录结构、是否使用开源软件且使用的哪种开源软件、数据库类型、页面所含的超链接、部署应用用到的框架、中间件类型、用到了哪些网络服务（SSH、FTP）、使用的哪种CMS等等还有很多。</p>
<p>而其中搜集利用到的方式为：主动扫描；开放搜索；利用搜索引擎获取后台、未授权页面、敏感url等等</p>
<pre class="line-numbers language-none"><code class="language-none">基础信息：IP，网段，域名，端口，旁站、C段
系统信息：操作系统版本--》在之后的提权中才能“对症下药”
应用信息：各端口的应用，例如web应用，邮件应用等
版本信息：所有探测到的版本
服务信息：服务器类型、版本、中间件、数据库、脚本类型、软件类型（微信，Chrome）、用到的网络服务
人员信息：域名注册人员信息，web应用中网站发帖人的id，管理员姓名等
防护信息：试着看能否探测到防护设备<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这种信息一般可以先通过部分功能强大的小插件先获取</p>
<p><img src="image-20240101172201533.png" alt="image-20240101172201533"></p>
<h2 id="2-4-漏洞探测（手动-自动）">2.4 漏洞探测（手动&amp;自动）</h2>
<p>到了这一阶段就需要利用2.3搜集到的各类信息，尝试找到相应的漏洞进行探测。</p>
<h3 id="探测方法">探测方法</h3>
<ul>
<li>各类漏扫工具：AWVS、AppScan等等；</li>
<li>结合漏洞去开源漏洞库（exploit-db）等地方去尝试寻找是否是已经公开过的漏洞。</li>
<li>网络漫游找寻漏洞验证POC</li>
<li>平常也需要多关注一些关于网络安全的新闻，掌握漏洞实时消息，说不定日后就不会用到的</li>
</ul>
<p>简单列举一下常见的软件漏洞：</p>
<pre class="line-numbers language-none"><code class="language-none">XAMPP提权漏洞
WordPress大量漏洞
PhpStudy漏洞
phpMyAdmin漏洞
IIS低版本解析漏洞
Nginx/Apache解析漏洞
SSH后门漏洞
FTP/RDP等网络服务弱口令漏洞
Rlogin后门漏洞<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="探测内容">探测内容</h3>
<ul>
<li>系统漏洞：找寻对方系统是否没有打入相关补丁，幸运地话可能会发现对方操作系统并未及时打补丁，后果就是直接拿下！</li>
<li>Webserver漏洞：Webserver配置问题–也就是中间件漏洞（这一块爆的漏洞还是很多的）</li>
<li>Web应用漏洞：Web应用开发问题、还有就是Web开启了其他端口的服务，但却没设置授权访问，或者可以弱口令打入。</li>
<li>各种端口服务：这里主要是针对端口服务的开启，比如21–FTP、8080–这里可能有Apache-tomcat、struct2等等，常被用于代理www服务、7001端口–一般为weblogic服务、22–Linux-SSH远程连接服务、3389–Windows远程桌面连接等等。</li>
<li>通信安全：看看传输过程中的敏感数据是明文的、比如token在cookie的传输、jwt加密所用的key、各类加密盐等等。</li>
</ul>
<h2 id="2-5-漏洞验证">2.5 漏洞验证</h2>
<p>将上一步发现的有可能可以成功利用的漏洞都验证一遍。结合实际情况，搭建模拟环境进行测试，成功后再在目标中实现，验证发面包括一下内容：</p>
<ul>
<li>自动化验证：结合自动化扫描工具提供的结果</li>
<li>手工验证：根据公开资源进行验证</li>
<li>试验验证：自己搭建模拟环境进行验证</li>
<li>登录猜解：有时可以尝试猜解一下登陆口的账号密码等信息，可关注前端js接口。</li>
<li>业务漏洞验证：如发现业务漏洞，要进行验证</li>
<li>公开资源的利用exploit-db/wooyun/渗透代码网站通用、缺省口令厂商的漏洞警告等</li>
</ul>
<h2 id="2-6-信息分析">2.6 信息分析</h2>
<p>这一步是为下一步实施具体渗透做准备。</p>
<ul>
<li>精准攻击：准备好上一步探测到的漏洞exp（漏洞利用），用来对某个模块进行精准攻击</li>
<li>绕过防御机制：是否有防火墙等设备，如何绕过</li>
<li>定制攻击路径：最佳工具路径，根据薄弱点入口，搞清楚内网权限位置，确定最终目标</li>
<li>绕过检测机制：是否有检测机制，流量监控，杀毒软件，恶意代码检测等（免杀）</li>
<li>攻击代码：经过试验得来的代码，包括不限于xss代码，sql注入语句等</li>
</ul>
<h2 id="2-7-利用漏洞获取数据">2.7 利用漏洞获取数据</h2>
<ul>
<li>实施攻击：根据前几步的结果，进行攻击</li>
<li>获取内部信息：基础设施（网络连接，vpn，路由，拓扑等）</li>
<li>进一步渗透：内网入侵，敏感目标</li>
<li>持续性存在：一般对客户做渗透不需要。rookit，后门，添加管理账号，驻扎手法等</li>
<li>清理痕迹：清理相关日志（访问，操作），上传文件等</li>
</ul>
<h2 id="2-8-信息整理">2.8 信息整理</h2>
<ul>
<li>整理渗透工具：整理渗透过程中用到的代码，poc，exp等</li>
<li>整理收集信息：整理渗透过程中收集到的一切信息</li>
<li>整理漏洞信息：整理渗透过程中遇到的各种漏洞，各种脆弱位置信息</li>
<li>目的：为了最后形成报告，形成测试结果使用。</li>
</ul>
<h2 id="2-9-形成报告">2.9 形成报告</h2>
<ul>
<li>按需整理：按照之前第一步跟客户确定好的范围，需求来整理资料，并将资料形成报告</li>
<li>补充介绍：要对漏洞成因，验证过程和带来危害进行分析</li>
<li>修补建议：要对所有产生的问题提出合理高效安全的解决办法</li>
</ul>
<h1>0x03 信息搜集</h1>
<p>这里就单独着重学习一下信息搜集的各类奇淫巧技吧。</p>
<h2 id="3-1-信息搜集的分类">3.1 信息搜集的分类</h2>
<p>1、主动式信息搜集（可获取到的信息较多，但易被目标发现）</p>
<p>2、通过直接发起与被测目标网络之间的互动来获取相关信息，如通过Nmap扫描目标系统。</p>
<p>3、被动式信息搜集（搜集到的信息较少，但不易被发现）</p>
<p>4、通过第三方服务来获取目标网络相关信息。如通过搜索引擎方式来搜集信息。</p>
<h2 id="3-2-搜集什么信息">3.2 搜集什么信息</h2>
<blockquote>
<p>1、whois信息（微步）</p>
<p>2、网站架构</p>
<p>3、dns信息（通过查询dns我们可以检测是否存在dns域传送漏洞）</p>
<p>4、子域名搜集</p>
<p>5、敏感目录及敏感信息、源码泄露（搜索引擎+工具）</p>
<p>6、脆弱系统（网络空间）</p>
<p>7、旁站查询</p>
<p>8、C端查询</p>
<p>9、指纹信息</p>
<p>10、端口服务</p>
<p>11、备案信息</p>
<p>12、真实ip</p>
<p>13、探测waf</p>
<p>14、社工（朋友圈、微博、qq空间、求职、交易等社交平台）</p>
<p>15、企业信息（天眼查、企业信用信息公示系统、工业和信息化部ICP/IP地址/域名信息备案管理系统）</p>
</blockquote>
<h2 id="3-3-目标确认">3.3 目标确认</h2>
<h3 id="域名注册信息（主域名查询）">域名注册信息（主域名查询）</h3>
<p><strong>通过如下步骤确认目标所有者信息：</strong></p>
<blockquote>
<p>Whois 目标域名/主机名：whois <a target="_blank" rel="noopener" href="http://example.com">http://example.com</a><br>
解析目标域名/主机名的IP地址：dig +short <a target="_blank" rel="noopener" href="http://example.com">http://example.com</a><br>
获取域名的详细解析过程：dig +trace <a target="_blank" rel="noopener" href="http://example.com">http://example.com</a></p>
</blockquote>
<p>后续用于字典制作和进一步收集目标信息的基础</p>
<h4 id="whois查询">whois查询</h4>
<p>whois就是一个用来查询域名是否已经被注册，以及注册域名的详细信息的<code>数据库</code>（如域名所有人、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%9F%9F%E5%90%8D%E6%B3%A8%E5%86%8C&amp;spm=1001.2101.3001.7020">域名注册</a>商）。</p>
<p>whois信息可以获取关键注册人的信息，包括注册商、联系人、联系邮箱、联系电话、创建时间等,可以进行邮箱反查域名，爆破邮箱，社工，域名劫持等等。</p>
<p>注：不同域名后缀的whois信息需要到不同的whois数据库查询</p>
<p>主要的实现原理：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">1.根据域名从根服务器获取域名所在whois服务器
2.再根据域名从域名所在whois服务器获取域名信息
即
domain <span class="token operator">+</span> rootServer =&gt; targetServer
domain <span class="token operator">+</span> targetServer =&gt; domainInfo
当然，如果知道了域名信息所在服务器，可以跳过第一步，直接查询域名信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>下面实操一手。</p>
<h5 id="方法一：根服务器">方法一：根服务器</h5>
<p>通过原始网页查询：首先根据域名从whois的根服务器获取域名所在的whois服务器：<a target="_blank" rel="noopener" href="https://www.iana.org/whois">https://www.iana.org/whois</a></p>
<p><img src="image-20240101185641310.png" alt="image-20240101185641310"></p>
<p>或者根据域名后缀在数据库中查询对应whois服务器地址：<a target="_blank" rel="noopener" href="https://www.iana.org/domains/root/db">https://www.iana.org/domains/root/db</a></p>
<p>这里我们就以.cn为例，查询一下，如下图可以看到该域名对应的whois服务器</p>
<p><img src="image-20240101185846245.png" alt="image-20240101185846245"></p>
<p>接下来就是根据得到的whois服务器获取域名信息，结果如下，但这里只能查询一级域名，不能携带www之类的前缀</p>
<p><img src="image-20240101190016712.png" alt="image-20240101190016712"></p>
<p>这里也能看到如果域名后缀不对应，也是查询不到的</p>
<p><img src="image-20240101190119728.png" alt="image-20240101190119728"></p>
<h5 id="方法二：第三方服务查询">方法二：第三方服务查询</h5>
<ul>
<li><a target="_blank" rel="noopener" href="https://whois.aliyun.com/">https://whois.aliyun.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://whois.cloud.tencent.com/">https://whois.cloud.tencent.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://who.is/">https://who.is/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.whois.com/whois/">https://www.whois.com/whois/</a></li>
<li><a target="_blank" rel="noopener" href="https://whois.chinaz.com/">https://whois.chinaz.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://whois.aizhan.com/">https://whois.aizhan.com/</a></li>
</ul>
<p><img src="image-20240101191413063.png" alt="image-20240101191413063"></p>
<p>下方有对应的英文详细信息：</p>
<p><img src="image-20240101191442021.png" alt="image-20240101191442021"></p>
<p>体验下来感觉<a target="_blank" rel="noopener" href="https://www.whois.com/whois%E6%9B%B4%E5%A5%BD%E4%B8%80%E7%82%B9%EF%BC%8C%E4%BF%A1%E6%81%AF%E6%8C%BA%E5%AE%8C%E5%96%84%E7%9A%84%E3%80%82%E4%B8%8D%E8%BF%87%E6%9C%AC%E8%B4%A8%E6%9D%A5%E4%BC%BC%E4%B9%8E%E9%83%BD%E6%98%AF%E6%9D%A5%E8%87%AAwhois%E6%A0%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9F%A5%E8%AF%A2%E5%88%B0%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%8C%E6%95%B4%E5%90%88%E4%BA%86%E4%B8%80%E4%B8%8B%E8%80%8C%E5%B7%B2%E3%80%82%E8%80%8C%E9%98%BF%E9%87%8C%E4%BA%91%E5%92%8C%E8%85%BE%E8%AE%AF%E4%BA%91%E7%9A%84%E6%84%9F%E8%A7%89%E7%94%A8%E4%BA%8E%E6%9F%A5%E5%9B%BD%E5%86%85%E5%B0%B1%E8%A1%8C%E4%BA%86%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E7%AB%99%E9%95%BF%E5%B7%A5%E5%85%B7%E7%9A%84whois%E4%B8%8D%E5%A4%AA%E5%AE%8C%E5%96%84%EF%BC%8C%E4%BD%86%E7%9B%B4%E6%8E%A5%E6%8F%90%E4%BE%9B%E4%BA%86%E5%8F%8D%E6%9F%A5%E5%8A%9F%E8%83%BD%EF%BC%8C%E6%84%9F%E8%A7%89%E8%BF%98%E7%AE%97%E4%B8%8D%E9%94%99%EF%BC%88%E6%84%9F%E8%A7%89%E6%98%AF%E6%9F%A5%E5%9B%BD%E5%86%85%E6%8C%BA%E6%95%88%E7%8E%87%E7%9A%84%E5%B7%A5%E5%85%B7%E4%BA%86%EF%BC%89">https://www.whois.com/whois更好一点，信息挺完善的。不过本质来似乎都是来自whois根服务器查询到的信息，整合了一下而已。而阿里云和腾讯云的感觉用于查国内就行了，最后一个站长工具的whois不太完善，但直接提供了反查功能，感觉还算不错（感觉是查国内挺效率的工具了）</a></p>
<p><img src="image-20240101191921703.png" alt="image-20240101191921703"></p>
<p><img src="image-20240101192120541.png" alt="image-20240101192120541"></p>
<p>这里还有爱站</p>
<p><img src="image-20240101210107271.png" alt="image-20240101210107271"></p>
<p>这里最全面的感觉就是微步社区了</p>
<p><img src="image-20240101210308820.png" alt="image-20240101210308820"></p>
<p><img src="image-20240101210313055.png" alt="image-20240101210313055"></p>
<p>可以看到结果很全面，就是想要查询一些隐私还得氪金~~~</p>
<h5 id="方法三：whois命令">方法三：whois命令</h5>
<p>就是用whois命令进行查询，这个命令在Linux与Windows下都可安装，这里用Linux演示了，至于安装办法就不赘述了</p>
<p><img src="image-20240101192245053.png" alt="image-20240101192245053"></p>
<p><img src="image-20240101192300021.png" alt="image-20240101192300021"></p>
<p>同样的如下图，二级域名就查询不到了</p>
<p><img src="image-20240101192340912.png" alt="image-20240101192340912"></p>
<p>这里需要注意的是国际域名可以设置隐私保护，但像国内.cn等域名是不可以设置隐私保护的。</p>
<h5 id="方法四：中文域名">方法四：中文域名</h5>
<p>这里看了几篇文章，还有用代码去实现的（自我感觉没太必要），这里的代码可以自己写，也可以直接用第三方库</p>
<p>具体的感兴趣参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/mouday/article/details/129691736?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170410215916800227411682%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=170410215916800227411682&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-129691736-null-null.142%5Ev99%5Epc_search_result_base2&amp;utm_term=whois%E5%91%BD%E4%BB%A4&amp;spm=1018.2226.3001.4187">一文搞定：whois数据库查询域名信息（WHOIS）</a></p>
<p>这里介绍这篇文章提到的中文域名查询。。。</p>
<p>他这里说：通过接口直接查询中文域名，会提示没有查询结果。这时候需要将中文域名进行编码</p>
<p>在线编码：<a target="_blank" rel="noopener" href="http://tools.jb51.net/punycode/index.php">http://tools.jb51.net/punycode/index.php</a></p>
<p><img src="image-20240101192800298.png" alt="image-20240101192800298"></p>
<p>其实，中文后缀的域名可以不编码，主要是中英结合的域名, 比如 <a target="_blank" rel="noopener" href="http://xn--chq7c.cn/">http://中万.cn/</a></p>
<p>从浏览器直接复制过来是<a target="_blank" rel="noopener" href="http://xn--chq7c.cn/">http://xn–chq7c.cn/</a></p>
<p>这是一种叫做：Punycode的编码方式</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"中万"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'punycode'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># chq7c</span>
<span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>然后加上前缀<code>xn--</code>，就和上面的结果一致了</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">xn--chq7c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可以看到还是可以查询到的，不过这里如果进入其对应的refer服务器中就查询错误（格式不正确）</p>
<p><img src="image-20240101193453609.png" alt="image-20240101193453609"></p>
<p>不过这里竟然可以直接中文域名查询！！当然whois根服务器也可以</p>
<p><img src="image-20240101193650786.png" alt="image-20240101193650786"></p>
<p>这里附上一个whois查询信息的解释：</p>
<pre class="line-numbers language-none"><code class="language-none">01 whois：是查询命令

02 qqpk.cn：是要查询的域名

03 Domain.name：域名

04 ROID：是Register Object ID号，相当于注册对象的一个身份证号码

05 Domain Status: CLIENT TRANSFER PROHIBITED 
   【也就是客户端禁止转移，该状态由注册商设置，域名可以更新（域名信息修改）、续费、删除，需要指派至少一台域名服务器则可以正常使用。】

06 Registrant：域名注册人的姓名

07 Registrant Contact Email：注册人的联系邮箱

08 Sponsoring Registrar：注册商 
   【他们进行抢注域名，然后进行high价转让的公司】

09 Name Server：也就是DNS域名解析服务器，它在互联网的作用是把域名转换成为网络可以识别的IP地址

10 Registration Time：注册该域名的时间

11 Expiration Time：该域名到期时间

12 DNSSEC：unsigne 
   【DNSSEC=Domain Name System Security Extensions (DNSSEC)，DNS安全扩展，是由IETF提供的一系列DNS安全认证的机制（可参考RFC2535）。它提供了一种来源鉴定和数据完整性的扩展，但不去保障可用性、加密性和证实域名不存在。】
   【Unsigned：未设置、未部署】<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="dig查询">dig查询</h4>
<p>dig（domain information group）是常用的域名查询工具，可以从DNS域名服务器查询主机地址信息，获取到详细的域名信息。这个命令是Bind的一部分，本身并没有在Windows和<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Linux&amp;spm=1001.2101.3001.7020">Linux</a>系统中集成，所以如果我们想要使用该命令就需要先下载相应的软件包。–至于下载方式这里就不说了</p>
<p>这里补充一下对于资源记录(RR)的四个元组的知识：</p>
<blockquote>
<p>A记录 IP地址记录,记录一个域名对应的IP地址</p>
<p>AAAA记录  IPv6地址记录，记录一个域名对应的IPv6地址</p>
<p>CNAME记录   别名记录，记录一个主机的别名</p>
<p>MX记录    电子邮件交换记录，记录一个邮件域名对应的IP地址，比如my[at]<a target="_blank" rel="noopener" href="http://lijiejie.com">lijiejie.com</a><br>
<a target="_blank" rel="noopener" href="http://xn--lijiejie-ul7mw1owm9img2c1ur.com">后面的部分lijiejie.com</a>，邮件服务器对应的IP地址</p>
<p>NS记录      域名服务器记录 ,记录该域名由哪台域名服务器解析</p>
<p>PTR记录     反向记录，也即从IP地址到域名的一条记录</p>
<p>TXT记录     记录域名的相关文本信息</p>
<p>SOA记录   start of anthorization 开始授权，是一种比较难以理解的记录值，一般二级域名才会有</p>
</blockquote>
<p><img src="image-20240104200233900.png" alt="image-20240104200233900"></p>
<p>简单使用：<code>dig www.baidu.com</code></p>
<p><img src="image-20240101200849679.png" alt="image-20240101200849679"></p>
<p>对一些字段的解释：</p>
<blockquote>
<p>第一二行：输出了有关dig的版本信息，和全局设置选项：+cmd，以及输入参数信息</p>
<p>Got answer：输出了从DNS返回的技术信息，比较重要的是 status，如果 status 的值为 NOERROR ，则说明本次查询成功。这段信息可以用选项 [no]comments 来控制是否显示，但是小心禁止掉comments也可能关闭一些其它的选项。</p>
</blockquote>
<p><img src="image-20240101201303974.png" alt="image-20240101201303974"></p>
<p><img src="image-20240101201637507.png" alt="image-20240101201637507"></p>
<blockquote>
<p>QUESTION SECTION：查询字段，显示了我们查询的域名以及查询的服务，A代表的是查询A记录，即主机查询</p>
<p>ANSWER SECTION：回答字段这里的结果表示：要查询www.baidu.com先查询CNAME记录，对www.a.shifen.com进行访问，当我们访问www.a.shifen.com后，该主机让我们访问110.242.68.3，我们访问110.242.68.3后，这个ip的主机会告诉我们www.baidu.com的IP是110.242.68.4</p>
</blockquote>
<p><img src="image-20240101201839925.png" alt="image-20240101201839925"></p>
<blockquote>
<p>这部分显示了请求所花的时间，dns服务器，当前时间，以及查询信息的大小</p>
</blockquote>
<p>还有一个值得记录的是-x选项，说是根据IP反查域名（另外每个命令后面添加+short可以简化输出信息）</p>
<pre class="line-numbers language-none"><code class="language-none">dig -x 183.84.6.134	# 访问PTR记录，查询该IP地址所对应的主机名，DNS解析是用域名查IP，而PTR记录是IP查域名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240101202406892.png" alt="image-20240101202406892"></p>
<p>不过这里始终没看出来域名在哪里。。。。还有一个+trace命令可以看到域名解析详细过程</p>
<p><img src="image-20240101204008916.png" alt="image-20240101204008916"></p>
<h4 id="ICP备案查询">ICP备案查询</h4>
<p>ICP备案是指网站在信息产业部提交网站信息进行官方认可。对国内各大小网站(包括企业及个人站点)的严格审查工作，对于没有合法备案的非经营性网站或没有取得ICP许可证的经营性网站，根据网站性质，将予以罚款，严重的关闭网站，以此规范网络安全，打击一切利用网络资源进行不法活动的犯罪行为。也就是说，只要是盈利为目的的网站，都要进行ICP备案，否则会受到相应的处罚。</p>
<p><strong>国内使用国内服务器的网站，都必须要先办理ICP备案后才可以上线。</strong></p>
<p>通过查询目标企业的备案信息，可直接获取到目标企业注册了哪些域名，从而增加可渗透的目标范围。</p>
<p>推荐使用官方网站<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/recordQuery">ICP/IP地址/域名信息备案管理系统</a> ——支持使用<code>单位名称</code>、<code>域名</code>和<code>备案号</code>进行查询</p>
<p><img src="image-20240106150321631.png" alt="image-20240106150321631"></p>
<h4 id="站长工具">站长工具</h4>
<p><img src="image-20240106150456508.png" alt="image-20240106150456508"></p>
<h4 id="爱站网">爱站网</h4>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.aizhan.com/cha/">站长seo综合查询工具-爱站网</a></li>
</ul>
<p><img src="image-20240106150621739.png" alt="image-20240106150621739"></p>
<h4 id="证书查询">证书查询</h4>
<p>SSL证书是一种遵守SSL协议的服务器数字证书，由受信任的根证书颁发机构颁发。 SSL证书采用SSL协议进行通信，SSL证书部署到服务器后，服务器端的访问将启用HTTPS协议。 您的网站将会通过HTTPS加密协议来传输数据，可帮助服务器端和客户端之间建立加密链接，从而保证数据传输的安全。</p>
<p>通过查询共用SSL证书的网站，可以找到相关的其他域名。</p>
<p>第一种可以浏览器直接查看，如下图，点击更多信息</p>
<p><img src="image-20240106151111537.png" alt="image-20240106151111537"></p>
<p><img src="image-20240106151207608.png" alt="image-20240106151207608"></p>
<p>接着点击上图的查看证书即可</p>
<p><img src="image-20240106151233576.png" alt="image-20240106151233576"></p>
<p>第二种是利用在线网站查询： <a target="_blank" rel="noopener" href="https://crt.sh/">crt.sh</a></p>
<p><img src="image-20240106151348228.png" alt="image-20240106151348228"></p>
<p>第三种是通过网络空间搜索引擎</p>
<p>可查询fofa语法手册：</p>
<table>
<thead>
<tr>
<th style="text-align:left">语法</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>cert="baidu"</code></td>
<td style="text-align:left">搜索证书(https或者imaps等)中带有baidu的资产。</td>
</tr>
<tr>
<td style="text-align:left"><code>cert.subject="Oracle Corporation"</code></td>
<td style="text-align:left">搜索证书持有者是Oracle Corporation的资产</td>
</tr>
<tr>
<td style="text-align:left"><code>cert.issuer="DigiCert"</code></td>
<td style="text-align:left">搜索证书颁发者为DigiCert Inc的资产</td>
</tr>
<tr>
<td style="text-align:left"><code>cert.is_valid=true</code></td>
<td style="text-align:left">验证证书是否有效，true有效，false无效</td>
</tr>
</tbody>
</table>
<p><img src="image-20240106151558662.png" alt="image-20240106151558662"></p>
<h4 id="DNS共享记录查询">DNS共享记录查询</h4>
<p>DNS（Domain Name Server，域名服务器）是进行域名(domain name)和与之相对应的IP地址 (IP address)转换的服务器。DNS中保存了一张域名(domain name)和与之相对应的IP地址 (IP address)的表，以解析消息的域名。 域名是Internet上某一台计算机或计算机组的名称，用于在数据传输时标识计算机的电子方位（有时也指地理位置）。域名是由一串用点分隔的名字组成的，通常包含组织名，而且始终包括两到三个字母的后缀，以指明组织的类型或该域所在的国家或地区。</p>
<p>此处通过查询共享DNS服务器的主机来获取到相关的域名；需要注意的是，如果是公开的DNS服务器，那么查询的效果将会特别差。</p>
<p>首先查询目标是否存在自建的NS服务器</p>
<p><img src="image-20240106151959401.png" alt="image-20240106151959401"></p>
<p>将获取到的NS服务器带入 <a target="_blank" rel="noopener" href="https://hackertarget.com/find-shared-dns-servers/">https://hackertarget.com/find-shared-dns-servers/</a> 进行查询</p>
<p><img src="image-20240106152116789.png" alt="image-20240106152116789"></p>
<p><img src="image-20240106152128296.png" alt="image-20240106152128296"></p>
<p>此处查询的结果并不全是属于目标范围，需要进一步的确认和观察。</p>
<h4 id="IP反查">IP反查</h4>
<p>目标多个域名可能绑定在同一IP上，通过IP反查一定情况下可获取到其他的域名信息。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://s.tool.chinaz.com/same">同IP网站查询，同服务器网站查询 - 站长工具</a></li>
<li><a target="_blank" rel="noopener" href="https://dnslytics.com/">Online investigation tool - Reverse IP, NS, MX, WHOIS and Search Tools</a></li>
</ul>
<p>输入相关的域名或IP地址即可查询。</p>
<p><img src="image-20240106152413850.png" alt="image-20240106152413850"></p>
<p><img src="image-20240106152542354.png" alt="image-20240106152542354"></p>
<p><img src="image-20240106152557186.png" alt="image-20240106152557186"></p>
<p>搜索引擎搜索<code>IP反查域名</code>即可，但有时候效果并不理想，很多情况查不到</p>
<p>推荐使用平台：<a target="_blank" rel="noopener" href="https://securitytrails.com/dns-trails">https://securitytrails.com/dns-trails</a></p>
<p><img src="image-20240106175828753.png" alt="image-20240106175828753"></p>
<p><code>fofa</code>、<code>zoomeye</code>、<code>hunter</code>、<code>quake</code>等，最推荐的还是<code>hunter</code>，效果最好，能查到很多东西</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//hunter.qianxin.com/list?search=ip%3D"220.181.38.251"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240106175927343.png" alt="image-20240106175927343"></p>
<h4 id="股权信息">股权信息</h4>
<p>通过查询股权信息，或者股权穿透图，寻找子公司和孙公司等，一般对外投资超过50%或者有行政权限的都可以算目标</p>
<ol>
<li>天眼查：<a target="_blank" rel="noopener" href="https://www.tianyancha.com/">https://www.tianyancha.com/</a></li>
<li>企查查：<a target="_blank" rel="noopener" href="https://www.qcc.com/">https://www.qcc.com/</a></li>
</ol>
<p>如查询字节跳动</p>
<p><img src="image-20240106162039305.png" alt="image-20240106162039305"></p>
<p>通过查询子公司，再查询子公司对应的产品，可以大范围的扩大攻击面</p>
<p><strong>工具推荐</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/wgpsec/ENScan_GO">https://github.com/wgpsec/ENScan_GO</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/i11us0ry/AScan">https://github.com/i11us0ry/AScan</a></li>
</ul>
<h4 id="Hackerone">Hackerone</h4>
<p>一些在hackerone上进行众测的厂商，会把自己的测试范围列举出来，其中就包含有大量的域名，因此通过hackerone来完善资产收集也是一个不错的方法。</p>
<p>以阿里为例：<a target="_blank" rel="noopener" href="https://hackerone.com/alibaba?type=team&amp;view_policy=true">https://hackerone.com/alibaba?type=team&amp;view_policy=true</a></p>
<p><img src="image-20240106164324179.png" alt="image-20240106164324179"></p>
<h4 id="Google">Google</h4>
<p>Google直接搜索里面的一些关键内容来查询，比如公司名、备案、引用的特殊js等</p>
<p>还是以阿里为例（别人的成果图）</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token property">intext</span><span class="token punctuation">:</span>浙ICP备09048685号 <span class="token property">intext</span><span class="token punctuation">:</span>11040102700068 -www<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240106164906048.png" alt="image-20240106164906048"></p>
<h4 id="国家企业信用信息公示系统">国家企业信用信息公示系统</h4>
<p><a target="_blank" rel="noopener" href="https://shiming.gsxt.gov.cn/corp-query-search-1.html">https://shiming.gsxt.gov.cn/corp-query-search-1.html</a></p>
<p><img src="image-20240106165623017.png" alt="image-20240106165623017"></p>
<h3 id="获取真实IP">获取真实IP</h3>
<p>为了保证网络的稳定和快速传输，网站服务商会在网络的不同位置设置节点服务器，通过 CDN（Content Delivery Network，内容分发网络）技术，将网络请求分发到最优的节点服务器上面。如果网站开启了 CDN 加速，就无法通过网站的域名信息获取真实的 IP，要对目标的 IP 资源进行收集，就要绕过 CDN 查询到其真实的 IP 信息。</p>
<p>一个小tip：浏览器切换手机模式，可能是真实ip，公众号、小程序中的资产也可能对应真实ip。</p>
<h4 id="如何判断是否有CDN">如何判断是否有CDN</h4>
<p>在对目标 IP 信息收集之前，首先要判断目标网站是否开启了 CDN，一般通过不同地方的主机 ping 域名和 nslookup 域名解析两种方法，通过查看返回的 IP 是否是多个的方式来判断网站是否开启了 CDN，如果返回的 IP 信息是多个不同的 IP，那就有可能使用了 CDN 技术。</p>
<h5 id="方法一：多地ping">方法一：多地ping</h5>
<p>使用各种多地 ping 的服务，查看对应 IP 地址是否唯一，如果不唯一多半是使用了CDN， 多地 Ping 网站有：</p>
<p><img src="image-20240101205110956.png" alt="image-20240101205110956"></p>
<p><img src="image-20240101205140092.png" alt="image-20240101205140092"></p>
<p>可以到有多个IP，一般这种方法要根据多个网站都进行尝试一下，才能更好的确定，不过这里能用的我知道的只有两个</p>
<p><a target="_blank" rel="noopener" href="http://ping.chinaz.com/%E3%80%81http://ping.aizhan.com/%E8%80%8C%E4%B8%94%E5%90%8E%E8%80%85%E8%BF%98%E4%BC%BC%E4%B9%8E%E5%B4%A9%E4%BA%86%EF%BC%8C%E6%9F%A5%E8%AF%A2%E6%B2%A1%E5%8F%8D%E5%BA%94">http://ping.chinaz.com/、http://ping.aizhan.com/而且后者还似乎崩了，查询没反应</a></p>
<p>又去谷歌找了一番，无果，感觉有需要的话需要多翻翻一些网站了。</p>
<h5 id="方法二：nslookup">方法二：nslookup</h5>
<p>试用nslookup进行检测，如果返回域名解析对应多个IP，那么多半是试用了CDN.</p>
<pre class="line-numbers language-none"><code class="language-none">nslookup http://example.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240101210831289.png" alt="image-20240101210831289"></p>
<p>这里看到一个是有多个IP地址，一个是name的值直接就是cdn.net什么的，这很明显就是有CDN了</p>
<h5 id="方法三：在线工具">方法三：在线工具</h5>
<p>在线工具查看是否存在CDN，可以参考以下站点:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.cdnplanet.com/tools/cdnfinder">http://www.cdnplanet.com/tools/cdnfinder</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ipip.net/ip.html">http://www.ipip.net/ip.html</a></li>
</ul>
<p>这里推荐第二个站点</p>
<p><img src="image-20240101211349443.png" alt="image-20240101211349443"></p>
<h4 id="绕过CDN">绕过CDN</h4>
<h5 id="查询历史DNS记录">查询历史DNS记录</h5>
<p>查看 IP 与 域名绑定的历史记录，可能会存在使用 CDN 前的记录，相关查询网站有</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a></li>
</ul>
<p><img src="image-20240101220032934.png" alt="image-20240101220032934"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://censys.io/ipv4?q=baidu.com">https://censys.io/ipv4?q=baidu.com</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/projectdiscovery/cdncheck">https://github.com/projectdiscovery/cdncheck</a> –未仔细查看</li>
<li><a target="_blank" rel="noopener" href="https://viewdns.info/iphistory/">https://viewdns.info/iphistory/</a></li>
</ul>
<p><img src="image-20240101212421633.png" alt="image-20240101212421633"></p>
<p><a target="_blank" rel="noopener" href="https://securitytrails.com/">https://securitytrails.com/</a> –需要企业邮箱注册，不过很全</p>
<p>SecurityTrails（前身为 DNS Trails）拥有大约3.5万亿DNS记录，3亿whois记录，8亿SSL证书记录以及超过4.5亿子域的记录数据。自2008年以来，网站每天都收集和更新海量数据。</p>
<p>DNS 记录：</p>
<p><img src="image-20240101214927518.png" alt="image-20240101214927518"></p>
<p>IP历史</p>
<p><img src="image-20240101214837563.png" alt="image-20240101214837563"></p>
<p>子域名：</p>
<p><img src="image-20240101215012570.png" alt="image-20240101215012570"></p>
<p>Complete DNS（<a target="_blank" rel="noopener" href="https://completedns.com/%EF%BC%89Complete">https://completedns.com/）Complete</a> DNS 拥有超过 22 亿个DNS变更记录，提供API，支持同时进行多域名/IP查询。</p>
<p><img src="image-20240101215229120.png" alt="image-20240101215229120"></p>
<p>WhoISrequest （<a target="_blank" rel="noopener" href="https://whoisrequest.com/%EF%BC%89">https://whoisrequest.com/）</a></p>
<p>WhoISrequest 这个网站自2002年以来一直在跟踪和记录DNS历史变更，数据底蕴很足。</p>
<p>不过这里查了半天没查到什么信息，而且这个网站似乎对于dns历史记录用的是上面的网站的api</p>
<p>Whoxy（<a target="_blank" rel="noopener" href="https://www.whoxy.com/%EF%BC%89">https://www.whoxy.com/）</a></p>
<p>Whoxy 拥有爬取超过 3.65亿个子域数据，该网站 API 调用非常方便，以 XML 和 JSON 格式返回数据。</p>
<p><img src="image-20240101215944112.png" alt="image-20240101215944112"></p>
<p>还有很多网站，这里就不一一介绍了，详细可浏览参考文章，这里汇总一下</p>
<blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.cdnplanet.com/tools/cdnfinder">http://www.cdnplanet.com/tools/cdnfinder</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ipip.net/ip.html">http://www.ipip.net/ip.html</a></li>
<li><a target="_blank" rel="noopener" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a></li>
<li><a target="_blank" rel="noopener" href="https://censys.io/ipv4?q=baidu.com">https://censys.io/ipv4?q=baidu.com</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/projectdiscovery/cdncheck">https://github.com/projectdiscovery/cdncheck</a></li>
<li><a target="_blank" rel="noopener" href="https://viewdns.info/iphistory/">https://viewdns.info/iphistory/</a></li>
<li><a target="_blank" rel="noopener" href="https://securitytrails.com/">https://securitytrails.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://completedns.com/">https://completedns.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://whoisrequest.com/">https://whoisrequest.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.whoxy.com/">https://www.whoxy.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://dnsdb.io/">https://dnsdb.io/</a></li>
<li><a target="_blank" rel="noopener" href="https://reverse-ip.whoisxmlapi.com/">https://reverse-ip.whoisxmlapi.com/</a></li>
</ul>
</blockquote>
<h5 id="使用国外主机请求域名">使用国外主机请求域名</h5>
<p>部分国内的 CDN 加速服务商只对国内的线路做了 CDN 加速，但是国外的线路没有做加速，这样就可以通过国外的主机来探测真实的 IP 信息。</p>
<p>探测的方式也有两种，可以利用已有的国外主机直接进行探测；如果没有国外主机，可以利用公开的多地 ping 服务（多地 ping 服务有国外的探测节点），可以利用国外的探测节点返回的信息来判断真实的 IP 信息。</p>
<h5 id="网站信息泄露漏洞">网站信息泄露漏洞</h5>
<ul>
<li>服务器日志文件</li>
<li>探针文件，例如 phpinfo</li>
<li>网站备份压缩文件</li>
<li>.DS_Store</li>
<li>.hg</li>
<li>.git</li>
<li>SVN</li>
<li>Web.xml</li>
</ul>
<p>字典非常重要，往往疏忽的点就在一台边缘服务器。</p>
<p>小tip：phpinfo 页面中有一个 SERVER_ADDR 字段会显示该主机真实 IP。</p>
<h5 id="查询子域名">查询子域名</h5>
<p>这里注意的就是子域名、C段以及旁站（同IP网站）</p>
<p>由于 CDN 加速需要支付一定的费用，很多网站只对主站做了 CDN 加速，子域名没有做 CDN 加速，子域名可能跟主站在同一个服务器或者同一个 C 段网络中，可以通过子域名探测的方式，收集目标的子域名信息，通过查询子域名的 IP 信息来辅助判断主站的真实 IP 信息。   ———具体的方法在下面叙述</p>
<h5 id="邮件信息">邮件信息</h5>
<p>一般大型网站自己部署架设的邮件服务器如果向外部用户发送邮件的话，如果中间未经任何数据处理和防护措施，那么邮件头部的源码中会包含此邮件服务器的真实 IP 地址。常见的邮件触发点有：</p>
<ul>
<li>RSS 订阅</li>
<li>邮箱注册、激活处</li>
<li>邮箱找回密码处</li>
<li>产品更新的邮件推送</li>
<li>某业务执行后发送的邮件通知</li>
<li>员工邮箱、邮件管理平台等入口处的忘记密码</li>
</ul>
<p><img src="image-20240102153303790.png" alt="image-20240102153303790"></p>
<p>另外这里还有一个<code>奇淫技巧</code>，通过发送邮件给一个不存在的邮箱地址，比如 <a href="mailto:000xxx@domain.com">000xxx@domain.com</a> ，因为该用户不存在，所以发送将失败，并且还会收到一个包含发送该电子邮件给你的服务器的真实 IP 通知。</p>
<p>生产上多关注这些点，一个不成功继续测试下一个邮件触发点，很多大型网站的邮件服务器不止一台，并不是所有都做了防护处理，细节决定成败。</p>
<h5 id="目标网站-APP-应用">目标网站 APP 应用</h5>
<p>如果目标网站有自己的 App，可以尝试利用 Burp Suite 等流量抓包工具抓取 App 的请求，从里面可能会找到目标的真实 IP。</p>
<h3 id="子域名查询">子域名查询</h3>
<p>这里除了常见的网络空间如fofa、shodan、zoomeye、censys等，就是一些强大脚本工具了。这里熟悉几个常见的</p>
<h4 id="SubDomainsBrute">SubDomainsBrute</h4>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/lijiejie/subDomainsBrute">https://github.com/lijiejie/subDomainsBrute</a></p>
<p>SubDomainsBrute 是通过纯 DNS 爆破来寻找子域名，为了最大提升脚本效率，采用协程+多进程的方式进行爆破。Python 3.5 以上需要安装 aiodns 库进行异步查询，python 2 需要安装 dnspython 库和 gevent 协程库。</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">python subDomainsBrute.py baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240102190611143.png" alt="image-20240102190611143"></p>
<p>且在最近更新之后是支持扫描泛解析域名的，使用 -w 参数。——这里简单了解了一下域名泛解析。</p>
<p>简单来说就是DNS的泛域名解析也可以理解为带通配符的解析记录，带通配符的解析记录是用来为不存在的子域提供解析请求响应的方法。 <a target="_blank" rel="noopener" href="http://xn--example-4t3kgms1jty2anogusg.com">例如存在一个example.com</a>，如果我们设置通配符记录：*.example.com，则对其不存在的所有子域，<a target="_blank" rel="noopener" href="http://xn--abcd-f96g315g.example.com">比如abcd.example.com</a>、<a target="_blank" rel="noopener" href="http://xxx.example.com">xxx.example.com</a>（这些都是不存在的子域），则如果我们在对这些子域进行请求的时候，<a target="_blank" rel="noopener" href="http://xn--example-lo5kg8xfwdy10d6p7ek7wb.com">都会自动指向example.com</a>。</p>
<p>因此基于上述原理，如果我们的目标域名设置了这样的泛解析，那我们可以凭借强大的字典对其任意子域进行请求，看最终返回的ip是否与其主域IP一致，如果一致那说明该子域不存在；但如果不一致，说明该子域是存在的。</p>
<p>当然如果目标域名没有设置泛解析，那我们在对其子域进行请求的时候，如果返回了与主域IP地址不同的情况，则直接说明该子域存在</p>
<p>我们针对一个泛解析的域名进行爆破，subDomainsBrute 会提示 any-sub 错误，之后使用 -w 参数开启泛解析强制爆破</p>
<h4 id="ESD">ESD</h4>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/FeeiCN/ESD">https://github.com/FeeiCN/ESD</a> –具体的就不介绍了，看一下使用效果即可，这里扫描单个域名看看</p>
<p><img src="image-20240102194424947.png" alt="image-20240102194424947"></p>
<p>就是速度有点慢</p>
<pre class="line-numbers language-none"><code class="language-none"># 扫描单个域名
esd -d qq.com

# debug模式扫描单个域名
esd=debug esd -d qq.com

# 扫描多个域名（英文逗号分隔）
esd --domain qq.com,tencent.com

# 扫描单个域名且过滤子域名中单个特定响应内容
esd --domain mogujie.com --filter 搜本店

# 扫描单个域名且过滤子域名中多个特定响应内容
esd --domain mogujie.com --filter 搜本店,收藏店铺

# 扫描文件（文件中每行一个域名）
esd --file targets.txt

# 跳过相似度对比（开启这个选项会把所有泛解析的域名都过滤掉）
esd --domain qq.com --skip-rsc

# 平均分割字典，加快爆破
esd --domain qq.com --split 1/4

# 使用DNS域传送漏洞获取子域名
esd --domain qq.com --dns-transfer

# 使用HTTPS证书透明度获取子域名
esd --domain qq.com --ca-info<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Layer-子域名挖掘机">Layer 子域名挖掘机</h4>
<p>项目地址：<a target="_blank" rel="noopener" href="https://hub.fastgit.org/euphrat1ca/LayerDomainFinder/releases/tag/3">https://hub.fastgit.org/euphrat1ca/LayerDomainFinder/releases/tag/3</a></p>
<p><img src="image-20240102195144221.png" alt="image-20240102195144221"></p>
<h4 id="Xray">Xray</h4>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/chaitin/xray">https://github.com/chaitin/xray</a></p>
<p>xray 是一款强大的安全评估工具，一款自动化扫描器，我们可以用其自带的 subdomain 子域名发掘功能来针对性探测：</p>
<p>subdomain 功能支持暴力破解模式和非暴力模式，可以只探测 web 服务或者只探测 ip 可解析的子域，另外支持 webhook 数据传递，作为插件端或者分发消息的接收端来使用都非常方便快捷。</p>
<p><img src="image-20240102205755924.png" alt="image-20240102205755924"></p>
<h4 id="Bypass-firewalls-by-DNS-history">Bypass-firewalls-by-DNS-history</h4>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/vincentcox/bypass-firewalls-by-DNS-history">https://github.com/vincentcox/bypass-firewalls-by-DNS-history</a></p>
<p>Bypass-firewalls-by-DNS-history 是一款集成全自动化的探测工具，通过探测 DNS 历史记录，搜索旧的 DNS A Record，收集子域，并检查服务器是否对该域名进行答复。 另外它还基于源服务器和防火墙在HTML响应中的相似性阈值来判断。</p>
<p><img src="image-20240102210033498.png" alt="image-20240102210033498"></p>
<h4 id="OneForAll">OneForAll</h4>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/shmilylty/OneForAll">https://github.com/shmilylty/OneForAll</a></p>
<p><img src="image-20240102211435020.png" alt="image-20240102211435020"></p>
<h4 id="搜索引擎发现子域名">搜索引擎发现子域名</h4>
<p>使用搜索引擎语法，如Google 或者百度等</p>
<pre class="line-numbers language-none"><code class="language-none">Google-》site:xxx.com
Fofa-》domain="xxx.com"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="image-20240102211855257.png" alt="image-20240102211855257"></p>
<h4 id="第三方聚合服务发现子域名">第三方聚合服务发现子域名</h4>
<p>第三方聚合平台 Netcraft、Virustotal、ThreatCrowd、DNSdumpster 和 ReverseDNS 等获取子域信息。</p>
<h4 id="通过-SSL-证书">通过 SSL 证书</h4>
<ul>
<li>证书颁发机构 (CA) 必须将他们发布的每个 SSL/TLS 证书发布到公共日志中，SSL/TLS 证书通常包含域名、子域名和电子邮件地址。因此可以利用 SSL/TLS 证书来发现目标站点的真实 IP 地址。</li>
<li>CDN 运营商在给服务器提供保护的同时，也会与其服务器进行加密通信（ssl），这时当服务器的 443 端口接入域名时也会在 443 端口暴露其证书，我们通过证书比对便可发现网站的真实 IP 地址。</li>
</ul>
<ol>
<li>利用 Censys 引擎（<a target="_blank" rel="noopener" href="https://censys.io/%EF%BC%89">https://censys.io/）</a></li>
</ol>
<ul>
<li>Censys 搜索引擎能够扫描整个互联网，每天都会扫描 IPv4 地址空间，以搜索所有联网设备并收集相关的信息，可以利用 Censys 进行全网方面的 SSL 证书搜索，找到匹配的真实 IP 。</li>
</ul>
<p>可以看到，当我们针对一个互联网 IP 地址进行搜索时，是有匹配到证书 sha1 签名的</p>
<p><img src="image-20240102215326027.png" alt="image-20240102215326027"></p>
<p>同理，我们根据域名指纹搜索 SSL 证书指纹，然后再反查 IP 就可以了。</p>
<p>首先针对目标域名，选择 <code>Certificates</code> 证书搜索，结果出来一堆 <code>有效</code> 的证书和 <code>无效 </code> 的证书：</p>
<p>我们在搜索的时候可以使用语法来先检索有效证书，如果无果再回去查看无效证书</p>
<p><img src="image-20240102215803297.png" alt="image-20240102215803297"></p>
<p><img src="image-20240102215743683.png" alt="image-20240102215743683"></p>
<p><img src="image-20240102215826897.png" alt="image-20240102215826897"></p>
<h4 id="使用命令行">使用命令行</h4>
<ul>
<li>通过 <code>openssl</code> 和 <code>curl</code> 等常见的基础命令，也同样可以达到反查 SSL 证书的效果。</li>
</ul>
<p>openssl：附上成果图</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">openssl s_client -connect <span class="token property">ip</span><span class="token punctuation">:</span>443 | grep subject<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240102220521953.png" alt="image-20240102220521953"></p>
<p>curl：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> https://123.123.123.123 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'subject'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240102220459535.png" alt="image-20240102220459535"></p>
<h4 id="使用工具和脚本">使用工具和脚本</h4>
<ul>
<li>通过自己写工具脚本，集成前面的1、2两点，完全可以做到一个简易版的 SSL 全网证书爬取，也可以利用现有的一些脚本工具和网站，省的我们自己费力了。</li>
</ul>
<p>例如 <code>CloudFlair</code> ，项目地址：<a target="_blank" rel="noopener" href="https://github.com/christophetd/CloudFlair">https://github.com/christophetd/CloudFlair</a></p>
<p>脚本兼容 python2.7 和 3.5，需要配置 Censys API，不过只针对目标网站是否使用 CloudFlare 服务进行探测。</p>
<h4 id="证书收集">证书收集</h4>
<p>可以通过 <a target="_blank" rel="noopener" href="https://crt.sh/">https://crt.sh</a> 进行快速证书查询收集</p>
<p><img src="image-20240102220811833.png" alt="image-20240102220811833"></p>
<p><img src="image-20240102220822759.png" alt="image-20240102220822759"></p>
<p>附上查询的 python 小脚本：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> re

TIME_OUT <span class="token operator">=</span> <span class="token number">60</span>
<span class="token keyword">def</span> <span class="token function">get_SSL</span><span class="token punctuation">(</span>domain<span class="token punctuation">)</span><span class="token punctuation">:</span>
    domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    url <span class="token operator">=</span> <span class="token string">'https://crt.sh/?q=%25.{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>domain<span class="token punctuation">)</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span>TIME_OUT<span class="token punctuation">)</span>
    ssl <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;TD&gt;(.*?).{}&lt;/TD&gt;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>domain<span class="token punctuation">)</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> ssl<span class="token punctuation">:</span>
        i <span class="token operator">+=</span> <span class="token string">'.'</span> <span class="token operator">+</span> domain
        domains<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>domains<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    get_SSL<span class="token punctuation">(</span><span class="token string">"baidu.com"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>获得所有包含证书的子域：</p>
<h4 id="通过海外-DNS-查询">通过海外 DNS 查询</h4>
<ul>
<li>针对国内市场用户，大部分的 CDN 服务商并没有做海外市场的 CDN ，所以可以通过寻找小众、冷门的海外 DNS 查询，看是否能获得真实 IP 。</li>
</ul>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nslookup target.com &lt;海外 DNS 地址&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240102221000835.png" alt="image-20240102221000835"></p>
<p>也可以使用海外的超级ping类的平台在线多国家多地区测试，推荐 <a target="_blank" rel="noopener" href="https://www.host-tracker.com/v3/check/">https://www.host-tracker.com/v3/check/</a> ，支持 140 多个地区的 ping 测试，另外支持针对某子域超长期的监控，通过邮件通知，简直太强大了。——就是需要氪金</p>
<p><img src="image-20240102221402157.png" alt="image-20240102221402157"></p>
<p>小技巧：在<a target="_blank" rel="noopener" href="https://github.com/">https://github.com/</a> 上也可以搜索子域名，运气好的话，会有意想不到的收获。</p>
<h4 id="通过变更的域名">通过变更的域名</h4>
<ul>
<li>很多网站在发展的过程中，会更换域名，比如京东以前的域名是 <a target="_blank" rel="noopener" href="http://360buy.com">360buy.com</a> ，后来斥巨资购买了 <a target="_blank" rel="noopener" href="http://jd.com">jd.com</a> 。</li>
<li>网站在更换新域名时，如果将 CDN 部署到新的域名上，而之前的域名由于没过期，可能未使用 CDN，因此可以直接获得服务器 IP，所以，历史域名也是一个很重要的点。</li>
</ul>
<h4 id="通过-APP-移动端应用">通过 APP 移动端应用</h4>
<ul>
<li>如果网站存在 APP ，可以通过抓包分析其 APP 的数据流量，看是否能找到网站真实 IP 地址，记得关注 APP 的历史版本，里面会有很多 surprise 。</li>
</ul>
<h4 id="通过-F5-LTM-解码">通过 F5 LTM 解码</h4>
<ul>
<li>LTM 是将所有的应用请求分配到多个节点服务器上。提高业务的处理能力，也就是负载均衡。</li>
<li>当服务器使用 F5 LTM 做负载均衡时，通过对 <code>set-cookie</code> 关键字的解码，可以获取服务器真实 ip 地址。</li>
</ul>
<p>例如：</p>
<pre class="line-numbers language-none"><code class="language-none">Set-Cookie: BIGipServerpool_9.29_5229=605532106.22012.0000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>先把第一小节的十进制数，即 605532106 取出来</li>
<li>将其转为十六进制数 2417afca</li>
<li>接着从后至前，取四个字节出来： CA AF 17 24</li>
<li>最后依次转为十进制数 202.175.23.36，即是服务器的真实 ip 地址。</li>
</ul>
<h4 id="通过全网扫描">通过全网扫描</h4>
<ul>
<li>首先从 apnic 网络信息中心 或 IPdeny 获取目标地区 ip 段。</li>
<li>接着使用 Zmap、masscan 等工具对扫描出来端口开放的主机进行 banner 爬取。</li>
<li>然后在 http-req 的 Host 字段，写入我们需要寻找的子域。</li>
<li>最后过滤特征，确认是否有对应的服务器响应。</li>
<li>如果端口不是常见或者固定，当场退役。</li>
</ul>
<p>缺陷：实际上，全网扫描的方法十分笨重，不推荐。因为已经有很多的网站给我们提供了全网爬取服务，之前的方法里都有介绍到，何必自己全网扫描呢，受限于网络、受限于设备，你个人爬的数据也不会有人家商业爬的全</p>
<h4 id="通过-virtual-host-碰撞">通过 virtual-host 碰撞</h4>
<ul>
<li>当我们收集了目标足够多的可能的真实 IP 时，可以通过 IP 和子域的碰撞，来批量获得命中目标以及目标哪些的子域。</li>
</ul>
<p>这里对于我这个小白还不懂什么是host碰撞，那我们先来了解一下：</p>
<p>什么是HOSTS碰撞：</p>
<blockquote>
<p>当直接访问IP回显4xx错误，直接指定HOST头为某个域名时访问该IP回显正常时，可判断可进行HOSTS碰撞。<br>
当一些域名只允许在内网访问时，可通过这种碰撞直接突破边界限制，访问到内网系统进行下一步渗透测试。</p>
</blockquote>
<p>比如如果此时对方的网站对应的中间件有如下配置</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token selector">server </span><span class="token punctuation">{</span>
    listen 80 default_server<span class="token punctuation">;</span>
    server_name _<span class="token punctuation">;</span>
    return 400<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">server </span><span class="token punctuation">{</span>
    listen 80<span class="token punctuation">;</span>
    server_name www.tpaertest.com<span class="token punctuation">;</span>
        
    <span class="token selector">location / </span><span class="token punctuation">{</span>
        proxy_pass <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//192.168.3.17:8003;</span>
        proxy_redirect off<span class="token punctuation">;</span>
        proxy_set_header Host <span class="token property"><span class="token variable">$host</span></span><span class="token punctuation">:</span><span class="token variable">$server_port</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        root html<span class="token punctuation">;</span>
        index index.html index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     access_log  logs/test.com.log<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>第一个server的意思是，监听80端口，且如果我们访问的servername不是其他server块儿（也就是这里的第二个）配置的servername，那就返回400。这里我们第二个server块儿设置了servername为指定域名，也就是如果我们在访问该网站的时候不是用指定域名访问的，就会返回400（也就是禁用IP访问了）。这里我结合那些文章举个例子吧：</p>
<p>比如我们此时对目标网站进行信息搜集之后，有了大量的IP资产，并且这些IP资产也开启了web端口，但当我们使用IP直接访问的时候会发现总是返回400、403、404等等。这基本就是对方的中间件使用了反向代理，禁用了IP访问。此时呢，对方网站设置的是：只能使用内网域名来访问该网站。</p>
<p>而对于处于外网的我们来讲，如果我们找到了该IP对应的真正域名，此时我们去访问该域名的时候也是行不通的，因为他是内网域名，而我们在访问的时候，会去公网DNS服务器去寻求域名对应解析出来的IP，但很明显是找不到的。</p>
<p>只有我们在本地hosts文件中设置<code>IP-&gt;正确域名</code>的解析关系，这时我们再去访问的时候就可以成功访问目标内网系统。因为本地hosts的IP解析优先级高于公共的DNS服务器。</p>
<p>具体可参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lxc408863575/article/details/120278310">边界渗透中的小技巧-Hosts碰撞</a> 、<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9590">利用HOSTS碰撞突破边界</a>、<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_18980147/article/details/127511001">Host碰撞环境搭建原理及复现</a></p>
<p>回到正题，那我们在遇到类似情况就可以使用自动化工具来快速明确IP与域名的正确绑定关系：</p>
<p>自动化的过程可以使用 virtual-host-discovery 工具，项目地址：<a target="_blank" rel="noopener" href="https://github.com/jobertabma/virtual-host-discovery">https://github.com/jobertabma/virtual-host-discovery</a></p>
<p>使用方法：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">$ ruby scan.rb --ip=x.x.x.x --host=domain  --wordlist=&lt;dict file&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中wordlsit 参数可以省略，默认有一个字典加载，使用该参数则是指定我们自己想要跑的子域列表。</p>
<p>执行后，即可快速找出命中 IP 的子域，这里放上一个成果图（未实践）</p>
<p><img src="image-20240104212403832.png" alt="image-20240104212403832"></p>
<p>另外可以通过 find-virtual-hosts （<a target="_blank" rel="noopener" href="https://pentest-tools.com/information-gathering/find-virtual-hosts#%EF%BC%89%E5%B7%A5%E5%85%B7%E6%9D%A5%E5%9C%A8%E7%BA%BF%E5%BF%AB%E9%80%9F%E9%92%88%E5%AF%B9%E5%85%A8%E7%BD%91%E6%95%B0%E6%8D%AE%E6%89%AB%E6%8F%8F%E6%AF%94%E5%AF%B9%E5%BE%97%E5%87%BA%E7%BB%93%E6%9E%9C%EF%BC%9A">https://pentest-tools.com/information-gathering/find-virtual-hosts#）工具来在线快速针对全网数据扫描比对得出结果：</a></p>
<p><img src="image-20240104212659798.png" alt="image-20240104212659798"></p>
<h4 id="通过-favicon-ico-哈希特征">通过 favicon.ico 哈希特征</h4>
<ul>
<li>favicon.ico 是现代浏览器在网页标题的左侧显示的一个小图标。</li>
<li>该图标数据通常是从 <a target="_blank" rel="noopener" href="https://anywebsite/favicon.ico">https://anywebsite/favicon.ico</a> 处获取的，浏览器会在浏览任何网站时自动请求它。</li>
<li>因为可以通过计算 favicon.ico 的指纹哈希，然后去 shodan 等搜索引擎搜索与之相同的主机结果，从而进一步探测是否能挖掘出目标网站的真实 IP 地址。</li>
</ul>
<p>计算 favicon.ico 哈希的小脚本：</p>
<p>python 2</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> mmh3
<span class="token keyword">import</span> requests
 
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://domain.com/favicon.ico'</span><span class="token punctuation">)</span>
favicon <span class="token operator">=</span> response<span class="token punctuation">.</span>content<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span>
<span class="token builtin">hash</span> <span class="token operator">=</span> mmh3<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">(</span>favicon<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token builtin">hash</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>python 3</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> mmh3
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> codecs
 
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://domain.com/favicon.ico'</span><span class="token punctuation">)</span>
favicon <span class="token operator">=</span> codecs<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">,</span><span class="token string">"base64"</span><span class="token punctuation">)</span>
<span class="token builtin">hash</span> <span class="token operator">=</span> mmh3<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">(</span>favicon<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hash</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>安装好环境依赖后执行脚本，计算得到目标网站的 favicon.ico 哈希值：</p>
<p><img src="image-20240104220746280.png" alt="image-20240104220746280"></p>
<p>然后用 shodan 搜索引擎搜索哈希，去命中 IP：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains4 shodan search http.favicon.hash:1533180946 <span class="token parameter variable">--fields</span> ip_str,port <span class="token parameter variable">--separator</span> <span class="token string">" "</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1":"$2}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240105194829215.png" alt="image-20240105194829215"></p>
<p>这里不知为何访问总是被禁，但在网站上还是可以正常访问的。。。。</p>
<p><img src="image-20240105194901587.png" alt="image-20240105194901587"></p>
<p>感觉是api-key的问题，但也没解决，先放着吧。。。</p>
<h4 id="通过网页源码特征值">通过网页源码特征值</h4>
<ul>
<li>在服务器源 IP 地址允许访问并且返回的也是类似的网站内容情况下，可以通过侦察页面源码中 JS 、CSS 、HTML 等一系列静态特征值，然后用 Shodan 、Zoomeye 、Censys 等搜索引擎进行匹配搜索，从而定位 IP 。</li>
</ul>
<p>例如源码中找到一段 Google Analytics 的 JS 特征：</p>
<p><img src="image-20240105195727776.png" alt="image-20240105195727776"></p>
<p><img src="image-20240105195737542.png" alt="image-20240105195737542"></p>
<p>这里我的找的特征值也不够有特色，可以看到回显的</p>
<h4 id="使用-CloudFair-工具">使用 CloudFair 工具</h4>
<ul>
<li>如果你的目标是 CloudFlare 保护的，建议先上这款工具跑。</li>
<li>CloudFail 是一种战术侦察工具，旨在收集有关受 Cloudflare 保护的目标的足够信息，以期发现服务器的 IP 位置。</li>
</ul>
<p>该工具目前探测经过3个不同的攻击阶段：</p>
<p>1.使用 <a target="_blank" rel="noopener" href="http://DNSDumpster.com">DNSDumpster.com</a> 扫描 DNS 配置错误。 2.扫描和比对 <a target="_blank" rel="noopener" href="http://Crimeflare.com">Crimeflare.com</a> 数据库。 3.内置字典暴力扫描超过11000个子域名。</p>
<p>安装和使用：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">git clone <span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//github.com/m0rtem/CloudFail</span>
pip install -r requirements.txt
python cloudfail.py -t domain.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="DNS-域传送发现子域名">DNS 域传送发现子域名</h4>
<p>DNS 服务器分为：主服务器、备份服务器和缓存服务器。在主备服务器之间同步数据库，需要使用 “DNS 域传送”。域传送是指备份服务器从主服务器拷贝数据，并用得到的数据更新自身数据库。</p>
<p>若 DNS 服务器配置不当，可能导致攻击者获取某个域的所有记录。造成整个网络的拓扑结构泄露给潜在的攻击者，包括一些安全性较低的内部主机，如测试服务器。同时，黑客可以快速的判定出某个特定 zone 的所有主机，收集域信息，选择攻击目标，找出未使用的 IP 地址，绕过基于网络的访问控制。目前来看 “DNS 域传送漏洞” 已经很少了。</p>
<p>利用 nmap 漏洞检测脚本 <code>dns-zone-transfer</code> 进行检测</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmap <span class="token parameter variable">--script</span> dns-zone-transfer --script-args dns-zone-transfer.domain<span class="token operator">=</span>xxx.edu.cn <span class="token parameter variable">-p</span> <span class="token number">53</span> <span class="token parameter variable">-Pn</span> dns.xxx.edu.cn<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Linux dig命令进行测试</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">dig xxx.com nsdig axfr @dns xxx.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>最后记几个未能实践但却值得记录的几个方法（万一日后用上呢）</p>
<blockquote>
<ol>
<li>通过 CDN 标头特征值–censys搜索</li>
<li>通过 XML-RPC PINGBACK 通信 ——似乎是针对支持 WordPress 的网站的方法</li>
<li>通过 FTP/SCP 协议</li>
<li>利用 Websocket 协议——针对那些没有针对websocket进行部署的网站</li>
<li>社会工程学——社工的魅力</li>
<li>通过全网扫描</li>
<li>通过网站远程资源业务 ——注入我们自己的服务器资源文件，看http日志</li>
<li>通过CDN机器 ——对于自搭建CDN的网站，我们可以尝试渗透一些防护弱的CDN机器</li>
<li>通过流量耗尽、流量放大攻击 ——利用CDN流量有限的特点来进行ddos</li>
<li>通过域名备案信息广域探测——尝试寻找没有做CDN的边缘子域</li>
<li>利用CDN 服务商默认配置 ——CloudFlare ，默认配置 <a target="_blank" rel="noopener" href="http://direct.domain.com">direct.domain.com</a> 二级子域指向服务器源 IP</li>
</ol>
</blockquote>
<h2 id="IP段的收集">IP段的收集</h2>
<p>一般IP的话，我们在收集子域名的时候，就大概知道目标网站的IP段了。</p>
<p>也可以通过whois命令获取。即通过中国互联网信息中心<a target="_blank" rel="noopener" href="http://ipwhois.cnnic.net.cn/%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2%EF%BC%9A">http://ipwhois.cnnic.net.cn/进行查询：</a></p>
<p><img src="image-20240105222056899.png" alt="image-20240105222056899"></p>
<h2 id="C段与旁站查询">C段与旁站查询</h2>
<p>C 段：是指与目标服务器在同一 C 段网络的服务器。攻击目标的 C 段存活主机是信息收集的重要步骤，很多企业的内部服务器可能都会在一个 C 段网络中。在很难找到攻击目标服务器互联网漏洞的情况下，可以通过攻击 C 段主机，获取对 C 段主机的控制权，进入企业内网，在企业的内网安全隔离及安全防护不如互联网防护健全的情况下，可以通过 C 段的主机进行内网渗透，这样就可以绕过互联网的防护，对目标进行攻击。但是这种攻击方式容易打偏。</p>
<p>旁站：是和目标网站在同一台服务器上的其它的网站。</p>
<h3 id="Nmap扫描">Nmap扫描</h3>
<p>使用命令 nmap -sn x.x.x.x/24，对目标 IP 的 C 段主机进行存活扫描，根据扫描的结果可以判断目标 IP 的 C 段还有哪些主机存活。</p>
<p>nmap -Pn 这个命令在实际工作中的使用很多，该命令不通过 ICMP 协议进行主机存活判断，会直接对端口进行扫描。这样在开启了防火墙禁 Ping 的情况下，也可以利用这个命令正常扫描目标是否存活及对外开启的相关服务。</p>
<h3 id="搜索引擎语法">搜索引擎语法</h3>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">Google：<span class="token property">site</span><span class="token punctuation">:</span>x.x.x.*
Bing.com，语法为：<span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//cn.bing.com/search?q=ip:111.111.111.111 </span>
Fofa：ip=<span class="token string">"x.x.x.x/24"</span>
查旁站：<span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//chapangzhan.com/</span>
云悉：<span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//www.yunsee.cn/</span>
K8工具、goby、御剑、北极熊扫描器等
站长之家：<span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//s.tool.chinaz.com/same </span>
在线：<span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//www.webscan.cc/ </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240105223400508.png" alt="image-20240105223400508"></p>
<p><a target="_blank" rel="noopener" href="http://www.webscan.cc/">http://www.webscan.cc/</a></p>
<p><img src="image-20240106134155197.png" alt="image-20240106134155197"></p>
<h3 id="nmap扫描">nmap扫描</h3>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -p 80<span class="token punctuation">,</span>8080 --open ip/24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240106135431424.png" alt="image-20240106135431424"></p>
<p>这里一共是扫描出256的存活的ip。</p>
<h3 id="httpscan">httpscan</h3>
<p>项目地址： <a target="_blank" rel="noopener" href="https://github.com/zer0h/httpscan">https://github.com/zer0h/httpscan</a></p>
<p><img src="image-20240106141827978.png" alt="image-20240106141827978"></p>
<h3 id="bufferfly">bufferfly</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/dr0op/bufferfly">https://github.com/dr0op/bufferfly</a></p>
<p>攻防资产处理小工具，对攻防前的信息搜集到的大批量资产/域名进行存活检测、获取标题头、语料提取、常见web端口检测、简单中间识别，去重等，便于筛选有价值资产。——下面附上一个成果展示图：</p>
<p><img src="image-20240106142632225.png" alt="image-20240106142632225"></p>
<h3 id="cscan">cscan</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/z1un/cscan">https://github.com/z1un/cscan</a></p>
<p>与httpscan很像，不过这是py3的，但效果感觉不如http</p>
<p><img src="image-20240106143008013.png" alt="image-20240106143008013"></p>
<h3 id="masscan">masscan</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/robertdavidgraham/masscan">https://github.com/robertdavidgraham/masscan</a></p>
<p>与nmap类似，一个强大的端口扫描工具。优势在于速度快，缺点是误报率也高</p>
<p><img src="image-20240106144229835.png" alt="image-20240106144229835"></p>
<h3 id="fscan">fscan</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/shadow1ng/fscan">https://github.com/shadow1ng/fscan</a> ——扫描速度快，支持漏洞验证</p>
<p>一款内网综合扫描工具，方便一键自动化、全方位漏扫扫描。<br>
支持主机存活探测、端口扫描、常见服务的爆破、ms17010、redis批量写公钥、计划任务反弹shell、读取win网卡信息、web指纹识别、web漏洞扫描、netbios探测、域控识别等功能。</p>
<p><img src="image-20240106154843054.png" alt="image-20240106154843054"></p>
<h3 id="shuize">shuize</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/0x727/ShuiZe_0x727">https://github.com/0x727/ShuiZe_0x727</a></p>
<p>水泽自带资产探活、支持漏洞验证、Host碰撞</p>
<p><img src="image-20240106171305716.png" alt="image-20240106171305716"></p>
<h3 id="ALLiN">ALLiN</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/P1-Team/AlliN">https://github.com/P1-Team/AlliN</a></p>
<p>一个辅助平常渗透测试项目或者攻防项目快速打点的综合工具，由之前写的工具AG3改名而来。是一款轻便、小巧、快速、全面的扫描工具。多用于渗透前资产收集和渗透后内网横向渗透。工具从项目上迭代了一些懒人功能（比如提供扫描资产文件中，可以写绝大部分的各种形式的链接/CIDR,并在此基础上可以添加任意端口和路径）</p>
<p>红队信息搜集工具，被动识别访问站点是否是云上站点</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 AlliN.py <span class="token parameter variable">--host</span> <span class="token number">110.242</span>.68.0/24 <span class="token parameter variable">-p</span> <span class="token number">80</span> <span class="token parameter variable">-m</span> pscan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240106171621563.png" alt="image-20240106171621563"></p>
<h3 id="Ehole">Ehole</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/EdgeSecurityTeam/EHole">https://github.com/EdgeSecurityTeam/EHole</a></p>
<p>EHole是一款对资产中重点系统指纹识别的工具，在红队作战中，信息收集是必不可少的环节，如何才能从大量的资产中提取有用的系统(如OA、VPN、Weblogic…)。EHole旨在帮助红队人员在信息收集期间能够快速从C段、大量杂乱的资产中精准定位到易被攻击的系统，从而实施进一步攻击。</p>
<h2 id="开放端口探测">开放端口探测</h2>
<p>收集到大量IP，那就要进行端口扫描了，看看有什么常见的漏洞。</p>
<p>最常用的就是神器Nmap了。命令：nmap  -T4  -sT  -p -sV  ip</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">-sS <span class="token punctuation">(</span>TCP SYN扫描<span class="token punctuation">)</span>
-sT <span class="token punctuation">(</span>TCP <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>扫描<span class="token punctuation">)</span>
-sU <span class="token punctuation">(</span>UDP扫描<span class="token punctuation">)</span>
-sN<span class="token punctuation">;</span> -sF<span class="token punctuation">;</span> -sX <span class="token punctuation">(</span>TCP Null，FIN，and Xmas扫描<span class="token punctuation">)</span>
-Pn <span class="token punctuation">(</span>不通过ICMP探测<span class="token punctuation">)</span>

详细文档：
<span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//nmap.org/man/zh/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其次可能还会用到 masscan，常见端口及对应服务表：</p>
<table>
<thead>
<tr>
<th>端口</th>
<th>服务</th>
<th>渗透用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>tcp 20,21</td>
<td>FTP</td>
<td>允许匿名的上传下载,爆破,嗅探,win提权,远程执行(proftpd 1.3.5),各类后门(proftpd,vsftp 2.3.4)</td>
</tr>
<tr>
<td>tcp 22</td>
<td>SSH</td>
<td>可根据已搜集到的信息尝试爆破,v1版本可中间人,ssh隧道及内网代理转发,文件传输等等</td>
</tr>
<tr>
<td>tcp 23</td>
<td>Telnet</td>
<td>爆破,嗅探,一般常用于路由,交换登陆,可尝试弱口令</td>
</tr>
<tr>
<td>tcp 25</td>
<td>SMTP</td>
<td>邮件伪造,vrfy/expn查询邮件用户信息,可使用smtp-user-enum工具来自动跑</td>
</tr>
<tr>
<td>tcp/udp 53</td>
<td>DNS</td>
<td>允许区域传送,dns劫持,缓存投毒,欺骗以及各种基于dns隧道的远控</td>
</tr>
<tr>
<td>tcp/udp 69</td>
<td>TFTP</td>
<td>尝试下载目标及其的各类重要配置文件</td>
</tr>
<tr>
<td>tcp 80-89,443,8440-8450,8080-8089</td>
<td>各种常用的Web服务端口</td>
<td>可尝试经典的topn,vpn,owa,webmail,目标oa,各类Java控制台,各类服务器Web管理面板,各类Web中间件漏洞利用,各类Web框架漏洞利用等等……</td>
</tr>
<tr>
<td>tcp 110</td>
<td>POP3</td>
<td>可尝试爆破,嗅探</td>
</tr>
<tr>
<td>tcp 111,2049</td>
<td>NFS</td>
<td>权限配置不当</td>
</tr>
<tr>
<td>tcp 137,139,445</td>
<td>Samba</td>
<td>可尝试爆破以及smb自身的各种远程执行类漏洞利用,如,ms08-067,ms17-010,嗅探等……</td>
</tr>
<tr>
<td>tcp 143</td>
<td>IMAP</td>
<td>可尝试爆破</td>
</tr>
<tr>
<td>udp 161</td>
<td>SNMP</td>
<td>爆破默认团队字符串,搜集目标内网信息</td>
</tr>
<tr>
<td>tcp 389</td>
<td>LDAP</td>
<td>ldap注入,允许匿名访问,弱口令</td>
</tr>
<tr>
<td>tcp 512,513,514</td>
<td>Linux rexec</td>
<td>可爆破,rlogin登陆</td>
</tr>
<tr>
<td>tcp 873</td>
<td>Rsync</td>
<td>匿名访问,文件上传</td>
</tr>
<tr>
<td>tcp 1194</td>
<td>OpenVPN</td>
<td>想办法钓VPN账号,进内网</td>
</tr>
<tr>
<td>tcp 1352</td>
<td>Lotus</td>
<td>弱口令,信息泄漏,爆破</td>
</tr>
<tr>
<td>tcp 1433</td>
<td>SQL Server</td>
<td>注入,提权,sa弱口令,爆破</td>
</tr>
<tr>
<td>tcp 1521</td>
<td>Oracle</td>
<td>tns爆破,注入,弹shell…</td>
</tr>
<tr>
<td>tcp 1500</td>
<td>ISPmanager</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 1723</td>
<td>PPTP</td>
<td>爆破,想办法钓VPN账号,进内网</td>
</tr>
<tr>
<td>tcp 2082,2083</td>
<td>cPanel</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 2181</td>
<td>ZooKeeper</td>
<td>未授权访问</td>
</tr>
<tr>
<td>tcp 2601,2604</td>
<td>Zebra</td>
<td>默认密码zerbra</td>
</tr>
<tr>
<td>tcp 3128</td>
<td>Squid</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 3312,3311</td>
<td>kangle</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 3306</td>
<td>MySQL</td>
<td>注入,提权,爆破</td>
</tr>
<tr>
<td>tcp 3389</td>
<td>Windows rdp</td>
<td>shift后门[需要03以下的系统],爆破,ms12-020</td>
</tr>
<tr>
<td>tcp 3690</td>
<td>SVN</td>
<td>svn泄露,未授权访问</td>
</tr>
<tr>
<td>tcp 4848</td>
<td>GlassFish</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 5000</td>
<td>Sybase/DB2</td>
<td>爆破,注入</td>
</tr>
<tr>
<td>tcp 5432</td>
<td>PostgreSQL</td>
<td>爆破,注入,弱口令</td>
</tr>
<tr>
<td>tcp 5900,5901,5902</td>
<td>VNC</td>
<td>弱口令爆破</td>
</tr>
<tr>
<td>tcp 5984</td>
<td>CouchDB</td>
<td>未授权导致的任意指令执行</td>
</tr>
<tr>
<td>tcp 6379</td>
<td>Redis</td>
<td>可尝试未授权访问,弱口令爆破</td>
</tr>
<tr>
<td>tcp 7001,7002</td>
<td>WebLogic</td>
<td>Java反序列化,弱口令</td>
</tr>
<tr>
<td>tcp 7778</td>
<td>Kloxo</td>
<td>主机面板登录</td>
</tr>
<tr>
<td>tcp 8000</td>
<td>Ajenti</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 8443</td>
<td>Plesk</td>
<td>弱口令</td>
</tr>
<tr>
<td>tcp 8069</td>
<td>Zabbix</td>
<td>远程执行,SQL注入</td>
</tr>
<tr>
<td>tcp 8080-8089</td>
<td>Jenkins,JBoss</td>
<td>反序列化,控制台弱口令</td>
</tr>
<tr>
<td>tcp 9080-9081,9090</td>
<td>WebSphere</td>
<td>Java反序列化/弱口令</td>
</tr>
<tr>
<td>tcp 9200,9300</td>
<td>ElasticSearch</td>
<td>远程执行</td>
</tr>
<tr>
<td>tcp 11211</td>
<td>Memcached</td>
<td>未授权访问</td>
</tr>
<tr>
<td>tcp 27017,27018</td>
<td>MongoDB</td>
<td>爆破,未授权访问</td>
</tr>
<tr>
<td>tcp 50070,50030</td>
<td>Hadoop</td>
<td>默认端口未授权访问</td>
</tr>
</tbody>
</table>
<hr>
<table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>端口说明</strong></th>
<th><strong>渗透思路</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>21/69</td>
<td>FTP/TFTP：文件传输协议</td>
<td>爆破、内网嗅探</td>
</tr>
<tr>
<td>22</td>
<td>SSH：远程连接</td>
<td>用户名枚举、爆破</td>
</tr>
<tr>
<td>23</td>
<td>Telnet：远程连接</td>
<td>爆破、内网嗅探</td>
</tr>
<tr>
<td>25</td>
<td>SMTP：邮件服务</td>
<td>邮件伪造</td>
</tr>
<tr>
<td>53</td>
<td>DNS：域名系统</td>
<td>DNS域传送\DNS缓存投毒\DNS欺骗\利用DNS隧道技术刺透防火墙</td>
</tr>
<tr>
<td>389</td>
<td>LDAP</td>
<td>未授权访问（通过LdapBrowser工具直接连入）</td>
</tr>
<tr>
<td>443</td>
<td>https服务</td>
<td>OpenSSL 心脏滴血（nmap -sV --script=ssl-heartbleed 目标）</td>
</tr>
<tr>
<td>445</td>
<td>SMB服务</td>
<td>ms17_010远程代码执行</td>
</tr>
<tr>
<td>873</td>
<td>rsync服务</td>
<td>未授权访问</td>
</tr>
<tr>
<td>1090/1099</td>
<td>Java-rmi</td>
<td>JAVA反序列化远程命令执行漏洞</td>
</tr>
<tr>
<td>1352</td>
<td>Lotus Domino邮件服务</td>
<td>爆破：弱口令、信息泄漏：源代码</td>
</tr>
<tr>
<td>1433</td>
<td>MSSQL</td>
<td>注入、SA弱口令爆破、提权</td>
</tr>
<tr>
<td>1521</td>
<td>Oracle</td>
<td>注入、TNS爆破</td>
</tr>
<tr>
<td>2049</td>
<td>NFS</td>
<td>配置不当</td>
</tr>
<tr>
<td>2181</td>
<td>ZooKeeper服务</td>
<td>未授权访问</td>
</tr>
<tr>
<td>3306</td>
<td>MySQL</td>
<td>注入、爆破、写shell、提权</td>
</tr>
<tr>
<td>3389</td>
<td>RDP</td>
<td>爆破、Shift后门、CVE-2019-0708远程代码执行</td>
</tr>
<tr>
<td>4848</td>
<td>GlassFish控制台</td>
<td>爆破：控制台弱口令、认证绕过</td>
</tr>
<tr>
<td>5000</td>
<td>Sybase/DB2数据库</td>
<td>爆破、注入</td>
</tr>
<tr>
<td>5432</td>
<td>PostgreSQL</td>
<td>爆破弱口令、高权限执行系统命令</td>
</tr>
<tr>
<td>5632</td>
<td>PcAnywhere服务</td>
<td>爆破弱口令</td>
</tr>
<tr>
<td>5900</td>
<td>VNC</td>
<td>爆破：弱口令、认证绕过</td>
</tr>
<tr>
<td>6379</td>
<td>Redis</td>
<td>未授权访问、爆破弱口令</td>
</tr>
<tr>
<td>7001</td>
<td>WebLogic中间件</td>
<td>反序列化、控制台弱口令+部署war包、SSRF</td>
</tr>
<tr>
<td>8000</td>
<td>jdwp</td>
<td>JDWP 远程命令执行漏洞（<a target="_blank" rel="noopener" href="https://github.com/IOActive/jdwp-shellifier">工具</a>）</td>
</tr>
<tr>
<td>8080/8089</td>
<td>Tomcat/JBoss/Resin/Jetty/Jenkins</td>
<td>反序列化、控制台弱口令、未授权</td>
</tr>
<tr>
<td>8161</td>
<td>ActiveMQ</td>
<td>admin/admin、任意文件写入、反序列化</td>
</tr>
<tr>
<td>8069</td>
<td>Zabbix</td>
<td>远程命令执行</td>
</tr>
<tr>
<td>9043</td>
<td>WebSphere控制台</td>
<td>控制台弱口令<a target="_blank" rel="noopener" href="https://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/01.%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/01.%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/1.%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86/03.ip%E6%AE%B5%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/07.%E7%AB%AF%E5%8F%A3%E5%AF%B9%E5%BA%94%E6%B8%97%E9%80%8F%EF%BC%88%E7%AB%AF%E5%8F%A3%E6%B8%97%E9%80%8F%E5%A4%87%E5%BF%98%E5%BD%95%EF%BC%89.html">https://:9043/ibm/console/logon.jsp、远程代码执行</a></td>
</tr>
<tr>
<td>9200/9300</td>
<td>Elasticsearch服务</td>
<td>远程代码执行</td>
</tr>
<tr>
<td>11211</td>
<td>Memcache</td>
<td>未授权访问（nc -vv 目标 11211）</td>
</tr>
<tr>
<td>27017</td>
<td>MongoDB</td>
<td>未授权访问、爆破弱口令</td>
</tr>
<tr>
<td>50000</td>
<td>SAP</td>
<td>远程代码执行</td>
</tr>
<tr>
<td>50070</td>
<td>hadoop</td>
<td>未授权访问</td>
</tr>
</tbody>
</table>
<hr>
<table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>服务</strong></th>
<th><strong>渗透思路</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>21</td>
<td>FTP/TFTP/VSFTPD</td>
<td>爆破/嗅探/溢出/后门</td>
</tr>
<tr>
<td>22</td>
<td>ssh远程连接</td>
<td>爆破/openssh漏洞</td>
</tr>
<tr>
<td>23</td>
<td>Telnet远程连接</td>
<td>爆破/嗅探/弱口令</td>
</tr>
<tr>
<td>25</td>
<td>SMTP邮件服务</td>
<td>邮件伪造</td>
</tr>
<tr>
<td>53</td>
<td>DNS域名解析系统</td>
<td>域传送/劫持/缓存投毒/欺骗</td>
</tr>
<tr>
<td>67/68</td>
<td>dhcp服务</td>
<td>劫持/欺骗</td>
</tr>
<tr>
<td>110</td>
<td>pop3</td>
<td>爆破/嗅探</td>
</tr>
<tr>
<td>139</td>
<td>Samba服务</td>
<td>爆破/未授权访问/远程命令执行</td>
</tr>
<tr>
<td>143</td>
<td>Imap协议</td>
<td>爆破161SNMP协议爆破/搜集目标内网信息</td>
</tr>
<tr>
<td>389</td>
<td>Ldap目录访问协议</td>
<td>注入/未授权访问/弱口令</td>
</tr>
<tr>
<td>445</td>
<td>smb</td>
<td>ms17-010/端口溢出</td>
</tr>
<tr>
<td>512/513/514</td>
<td>Linux Rexec服务</td>
<td>爆破/Rlogin登陆</td>
</tr>
<tr>
<td>873</td>
<td>Rsync服务</td>
<td>文件上传/未授权访问</td>
</tr>
<tr>
<td>1080</td>
<td>socket</td>
<td>爆破</td>
</tr>
<tr>
<td>1352</td>
<td>Lotus domino邮件服务</td>
<td>爆破/信息泄漏</td>
</tr>
<tr>
<td>1433</td>
<td>mssql</td>
<td>爆破/注入/SA弱口令</td>
</tr>
<tr>
<td>1521</td>
<td>oracle</td>
<td>爆破/注入/TNS爆破/反弹shell2049Nfs服务配置不当</td>
</tr>
<tr>
<td>2181</td>
<td>zookeeper服务</td>
<td>未授权访问</td>
</tr>
<tr>
<td>2375</td>
<td>docker remote api</td>
<td>未授权访问</td>
</tr>
<tr>
<td>3306</td>
<td>mysql</td>
<td>爆破/注入</td>
</tr>
<tr>
<td>3389</td>
<td>Rdp远程桌面链接</td>
<td>爆破/shift后门</td>
</tr>
<tr>
<td>4848</td>
<td>GlassFish控制台</td>
<td>爆破/认证绕过</td>
</tr>
<tr>
<td>5000</td>
<td>sybase/DB2数据库</td>
<td>爆破/注入/提权</td>
</tr>
<tr>
<td>5432</td>
<td>postgresql</td>
<td>爆破/注入/缓冲区溢出</td>
</tr>
<tr>
<td>5632</td>
<td>pcanywhere服务</td>
<td>抓密码/代码执行</td>
</tr>
<tr>
<td>5900</td>
<td>vnc</td>
<td>爆破/认证绕过</td>
</tr>
<tr>
<td>6379</td>
<td>Redis数据库</td>
<td>未授权访问/爆破</td>
</tr>
<tr>
<td>7001/7002</td>
<td>weblogic</td>
<td>java反序列化/控制台弱口令</td>
</tr>
<tr>
<td>80/443</td>
<td>http/https</td>
<td>web应用漏洞/心脏滴血</td>
</tr>
<tr>
<td>8069</td>
<td>zabbix服务</td>
<td>远程命令执行/注入</td>
</tr>
<tr>
<td>8161</td>
<td>activemq</td>
<td>弱口令/写文件</td>
</tr>
<tr>
<td>8080/8089</td>
<td>Jboss/Tomcat/Resin</td>
<td>爆破/PUT文件上传/反序列化</td>
</tr>
<tr>
<td>8083/8086</td>
<td>influxDB</td>
<td>未授权访问</td>
</tr>
<tr>
<td>9000</td>
<td>fastcgi</td>
<td>远程命令执行</td>
</tr>
<tr>
<td>9090</td>
<td>Websphere</td>
<td>控制台爆破/java反序列化/弱口令</td>
</tr>
<tr>
<td>9200/9300</td>
<td>elasticsearch</td>
<td>远程代码执行</td>
</tr>
<tr>
<td>11211</td>
<td>memcached</td>
<td>未授权访问</td>
</tr>
<tr>
<td>27017/27018</td>
<td>mongodb</td>
<td>未授权访问/爆破</td>
</tr>
</tbody>
</table>
<hr>
<table>
<thead>
<tr>
<th><strong>端口号</strong></th>
<th><strong>服务</strong></th>
<th><strong>渗透思路</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>20</td>
<td>ftp_data</td>
<td>爆破、嗅探、溢出、后门</td>
</tr>
<tr>
<td>21</td>
<td>ftp_control</td>
<td>爆破、嗅探、溢出、后门</td>
</tr>
<tr>
<td>23</td>
<td>telnet</td>
<td>爆破、嗅探</td>
</tr>
<tr>
<td>25</td>
<td>smtp</td>
<td>邮件伪造</td>
</tr>
<tr>
<td>53</td>
<td>DNS</td>
<td>DNS区域传输、DNS劫持、DNS缓存投毒、DNS欺骗、深度利用：利用DNS隧道技术刺透防火墙</td>
</tr>
<tr>
<td>67</td>
<td>dhcp</td>
<td>劫持、欺骗</td>
</tr>
<tr>
<td>68</td>
<td>dhcp</td>
<td>劫持、欺骗</td>
</tr>
<tr>
<td>110</td>
<td>pop3</td>
<td>爆破</td>
</tr>
<tr>
<td>139</td>
<td>samba</td>
<td>爆破、未授权访问、远程代码执行</td>
</tr>
<tr>
<td>143</td>
<td>imap</td>
<td>爆破</td>
</tr>
<tr>
<td>161</td>
<td>snmp</td>
<td>爆破</td>
</tr>
<tr>
<td>389</td>
<td>ldap</td>
<td>注入攻击、未授权访问</td>
</tr>
<tr>
<td>512</td>
<td>linux r</td>
<td>直接使用rlogin</td>
</tr>
<tr>
<td>513</td>
<td>linux r</td>
<td>直接使用rlogin</td>
</tr>
<tr>
<td>514</td>
<td>linux r</td>
<td>直接使用rlogin</td>
</tr>
<tr>
<td>873</td>
<td>rsync</td>
<td>未授权访问</td>
</tr>
<tr>
<td>888</td>
<td>BTLINUX</td>
<td>宝塔Linux主机管理后台/默认帐户：admin｜默认密码：admin</td>
</tr>
<tr>
<td>999</td>
<td>PMA</td>
<td>护卫神佩带的phpmyadmin管理后台，默认帐户：root｜默认密码：<a target="_blank" rel="noopener" href="http://huweishen.com">huweishen.com</a></td>
</tr>
<tr>
<td>1080</td>
<td>socket</td>
<td>爆破：进行内网渗透</td>
</tr>
<tr>
<td>1352</td>
<td>lotus</td>
<td>爆破：弱口令、信息泄露：源代码</td>
</tr>
<tr>
<td>1433</td>
<td>mssql</td>
<td>爆破：使用系统用户登录、注入攻击</td>
</tr>
<tr>
<td>1521</td>
<td>oracle</td>
<td>爆破：TNS、注入攻击</td>
</tr>
<tr>
<td>2049</td>
<td>nfs</td>
<td>配置不当</td>
</tr>
<tr>
<td>2181</td>
<td>zookeeper</td>
<td>未授权访问</td>
</tr>
<tr>
<td>3306</td>
<td>mysql</td>
<td>爆破、拒绝服务、注入</td>
</tr>
<tr>
<td>3389</td>
<td>rdp</td>
<td>爆破、Shift后门</td>
</tr>
<tr>
<td>4848</td>
<td>glassfish</td>
<td>爆破：控制台弱口令、认证绕过</td>
</tr>
<tr>
<td>5000</td>
<td>sybase/DB2</td>
<td>爆破、注入</td>
</tr>
<tr>
<td>5432</td>
<td>postgresql</td>
<td>缓冲区溢出、注入攻击、爆破：弱口令</td>
</tr>
<tr>
<td>5632</td>
<td>pcanywhere</td>
<td>拒绝服务、代码执行</td>
</tr>
<tr>
<td>5900</td>
<td>vnc</td>
<td>爆破：弱口令、认证绕过</td>
</tr>
<tr>
<td>5901</td>
<td>vnc</td>
<td>爆破：弱口令、认证绕过</td>
</tr>
<tr>
<td>5902</td>
<td>vnc</td>
<td>爆破：弱口令、认证绕过</td>
</tr>
<tr>
<td>6379</td>
<td>redis</td>
<td>未授权访问、爆破：弱口令</td>
</tr>
<tr>
<td>7001</td>
<td>weblogic</td>
<td>JAVA反序列化、控制台弱口令、控制台部署webshell</td>
</tr>
<tr>
<td>7002</td>
<td>weblogic</td>
<td>JAVA反序列化、控制台弱口令、控制台部署webshell</td>
</tr>
<tr>
<td>80</td>
<td>web</td>
<td>常见Web攻击、控制台爆破、对应服务器版本漏洞</td>
</tr>
<tr>
<td>443</td>
<td>web</td>
<td>常见Web攻击、控制台爆破、对应服务器版本漏洞</td>
</tr>
<tr>
<td>8080</td>
<td>web｜Tomcat｜…</td>
<td>常见Web攻击、控制台爆破、对应服务器版本漏洞、Tomcat漏洞</td>
</tr>
<tr>
<td>8069</td>
<td>zabbix</td>
<td>远程命令执行</td>
</tr>
<tr>
<td>9090</td>
<td>websphere</td>
<td>文件泄露、爆破：控制台弱口令、Java反序列</td>
</tr>
<tr>
<td>9200</td>
<td>elasticsearch</td>
<td>未授权访问、远程代码执行</td>
</tr>
<tr>
<td>9300</td>
<td>elasticsearch</td>
<td>未授权访问、远程代码执行</td>
</tr>
<tr>
<td>11211</td>
<td>memcacache</td>
<td>未授权访问</td>
</tr>
<tr>
<td>27017</td>
<td>mongodb</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>27018</td>
<td>mongodb</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>50070</td>
<td>Hadoop</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>50075</td>
<td>Hadoop</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>14000</td>
<td>Hadoop</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>8480</td>
<td>Hadoop</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>8088</td>
<td>web</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>50030</td>
<td>Hadoop</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>50060</td>
<td>Hadoop</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>60010</td>
<td>Hadoop</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>60030</td>
<td>Hadoop</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>10000</td>
<td>Virtualmin/Webmin</td>
<td>服务器虚拟主机管理系统</td>
</tr>
<tr>
<td>10003</td>
<td>Hadoop</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>5984</td>
<td>couchdb</td>
<td>未授权访问</td>
</tr>
<tr>
<td>445</td>
<td>SMB</td>
<td>弱口令爆破，检测是否有ms_08067等溢出</td>
</tr>
<tr>
<td>1025</td>
<td>111</td>
<td>NFS</td>
</tr>
<tr>
<td>2082</td>
<td></td>
<td>cpanel主机管理系统登陆 （国外用较多）</td>
</tr>
<tr>
<td>2083</td>
<td></td>
<td>cpanel主机管理系统登陆 （国外用较多）</td>
</tr>
<tr>
<td>2222</td>
<td></td>
<td>DA虚拟主机管理系统登陆 （国外用较多）</td>
</tr>
<tr>
<td>2601</td>
<td></td>
<td>zebra路由</td>
</tr>
<tr>
<td>2604</td>
<td></td>
<td>zebra路由</td>
</tr>
<tr>
<td>3128</td>
<td></td>
<td>代理默认端口,如果没设置口令很可能就直接漫游内网了</td>
</tr>
<tr>
<td>3311</td>
<td></td>
<td>kangle主机管理系统登陆</td>
</tr>
<tr>
<td>3312</td>
<td></td>
<td>kangle主机管理系统登陆</td>
</tr>
<tr>
<td>4440</td>
<td></td>
<td>参考WooYun: 借用新浪某服务成功漫游新浪内网</td>
</tr>
<tr>
<td>6082</td>
<td></td>
<td>参考WooYun: Varnish HTTP accelerator CLI 未授权访问易导致网站被直接篡改或者作为代理进入内网</td>
</tr>
<tr>
<td>7778</td>
<td></td>
<td>主机控制面板登录</td>
</tr>
<tr>
<td>8083</td>
<td></td>
<td>主机管理系统 （国外用较多）</td>
</tr>
<tr>
<td>8649</td>
<td></td>
<td></td>
</tr>
<tr>
<td>8888</td>
<td></td>
<td>主机管理系统默认端口</td>
</tr>
<tr>
<td>9000</td>
<td></td>
<td>fcgi php执行</td>
</tr>
<tr>
<td>50000</td>
<td>SAP</td>
<td>命令执行</td>
</tr>
</tbody>
</table>
<h2 id="网络架构探测">网络架构探测</h2>
<p>当我们探测目标站点网站架构时，比如说：操作系统，中间件，脚本语言，数据库，服务器，web容器等等，可以使用以下方法查询。</p>
<h3 id="CMS识别">CMS识别</h3>
<p>识别 CMS 的目的在于，方便利用已公开漏洞进行渗透测试，甚至可以到对应 CMS 的官网下载对应版本的 CMS 进行本地白盒代码审计。</p>
<blockquote>
<p>（1）wappalyzer插件——火狐插件</p>
<p>（2）云悉：<a target="_blank" rel="noopener" href="http://www.yunsee.cn/">http://www.yunsee.cn/</a>   —不过这个邀请码有点。。。。</p>
<p>（3）CMS指纹识别：<a target="_blank" rel="noopener" href="http://whatweb.bugscaner.com/look/">http://whatweb.bugscaner.com/look/</a> ——但这个似乎不能用了</p>
</blockquote>
<p>CMS指纹识别又有很多方法，比如说御剑指纹识别、Webrobot工具、whatweb工具、还有在线查询的网站等等。</p>
<h3 id="服务器信息搜集">服务器信息搜集</h3>
<p>服务版本识别、操作系统信息识别都可以利用 nmap 实现识别</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmap <span class="token parameter variable">-sV</span> <span class="token parameter variable">-p</span> <span class="token number">1</span>-65535 x.x.x.xnmap <span class="token parameter variable">-O</span> x.x.x.x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="特定关键字识别">特定关键字识别</h3>
<p>CMS 的首页文件、特定文件可能包含了 CMS 类型及版本信息，通过访问这些文件，将返回的网页信息（如 Powered by XXCMS）与扫描工具数据库存储的指纹信息进行正则匹配，判断 CMS 的类型。</p>
<p>也可能前端源码中或 meta 标签中的 content 字段存在一些 CMS 特征信息，下图很明显能得知是 WordPress 框架</p>
<p><img src="image-20240106180713688.png" alt="image-20240106180713688"></p>
<h3 id="特定文件及路径识别">特定文件及路径识别</h3>
<p>不同的 CMS 会有不同的网站结构及文件名称，可以通过特定文件及路径识别 CMS。如 WordPress 会有特定的文件路径 /wp-admin、/wp-includes 等，有些 CMS 的 robots.txt 文件也可能包含了 CMS 特定的文件路径，与扫描工具数据库存储的指纹信息进行正则匹配，判断 CMS 的类型。</p>
<p>CMS 会有一些 JS、CSS、图片等<strong>静态文件</strong>，这些文件一般不会变化，可以利用这些特定文件的 MD5 值作为指纹信息来判断 CMS 的类型。</p>
<h3 id="响应头信息识别">响应头信息识别</h3>
<p>应用程序会在响应头 Server、X-Powered-By、Set-Cookie 等字段中返回 Banner 信息或者自定义的数据字段，通过响应头返回的信息，可以对应用进行识别，有些 WAF 设备也可以通过响应头信息进行识别判断。当然 Banner 信息并不一定是完全准确的，应用程序可以自定义自己的 Banner 信息。</p>
<p>例如 Shiro 的响应头信息中包含 rememberMe 字段：</p>
<p><img src="image-20240106180837983.png" alt="image-20240106180837983"></p>
<h3 id="常见脚本工具">常见脚本工具</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/s7ckTeam/Glass">https://github.com/s7ckTeam/Glass</a></p>
<p>Glass是一款针对资产列表的快速指纹识别工具，通过调用Fofa/ZoomEye/Shodan/360等api接口快速查询资产信息并识别重点资产的指纹，也可针对IP/IP段或资产列表进行快速的指纹识别。</p>
<p>Glass旨在帮助红队人员在资产信息收集期间能够快速从C段、大量杂乱的资产中精准识别到易被攻击的系统，从而实施进一步测试攻击。</p>
<p>还有两款只支持如 WordPress, Joomla, Drupal 的工具</p>
<p>CMSScan：<a target="_blank" rel="noopener" href="https://github.com/ajinabraham/CMSScan">https://github.com/ajinabraham/CMSScan</a></p>
<p>CMSmap：<a target="_blank" rel="noopener" href="https://github.com/Dionach/CMSmap">https://github.com/Dionach/CMSmap</a></p>
<p>还有一些其他优秀Github项目</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Tuhinshubhra/CMSeeK">CMSeeK</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Dionach/CMSmap">CMSmap</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/aedoo/ACMSDiscovery">ACMSDiscovery</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/TideSec/TideFinger">TideFinger</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Lucifer1993/AngelSword">AngelSword</a></li>
</ul>
<h3 id="数字观星平台">数字观星平台</h3>
<p><a target="_blank" rel="noopener" href="https://fp.shuziguanxing.com/#/">https://fp.shuziguanxing.com/#/</a></p>
<p><img src="image-20240106190841702.png" alt="image-20240106190841702"></p>
<h3 id="WAF识别">WAF识别</h3>
<p>Waf也叫Web应用防火墙，是通过执行一系列针对HTTP/HTTPS的安全策略来专门为Web应用提供保护的一款产品。Waf的探测很多人都会忽略掉</p>
<p>主要有两种手法吧，一种是手动，一种是工具；知道了是否有WAF，用的什么WAF，我们才好对症下药</p>
<p>手动的话：一般来说WAF都会拦截敏感文件下载，如<code>a.sql</code>、<code>a.mdb</code>等，直接添加到网站URL中即可</p>
<p>一些WAF可能不防护这些，那么就可以拿一些XSS、SQLI的payload来测试也可（贴个图）</p>
<p><img src="image-20240106191110508.png" alt="image-20240106191110508"></p>
<p>还有就是靠工具识别：wafw00f：<a target="_blank" rel="noopener" href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a></p>
<p><img src="image-20240106191404217.png" alt="image-20240106191404217"></p>
<p>还有Nmap神器：探测WAF有两种脚本。</p>
<p>一种是http-waf-detect。</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap  -p80<span class="token punctuation">,</span>443  --script=http-waf-detect  ip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>一种是http-waf-fingerprint。</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap  -p80<span class="token punctuation">,</span>443  --script=http-waf-fingerprint  ip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240106191658297.png" alt="image-20240106191658297"></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/8F060FU9g_78z57UKS-JsQ">30几款常见WAF的拦截页整理</a></p>
<h2 id="其他应用收集">其他应用收集</h2>
<h3 id="小程序">小程序</h3>
<p>企查查等：找到小程序点击即可</p>
<p><img src="image-20240106212813758.png" alt="image-20240106212813758"></p>
<p>微信APP</p>
<p><img src="image-20240106212905850.png" alt="image-20240106212905850"></p>
<p>支付宝APP</p>
<p>和微信类似，但是不同平台因为不同的规则，可能有一点点差异  ——这里贴个别的师傅的图</p>
<p><img src="image-20240106212944804.png" alt="image-20240106212944804"></p>
<h3 id="公众号">公众号</h3>
<ul>
<li>企查查：<a target="_blank" rel="noopener" href="https://www.qcc.com/">https://www.qcc.com/</a></li>
<li>天眼查：<a target="_blank" rel="noopener" href="https://www.tianyancha.com/">https://www.tianyancha.com/</a></li>
</ul>
<p>直接搜索相应公司，在菜单栏中找到微信公众号 ——和上面查小程序一般</p>
<p><img src="image-20240106213034093.png" alt="image-20240106213034093"></p>
<p>依旧还可以用微信搜索，这里那位师傅说还可以用搜狗微信：<a target="_blank" rel="noopener" href="https://weixin.sogou.com/">https://weixin.sogou.com/</a> ——但我搜不出来。。</p>
<p>先贴个图</p>
<p><img src="image-20240106213241089.png" alt="image-20240106213241089"></p>
<h3 id="生活号">生活号</h3>
<p>感觉有点类似微信上的公众号，也是通过支付宝APP搜索即可</p>
<h3 id="APP搜集">APP搜集</h3>
<p>收集到APP，可以测正常功能，也可以对它进行反编译查看源码，可能获取一些敏感的接口等信息。</p>
<p>tips：不仅要收集最新版，还要收集历史版本的APP，可能存在敏感信息，也有可能存在有漏洞的历史接口。</p>
<p>七麦数据</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.qimai.cn/">https://www.qimai.cn/</a></p>
</blockquote>
<p>直接搜索可以获取到部分相关的APP</p>
<p><img src="image-20240106213524959.png" alt="image-20240106213524959"></p>
<p>但是有些较隐藏的APP直接搜名字还是搜不出来，这个时候我们就会用到七麦一个很方便的功能：<strong>同开发者APP</strong></p>
<p><img src="image-20240106213708598.png" alt="image-20240106213708598"></p>
<p>此外，还可以获取APP的历史版本，可能里面存在大量的敏感信息!!!</p>
<p>豌豆荚</p>
<p>使用豌豆荚可以方便的获取到APP的历史版本，这里就直接贴图了</p>
<p><img src="image-20240106213752937.png" alt="image-20240106213752937"></p>
<p><img src="image-20240106213759030.png" alt="image-20240106213759030"></p>
<p>企查查&amp;天眼查——依旧类似上面的小程序</p>
<p><img src="image-20240106213830237.png" alt="image-20240106213830237"></p>
<p>App Store</p>
<p>搜索到应用往下滑，其实也是和七麦数据找同开发者APP一样的 ——贴图</p>
<p><img src="image-20240106213846866.png" alt="image-20240106213846866"></p>
<h3 id="PC应用">PC应用</h3>
<p>看看客户端的产品，可能有时候也会发现一些突破口</p>
<p>一般比较明显的官网就可以下载，可能还有一些隐藏的PC应用，或者测试版，就需要自己去寻找了</p>
<h2 id="敏感文件、敏感目录探测">敏感文件、敏感目录探测</h2>
<p>通常我们所说的敏感文件、敏感目录大概有以下几种：</p>
<blockquote>
<p>（1）Git</p>
<p>（2）hg/Mercurial</p>
<p>（3）svn/Subversion</p>
<p>（4）bzr/Bazaar</p>
<p>（5）Cvs</p>
<p>（6）WEB-INF泄露</p>
<p>（7）备份文件泄露、配置文件泄露</p>
</blockquote>
<p>敏感文件、敏感目录挖掘一般都是靠工具、脚本来找，当然大佬手工也能找得到。</p>
<h3 id="脚本工具">脚本工具</h3>
<blockquote>
<p>（1）御剑（真的很万能，文末附上全家桶）</p>
<p>（2）爬虫（AWVS、Burpsuite等）</p>
<p>（3）搜索引擎（Google、Github等）</p>
<p>（4）wwwscan</p>
<p>（5）BBscan（一位巨佬写的python脚本：<a target="_blank" rel="noopener" href="https://github.com/lijiejie/BBScan">https://github.com/lijiejie/BBScan</a></p>
<p>（6）GSIL（也是一位巨佬写的python脚本：<a target="_blank" rel="noopener" href="https://github.com/FeeiCN/GSIL">https://github.com/FeeiCN/GSIL</a> ——不过这个工具似乎存在问题，我配置不成功</p>
<p>（7）社交平台</p>
</blockquote>
<h3 id="Google-hacking">Google hacking</h3>
<blockquote>
<ul>
<li>目录遍历: site:$site intitle:index.of</li>
<li>配置文件泄露: site:$site ext:xml | ext:conf | ext:cnf | ext:reg | ext:inf | ext:rdp | ext:cfg | ext:txt | ext:ora | ext:ini</li>
<li>数据库文件泄露: site:$site ext:sql | ext:dbf | ext:mdb</li>
<li>日志文件泄露: site:$site ext:log</li>
<li>备份和历史文件: site:$site ext:bkf | ext:bkp | ext:bak | ext:old | ext:backup</li>
<li>登录页面: site:$site inurl:login</li>
<li>SQL错误: site:$site intext:“sql syntax near” | intext:“syntax error has occurred” | intext:“incorrect syntax near” | intext:“unexpected end of SQL command” | intext:“Warning: mysql_connect()” | intext:“Warning: mysql_query()” | intext:“Warning: pg_connect()”</li>
<li>公开文件信息: site:$site ext:doc | ext:docx | ext:odt | ext:pdf | ext:rtf | ext:sxw | ext:psw | ext:ppt | ext:pptx | ext:pps | ext:csv</li>
<li>phpinfo(): site:$site ext:php intitle:phpinfo “published by the PHP Group”</li>
<li>搜索粘贴站点: site:pastebin.com | site:paste2.org | site:pastehtml.com | site:slexy.org | site:snipplr.com | site:snipt.net | site:textsnip.com | site:bitpaste.app | site:justpaste.it | site:heypasteit.com | site:hastebin.com | site:dpaste.org | site:dpaste.com | site:codepad.org | site:jsitor.com | site:codepen.io | site:jsfiddle.net | site:dotnetfiddle.net | site:phpfiddle.org | site:ide.geeksforgeeks.org | site:repl.it | site:ideone.com | site:paste.debian.net | site:paste.org | site:paste.org.ru | site:codebeautify.org | site:codeshare.io | site:trello.com $site</li>
<li>搜索Github、Gitlab: site:github.com | site:gitlab.com $site.</li>
<li>在线Google Hacking利用：<a target="_blank" rel="noopener" href="https://tools.zjun.info/googlehacking/">https://tools.zjun.info/googlehacking/</a></li>
</ul>
</blockquote>
<h3 id="针对信息泄露的搜索引擎">针对信息泄露的搜索引擎</h3>
<p><a target="_blank" rel="noopener" href="https://leakix.net/">https://leakix.net/</a></p>
<p><img src="image-20240106183000842.png" alt="image-20240106183000842"></p>
<h3 id="Google-hacking-database">Google hacking database</h3>
<p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/google-hacking-database">https://www.exploit-db.com/google-hacking-database</a></p>
<p><img src="image-20240106183134068.png" alt="image-20240106183134068"></p>
<h3 id="ffuf">ffuf</h3>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/ffuf/ffuf">https://github.com/ffuf/ffuf</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffuf <span class="token parameter variable">-w</span> /path/to/wordlist <span class="token parameter variable">-u</span> https://target/FUZZ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>字典需要自己添加，在需要fuzz的地方添加“FUZZ”</p>
<h3 id="dirmap">dirmap</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/H4ckForJob/dirmap">https://github.com/H4ckForJob/dirmap</a></li>
</ul>
<p>支持递归扫描、功能将会强于DirBuster、Dirsearch、cansina、御剑</p>
<p><img src="image-20240106192543201.png" alt="image-20240106192543201"></p>
<h3 id="github语法">github语法</h3>
<p>一些语法</p>
<p>参考自：<a target="_blank" rel="noopener" href="https://github.com/obheda12/GitDorker/tree/master/Dorks">https://github.com/obheda12/GitDorker/tree/master/Dorks</a></p>
<p>所有语法txt版</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/obheda12/GitDorker/blob/master/Dorks/alldorksv3">alldorksv3</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/obheda12/GitDorker/blob/master/Dorks/medium_dorks.txt">medium_dorks</a></li>
</ul>
<p>自动化工具：<a target="_blank" rel="noopener" href="https://github.com/damit5/gitdorks_go">https://github.com/damit5/gitdorks_go</a></p>
<h3 id="历史页面">历史页面</h3>
<p>在线网站：<a target="_blank" rel="noopener" href="https://web.archive.org/">https://web.archive.org/</a></p>
<p>wayback会记录网站版本更迭，可以获取到之前版本的网站，可能会找到一些后来删除的敏感资产信息，或者一些漏洞</p>
<p><a target="_blank" rel="noopener" href="http://xn--2010qq-hp7im43i0sozq2bht5e.com">下面是2010年的qq.com</a>！！</p>
<p><img src="image-20240106193040958.png" alt="image-20240106193040958"></p>
<p>在推荐两款强力工具：</p>
<blockquote>
<p>gau：<a target="_blank" rel="noopener" href="https://github.com/lc/gau">https://github.com/lc/gau</a></p>
<p>waybackurls：<a target="_blank" rel="noopener" href="https://github.com/tomnomnom/waybackurls">https://github.com/tomnomnom/waybackurls</a></p>
</blockquote>
<h3 id="网盘信息搜集">网盘信息搜集</h3>
<p>某些安全意识薄弱的人员可能上传资料到一些网盘中，没有加密码或者密码泄露，然后被一些在线云盘抓取收录了，导致信息泄露。</p>
<p>超能搜：<a target="_blank" rel="noopener" href="https://www.chaonengsou.com/">https://www.chaonengsou.com/</a></p>
<p><img src="image-20240106193809722.png" alt="image-20240106193809722"></p>
<p>百度网盘爬虫：<a target="_blank" rel="noopener" href="https://github.com/k1995/BaiduyunSpider">https://github.com/k1995/BaiduyunSpider</a></p>
<h3 id="邮箱信息搜集">邮箱信息搜集</h3>
<p>目前情况来看，通过web打点不一定是最优的方式，可以社工等方式同步进行；因此尽可能多的收集目标的邮箱，然后进行社工钓鱼可能大有突破</p>
<blockquote>
<p>实际过程中，我们可以尽可能的把收集到疑似网络管理员、运维人员、安全部门的人员提取出来，这些人单独写邮件或者不发，因为这些人安全意识相对较高，容易打草惊蛇，我们需要对一些非技术员工安全意识薄弱的人下手，挑软柿子捏。</p>
</blockquote>
<h4 id="寻找目标邮箱入口">寻找目标邮箱入口</h4>
<p>目标为开放的邮服端口或web邮箱入口</p>
<p>拿到目标后，先要先从MX记录域名找到他的真实ip地址（某些目标可能是第三方邮件服务器，这种情况mx记录就没有参考价值了）</p>
<p><img src="image-20240106194355586.png" alt="image-20240106194355586"></p>
<p><img src="image-20240106194516642.png" alt="image-20240106194516642"></p>
<p>然后针对这个ip地址的C段进行扫描（25、109、110、143、465、995、993端口）</p>
<h4 id="通过子域名">通过子域名</h4>
<p>主要是利用一些子域名收集工具，如：Subdomainbrute、ksubdomain、Oneforall、Sublist3r、TeeMO、LangSrcCurise、Layer挖掘机等</p>
<h4 id="通过搜索引擎">通过搜索引擎</h4>
<p>1、Google Hacking语法</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">site</span><span class="token punctuation">:</span><span class="token value attr-value">target.com intitle:"Outlook Web App"</span>
<span class="token key attr-name">site</span><span class="token punctuation">:</span><span class="token value attr-value">target.com intitle:"mail"</span>
<span class="token key attr-name">site</span><span class="token punctuation">:</span><span class="token value attr-value">target.com intitle:"邮箱"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240106194628133.png" alt="image-20240106194628133"></p>
<p>2、网络空间搜索引擎</p>
<ul>
<li>Shodan</li>
<li>fofa</li>
<li>zoomeye</li>
</ul>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">hostname</span><span class="token punctuation">:</span><span class="token value attr-value">163.com http.title:"邮箱"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="在线平台搜集">在线平台搜集</h4>
<p>邮箱查找工具：<a target="_blank" rel="noopener" href="https://app.snov.io/">https://app.snov.io/</a></p>
<p><img src="image-20240106195050831.png" alt="image-20240106195050831"></p>
<p><a target="_blank" rel="noopener" href="https://phonebook.cz/">https://phonebook.cz/</a> ——还可以收集域名与url</p>
<p><img src="image-20240106195511614.png" alt="image-20240106195511614"></p>
<p><a target="_blank" rel="noopener" href="https://hunter.io/">https://hunter.io/</a></p>
<p><img src="image-20240106195739725.png" alt="image-20240106195739725"></p>
<p><a target="_blank" rel="noopener" href="http://www.skymem.info/">http://www.skymem.info/</a></p>
<p><img src="image-20240106195806919.png" alt="image-20240106195806919"></p>
<p><a target="_blank" rel="noopener" href="https://www.email-format.com/i/search/">https://www.email-format.com/i/search/</a></p>
<p><img src="image-20240106195855854.png" alt="image-20240106195855854"></p>
<h4 id="工具搜集">工具搜集</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a> —kali自带</p>
<p><img src="image-20240106201258138.png" alt="image-20240106201258138"></p>
<p>不理解的是，总是查不出来，感觉是api的问题吧。。。</p>
<h4 id="验证邮箱">验证邮箱</h4>
<p>在经过上述的邮箱搜集之后，我们可以对邮箱进行存活性验证，检测目标邮箱是否存在被弃用的情况（离职，职位调动等）。</p>
<p><a target="_blank" rel="noopener" href="http://xn--mailtester-ym34ap2a.com">通过mailtester.com</a> ：<a target="_blank" rel="noopener" href="https://mailtester.com/">https://mailtester.com/</a></p>
<p><img src="image-20240106201711941.png" alt="image-20240106201711941"></p>
<h4 id="邮箱爆破">邮箱爆破</h4>
<p>这种方式的弱口令爆破只适用于目标企业自己的邮件服务器如owa等 像百度腾讯阿里网易等第三方邮箱不优先考虑</p>
<p>SMTP协议爆破：medusa、hydra、SNETCracker、APT34组织 owa爆破工具等…</p>
<p>网页邮箱爆破：burpsuite等…</p>
<h3 id="JS信息搜集">JS信息搜集</h3>
<p>在JS中可能会存在大量的敏感信息，包括但不限于：</p>
<ol>
<li>某些服务的接口，可以测试这些接口是否有未授权等</li>
<li>子域名，可能包含有不常见或者子域名收集过程中没收集到的目标</li>
<li>密码、secretKey等敏感数据</li>
</ol>
<h4 id="手工搜集">手工搜集</h4>
<p>可以全局搜索<code>http</code>、<code>"/</code>、这种关键词</p>
<p><img src="image-20240106201922330.png" alt="image-20240106201922330"></p>
<h4 id="利用工具">利用工具</h4>
<h4 id="JSFinder">JSFinder</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Threezh1/JSFinder">https://github.com/Threezh1/JSFinder</a></p>
</blockquote>
<p>JSFinder是一款用作快速在网站的js文件中提取URL，子域名的工具用法参考项目文档，或者<code>-h</code></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">python JSFinder.py -u <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//www.jd.com  ---简单爬取</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240106202216480.png" alt="image-20240106202216480"></p>
<h4 id="LinkFinder">LinkFinder</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/GerbenJavado/LinkFinder">https://github.com/GerbenJavado/LinkFinder</a></p>
</blockquote>
<p>这也是一款一直在用的工具，效果杠杠的，可以本地用，也可以集成到Burp插件里面</p>
<p><img src="image-20240106203308734.png" alt="image-20240106203308734"></p>
<h4 id="Hae">Hae</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/gh0stkey/HaE">https://github.com/gh0stkey/HaE</a></p>
</blockquote>
<p><strong>HaE</strong>是基于 <code>BurpSuite</code> 插件 <code>JavaAPI</code> 开发的请求高亮标记与信息提取的辅助型插件。基于正则表达式，除了提取敏感信息，也可以提取页面中的链接等</p>
<p>贴个图：</p>
<p><img src="image-20240106203624150.png" alt="image-20240106203624150"></p>
<h3 id="社会工程学">社会工程学</h3>
<p>社会工程学收集的信息有很多，包含网络 ID（现用和曾用）、真实姓名、手机号、电子邮箱、出生日期、身份证号、银行卡、支付宝账号、QQ 号、微信号、家庭地址、注册网站（贴吧、微博、人人网等）等信息。</p>
<p>在目标相关网页中可能会存在招聘信息、客服联系等，可以利用招聘或客服聊天的方式进行钓鱼、木马植入等。</p>
<p>搜集到相关的人员信息后可以制作社工字典，有如下在线或本地工具：</p>
<pre class="line-numbers language-none"><code class="language-none">bugku密码攻击器：https://www.bugku.com/mima/
白鹿社工字典生成器：https://github.com/z3r023/BaiLu-SED-Tool<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>还有一些社工机器人：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://t.me/DogeSGK_bot?start=348315174">狗狗免费社工机器人</a></li>
<li><a target="_blank" rel="noopener" href="https://t.me/DATA_007bot?start=1d7b32db6a">DATA007</a></li>
<li><a target="_blank" rel="noopener" href="https://t.me/pingansgk_bot?start=567fbc7aa9">平安社工库</a></li>
<li><a target="_blank" rel="noopener" href="https://t.me/aishegongkubot?start=AISGK_FW5KQHNC">AISGK</a>：数据相对比较全，但是需要推广一定人才能用！</li>
</ul>
<p>社工密码生成：<a target="_blank" rel="noopener" href="https://github.com/zgjx6/SocialEngineeringDictionaryGenerator">https://github.com/zgjx6/SocialEngineeringDictionaryGenerator</a></p>
<p><img src="image-20240106204906648.png" alt="image-20240106204906648"></p>
<h2 id="目标域名邮箱收集">目标域名邮箱收集</h2>
<p>一定要养成收集站点邮箱账号收集的习惯（因为好多官方后台都是用内部邮箱账号登录的，指不定哪天你就得到一个进后台的机会）。</p>
<blockquote>
<p>（1）通过说明文档以及网站页面收集，或者网站发表者以及留言板信息处收集账号</p>
<p>（2）通过 teemo，metago，burpusit，awvs，netspker 或者 google 语法收集</p>
<p>（3）搜索相关 QQ 群收集相关企业员工的社交账号</p>
</blockquote>
<p>用途： 可用来进行爆破或者弱口令登录以及撞裤攻击。</p>
<h1>0x04 外网打点基本流程</h1>
<p>经过以上的学习，接下来跟着文章梳理一遍打点的流程</p>
<h2 id="Step-One">Step One</h2>
<h3 id="主域名收集">主域名收集</h3>
<p>先收集目标的各种主域名（包括子公司、app、小程序、公众号等）</p>
<blockquote>
<p>工具：备案反查域名(icp_domans等)、企查查、…</p>
</blockquote>
<h3 id="收集子域名">收集子域名</h3>
<p>配置好api的oneforall 、masscan、fscan等等工具，获得比较全的子域名</p>
<h3 id="获取真实IP与C段">获取真实IP与C段</h3>
<p>对于子域名，获取其真实ip和C段 （C段量大、比较分散的话，可以放到后面再看）</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">可能很大一部分ip是CDN，快速过滤掉CDN ip<span class="token punctuation">,</span>以及做一些简单的绕过（时间充足的话，对重点域名详细绕过，寻找真实ip<span class="token punctuation">)</span>

工具：
Eeyes（快速筛选真实IP并整理为C段<span class="token punctuation">,</span>网络条件好的话，准确率挺高的）
fcdn <span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//github.com/ccc-f/FCDN</span>
<span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//github.com/mabangde/cdncheck_cn</span>

国外可以使用cdncheck：（可检测CDN、WAF、云，国内基本没啥用）
type ip.txt | cdncheck.exe -resp -cdn <span class="token punctuation">(</span>再过滤一遍Eeyes输出的真实ip结果<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="获取对应的资产">获取对应的资产</h3>
<p>获取ip和C段信息对应的资产</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">通过fofa等快速获取ip和C段信息对应的资产
<span class="token punctuation">(</span>相关工具：<span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//github.com/zhizhuoshuma/Assetstocollect )</span>

再通过fofa语法搜一遍主域对应的资产信息： domain=<span class="token string">"xxx.com"</span>

时间充足的话，对ip和C段信息进行全端口扫描，获取更多资产<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="子域名探活">子域名探活</h3>
<p>对子域名进行探活，获取web资产信息</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">httpx 等，可以增加一下常用的端口

探活有时候不太准确，漏掉一些，可以将所有子域前面增加`<span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//` `https://` 进行一遍识别</span>

探活可以跟指纹识别一起进行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="整理资产，指纹识别">整理资产，指纹识别</h3>
<p>整合所有web资产，进行指纹识别</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">通过子域名获得的web资产 <span class="token operator">+</span> fofa ip/C段<span class="token punctuation">(</span>ip=<span class="token string">"1.1.1.1"</span> <span class="token operator">or</span> ip=<span class="token string">"1.1.1.1/24"</span><span class="token punctuation">)</span> <span class="token operator">+</span> fofa domain=<span class="token string">"xxx.com"</span>等等 获得的web资产进行整合

整合后通过 <span class="token function">ehole</span><span class="token punctuation">(</span>扩充指纹<span class="token punctuation">)</span> 等，进行指纹识别

云溪、wappalyzergo、tidefinger （只能单个url）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="web资产漏扫">web资产漏扫</h3>
<p>根据目标的防护情况，选择漏扫工具：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">快速：fscan

完备：
1、nuclei
	整合POC：
		自带
		整合一些其他的
		爬虫<span class="token punctuation">(</span>katana等）+fuzzing-templates（<span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//github.com/projectdiscovery/fuzzing- templates） or https://github.com/0xKayala/NucleiFuzzer</span>
            
2、afrog <span class="token punctuation">(</span>1000个左右poc<span class="token punctuation">)</span>
            
3、爬虫+xray
            
补充：
vscan、sweetbaby<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="IP和C段的高危端口利用">IP和C段的高危端口利用</h3>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">一些非web端口，如ftp ssh 各种数据库 rdp 之类的

弱口令、历史漏洞<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="web资产目录扫描">web资产目录扫描</h3>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">dirsearch ，可以先只扫200，可以在前面就先挂上

备份文件扫描（主要针对一些自建的站）

针对重点资产，手工测试的时候再进行深入扫描<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="敏感Web资产，深入挖掘">敏感Web资产，深入挖掘</h3>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">登录/注册/敏感框架、组件、服务等：

i<span class="token punctuation">)</span>指纹识别和POC可能不够完备，针对一些产品，手工识别并找一些历史漏洞测试
ii<span class="token punctuation">)</span>重点关注 反序列化、文件上传、SQL注入 漏洞，详细挖掘一下
iii<span class="token punctuation">)</span> 登录点爆破，可以收集目标邮箱和社工字典
iv<span class="token punctuation">)</span>根据目录扫描结果，对有东西的站深入看一下
v<span class="token punctuation">)</span>有充足时间，可以像挖SRC一样对一些站深入挖掘一下。（urlfiner、js接口、爬虫的敏感链接之类。）

测试时，burp插件安装完备<span class="token punctuation">(</span>strut2、shiro、fastjson、log4j2、spring、SQL注入相关等<span class="token punctuation">)</span>都打开，
同时，有条件可以挂着xray被动<span class="token punctuation">(</span>xray可以只用来测sql注入<span class="token punctuation">)</span>

java站基本是strut2和spring 二选一，有时间都打一遍poc，同时要注意log4j2漏洞一定要测一下
（工具：SpringBoot-Scan-2.03、Spring_All_Reachable、struts2_19.jar）
<span class="token punctuation">(</span>log4j2一般使用burp插件<span class="token punctuation">:</span><span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//github.com/whwlsfb/Log4j2Scan)</span>

工具：
智能 Web后台密码爆破工具 <span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//github.com/Fly-Playgroud/Boom 可以批量爆破web后台</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>小tips：备份文件扫描可以提前</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">i<span class="token punctuation">)</span>对一些自建站点，可以进行备份文件扫描，找到备份文件，审源码

ii<span class="token punctuation">)</span>通过google、github、fofa ico/证书/关键字/title=<span class="token string">"单位名"</span>等，收集更多资产或者泄露信息

iii<span class="token punctuation">)</span>对于一些小众产品，可以通过fofa等，找其他人使用的，可能在用低版本或者有备份文件，拿到源码去审
计<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="app、小程序、公众号">app、小程序、公众号</h3>
<p>对发现的app、小程序、公众号进行进一步的探测，类比web探测进行</p>
<h2 id="Step-Second">Step Second</h2>
<h3 id="收集目标">收集目标</h3>
<p>上下游公司、供应链、IDC、IDC代理商等信息，重复第一轮的步骤。</p>
<pre class="line-numbers language-none"><code class="language-none">用收集到的邮箱再去反查一波，就能找到一部分了，然后去相关备案网站再找一部分，剩下的就是通过爬取相关新闻、超链接、年报，从里面找跟他业务相关的公司<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1>0x05 后记</h1>
<p>这几天忙得要死来不及学习。今天大概学习完了，回顾之前的学习历程，感觉是有点抽象的，毕竟感觉在纸上谈兵，学的有点没激情，但这却是后面进一步深入的基础，必须啃下来。</p>
<p>经过上述的学习，对渗透测试以及打点流程有了认识，但日后能实施于实践才算成功，只能说任重道远。总的来说对于上述的流程是有认识了，但对于工具和平台等的使用还是有点懵的，被强行喂了一通知识，但却没有好好消化，因此在今后应该多实战熟悉工具的利用，进一步熟悉渗透测试流程（水很深啊~~~）</p>
<p>之后在看一看st3pby师傅给的实战打点文章，看看佬们的骚操作。本篇文章日后肯定也会更新的（毕竟质量有点差）希望不断完善，形成一个优美的信息搜集知识库！</p>
<h1>0x06 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7075240551456440333">Web安全渗透测试基本流程</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/01.%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">d4m1ts 知识库</a></p>
<p><a target="_blank" rel="noopener" href="https://www.wangan.com/p/7fy7fy135d85fec8#DNS%E5%9F%9F%E4%BC%A0%E9%80%81%E5%8F%91%E7%8E%B0%E5%AD%90%E5%9F%9F%E5%90%8D">干货 | 最全Web 渗透测试信息搜集-CheckList</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/database/195169.html">全流程信息收集方法总结</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40748006/article/details/106328924?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=dig%E5%91%BD%E4%BB%A4&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-106328924.142%5Ev99%5Epc_search_result_base4&amp;spm=1018.2226.3001.4187">DNS篇之dig使用详解 </a>  ——很详细</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41982020/article/details/121231166?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170410967216800213037345%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=170410967216800213037345&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-121231166-null-null.142%5Ev99%5Epc_search_result_base4&amp;utm_term=dig%E5%91%BD%E4%BB%A4&amp;spm=1018.2226.3001.4187">dig命令的介绍与使用</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/laoxu/1282773">DNS服务系列之一：泛域名解析的安全案例</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hls-code/p/16808977.html">nslookup命令详解：nslookup是一种网络管理命令行工具</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hybcx</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://hybcx.xyz/2023/12/31/shen-tou-ce-shi-wai-wang-da-dian/">http://hybcx.xyz/2023/12/31/shen-tou-ce-shi-wai-wang-da-dian/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hybcx</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">
                                    <span class="chip bg-color">内网渗透</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">随缘，看各位佬的心情</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'u0n6SeKEfoilg30pN4VxouXR-MdYXbMMI',
        appKey: '36SdcVNDUm7oJBLF0OpXO4ut',
        serverURLs: 'https://u0n6seke.api.lncldglobal.com',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/01/10/shen-ru-dvwa/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="重温DVWA">
                        
                        <span class="card-title">重温DVWA</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-01-10
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Web%E6%B8%97%E9%80%8F%E9%9D%B6%E5%9C%BA/" class="post-category">
                                    Web渗透靶场
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/web%E6%B8%97%E9%80%8F/">
                        <span class="chip bg-color">web渗透</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/12/27/ssrf-da-redis/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="ssrf打redis">
                        
                        <span class="card-title">ssrf打redis</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-12-27
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" class="post-category">
                                    web知识总结
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
                        <span class="chip bg-color">基础知识</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.js"></script>


<!-- 代码语言 -->


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('3'),
            headingSelector: 'h2, h3, h4, h5, h6'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <a href="/about" target="_blank">hybcx</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">861.1k</span>
            
            
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/hybchenxing/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2235199080@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=61555427038857" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=61555427038857" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>





    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2235199080" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2235199080" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    

    
        <script src="//code.tidio.co/7sfvbaabl5mp7up6avakdatk7dbm4xow.js"></script>
        <script>
            $(document).ready(function () {
                setInterval(change_Tidio, 50);
                function change_Tidio() {
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                }
            });
        </script>
    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
