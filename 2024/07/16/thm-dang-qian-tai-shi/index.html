<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>THM-当前态势 | hybcx</title><meta name="keywords" content="TryHackMe"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="THM-当前态势"><meta name="application-name" content="THM-当前态势"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="THM-当前态势"><meta property="og:url" content="http://hybcx.xyz/2024/07/16/thm-dang-qian-tai-shi/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="了解并实践企业环境中使用的常见技术和安全产品；涵盖了基于主机和网络的安全解决方案。 0x01 介绍 熟悉在红队参与期间首次访问受感染计算机的环境至关重要。因此，进行侦察和清点是重要的一环，首要目标是收集尽可能多的信息以供下一阶段使用。 建立了最初的立足点后，后渗透过程就开始了！ 这个房间介绍了我们需"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="了解并实践企业环境中使用的常见技术和安全产品；涵盖了基于主机和网络的安全解决方案。 0x01 介绍 熟悉在红队参与期间首次访问受感染计算机的环境至关重要。因此，进行侦察和清点是重要的一环，首要目标是收集尽可能多的信息以供下一阶段使用。 建立了最初的立足点后，后渗透过程就开始了！ 这个房间介绍了我们需"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2024/07/16/thm-dang-qian-tai-shi/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: 'THM-当前态势',
  postAI: '',
  pageFillDescription: '0x01 介绍, 0x02 部署虚拟机, 0x03 网络基础设施, 内网, 非军事区 (DMZ), 网络枚举, 内网服务, 0x04 AD环境, 什么是AD环境, 回答问题, 0x05 用户和组管理, 活动目录 (AD) 枚举, 0x06 主机安全解决方案1, 主机安全解决方案, 防病毒软件 (AV), Microsoft Windows Defender, 回答问题, 0x07 主机解决方案2, 安全事件记录和监控, 系统监视器（Sysmon）, 基于主机的入侵检测/预防系统（HIDS/HIPS）, 端点检测和响应 (EDR), 0x08 网络安全解决方案, 网络防火墙, 安全信息和事件管理 (SIEM), 入侵检测系统和入侵防御系统（NIDS/NIPS）, 0x09 应用程序和服务, 已安装的应用程序, 服务和进程, 共享文件和打印机, 内部服务：DNS、本地Web应用程序等, 回答问题了解并实践企业环境中使用的常见技术和安全产品涵盖了基于主机和网络的安全解决方案介绍熟悉在红队参与期间首次访问受感染计算机的环境至关重要因此进行侦察和清点是重要的一环首要目标是收集尽可能多的信息以供下一阶段使用建立了最初的立足点后后渗透过程就开始了这个房间介绍了我们需要了解的常用概念技术和安全产品在这个房间里假设我们已经获得了对机器的访问权限并且我们准备通过执行以下枚举来扩展我们对环境的更多了解网络基础设施活动目录环境用户和组基于主机的安全解决方案基于网络的安全解决方案应用程序和服务部署虚拟机为了遵循任务内容并应用此房间中提供的内容您需要使用此任务中的绿色启动计算机按钮启动连接的计算机并等待几分钟以使其启动要访问连接的计算机您可以使用浏览器视图中的拆分或通过连接如果您更喜欢通过连接请确保部署或连接到使用以下凭据网络基础设施一旦到达未知网络我们的首要目标是确定我们在哪里以及我们可以到达什么在红队参与过程中我们需要了解我们正在处理什么目标系统该机器提供什么服务我们处于什么样的网络中因此在获得初始访问权限后对受感染机器的枚举是回答这些问题的关键问题此任务将讨论我们在参与过程中可能遇到的常见网络类型网络分段是网络安全的额外层分为多个子网它用于提高网络的安全性和管理例如它用于防止未经授权访问公司最有价值的资产例如客户数据财务记录等虚拟局域网是一种用于网络分段的网络技术用于控制网络问题例如本地网络中的广播问题并提高安全性内的主机只能与同一网络内的其他主机进行通信如果您想了解有关网络基础知识的更多信息我们建议尝试以下模块网络基础知识内网内部网络是根据内部设备的重要性或其数据可访问性的重要性进行分段和分离的子网内部网络的主要目的是在组织内共享信息更快更轻松的通信协作工具操作系统和网络服务在企业网络中网络管理员出于各种原因打算使用网络分段包括控制网络流量优化网络性能和改善安全状况上图是网络分段的简单概念的示例因为网络被分为两个网络第一个用于员工工作站和个人设备第二个是针对提供内部服务例如内部电子邮件服务等的私有和内部网络设备非军事区网络是一种边缘网络可保护公司内部局域网并为其添加额外的安全层使其免受不可信流量的影响的常见设计是位于公共互联网和内部网络之间的子网公司内部网络的设计取决于其要求和需求例如假设一家公司提供网站等公共服务那么他们可能会设计一个网络来隔离和启用对公网流量不可信流量的访问控制在上图中我们用红色表示网络的网络流量该网络流量不受信任直接来自互联网内部网络之间的绿色网络流量是可以经过一台或多台网络安全设备的受控流量枚举系统和内部网络是发现阶段这使得攻击者能够了解系统和内部网络根据获得的信息我们用它来处理横向移动或权限升级以获得系统或环境的更多权限网络枚举有许多与网络方面相关的内容需要检查例如和端口以及已建立的连接路由表表等让我们开始检查目标机器的和开放端口这可以使用命令来完成如下所示输出显示打开的端口以及已建立的连接接下来我们列出表其中包含与网络内目标计算机通信的计算机的地址和物理地址这有助于查看网络内的通信以扫描其他计算机的开放端口和漏洞内网服务它为内部网络设备提供私有和内部网络通信访问网络服务的一个示例是内部服务器自定义应用程序等需要注意的是内部网络服务无法在网络外部访问但是一旦我们初步访问了这些网络服务的网络之一它们就可以访问并可用于通信我们将在任务中讨论更多应用程序和服务包括和自定义应用程序环境什么是环境它是一种基于的目录服务用于存储并向内部网络环境提供数据对象它允许集中管理身份验证和授权包含有关网络和环境的基本信息包括用户计算机打印机等例如可能包含用户的详细信息如职位电话号码地址密码组权限等该图是设计方式的一个可能示例控制器放置在服务器子网中如上所示的服务器网络然后客户端位于单独的网络上它们可以在其中加入域并通过防火墙使用服务以下是我们需要熟悉的组件列表组织单位服务帐户内置本地用户域用户托管服务帐户域控制器是提供服务并控制整个域的服务器它是一种集中式用户管理形式提供用户数据加密以及控制对网络包括用户组策略和计算机的访问它还支持资源访问和共享这些都是攻击者针对域中的域控制器的原因因为它包含大量高价值信息组织单位是域内具有分层结构的容器对象可以是单个用户或组也可以是硬件组件例如计算机或打印机每个域都拥有一个数据库其中包含创建环境的对象身份信息包括允许对域中的计算机进行身份验证的安全主体一种特殊类型的用户帐户应用于其他对象的策略集合是网络中组件的集合是相互信任的域的集合有关基础知识的更多信息我们建议尝试以下空间基础知识实现初始访问后在企业网络中查找环境非常重要因为环境向加入的用户提供有关该环境的大量信息作为红队成员我们通过枚举环境并访问各种细节来利用这一点然后将其用于横向移动阶段回答问题为了检查机器是否是环境的一部分一种方法是我们可以使用命令提示符命令的输出提供有关计算机的信息包括操作系统名称和版本主机名和其他硬件信息以及域从上面的输出中我们可以看到计算机名称是一个域名为这证实它是环境的一部分请注意如果我们在域部分中看到则表示该计算机是本地工作组的一部分在继续之前请确保连接的计算机已部署并尝试我们讨论的内容连接的机器是环境的一部分吗是否用户和组管理在此任务中我们将了解有关用户和组的更多信息特别是在中收集有关受感染机器的信息至关重要可以在下一阶段使用一旦我们获得了对受感染计算机的初始访问权限以了解我们拥有什么以及系统中还有哪些其他帐户帐户发现就是第一步环境包含各种帐户这些帐户具有用于不同目的的必要权限访问权限和角色常见的服务帐户包括内置本地用户帐户域用户帐户托管服务帐户和虚拟帐户内置的本地用户帐户用于在本地管理系统不属于环境的一部分有权访问环境的域用户帐户可以使用服务由管理托管服务帐户是有限的域用户帐户具有更高的权限来管理服务域管理员是可以管理环境中信息的用户帐户包括配置用户组权限角色服务等红队参与的目标之一是寻找可找到域管理员的信息完全控制环境以下是管理员帐户内置管理员域控制器上的本地管理员访问权限域管理员对域中所有资源的管理访问权限企业管理员仅在林根中可用架构管理员能够修改域林对红队队员有用服务器运营商可以管理域服务器账户运营商可以管理不属于特权组的用户现在我们了解了环境中的各种帐户类型让我们列举一下在初始访问阶段我们可以访问的机器作为当前用户我们拥有查看或管理计算机和环境中的内容的特定权限活动目录枚举现在环境中的枚举需要不同的工具和技术一旦我们确认机器是环境的一部分我们就可以开始寻找稍后可能使用的任何变量信息在此阶段我们使用枚举用户和组以下命令用于获取所有用户帐户请注意我们需要使用参数我们还可以使用层次树结构来查找环境中的用户可分辨名称是逗号分隔的键和值对的集合用于标识目录中的唯一记录由域组件组织单元名称通用名称等组成以下是的示例可以如下可视化使用选项我们在活动目录中指定一个特定的例如我们可以指定列出用户中该部分的任何用户请注意结果可能包含多个用户具体取决于的配置尝试使用该命令查找中的所有用户并回答下面的问题主机安全解决方案在执行进一步操作之前我们需要获得有关现有安全解决方案的一般知识请记住枚举端点上的防病毒和安全检测方法非常重要以便尽可能不被发现并减少被发现的机会本任务将讨论企业网络中使用的常见安全解决方案分为主机安全解决方案和网络安全解决方案主机安全解决方案它是一组用于监控和检测主机内异常和恶意活动的软件应用程序包括防毒软件基于主机的防火墙安全事件记录和监控基于主机的入侵检测系统基于主机的入侵防御系统端点检测和响应让我们更详细地了解红队参与期间可能遇到的基于主机的安全解决方案防病毒软件防病毒软件也称为反恶意软件主要用于监控检测和阻止恶意软件在主机内执行大多数防病毒软件应用程序都使用众所周知的功能包括后台扫描完整系统扫描病毒定义在后台扫描中防病毒软件实时工作并在后台扫描所有打开和使用的文件首次安装防病毒软件时完整的系统扫描至关重要最有趣的部分是病毒定义其中防病毒软件会回复预定义的病毒这就是为什么防病毒软件需要不时更新的原因防病毒软件使用多种检测技术包括基于签名的检测基于启发式的检测基于行为的检测基于签名的检测是防病毒软件中用于识别恶意文件的常见传统技术之一通常研究人员或用户将受感染的文件提交到防病毒引擎平台中以供供应商进一步分析如果确认为恶意文件则签名会在他们的数据库中注册防病毒软件将扫描的文件与已知签名数据库进行比较以发现客户端可能存在的攻击和恶意软件如果我们有匹配那么它就会认为是威胁基于启发式的检测使用机器学习来确定我们是否拥有恶意文件它实时扫描和静态分析以查找应用程序代码中的可疑属性或检查它是否使用不常见的或系统它在做出决策时不依赖于基于签名的攻击或者有时依赖于基于签名的攻击这取决于防病毒软件的实现最后基于行为的检测依赖于监视和检查应用程序的执行以发现异常行为和不常见的活动例如创建更新注册表项中的值终止创建进程等作为红队成员了解防病毒软件是否存在至关重要它阻止我们做我们想做的事情我们可以使用内置工具来枚举软件例如这也可以使用来完成它会给出相同的结果因此计算机上安装了第三方防病毒软件和请注意服务器可能没有命名空间这可能无法在连接的上运行相反它适用于工作站是在端点上运行的预装防病毒安全工具它在检测中使用各种算法包括机器学习大数据分析深入的威胁抵抗研究以及微软云基础设施来防御恶意软件和病毒以三种保护模式工作主动被动禁用模式主动模式用于作为计算机上的主要防病毒软件运行提供保护和修复安装第三方防病毒软件后会运行被动模式因此它充当辅助防病毒软件扫描文件并检测威胁但不提供补救措施最后禁用模式是指被禁用或从系统中卸载我们可以使用以下命令来检查的服务状态接下来我们可以开始使用来获取当前的状态但是它提供了安全解决方案元素的当前状态包括反间谍软件防病毒实时保护等我们可以使用来指定我们需要的内容如下所示因此会突出显示是否已启用基于主机的防火墙它是安装并运行在主机上的安全工具可以防止和阻止攻击者或红队成员的攻击企图因此有必要枚举和收集有关我们最初访问的计算机中的防火墙及其规则的详细信息基于主机的防火墙的主要目的是控制通过设备接口的入站和出站流量它保护主机免受同一网络上不受信任的设备的侵害现代基于主机的防火墙在建立连接时使用多个级别的流量分析包括数据包分析防火墙充当网络层的控制访问它能够允许和拒绝网络数据包例如可以将防火墙配置为阻止同一网络中其他计算机通过命令发送的数据包下一代防火墙还可以检查其他层例如应用程序层因此它可以检测并阻止注入和其他应用层攻击如果我们对当前登录用户拥有管理员权限那么我们会尝试使用禁用一个或多个防火墙配置文件我们还可以了解并查看当前的防火墙规则是否被防火墙允许或拒绝在红队参与期间我们不知道防火墙阻止了什么但是我们可以利用一些例如和假设我们知道防火墙已经到位并且我们需要在没有额外工具的情况下测试入站连接那么我们可以执行以下操作因此我们可以确认端口上的入站连接已打开并在防火墙中被允许请注意我们还可以通过在的参数中指定来测试同一网络或域名中的远程目标回答问题主机解决方案在本次任务中我们将继续讨论主机安全解决方案安全事件记录和监控操作系统会在多个类别中记录事件信息包括应用程序系统安全性服务等此外安全设备和网络设备也会将事件信息存储到日志文件中以便系统管理员了解系统的运行状况我们可以使用获取本地计算机上可用事件日志的列表有时可用事件日志列表可以让您深入了解计算机上安装了哪些应用程序和服务例如我们可以看到本地计算机有服务器等有关的更多信息以及示例请访问文档网站在企业网络中日志代理软件安装在客户端上用于收集来自不同传感器的日志以分析和监控网络内的活动我们将在网络安全解决方案任务中详细讨论它们系统监视器工具的一大特色是它可以记录许多重要事件您还可以创建自己的规则和配置来监视进程的创建和终止网络连接对文件的修改远程威胁进程和内存访问要了解有关的更多信息请访问此处的文档页面作为红队成员主要目标之一是保持不被发现因此必须了解这些工具并避免导致生成和警报事件以下是一些可用于检测在受害计算机中是否可用的技巧我们可以在当前进程或服务中查找名为的进程或服务如下所示或寻找如下服务也可以通过检查注册表来完成所有这些命令都会确认工具是否已安装一旦我们检测到它如果我们有可读权限我们就可以尝试找到配置文件以了解系统管理员正在监视什么有关工具以及如何在端点中使用它的更多详细信息我们建议尝试房间基于主机的入侵检测预防系统代表基于主机的入侵检测系统它是能够监视和检测主机中的异常和恶意活动的软件的主要目的是检测可疑活动而不是阻止它们基于主机或网络的入侵检测系统有两种工作方式包括基于签名的它着眼于校验和和消息身份验证基于异常的会查找意外活动包括异常的带宽使用协议和端口基于主机的入侵防御系统可保护安装该系统的设备的操作系统活动它是针对众所周知的攻击和异常行为的检测和预防解决方案可以审核主机的日志文件监控进程并保护系统资源结合了防病毒行为分析网络应用防火墙等多种产品功能还有基于网络的我们将在下一个任务中介绍端点检测和响应它也称为端点检测和威胁响应是一种网络安全解决方案可防御恶意软件和其他威胁可以查找恶意文件监控端点系统和网络事件并将其记录在数据库中以供进一步分析检测和调查是下一代防病毒软件可实时检测主机上的恶意活动分析系统数据和行为以产生区域威胁包括恶意软件包括病毒木马广告软件键盘记录程序漏洞利用链勒索软件以下是一些常见的端点软件尽管攻击者成功交付了有效负载并在接收反向时绕过了但仍在运行并监视系统如果它标记了警报它可能会阻止我们做其他事情我们可以使用脚本来枚举机器内的安全产品例如和它们通过检查文件元数据进程加载到当前进程中的服务以及驱动程序目录来检查常用的防病毒日志监控产品网络安全解决方案本任务将讨论企业网络中常见和使用的网络安全解决方案网络安全解决方案可以是用于监视检测和防止网络内恶意活动的软件或硬件设备它专注于保护连接到合作网络的客户端和设备网络安全解决方案包括但不限于网络防火墙防火墙是到达网络的不受信任流量的第一个检查点防火墙根据规则和策略将不受信任的流量过滤到网络中此外防火墙还可用于将网络与外部流量源内部流量源甚至特定应用程序隔离如今防火墙产品是内置网络路由器或其他提供各种安全功能的安全产品以下是企业可能使用的一些防火墙类型包过滤防火墙代理防火墙网络地址转换防火墙应用程序防火墙安全信息和事件管理结合了安全信息管理和安全事件管理可以实时监控和分析事件并跟踪和记录数据帮助系统管理员和蓝队成员在对组织造成损害之前监控和跟踪潜在的安全威胁和漏洞解决方案充当日志数据聚合中心从传感器收集日志文件并对收集的数据执行功能以识别和检测安全威胁或攻击以下是可能提供的一些功能日志管理实时捕获和收集整个企业网络的数据事件分析它应用高级分析来检测异常模式或行为仪表板中提供图表和统计数据事件监控和安全警报它监控整个网络包括连接的用户设备应用程序等一旦检测到攻击它就会立即提醒管理员采取适当的措施来缓解合规管理和报告随时生成实时报告能够利用集成的威胁情报和人工智能技术来检测高级和未知威胁包括内部威胁安全漏洞网络钓鱼攻击攻击攻击数据泄露等以下是很多企业中常见的一些产品入侵检测系统和入侵防御系统基于网络的与基于主机的具有相似的概念主要区别在于基于网络的产品关注网络的安全而不是主机的安全基于网络的解决方案将基于分布在网络设备和主机中的传感器和代理来收集数据和都是企业用来保护其内部系统的检测和监控网络安全解决方案它们都读取网络数据包寻找异常行为和预加载到先前数据库中的已知威胁两种解决方案之间的显着区别在于需要人工交互或第三方软件来分析数据以采取行动是一种根据策略和规则接受或拒绝数据包的控制系统以下是常见的企业产品有关的更多信息请访问参考链接应用程序和服务这项任务将扩展我们更多地了解该系统所需的知识我们在之前的任务中讨论了系统内的帐户发现和安全产品我们将继续了解有关该系统的更多信息包括已安装的应用程序服务和进程共享文件和打印机内部服务和本地应用程序为了从信息中获益有必要了解系统提供的内容已安装的应用程序首先我们通过检查应用程序的名称和版本开始枚举系统中已安装的应用程序作为红队成员这些信息将使我们受益我们可能会发现安装了易受攻击的软件来利用和升级我们的系统权限此外我们可能会发现一些信息例如纯文本凭据留在属于其他系统或服务的系统上我们将使用命令列出所有已安装的应用程序及其版本另一件有趣的事情是寻找特定的文本字符串隐藏目录备份文件然后我们可以使用如下所示服务和进程服务使系统管理员能够在我们自己的会话中创建长时间运行的可执行应用程序有时服务的权限配置错误这会提升当前用户的权限访问级别因此我们必须查看正在运行的服务并执行服务和进程侦察有关更多详细信息您可以阅读上有关进程发现的内容进程发现是了解系统提供的内容的枚举步骤红队应该获取有关在系统上运行服务和进程的信息和详细信息我们需要尽可能多地了解我们的目标这些信息可以帮助我们了解网络中其他系统上运行的常见软件例如受感染的系统可能有一个用于内部目的的自定义客户端应用程序定制内部开发的软件是升级向量的最常见根本原因因此值得进一步挖掘以获取有关当前流程的详细信息有关从蓝队角度了解核心进程的更多详细信息请查看房间核心进程共享文件和打印机共享文件和网络资源通常用于个人和企业环境系统管理员错误配置访问权限他们可能拥有有关其他帐户和系统的有用信息有关打印机黑客攻击的更多信息我们建议尝试以下房间打印机黑客攻击内部服务本地应用程序等内部网络服务是扩展我们对其他系统和整个环境的了解的另一个信息来源要获取有关用于外部和内部网络服务的网络服务的更多详细信息我们建议尝试以下房间网络服务网络服务以下是我们感兴趣的一些常用的内部服务域名解析服务电子邮件服务网络文件共享应用程序数据库服务回答问题让我们尝试使用命令提示符列出正在运行的服务以检查是否有任何有趣的正在运行的服务我们可以看到一个名为的服务我们想了解更多信息现在让我们查找确切的服务名称我们需要它来查找更多信息我们找到文件名及其路径现在让我们使用查找更多详细信息一旦我们找到了它的进程我们就可以通过列出系统内的监听端口来检查是否提供网络服务最后我们可以看到它正在侦听端口现在尝试应用我们讨论的内容并找到的端口号端口号是多少我们提到服务是任何环境和网络中常用的协议附属机器为提供服务让我们通过执行区域传输来枚举看看是否可以列出所有记录我们将使用工具执行区域传输一旦我们执行它我们就会提供我们需要询问的服务器在本例中是目标计算机现在让我们在环境中找到的域上尝试区域传输前面的输出是成功执行区域传输的示例现在使用枚举域控制器的域名并执行区域传输其中一条记录的标志是什么这个房间介绍企业环境中的客户端系统学生应该更好地了解如何在企业网络中使用客户端包括网络基础设施环境安全措施等内部应用程序和服务',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-08-01 16:12:26',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/TryHackMe/" itemprop="url">TryHackMe</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/TryHackMe/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>TryHackMe</span></a></span></div></div><h1 class="post-title" itemprop="name headline">THM-当前态势</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-07-16T07:22:22.000Z" title="发表于 2024-07-16 15:22:22">2024-07-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-08-01T08:12:26.594Z" title="更新于 2024-08-01 16:12:26">2024-08-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">9.5k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>32分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="THM-当前态势"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/07/16/thm-dang-qian-tai-shi/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/07/16/thm-dang-qian-tai-shi/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2024/07/16/thm-dang-qian-tai-shi/"><header><a class="post-meta-categories" href="/categories/TryHackMe/" itemprop="url">TryHackMe</a><a href="/tags/TryHackMe/" tabindex="-1" itemprop="url">TryHackMe</a><h1 id="CrawlerTitle" itemprop="name headline">THM-当前态势</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2024-07-16T07:22:22.000Z" title="发表于 2024-07-16 15:22:22">2024-07-16</time><time itemprop="dateCreated datePublished" datetime="2024-08-01T08:12:26.594Z" title="更新于 2024-08-01 16:12:26">2024-08-01</time></header><p>了解并实践企业环境中使用的常见技术和安全产品；涵盖了基于主机和网络的安全解决方案。</p>
<h1 id="0x01-介绍">0x01 介绍</h1>
<p>熟悉在红队参与期间首次访问受感染计算机的环境至关重要。因此，进行侦察和清点是重要的一环，首要目标是收集尽可能多的信息以供下一阶段使用。</p>
<p>建立了最初的立足点后，后渗透过程就开始了！</p>
<p>这个房间介绍了我们需要了解的常用概念、技术和安全产品。</p>
<p>在这个房间里，假设我们已经获得了对机器的访问权限，并且我们准备通过执行以下枚举来扩展我们对环境的更多了解：</p>
<ul>
<li>网络基础设施</li>
<li>活动目录环境</li>
<li>用户和组</li>
<li>基于主机的安全解决方案</li>
<li>基于网络的安全解决方案</li>
<li>应用程序和服务</li>
</ul>
<h1 id="0x02-部署虚拟机">0x02 部署虚拟机</h1>
<p>为了遵循任务内容并应用此房间中提供的内容，您需要使用此任务中的绿色启动计算机按钮启动连接的计算机，并等待几分钟以使其启动。要访问连接的计算机，您可以使用浏览器视图中的拆分或通过 RDP 连接。</p>
<p>如果您更喜欢通过 RDP 连接，请确保部署 AttackBox 或连接到 VPN.</p>
<p>使用以下凭据：kkidd:Pass123321@</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ xfreerdp /<span class="hljs-attribute">v</span>:MACHINE_IP /<span class="hljs-attribute">u</span>:kkidd</code></pre>
<h1 id="0x03-网络基础设施">0x03 网络基础设施</h1>
<p>一旦到达未知网络，我们的首要目标是确定我们在哪里以及我们可以到达什么。在红队参与过程中，我们需要了解我们正在处理什么目标系统，该机器提供什么服务，我们处于什么样的网络中。因此，在获得初始访问权限后对受感染机器的枚举是回答这些问题的关键问题。此任务将讨论我们在参与过程中可能遇到的常见网络类型。</p>
<p>网络分段是网络安全的额外层，分为多个子网。它用于提高网络的安全性和管理。例如，它用于防止未经授权访问公司最有价值的资产，例如客户数据、财务记录等。</p>
<p>虚拟局域网 (VLAN) 是一种用于网络分段的网络技术，用于控制网络问题（例如本地网络中的广播问题）并提高安全性。 VLAN内的主机只能与同一VLAN网络内的其他主机进行通信。</p>
<p>如果您想了解有关网络基础知识的更多信息，我们建议尝试以下 TryHackMe 模块：<a target="_blank" rel="noopener" href="https://tryhackme.com/module/network-fundamentals">网络基础知识</a>.</p>
<h2 id="内网">内网</h2>
<p>内部网络是根据内部设备的重要性或其数据可访问性的重要性进行分段和分离的子网。内部网络的主要目的是在组织内共享信息、更快、更轻松的通信、协作工具、操作系统和网络服务。在企业网络中，网络管理员出于各种原因打算使用网络分段，包括控制网络流量、优化网络性能和改善安全状况。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857035.png" alt="image-20240716153711591"></p>
<p>上图是网络分段的简单概念的示例，因为网络被分为两个网络。第一个用于员工工作站和个人设备。第二个是针对提供内部服务（例如 DNS、内部 Web、电子邮件服务等）的私有和内部网络设备。</p>
<h2 id="非军事区-dmz">非军事区 (DMZ)</h2>
<p>DMZ 网络是一种边缘网络，可保护公司内部局域网并为其添加额外的安全层，使其免受不可信流量的影响。 DMZ 的常见设计是位于公共互联网和内部网络之间的子网。</p>
<p>公司内部网络的设计取决于其要求和需求。例如，假设一家公司提供网站、DNS、FTP、Proxy、VPN等公共服务，那么他们可能会设计一个DMZ网络来隔离和启用对公网流量、不可信流量的访问控制。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857036.png" alt="image-20240716154053609"></p>
<p>在上图中，我们用红色表示 DMZ 网络的网络流量，该网络流量不受信任（直接来自互联网）。内部网络之间的绿色网络流量是可以经过一台或多台网络安全设备的受控流量。</p>
<p>枚举系统和内部网络是发现阶段，这使得攻击者能够了解系统和内部网络。根据获得的信息，我们用它来处理横向移动或权限升级，以获得系统或 AD 环境的更多权限。</p>
<h2 id="网络枚举">网络枚举</h2>
<p>有许多与网络方面相关的内容需要检查，例如 TCP 和 UDP 端口以及已建立的连接、路由表、ARP 表等。</p>
<p>让我们开始检查目标机器的 TCP 和 UDP 开放端口。这可以使用 netstat 命令来完成，如下所示。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; netstat -na

Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">80</span>             <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">88</span>             <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">135</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">389</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING</code></pre>
<p>输出显示打开的端口以及已建立的连接。接下来，我们列出 ARP 表，其中包含与网络内目标计算机通信的计算机的 IP 地址和物理地址。这有助于查看网络内的通信以扫描其他计算机的开放端口和漏洞。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857037.png" alt="image-20240716155533192"></p>
<h2 id="内网服务">内网服务</h2>
<p>它为内部网络设备提供私有和内部网络通信访问。网络服务的一个示例是内部 DNS、Web 服务器、自定义应用程序等。需要注意的是，内部网络服务无法在网络外部访问。但是，一旦我们初步访问了这些网络服务的网络之一，它们就可以访问并可用于通信。</p>
<p>我们将在任务 9 中讨论更多 Windows 应用程序和服务，包括 DNS 和自定义 Web 应用程序。</p>
<h1 id="0x04-ad环境">0x04 AD环境</h1>
<h2 id="什么是ad环境">什么是AD环境</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857038.png" alt="image-20240716155704264"></p>
<p>它是一种基于Windows的目录服务，用于存储并向内部网络环境提供数据对象。它允许集中管理身份验证和授权。 AD 包含有关网络和环境的基本信息，包括用户、计算机、打印机等。例如，AD 可能包含用户的详细信息，如职位、电话号码、地址、密码、组、权限等。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857039.png" alt="image-20240716155958074"></p>
<p>该图是 Active Directory 设计方式的一个可能示例。 AD 控制器放置在服务器子网中（如上所示的服务器网络），然后 AD 客户端位于单独的网络上，它们可以在其中加入域并通过防火墙使用 AD 服务。</p>
<p>以下是我们需要熟悉的Active Directory组件列表：</p>
<ul>
<li>Domain Controllers</li>
<li>Organizational Units 组织单位</li>
<li>AD objects</li>
<li>AD Domains</li>
<li>Forest</li>
<li>AD Service Accounts: Built-in local users, Domain users, Managed service accounts<br>
AD 服务帐户：内置本地用户、域用户、托管服务帐户</li>
<li>Domain Administrators</li>
</ul>
<p>域控制器是提供 Active Directory 服务并控制整个域的 Windows 服务器。它是一种集中式用户管理形式，提供用户数据加密以及控制对网络（包括用户、组、策略和计算机）的访问。它还支持资源访问和共享。这些都是攻击者针对域中的域控制器的原因，因为它包含大量高价值信息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857040.png" alt="image-20240716160227405"></p>
<p>组织单位 (OU) 是 AD 域内具有分层结构的容器。</p>
<p>Active Directory 对象可以是单个用户或组，也可以是硬件组件，例如计算机或打印机。每个域都拥有一个数据库，其中包含创建 AD 环境的对象身份信息，包括：</p>
<ul>
<li>Users - 允许对域中的计算机进行身份验证的安全主体</li>
<li>Computers - 一种特殊类型的用户帐户</li>
<li>GPOs - 应用于其他 AD 对象的策略集合</li>
</ul>
<p>AD domains是 AD 网络中 Microsoft 组件的集合。</p>
<p>AD Forest是相互信任的域的集合。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857041.png" alt="image-20240716160519115"></p>
<p>有关 Active Directory 基础知识的更多信息，我们建议尝试以下 TryHackMe 空间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/winadbasics">Active Directory 基础知识</a>.</p>
<p>实现初始访问后，在企业网络中查找 AD 环境非常重要，因为 Active Directory 环境向加入的用户提供有关该环境的大量信息。作为红队成员，我们通过枚举 AD 环境并访问各种细节来利用这一点，然后将其用于横向移动阶段。</p>
<h2 id="回答问题">回答问题</h2>
<p>为了检查Windows机器是否是AD环境的一部分，一种方法是，我们可以使用命令提示符systeminfo命令。 systeminfo 的输出提供有关计算机的信息，包括操作系统名称和版本、主机名和其他硬件信息以及 AD 域。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; systeminfo | findstr Domain
OS Configuration:          Primary Domain Controller
Domain:                    thmdomain.com</code></pre>
<p>从上面的输出中，我们可以看到计算机名称是一个 AD，域名为 <a target="_blank" rel="noopener" href="http://thmdomain.com">thmdomain.com</a>，这证实它是 AD 环境的一部分。</p>
<p>请注意，如果我们在域部分中看到“WORKGROUP”，则表示该计算机是本地工作组的一部分。</p>
<p>在继续之前，请确保连接的计算机已部署并尝试我们讨论的内容。连接的机器是 AD 环境的一部分吗？ （是|否）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857042.png" alt="image-20240716161239476"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857043.png" alt="image-20240716161252926"></p>
<h1 id="0x05-用户和组管理">0x05 用户和组管理</h1>
<p>在此任务中，我们将了解有关用户和组的更多信息，特别是在 Active Directory 中。收集有关受感染机器的信息至关重要，可以在下一阶段使用。一旦我们获得了对受感染计算机的初始访问权限，以了解我们拥有什么以及系统中还有哪些其他帐户，帐户发现就是第一步。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857044.png" alt="image-20240716161339200"></p>
<p>Active Directory 环境包含各种帐户，这些帐户具有用于不同目的的必要权限、访问权限和角色。常见的 Active Directory 服务帐户包括内置本地用户帐户、域用户帐户、托管服务帐户和虚拟帐户。</p>
<ul>
<li>内置的本地用户帐户用于在本地管理系统，不属于 AD 环境的一部分。</li>
<li>有权访问 Active Directory 环境的域用户帐户可以使用 AD 服务（由 AD 管理）。</li>
<li>AD 托管服务帐户是有限的域用户帐户，具有更高的权限来管理 AD 服务。</li>
<li>域管理员是可以管理 Active Directory 环境中信息的用户帐户，包括 AD 配置、用户、组、权限、角色、服务等。红队参与的目标之一是寻找可找到域管理员的信息完全控制 AD 环境。</li>
</ul>
<p>以下是 Active Directory 管理员帐户：</p>
<table>
<thead>
<tr>
<th>BUILTIN\Administrator 内置\管理员</th>
<th>域控制器上的本地管理员访问权限</th>
</tr>
</thead>
<tbody>
<tr>
<td>Domain Admins 域管理员</td>
<td>对域中所有资源的管理访问权限</td>
</tr>
<tr>
<td>Enterprise Admins 企业管理员</td>
<td>仅在林根中可用</td>
</tr>
<tr>
<td>Schema Admins 架构管理员</td>
<td>能够修改域/林；对红队队员有用</td>
</tr>
<tr>
<td>Server Operators 服务器运营商</td>
<td>可以管理域服务器</td>
</tr>
<tr>
<td>Account Operators 账户运营商</td>
<td>可以管理不属于特权组的用户</td>
</tr>
</tbody>
</table>
<p>现在我们了解了 AD 环境中的各种帐户类型。让我们列举一下在初始访问阶段我们可以访问的 Windows 机器。作为当前用户，我们拥有查看或管理计算机和 AD 环境中的内容的特定权限。</p>
<h2 id="活动目录-ad-枚举">活动目录 (AD) 枚举</h2>
<p>现在，AD 环境中的枚举需要不同的工具和技术。一旦我们确认机器是 AD 环境的一部分，我们就可以开始寻找稍后可能使用的任何变量信息。在此阶段，我们使用 PowerShell 枚举用户和组。</p>
<p>以下 PowerShell 命令用于获取所有 Active Directory 用户帐户。请注意，我们需要使用 -Filter 参数。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-ADUser  -Filter *
DistinguishedName : CN=Administrator,CN=Users,DC=thmredteam,DC=com
Enabled           : True
GivenName         :
Name              : Administrator
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">4094</span>d220-fb71-<span class="hljs-number">4</span>de1-b5b2-ba18f6583c65
SamAccountName    : Administrator
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">500</span>
Surname           :
UserPrincipalName :
PS C:\Users\thm&gt;</code></pre>
<p>我们还可以使用 <a target="_blank" rel="noopener" href="http://www.ietf.org/rfc/rfc2253.txt">LDAP 层次树结构</a>来查找 AD 环境中的用户。可分辨名称 (DN) 是逗号分隔的键和值对的集合，用于标识目录中的唯一记录。 DN 由域组件 (DC)、组织单元名称 (OU)、通用名称 (CN) 等组成。以下“CN=User1,CN=Users,DC=thmredteam,DC=com”是 DN 的示例，可以如下可视化：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857045.png" alt="image-20240716161858483"></p>
<p>使用 SearchBase 选项，我们在活动目录中指定一个特定的 Common-Name CN。例如，我们可以指定列出用户中该部分的任何用户.</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-ADUser -Filter * -SearchBase <span class="hljs-string">"CN=Users,DC=THMREDTEAM,DC=COM"</span>


DistinguishedName : CN=Administrator,CN=Users,DC=thmredteam,DC=com
Enabled           : True
GivenName         :
Name              : Administrator
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">4094</span>d220-fb71-<span class="hljs-number">4</span>de1-b5b2-ba18f6583c65
SamAccountName    : Administrator
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">500</span>
Surname           :
UserPrincipalName :</code></pre>
<p>请注意，结果可能包含多个用户，具体取决于 CN 的配置。尝试使用该命令查找 THM OU 中的所有用户并回答下面的问题 1。</p>
<pre><code class="hljs scss">PS C:\Users\kkidd&gt; Get-ADUser -Filter * -SearchBase <span class="hljs-string">"OU=THM,DC=THMREDTEAM,DC=COM"</span>


DistinguishedName : CN=Pierre Pittman,OU=THM,DC=thmredteam,DC=com
GivenName         : Pierre
Name              : Pierre Pittman
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">34</span>febcdd-<span class="hljs-number">49</span>dc-<span class="hljs-number">4160</span>-b88e-<span class="hljs-number">7</span>e6323f40dba
SamAccountName    : ppittman
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1113</span>
Surname           : Pittman
UserPrincipalName : ppittman@thmredteam.com

DistinguishedName : CN=Dario Philips,OU=THM,DC=thmredteam,DC=com
GivenName         : Dario
Name              : Dario Philips
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">3</span>cc9cfc7-<span class="hljs-number">3</span>c62-<span class="hljs-number">4</span>d46-<span class="hljs-number">8</span>a83-b8c02f45efbb
SamAccountName    : dphilips
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1114</span>
Surname           : Philips
UserPrincipalName : dphilips@thmredteam.com

DistinguishedName : CN=Weronika Burgess,OU=THM,DC=thmredteam,DC=com
GivenName         : Weronika
Name              : Weronika Burgess
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">88</span>e2935a-<span class="hljs-number">2</span>b50-<span class="hljs-number">4510</span>-<span class="hljs-number">816</span>d-<span class="hljs-number">8</span>eab5b06f548
SamAccountName    : wburgess
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1116</span>
Surname           : Burgess
UserPrincipalName : wburgess@thmredteam.com

DistinguishedName : CN=Cecil Solomon,OU=THM,DC=thmredteam,DC=com
GivenName         : Cecil
Name              : Cecil Solomon
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">88</span>ca7ae9-<span class="hljs-number">0</span>f03-<span class="hljs-number">4956</span>-<span class="hljs-number">8916</span>-b0cbd985520c
SamAccountName    : csolomon
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1120</span>
Surname           : Solomon
UserPrincipalName : csolomon@thmredteam.com

DistinguishedName : CN=Kevin Kidd,OU=THM,DC=thmredteam,DC=com
Enabled           : True
GivenName         : Kevin
Name              : Kevin Kidd
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">42353060</span>-b13d-<span class="hljs-number">48</span>b4-af2f-<span class="hljs-number">70543</span>e6ca8f8
SamAccountName    : kkidd
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1122</span>
Surname           : Kidd
UserPrincipalName : kkidd@thmredteam.com

DistinguishedName : CN=THM Admin,OU=THM,DC=thmredteam,DC=com
Enabled           : True
GivenName         : THM
Name              : THM Admin
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">8974</span>cd3d-<span class="hljs-number">9</span>bf0-<span class="hljs-number">4</span>c43-ac7d-<span class="hljs-number">068413</span>fb462c
SamAccountName    : thmadmin
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1124</span>
Surname           : Admin
UserPrincipalName : thmadmin@thmredteam.com</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857046.png" alt="image-20240716163034175"></p>
<h1 id="0x06-主机安全解决方案1">0x06 主机安全解决方案#1</h1>
<p>在执行进一步操作之前，我们需要获得有关现有安全解决方案的一般知识。请记住，枚举端点上的防病毒和安全检测方法非常重要，以便尽可能不被发现并减少被发现的机会。</p>
<p>本任务将讨论企业网络中使用的常见安全解决方案，分为主机安全解决方案和网络安全解决方案。</p>
<h2 id="主机安全解决方案">主机安全解决方案</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857047.png" alt="image-20240716163330543"></p>
<p>它是一组用于监控和检测主机内异常和恶意活动的软件应用程序，包括：</p>
<ol>
<li>防毒软件</li>
<li>Microsoft Windows Defender</li>
<li>基于主机的防火墙</li>
<li>安全事件记录和监控</li>
<li>基于主机的入侵检测系统 (HIDS)/基于主机的入侵防御系统 (HIPS)</li>
<li>端点检测和响应 (EDR)</li>
</ol>
<p>让我们更详细地了解红队参与期间可能遇到的基于主机的安全解决方案。</p>
<h2 id="防病毒软件-av">防病毒软件 (AV)</h2>
<p>防病毒软件也称为反恶意软件，主要用于监控、检测和阻止恶意软件在主机内执行。大多数防病毒软件应用程序都使用众所周知的功能，包括后台扫描、完整系统扫描、病毒定义。在后台扫描中，防病毒软件实时工作并在后台扫描所有打开和使用的文件。首次安装防病毒软件时，完整的系统扫描至关重要。最有趣的部分是病毒定义，其中防病毒软件会回复预定义的病毒。这就是为什么防病毒软件需要不时更新的原因。</p>
<p>防病毒软件使用多种检测技术，包括</p>
<ul>
<li>基于签名的检测</li>
<li>Heuristic-based detection 基于启发式的检测</li>
<li>Behavior-based detection 基于行为的检测</li>
</ul>
<p>基于签名的检测是防病毒软件中用于识别恶意文件的常见传统技术之一。通常，研究人员或用户将受感染的文件提交到防病毒引擎平台中，以供 AV 供应商进一步分析，如果确认为恶意文件，则签名会在他们的数据库中注册。防病毒软件将扫描的文件与已知签名数据库进行比较，以发现客户端可能存在的攻击和恶意软件。如果我们有匹配，那么它就会认为是威胁。</p>
<p>基于启发式的检测使用机器学习来确定我们是否拥有恶意文件。它实时扫描和静态分析，以查找应用程序代码中的可疑属性或检查它是否使用不常见的 Windows 或系统 API。它在做出决策时不依赖于基于签名的攻击，或者有时依赖于基于签名的攻击。这取决于防病毒软件的实现。</p>
<p>最后，基于行为的检测依赖于监视和检查应用程序的执行，以发现异常行为和不常见的活动，例如创建/更新注册表项中的值、终止/创建进程等。</p>
<p>作为红队成员，了解防病毒软件是否存在至关重要。它阻止我们做我们想做的事情。我们可以使用Windows内置工具来枚举AV软件，例如wmic.</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; wmic /namespace:\\root\securitycenter2 path antivirusproduct</code></pre>
<p>这也可以使用 PowerShell 来完成，它会给出相同的结果。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-CimInstance -Namespace root/SecurityCenter2 -ClassName AntivirusProduct


displayName              : Bitdefender Antivirus
instanceGuid             : {BAF124F4-FA00-<span class="hljs-number">8560</span>-<span class="hljs-number">3</span>FDE-<span class="hljs-number">6</span>C380446AEFB}
pathToSignedProductExe   : C:\Program Files\Bitdefender\Bitdefender Security\wscfix.exe
pathToSignedReportingExe : C:\Program Files\Bitdefender\Bitdefender Security\bdservicehost.exe
productState             : <span class="hljs-number">266240</span>
timestamp                : Wed, <span class="hljs-number">15</span> Dec <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">40</span>:<span class="hljs-number">10</span> GMT
PSComputerName           :

displayName              : Windows Defender
instanceGuid             : {D58FFC3A-<span class="hljs-number">813</span>B-<span class="hljs-number">4</span>fae-<span class="hljs-number">9</span>E44-DA132C9FAA36}
pathToSignedProductExe   : windowsdefender://
pathToSignedReportingExe : %ProgramFiles%\Windows Defender\MsMpeng.exe
productState             : <span class="hljs-number">393472</span>
timestamp                : Fri, <span class="hljs-number">15</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">22</span>:<span class="hljs-number">32</span>:<span class="hljs-number">01</span> GMT
PSComputerName           :</code></pre>
<p>因此，计算机上安装了第三方防病毒软件（Bitdefender Antivirus）和 Windows Defender。请注意，Windows 服务器可能没有 SecurityCenter2 命名空间，这可能无法在连接的 VM 上运行。相反，它适用于 Windows 工作站！</p>
<h2 id="microsoft-windows-defender">Microsoft Windows Defender</h2>
<p>Microsoft Windows Defender 是在端点上运行的预装防病毒安全工具。它在检测中使用各种算法，包括机器学习、大数据分析、深入的威胁抵抗研究以及微软云基础设施来防御恶意软件和病毒。 MS Defender 以三种保护模式工作：主动、被动、禁用模式。</p>
<p>主动模式用于 MS Defender 作为计算机上的主要防病毒软件运行，提供保护和修复。安装第三方防病毒软件后会运行被动模式。因此，它充当辅助防病毒软件，扫描文件并检测威胁，但不提供补救措施。最后，禁用模式是指 MS Defender 被禁用或从系统中卸载。</p>
<p>我们可以使用以下PowerShell命令来检查Windows Defender的服务状态：</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-Service WinDefend

Status   Name               DisplayName
------   ----               -----------
Running  WinDefend          Windows Defender Antivirus Service</code></pre>
<p>接下来，我们可以开始使用 Get-MpComputerStatus cmdlet 来获取当前的 Windows Defender 状态。但是，它提供了安全解决方案元素的当前状态，包括反间谍软件、防病毒、LoavProtection、实时保护等。我们可以使用 select 来指定我们需要的内容，如下所示，</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-MpComputerStatus | select RealTimeProtectionEnabled

RealTimeProtectionEnabled
-------------------------
                    False</code></pre>
<p>因此，MpComputerStatus 会突出显示 Windows Defender 是否已启用。</p>
<p>基于主机的防火墙：它是安装并运行在主机上的安全工具，可以防止和阻止攻击者或红队成员的攻击企图。因此，有必要枚举和收集有关我们最初访问的计算机中的防火墙及其规则的详细信息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857048.png" alt="image-20240716164251328"></p>
<p>基于主机的防火墙的主要目的是控制通过设备接口的入站和出站流量。它保护主机免受同一网络上不受信任的设备的侵害。现代基于主机的防火墙在建立连接时使用多个级别的流量分析，包括数据包分析。</p>
<p>防火墙充当网络层的控制访问。它能够允许和拒绝网络数据包。例如，可以将防火墙配置为阻止同一网络中其他计算机通过 ping 命令发送的 ICMP 数据包。下一代防火墙还可以检查其他 OSI 层，例如应用程序层。因此，它可以检测并阻止SQL注入和其他应用层攻击。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-NetFirewallProfile | Format-Table Name, Enabled

Name    Enabled
----    -------
Domain     True
Private    True
Public     True</code></pre>
<p>如果我们对当前登录用户拥有管理员权限，那么我们会尝试使用 Set-NetFirewallProfile cmdlet 禁用一个或多个防火墙配置文件.</p>
<pre><code class="hljs scss">PS C:\Windows\system32&gt; Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled False
PS C:\Windows\system32&gt; Get-NetFirewallProfile | Format-Table Name, Enabled
---- -------
Domain False
Private False
Public False</code></pre>
<p>我们还可以了解并查看当前的防火墙规则，是否被防火墙允许或拒绝。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-NetFirewallRule | select DisplayName, Enabled, Description

DisplayName                                                                  Enabled
-----------                                                                  -------
Virtual Machine Monitoring (DCOM-In)                                           False
Virtual Machine Monitoring (Echo Request - ICMPv4-In)                          False
Virtual Machine Monitoring (Echo Request - ICMPv6-In)                          False
Virtual Machine Monitoring (NB-Session-In)                                     False
Virtual Machine Monitoring (RPC)                                               False
SNMP Trap Service (UDP In)                                                     False
SNMP Trap Service (UDP In)                                                     False
Connected User Experiences and Telemetry                                        True
Delivery Optimization (TCP-In)                                                  True</code></pre>
<p>在红队参与期间，我们不知道防火墙阻止了什么。但是，我们可以利用一些 PowerShell cmdlet，例如 Test-NetConnection 和 TcpClient。假设我们知道防火墙已经到位，并且我们需要在没有额外工具的情况下测试入站连接，那么我们可以执行以下操作：</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Test-NetConnection -ComputerName <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> -Port <span class="hljs-number">80</span>


ComputerName     : <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
RemoteAddress    : <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
RemotePort       : <span class="hljs-number">80</span>
InterfaceAlias   : Loopback Pseudo-Interface <span class="hljs-number">1</span>
SourceAddress    : <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
TcpTestSucceeded : True

PS C:\Users\thm&gt; (New-Object System.Net.Sockets.<span class="hljs-built_in">TcpClient</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-string">"80"</span>)).Connected
True</code></pre>
<p>因此，我们可以确认端口 80 上的入站连接已打开并在防火墙中被允许。请注意，我们还可以通过在 Test-NetConnection 的 -ComputerName 参数中指定来测试同一网络或域名中的远程目标。</p>
<h2 id="回答问题">回答问题</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857049.png" alt="image-20240716165442820"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857050.png" alt="image-20240716165648911"></p>
<pre><code class="hljs scss">PS C:\Users\kkidd&gt; Get-NetFirewallRule | findstr <span class="hljs-string">"THM-Connection"</span>                               DisplayName           : THM-Connection                                                           Description           : THM-Connection inbound to <span class="hljs-number">17337</span> Port!</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857051.png" alt="image-20240716165925050"></p>
<h1 id="0x07-主机解决方案2">0x07 主机解决方案#2</h1>
<p>在本次任务中，我们将继续讨论主机安全解决方案。</p>
<h2 id="安全事件记录和监控">安全事件记录和监控</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857052.png" alt="image-20240716165953255"></p>
<p>Windows 操作系统会在多个类别中记录事件信息，包括应用程序、系统、安全性、服务等。此外，安全设备和网络设备也会将事件信息存储到日志文件中，以便系统管理员了解系统的运行状况。</p>
<p>我们可以使用 Get-EventLog cmdlet 获取本地计算机上可用事件日志的列表。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-EventLog -List

  <span class="hljs-built_in">Max</span>(K) Retain OverflowAction        Entries Log
  ------ ------ --------------        ------- ---
     <span class="hljs-number">512</span>      <span class="hljs-number">7</span> OverwriteOlder             <span class="hljs-number">59</span> Active Directory Web Services
  <span class="hljs-number">20</span>,<span class="hljs-number">480</span>      <span class="hljs-number">0</span> OverwriteAsNeeded         <span class="hljs-number">512</span> Application
     <span class="hljs-number">512</span>      <span class="hljs-number">0</span> OverwriteAsNeeded         <span class="hljs-number">170</span> Directory Service
 <span class="hljs-number">102</span>,<span class="hljs-number">400</span>      <span class="hljs-number">0</span> OverwriteAsNeeded          <span class="hljs-number">67</span> DNS Server
  <span class="hljs-number">20</span>,<span class="hljs-number">480</span>      <span class="hljs-number">0</span> OverwriteAsNeeded       <span class="hljs-number">4</span>,<span class="hljs-number">345</span> System
  <span class="hljs-number">15</span>,<span class="hljs-number">360</span>      <span class="hljs-number">0</span> OverwriteAsNeeded       <span class="hljs-number">1</span>,<span class="hljs-number">692</span> Windows PowerShell</code></pre>
<p>有时，可用事件日志列表可以让您深入了解计算机上安装了哪些应用程序和服务！例如，我们可以看到本地计算机有 Active Directory、DNS 服务器等。有关 Get-EventLog cmdlet 的更多信息以及示例，请访问 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-eventlog?view=powershell-5.1">Microsoft 文档网站</a>。</p>
<p>在企业网络中，日志代理软件安装在客户端上，用于收集来自不同传感器的日志，以分析和监控网络内的活动。我们将在网络安全解决方案任务中详细讨论它们。</p>
<h2 id="系统监视器sysmon">系统监视器（Sysmon）</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857053.png" alt="image-20240716170648481"></p>
<p>sysmon 工具的一大特色是它可以记录许多重要事件，您还可以创建自己的规则和配置来监视：</p>
<ul>
<li>Process creation and termination 进程的创建和终止</li>
<li>Network connections 网络连接</li>
<li>Modification on file 对文件的修改</li>
<li>Remote threats 远程威胁</li>
<li>Process and memory access 进程和内存访问</li>
<li>and many others</li>
</ul>
<p>要了解有关 sysmon 的更多信息，请访问此处的 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">Windows 文档页面</a>。</p>
<p>作为红队成员，主要目标之一是保持不被发现，因此必须了解这些工具并避免导致生成和警报事件。以下是一些可用于检测 sysmon 在受害计算机中是否可用的技巧。</p>
<p>我们可以在当前进程或服务中查找名为“Sysmon”的进程或服务，如下所示，</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-Process | Where-Object { $_<span class="hljs-selector-class">.ProcessName</span> -eq "Sysmon" }

Handles  <span class="hljs-built_in">NPM</span>(K)    <span class="hljs-built_in">PM</span>(K)      <span class="hljs-built_in">WS</span>(K)     <span class="hljs-built_in">CPU</span>(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    <span class="hljs-number">373</span>      <span class="hljs-number">15</span>    <span class="hljs-number">20212</span>      <span class="hljs-number">31716</span>              <span class="hljs-number">3316</span>   <span class="hljs-number">0</span> Sysmon</code></pre>
<p>或寻找如下服务</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-CimInstance win32_service -Filter <span class="hljs-string">"Description = 'System Monitor service'"</span>
# or
Get-Service | where-object {$_<span class="hljs-selector-class">.DisplayName</span> -like "*sysm*"}</code></pre>
<p>也可以通过检查 Windows 注册表来完成</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Sysmon/Operational</code></pre>
<p>所有这些命令都会确认 sysmon 工具是否已安装。一旦我们检测到它，如果我们有可读权限，我们就可以尝试找到 sysmon 配置文件，以了解系统管理员正在监视什么。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; findstr /si <span class="hljs-string">'&lt;ProcessCreate onmatch="exclude"&gt;'</span> C:\tools\*
C:\tools\Sysmon\sysmonconfig.xml:      
C:\tools\Sysmon\sysmonconfig.xml:</code></pre>
<p>有关 Windows sysmon 工具以及如何在端点中使用它的更多详细信息，我们建议尝试 TryHackMe 房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/sysmon">Sysmon</a>。</p>
<h2 id="基于主机的入侵检测预防系统hidships">基于主机的入侵检测/预防系统（HIDS/HIPS）</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857054.png" alt="image-20240716171158973"></p>
<p>HIDS 代表基于主机的入侵检测系统。它是能够监视和检测主机中的异常和恶意活动的软件。 HIDS 的主要目的是检测可疑活动，而不是阻止它们。基于主机或网络的入侵检测系统有两种工作方式，包括：</p>
<ul>
<li>基于签名的 IDS - 它着眼于校验和和消息身份验证。</li>
<li>基于异常的 IDS 会查找意外活动，包括异常的带宽使用、协议和端口。</li>
</ul>
<p>基于主机的入侵防御系统 (HIPS) 可保护安装该系统的设备的操作系统活动。它是针对众所周知的攻击和异常行为的检测和预防解决方案。 HIPS 可以审核主机的日志文件、监控进程并保护系统资源。 HIPS结合了防病毒、行为分析、网络、应用防火墙等多种产品功能。</p>
<p>还有基于网络的 IDS/IPS，我们将在下一个任务中介绍。</p>
<h2 id="端点检测和响应-edr">端点检测和响应 (EDR)</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857056.png" alt="image-20240716171817493"></p>
<p>它也称为端点检测和威胁响应 (EDTR)。 EDR 是一种网络安全解决方案，可防御恶意软件和其他威胁。 EDR 可以查找恶意文件，监控端点、系统和网络事件，并将其记录在数据库中以供进一步分析、检测和调查。 EDR 是下一代防病毒软件，可实时检测主机上的恶意活动。</p>
<p>EDR 分析系统数据和行为以产生区域威胁，包括</p>
<ul>
<li>恶意软件，包括病毒、木马、广告软件、键盘记录程序</li>
<li>Exploit chains 漏洞利用链</li>
<li>Ransomware 勒索软件</li>
</ul>
<p>以下是一些常见的端点 EDR 软件</p>
<ul>
<li>Cylance</li>
<li>Crowdstrike</li>
<li>Symantec</li>
<li>SentinelOne</li>
<li>Many others</li>
</ul>
<p>尽管攻击者成功交付了有效负载并在接收反向 shell 时绕过了 EDR，但 EDR 仍在运行并监视系统。如果它标记了警报，它可能会阻止我们做其他事情。</p>
<p>我们可以使用脚本来枚举机器内的安全产品，例如<a target="_blank" rel="noopener" href="https://github.com/PwnDexter/Invoke-EDRChecker">Invoke-EDRChecker</a>和<a target="_blank" rel="noopener" href="https://github.com/PwnDexter/SharpEDRChecker">SharpEDRChecker</a>。它们通过检查文件元数据、进程、加载到当前进程中的 DLL、服务以及驱动程序、目录来检查常用的防病毒、EDR、日志监控产品。</p>
<h1 id="0x08-网络安全解决方案">0x08 网络安全解决方案</h1>
<p>本任务将讨论企业网络中常见和使用的网络安全解决方案。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857057.png" alt="image-20240716172348954"></p>
<p>网络安全解决方案可以是用于监视、检测和防止网络内恶意活动的软件或硬件设备。它专注于保护连接到合作网络的客户端和设备。网络安全解决方案包括但不限于：</p>
<ul>
<li>Network Firewall</li>
<li>SIEM</li>
<li>IDS/IPS</li>
</ul>
<h2 id="网络防火墙">网络防火墙</h2>
<p>防火墙是到达网络的不受信任流量的第一个检查点。防火墙根据规则和策略将不受信任的流量过滤到网络中。此外，防火墙还可用于将网络与外部流量源、内部流量源甚至特定应用程序隔离。如今，防火墙产品是内置网络路由器或其他提供各种安全功能的安全产品。以下是企业可能使用的一些防火墙类型。</p>
<ul>
<li>Packet-filtering firewalls 包过滤防火墙</li>
<li>Proxy firewalls 代理防火墙</li>
<li>NAT firewalls  网络地址转换防火墙</li>
<li>Web application firewalls Web 应用程序防火墙</li>
</ul>
<h2 id="安全信息和事件管理-siem">安全信息和事件管理 (SIEM)</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857058.png" alt="image-20240716172631638"></p>
<p>SIEM 结合了安全信息管理 (SIM) 和安全事件管理 (SEM)，可以实时监控和分析事件并跟踪和记录数据。 SIEM 帮助系统管理员和蓝队成员在对组织造成损害之前监控和跟踪潜在的安全威胁和漏洞。</p>
<p>SIEM solutions work as log data aggregation center, where it collects log files from sensors and perform functions on the gathered data to identify and detect security threats or attacks. The following are some of the functions that a SIEM may offer:<br>
SIEM 解决方案充当日志数据聚合中心，从传感器收集日志文件并对收集的数据执行功能以识别和检测安全威胁或攻击。以下是 SIEM 可能提供的一些功能：</p>
<ul>
<li>日志管理：实时捕获和收集整个企业网络的数据。</li>
<li>事件分析：它应用高级分析来检测异常模式或行为，仪表板中提供图表和统计数据。</li>
<li>事件监控和安全警报：它监控整个网络，包括连接的用户、设备、应用程序等，一旦检测到攻击，它就会立即提醒管理员采取适当的措施来缓解。</li>
<li>合规管理和报告：随时生成实时报告。</li>
</ul>
<p>SIEM能够利用集成的威胁情报和人工智能技术来检测高级和未知威胁，包括内部威胁、安全漏洞、网络钓鱼攻击、Web攻击、DDoS攻击、数据泄露等。</p>
<p>以下是很多企业中常见的一些SIEM产品：</p>
<ul>
<li>Splunk</li>
<li>LogRhythm NextGen SIEM Platform</li>
<li>SolarWinds Security Event Manager</li>
<li>Datadog Security Monitoring</li>
<li>many others</li>
</ul>
<h2 id="入侵检测系统和入侵防御系统nidsnips">入侵检测系统和入侵防御系统（NIDS/NIPS）</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857059.png" alt="image-20240716173011222"></p>
<p>基于网络的 IDS/IPS 与基于主机的 IDS/IPS 具有相似的概念。主要区别在于基于网络的产品关注网络的安全而不是主机的安全。基于网络的解决方案将基于分布在网络设备和主机中的传感器和代理来收集数据。 IDS 和 IPS 都是企业用来保护其内部系统的检测和监控网络安全解决方案。它们都读取网络数据包，寻找异常行为和预加载到先前数据库中的已知威胁。两种解决方案之间的显着区别在于 IDS 需要人工交互或第三方软件来分析数据以采取行动。 IPS 是一种根据策略和规则接受或拒绝数据包的控制系统。</p>
<p>以下是常见的企业IDS/IPS产品</p>
<ul>
<li>Palo Alto Networks</li>
<li>Cisco’s Next-Generation</li>
<li>McAfee Network Security Platform (NSP)</li>
<li>Trend Micro TippingPoint</li>
<li>Suricata</li>
</ul>
<p>有关 IDS/IPS 的更多信息，请访问<a target="_blank" rel="noopener" href="https://geekflare.com/ids-vs-ips-network-security-solutions/">参考链接</a>。</p>
<h1 id="0x09-应用程序和服务">0x09 应用程序和服务</h1>
<p>这项任务将扩展我们更多地了解该系统所需的知识。我们在之前的任务中讨论了系统内的帐户发现和安全产品。我们将继续了解有关该系统的更多信息，包括：</p>
<ul>
<li>已安装的应用程序</li>
<li>服务和进程</li>
<li>共享文件和打印机</li>
<li>内部服务：DNS 和本地 Web 应用程序</li>
</ul>
<p>为了从信息中获益，有必要了解系统提供的内容。</p>
<h2 id="已安装的应用程序">已安装的应用程序</h2>
<p>首先，我们通过检查应用程序的名称和版本开始枚举系统中已安装的应用程序。作为红队成员，这些信息将使我们受益。我们可能会发现安装了易受攻击的软件来利用和升级我们的系统权限。此外，我们可能会发现一些信息（例如纯文本凭据）留在属于其他系统或服务的系统上。</p>
<p>我们将使用 wmic Windows 命令列出所有已安装的应用程序及其版本。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; wmic product get name,version
Name                                                            Version
Microsoft Visual C++ <span class="hljs-number">2019</span> X64 Minimum Runtime - <span class="hljs-number">14.28</span>.<span class="hljs-number">29910</span>     <span class="hljs-number">14.28</span>.<span class="hljs-number">29910</span>
AWS Tools for Windows                                           <span class="hljs-number">3.15</span>.<span class="hljs-number">1248</span>
Amazon SSM Agent                                                <span class="hljs-number">3.0</span>.<span class="hljs-number">529.0</span>
aws-cfn-bootstrap                                               <span class="hljs-number">2.0</span>.<span class="hljs-number">5</span>
AWS PV Drivers                                                  <span class="hljs-number">8.3</span>.<span class="hljs-number">4</span>
Microsoft Visual C++ <span class="hljs-number">2019</span> X64 Additional Runtime - <span class="hljs-number">14.28</span>.<span class="hljs-number">29910</span>  <span class="hljs-number">14.28</span>.<span class="hljs-number">29910</span></code></pre>
<p>另一件有趣的事情是寻找特定的文本字符串、隐藏目录、备份文件。然后我们可以使用 PowerShell cmdlet Get-ChildItem，如下所示：</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-ChildItem -Hidden -Path C:\Users\kkidd\Desktop\</code></pre>
<h2 id="服务和进程">服务和进程</h2>
<p>Windows 服务使系统管理员能够在我们自己的 Windows 会话中创建长时间运行的可执行应用程序。有时，Windows 服务的权限配置错误，这会提升当前用户的权限访问级别。因此，我们必须查看正在运行的服务并执行服务和进程侦察。有关更多详细信息，您可以阅读 <a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1057/">Attack MITRE</a> 上有关进程发现的内容。</p>
<p>进程发现是了解系统提供的内容的枚举步骤。红队应该获取有关在系统上运行服务和进程的信息和详细信息。我们需要尽可能多地了解我们的目标。这些信息可以帮助我们了解网络中其他系统上运行的常见软件。例如，受感染的系统可能有一个用于内部目的的自定义客户端应用程序。定制内部开发的软件是升级向量的最常见根本原因。因此，值得进一步挖掘以获取有关当前流程的详细信息。</p>
<p>有关从蓝队角度了解核心 Windows 进程的更多详细信息，请查看 TryHackMe 房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/btwindowsinternals">核心 Windows 进程</a>。</p>
<h2 id="共享文件和打印机">共享文件和打印机</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857060.png" alt="image-20240716173826889"></p>
<p>共享文件和网络资源通常用于个人和企业环境。系统管理员错误配置访问权限，他们可能拥有有关其他帐户和系统的有用信息。有关打印机黑客攻击的更多信息，我们建议尝试以下 TryHackMe 房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/printerhacking101">打印机黑客攻击 101</a>。</p>
<h2 id="内部服务dns-本地web应用程序等">内部服务：DNS、本地Web应用程序等</h2>
<p>内部网络服务是扩展我们对其他系统和整个环境的了解的另一个信息来源。要获取有关用于外部和内部网络服务的网络服务的更多详细信息，我们建议尝试以下房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/networkservices">网络服务</a>、<a target="_blank" rel="noopener" href="https://tryhackme.com/room/networkservices2">网络服务2</a>。</p>
<p>以下是我们感兴趣的一些常用的内部服务：</p>
<ul>
<li>DNS Services 域名解析服务</li>
<li>Email Services 电子邮件服务</li>
<li>Network File Share 网络文件共享</li>
<li>Web application Web应用程序</li>
<li>Database service 数据库服务</li>
</ul>
<h2 id="回答问题">回答问题</h2>
<p>让我们尝试使用 Windows 命令提示符 net start 列出正在运行的服务，以检查是否有任何有趣的正在运行的服务。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; net start
These Windows services are started:

Active Directory Web Services
Amazon SSM Agent
Application Host Helper Service
Cryptographic Services
DCOM Server Process Launcher
DFS Namespace
DFS Replication
DHCP Client
Diagnostic Policy Service
THM Demo
DNS Client</code></pre>
<p>我们可以看到一个名为 THM Demo 的服务，我们想了解更多信息。</p>
<p>现在让我们查找确切的服务名称，我们需要它来查找更多信息。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; wmic service where <span class="hljs-string">"name like 'THM Demo'"</span> get Name,PathName
Name         PathName
THM Service  c:\Windows\thm-demo.exe</code></pre>
<p>我们找到文件名及其路径；现在让我们使用 Get-Process cmdlet 查找更多详细信息。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-Process -Name thm-demo

Handles  <span class="hljs-built_in">NPM</span>(K)    <span class="hljs-built_in">PM</span>(K)      <span class="hljs-built_in">WS</span>(K)     <span class="hljs-built_in">CPU</span>(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
     <span class="hljs-number">82</span>       <span class="hljs-number">9</span>    <span class="hljs-number">13128</span>       <span class="hljs-number">6200</span>              <span class="hljs-number">3212</span>   <span class="hljs-number">0</span> thm-service</code></pre>
<p>一旦我们找到了它的进程ID，我们就可以通过列出系统内的监听端口来检查是否提供网络服务。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; netstat -noa |findstr <span class="hljs-string">"LISTENING"</span> |findstr <span class="hljs-string">"3212"</span>
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8080</span>          <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING       <span class="hljs-number">3212</span>
  TCP    [::]:<span class="hljs-number">8080</span>             [::]:<span class="hljs-number">0</span>                 LISTENING       <span class="hljs-number">3212</span></code></pre>
<p>最后，我们可以看到它正在侦听端口 8080。现在尝试应用我们讨论的内容并找到 THM Service的端口号。端口号是多少？</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857061.png" alt="image-20240716174318363"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857062.png" alt="image-20240716174356448"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857063.png" alt="image-20240716174452253"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857064.png" alt="image-20240716174531880"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857065.png" alt="image-20240716174550354"></p>
<p>我们提到，DNS 服务是任何 Active Directory 环境和网络中常用的协议。附属机器为AD提供DNS服务。让我们通过执行区域传输 DNS 来枚举 DNS，看看是否可以列出所有记录。</p>
<p>我们将使用 Microsoft 工具 nslookup.exe 执行 DNS 区域传输.</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; nslookup.exe
Default Server:  UnKnown
Address:  ::<span class="hljs-number">1</span></code></pre>
<p>一旦我们执行它，我们就会提供我们需要询问的 DNS 服务器，在本例中是目标计算机</p>
<pre><code class="hljs scss">&gt; server <span class="hljs-number">10.10</span><span class="hljs-selector-class">.229</span><span class="hljs-selector-class">.29</span>
Default Server:  [<span class="hljs-number">10.10</span>.<span class="hljs-number">229.29</span>]
Address:  <span class="hljs-number">10.10</span>.<span class="hljs-number">229.29</span></code></pre>
<p>现在让我们在 AD 环境中找到的域上尝试 DNS 区域传输。</p>
<pre><code class="hljs scss">&gt; ls -d thmredteam<span class="hljs-selector-class">.com</span>
<span class="hljs-selector-attr">[[10.10.229.29]</span>]
 thmredteam<span class="hljs-selector-class">.com</span>.                SOA    ad<span class="hljs-selector-class">.thmredteam</span><span class="hljs-selector-class">.com</span> hostmaster<span class="hljs-selector-class">.thmredteam</span><span class="hljs-selector-class">.com</span>. (<span class="hljs-number">732</span> <span class="hljs-number">900</span> <span class="hljs-number">600</span> <span class="hljs-number">86400</span> <span class="hljs-number">3600</span>)
 thmredteam<span class="hljs-selector-class">.com</span>.                <span class="hljs-selector-tag">A</span>      <span class="hljs-number">10.10</span><span class="hljs-selector-class">.229</span><span class="hljs-selector-class">.29</span>
 thmredteam<span class="hljs-selector-class">.com</span>.                NS     ad<span class="hljs-selector-class">.thmredteam</span><span class="hljs-selector-class">.com</span>
***
 ad                             <span class="hljs-selector-tag">A</span>      <span class="hljs-number">10.10</span><span class="hljs-selector-class">.229</span><span class="hljs-selector-class">.29</span></code></pre>
<p>前面的输出是成功执行 DNS 区域传输的示例。</p>
<p>现在，使用 nslookup.exe 枚举域控制器 <a target="_blank" rel="noopener" href="http://thmredteam.com">thmredteam.com</a> 的域名，并执行 DNS 区域传输。其中一条记录的标志是什么？</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857066.png" alt="image-20240716174848877"></p>
<p>这个房间介绍企业环境中的客户端系统。学生应该更好地了解如何在企业网络中使用客户端，包括：</p>
<ul>
<li>Network Infrastructure 网络基础设施</li>
<li>AD environment AD环境</li>
<li>security measures (HIPS, AV, etc.) 安全措施（HIPS、AV 等）</li>
<li>Internal applications and services 内部应用程序和服务</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2024/07/16/thm-dang-qian-tai-shi/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2024/07/16/thm-dang-qian-tai-shi/')">THM-当前态势</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2024/07/16/thm-dang-qian-tai-shi/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=THM-当前态势&amp;url=http://hybcx.xyz/2024/07/16/thm-dang-qian-tai-shi/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/TryHackMe/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>TryHackMe<span class="tagsPageCount">42</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/14/thm-password-gong-ji/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">THM-password攻击</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/16/thm-enumeration/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">THM-Enumeration</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/08/08/thm-bypass-uac/" title="THM-ByPass_UAC"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-08-08</div><div class="title">THM-ByPass_UAC</div></div></a></div><div><a href="/2024/02/14/thm-basic-pentesting/" title="THM-Basic Pentesting"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-14</div><div class="title">THM-Basic Pentesting</div></div></a></div><div><a href="/2024/07/10/thm-c2-jian-jie/" title="THM-C2简介"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-10</div><div class="title">THM-C2简介</div></div></a></div><div><a href="/2024/06/17/thm-corp/" title="THM-Corp"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-17</div><div class="title">THM-Corp</div></div></a></div><div><a href="/2024/06/09/thm-enumerating-active-directory/" title="THM-Enumerating Active Directory"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-09</div><div class="title">THM-Enumerating Active Directory</div></div></a></div><div><a href="/2024/07/16/thm-enumeration/" title="THM-Enumeration"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-16</div><div class="title">THM-Enumeration</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">0x01 介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E9%83%A8%E7%BD%B2%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">2.</span> <span class="toc-text">0x02 部署虚拟机</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD"><span class="toc-number">3.</span> <span class="toc-text">0x03 网络基础设施</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91"><span class="toc-number">3.1.</span> <span class="toc-text">内网</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E5%86%9B%E4%BA%8B%E5%8C%BA-dmz"><span class="toc-number">3.2.</span> <span class="toc-text">非军事区 (DMZ)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%9E%9A%E4%B8%BE"><span class="toc-number">3.3.</span> <span class="toc-text">网络枚举</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.4.</span> <span class="toc-text">内网服务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-ad%E7%8E%AF%E5%A2%83"><span class="toc-number">4.</span> <span class="toc-text">0x04 AD环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFad%E7%8E%AF%E5%A2%83"><span class="toc-number">4.1.</span> <span class="toc-text">什么是AD环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E7%AD%94%E9%97%AE%E9%A2%98"><span class="toc-number">4.2.</span> <span class="toc-text">回答问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">0x05 用户和组管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95-ad-%E6%9E%9A%E4%B8%BE"><span class="toc-number">5.1.</span> <span class="toc-text">活动目录 (AD) 枚举</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E4%B8%BB%E6%9C%BA%E5%AE%89%E5%85%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%881"><span class="toc-number">6.</span> <span class="toc-text">0x06 主机安全解决方案#1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%AE%89%E5%85%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">6.1.</span> <span class="toc-text">主机安全解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E7%97%85%E6%AF%92%E8%BD%AF%E4%BB%B6-av"><span class="toc-number">6.2.</span> <span class="toc-text">防病毒软件 (AV)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#microsoft-windows-defender"><span class="toc-number">6.3.</span> <span class="toc-text">Microsoft Windows Defender</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E7%AD%94%E9%97%AE%E9%A2%98"><span class="toc-number">6.4.</span> <span class="toc-text">回答问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-%E4%B8%BB%E6%9C%BA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%882"><span class="toc-number">7.</span> <span class="toc-text">0x07 主机解决方案#2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E4%BA%8B%E4%BB%B6%E8%AE%B0%E5%BD%95%E5%92%8C%E7%9B%91%E6%8E%A7"><span class="toc-number">7.1.</span> <span class="toc-text">安全事件记录和监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%9B%91%E8%A7%86%E5%99%A8sysmon"><span class="toc-number">7.2.</span> <span class="toc-text">系统监视器（Sysmon）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%B8%BB%E6%9C%BA%E7%9A%84%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E9%A2%84%E9%98%B2%E7%B3%BB%E7%BB%9Fhidships"><span class="toc-number">7.3.</span> <span class="toc-text">基于主机的入侵检测&#x2F;预防系统（HIDS&#x2F;HIPS）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E7%82%B9%E6%A3%80%E6%B5%8B%E5%92%8C%E5%93%8D%E5%BA%94-edr"><span class="toc-number">7.4.</span> <span class="toc-text">端点检测和响应 (EDR)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">8.</span> <span class="toc-text">0x08 网络安全解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">8.1.</span> <span class="toc-text">网络防火墙</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E4%BF%A1%E6%81%AF%E5%92%8C%E4%BA%8B%E4%BB%B6%E7%AE%A1%E7%90%86-siem"><span class="toc-number">8.2.</span> <span class="toc-text">安全信息和事件管理 (SIEM)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F%E5%92%8C%E5%85%A5%E4%BE%B5%E9%98%B2%E5%BE%A1%E7%B3%BB%E7%BB%9Fnidsnips"><span class="toc-number">8.3.</span> <span class="toc-text">入侵检测系统和入侵防御系统（NIDS&#x2F;NIPS）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%92%8C%E6%9C%8D%E5%8A%A1"><span class="toc-number">9.</span> <span class="toc-text">0x09 应用程序和服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%B2%E5%AE%89%E8%A3%85%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">9.1.</span> <span class="toc-text">已安装的应用程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%92%8C%E8%BF%9B%E7%A8%8B"><span class="toc-number">9.2.</span> <span class="toc-text">服务和进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%92%8C%E6%89%93%E5%8D%B0%E6%9C%BA"><span class="toc-number">9.3.</span> <span class="toc-text">共享文件和打印机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E6%9C%8D%E5%8A%A1dns-%E6%9C%AC%E5%9C%B0web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%AD%89"><span class="toc-number">9.4.</span> <span class="toc-text">内部服务：DNS、本地Web应用程序等</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E7%AD%94%E9%97%AE%E9%A2%98"><span class="toc-number">9.5.</span> <span class="toc-text">回答问题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>