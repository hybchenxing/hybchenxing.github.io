
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>THM-当前态势 - hybcx's blog</title>

  
    <meta name="description" content="了解并实践企业环境中使用的常见技术和安全产品；涵盖了基于主机和网络的安全解决方案。 0x01 介绍 熟悉在红队参与期间首次访问受感染计算机的环境至关重要。因此，进行侦察和清点是重要的一环，首要目标是收集尽可能多的信息以供下一阶段使用。 建立了最初的立足点后，后渗透过程就开始了！ 这个房间介绍了我们需要了解的常用概念、技术和安全产品。 在这个房间里，假设我们已经获得了对机器的访问权限，并且我们准备通">
<meta property="og:type" content="article">
<meta property="og:title" content="THM-当前态势">
<meta property="og:url" content="http://hybcx.xyz/2024/07/16/thm-dang-qian-tai-shi/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="了解并实践企业环境中使用的常见技术和安全产品；涵盖了基于主机和网络的安全解决方案。 0x01 介绍 熟悉在红队参与期间首次访问受感染计算机的环境至关重要。因此，进行侦察和清点是重要的一环，首要目标是收集尽可能多的信息以供下一阶段使用。 建立了最初的立足点后，后渗透过程就开始了！ 这个房间介绍了我们需要了解的常用概念、技术和安全产品。 在这个房间里，假设我们已经获得了对机器的访问权限，并且我们准备通">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857035.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857036.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857037.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857038.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857039.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857040.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857041.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857042.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857043.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857044.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857045.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857046.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857047.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857048.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857049.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857050.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857051.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857052.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857053.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857054.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857056.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857057.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857058.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857059.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857060.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857061.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857062.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857063.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857064.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857065.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857066.png">
<meta property="article:published_time" content="2024-07-16T07:22:22.000Z">
<meta property="article:modified_time" content="2024-07-22T11:48:03.341Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="tryhackme">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857035.png">
  
  
  
  <meta name="keywords" content="tryhackme">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/07/25/thm-windows-api-jie-shao/"><span class="title">THM-Windows-API介绍</span></a><a class="item title" href="/2024/07/24/thm-windows-nei-he/"><span class="title">THM-Windows内核</span></a><a class="item title" href="/2024/07/20/thm-shu-ju-xie-lu/"><span class="title">THM-数据泄露</span></a><a class="item title" href="/2024/07/21/linux-ti-quan-zong-jie/"><span class="title">Linux提权总结</span></a><a class="item title" href="/2024/07/16/thm-enumeration/"><span class="title">THM-Enumeration</span></a><a class="item title" href="/2024/07/16/thm-dang-qian-tai-shi/"><span class="title">THM-当前态势</span></a><a class="item title" href="/2024/02/10/thm-linux-quan-xian-ti-sheng/"><span class="title">THM-Linux权限提升</span></a><a class="item title" href="/2024/02/14/thm-basic-pentesting/"><span class="title">THM-Basic Pentesting</span></a><a class="item title" href="/2024/07/20/linux-ti-quan-xue-xi-yi/"><span class="title">Linux提权学习之rbash逃逸</span></a><a class="item title" href="/2023/08/07/qian-xi-mu-lu-chuan-yue/"><span class="title">浅析目录穿越</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/tryhackme/">tryhackme</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-07-16T07:22:22.000Z">2024-07-16</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-07-22T11:48:03.341Z">2024-07-22</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>THM-当前态势</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><p>了解并实践企业环境中使用的常见技术和安全产品；涵盖了基于主机和网络的安全解决方案。</p>
<h1 id="0x01-介绍">0x01 介绍</h1>
<p>熟悉在红队参与期间首次访问受感染计算机的环境至关重要。因此，进行侦察和清点是重要的一环，首要目标是收集尽可能多的信息以供下一阶段使用。</p>
<p>建立了最初的立足点后，后渗透过程就开始了！</p>
<p>这个房间介绍了我们需要了解的常用概念、技术和安全产品。</p>
<p>在这个房间里，假设我们已经获得了对机器的访问权限，并且我们准备通过执行以下枚举来扩展我们对环境的更多了解：</p>
<ul>
<li>网络基础设施</li>
<li>活动目录环境</li>
<li>用户和组</li>
<li>基于主机的安全解决方案</li>
<li>基于网络的安全解决方案</li>
<li>应用程序和服务</li>
</ul>
<h1 id="0x02-部署虚拟机">0x02 部署虚拟机</h1>
<p>为了遵循任务内容并应用此房间中提供的内容，您需要使用此任务中的绿色启动计算机按钮启动连接的计算机，并等待几分钟以使其启动。要访问连接的计算机，您可以使用浏览器视图中的拆分或通过 RDP 连接。</p>
<p>如果您更喜欢通过 RDP 连接，请确保部署 AttackBox 或连接到 VPN.</p>
<p>使用以下凭据：kkidd:Pass123321@</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ xfreerdp /<span class="hljs-attribute">v</span>:MACHINE_IP /<span class="hljs-attribute">u</span>:kkidd</code></pre>
<h1 id="0x03-网络基础设施">0x03 网络基础设施</h1>
<p>一旦到达未知网络，我们的首要目标是确定我们在哪里以及我们可以到达什么。在红队参与过程中，我们需要了解我们正在处理什么目标系统，该机器提供什么服务，我们处于什么样的网络中。因此，在获得初始访问权限后对受感染机器的枚举是回答这些问题的关键问题。此任务将讨论我们在参与过程中可能遇到的常见网络类型。</p>
<p>网络分段是网络安全的额外层，分为多个子网。它用于提高网络的安全性和管理。例如，它用于防止未经授权访问公司最有价值的资产，例如客户数据、财务记录等。</p>
<p>虚拟局域网 (VLAN) 是一种用于网络分段的网络技术，用于控制网络问题（例如本地网络中的广播问题）并提高安全性。 VLAN内的主机只能与同一VLAN网络内的其他主机进行通信。</p>
<p>如果您想了解有关网络基础知识的更多信息，我们建议尝试以下 TryHackMe 模块：<a target="_blank" rel="noopener" href="https://tryhackme.com/module/network-fundamentals">网络基础知识</a>.</p>
<h2 id="内网">内网</h2>
<p>内部网络是根据内部设备的重要性或其数据可访问性的重要性进行分段和分离的子网。内部网络的主要目的是在组织内共享信息、更快、更轻松的通信、协作工具、操作系统和网络服务。在企业网络中，网络管理员出于各种原因打算使用网络分段，包括控制网络流量、优化网络性能和改善安全状况。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857035.png" alt="image-20240716153711591"></p>
<p>上图是网络分段的简单概念的示例，因为网络被分为两个网络。第一个用于员工工作站和个人设备。第二个是针对提供内部服务（例如 DNS、内部 Web、电子邮件服务等）的私有和内部网络设备。</p>
<h2 id="非军事区-dmz">非军事区 (DMZ)</h2>
<p>DMZ 网络是一种边缘网络，可保护公司内部局域网并为其添加额外的安全层，使其免受不可信流量的影响。 DMZ 的常见设计是位于公共互联网和内部网络之间的子网。</p>
<p>公司内部网络的设计取决于其要求和需求。例如，假设一家公司提供网站、DNS、FTP、Proxy、VPN等公共服务，那么他们可能会设计一个DMZ网络来隔离和启用对公网流量、不可信流量的访问控制。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857036.png" alt="image-20240716154053609"></p>
<p>在上图中，我们用红色表示 DMZ 网络的网络流量，该网络流量不受信任（直接来自互联网）。内部网络之间的绿色网络流量是可以经过一台或多台网络安全设备的受控流量。</p>
<p>枚举系统和内部网络是发现阶段，这使得攻击者能够了解系统和内部网络。根据获得的信息，我们用它来处理横向移动或权限升级，以获得系统或 AD 环境的更多权限。</p>
<h2 id="网络枚举">网络枚举</h2>
<p>有许多与网络方面相关的内容需要检查，例如 TCP 和 UDP 端口以及已建立的连接、路由表、ARP 表等。</p>
<p>让我们开始检查目标机器的 TCP 和 UDP 开放端口。这可以使用 netstat 命令来完成，如下所示。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; netstat -na

Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">80</span>             <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">88</span>             <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">135</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">389</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING</code></pre>
<p>输出显示打开的端口以及已建立的连接。接下来，我们列出 ARP 表，其中包含与网络内目标计算机通信的计算机的 IP 地址和物理地址。这有助于查看网络内的通信以扫描其他计算机的开放端口和漏洞。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857037.png" alt="image-20240716155533192"></p>
<h2 id="内网服务">内网服务</h2>
<p>它为内部网络设备提供私有和内部网络通信访问。网络服务的一个示例是内部 DNS、Web 服务器、自定义应用程序等。需要注意的是，内部网络服务无法在网络外部访问。但是，一旦我们初步访问了这些网络服务的网络之一，它们就可以访问并可用于通信。</p>
<p>我们将在任务 9 中讨论更多 Windows 应用程序和服务，包括 DNS 和自定义 Web 应用程序。</p>
<h1 id="0x04-ad环境">0x04 AD环境</h1>
<h2 id="什么是ad环境">什么是AD环境</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857038.png" alt="image-20240716155704264"></p>
<p>它是一种基于Windows的目录服务，用于存储并向内部网络环境提供数据对象。它允许集中管理身份验证和授权。 AD 包含有关网络和环境的基本信息，包括用户、计算机、打印机等。例如，AD 可能包含用户的详细信息，如职位、电话号码、地址、密码、组、权限等。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857039.png" alt="image-20240716155958074"></p>
<p>该图是 Active Directory 设计方式的一个可能示例。 AD 控制器放置在服务器子网中（如上所示的服务器网络），然后 AD 客户端位于单独的网络上，它们可以在其中加入域并通过防火墙使用 AD 服务。</p>
<p>以下是我们需要熟悉的Active Directory组件列表：</p>
<ul>
<li>Domain Controllers</li>
<li>Organizational Units 组织单位</li>
<li>AD objects</li>
<li>AD Domains</li>
<li>Forest</li>
<li>AD Service Accounts: Built-in local users, Domain users, Managed service accounts<br>
AD 服务帐户：内置本地用户、域用户、托管服务帐户</li>
<li>Domain Administrators</li>
</ul>
<p>域控制器是提供 Active Directory 服务并控制整个域的 Windows 服务器。它是一种集中式用户管理形式，提供用户数据加密以及控制对网络（包括用户、组、策略和计算机）的访问。它还支持资源访问和共享。这些都是攻击者针对域中的域控制器的原因，因为它包含大量高价值信息。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857040.png" alt="image-20240716160227405"></p>
<p>组织单位 (OU) 是 AD 域内具有分层结构的容器。</p>
<p>Active Directory 对象可以是单个用户或组，也可以是硬件组件，例如计算机或打印机。每个域都拥有一个数据库，其中包含创建 AD 环境的对象身份信息，包括：</p>
<ul>
<li>Users - 允许对域中的计算机进行身份验证的安全主体</li>
<li>Computers - 一种特殊类型的用户帐户</li>
<li>GPOs - 应用于其他 AD 对象的策略集合</li>
</ul>
<p>AD domains是 AD 网络中 Microsoft 组件的集合。</p>
<p>AD Forest是相互信任的域的集合。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857041.png" alt="image-20240716160519115"></p>
<p>有关 Active Directory 基础知识的更多信息，我们建议尝试以下 TryHackMe 空间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/winadbasics">Active Directory 基础知识</a>.</p>
<p>实现初始访问后，在企业网络中查找 AD 环境非常重要，因为 Active Directory 环境向加入的用户提供有关该环境的大量信息。作为红队成员，我们通过枚举 AD 环境并访问各种细节来利用这一点，然后将其用于横向移动阶段。</p>
<h2 id="回答问题">回答问题</h2>
<p>为了检查Windows机器是否是AD环境的一部分，一种方法是，我们可以使用命令提示符systeminfo命令。 systeminfo 的输出提供有关计算机的信息，包括操作系统名称和版本、主机名和其他硬件信息以及 AD 域。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; systeminfo | findstr Domain
OS Configuration:          Primary Domain Controller
Domain:                    thmdomain.com</code></pre>
<p>从上面的输出中，我们可以看到计算机名称是一个 AD，域名为 <a target="_blank" rel="noopener" href="http://thmdomain.com">thmdomain.com</a>，这证实它是 AD 环境的一部分。</p>
<p>请注意，如果我们在域部分中看到“WORKGROUP”，则表示该计算机是本地工作组的一部分。</p>
<p>在继续之前，请确保连接的计算机已部署并尝试我们讨论的内容。连接的机器是 AD 环境的一部分吗？ （是|否）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857042.png" alt="image-20240716161239476"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857043.png" alt="image-20240716161252926"></p>
<h1 id="0x05-用户和组管理">0x05 用户和组管理</h1>
<p>在此任务中，我们将了解有关用户和组的更多信息，特别是在 Active Directory 中。收集有关受感染机器的信息至关重要，可以在下一阶段使用。一旦我们获得了对受感染计算机的初始访问权限，以了解我们拥有什么以及系统中还有哪些其他帐户，帐户发现就是第一步。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857044.png" alt="image-20240716161339200"></p>
<p>Active Directory 环境包含各种帐户，这些帐户具有用于不同目的的必要权限、访问权限和角色。常见的 Active Directory 服务帐户包括内置本地用户帐户、域用户帐户、托管服务帐户和虚拟帐户。</p>
<ul>
<li>内置的本地用户帐户用于在本地管理系统，不属于 AD 环境的一部分。</li>
<li>有权访问 Active Directory 环境的域用户帐户可以使用 AD 服务（由 AD 管理）。</li>
<li>AD 托管服务帐户是有限的域用户帐户，具有更高的权限来管理 AD 服务。</li>
<li>域管理员是可以管理 Active Directory 环境中信息的用户帐户，包括 AD 配置、用户、组、权限、角色、服务等。红队参与的目标之一是寻找可找到域管理员的信息完全控制 AD 环境。</li>
</ul>
<p>以下是 Active Directory 管理员帐户：</p>
<table>
<thead>
<tr>
<th>BUILTIN\Administrator 内置\管理员</th>
<th>域控制器上的本地管理员访问权限</th>
</tr>
</thead>
<tbody>
<tr>
<td>Domain Admins 域管理员</td>
<td>对域中所有资源的管理访问权限</td>
</tr>
<tr>
<td>Enterprise Admins 企业管理员</td>
<td>仅在林根中可用</td>
</tr>
<tr>
<td>Schema Admins 架构管理员</td>
<td>能够修改域/林；对红队队员有用</td>
</tr>
<tr>
<td>Server Operators 服务器运营商</td>
<td>可以管理域服务器</td>
</tr>
<tr>
<td>Account Operators 账户运营商</td>
<td>可以管理不属于特权组的用户</td>
</tr>
</tbody>
</table>
<p>现在我们了解了 AD 环境中的各种帐户类型。让我们列举一下在初始访问阶段我们可以访问的 Windows 机器。作为当前用户，我们拥有查看或管理计算机和 AD 环境中的内容的特定权限。</p>
<h2 id="活动目录-ad-枚举">活动目录 (AD) 枚举</h2>
<p>现在，AD 环境中的枚举需要不同的工具和技术。一旦我们确认机器是 AD 环境的一部分，我们就可以开始寻找稍后可能使用的任何变量信息。在此阶段，我们使用 PowerShell 枚举用户和组。</p>
<p>以下 PowerShell 命令用于获取所有 Active Directory 用户帐户。请注意，我们需要使用 -Filter 参数。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-ADUser  -Filter *
DistinguishedName : CN=Administrator,CN=Users,DC=thmredteam,DC=com
Enabled           : True
GivenName         :
Name              : Administrator
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">4094</span>d220-fb71-<span class="hljs-number">4</span>de1-b5b2-ba18f6583c65
SamAccountName    : Administrator
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">500</span>
Surname           :
UserPrincipalName :
PS C:\Users\thm&gt;</code></pre>
<p>我们还可以使用 <a target="_blank" rel="noopener" href="http://www.ietf.org/rfc/rfc2253.txt">LDAP 层次树结构</a>来查找 AD 环境中的用户。可分辨名称 (DN) 是逗号分隔的键和值对的集合，用于标识目录中的唯一记录。 DN 由域组件 (DC)、组织单元名称 (OU)、通用名称 (CN) 等组成。以下“CN=User1,CN=Users,DC=thmredteam,DC=com”是 DN 的示例，可以如下可视化：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857045.png" alt="image-20240716161858483"></p>
<p>使用 SearchBase 选项，我们在活动目录中指定一个特定的 Common-Name CN。例如，我们可以指定列出用户中该部分的任何用户.</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-ADUser -Filter * -SearchBase <span class="hljs-string">"CN=Users,DC=THMREDTEAM,DC=COM"</span>


DistinguishedName : CN=Administrator,CN=Users,DC=thmredteam,DC=com
Enabled           : True
GivenName         :
Name              : Administrator
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">4094</span>d220-fb71-<span class="hljs-number">4</span>de1-b5b2-ba18f6583c65
SamAccountName    : Administrator
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">500</span>
Surname           :
UserPrincipalName :</code></pre>
<p>请注意，结果可能包含多个用户，具体取决于 CN 的配置。尝试使用该命令查找 THM OU 中的所有用户并回答下面的问题 1。</p>
<pre><code class="hljs scss">PS C:\Users\kkidd&gt; Get-ADUser -Filter * -SearchBase <span class="hljs-string">"OU=THM,DC=THMREDTEAM,DC=COM"</span>


DistinguishedName : CN=Pierre Pittman,OU=THM,DC=thmredteam,DC=com
GivenName         : Pierre
Name              : Pierre Pittman
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">34</span>febcdd-<span class="hljs-number">49</span>dc-<span class="hljs-number">4160</span>-b88e-<span class="hljs-number">7</span>e6323f40dba
SamAccountName    : ppittman
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1113</span>
Surname           : Pittman
UserPrincipalName : ppittman@thmredteam.com

DistinguishedName : CN=Dario Philips,OU=THM,DC=thmredteam,DC=com
GivenName         : Dario
Name              : Dario Philips
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">3</span>cc9cfc7-<span class="hljs-number">3</span>c62-<span class="hljs-number">4</span>d46-<span class="hljs-number">8</span>a83-b8c02f45efbb
SamAccountName    : dphilips
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1114</span>
Surname           : Philips
UserPrincipalName : dphilips@thmredteam.com

DistinguishedName : CN=Weronika Burgess,OU=THM,DC=thmredteam,DC=com
GivenName         : Weronika
Name              : Weronika Burgess
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">88</span>e2935a-<span class="hljs-number">2</span>b50-<span class="hljs-number">4510</span>-<span class="hljs-number">816</span>d-<span class="hljs-number">8</span>eab5b06f548
SamAccountName    : wburgess
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1116</span>
Surname           : Burgess
UserPrincipalName : wburgess@thmredteam.com

DistinguishedName : CN=Cecil Solomon,OU=THM,DC=thmredteam,DC=com
GivenName         : Cecil
Name              : Cecil Solomon
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">88</span>ca7ae9-<span class="hljs-number">0</span>f03-<span class="hljs-number">4956</span>-<span class="hljs-number">8916</span>-b0cbd985520c
SamAccountName    : csolomon
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1120</span>
Surname           : Solomon
UserPrincipalName : csolomon@thmredteam.com

DistinguishedName : CN=Kevin Kidd,OU=THM,DC=thmredteam,DC=com
Enabled           : True
GivenName         : Kevin
Name              : Kevin Kidd
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">42353060</span>-b13d-<span class="hljs-number">48</span>b4-af2f-<span class="hljs-number">70543</span>e6ca8f8
SamAccountName    : kkidd
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1122</span>
Surname           : Kidd
UserPrincipalName : kkidd@thmredteam.com

DistinguishedName : CN=THM Admin,OU=THM,DC=thmredteam,DC=com
Enabled           : True
GivenName         : THM
Name              : THM Admin
ObjectClass       : user
ObjectGUID        : <span class="hljs-number">8974</span>cd3d-<span class="hljs-number">9</span>bf0-<span class="hljs-number">4</span>c43-ac7d-<span class="hljs-number">068413</span>fb462c
SamAccountName    : thmadmin
SID               : S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1966530601</span>-<span class="hljs-number">3185510712</span>-<span class="hljs-number">10604624</span>-<span class="hljs-number">1124</span>
Surname           : Admin
UserPrincipalName : thmadmin@thmredteam.com</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857046.png" alt="image-20240716163034175"></p>
<h1 id="0x06-主机安全解决方案1">0x06 主机安全解决方案#1</h1>
<p>在执行进一步操作之前，我们需要获得有关现有安全解决方案的一般知识。请记住，枚举端点上的防病毒和安全检测方法非常重要，以便尽可能不被发现并减少被发现的机会。</p>
<p>本任务将讨论企业网络中使用的常见安全解决方案，分为主机安全解决方案和网络安全解决方案。</p>
<h2 id="主机安全解决方案">主机安全解决方案</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857047.png" alt="image-20240716163330543"></p>
<p>它是一组用于监控和检测主机内异常和恶意活动的软件应用程序，包括：</p>
<ol>
<li>防毒软件</li>
<li>Microsoft Windows Defender</li>
<li>基于主机的防火墙</li>
<li>安全事件记录和监控</li>
<li>基于主机的入侵检测系统 (HIDS)/基于主机的入侵防御系统 (HIPS)</li>
<li>端点检测和响应 (EDR)</li>
</ol>
<p>让我们更详细地了解红队参与期间可能遇到的基于主机的安全解决方案。</p>
<h2 id="防病毒软件-av">防病毒软件 (AV)</h2>
<p>防病毒软件也称为反恶意软件，主要用于监控、检测和阻止恶意软件在主机内执行。大多数防病毒软件应用程序都使用众所周知的功能，包括后台扫描、完整系统扫描、病毒定义。在后台扫描中，防病毒软件实时工作并在后台扫描所有打开和使用的文件。首次安装防病毒软件时，完整的系统扫描至关重要。最有趣的部分是病毒定义，其中防病毒软件会回复预定义的病毒。这就是为什么防病毒软件需要不时更新的原因。</p>
<p>防病毒软件使用多种检测技术，包括</p>
<ul>
<li>基于签名的检测</li>
<li>Heuristic-based detection 基于启发式的检测</li>
<li>Behavior-based detection 基于行为的检测</li>
</ul>
<p>基于签名的检测是防病毒软件中用于识别恶意文件的常见传统技术之一。通常，研究人员或用户将受感染的文件提交到防病毒引擎平台中，以供 AV 供应商进一步分析，如果确认为恶意文件，则签名会在他们的数据库中注册。防病毒软件将扫描的文件与已知签名数据库进行比较，以发现客户端可能存在的攻击和恶意软件。如果我们有匹配，那么它就会认为是威胁。</p>
<p>基于启发式的检测使用机器学习来确定我们是否拥有恶意文件。它实时扫描和静态分析，以查找应用程序代码中的可疑属性或检查它是否使用不常见的 Windows 或系统 API。它在做出决策时不依赖于基于签名的攻击，或者有时依赖于基于签名的攻击。这取决于防病毒软件的实现。</p>
<p>最后，基于行为的检测依赖于监视和检查应用程序的执行，以发现异常行为和不常见的活动，例如创建/更新注册表项中的值、终止/创建进程等。</p>
<p>作为红队成员，了解防病毒软件是否存在至关重要。它阻止我们做我们想做的事情。我们可以使用Windows内置工具来枚举AV软件，例如wmic.</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; wmic /namespace:\\root\securitycenter2 path antivirusproduct</code></pre>
<p>这也可以使用 PowerShell 来完成，它会给出相同的结果。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-CimInstance -Namespace root/SecurityCenter2 -ClassName AntivirusProduct


displayName              : Bitdefender Antivirus
instanceGuid             : {BAF124F4-FA00-<span class="hljs-number">8560</span>-<span class="hljs-number">3</span>FDE-<span class="hljs-number">6</span>C380446AEFB}
pathToSignedProductExe   : C:\Program Files\Bitdefender\Bitdefender Security\wscfix.exe
pathToSignedReportingExe : C:\Program Files\Bitdefender\Bitdefender Security\bdservicehost.exe
productState             : <span class="hljs-number">266240</span>
timestamp                : Wed, <span class="hljs-number">15</span> Dec <span class="hljs-number">2021</span> <span class="hljs-number">12</span>:<span class="hljs-number">40</span>:<span class="hljs-number">10</span> GMT
PSComputerName           :

displayName              : Windows Defender
instanceGuid             : {D58FFC3A-<span class="hljs-number">813</span>B-<span class="hljs-number">4</span>fae-<span class="hljs-number">9</span>E44-DA132C9FAA36}
pathToSignedProductExe   : windowsdefender://
pathToSignedReportingExe : %ProgramFiles%\Windows Defender\MsMpeng.exe
productState             : <span class="hljs-number">393472</span>
timestamp                : Fri, <span class="hljs-number">15</span> Oct <span class="hljs-number">2021</span> <span class="hljs-number">22</span>:<span class="hljs-number">32</span>:<span class="hljs-number">01</span> GMT
PSComputerName           :</code></pre>
<p>因此，计算机上安装了第三方防病毒软件（Bitdefender Antivirus）和 Windows Defender。请注意，Windows 服务器可能没有 SecurityCenter2 命名空间，这可能无法在连接的 VM 上运行。相反，它适用于 Windows 工作站！</p>
<h2 id="microsoft-windows-defender">Microsoft Windows Defender</h2>
<p>Microsoft Windows Defender 是在端点上运行的预装防病毒安全工具。它在检测中使用各种算法，包括机器学习、大数据分析、深入的威胁抵抗研究以及微软云基础设施来防御恶意软件和病毒。 MS Defender 以三种保护模式工作：主动、被动、禁用模式。</p>
<p>主动模式用于 MS Defender 作为计算机上的主要防病毒软件运行，提供保护和修复。安装第三方防病毒软件后会运行被动模式。因此，它充当辅助防病毒软件，扫描文件并检测威胁，但不提供补救措施。最后，禁用模式是指 MS Defender 被禁用或从系统中卸载。</p>
<p>我们可以使用以下PowerShell命令来检查Windows Defender的服务状态：</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-Service WinDefend

Status   Name               DisplayName
------   ----               -----------
Running  WinDefend          Windows Defender Antivirus Service</code></pre>
<p>接下来，我们可以开始使用 Get-MpComputerStatus cmdlet 来获取当前的 Windows Defender 状态。但是，它提供了安全解决方案元素的当前状态，包括反间谍软件、防病毒、LoavProtection、实时保护等。我们可以使用 select 来指定我们需要的内容，如下所示，</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-MpComputerStatus | select RealTimeProtectionEnabled

RealTimeProtectionEnabled
-------------------------
                    False</code></pre>
<p>因此，MpComputerStatus 会突出显示 Windows Defender 是否已启用。</p>
<p>基于主机的防火墙：它是安装并运行在主机上的安全工具，可以防止和阻止攻击者或红队成员的攻击企图。因此，有必要枚举和收集有关我们最初访问的计算机中的防火墙及其规则的详细信息。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857048.png" alt="image-20240716164251328"></p>
<p>基于主机的防火墙的主要目的是控制通过设备接口的入站和出站流量。它保护主机免受同一网络上不受信任的设备的侵害。现代基于主机的防火墙在建立连接时使用多个级别的流量分析，包括数据包分析。</p>
<p>防火墙充当网络层的控制访问。它能够允许和拒绝网络数据包。例如，可以将防火墙配置为阻止同一网络中其他计算机通过 ping 命令发送的 ICMP 数据包。下一代防火墙还可以检查其他 OSI 层，例如应用程序层。因此，它可以检测并阻止SQL注入和其他应用层攻击。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-NetFirewallProfile | Format-Table Name, Enabled

Name    Enabled
----    -------
Domain     True
Private    True
Public     True</code></pre>
<p>如果我们对当前登录用户拥有管理员权限，那么我们会尝试使用 Set-NetFirewallProfile cmdlet 禁用一个或多个防火墙配置文件.</p>
<pre><code class="hljs scss">PS C:\Windows\system32&gt; Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled False
PS C:\Windows\system32&gt; Get-NetFirewallProfile | Format-Table Name, Enabled
---- -------
Domain False
Private False
Public False</code></pre>
<p>我们还可以了解并查看当前的防火墙规则，是否被防火墙允许或拒绝。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-NetFirewallRule | select DisplayName, Enabled, Description

DisplayName                                                                  Enabled
-----------                                                                  -------
Virtual Machine Monitoring (DCOM-In)                                           False
Virtual Machine Monitoring (Echo Request - ICMPv4-In)                          False
Virtual Machine Monitoring (Echo Request - ICMPv6-In)                          False
Virtual Machine Monitoring (NB-Session-In)                                     False
Virtual Machine Monitoring (RPC)                                               False
SNMP Trap Service (UDP In)                                                     False
SNMP Trap Service (UDP In)                                                     False
Connected User Experiences and Telemetry                                        True
Delivery Optimization (TCP-In)                                                  True</code></pre>
<p>在红队参与期间，我们不知道防火墙阻止了什么。但是，我们可以利用一些 PowerShell cmdlet，例如 Test-NetConnection 和 TcpClient。假设我们知道防火墙已经到位，并且我们需要在没有额外工具的情况下测试入站连接，那么我们可以执行以下操作：</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Test-NetConnection -ComputerName <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> -Port <span class="hljs-number">80</span>


ComputerName     : <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
RemoteAddress    : <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
RemotePort       : <span class="hljs-number">80</span>
InterfaceAlias   : Loopback Pseudo-Interface <span class="hljs-number">1</span>
SourceAddress    : <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
TcpTestSucceeded : True

PS C:\Users\thm&gt; (New-Object System.Net.Sockets.<span class="hljs-built_in">TcpClient</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-string">"80"</span>)).Connected
True</code></pre>
<p>因此，我们可以确认端口 80 上的入站连接已打开并在防火墙中被允许。请注意，我们还可以通过在 Test-NetConnection 的 -ComputerName 参数中指定来测试同一网络或域名中的远程目标。</p>
<h2 id="回答问题">回答问题</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857049.png" alt="image-20240716165442820"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857050.png" alt="image-20240716165648911"></p>
<pre><code class="hljs scss">PS C:\Users\kkidd&gt; Get-NetFirewallRule | findstr <span class="hljs-string">"THM-Connection"</span>                               DisplayName           : THM-Connection                                                           Description           : THM-Connection inbound to <span class="hljs-number">17337</span> Port!</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857051.png" alt="image-20240716165925050"></p>
<h1 id="0x07-主机解决方案2">0x07 主机解决方案#2</h1>
<p>在本次任务中，我们将继续讨论主机安全解决方案。</p>
<h2 id="安全事件记录和监控">安全事件记录和监控</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857052.png" alt="image-20240716165953255"></p>
<p>Windows 操作系统会在多个类别中记录事件信息，包括应用程序、系统、安全性、服务等。此外，安全设备和网络设备也会将事件信息存储到日志文件中，以便系统管理员了解系统的运行状况。</p>
<p>我们可以使用 Get-EventLog cmdlet 获取本地计算机上可用事件日志的列表。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-EventLog -List

  <span class="hljs-built_in">Max</span>(K) Retain OverflowAction        Entries Log
  ------ ------ --------------        ------- ---
     <span class="hljs-number">512</span>      <span class="hljs-number">7</span> OverwriteOlder             <span class="hljs-number">59</span> Active Directory Web Services
  <span class="hljs-number">20</span>,<span class="hljs-number">480</span>      <span class="hljs-number">0</span> OverwriteAsNeeded         <span class="hljs-number">512</span> Application
     <span class="hljs-number">512</span>      <span class="hljs-number">0</span> OverwriteAsNeeded         <span class="hljs-number">170</span> Directory Service
 <span class="hljs-number">102</span>,<span class="hljs-number">400</span>      <span class="hljs-number">0</span> OverwriteAsNeeded          <span class="hljs-number">67</span> DNS Server
  <span class="hljs-number">20</span>,<span class="hljs-number">480</span>      <span class="hljs-number">0</span> OverwriteAsNeeded       <span class="hljs-number">4</span>,<span class="hljs-number">345</span> System
  <span class="hljs-number">15</span>,<span class="hljs-number">360</span>      <span class="hljs-number">0</span> OverwriteAsNeeded       <span class="hljs-number">1</span>,<span class="hljs-number">692</span> Windows PowerShell</code></pre>
<p>有时，可用事件日志列表可以让您深入了解计算机上安装了哪些应用程序和服务！例如，我们可以看到本地计算机有 Active Directory、DNS 服务器等。有关 Get-EventLog cmdlet 的更多信息以及示例，请访问 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-eventlog?view=powershell-5.1">Microsoft 文档网站</a>。</p>
<p>在企业网络中，日志代理软件安装在客户端上，用于收集来自不同传感器的日志，以分析和监控网络内的活动。我们将在网络安全解决方案任务中详细讨论它们。</p>
<h2 id="系统监视器sysmon">系统监视器（Sysmon）</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857053.png" alt="image-20240716170648481"></p>
<p>sysmon 工具的一大特色是它可以记录许多重要事件，您还可以创建自己的规则和配置来监视：</p>
<ul>
<li>Process creation and termination 进程的创建和终止</li>
<li>Network connections 网络连接</li>
<li>Modification on file 对文件的修改</li>
<li>Remote threats 远程威胁</li>
<li>Process and memory access 进程和内存访问</li>
<li>and many others</li>
</ul>
<p>要了解有关 sysmon 的更多信息，请访问此处的 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">Windows 文档页面</a>。</p>
<p>作为红队成员，主要目标之一是保持不被发现，因此必须了解这些工具并避免导致生成和警报事件。以下是一些可用于检测 sysmon 在受害计算机中是否可用的技巧。</p>
<p>我们可以在当前进程或服务中查找名为“Sysmon”的进程或服务，如下所示，</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-Process | Where-Object { $_<span class="hljs-selector-class">.ProcessName</span> -eq "Sysmon" }

Handles  <span class="hljs-built_in">NPM</span>(K)    <span class="hljs-built_in">PM</span>(K)      <span class="hljs-built_in">WS</span>(K)     <span class="hljs-built_in">CPU</span>(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    <span class="hljs-number">373</span>      <span class="hljs-number">15</span>    <span class="hljs-number">20212</span>      <span class="hljs-number">31716</span>              <span class="hljs-number">3316</span>   <span class="hljs-number">0</span> Sysmon</code></pre>
<p>或寻找如下服务</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-CimInstance win32_service -Filter <span class="hljs-string">"Description = 'System Monitor service'"</span>
# or
Get-Service | where-object {$_<span class="hljs-selector-class">.DisplayName</span> -like "*sysm*"}</code></pre>
<p>也可以通过检查 Windows 注册表来完成</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Channels\Microsoft-Windows-Sysmon/Operational</code></pre>
<p>所有这些命令都会确认 sysmon 工具是否已安装。一旦我们检测到它，如果我们有可读权限，我们就可以尝试找到 sysmon 配置文件，以了解系统管理员正在监视什么。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; findstr /si <span class="hljs-string">'&lt;ProcessCreate onmatch="exclude"&gt;'</span> C:\tools\*
C:\tools\Sysmon\sysmonconfig.xml:      
C:\tools\Sysmon\sysmonconfig.xml:</code></pre>
<p>有关 Windows sysmon 工具以及如何在端点中使用它的更多详细信息，我们建议尝试 TryHackMe 房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/sysmon">Sysmon</a>。</p>
<h2 id="基于主机的入侵检测预防系统hidships">基于主机的入侵检测/预防系统（HIDS/HIPS）</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857054.png" alt="image-20240716171158973"></p>
<p>HIDS 代表基于主机的入侵检测系统。它是能够监视和检测主机中的异常和恶意活动的软件。 HIDS 的主要目的是检测可疑活动，而不是阻止它们。基于主机或网络的入侵检测系统有两种工作方式，包括：</p>
<ul>
<li>基于签名的 IDS - 它着眼于校验和和消息身份验证。</li>
<li>基于异常的 IDS 会查找意外活动，包括异常的带宽使用、协议和端口。</li>
</ul>
<p>基于主机的入侵防御系统 (HIPS) 可保护安装该系统的设备的操作系统活动。它是针对众所周知的攻击和异常行为的检测和预防解决方案。 HIPS 可以审核主机的日志文件、监控进程并保护系统资源。 HIPS结合了防病毒、行为分析、网络、应用防火墙等多种产品功能。</p>
<p>还有基于网络的 IDS/IPS，我们将在下一个任务中介绍。</p>
<h2 id="端点检测和响应-edr">端点检测和响应 (EDR)</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857056.png" alt="image-20240716171817493"></p>
<p>它也称为端点检测和威胁响应 (EDTR)。 EDR 是一种网络安全解决方案，可防御恶意软件和其他威胁。 EDR 可以查找恶意文件，监控端点、系统和网络事件，并将其记录在数据库中以供进一步分析、检测和调查。 EDR 是下一代防病毒软件，可实时检测主机上的恶意活动。</p>
<p>EDR 分析系统数据和行为以产生区域威胁，包括</p>
<ul>
<li>恶意软件，包括病毒、木马、广告软件、键盘记录程序</li>
<li>Exploit chains 漏洞利用链</li>
<li>Ransomware 勒索软件</li>
</ul>
<p>以下是一些常见的端点 EDR 软件</p>
<ul>
<li>Cylance</li>
<li>Crowdstrike</li>
<li>Symantec</li>
<li>SentinelOne</li>
<li>Many others</li>
</ul>
<p>尽管攻击者成功交付了有效负载并在接收反向 shell 时绕过了 EDR，但 EDR 仍在运行并监视系统。如果它标记了警报，它可能会阻止我们做其他事情。</p>
<p>我们可以使用脚本来枚举机器内的安全产品，例如<a target="_blank" rel="noopener" href="https://github.com/PwnDexter/Invoke-EDRChecker">Invoke-EDRChecker</a>和<a target="_blank" rel="noopener" href="https://github.com/PwnDexter/SharpEDRChecker">SharpEDRChecker</a>。它们通过检查文件元数据、进程、加载到当前进程中的 DLL、服务以及驱动程序、目录来检查常用的防病毒、EDR、日志监控产品。</p>
<h1 id="0x08-网络安全解决方案">0x08 网络安全解决方案</h1>
<p>本任务将讨论企业网络中常见和使用的网络安全解决方案。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857057.png" alt="image-20240716172348954"></p>
<p>网络安全解决方案可以是用于监视、检测和防止网络内恶意活动的软件或硬件设备。它专注于保护连接到合作网络的客户端和设备。网络安全解决方案包括但不限于：</p>
<ul>
<li>Network Firewall</li>
<li>SIEM</li>
<li>IDS/IPS</li>
</ul>
<h2 id="网络防火墙">网络防火墙</h2>
<p>防火墙是到达网络的不受信任流量的第一个检查点。防火墙根据规则和策略将不受信任的流量过滤到网络中。此外，防火墙还可用于将网络与外部流量源、内部流量源甚至特定应用程序隔离。如今，防火墙产品是内置网络路由器或其他提供各种安全功能的安全产品。以下是企业可能使用的一些防火墙类型。</p>
<ul>
<li>Packet-filtering firewalls 包过滤防火墙</li>
<li>Proxy firewalls 代理防火墙</li>
<li>NAT firewalls  网络地址转换防火墙</li>
<li>Web application firewalls Web 应用程序防火墙</li>
</ul>
<h2 id="安全信息和事件管理-siem">安全信息和事件管理 (SIEM)</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857058.png" alt="image-20240716172631638"></p>
<p>SIEM 结合了安全信息管理 (SIM) 和安全事件管理 (SEM)，可以实时监控和分析事件并跟踪和记录数据。 SIEM 帮助系统管理员和蓝队成员在对组织造成损害之前监控和跟踪潜在的安全威胁和漏洞。</p>
<p>SIEM solutions work as log data aggregation center, where it collects log files from sensors and perform functions on the gathered data to identify and detect security threats or attacks. The following are some of the functions that a SIEM may offer:<br>
SIEM 解决方案充当日志数据聚合中心，从传感器收集日志文件并对收集的数据执行功能以识别和检测安全威胁或攻击。以下是 SIEM 可能提供的一些功能：</p>
<ul>
<li>日志管理：实时捕获和收集整个企业网络的数据。</li>
<li>事件分析：它应用高级分析来检测异常模式或行为，仪表板中提供图表和统计数据。</li>
<li>事件监控和安全警报：它监控整个网络，包括连接的用户、设备、应用程序等，一旦检测到攻击，它就会立即提醒管理员采取适当的措施来缓解。</li>
<li>合规管理和报告：随时生成实时报告。</li>
</ul>
<p>SIEM能够利用集成的威胁情报和人工智能技术来检测高级和未知威胁，包括内部威胁、安全漏洞、网络钓鱼攻击、Web攻击、DDoS攻击、数据泄露等。</p>
<p>以下是很多企业中常见的一些SIEM产品：</p>
<ul>
<li>Splunk</li>
<li>LogRhythm NextGen SIEM Platform</li>
<li>SolarWinds Security Event Manager</li>
<li>Datadog Security Monitoring</li>
<li>many others</li>
</ul>
<h2 id="入侵检测系统和入侵防御系统nidsnips">入侵检测系统和入侵防御系统（NIDS/NIPS）</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857059.png" alt="image-20240716173011222"></p>
<p>基于网络的 IDS/IPS 与基于主机的 IDS/IPS 具有相似的概念。主要区别在于基于网络的产品关注网络的安全而不是主机的安全。基于网络的解决方案将基于分布在网络设备和主机中的传感器和代理来收集数据。 IDS 和 IPS 都是企业用来保护其内部系统的检测和监控网络安全解决方案。它们都读取网络数据包，寻找异常行为和预加载到先前数据库中的已知威胁。两种解决方案之间的显着区别在于 IDS 需要人工交互或第三方软件来分析数据以采取行动。 IPS 是一种根据策略和规则接受或拒绝数据包的控制系统。</p>
<p>以下是常见的企业IDS/IPS产品</p>
<ul>
<li>Palo Alto Networks</li>
<li>Cisco’s Next-Generation</li>
<li>McAfee Network Security Platform (NSP)</li>
<li>Trend Micro TippingPoint</li>
<li>Suricata</li>
</ul>
<p>有关 IDS/IPS 的更多信息，请访问<a target="_blank" rel="noopener" href="https://geekflare.com/ids-vs-ips-network-security-solutions/">参考链接</a>。</p>
<h1 id="0x09-应用程序和服务">0x09 应用程序和服务</h1>
<p>这项任务将扩展我们更多地了解该系统所需的知识。我们在之前的任务中讨论了系统内的帐户发现和安全产品。我们将继续了解有关该系统的更多信息，包括：</p>
<ul>
<li>已安装的应用程序</li>
<li>服务和进程</li>
<li>共享文件和打印机</li>
<li>内部服务：DNS 和本地 Web 应用程序</li>
</ul>
<p>为了从信息中获益，有必要了解系统提供的内容。</p>
<h2 id="已安装的应用程序">已安装的应用程序</h2>
<p>首先，我们通过检查应用程序的名称和版本开始枚举系统中已安装的应用程序。作为红队成员，这些信息将使我们受益。我们可能会发现安装了易受攻击的软件来利用和升级我们的系统权限。此外，我们可能会发现一些信息（例如纯文本凭据）留在属于其他系统或服务的系统上。</p>
<p>我们将使用 wmic Windows 命令列出所有已安装的应用程序及其版本。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; wmic product get name,version
Name                                                            Version
Microsoft Visual C++ <span class="hljs-number">2019</span> X64 Minimum Runtime - <span class="hljs-number">14.28</span>.<span class="hljs-number">29910</span>     <span class="hljs-number">14.28</span>.<span class="hljs-number">29910</span>
AWS Tools for Windows                                           <span class="hljs-number">3.15</span>.<span class="hljs-number">1248</span>
Amazon SSM Agent                                                <span class="hljs-number">3.0</span>.<span class="hljs-number">529.0</span>
aws-cfn-bootstrap                                               <span class="hljs-number">2.0</span>.<span class="hljs-number">5</span>
AWS PV Drivers                                                  <span class="hljs-number">8.3</span>.<span class="hljs-number">4</span>
Microsoft Visual C++ <span class="hljs-number">2019</span> X64 Additional Runtime - <span class="hljs-number">14.28</span>.<span class="hljs-number">29910</span>  <span class="hljs-number">14.28</span>.<span class="hljs-number">29910</span></code></pre>
<p>另一件有趣的事情是寻找特定的文本字符串、隐藏目录、备份文件。然后我们可以使用 PowerShell cmdlet Get-ChildItem，如下所示：</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-ChildItem -Hidden -Path C:\Users\kkidd\Desktop\</code></pre>
<h2 id="服务和进程">服务和进程</h2>
<p>Windows 服务使系统管理员能够在我们自己的 Windows 会话中创建长时间运行的可执行应用程序。有时，Windows 服务的权限配置错误，这会提升当前用户的权限访问级别。因此，我们必须查看正在运行的服务并执行服务和进程侦察。有关更多详细信息，您可以阅读 <a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1057/">Attack MITRE</a> 上有关进程发现的内容。</p>
<p>进程发现是了解系统提供的内容的枚举步骤。红队应该获取有关在系统上运行服务和进程的信息和详细信息。我们需要尽可能多地了解我们的目标。这些信息可以帮助我们了解网络中其他系统上运行的常见软件。例如，受感染的系统可能有一个用于内部目的的自定义客户端应用程序。定制内部开发的软件是升级向量的最常见根本原因。因此，值得进一步挖掘以获取有关当前流程的详细信息。</p>
<p>有关从蓝队角度了解核心 Windows 进程的更多详细信息，请查看 TryHackMe 房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/btwindowsinternals">核心 Windows 进程</a>。</p>
<h2 id="共享文件和打印机">共享文件和打印机</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857060.png" alt="image-20240716173826889"></p>
<p>共享文件和网络资源通常用于个人和企业环境。系统管理员错误配置访问权限，他们可能拥有有关其他帐户和系统的有用信息。有关打印机黑客攻击的更多信息，我们建议尝试以下 TryHackMe 房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/printerhacking101">打印机黑客攻击 101</a>。</p>
<h2 id="内部服务dns-本地web应用程序等">内部服务：DNS、本地Web应用程序等</h2>
<p>内部网络服务是扩展我们对其他系统和整个环境的了解的另一个信息来源。要获取有关用于外部和内部网络服务的网络服务的更多详细信息，我们建议尝试以下房间：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/networkservices">网络服务</a>、<a target="_blank" rel="noopener" href="https://tryhackme.com/room/networkservices2">网络服务2</a>。</p>
<p>以下是我们感兴趣的一些常用的内部服务：</p>
<ul>
<li>DNS Services 域名解析服务</li>
<li>Email Services 电子邮件服务</li>
<li>Network File Share 网络文件共享</li>
<li>Web application Web应用程序</li>
<li>Database service 数据库服务</li>
</ul>
<h2 id="回答问题">回答问题</h2>
<p>让我们尝试使用 Windows 命令提示符 net start 列出正在运行的服务，以检查是否有任何有趣的正在运行的服务。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; net start
These Windows services are started:

Active Directory Web Services
Amazon SSM Agent
Application Host Helper Service
Cryptographic Services
DCOM Server Process Launcher
DFS Namespace
DFS Replication
DHCP Client
Diagnostic Policy Service
THM Demo
DNS Client</code></pre>
<p>我们可以看到一个名为 THM Demo 的服务，我们想了解更多信息。</p>
<p>现在让我们查找确切的服务名称，我们需要它来查找更多信息。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; wmic service where <span class="hljs-string">"name like 'THM Demo'"</span> get Name,PathName
Name         PathName
THM Service  c:\Windows\thm-demo.exe</code></pre>
<p>我们找到文件名及其路径；现在让我们使用 Get-Process cmdlet 查找更多详细信息。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; Get-Process -Name thm-demo

Handles  <span class="hljs-built_in">NPM</span>(K)    <span class="hljs-built_in">PM</span>(K)      <span class="hljs-built_in">WS</span>(K)     <span class="hljs-built_in">CPU</span>(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
     <span class="hljs-number">82</span>       <span class="hljs-number">9</span>    <span class="hljs-number">13128</span>       <span class="hljs-number">6200</span>              <span class="hljs-number">3212</span>   <span class="hljs-number">0</span> thm-service</code></pre>
<p>一旦我们找到了它的进程ID，我们就可以通过列出系统内的监听端口来检查是否提供网络服务。</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; netstat -noa |findstr <span class="hljs-string">"LISTENING"</span> |findstr <span class="hljs-string">"3212"</span>
  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8080</span>          <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING       <span class="hljs-number">3212</span>
  TCP    [::]:<span class="hljs-number">8080</span>             [::]:<span class="hljs-number">0</span>                 LISTENING       <span class="hljs-number">3212</span></code></pre>
<p>最后，我们可以看到它正在侦听端口 8080。现在尝试应用我们讨论的内容并找到 THM Service的端口号。端口号是多少？</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857061.png" alt="image-20240716174318363"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857062.png" alt="image-20240716174356448"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857063.png" alt="image-20240716174452253"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857064.png" alt="image-20240716174531880"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857065.png" alt="image-20240716174550354"></p>
<p>我们提到，DNS 服务是任何 Active Directory 环境和网络中常用的协议。附属机器为AD提供DNS服务。让我们通过执行区域传输 DNS 来枚举 DNS，看看是否可以列出所有记录。</p>
<p>我们将使用 Microsoft 工具 nslookup.exe 执行 DNS 区域传输.</p>
<pre><code class="hljs scss">PS C:\Users\thm&gt; nslookup.exe
Default Server:  UnKnown
Address:  ::<span class="hljs-number">1</span></code></pre>
<p>一旦我们执行它，我们就会提供我们需要询问的 DNS 服务器，在本例中是目标计算机</p>
<pre><code class="hljs scss">&gt; server <span class="hljs-number">10.10</span><span class="hljs-selector-class">.229</span><span class="hljs-selector-class">.29</span>
Default Server:  [<span class="hljs-number">10.10</span>.<span class="hljs-number">229.29</span>]
Address:  <span class="hljs-number">10.10</span>.<span class="hljs-number">229.29</span></code></pre>
<p>现在让我们在 AD 环境中找到的域上尝试 DNS 区域传输。</p>
<pre><code class="hljs scss">&gt; ls -d thmredteam<span class="hljs-selector-class">.com</span>
<span class="hljs-selector-attr">[[10.10.229.29]</span>]
 thmredteam<span class="hljs-selector-class">.com</span>.                SOA    ad<span class="hljs-selector-class">.thmredteam</span><span class="hljs-selector-class">.com</span> hostmaster<span class="hljs-selector-class">.thmredteam</span><span class="hljs-selector-class">.com</span>. (<span class="hljs-number">732</span> <span class="hljs-number">900</span> <span class="hljs-number">600</span> <span class="hljs-number">86400</span> <span class="hljs-number">3600</span>)
 thmredteam<span class="hljs-selector-class">.com</span>.                <span class="hljs-selector-tag">A</span>      <span class="hljs-number">10.10</span><span class="hljs-selector-class">.229</span><span class="hljs-selector-class">.29</span>
 thmredteam<span class="hljs-selector-class">.com</span>.                NS     ad<span class="hljs-selector-class">.thmredteam</span><span class="hljs-selector-class">.com</span>
***
 ad                             <span class="hljs-selector-tag">A</span>      <span class="hljs-number">10.10</span><span class="hljs-selector-class">.229</span><span class="hljs-selector-class">.29</span></code></pre>
<p>前面的输出是成功执行 DNS 区域传输的示例。</p>
<p>现在，使用 nslookup.exe 枚举域控制器 <a target="_blank" rel="noopener" href="http://thmredteam.com">thmredteam.com</a> 的域名，并执行 DNS 区域传输。其中一条记录的标志是什么？</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407161857066.png" alt="image-20240716174848877"></p>
<p>这个房间介绍企业环境中的客户端系统。学生应该更好地了解如何在企业网络中使用客户端，包括：</p>
<ul>
<li>Network Infrastructure 网络基础设施</li>
<li>AD environment AD环境</li>
<li>security measures (HIPS, AV, etc.) 安全措施（HIPS、AV 等）</li>
<li>Internal applications and services 内部应用程序和服务</li>
</ul>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/07/16/thm-enumeration/">THM-Enumeration</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/07/14/thm-password-gong-ji/">THM-password攻击</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E4%BB%8B%E7%BB%8D"><span class="toc-text">0x01 介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E9%83%A8%E7%BD%B2%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text">0x02 部署虚拟机</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD"><span class="toc-text">0x03 网络基础设施</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91"><span class="toc-text">内网</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E5%86%9B%E4%BA%8B%E5%8C%BA-dmz"><span class="toc-text">非军事区 (DMZ)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%9E%9A%E4%B8%BE"><span class="toc-text">网络枚举</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%9C%8D%E5%8A%A1"><span class="toc-text">内网服务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-ad%E7%8E%AF%E5%A2%83"><span class="toc-text">0x04 AD环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFad%E7%8E%AF%E5%A2%83"><span class="toc-text">什么是AD环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E7%AD%94%E9%97%AE%E9%A2%98"><span class="toc-text">回答问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%AE%A1%E7%90%86"><span class="toc-text">0x05 用户和组管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95-ad-%E6%9E%9A%E4%B8%BE"><span class="toc-text">活动目录 (AD) 枚举</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E4%B8%BB%E6%9C%BA%E5%AE%89%E5%85%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%881"><span class="toc-text">0x06 主机安全解决方案#1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%AE%89%E5%85%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">主机安全解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E7%97%85%E6%AF%92%E8%BD%AF%E4%BB%B6-av"><span class="toc-text">防病毒软件 (AV)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#microsoft-windows-defender"><span class="toc-text">Microsoft Windows Defender</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E7%AD%94%E9%97%AE%E9%A2%98"><span class="toc-text">回答问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-%E4%B8%BB%E6%9C%BA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%882"><span class="toc-text">0x07 主机解决方案#2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E4%BA%8B%E4%BB%B6%E8%AE%B0%E5%BD%95%E5%92%8C%E7%9B%91%E6%8E%A7"><span class="toc-text">安全事件记录和监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%9B%91%E8%A7%86%E5%99%A8sysmon"><span class="toc-text">系统监视器（Sysmon）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%B8%BB%E6%9C%BA%E7%9A%84%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E9%A2%84%E9%98%B2%E7%B3%BB%E7%BB%9Fhidships"><span class="toc-text">基于主机的入侵检测&#x2F;预防系统（HIDS&#x2F;HIPS）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E7%82%B9%E6%A3%80%E6%B5%8B%E5%92%8C%E5%93%8D%E5%BA%94-edr"><span class="toc-text">端点检测和响应 (EDR)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">0x08 网络安全解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-text">网络防火墙</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E4%BF%A1%E6%81%AF%E5%92%8C%E4%BA%8B%E4%BB%B6%E7%AE%A1%E7%90%86-siem"><span class="toc-text">安全信息和事件管理 (SIEM)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F%E5%92%8C%E5%85%A5%E4%BE%B5%E9%98%B2%E5%BE%A1%E7%B3%BB%E7%BB%9Fnidsnips"><span class="toc-text">入侵检测系统和入侵防御系统（NIDS&#x2F;NIPS）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%92%8C%E6%9C%8D%E5%8A%A1"><span class="toc-text">0x09 应用程序和服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%B2%E5%AE%89%E8%A3%85%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-text">已安装的应用程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%92%8C%E8%BF%9B%E7%A8%8B"><span class="toc-text">服务和进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%92%8C%E6%89%93%E5%8D%B0%E6%9C%BA"><span class="toc-text">共享文件和打印机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E6%9C%8D%E5%8A%A1dns-%E6%9C%AC%E5%9C%B0web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%AD%89"><span class="toc-text">内部服务：DNS、本地Web应用程序等</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E7%AD%94%E9%97%AE%E9%A2%98"><span class="toc-text">回答问题</span></a></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
