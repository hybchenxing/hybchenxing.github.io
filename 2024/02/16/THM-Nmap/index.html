<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>THM-Nmap | hybcx</title><meta name="keywords" content="TryHackMe"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="THM-Nmap"><meta name="application-name" content="THM-Nmap"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="THM-Nmap"><meta property="og:url" content="http://hybcx.xyz/2024/02/16/thm-nmap/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="0x01 简介 对于黑客来说，知识就是力量。您对目标系统或网络的了解越多，可用的选项就越多。这使得在进行任何利用尝试之前必须进行适当的枚举。 假设我们已获得一个 IP（或多个 IP 地址）来执行安全审核。在我们做任何其他事情之前，我们需要了解我们正在攻击的“景观”。这意味着我们需要确定目标上正在运行"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="0x01 简介 对于黑客来说，知识就是力量。您对目标系统或网络的了解越多，可用的选项就越多。这使得在进行任何利用尝试之前必须进行适当的枚举。 假设我们已获得一个 IP（或多个 IP 地址）来执行安全审核。在我们做任何其他事情之前，我们需要了解我们正在攻击的“景观”。这意味着我们需要确定目标上正在运行"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2024/02/16/thm-nmap/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: 'THM-Nmap',
  postAI: '',
  pageFillDescription: '0x01 简介, 0x02 Nmap选项, 0x03 扫描类型概述, 0x04 TCP 扫描, 0x05 SYN 扫描, 0x06 UDP 扫描, 0x07 NULL、FIN、Xmas扫描, 0x08 ICMP 扫描, 0x09 NSE 脚本概述, 0x10 使用 NSE 脚本, 0x11 NSE 搜索脚本, 0x12 防火墙规避, 0x13 实践, 0x14 参考文章, 0x15 Nmap 后端口扫描, 服务检测, 操作系统检测和Traceroute, 操作系统检测, 路由追踪, Nmap 脚本 NSE, 保存输出, Normal 普通的, Grepable, XML, 脚本小子, 总结简介对于黑客来说知识就是力量您对目标系统或网络的了解越多可用的选项就越多这使得在进行任何利用尝试之前必须进行适当的枚举假设我们已获得一个或多个地址来执行安全审核在我们做任何其他事情之前我们需要了解我们正在攻击的景观这意味着我们需要确定目标上正在运行哪些服务例如也许其中一个正在运行服务器另一个则充当域控制器建立景观地图的第一个阶段是所谓的端口扫描当计算机运行网络服务时它会打开一个称为端口的网络结构来接收连接端口对于发出多个网络请求或提供多个可用服务是必需的例如当您在网络浏览器中同时加载多个网页时程序必须有某种方法来确定哪个选项卡正在加载哪个网页这是通过使用本地计算机上的不同端口建立与远程网络服务器的连接来完成的同样如果您希望一台服务器能够运行多个服务例如您可能希望您的服务器同时运行该站点的和版本那么您需要某种方法将流量引导至适当的服务端口再次是解决这个问题的方法网络连接是在两个端口之间建立的一个在服务器上侦听的开放端口和一个在您自己的计算机上随机选择的端口例如当您连接到网页时您的计算机可能会打开端口以连接到服务器的端口与前面的示例一样该图显示了当您同时连接到多个网站时会发生什么情况您的计算机打开一个不同的高编号端口随机用于与远程服务器的所有通信每台计算机共有个可用端口然而其中许多已注册为标准端口例如服务几乎总是可以在服务器的端口上找到服务可以在端口上找到可以在端口上找到可以在端口上找到需要注意的是然而特别是在设置中即使这些标准端口被更改也并非闻所未闻这使得我们更有必要对目标执行适当的枚举如果我们不知道服务器打开了哪些端口那么我们就没有成功攻击目标的希望因此我们从端口扫描开始任何攻击至关重要这可以通过多种方式来完成通常使用名为的工具这是本次会议的重点可用于执行许多不同类型的端口扫描其中最常见的将在接下来的任务中介绍然而基本理论是这样的将依次连接到目标的每个端口根据端口的响应方式可以将其确定为开放关闭或过滤通常由防火墙一旦我们知道哪些端口是开放的我们就可以查看每个端口上正在运行的服务手动或者更常见的是使用那么为什么是简而言之它目前成为行业标准是有原因的没有其他端口扫描工具能够接近其功能尽管一些新来者现在在速度上与它相匹配它是一个非常强大的工具其脚本引擎使其更加强大可用于扫描漏洞在某些情况下甚至可以直接执行漏洞利用再次这将在接下来的任务中更多地涉及现在了解以下内容很重要什么是端口扫描为什么有必要是任何类型初始枚举的首选工具选项与大多数渗透测试工具一样是从终端运行的有适用于和的版本对于这个房间我们假设您使用的是但是开关应该是相同的默认安装在和中可以通过在终端命令行中输入来访问然后输入我们将在下面介绍的一些开关告诉程序执行不同操作的命令参数为此您所需要的只是的帮助菜单使用访问和或手册页使用访问对于每个答案除非另有说明否则请包括开关的所有部分这包括开头的连字符扫描类型概述使用进行端口扫描时有三种基本扫描类型这些都是连接扫描半开扫描扫描此外还有几种不太常见的端口扫描类型我们还将介绍其中一些类型尽管不太详细这些都是空扫描扫描圣诞节扫描其中大多数扫描除外的用途非常相似但是每次扫描的工作方式有所不同这意味着虽然在大多数情况下您可能会选择前三种扫描之一但值得注意的是还存在其他扫描类型在网络扫描方面我们还将简要介绍一下或扫描扫描要了解连接扫描熟悉三向握手非常重要如果您对这个术语比较陌生那么建议您先完成网络介绍然后再继续简要回顾一下三向握手由三个阶段组成首先连接终端在本例中是我们的攻击机器向目标服务器发送一个设置了标志的请求然后服务器使用包含标志以及标志的响应来确认该数据包最后我们的终端通过发送设置了标志的请求来完成握手这是网络的基本原则之一但它与有何关系顾名思义扫描的工作原理是依次与每个目标端口执行三向握手换句话说尝试连接到每个指定的端口并通过收到的响应来确定服务是否打开例如如果端口关闭指出如果连接不存在关闭则将发送重置以响应除另一个重置之外的任何传入分段通过这种方式拒绝与现有连接不匹配的分段换句话说如果向关闭的端口发送设置了标志的请求目标服务器将使用设置了重置标志的数据包进行响应通过此响应可以确定端口已关闭但是如果请求发送到开放端口目标将使用设置了标志的数据包进行响应然后将此端口标记为打开并通过发回设置了的数据包来完成握手这一切都很好但是还有第三种可能性如果端口是开放的但隐藏在防火墙后面怎么办许多防火墙配置为简单地丢弃传入数据包发送请求但没有收到任何回复这表明该端口受到防火墙保护因此该端口被视为被过滤也就是说配置防火墙以响应数据包非常容易例如在的中命令的简单版本如下这使得获得目标的准确读数变得极其困难如果不是不可能的话扫描与扫描一样扫描用于扫描一个或多个目标的端口范围然而这两种扫描类型的工作方式略有不同扫描有时称为半开放扫描或隐形扫描扫描与目标执行完整的三向握手扫描在从服务器接收到后发回数据包这可以防止服务器重复尝试发出请求换句话说扫描开放端口的顺序如下所示这对于我们黑客来说有很多好处它可用于绕过旧的入侵检测系统因为它们正在寻找完整的三向握手现代解决方案通常不再出现这种情况正是由于这个原因扫描仍然经常被称为隐形扫描侦听开放端口的应用程序通常不会记录扫描因为标准做法是在完全建立连接后记录连接这再次体现了扫描的隐秘性无需费心为每个端口完成和断开连接三向握手扫描比标准连接扫描要快得多然而扫描有一些缺点即它们需要权限才能在中正常工作这是因为扫描需要能够创建原始数据包而不是完整的握手默认情况下只有用户才拥有此权限不稳定的服务有时会因扫描而中断如果客户端提供了用于测试的生产环境这可能会出现问题总而言之利大于弊因此如果使用权限运行扫描是使用的默认扫描如果在没有权限的情况下运行默认进行我们在上一个任务中看到的连接扫描当使用扫描来识别关闭和过滤的端口时适用与连接扫描完全相同的规则如果端口关闭则服务器会使用数据包进行响应如果端口被防火墙过滤则数据包将被丢弃或者通过重置进行欺骗在这方面两次扫描是相同的最大的区别在于它们处理开放端口的方式还可以通过为提供和功能来使扫描发挥作用但是这可能无法让许多脚本正常运行扫描与不同连接是无状态的这意味着连接不是通过来回握手来启动连接而是依赖于将数据包发送到目标端口并本质上希望它们能够成功这使得非常适合依赖速度而不是质量的连接例如视频共享但缺乏确认使得扫描变得更加困难并且速度慢得多扫描的开关是当数据包发送到开放的端口时不应有响应发生这种情况时将端口称为换句话说它怀疑端口是开放的但可能被防火墙阻止如果它收到响应这是非常不寻常的则该端口被标记为打开更常见的是没有响应在这种情况下会再次发送请求以进行双重检查如果仍然没有响应则端口被标记为打开已过滤并且继续前进当数据包发送到关闭的端口时目标应使用数据包进行响应其中包含该端口无法访问的消息这清楚地识别了关闭的端口将其标记为关闭的端口并继续前进由于难以识别端口是否实际打开因此与各种扫描相比扫描往往非常慢在连接良好的情况下扫描前个端口大约需要分钟因此在启用的情况下运行扫描通常是一个好习惯例如使用进行扫描将扫描前个最常用的端口从而获得更可接受的扫描时间当扫描端口时通常发送完全空的请求只是原始的数据包也就是说对于通常被知名服务占用的端口它将发送特定于协议的有效负载该有效负载更有可能引发响应从而得出更准确的结果扫描和端口扫描比我们已经介绍过的其他端口扫描不太常用因此我们不会在这里深入讨论这三者都是相互关联的之所以使用主要是因为相对而言它们比隐形扫描更加隐蔽从扫描开始顾名思义扫描是指发送请求时根本没有设置任何标志根据如果端口关闭目标主机应使用进行响应扫描的工作方式几乎相同但是不是发送完全空的数据包而是发送带有标志的请求通常用于正常关闭活动连接如果端口关闭再次期望与此类中的其他两个扫描一样扫描发送格式错误的数据包并期望关闭端口的响应它被称为圣诞扫描因为当在中将其视为数据包捕获时它设置的标志和使其看起来像一棵闪烁的圣诞树这些扫描对开放端口的预期响应也是相同的并且与扫描的响应非常相似如果端口打开则不会对格式错误的数据包做出响应不幸的是与开放的端口一样如果端口受防火墙保护这也是预期的行为因此和扫描将仅将端口识别为开放过滤关闭或过滤如果某个端口被这些扫描之一识别为已过滤则通常是因为目标已响应无法到达的数据包还值得注意的是虽然要求网络主机对关闭端口使用数据包响应格式错误的数据包而对开放端口根本不响应实际情况并非总是如此特别是众所周知以及许多网络设备会使用响应任何格式错误的数据包无论端口是否实际打开这会导致所有端口显示为关闭也就是说这里的目标当然是绕过防火墙许多防火墙配置为将传入的数据包丢弃到设置了标志的阻止端口从而阻止新的连接发起请求通过发送不包含标志的请求我们可以有效地绕过这种防火墙虽然这在理论上很好但大多数现代解决方案都熟悉这些扫描类型因此在处理现代系统时不要依赖它们有效扫描在黑盒分配中首次连接到目标网络时我们的第一个目标是获取网络结构的地图或者换句话说我们希望查看哪些地址包含活动主机哪些不包含活动主机实现此目的的一种方法是使用执行所谓的扫描顾名思义向指定网络的每个可能的地址发送数据包当它收到响应时它将响应的地址标记为活动的由于我们将在后面的任务中看到的原因这并不总是准确的然而它可以提供一些基线因此值得讨论为了执行扫描我们将开关与范围结合使用可以使用连字符或表示法指定范围即我们可以使用以下命令扫描网络开关告诉不要扫描任何端口强制它主要依靠回显数据包或本地网络上的请求如果使用运行或直接以用户身份运行来识别目标除了回显请求之外开关还会导致向目标的端口发送数据包以及如果不以身份运行则发送数据包发送至目标的端口这里图上去掉符号脚本概述脚本引擎是的一个非常强大的补充相当大地扩展了它的功能脚本是用编程语言编写的可用于执行多种操作从扫描漏洞到自动利用漏洞对于侦察特别有用但是值得注意的是脚本库的范围有多大有很多类别可供选择一些有用的类别包括不会影响目标不安全可能影响目标扫描漏洞尝试利用漏洞尝试绕过正在运行的服务的身份验证例如匿名登录服务器尝试暴力破解正在运行的服务的凭据尝试查询正在运行的服务以获取有关网络的更多信息例如查询服务器可以在此处找到更详尽的列表在下一个任务中我们将了解如何与交互并使用这些类别中的脚本使用脚本在任务中我们非常简要地了解了使用从类别激活脚本的开关其他类别的工作方式完全相同也就不足为奇了如果运行命令则将针对目标运行任何适用的安全脚本注意仅激活针对活动服务的脚本要运行特定脚本我们将使用例如通过用逗号分隔多个脚本可以以这种方式同时运行例如某些脚本需要参数例如凭据如果它们正在利用经过身份验证的漏洞这些可以通过开关给出一个例子是脚本用于使用方法上传文件这需要两个参数将文件上传到的以及文件在磁盘上的位置例如请注意参数以逗号分隔并用句点连接到相应的脚本即可以在此处找到脚本及其相应参数以及示例用例的完整列表脚本带有内置帮助菜单可以使用访问这往往不像上面给出的链接那么广泛但是在本地工作时它仍然很有用搜索脚本好的我们知道了如何使用中的脚本但我们还不知道如何找到这些脚本为此我们有两种选择最好将它们结合使用第一个是网站上的页面在上一个任务中提到其中包含所有官方脚本的列表第二个是攻击机器上的本地存储将其脚本存储在上的处默认情况下所有脚本都存储在该目录中当您指定脚本时会在该目录中查找脚本有两种方法可以搜索已安装的脚本一种是使用文件尽管有扩展名但这实际上并不是一个数据库而是一个包含每个可用脚本的文件名和类别的格式化文本文件使用此文件来跟踪并利用脚本引擎的脚本但是我们也可以通过来查找脚本例如搜索脚本的第二种方法非常简单使用命令例如我们可以使用获得与上一个屏幕截图相同的结果请注意搜索词两侧使用星号相同的技术也可用于搜索脚本类别例如我们之前提到过网站包含一系列脚本那么如果本地目录中缺少其中一个脚本会发生什么情况标准应该可以解决这个问题但是也可以通过从下载脚本来手动安装脚本然后必须跟随着它更新文件以包含新下载的脚本值得注意的是如果您要制作自己的脚本并将其添加到中则需要相同的命令这是一项非常易于管理的任务只需具备一些基础知识即可第二问题问的是依赖防火墙规避我们已经看到了一些绕过防火墙的技术想想隐形扫描以及和扫描然而还有另一种非常常见的防火墙配置我们必须知道如何绕过它您的典型主机将使用其默认防火墙阻止所有数据包这就带来了一个问题我们不仅经常使用来手动建立目标的活动默认情况下也会做同样的事情这意味着会将具有此防火墙配置的主机注册为死亡主机并且根本不扫描它因此我们需要一种方法来绕过这个配置幸运的是为此提供了一个选项它告诉在扫描主机之前不必费心主机这意味着将始终将目标主机视为活动的从而有效地绕过块然而它的代价是可能需要很长时间才能完成扫描如果主机确实死了那么仍然会检查并仔细检查每个指定的端口值得注意的是如果您已经直接位于本地网络上还可以使用请求来确定主机活动认为还有多种其他开关可用于规避防火墙我们不会详细介绍这些内容但是可以在这里找到它们以下开关尤其值得注意用于对数据包进行分段即将它们分成更小的部分从而降低防火墙或检测到数据包的可能性的替代方案但提供对数据包大小的更多控制接受用于发送的数据包的最大传输单元大小这必须是的倍数用于在发送的数据包之间添加延迟如果网络不稳定这非常有用而且还可以逃避任何可能存在的基于时间的防火墙触发器这用于生成数据包的无效校验和任何真正的堆栈都会丢弃此数据包但是防火墙可能会自动响应而无需检查数据包的校验和因此该开关可用于确定防火墙的存在实践采用直接目标机或者的选项确定请求这里说个端口都是被过滤的可以看到允许登录端口参考文章后端口扫描这里就当做命令的笔记吧本房间是系列的最后一个网络安全简介模块的一部分在这个房间中我们重点关注端口扫描之后的步骤特别是服务检测操作系统检测脚本引擎和保存扫描结果服务检测一旦发现开放端口您就可以探测可用端口来检测正在运行的服务对开放端口的进一步调查是重要的信息因为渗透测试人员可以使用它来了解该服务是否存在任何已知的漏洞加入漏洞了解有关搜索易受攻击服务的更多信息将添加到命令将收集并确定开放端口的服务和版本信息您可以使用控制强度其中级别范围为最轻和最完整的强度为而的强度为需要注意的是使用将强制继续进行次握手并建立连接连接建立是必要的因为如果不完全建立连接并与监听服务通信就无法发现版本换句话说当选择选项时秘密扫描是不可能的下面的控制台输出显示了带有选项的简单隐形扫描添加选项会导致输出中出现一个新列显示每个检测到的服务的版本例如在端口打开的情况下我们获取的不是而是请注意协议被猜测为服务因为端口已打开不需要连接到端口来确认但是需要连接到此开放端口以获取服务横幅及其可以获得的任何版本信息例如因此与服务列不同版本列不是猜测请注意许多选项需要权限除非您以身份运行否则您需要使用操作系统检测和操作系统检测可以根据操作系统的行为及其响应中的任何迹象来检测操作系统可以使用启用操作系统检测这是中的大写在此示例中我们在上运行检测到操作系统是然后进一步猜测它运行的是内核我们扫描并尝试检测其操作系统版本的系统正在运行内核版本能够在这种情况下做出接近的猜测在另一个案例中我们扫描了内核为的系统然而检测到它是好消息是正确检测到操作系统不太好的消息是内核版本错误操作系统检测非常方便但许多因素可能会影响其准确性首先需要在目标上找到至少一个开放端口和一个关闭端口才能进行可靠的猜测此外由于虚拟化和类似技术的广泛使用客户操作系统的指纹可能会变得扭曲因此在使用操作系统版本信息时要持有怀疑态度路由追踪如果你想让找到你和目标之间的路由器只需添加在以下示例中将跟踪路由附加到其扫描结果中请注意的跟踪路由的工作方式与和上的命令或上的命令略有不同标准以低生存时间数据包开始并不断增加直至到达目标的跟踪路由从高的数据包开始并不断减少它在下面的示例中我们在上执行了我们可以看到两者之间没有路由器跃点因为它们是直接连接的值得一提的是许多路由器都配置为不发送超出生存时间的这会阻止我们发现它们的地址欲了解更多信息请访问主动侦察室脚本脚本是一段不需要编译的代码换句话说它保持原来的人类可读形式不需要转换为机器语言许多程序通过脚本提供附加功能此外脚本可以添加通过内置命令不存在的自定义功能同样也提供对使用语言的脚本的支持脚本引擎是的一部分是一个解释器允许执行用语言编写的脚本然而我们不需要学习来使用脚本您的默认安装可以轻松包含近个脚本查看安装文件夹在上检查处的文件您会注意到有数百个脚本以它们的目标协议开头方便命名我们在下面的控制台输出中列出了上以开头的所有脚本我们发现了大约个以开头的脚本随着未来的更新您只能期望安装的脚本数量会增加您可以指定使用这些已安装脚本中的任何一个或一组此外您可以安装其他用户的脚本并将其用于扫描让我们从默认脚本开始您可以选择使用或简单地添加来运行默认类别中的脚本除了默认之外类别还包括身份验证广播暴力默认发现漏洞利用外部模糊器侵入恶意软件安全版本和漏洞简要说明如下表所示认证相关脚本通过发送广播消息发现主机对登录执行暴力密码审核默认脚本与相同检索可访问的信息例如数据库表和名称检测易受拒绝服务攻击的服务器尝试利用各种易受攻击的服务使用第三方服务进行检查例如和发起模糊攻击暴力攻击和利用等侵入性脚本扫描后门不会使目标崩溃的安全脚本检索服务版本检查漏洞或利用易受攻击的服务有些脚本属于多个类别此外一些脚本对服务发起暴力攻击而另一些脚本则发起攻击并利用系统因此如果您不想使服务崩溃或利用它们那么在选择要运行的脚本时要小心这一点至关重要我们使用对运行扫描并在控制台中执行默认脚本如下所示该命令是其中将确保在扫描之后执行默认脚本下面出现了新的详细信息查看端口的服务恢复了与正在运行的服务器相关的所有四个公钥考虑另一个例子端口上的服务检索默认页面标题我们可以看到该页面已保留为默认页面您还可以使用或等模式按名称指定脚本其中包括如果您不确定脚本的作用可以使用文本阅读器例如或文本编辑器打开脚本文件对于它指出对服务器执行暴力密码审核您必须小心因为某些脚本非常具有侵入性此外某些脚本可能适用于特定服务器如果随机选择则会浪费您的时间而没有任何好处与往常一样请确保您有权在目标服务器上启动此类测试让我们考虑一个良性脚本我们猜测它会检索服务器日期和时间这在其描述中确实得到了证实从类似的服务获取日期此外它还会打印日期与当地时间的差异在上我们执行如下面的控制台所示最后您可以将的功能扩展到官方脚本之外您可以编写脚本或从下载脚本从下载和使用脚本存在一定程度的风险因此最好不要运行您不信任的作者的脚本知道脚本保存在上的中脚本检查什么如果尚未启动请启动它确保已从任务终止后启动此任务的目标计算机在上使用默认脚本针对运行您会注意到有一个服务正在侦听端口它的完整版本值是多少根据其描述脚本报告目标服务器提供的算法数量用于加密压缩等依赖于并受支持的密钥交换算法的名称是什么保存输出每当您运行扫描时将结果保存在文件中是合理的选择和采用良好的命名约定对于文件名至关重要文件数量可能会快速增长并且可能妨碍您查找先前的扫描结果主要的三种格式有我们不推荐第四种脚本小子普通的顾名思义正常格式类似于扫描目标时在屏幕上获得的输出您可以使用以正常格式保存扫描结果代表正常这是结果的示例格式的名称来自命令代表全局正则表达式打印机简而言之它可以高效地过滤扫描输出中的特定关键字或术语您可以使用将扫描结果保存为格式上面以正常格式显示的扫描输出使用格式显示在下面的控制台中正常输出为行然而输出只有行主要原因是希望在用户应用时使每一行都有意义且完整因此在输出中与正常输出相比行很长并且不方便阅读的一个使用示例是该命令将显示包含所提供的关键字的所有行让我们比较一下在正常输出和输出上使用的输出您会注意到前者不提供主机的地址相反它返回如果您要筛选多个系统的扫描结果这会非常不方便然而后者在每一行中提供了足够的信息例如主机的地址以使其完整第三种格式是您可以使用将扫描结果以格式保存格式最方便用于在其他程序中处理输出方便的是您可以使用将扫描输出以所有三种格式保存即结合了普通格式可格式和格式脚本小子第四种格式是脚本小子您可以看到如果您想在输出中搜索任何有趣的关键字或保留结果以供将来参考则此格式毫无用处但是您可以使用它来保存扫描的输出显示输出文件名并在不懂技术的朋友面前查看终止上一个任务的目标机器并启动本任务的目标机器在终端上发出命令从目标虚拟机下载正常格式和格式的报告请注意用户名的密码为检查附加的日志有多少系统正在侦听端口总结在这个房间中我们学习了如何检测正在运行的服务及其版本以及主机操作系统我们学习了如何启用跟踪路由并介绍了选择一个或多个脚本来帮助渗透测试最后我们介绍了保存扫描结果以供将来参考的不同格式下表总结了我们在这个房间中讨论的最重要的选项选项意义确定开放端口上的服务版本信息尝试最有可能的探针尝试所有可用的探针检测操作系统运行到目标要运行的脚本或运行默认脚本相当于以正常格式保存输出以格式保存输出以格式保存输出以普通和格式保存输出',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-03-10 11:24:19',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/TryHackMe/" itemprop="url">TryHackMe</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/TryHackMe/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>TryHackMe</span></a></span></div></div><h1 class="post-title" itemprop="name headline">THM-Nmap</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-02-16T09:45:21.092Z" title="发表于 2024-02-16 17:45:21">2024-02-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-03-10T03:24:19.015Z" title="更新于 2024-03-10 11:24:19">2024-03-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">10.8k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>38分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="THM-Nmap"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/02/16/thm-nmap/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/02/16/thm-nmap/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2024/02/16/thm-nmap/"><header><a class="post-meta-categories" href="/categories/TryHackMe/" itemprop="url">TryHackMe</a><a href="/tags/TryHackMe/" tabindex="-1" itemprop="url">TryHackMe</a><h1 id="CrawlerTitle" itemprop="name headline">THM-Nmap</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2024-02-16T09:45:21.092Z" title="发表于 2024-02-16 17:45:21">2024-02-16</time><time itemprop="dateCreated datePublished" datetime="2024-03-10T03:24:19.015Z" title="更新于 2024-03-10 11:24:19">2024-03-10</time></header><h1 id="0x01-简介">0x01 简介</h1>
<p>对于黑客来说，知识就是力量。您对目标系统或网络的了解越多，可用的选项就越多。这使得在进行任何利用尝试之前必须进行适当的枚举。</p>
<p>假设我们已获得一个 IP（或多个 IP 地址）来执行安全审核。在我们做任何其他事情之前，我们需要了解我们正在攻击的“景观”。这意味着我们需要确定目标上正在运行哪些服务。</p>
<p>例如，也许其中一个正在运行 Web 服务器，另一个则充当 Windows Active Directory 域控制器。建立景观“地图”的第一个阶段是所谓的端口扫描。当计算机运行网络服务时，它会打开一个称为“端口”的网络结构来接收连接。端口对于发出多个网络请求或提供多个可用服务是必需的。</p>
<p>例如，当您在网络浏览器中同时加载多个网页时，程序必须有某种方法来确定哪个选项卡正在加载哪个网页。这是通过使用本地计算机上的不同端口建立与远程网络服务器的连接来完成的。同样，如果您希望一台服务器能够运行多个服务（例如，您可能希望您的 Web 服务器同时运行该站点的 HTTP 和 HTTPS 版本），那么您需要某种方法将流量引导至适当的服务。端口再次是解决这个问题的方法。网络连接是在两个端口之间建立的 - 一个在服务器上侦听的开放端口和一个在您自己的计算机上随机选择的端口。例如，当您连接到网页时，您的计算机可能会打开端口 49534 以连接到服务器的端口 443。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216175656420.png" alt="image-20240216175656420"></p>
<p>与前面的示例一样，该图显示了当您同时连接到多个网站时会发生什么情况。您的计算机打开一个不同的高编号端口（随机），用于与远程服务器的所有通信。</p>
<p>每台计算机共有65535个可用端口；然而，其中许多已注册为标准端口。例如，HTTP Web 服务几乎总是可以在服务器的端口 80 上找到。 HTTPS Web 服务可以在端口 443 上找到。Windows NETBIOS 可以在端口 139 上找到，SMB 可以在端口 445 上找到。需要注意的是；然而，特别是在 CTF 设置中，即使这些标准端口被更改也并非闻所未闻，这使得我们更有必要对目标执行适当的枚举。</p>
<p>如果我们不知道服务器打开了哪些端口，那么我们就没有成功攻击目标的希望；因此，我们从端口扫描开始任何攻击至关重要。这可以通过多种方式来完成——通常使用名为 nmap 的工具，这是本​​次会议的重点。 Nmap 可用于执行许多不同类型的端口扫描 - 其中最常见的将在接下来的任务中介绍；然而，基本理论是这样的：nmap 将依次连接到目标的每个端口。根据端口的响应方式，可以将其确定为开放、关闭或过滤（通常由防火墙）。一旦我们知道哪些端口是开放的，我们就可以查看每个端口上正在运行的服务——手动，或者更常见的是使用 nmap。</p>
<p>那么，为什么是 nmap？简而言之，它目前成为行业标准是有原因的：没有其他端口扫描工具能够接近其功能（尽管一些新来者现在在速度上与它相匹配）。它是一个非常强大的工具 - 其脚本引擎使其更加强大，可用于扫描漏洞，在某些情况下甚至可以直接执行漏洞利用！再次，这将在接下来的任务中更多地涉及。</p>
<p>现在，了解以下内容很重要：什么是端口扫描；为什么有必要； nmap 是任何类型初始枚举的首选工具。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216180627248.png" alt="image-20240216180627248"></p>
<h1 id="0x02-nmap选项">0x02 Nmap选项</h1>
<p>与大多数渗透测试工具一样，nmap 是从终端运行的。有适用于 Windows 和 Linux 的版本。对于这个房间，我们假设您使用的是 Linux；但是，开关应该是相同的。 Nmap 默认安装在 Kali Linux 和 TryHackMe Attack Box 中。</p>
<p>可以通过在终端命令行中输入 <code>nmap</code> 来访问 Nmap，然后输入我们将在下面介绍的一些“开关”（告诉程序执行不同操作的命令参数）。</p>
<p>为此，您所需要的只是 nmap 的帮助菜单（使用 <code>nmap -h</code> 访问）和/或 nmap 手册页（使用 <code>man nmap</code> 访问）。对于每个答案，除非另有说明，否则请包括开关的所有部分。这包括开头的连字符 ( <code>-</code> )。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216182551471.png" alt="image-20240216182551471"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216182606759.png" alt="image-20240216182606759"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216182616793.png" alt="image-20240216182616793"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216182629146.png" alt="image-20240216182629146"></p>
<h1 id="0x03-扫描类型概述">0x03 扫描类型概述</h1>
<p>使用Nmap进行端口扫描时，有三种基本扫描类型。这些都是：</p>
<ul>
<li>TCP 连接扫描 ( <code>-sT</code> )</li>
<li>SYN“半开”扫描 ( <code>-sS</code> )</li>
<li>UDP 扫描 ( <code>-sU</code> )</li>
</ul>
<p>此外，还有几种不太常见的端口扫描类型，我们还将介绍其中一些类型（尽管不太详细）。这些都是：</p>
<ul>
<li>TCP 空扫描 ( <code>-sN</code> )</li>
<li>TCP FIN 扫描 ( <code>-sF</code> )</li>
<li>TCP 圣诞节扫描 ( <code>-sX</code> )</li>
</ul>
<p>其中大多数（UDP 扫描除外）的用途非常相似，但是每次扫描的工作方式有所不同。这意味着，虽然在大多数情况下您可能会选择前三种扫描之一，但值得注意的是还存在其他扫描类型。</p>
<p>在网络扫描方面，我们还将简要介绍一下 ICMP（或“ping”）扫描。</p>
<h1 id="0x04-tcp-扫描">0x04 TCP 扫描</h1>
<p>要了解 TCP 连接扫描 ( <code>-sT</code> )，熟悉 TCP 三向握手非常重要。如果您对这个术语比较陌生，那么建议您先完成网络介绍，然后再继续。</p>
<p>简要回顾一下，三向握手由三个阶段组成。首先，连接终端（在本例中是我们的攻击机器）向目标服务器发送一个设置了 SYN 标志的 TCP 请求。然后，服务器使用包含 SYN 标志以及 ACK 标志的 TCP 响应来确认该数据包。最后，我们的终端通过发送设置了 ACK 标志的 TCP 请求来完成握手。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216182935748.png" alt="image-20240216182935748"></p>
<p>这是 TCP/IP 网络的基本原则之一，但它与 Nmap 有何关系？</p>
<p>顾名思义，TCP Connect 扫描的工作原理是依次与每个目标端口执行三向握手。换句话说，Nmap 尝试连接到每个指定的 TCP 端口，并通过收到的响应来确定服务是否打开。</p>
<p>例如，如果端口关闭，RFC 9293 指出：</p>
<p>“…如果连接不存在（关闭），则将发送重置以响应除另一个重置之外的任何传入分段。通过这种方式拒绝与现有连接不匹配的 SYN 分段。”</p>
<p>换句话说，如果Nmap向关闭的端口发送设置了SYN标志的TCP请求，目标服务器将使用设置了RST（重置）标志的TCP数据包进行响应。通过此响应，Nmap 可以确定端口已关闭。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216183041765.png" alt="image-20240216183041765"></p>
<p>但是，如果请求发送到开放端口，目标将使用设置了 SYN/ACK 标志的 TCP 数据包进行响应。然后，Nmap 将此端口标记为打开（并通过发回设置了 ACK 的 TCP 数据包来完成握手）。</p>
<p>这一切都很好，但是，还有第三种可能性。</p>
<p>如果端口是开放的，但隐藏在防火墙后面怎么办？</p>
<p>许多防火墙配置为简单地丢弃传入数据包。 Nmap 发送 TCP SYN 请求，但没有收到任何回复。这表明该端口受到防火墙保护，因此该端口被视为被过滤。</p>
<p>也就是说，配置防火墙以响应 RST TCP 数据包非常容易。例如，在 Linux 的 IPtables 中，命令的简单版本如下：</p>
<pre><code class="hljs scss">iptables -<span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> &lt;port&gt; -j REJECT <span class="hljs-attr">--reject-with</span> tcp-reset</code></pre>
<p>这使得获得目标的准确读数变得极其困难（如果不是不可能的话）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216183218824.png" alt="image-20240216183218824"></p>
<h1 id="0x05-syn-扫描">0x05 SYN 扫描</h1>
<p>与 TCP 扫描一样，SYN 扫描 ( <code>-sS</code> ) 用于扫描一个或多个目标的 TCP 端口范围；然而，这两种扫描类型的工作方式略有不同。 SYN 扫描有时称为“半开放”扫描或“隐形”扫描。</p>
<p>TCP 扫描与目标执行完整的三向握手，SYN 扫描在从服务器接收到 SYN/ACK 后发回 RST TCP 数据包（这可以防止服务器重复尝试发出请求）。换句话说，扫描开放端口的顺序如下所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216183300156.png" alt="image-20240216183300156"></p>
<p>这对于我们黑客来说有很多好处：</p>
<ul>
<li>它可用于绕过旧的入侵检测系统，因为它们正在寻找完整的三向握手。现代 IDS 解决方案通常不再出现这种情况；正是由于这个原因，SYN 扫描仍然经常被称为“隐形”扫描。</li>
<li>侦听开放端口的应用程序通常不会记录 SYN 扫描，因为标准做法是在完全建立连接后记录连接。这再次体现了 SYN 扫描的隐秘性。</li>
<li>无需费心为每个端口完成（和断开连接）三向握手，SYN 扫描比标准 TCP 连接扫描要快得多。</li>
</ul>
<p>然而，SYN 扫描有一些缺点，即：</p>
<ul>
<li>它们需要 sudo 权限 [1] 才能在 Linux 中正常工作。这是因为 SYN 扫描需要能够创建原始数据包（而不是完整的 TCP 握手），默认情况下只有 root 用户才拥有此权限。</li>
<li>不稳定的服务有时会因 SYN 扫描而中断，如果客户端提供了用于测试的生产环境，这可能会出现问题。</li>
</ul>
<p>总而言之，利大于弊。</p>
<p>因此，如果使用 sudo 权限运行，SYN 扫描是 Nmap 使用的默认扫描。如果在没有 sudo 权限的情况下运行，Nmap 默认进行我们在上一个任务中看到的 TCP 连接扫描。</p>
<p>当使用 SYN 扫描来识别关闭和过滤的端口时，适用与 TCP 连接扫描完全相同的规则。</p>
<p>如果端口关闭，则服务器会使用 RST TCP 数据包进行响应。如果端口被防火墙过滤，则 TCP SYN 数据包将被丢弃，或者通过 TCP 重置进行欺骗。</p>
<p>在这方面，两次扫描是相同的：最大的区别在于它们处理开放端口的方式。</p>
<p>[1] 还可以通过为 Nmap 提供 CAP_NET_RAW、CAP_NET_ADMIN 和 CAP_NET_BIND_SERVICE 功能来使 SYN 扫描发挥作用；但是，这可能无法让许多 NSE 脚本正常运行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216183522702.png" alt="image-20240216183522702"></p>
<h1 id="0x06-udp-扫描">0x06 UDP 扫描</h1>
<p>与 TCP 不同，UDP 连接是无状态的。这意味着，UDP 连接不是通过来回“握手”来启动连接，而是依赖于将数据包发送到目标端口，并本质上希望它们能够成功。这使得 UDP 非常适合依赖速度而不是质量的连接（例如视频共享），但缺乏确认使得 UDP 扫描变得更加困难（并且速度慢得多）。 Nmap UDP 扫描的开关是 ( <code>-sU</code> )</p>
<p>当数据包发送到开放的 UDP 端口时，不应有响应。发生这种情况时，Nmap 将端口称为 <code>open|filtered</code> 。换句话说，它怀疑端口是开放的，但可能被防火墙阻止。如果它收到 UDP 响应（这是非常不寻常的），则该端口被标记为打开。更常见的是没有响应，在这种情况下，会再次发送请求以进行双重检查。如果仍然没有响应，则端口被标记为打开|已过滤并且 Nmap 继续前进。</p>
<p>当数据包发送到关闭的 UDP 端口时，目标应使用 ICMP (ping) 数据包进行响应，其中包含该端口无法访问的消息。这清楚地识别了关闭的端口，Nmap 将其标记为关闭的端口并继续前进。</p>
<p>由于难以识别 UDP 端口是否实际打开，因此与各种 TCP 扫描相比，UDP 扫描往往非常慢（在连接良好的情况下扫描前 1000 个端口大约需要 20 分钟）。因此，在启用 <code>--top-ports &lt;number&gt;</code> 的情况下运行 Nmap 扫描通常是一个好习惯。例如，使用 <code>nmap -sU --top-ports 20 &lt;target&gt;</code> 进行扫描。将扫描前 20 个最常用的 UDP 端口，从而获得更可接受的扫描时间。</p>
<p>当扫描 UDP 端口时，Nmap 通常发送完全空的请求——只是原始的 UDP 数据包。也就是说，对于通常被知名服务占用的端口，它将发送特定于协议的有效负载，该有效负载更有可能引发响应，从而得出更准确的结果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216184103251.png" alt="image-20240216184103251"></p>
<h1 id="0x07-null-fin-xmas扫描">0x07 NULL、FIN、Xmas扫描</h1>
<p>NULL、FIN 和 Xmas TCP 端口扫描比我们已经介绍过的其他端口扫描不太常用，因此我们不会在这里深入讨论。这三者都是相互关联的，之所以使用，主要是因为相对而言，它们比 SYN“隐形”扫描更加隐蔽。从 NULL 扫描开始：</p>
<ul>
<li>顾名思义，NULL 扫描 ( <code>-sN</code> ) 是指发送 TCP 请求时根本没有设置任何标志。根据 RFC，如果端口关闭，目标主机应使用 RST 进行响应。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216184306773.png" alt="image-20240216184306773"></p>
<ul>
<li>FIN 扫描 ( <code>-sF</code> ) 的工作方式几乎相同；但是，不是发送完全空的数据包，而是发送带有 FIN 标志的请求（通常用于正常关闭活动连接）。如果端口关闭，Nmap 再次期望 RST。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216184329439.png" alt="image-20240216184329439"></p>
<ul>
<li>与此类中的其他两个扫描一样，Xmas 扫描 ( <code>-sX</code> ) 发送格式错误的 TCP 数据包，并期望关闭端口的 RST 响应。它被称为圣诞扫描，因为当在 Wireshark 中将其视为数据包捕获时，它设置的标志（PSH、URG 和 FIN）使其看起来像一棵闪烁的圣诞树。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216184406875.png" alt="image-20240216184406875"></p>
<p>这些扫描对开放端口的预期响应也是相同的，并且与 UDP 扫描的响应非常相似。如果端口打开，则不会对格式错误的数据包做出响应。不幸的是（与开放的 UDP 端口一样），如果端口受防火墙保护，这也是预期的行为，因此 NULL、FIN 和 Xmas 扫描将仅将端口识别为开放|过滤、关闭或过滤。如果某个端口被这些扫描之一识别为已过滤，则通常是因为目标已响应 ICMP 无法到达的数据包。</p>
<p>还值得注意的是，虽然 RFC 793 要求网络主机对关闭端口使用 RST TCP 数据包响应格式错误的数据包，而对开放端口根本不响应；实际情况并非总是如此。特别是，众所周知，Microsoft Windows（以及许多 Cisco 网络设备）会使用 RST 响应任何格式错误的 TCP 数据包 - 无论端口是否实际打开。这会导致所有端口显示为关闭。</p>
<p>也就是说，这里的目标当然是绕过防火墙。许多防火墙配置为将传入的 TCP 数据包丢弃到设置了 SYN 标志的阻止端口（从而阻止新的连接发起请求）。通过发送不包含 SYN 标志的请求，我们可以有效地绕过这种防火墙。虽然这在理论上很好，但大多数现代 IDS 解决方案都熟悉这些扫描类型，因此在处理现代系统时不要依赖它们 100% 有效。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216184836853.png" alt="image-20240216184836853"></p>
<h1 id="0x08-icmp-扫描">0x08 ICMP 扫描</h1>
<p>在黑盒分配中首次连接到目标网络时，我们的第一个目标是获取网络结构的“地图”，或者换句话说，我们希望查看哪些 IP 地址包含活动主机，哪些不包含活动主机。</p>
<p>实现此目的的一种方法是使用 Nmap 执行所谓的“ping 扫描”。顾名思义，Nmap 向指定网络的每个可能的 IP 地址发送 ICMP 数据包。当它收到响应时，它将响应的 IP 地址标记为活动的。由于我们将在后面的任务中看到的原因，这并不总是准确的；然而，它可以提供一些基线，因此值得讨论。</p>
<p>为了执行 ping 扫描，我们将 <code>-sn</code> 开关与 IP 范围结合使用，可以使用连字符 ( <code>-</code> ) 或 CIDR 表示法指定 IP 范围。即我们可以使用以下命令扫描 <code>192.168.0.x</code> 网络：</p>
<ul>
<li><code>nmap -sn 192.168.0.1-254</code>or <code>nmap -sn 192.168.0.0/24</code></li>
</ul>
<p><code>-sn</code> 开关告诉 Nmap 不要扫描任何端口——强制它主要依靠 ICMP 回显数据包（或本地网络上的 ARP 请求，如果使用 sudo 运行或直接以 root 用户身份运行）来识别目标。除了 ICMP 回显请求之外， <code>-sn</code> 开关还会导致 nmap 向目标的端口 443 发送 TCP SYN 数据包以及 TCP ACK（如果不以 root 身份运行，则发送 TCP SYN）数据包发送至目标的 80 端口。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216185316277.png" alt="image-20240216185316277"></p>
<p>这里图上去掉+符号</p>
<h1 id="0x09-nse-脚本概述">0x09 NSE 脚本概述</h1>
<p>Nmap 脚本引擎 (NSE) 是 Nmap 的一个非常强大的补充，相当大地扩展了它的功能。 NSE 脚本是用 Lua 编程语言编写的，可用于执行多种操作：从扫描漏洞到自动利用漏洞。 NSE 对于侦察特别有用，但是，值得注意的是脚本库的范围有多大。</p>
<p>有很多类别可供选择。一些有用的类别包括：</p>
<ul>
<li><code>safe</code> :- 不会影响目标</li>
<li><code>intrusive</code> ：- 不安全：可能影响目标</li>
<li><code>vuln</code> ：- 扫描漏洞</li>
<li><code>exploit</code> ：- 尝试利用漏洞</li>
<li><code>auth</code> ：- 尝试绕过正在运行的服务的身份验证（例如匿名登录 FTP 服务器）</li>
<li><code>brute</code> ：- 尝试暴力破解正在运行的服务的凭据</li>
<li><code>discovery</code> ：- 尝试查询正在运行的服务以获取有关网络的更多信息（例如查询 SNMP 服务器）。</li>
</ul>
<p>可以在此处找到更详尽的列表：<a target="_blank" rel="noopener" href="https://nmap.org/book/nse-usage.html">here</a></p>
<p>在下一个任务中，我们将了解如何与 NSE 交互并使用这些类别中的脚本。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216185557080.png" alt="image-20240216185557080"></p>
<h1 id="0x10-使用-nse-脚本">0x10 使用 NSE 脚本</h1>
<p>在任务 3 中，我们非常简要地了解了使用 <code>--script=vuln</code> 从 <code>vuln</code> 类别激活 NSE 脚本的 <code>--script</code> 开关。其他类别的工作方式完全相同也就不足为奇了。如果运行命令 <code>--script=safe</code> ，则将针对目标运行任何适用的安全脚本（注意：仅激活针对活动服务的脚本）。</p>
<p>要运行特定脚本，我们将使用 <code>--script=&lt;script-name&gt;</code> ，例如 <code>--script=http-fileupload-exploiter</code> 。</p>
<p>通过用逗号分隔多个脚本可以以这种方式同时运行。例如： <code>--script=smb-enum-users,smb-enum-shares</code> 。</p>
<p>某些脚本需要参数（例如，凭据，如果它们正在利用经过身份验证的漏洞）。这些可以通过 <code>--script-args</code> Nmap 开关给出。一个例子是 <code>http-put</code> 脚本（用于使用 PUT 方法上传文件）。这需要两个参数：将文件上传到的 URL 以及文件在磁盘上的位置。例如：</p>
<pre><code class="hljs scss">nmap -<span class="hljs-selector-tag">p</span> <span class="hljs-number">80</span> <span class="hljs-attr">--script</span> http-put <span class="hljs-attr">--script-args</span> http-put<span class="hljs-selector-class">.url</span>='/dav/shell<span class="hljs-selector-class">.php</span>',http-put<span class="hljs-selector-class">.file</span>='./shell<span class="hljs-selector-class">.php</span>'</code></pre>
<p>请注意，参数以逗号分隔，并用句点连接到相应的脚本（即 <code>&lt;script-name&gt;.&lt;argument&gt;</code> ）。</p>
<p>可以在此处找到脚本及其相应参数（以及示例用例）的完整列表：<a target="_blank" rel="noopener" href="https://nmap.org/nsedoc/">here</a></p>
<p>Nmap 脚本带有内置帮助菜单，可以使用 <code>nmap --script-help &lt;script-name&gt;</code> 访问。这往往不像上面给出的链接那么广泛，但是，在本地工作时它仍然很有用。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216190408747.png" alt="image-20240216190408747"></p>
<h1 id="0x11-nse-搜索脚本">0x11 NSE 搜索脚本</h1>
<p>好的，我们知道了如何使用 Nmap 中的脚本，但我们还不知道如何找到这些脚本。</p>
<p>为此，我们有两种选择，最好将它们结合使用。第一个是 Nmap 网站上的页面（在上一个任务中提到），其中包含所有官方脚本的列表。第二个是攻击机器上的本地存储。 Nmap 将其脚本存储在 Linux 上的 <code>/usr/share/nmap/scripts</code> 处。默认情况下，所有 NSE 脚本都存储在该目录中——当您指定脚本时，Nmap 会在该目录中查找脚本。</p>
<p>有两种方法可以搜索已安装的脚本。一种是使用 <code>/usr/share/nmap/scripts/script.db</code> 文件。尽管有扩展名，但这实际上并不是一个数据库，而是一个包含每个可用脚本的文件名和类别的格式化文本文件。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216190524152.png" alt="image-20240216190524152"></p>
<p>Nmap 使用此文件来跟踪（并利用）脚本引擎的脚本；但是，我们也可以通过 grep 来查找脚本。例如： <code>grep "ftp" /usr/share/nmap/scripts/script.db</code> 。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216190540863.png" alt="image-20240216190540863"></p>
<p>搜索脚本的第二种方法非常简单，使用 <code>ls</code> 命令。例如，我们可以使用 <code>ls -l /usr/share/nmap/scripts/*ftp*</code> 获得与上一个屏幕截图相同的结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216190618291.png" alt="image-20240216190618291"></p>
<p>请注意搜索词两侧使用星号 ( <code>*</code> )相同的技术也可用于搜索脚本类别。例如：<br>
<code>grep "safe" /usr/share/nmap/scripts/script.db</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216190644073.png" alt="image-20240216190644073"></p>
<p>我们之前提到过，Nmap 网站包含一系列脚本，那么，如果本地 <code>scripts</code> 目录中缺少其中一个脚本，会发生什么情况？标准 <code>sudo apt update &amp;&amp; sudo apt install nmap</code> 应该可以解决这个问题；但是，也可以通过从 Nmap ( <code>sudo wget -O /usr/share/nmap/scripts/&lt;script-name&gt;.nse https://svn.nmap.org/nmap/scripts/&lt;script-name&gt;.nse</code> ) 下载脚本来手动安装脚本。然后必须跟随着 <code>nmap --script-updatedb</code> ，它更新 <code>script.db</code> 文件以包含新下载的脚本。</p>
<p>值得注意的是，如果您要制作自己的 NSE 脚本并将其添加到 Nmap 中，则需要相同的“updatedb”命令——这是一项非常易于管理的任务，只需具备一些 Lua 基础知识即可！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216191029146.png" alt="image-20240216191029146"></p>
<p>第二问题问的是依赖：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216191046335.png" alt="image-20240216191046335"></p>
<h1 id="0x12-防火墙规避">0x12 防火墙规避</h1>
<p>我们已经看到了一些绕过防火墙的技术（想想隐形扫描，以及 NULL、FIN 和 Xmas 扫描）；然而，还有另一种非常常见的防火墙配置，我们必须知道如何绕过它。</p>
<p>您的典型 Windows 主机将使用其默认防火墙阻止所有 ICMP 数据包。这就带来了一个问题：我们不仅经常使用 ping 来手动建立目标的活动，Nmap 默认情况下也会做同样的事情。这意味着 Nmap 会将具有此防火墙配置的主机注册为死亡主机，并且根本不扫描它。</p>
<p>因此，我们需要一种方法来绕过这个配置。幸运的是，Nmap 为此提供了一个选项： <code>-Pn</code> ，它告诉 Nmap 在扫描主机之前不必费心 ping 主机。这意味着 Nmap 将始终将目标主机视为活动的，从而有效地绕过 ICMP 块；然而，它的代价是可能需要很长时间才能完成扫描（如果主机确实死了，那么 Nmap 仍然会检查并仔细检查每个指定的端口）。</p>
<p>值得注意的是，如果您已经直接位于本地网络上，Nmap 还可以使用 ARP 请求来确定主机活动。</p>
<p>Nmap 认为还有多种其他开关可用于规避防火墙。我们不会详细介绍这些内容，但是可以在这里找到它们：<a target="_blank" rel="noopener" href="https://nmap.org/book/man-bypass-firewalls-ids.html">here</a></p>
<p>以下开关尤其值得注意：</p>
<ul>
<li><code>-f</code> ：- 用于对数据包进行分段（即将它们分成更小的部分），从而降低防火墙或 IDS 检测到数据包的可能性。</li>
<li><code>-f</code> 的替代方案，但提供对数据包大小的更多控制： <code>--mtu &lt;number&gt;</code> ，接受用于发送的数据包的最大传输单元大小。这必须是 8 的倍数。</li>
<li><code>--scan-delay &lt;time&gt;ms</code> ：- 用于在发送的数据包之间添加延迟。如果网络不稳定，这非常有用，而且还可以逃避任何可能存在的基于时间的防火墙/IDS 触发器。</li>
<li><code>--badsum</code> ：- 这用于生成数据包的无效校验和。任何真正的 TCP/IP 堆栈都会丢弃此数据包，但是，防火墙可能会自动响应，而无需检查数据包的校验和。因此，该开关可用于确定防火墙/IDS 的存在。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216191652525.png" alt="image-20240216191652525"></p>
<h1 id="0x13-实践">0x13 实践</h1>
<p>采用直接ping目标机或者nmap 的-PE选项确定ping请求</p>
<pre><code class="hljs scss">nmap -sX -<span class="hljs-selector-tag">p</span> <span class="hljs-number">1</span>-<span class="hljs-number">999</span> -Pn <span class="hljs-number">10.10</span><span class="hljs-selector-class">.162</span><span class="hljs-selector-class">.155</span> -vv</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216193100002.png" alt="image-20240216193100002"></p>
<p>这里说999个端口都是被过滤的</p>
<pre><code class="hljs scss">nmap -sS -<span class="hljs-selector-tag">p</span> <span class="hljs-number">1</span>-<span class="hljs-number">5000</span> -Pn <span class="hljs-number">10.10</span><span class="hljs-selector-class">.162</span><span class="hljs-selector-class">.155</span> -vv</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216193418154.png" alt="image-20240216193418154"></p>
<pre><code class="hljs scss">nmap -Pn <span class="hljs-attr">--script</span>=ftp-anon -<span class="hljs-selector-tag">p</span> <span class="hljs-number">21</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.162</span><span class="hljs-selector-class">.155</span> -vv</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216193801089.png" alt="image-20240216193801089"></p>
<p>可以看到允许登录21端口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240216193832775.png" alt="image-20240216193832775"></p>
<h1 id="0x14-参考文章">0x14 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://grumpyghost1011.medium.com/nmap-room-tryhackme-walkthrough-%EF%B8%8F-4fdf25829f1d"><strong>Nmap Room Tryhackme Walkthrough</strong></a></p>
<h1 id="0x15-nmap-后端口扫描">0x15 Nmap 后端口扫描</h1>
<p>这里就当做nmap命令的笔记吧</p>
<p>本房间是 Nmap 系列的最后一个（网络安全简介模块的一部分）。在这个房间中，我们重点关注端口扫描之后的步骤：特别是服务检测、操作系统检测、Nmap 脚本引擎和保存扫描结果。</p>
<h2 id="服务检测">服务检测</h2>
<p>一旦 Nmap 发现开放端口，您就可以探测可用端口来检测正在运行的服务。对开放端口的进一步调查是重要的信息，因为渗透测试人员可以使用它来了解该服务是否存在任何已知的漏洞。加入<a target="_blank" rel="noopener" href="https://tryhackme.com/room/vulnerabilities101">漏洞 101</a> 了解有关搜索易受攻击服务的更多信息。</p>
<p>将 <code>-sV</code> 添加到 Nmap 命令将收集并确定开放端口的服务和版本信息。您可以使用 <code>--version-intensity LEVEL</code> 控制强度，其中级别范围为 0（最轻）和 9（最完整）。 <code>-sV --version-light</code> 的强度为 2，而 <code>-sV --version-all</code> 的强度为 9。</p>
<p>需要注意的是，使用 <code>-sV</code> 将强制 Nmap 继续进行 TCP 3 次握手并建立连接。连接建立是必要的，因为如果不完全建立连接并与监听服务通信，Nmap 就无法发现版本。换句话说，当选择 <code>-sV</code> 选项时，秘密SYN扫描 <code>-sS</code> 是不可能的。</p>
<p>下面的控制台输出显示了带有 <code>-sV</code> 选项的简单 Nmap 隐形 SYN 扫描。添加 <code>-sV</code> 选项会导致输出中出现一个新列，显示每个检测到的服务的版本。例如，在 TCP 端口 22 打开的情况下，我们获取的不是 <code>22/tcp open ssh</code> ，而是 <code>22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u8 (protocol 2.0)</code> 。请注意，SSH 协议被猜测为服务，因为 TCP 端口 22 已打开； Nmap 不需要连接到端口 22 来确认。但是， <code>-sV</code> 需要连接到此开放端口以获取服务横幅及其可以获得的任何版本信息，例如 <code>nginx 1.6.2</code> 。因此，与服务列不同，版本列不是猜测。</p>
<p>请注意，许多 Nmap 选项需要 root 权限。除非您以 root 身份运行 Nmap，否则您需要使用 <code>sudo</code> 。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310103247817.png" alt="image-20240310103247817"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310103252532.png" alt="image-20240310103252532"></p>
<h2 id="操作系统检测和traceroute">操作系统检测和Traceroute</h2>
<h3 id="操作系统检测">操作系统检测</h3>
<p>Nmap 可以根据操作系统 (OS) 的行为及其响应中的任何迹象来检测操作系统 (OS)。可以使用 <code>-O</code> 启用操作系统检测；这是 OS 中的大写 O。在此示例中，我们在 AttackBox 上运行 <code>nmap -sS -O 10.10.212.228</code> 。 Nmap检测到操作系统是Linux 3.X，然后进一步猜测它运行的是内核3.13。</p>
<pre><code class="hljs scss">pentester<span class="hljs-keyword">@TryHackMe</span>$ sudo nmap -sS -O <span class="hljs-number">10.10</span>.<span class="hljs-number">212.228</span>

Starting Nmap <span class="hljs-number">7.60</span> ( <span class="hljs-attribute">https</span>://nmap.org ) at <span class="hljs-number">2021</span>-<span class="hljs-number">09</span>-<span class="hljs-number">10</span> <span class="hljs-number">05</span>:<span class="hljs-number">04</span> BST
Nmap <span class="hljs-attribute">scan</span> report for <span class="hljs-number">10.10</span>.<span class="hljs-number">212.228</span>
Host is up (<span class="hljs-number">0.00099s</span> latency).
<span class="hljs-keyword">Not</span> <span class="hljs-attribute">shown</span>: <span class="hljs-number">994</span> closed ports
PORT    STATE SERVICE
<span class="hljs-number">22</span>/tcp  open  ssh
<span class="hljs-number">25</span>/tcp  open  smtp
<span class="hljs-number">80</span>/tcp  open  http
<span class="hljs-number">110</span>/tcp open  pop3
<span class="hljs-number">111</span>/tcp open  rpcbind
<span class="hljs-number">143</span>/tcp open  imap
MAC <span class="hljs-attribute">Address</span>: <span class="hljs-number">02</span>:A0:E7:B5:B6:C5 (Unknown)
Device <span class="hljs-attribute">type</span>: general purpose
<span class="hljs-attribute">Running</span>: Linux <span class="hljs-number">3</span>.X
OS <span class="hljs-attribute">CPE</span>: <span class="hljs-attribute">cpe</span>:/<span class="hljs-attribute">o</span>:<span class="hljs-attribute">linux</span>:linux_<span class="hljs-attribute">kernel</span>:<span class="hljs-number">3.13</span>
OS <span class="hljs-attribute">details</span>: Linux <span class="hljs-number">3.13</span>
Network <span class="hljs-attribute">Distance</span>: <span class="hljs-number">1</span> hop

OS detection performed. Please report any incorrect results at <span class="hljs-attribute">https</span>://nmap.org/submit/ .
Nmap <span class="hljs-attribute">done</span>: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">3.91</span> seconds</code></pre>
<p>我们扫描并尝试检测其操作系统版本的系统正在运行内核版本 3.16。 Nmap 能够在这种情况下做出接近的猜测。在另一个案例中，我们扫描了内核为5.13.14的Fedora Linux系统；然而，Nmap 检测到它是 Linux 2.6.X。好消息是 Nmap 正确检测到操作系统；不太好的消息是内核版本错误。</p>
<p>操作系统检测非常方便，但许多因素可能会影响其准确性。首先，Nmap需要在目标上找到至少一个开放端口和一个关闭端口才能进行可靠的猜测。此外，由于虚拟化和类似技术的广泛使用，客户操作系统的指纹可能会变得扭曲。因此，在使用操作系统版本信息时，要持有怀疑态度。</p>
<h3 id="路由追踪">路由追踪</h3>
<p>如果你想让 Nmap 找到你和目标之间的路由器，只需添加 <code>--traceroute</code> 。在以下示例中，Nmap 将跟踪路由附加到其扫描结果中。请注意，Nmap 的跟踪路由的工作方式与 Linux 和 macOS 上的 <code>traceroute</code> 命令或 MS Windows 上的 <code>tracert</code> 命令略有不同。标准 <code>traceroute</code> 以低 TTL（生存时间）数据包开始，并不断增加直至到达目标。 Nmap 的跟踪路由从高 TTL 的数据包开始，并不断减少它。</p>
<p>在下面的示例中，我们在 AttackBox 上执行了 <code>nmap -sS --traceroute 10.10.212.228</code> 。我们可以看到两者之间没有路由器/跃点，因为它们是直接连接的。</p>
<pre><code class="hljs scss">pentester<span class="hljs-keyword">@TryHackMe</span>$ sudo nmap -sS --traceroute <span class="hljs-number">10.10</span>.<span class="hljs-number">212.228</span>

Starting Nmap <span class="hljs-number">7.60</span> ( <span class="hljs-attribute">https</span>://nmap.org ) at <span class="hljs-number">2021</span>-<span class="hljs-number">09</span>-<span class="hljs-number">10</span> <span class="hljs-number">05</span>:<span class="hljs-number">05</span> BST
Nmap <span class="hljs-attribute">scan</span> report for <span class="hljs-number">10.10</span>.<span class="hljs-number">212.228</span>
Host is up (<span class="hljs-number">0.0015s</span> latency).
<span class="hljs-keyword">Not</span> <span class="hljs-attribute">shown</span>: <span class="hljs-number">994</span> closed ports
PORT    STATE SERVICE
<span class="hljs-number">22</span>/tcp  open  ssh
<span class="hljs-number">25</span>/tcp  open  smtp
<span class="hljs-number">80</span>/tcp  open  http
<span class="hljs-number">110</span>/tcp open  pop3
<span class="hljs-number">111</span>/tcp open  rpcbind
<span class="hljs-number">143</span>/tcp open  imap
MAC <span class="hljs-attribute">Address</span>: <span class="hljs-number">02</span>:A0:E7:B5:B6:C5 (Unknown)

TRACEROUTE
HOP RTT     ADDRESS
<span class="hljs-number">1</span>   <span class="hljs-number">1.48</span> ms MACHINE_IP

Nmap <span class="hljs-attribute">done</span>: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">1.59</span> seconds</code></pre>
<p>值得一提的是，许多路由器都配置为不发送超出生存时间的 ICMP，这会阻止我们发现它们的 IP 地址。欲了解更多信息，请访问主动侦察室。</p>
<pre><code class="hljs scss">nmap -sS -O <span class="hljs-number">10.10</span><span class="hljs-selector-class">.212</span><span class="hljs-selector-class">.228</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310105353268.png" alt="image-20240310105353268"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310105431451.png" alt="image-20240310105431451"></p>
<h2 id="nmap-脚本-nse">Nmap 脚本 NSE</h2>
<p>脚本是一段不需要编译的代码。换句话说，它保持原来的人类可读形式，不需要转换为机器语言。许多程序通过脚本提供附加功能；此外，脚本可以添加通过内置命令不存在的自定义功能。同样，Nmap 也提供对使用 Lua 语言的脚本的支持。 Nmap 脚本引擎（NSE）是 Nmap 的一部分，是一个 Lua 解释器，允许 Nmap 执行用 Lua 语言编写的 Nmap 脚本。然而，我们不需要学习 Lua 来使用 Nmap 脚本。</p>
<p>您的 Nmap 默认安装可以轻松包含近 600 个脚本。查看 Nmap 安装文件夹。在 AttackBox 上，检查 <code>/usr/share/nmap/scripts</code> 处的文件，您会注意到有数百个脚本，以它们的目标协议开头，方便命名。我们在下面的控制台输出中列出了 AttackBox 上以 HTTP 开头的所有脚本；我们发现了大约 130 个以 http 开头的脚本。随着未来的更新，您只能期望安装的脚本数量会增加。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310105636735.png" alt="image-20240310105636735"></p>
<p>您可以指定使用这些已安装脚本中的任何一个或一组；此外，您可以安装其他用户的脚本并将其用于扫描。让我们从默认脚本开始。您可以选择使用 <code>--script=default</code> 或简单地添加 <code>-sC</code> 来运行默认类别中的脚本。除了默认之外，类别还包括身份验证、广播、暴力、默认、发现、dos、漏洞利用、外部、模糊器、侵入、恶意软件、安全、版本和漏洞。简要说明如下表所示。</p>
<table>
<thead>
<tr>
<th>Script Category</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auth</code></td>
<td>认证相关脚本</td>
</tr>
<tr>
<td><code>broadcast</code></td>
<td>通过发送广播消息发现主机</td>
</tr>
<tr>
<td><code>brute</code></td>
<td>对登录执行暴力密码审核</td>
</tr>
<tr>
<td><code>default</code></td>
<td>默认脚本，与 <code>-sC</code> 相同</td>
</tr>
<tr>
<td><code>discovery</code></td>
<td>检索可访问的信息，例如数据库表和 DNS 名称</td>
</tr>
<tr>
<td><code>dos</code></td>
<td>检测易受拒绝服务 (DoS) 攻击的服务器</td>
</tr>
<tr>
<td><code>exploit</code></td>
<td>尝试利用各种易受攻击的服务</td>
</tr>
<tr>
<td><code>external</code></td>
<td>使用第三方服务进行检查，例如 Geoplugin 和 Virustotal</td>
</tr>
<tr>
<td><code>fuzzer</code></td>
<td>发起模糊攻击</td>
</tr>
<tr>
<td><code>intrusive</code></td>
<td>暴力攻击和利用等侵入性脚本</td>
</tr>
<tr>
<td><code>malware</code></td>
<td>扫描后门</td>
</tr>
<tr>
<td><code>safe</code></td>
<td>不会使目标崩溃的安全脚本</td>
</tr>
<tr>
<td><code>version</code></td>
<td>检索服务版本</td>
</tr>
<tr>
<td><code>vuln</code></td>
<td>检查漏洞或利用易受攻击的服务</td>
</tr>
</tbody>
</table>
<p>有些脚本属于多个类别。此外，一些脚本对服务发起暴力攻击，而另一些脚本则发起 DoS 攻击并利用系统。因此，如果您不想使服务崩溃或利用它们，那么在选择要运行的脚本时要小心，这一点至关重要。</p>
<p>我们使用 Nmap 对 <code>10.10.104.195</code> 运行 SYN 扫描，并在控制台中执行默认脚本，如下所示。该命令是 <code>sudo nmap -sS -sC 10.10.104.195</code> ，其中 <code>-sC</code> 将确保 Nmap 在 SYN 扫描之后执行默认脚本。下面出现了新的详细信息。查看22端口的SSH服务； Nmap 恢复了与正在运行的服务器相关的所有四个公钥。考虑另一个例子，端口 80 上的 HTTP 服务； Nmap 检索默认页面标题。我们可以看到该页面已保留为默认页面。</p>
<pre><code class="hljs scss">pentester<span class="hljs-keyword">@TryHackMe</span>$ sudo nmap -sS -sC <span class="hljs-number">10.10</span>.<span class="hljs-number">104.195</span>

Starting Nmap <span class="hljs-number">7.60</span> ( <span class="hljs-attribute">https</span>://nmap.org ) at <span class="hljs-number">2021</span>-<span class="hljs-number">09</span>-<span class="hljs-number">10</span> <span class="hljs-number">05</span>:<span class="hljs-number">08</span> BST
Nmap <span class="hljs-attribute">scan</span> report for ip-<span class="hljs-number">10</span>-<span class="hljs-number">10</span>-<span class="hljs-number">161</span>-<span class="hljs-number">170</span>.eu-west-<span class="hljs-number">1</span>.compute.internal (<span class="hljs-number">10.10</span>.<span class="hljs-number">161.170</span>)
Host is up (<span class="hljs-number">0.0011s</span> latency).
<span class="hljs-keyword">Not</span> <span class="hljs-attribute">shown</span>: <span class="hljs-number">994</span> closed ports
PORT    STATE SERVICE
<span class="hljs-number">22</span>/tcp  open  ssh
| <span class="hljs-attribute">ssh-hostkey</span>: 
|   <span class="hljs-number">1024</span> d5:<span class="hljs-number">80</span>:<span class="hljs-number">97</span>:a3:a8:<span class="hljs-number">3</span><span class="hljs-attribute">b</span>:<span class="hljs-number">57</span>:<span class="hljs-number">78</span>:<span class="hljs-number">2</span><span class="hljs-attribute">f</span>:<span class="hljs-number">0</span><span class="hljs-attribute">a</span>:<span class="hljs-number">78</span>:<span class="hljs-attribute">ae</span>:<span class="hljs-attribute">ad</span>:<span class="hljs-number">34</span>:<span class="hljs-number">24</span>:f4 (DSA)
|   <span class="hljs-number">2048</span> <span class="hljs-attribute">aa</span>:<span class="hljs-number">66</span>:<span class="hljs-number">7</span><span class="hljs-attribute">a</span>:<span class="hljs-number">45</span>:<span class="hljs-attribute">eb</span>:d1:<span class="hljs-number">8</span><span class="hljs-attribute">c</span>:<span class="hljs-number">00</span>:e3:<span class="hljs-number">12</span>:<span class="hljs-number">31</span>:d8:<span class="hljs-number">76</span>:<span class="hljs-number">8</span><span class="hljs-attribute">e</span>:<span class="hljs-attribute">ed</span>:<span class="hljs-number">3</span>a (RSA)
|   <span class="hljs-number">256</span> <span class="hljs-number">3</span><span class="hljs-attribute">d</span>:<span class="hljs-number">82</span>:<span class="hljs-number">72</span>:a3:<span class="hljs-number">07</span>:<span class="hljs-number">49</span>:<span class="hljs-number">2</span><span class="hljs-attribute">e</span>:<span class="hljs-attribute">cb</span>:d9:<span class="hljs-number">87</span>:<span class="hljs-attribute">db</span>:<span class="hljs-number">08</span>:c6:<span class="hljs-number">90</span>:<span class="hljs-number">56</span>:<span class="hljs-number">65</span> (ECDSA)
|_  <span class="hljs-number">256</span> <span class="hljs-attribute">dc</span>:f0:<span class="hljs-number">0</span><span class="hljs-attribute">c</span>:<span class="hljs-number">89</span>:<span class="hljs-number">70</span>:<span class="hljs-number">87</span>:<span class="hljs-number">65</span>:<span class="hljs-attribute">ba</span>:<span class="hljs-number">52</span>:b1:e9:<span class="hljs-number">59</span>:f7:<span class="hljs-number">5</span><span class="hljs-attribute">d</span>:d2:<span class="hljs-number">6</span>a (EdDSA)
<span class="hljs-number">25</span>/tcp  open  smtp
|_<span class="hljs-attribute">smtp-commands</span>: debra2.thm.local, PIPELINING, SIZE <span class="hljs-number">10240000</span>, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, <span class="hljs-number">8</span>BITMIME, DSN, 
| <span class="hljs-attribute">ssl-cert</span>: <span class="hljs-attribute">Subject</span>: commonName=debra2.thm.local
| <span class="hljs-keyword">Not</span> valid <span class="hljs-attribute">before</span>: <span class="hljs-number">2021</span>-<span class="hljs-number">08</span>-<span class="hljs-number">10</span>T12:<span class="hljs-number">10</span>:<span class="hljs-number">58</span>
|_<span class="hljs-keyword">Not</span> valid <span class="hljs-attribute">after</span>:  <span class="hljs-number">2031</span>-<span class="hljs-number">08</span>-<span class="hljs-number">08</span>T12:<span class="hljs-number">10</span>:<span class="hljs-number">58</span>
|_<span class="hljs-attribute">ssl-date</span>: TLS randomness does <span class="hljs-keyword">not</span> represent time
<span class="hljs-number">80</span>/tcp  open  http
|_<span class="hljs-attribute">http-title</span>: Welcome to nginx on Debian!
<span class="hljs-number">110</span>/tcp open  pop3
|_pop3<span class="hljs-attribute">-capabilities</span>: RESP-CODES CAPA TOP SASL UIDL PIPELINING AUTH-RESP-CODE
<span class="hljs-number">111</span>/tcp open  rpcbind
| <span class="hljs-attribute">rpcinfo</span>: 
|   program version   port/proto  service
|   <span class="hljs-number">100000</span>  <span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>        <span class="hljs-number">111</span>/tcp  rpcbind
|   <span class="hljs-number">100000</span>  <span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>        <span class="hljs-number">111</span>/udp  rpcbind
|   <span class="hljs-number">100024</span>  <span class="hljs-number">1</span>          <span class="hljs-number">38099</span>/tcp  status
|_  <span class="hljs-number">100024</span>  <span class="hljs-number">1</span>          <span class="hljs-number">54067</span>/udp  status
<span class="hljs-number">143</span>/tcp open  imap
|_<span class="hljs-attribute">imap-capabilities</span>: LITERAL+ capabilities IMAP4rev1 OK Pre-login ENABLE have LOGINDISABLEDA0001 listed SASL-IR ID more post-login LOGIN-REFERRALS IDLE
MAC <span class="hljs-attribute">Address</span>: <span class="hljs-number">02</span>:A0:E7:B5:B6:C5 (Unknown)

Nmap <span class="hljs-attribute">done</span>: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">2.21</span> seconds</code></pre>
<p>您还可以使用 <code>--script "SCRIPT-NAME"</code> 或 <code>--script "ftp*"</code> 等模式按名称指定脚本，其中包括 <code>ftp-brute</code> 。如果您不确定脚本的作用，可以使用文本阅读器（例如 <code>less</code> ）或文本编辑器打开脚本文件。对于 <code>ftp-brute</code> ，它指出：“对 FTP 服务器执行暴力密码审核。”您必须小心，因为某些脚本非常具有侵入性。此外，某些脚本可能适用于特定服务器，如果随机选择，则会浪费您的时间而没有任何好处。与往常一样，请确保您有权在目标服务器上启动此类测试。</p>
<p>让我们考虑一个良性脚本 <code>http-date</code> ，我们猜测它会检索 http 服务器日期和时间，这在其描述中确实得到了证实：“从类似 HTTP 的服务获取日期。此外，它还会打印日期与当地时间的差异……”在 AttackBox 上，我们执行 <code>sudo nmap -sS -n --script "http-date" 10.10.104.195</code> ，如下面的控制台所示。</p>
<pre><code class="hljs scss">pentester<span class="hljs-keyword">@TryHackMe</span>$ sudo nmap -sS -n --script <span class="hljs-string">"http-date"</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">104.195</span>

Starting Nmap <span class="hljs-number">7.60</span> ( <span class="hljs-attribute">https</span>://nmap.org ) at <span class="hljs-number">2021</span>-<span class="hljs-number">09</span>-<span class="hljs-number">10</span> <span class="hljs-number">08</span>:<span class="hljs-number">04</span> BST
Nmap <span class="hljs-attribute">scan</span> report for <span class="hljs-number">10.10</span>.<span class="hljs-number">104.195</span>
Host is up (<span class="hljs-number">0.0011s</span> latency).
<span class="hljs-keyword">Not</span> <span class="hljs-attribute">shown</span>: <span class="hljs-number">994</span> closed ports
PORT    STATE SERVICE
<span class="hljs-number">22</span>/tcp  open  ssh
<span class="hljs-number">25</span>/tcp  open  smtp
<span class="hljs-number">80</span>/tcp  open  http
|_<span class="hljs-attribute">http-date</span>: Fri, <span class="hljs-number">10</span> Sep <span class="hljs-number">2021</span> <span class="hljs-number">07</span>:<span class="hljs-number">04</span>:<span class="hljs-number">26</span> GMT; <span class="hljs-number">0s</span> from local <span class="hljs-selector-tag">time</span>.
<span class="hljs-number">110</span>/tcp open  pop3
<span class="hljs-number">111</span>/tcp open  rpcbind
<span class="hljs-number">143</span>/tcp open  imap
MAC <span class="hljs-selector-tag">Address</span>: <span class="hljs-number">02</span>:<span class="hljs-number">44</span>:<span class="hljs-number">87</span>:<span class="hljs-number">82</span>:AC:<span class="hljs-number">83</span> (Unknown)

Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">1.78</span> seconds</code></pre>
<p>最后，您可以将 Nmap 的功能扩展到官方 Nmap 脚本之外；您可以编写脚本或从 Internet 下载 Nmap 脚本。从 Internet 下载和使用 Nmap 脚本存在一定程度的风险。因此，最好不要运行您不信任的作者的脚本。</p>
<p>知道 Nmap 脚本保存在 AttackBox 上的 <code>/usr/share/nmap/scripts</code> 中。脚本 <code>http-robots.txt</code> 检查什么？</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310110340479.png" alt="image-20240310110340479"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310110620238.png" alt="image-20240310110620238"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310110625843.png" alt="image-20240310110625843"></p>
<p>如果尚未启动 AttackBox，请启动它。确保已从任务 2 终止 VM 后，启动此任务的目标计算机。在 AttackBox 上，使用默认脚本 <code>-sC</code> 针对 <code>10.10.104.195</code> 运行 Nmap。您会注意到有一个服务正在侦听端口 53。它的完整版本值是多少？</p>
<pre><code class="hljs scss">nmap -sC -sS -T4 <span class="hljs-number">10.10</span><span class="hljs-selector-class">.104</span><span class="hljs-selector-class">.195</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310110745210.png" alt="image-20240310110745210"></p>
<p>根据其描述，脚本 <code>ssh2-enum-algos</code> “报告目标 SSH2 服务器提供的算法数量（用于加密、压缩等）。”依赖于“sha1”并受 <code>10.10.104.195</code> 支持的密钥交换算法 (kex_algorithms) 的名称是什么？</p>
<pre><code class="hljs scss">nmap -sS <span class="hljs-attr">--script</span> "ssh2-enum-algos" <span class="hljs-number">10.10</span><span class="hljs-selector-class">.104</span><span class="hljs-selector-class">.195</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310111013725.png" alt="image-20240310111013725"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310111020608.png" alt="image-20240310111020608"></p>
<h2 id="保存输出">保存输出</h2>
<p>每当您运行Nmap扫描时，将结果保存在文件中是合理的。选择和采用良好的命名约定对于文件名至关重要。文件数量可能会快速增长，并且可能妨碍您查找先前的扫描结果。主要的三种格式有：</p>
<ol>
<li>Normal</li>
<li>Grepable (<code>grep</code>able)</li>
<li>XML</li>
</ol>
<p>我们不推荐第四种：Script Kiddie 脚本小子</p>
<h3 id="normal-普通的">Normal 普通的</h3>
<p>顾名思义，正常格式类似于扫描目标时在屏幕上获得的输出。您可以使用 <code>-oN FILENAME</code> 以正常格式保存扫描结果； N代表正常。这是结果的示例。</p>
<pre><code class="hljs scss">pentester<span class="hljs-keyword">@TryHackMe</span>$ cat <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>_<span class="hljs-attribute">scan</span>.nmap 
# Nmap <span class="hljs-number">7.60</span> <span class="hljs-attribute">scan</span> initiated Fri Sep <span class="hljs-number">10</span> <span class="hljs-number">05</span>:<span class="hljs-number">14</span>:<span class="hljs-number">19</span> <span class="hljs-number">2021</span> <span class="hljs-attribute">as</span>: nmap -sS -sV -O -oN <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>_<span class="hljs-attribute">scan</span> MACHINE_IP
Nmap <span class="hljs-attribute">scan</span> report for <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>
Host is up (<span class="hljs-number">0.00086s</span> latency).
<span class="hljs-keyword">Not</span> <span class="hljs-attribute">shown</span>: <span class="hljs-number">994</span> closed ports
PORT    STATE SERVICE VERSION
<span class="hljs-number">22</span>/tcp  open  ssh     OpenSSH <span class="hljs-number">6.7</span>p1 Debian <span class="hljs-number">5</span>+deb8u8 (protocol <span class="hljs-number">2.0</span>)
<span class="hljs-number">25</span>/tcp  open  smtp    Postfix smtpd
<span class="hljs-number">80</span>/tcp  open  http    nginx <span class="hljs-number">1.6</span>.<span class="hljs-number">2</span>
<span class="hljs-number">110</span>/tcp open  pop3    Dovecot pop3d
<span class="hljs-number">111</span>/tcp open  rpcbind <span class="hljs-number">2</span>-<span class="hljs-number">4</span> (RPC <span class="hljs-number">#100000</span>)
<span class="hljs-number">143</span>/tcp open  imap    Dovecot imapd
MAC <span class="hljs-attribute">Address</span>: <span class="hljs-number">02</span>:A0:E7:B5:B6:C5 (Unknown)
Device <span class="hljs-attribute">type</span>: general purpose
<span class="hljs-attribute">Running</span>: Linux <span class="hljs-number">3</span>.X
OS <span class="hljs-attribute">CPE</span>: <span class="hljs-attribute">cpe</span>:/<span class="hljs-attribute">o</span>:<span class="hljs-attribute">linux</span>:linux_<span class="hljs-attribute">kernel</span>:<span class="hljs-number">3.13</span>
OS <span class="hljs-attribute">details</span>: Linux <span class="hljs-number">3.13</span>
Network <span class="hljs-attribute">Distance</span>: <span class="hljs-number">1</span> hop
Service <span class="hljs-attribute">Info</span>: <span class="hljs-attribute">Host</span>:  debra2.thm.local; OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Sep <span class="hljs-number">10</span> <span class="hljs-number">05</span>:<span class="hljs-number">14</span>:<span class="hljs-number">28</span> <span class="hljs-number">2021</span> -- <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">9.99</span> seconds</code></pre>
<h3 id="grepable">Grepable</h3>
<p>grepable 格式的名称来自命令 <code>grep</code> ； grep 代表全局正则表达式打印机。简而言之，它可以高效地过滤扫描输出中的特定关键字或术语。您可以使用 <code>-oG FILENAME</code> 将扫描结果保存为 grepable 格式。上面以正常格式显示的扫描输出使用 grepable 格式显示在下面的控制台中。正常输出为21行；然而，grepable 输出只有 4 行。主要原因是 Nmap 希望在用户应用 <code>grep</code> 时使每一行都有意义且完整。因此，在 grepable 输出中，与正常输出相比，行很长并且不方便阅读。</p>
<pre><code class="hljs scss">pentester<span class="hljs-keyword">@TryHackMe</span>$ cat <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>_<span class="hljs-attribute">scan</span>.gnmap 
# Nmap <span class="hljs-number">7.60</span> <span class="hljs-attribute">scan</span> initiated Fri Sep <span class="hljs-number">10</span> <span class="hljs-number">05</span>:<span class="hljs-number">14</span>:<span class="hljs-number">19</span> <span class="hljs-number">2021</span> <span class="hljs-attribute">as</span>: nmap -sS -sV -O -oG <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>_<span class="hljs-attribute">scan</span> MACHINE_IP
<span class="hljs-attribute">Host</span>: <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>	<span class="hljs-attribute">Status</span>: Up
<span class="hljs-attribute">Host</span>: MACHINE_IP	<span class="hljs-attribute">Ports</span>: <span class="hljs-number">22</span>/open/tcp//ssh//OpenSSH <span class="hljs-number">6.7</span>p1 Debian <span class="hljs-number">5</span>+deb8u8 (protocol <span class="hljs-number">2.0</span>)/, <span class="hljs-number">25</span>/open/tcp//smtp//Postfix smtpd/, <span class="hljs-number">80</span>/open/tcp//http//nginx <span class="hljs-number">1.6</span>.<span class="hljs-number">2</span>/, <span class="hljs-number">110</span>/open/tcp//pop3//Dovecot pop3d/, <span class="hljs-number">111</span>/open/tcp//rpcbind//<span class="hljs-number">2</span>-<span class="hljs-number">4</span> (RPC <span class="hljs-number">#100000</span>)/, <span class="hljs-number">143</span>/open/tcp//imap//Dovecot imapd/	Ignored <span class="hljs-attribute">State</span>: closed (<span class="hljs-number">994</span>)	<span class="hljs-attribute">OS</span>: Linux <span class="hljs-number">3.13</span>	Seq <span class="hljs-attribute">Index</span>: <span class="hljs-number">257</span>	IP ID <span class="hljs-attribute">Seq</span>: All zeros
# Nmap done at Fri Sep <span class="hljs-number">10</span> <span class="hljs-number">05</span>:<span class="hljs-number">14</span>:<span class="hljs-number">28</span> <span class="hljs-number">2021</span> -- <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">9.99</span> seconds</code></pre>
<p><code>grep</code> 的一个使用示例是 <code>grep KEYWORD TEXT_FILE</code> ；该命令将显示包含所提供的关键字的所有行。让我们比较一下在正常输出和 grepable 输出上使用 <code>grep</code> 的输出。您会注意到，前者不提供主机的 IP 地址。相反，它返回 <code>80/tcp open http nginx 1.6.2</code> ，如果您要筛选多个系统的扫描结果，这会非常不方便。然而，后者在每一行中提供了足够的信息，例如主机的 IP 地址，以使其完整。</p>
<pre><code class="hljs scss">pentester<span class="hljs-keyword">@TryHackMe</span>$ grep http <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>_<span class="hljs-attribute">scan</span>.nmap 
<span class="hljs-number">80</span>/tcp  open  http    nginx <span class="hljs-number">1.6</span>.<span class="hljs-number">2</span>
OS <span class="hljs-keyword">and</span> Service detection performed. Please report any incorrect results at <span class="hljs-attribute">https</span>://nmap.org/submit/ .</code></pre>
<pre><code class="hljs scss">pentester<span class="hljs-keyword">@TryHackMe</span>$ grep http <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>_<span class="hljs-attribute">scan</span>.gnmap 
<span class="hljs-attribute">Host</span>: <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>	<span class="hljs-attribute">Ports</span>: <span class="hljs-number">22</span>/open/tcp//ssh//OpenSSH <span class="hljs-number">6.7</span>p1 Debian <span class="hljs-number">5</span>+deb8u8 (protocol <span class="hljs-number">2.0</span>)/, <span class="hljs-number">25</span>/open/tcp//smtp//Postfix smtpd/, <span class="hljs-number">80</span>/open/tcp//http//nginx <span class="hljs-number">1.6</span>.<span class="hljs-number">2</span>/, <span class="hljs-number">110</span>/open/tcp//pop3//Dovecot pop3d/, <span class="hljs-number">111</span>/open/tcp//rpcbind//<span class="hljs-number">2</span>-<span class="hljs-number">4</span> (RPC <span class="hljs-number">#100000</span>)/, <span class="hljs-number">143</span>/open/tcp//imap//Dovecot imapd/	Ignored <span class="hljs-attribute">State</span>: closed (<span class="hljs-number">994</span>)	<span class="hljs-attribute">OS</span>: Linux <span class="hljs-number">3.13</span>	Seq <span class="hljs-attribute">Index</span>: <span class="hljs-number">257</span>	IP ID <span class="hljs-attribute">Seq</span>: All zeros</code></pre>
<h3 id="xml">XML</h3>
<p>第三种格式是XML。您可以使用<code>-oX FILENAME</code>将扫描结果以XML格式保存。XML格式最方便用于在其他程序中处理输出。方便的是，您可以使用<code>-oA FILENAME</code>将扫描输出以所有三种格式保存，即结合了普通格式（-oN）、可grep格式（-oG）和XML格式（-oX）。</p>
<h3 id="脚本小子">脚本小子</h3>
<p>第四种格式是脚本小子。您可以看到，如果您想在输出中搜索任何有趣的关键字或保留结果以供将来参考，则此格式毫无用处。但是，您可以使用它来保存扫描的输出 <code>nmap -sS 127.0.0.1 -oS FILENAME</code> ，显示输出文件名，并在不懂技术的朋友面前查看 31337 。</p>
<pre><code class="hljs scss">pentester<span class="hljs-keyword">@TryHackMe</span>$ cat <span class="hljs-number">10.10</span>.<span class="hljs-number">87.205</span>_<span class="hljs-attribute">scan</span>.kiddie 

<span class="hljs-variable">$tart</span>!ng nMaP <span class="hljs-number">7.60</span> ( <span class="hljs-attribute">httpz</span>://nMap.<span class="hljs-number">0</span>rG ) at <span class="hljs-number">2021</span>-<span class="hljs-number">09</span>-<span class="hljs-number">10</span> <span class="hljs-number">05</span>:<span class="hljs-number">17</span> B<span class="hljs-variable">$T</span>
Nmap <span class="hljs-attribute">scan</span> rEp0rt f0r |p-<span class="hljs-number">10</span>-<span class="hljs-number">10</span>-<span class="hljs-number">161</span>-<span class="hljs-number">170</span>.EU-w3<span class="hljs-variable">$t-1</span>.C0mputE.intErnaL (<span class="hljs-number">10.10</span>.<span class="hljs-number">161.170</span>)
HOSt !s uP (<span class="hljs-number">0.00095s</span> LatEncy).
N0T <span class="hljs-variable">$H0wn</span>: <span class="hljs-number">994</span> closed pOrtS
PoRT    st4Te SeRViC3 VERS1on
<span class="hljs-number">22</span>/tcp  Open  ssH     Op3n$<span class="hljs-variable">$H</span> <span class="hljs-number">6.7</span>p1 Deb|an <span class="hljs-number">5</span>+dEb8u8 (pr0t0COl <span class="hljs-number">2.0</span>)
<span class="hljs-number">25</span>/tCp  Op3n  SmTp    P0<span class="hljs-variable">$Tf</span>!x Smtpd
<span class="hljs-number">80</span>/tcp  <span class="hljs-number">0</span>p3n  http    Ng1nx <span class="hljs-number">1.6</span>.<span class="hljs-number">2</span>
<span class="hljs-number">110</span>/tCP <span class="hljs-number">0</span>pen  pOP3    d0v3coT P0p3D
<span class="hljs-number">111</span>/TcP op3n  RpcbInd <span class="hljs-number">2</span>-<span class="hljs-number">4</span> (RPC <span class="hljs-number">#100000</span>)
<span class="hljs-number">143</span>/Tcp opEn  Imap    Dovecot <span class="hljs-number">1</span>mApd
mAC <span class="hljs-number">4</span>Ddr3<span class="hljs-attribute">sz</span>: <span class="hljs-number">02</span>:<span class="hljs-number">40</span>:e7:B5:B6:c5 (Unknown)
Netw0rk d!stanc3: <span class="hljs-number">1</span> h0p
$<span class="hljs-number">3</span>rv1c3 <span class="hljs-attribute">InFO</span>: Ho<span class="hljs-variable">$t</span>:  dEBra2.thM.lOcal; <span class="hljs-number">0s</span>: Linux; cPe: cP3:/<span class="hljs-number">0</span>:linux:l|nux_k3rnel

<span class="hljs-number">0S</span> and servIc3 D3tEcti0n pErf0rm3d. Plea<span class="hljs-variable">$e</span> r3p0rt any !nc0RrecT rE<span class="hljs-variable">$ultz</span> at hTtpz://nmap.<span class="hljs-number">0</span>rg/<span class="hljs-variable">$ubmit</span>/ .
Nmap d0nE: <span class="hljs-number">1</span> |P addr3SS (<span class="hljs-number">1</span> hoSt up) <span class="hljs-variable">$CaNnEd</span> !n <span class="hljs-number">21.80</span> s3c0Ndz</code></pre>
<p>终止上一个任务的目标机器并启动本任务的目标机器。在 AttackBox 终端上，发出命令 <code>scp pentester@10.10.87.205:/home/pentester/* .</code> 从目标虚拟机下载正常格式和 grepable 格式的 Nmap 报告。</p>
<p>请注意，用户名 <code>pentester</code> 的密码为 <code>THM17577</code></p>
<p>检查附加的 Nmap 日志。有多少系统正在侦听 HTTPS 端口？</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310112055114.png" alt="image-20240310112055114"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310112105178.png" alt="image-20240310112105178"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240310112045359.png" alt="image-20240310112045359"></p>
<h2 id="总结">总结</h2>
<p>在这个房间中，我们学习了如何检测正在运行的服务及其版本以及主机操作系统。我们学习了如何启用跟踪路由，并介绍了选择一个或多个脚本来帮助渗透测试。最后，我们介绍了保存扫描结果以供将来参考的不同格式。下表总结了我们在这个房间中讨论的最重要的选项。</p>
<table>
<thead>
<tr>
<th>Option 选项</th>
<th>Meaning 意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-sV</code></td>
<td>确定开放端口上的服务/版本信息</td>
</tr>
<tr>
<td><code>-sV --version-light</code></td>
<td>尝试最有可能的探针 (2)</td>
</tr>
<tr>
<td><code>-sV --version-all</code></td>
<td>尝试所有可用的探针 (9)</td>
</tr>
<tr>
<td><code>-O</code></td>
<td>检测操作系统</td>
</tr>
<tr>
<td><code>--traceroute</code></td>
<td>运行traceroute到目标</td>
</tr>
<tr>
<td><code>--script=SCRIPTS</code></td>
<td>要运行的 Nmap 脚本</td>
</tr>
<tr>
<td><code>-sC</code> or <code>--script=default</code> <code>-sC</code> 或 <code>--script=default</code></td>
<td>运行默认脚本</td>
</tr>
<tr>
<td><code>-A</code></td>
<td>相当于 <code>-sV -O -sC --traceroute</code></td>
</tr>
<tr>
<td><code>-oN</code></td>
<td>以正常格式保存输出</td>
</tr>
<tr>
<td><code>-oG</code></td>
<td>以 grepable 格式保存输出</td>
</tr>
<tr>
<td><code>-oX</code></td>
<td>以 XML 格式保存输出</td>
</tr>
<tr>
<td><code>-oA</code></td>
<td>以普通、XML 和 Grepable 格式保存输出</td>
</tr>
</tbody>
</table>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2024/02/16/thm-nmap/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2024/02/16/thm-nmap/')">THM-Nmap</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2024/02/16/thm-nmap/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=THM-Nmap&amp;url=http://hybcx.xyz/2024/02/16/thm-nmap/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/TryHackMe/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>TryHackMe<span class="tagsPageCount">42</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/02/16/thm-lateral-movement-and-pivoting/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">THM-Lateral Movement and Pivoting</div></div></a></div><div class="next-post pull-right"><a href="/2024/02/19/thm-persisting-active-directory/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">THM-Persisting Active Directory</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/08/08/thm-bypass-uac/" title="THM-ByPass_UAC"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-08-08</div><div class="title">THM-ByPass_UAC</div></div></a></div><div><a href="/2024/02/14/thm-basic-pentesting/" title="THM-Basic Pentesting"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-14</div><div class="title">THM-Basic Pentesting</div></div></a></div><div><a href="/2024/07/10/thm-c2-jian-jie/" title="THM-C2简介"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-10</div><div class="title">THM-C2简介</div></div></a></div><div><a href="/2024/06/17/thm-corp/" title="THM-Corp"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-17</div><div class="title">THM-Corp</div></div></a></div><div><a href="/2024/06/09/thm-enumerating-active-directory/" title="THM-Enumerating Active Directory"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-09</div><div class="title">THM-Enumerating Active Directory</div></div></a></div><div><a href="/2024/07/16/thm-enumeration/" title="THM-Enumeration"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-16</div><div class="title">THM-Enumeration</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">0x01 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-nmap%E9%80%89%E9%A1%B9"><span class="toc-number">2.</span> <span class="toc-text">0x02 Nmap选项</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-%E6%89%AB%E6%8F%8F%E7%B1%BB%E5%9E%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">3.</span> <span class="toc-text">0x03 扫描类型概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-tcp-%E6%89%AB%E6%8F%8F"><span class="toc-number">4.</span> <span class="toc-text">0x04 TCP 扫描</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-syn-%E6%89%AB%E6%8F%8F"><span class="toc-number">5.</span> <span class="toc-text">0x05 SYN 扫描</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-udp-%E6%89%AB%E6%8F%8F"><span class="toc-number">6.</span> <span class="toc-text">0x06 UDP 扫描</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-null-fin-xmas%E6%89%AB%E6%8F%8F"><span class="toc-number">7.</span> <span class="toc-text">0x07 NULL、FIN、Xmas扫描</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-icmp-%E6%89%AB%E6%8F%8F"><span class="toc-number">8.</span> <span class="toc-text">0x08 ICMP 扫描</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-nse-%E8%84%9A%E6%9C%AC%E6%A6%82%E8%BF%B0"><span class="toc-number">9.</span> <span class="toc-text">0x09 NSE 脚本概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x10-%E4%BD%BF%E7%94%A8-nse-%E8%84%9A%E6%9C%AC"><span class="toc-number">10.</span> <span class="toc-text">0x10 使用 NSE 脚本</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x11-nse-%E6%90%9C%E7%B4%A2%E8%84%9A%E6%9C%AC"><span class="toc-number">11.</span> <span class="toc-text">0x11 NSE 搜索脚本</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x12-%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E9%81%BF"><span class="toc-number">12.</span> <span class="toc-text">0x12 防火墙规避</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x13-%E5%AE%9E%E8%B7%B5"><span class="toc-number">13.</span> <span class="toc-text">0x13 实践</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x14-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">14.</span> <span class="toc-text">0x14 参考文章</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x15-nmap-%E5%90%8E%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">15.</span> <span class="toc-text">0x15 Nmap 后端口扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%A3%80%E6%B5%8B"><span class="toc-number">15.1.</span> <span class="toc-text">服务检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A3%80%E6%B5%8B%E5%92%8Ctraceroute"><span class="toc-number">15.2.</span> <span class="toc-text">操作系统检测和Traceroute</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A3%80%E6%B5%8B"><span class="toc-number">15.2.1.</span> <span class="toc-text">操作系统检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%BF%BD%E8%B8%AA"><span class="toc-number">15.2.2.</span> <span class="toc-text">路由追踪</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap-%E8%84%9A%E6%9C%AC-nse"><span class="toc-number">15.3.</span> <span class="toc-text">Nmap 脚本 NSE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E8%BE%93%E5%87%BA"><span class="toc-number">15.4.</span> <span class="toc-text">保存输出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#normal-%E6%99%AE%E9%80%9A%E7%9A%84"><span class="toc-number">15.4.1.</span> <span class="toc-text">Normal 普通的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#grepable"><span class="toc-number">15.4.2.</span> <span class="toc-text">Grepable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xml"><span class="toc-number">15.4.3.</span> <span class="toc-text">XML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E5%B0%8F%E5%AD%90"><span class="toc-number">15.4.4.</span> <span class="toc-text">脚本小子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">15.5.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>