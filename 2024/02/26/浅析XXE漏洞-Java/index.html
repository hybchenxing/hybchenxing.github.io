<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>浅析xxe漏洞-Java | hybcx's blog</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem"><a class="navBlock" href="/about"><span class="navItemTitle">About</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>浅析xxe漏洞-Java</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2024-02-26T12:20:29.425Z" id="date"> 2024-02-26</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-02-27T09:03:03.787Z" id="updated"> 2024-02-27</time></div></span><br><span>Word Count: <div class="control">3.5k</div></span><br><span>Read Time: <div class="control">17 min</div></span></div></div><hr><div id="post-content"><h1>0x01 前言</h1>
<p>最近发了学新任务，发现XXE的Java没有学习过，于是想着找几篇文章学习一下。Java水平也垃圾，只是单纯过了过基础语法，学起来对我还是有难度~~~</p>
<p>由于水平垃圾，因此基本就是跟着文章的实验实操一遍，质量可能不高</p>
<h1>0x02 XXE漏洞基础</h1>
<p>这里简单过一下，因为看见有的师傅文章写的基础知识精辟，且仍有需要学习的地方，这里就大部分cv了</p>
<h2 id="XML文档结构："><a href="#XML文档结构：" class="headerlink" title="XML文档结构："></a>XML文档结构：</h2>
<p>XML主要由7个部分组成：文档声明、标签/元素、属性、注释、实体字符、CDATA 字符数据区、处理指令。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--XML文档声明；另外也是一个处理指令，&lt;? xxx ?&gt;就是处理指令的格式--&gt;</span><br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="hljs-comment">&lt;!--bookstore根元素、book子元素--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--category、lang都是属性--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;COOKING&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>Everyday Italian<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> <br>        <span class="hljs-comment">&lt;!--&amp;lt;实体字符 是一个预定义的实体引用，这里也可以引用dtd中定义的实体，以 &amp; 开头, 以;结尾--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>Giada De Laurentiis<span class="hljs-symbol">&amp;lt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>30.00<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--script这里是CDATA，不能被xml解析器解析，可以被JavaScript解析--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span><br><span class="language-xml"><span class="language-handlebars">            &lt;![CDATA[</span></span><br><span class="language-xml"><span class="language-handlebars">   function matchwo(a,b)</span></span><br><span class="language-xml"><span class="language-handlebars">   &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">    if (a &lt; b &amp;&amp; a &lt; 0) then</span></span><br><span class="language-xml"><span class="language-handlebars">      &#123;return 1;&#125;</span></span><br><span class="language-xml"><span class="language-handlebars">    else</span></span><br><span class="language-xml"><span class="language-handlebars">      &#123;return 0;&#125;</span></span><br><span class="language-xml"><span class="language-handlebars">   &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">   ]]&gt;</span></span><br><span class="language-xml"><span class="language-handlebars">        </span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>CDATA 指的是不应由 XML 解析器进行解析的文本数据（Unparsed Character Data）。CDATA 部分中的所有内容都会被解析器忽略。</p>
<p>CDATA 部分由 “**” 结束，某些文本比如 JavaScript 代码，包含大量 “&lt;” 或 “&amp;” 字符。为了避免错误，可以将脚本代码定义为 CDATA。</p>
<h2 id="XML示例："><a href="#XML示例：" class="headerlink" title="XML示例："></a>XML示例：</h2>
<p>如下实例，<code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</code>是XML声明，<code>&lt;!DOCTYPE description [&lt;!ENTITY abc &quot;123213123123123&quot; &gt;]&gt;</code>就是DTD文档类型定义，<code>&lt;description&gt;&amp;abc;&lt;/description&gt;</code>是文档元素 其中abc就是引用的dtd中的abc。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">description</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">abc</span> <span class="hljs-string">&quot;123213123123123&quot;</span> &gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span><span class="hljs-symbol">&amp;abc;</span><span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="DTD文档类型定义："><a href="#DTD文档类型定义：" class="headerlink" title="DTD文档类型定义："></a>DTD文档类型定义：</h2>
<p>DTD（文档类型定义）的作用是定义 XML 文档的合法构建模块。DTD 可以在 XML 文档内声明，也可以从外部引用。DTD实体也分为外部引用和内部定义。</p>
<h3 id="DTD两种引入方式："><a href="#DTD两种引入方式：" class="headerlink" title="DTD两种引入方式："></a>DTD两种引入方式：</h3>
<p>在XML内部声明DTD：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;?xml version=&quot;<span class="hljs-number">1.0</span>&quot;?&gt;<br>&lt;!DOCTYPE note <span class="hljs-selector-attr">[  &lt;!ELEMENT note (to,from,heading,body)&gt;  &lt;!ELEMENT to      (#PCDATA)&gt;  &lt;!ELEMENT from    (#PCDATA)&gt;  &lt;!ELEMENT message (#PCDATA)&gt;]</span>&gt;<br>&lt;note&gt;<br>    &lt;to&gt;George&lt;/to&gt;<br>    &lt;from&gt;John&lt;/from&gt;<br>    &lt;message&gt;Reminder&lt;/message&gt;<br>&lt;/note&gt;<br></code></pre></td></tr></table></figure>
<p>在XML中引入外部DTD文档</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;?xml version=&quot;<span class="hljs-number">1.0</span>&quot;?&gt;<br>&lt;!DOCTYPE note SYSTEM &quot;note<span class="hljs-selector-class">.dtd</span>&quot;&gt;<br>&lt;note&gt;<br>    &lt;to&gt;George&lt;/to&gt;<br>    &lt;from&gt;John&lt;/from&gt;<br>    &lt;message&gt;Reminder&lt;/message&gt;<br>&lt;/note&gt; <br><br>&lt;!--而note<span class="hljs-selector-class">.dtd</span>的内容为:--&gt;<br>&lt;!ELEMENT note (to,from,message)&gt;<br>&lt;!ELEMENT to (#PCDATA)&gt;<br>&lt;!ELEMENT from (#PCDATA)&gt;<br>&lt;!ELEMENT message (#PCDATA)&gt;<br></code></pre></td></tr></table></figure>
<h3 id="DTD实体两种方式："><a href="#DTD实体两种方式：" class="headerlink" title="DTD实体两种方式："></a>DTD实体两种方式：</h3>
<p>实体又分为一般实体和参数实体：一般实体的声明语法<code>&amp;实体名；</code>；参数实体只能在DTD中使用，参数实体的声明格式：<code>%实体名；</code>。</p>
<p>内部实体：</p>
<p>在dtd中定义了一个名为test的实体，实体的值为test-value：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;!ENTITY test &quot;test-value&quot;&gt;<br></code></pre></td></tr></table></figure>
<p><strong>外部实体：</strong></p>
<p>在dtd中定义了一个名为test的实体，实体的值为URL：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;!ENTITY test SYSTEM &quot;URI/URL&quot;&gt;<br>&lt;!ENTITY test SYSTEM &quot;file:///C://<span class="hljs-number">1</span>.dtd<span class="hljs-string">&quot;&gt;</span><br><span class="hljs-string">&lt;!ENTITY test SYSTEM &quot;</span>http://test.com/<span class="hljs-number">1</span>.dtd<span class="hljs-string">&quot;&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="常见的xml解析方式有以下四种"><a href="#常见的xml解析方式有以下四种" class="headerlink" title="常见的xml解析方式有以下四种"></a>常见的xml解析方式有以下四种:</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1)DOM生成和解析XML文档<br><br>2)SAX生成和解析XML文档<br><br>3)DOM4J生成和解析XML文档<br><br>4)JDOM生成和解析DOM文档<br></code></pre></td></tr></table></figure>
<p>SAX是以流的形式读取XML文档中的内容，并在读取过程中自动调用预先定义的处理方法；DOM是将整个xml文档中的内容以tree的形式存储在内存当中，可以对这个tree中的任意一个节点进行操作，SAX则不能。SAX不适合用来修改xml内容，DOM需要耗费大量内存</p>
<h1>0x03 实验</h1>
<p>实操才发现，搭环境对我来说成了大问题。。。。因此这里先简单记录知识，Java下去得补补了</p>
<p>在Java中有很多jar包可以来解析XML：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scss">javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.parsers</span><span class="hljs-selector-class">.DocumentBuilder</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.parsers</span><span class="hljs-selector-class">.SAXParser</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.parsers</span><span class="hljs-selector-class">.SAXParserFactory</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.transform</span><span class="hljs-selector-class">.TransformerFactory</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.Validator</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.SchemaFactory</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.transform</span><span class="hljs-selector-class">.sax</span><span class="hljs-selector-class">.SAXTransformerFactory</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.transform</span><span class="hljs-selector-class">.sax</span><span class="hljs-selector-class">.SAXSource</span><br>org<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.sax</span><span class="hljs-selector-class">.XMLReader</span><br>org<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.sax</span><span class="hljs-selector-class">.helpers</span><span class="hljs-selector-class">.XMLReaderFactory</span><br>org<span class="hljs-selector-class">.dom4j</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.SAXReader</span><br>org<span class="hljs-selector-class">.jdom</span><span class="hljs-selector-class">.input</span><span class="hljs-selector-class">.SAXBuilder</span><br>org<span class="hljs-selector-class">.jdom2</span><span class="hljs-selector-class">.input</span><span class="hljs-selector-class">.SAXBuilder</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.Unmarshaller</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.xpath</span><span class="hljs-selector-class">.XpathExpression</span><br>javax<span class="hljs-selector-class">.xml</span><span class="hljs-selector-class">.stream</span><span class="hljs-selector-class">.XMLStreamReader</span><br>org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.commons</span><span class="hljs-selector-class">.digester3</span><span class="hljs-selector-class">.Digester</span><br></code></pre></td></tr></table></figure>
<h2 id="SAXBuilder解析xml并修复漏洞"><a href="#SAXBuilder解析xml并修复漏洞" class="headerlink" title="SAXBuilder解析xml并修复漏洞"></a>SAXBuilder解析xml并修复漏洞</h2>
<p>实验编写的servlet如下，其中postNoFixXxe是未修复时的方法，postWithFixXxe是修复后的方法，修复时通过 builder.setFeature设置外部实体不能被解析的方法从而防御xxe漏洞。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.PrintWriter;<br><br><span class="hljs-keyword">import</span> org.jdom2.JDOMException;<br><span class="hljs-keyword">import</span> org.jdom2.input.SAXBuilder;<br><span class="hljs-keyword">import</span> org.jdom2.Document;<br><span class="hljs-keyword">import</span> org.jdom2.output.XMLOutputter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SAXBuilderServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-built_in">super</span>.doGet(req, resp);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>		<span class="hljs-comment">// postNoFixXxe(req, resp);</span><br>        postWithFixXxe(req, resp);<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postNoFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//获取请求输入流</span><br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> req.getReader();<br>            <span class="hljs-comment">//将xml读取到doc</span><br>            <span class="hljs-type">SAXBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXBuilder</span>(); <span class="hljs-comment">//使用默认解析器</span><br>            <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> builder.build(reader);<br>            <span class="hljs-comment">// 获取响应输出流</span><br>            <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> resp.getWriter();<br>            <span class="hljs-comment">//将doc写到输出流</span><br>            <span class="hljs-type">XMLOutputter</span> <span class="hljs-variable">outputter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLOutputter</span>();<br>            outputter.output(doc, writer);<br><br>        &#125; <span class="hljs-keyword">catch</span> (JDOMException | IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postWithFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//获取请求输入流</span><br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> req.getReader();<br>            <span class="hljs-comment">//将xml读取到doc，通过setFeature设置dtd、外部实体读取 防止xxe漏洞</span><br>            <span class="hljs-type">SAXBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXBuilder</span>();<br>            builder.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="hljs-literal">true</span>);<br>            builder.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>            builder.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>            builder.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="hljs-literal">false</span>);<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> builder.build(reader);<br>            <span class="hljs-comment">// 获取响应输出流</span><br>            <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> resp.getWriter();<br>            <span class="hljs-comment">//将doc写到输出流</span><br>            <span class="hljs-type">XMLOutputter</span> <span class="hljs-variable">outputter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLOutputter</span>();<br>            outputter.output(doc, writer);<br><br>        &#125; <span class="hljs-keyword">catch</span> (JDOMException | IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p>两种方法对比即可发现防御代码部分为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">builder.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="hljs-literal">true</span>);<br>builder.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>builder.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>builder.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure>
<p>看到这里是对builder的setFeature属性做出了更改，对于里面的内容，顾名思义也很容易知道这里对于禁止 XML 文档中的文档类型声明（DOCTYPE declaration）：<code>disallow-doctype-decl</code>（设置true）、外部实体加载：<code>external-general-entities</code>、外部参数实体：<code>external-parameter-entities</code>、加载外部dtd文件：<code>load-external-dtd</code>都设置了false，杜绝的xxe的可能</p>
<p>当在doPost中调用postNoFixXxe时，构造xml，成功访问文件内容，可以导致xxe漏洞。（以下都借用师傅的图了）</p>
<p class='item-img' data-src='https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227164302067.png'><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227164302067.png" alt="image-20240227164302067"></p>
<p>当在doPost中调用postWithFixXxe时，成功防御了xxe漏洞，响应未输出xml，并且log报错不允许dtd。</p>
<p class='item-img' data-src='https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227164311847.png'><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227164311847.png" alt="image-20240227164311847"></p>
<h2 id="DocumentBuilder-原生dom解析xml"><a href="#DocumentBuilder-原生dom解析xml" class="headerlink" title="DocumentBuilder-原生dom解析xml"></a>DocumentBuilder(原生dom解析xml)</h2>
<p>为了方便输出用了TransformerFactory将document输出到响应流。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.w3c.dom.Document;<br><span class="hljs-keyword">import</span> org.xml.sax.InputSource;<br><br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.xml.XMLConstants;<br><span class="hljs-keyword">import</span> javax.xml.parsers.DocumentBuilder;<br><span class="hljs-keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;<br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.PrintWriter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentBuilderServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-built_in">super</span>.doGet(req, resp);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        postNoFixXxe(req, resp);<br><span class="hljs-comment">//        postWithFixXxe(req, resp);</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postNoFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">DocumentBuilderFactory</span> <span class="hljs-variable">documentBuilderFactory</span> <span class="hljs-operator">=</span> DocumentBuilderFactory.newInstance();<br>            <span class="hljs-type">DocumentBuilder</span> <span class="hljs-variable">documentBuilder</span> <span class="hljs-operator">=</span> documentBuilderFactory.newDocumentBuilder();<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(req.getReader());<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> documentBuilder.parse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(br));<br>            <span class="hljs-comment">// 获取响应输出流</span><br>            <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> resp.getWriter();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">textContent</span> <span class="hljs-operator">=</span> document.getDocumentElement().getTextContent();<br>            writer.print(textContent);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postWithFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">DocumentBuilderFactory</span> <span class="hljs-variable">documentBuilderFactory</span> <span class="hljs-operator">=</span> DocumentBuilderFactory.newInstance();<br>            documentBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="hljs-string">&quot;&quot;</span>);<br>            documentBuilderFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, <span class="hljs-string">&quot;&quot;</span>);<br>            documentBuilderFactory.setAttribute(XMLConstants.FEATURE_SECURE_PROCESSING, <span class="hljs-literal">true</span>);<br>            documentBuilderFactory.setExpandEntityReferences(<span class="hljs-literal">false</span>);<br>            <span class="hljs-type">DocumentBuilder</span> <span class="hljs-variable">documentBuilder</span> <span class="hljs-operator">=</span> documentBuilderFactory.newDocumentBuilder();<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(req.getReader());<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> documentBuilder.parse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(br));<br><br>            <span class="hljs-comment">// 获取响应输出流</span><br>            <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> resp.getWriter();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">textContent</span> <span class="hljs-operator">=</span> document.getDocumentElement().getTextContent();<br>            writer.print(textContent);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>与上述实验一类似，关键代码如下：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">documentBuilderFactory<span class="hljs-selector-class">.setAttribute</span>(XMLConstants.ACCESS_EXTERNAL_DTD, &quot;&quot;);<br>documentBuilderFactory<span class="hljs-selector-class">.setAttribute</span>(XMLConstants.ACCESS_EXTERNAL_SCHEMA, &quot;&quot;);<br>documentBuilderFactory<span class="hljs-selector-class">.setAttribute</span>(XMLConstants.FEATURE_SECURE_PROCESSING, true);<br></code></pre></td></tr></table></figure>
<p>这里设置为禁止访问外部dtd文件（ACCESS_EXTERNAL_DTD为空）、禁止访问外部xml schema文件（ACCESS_EXTERNAL_SCHEMA为空）</p>
<p>另外还有启用安全处理特性（FEATURE_SECURE_PROCESSING）：这个特性将启用 XML 处理器的安全功能，例如禁用外部实体（External Entities）加载，防止 XXE（XML External Entity）攻击。</p>
<p>调用postNoFixXxe</p>
<p class='item-img' data-src='https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165035927.png'><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165035927.png" alt="image-20240227165035927"></p>
<p>调用postWithFixXxe</p>
<p class='item-img' data-src='https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165049326.png'><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165049326.png" alt="image-20240227165049326"></p>
<h2 id="SAXReader解析xml"><a href="#SAXReader解析xml" class="headerlink" title="SAXReader解析xml"></a>SAXReader解析xml</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><br><span class="hljs-keyword">import</span> org.dom4j.Document;<br><span class="hljs-keyword">import</span> org.dom4j.io.SAXReader;<br><span class="hljs-keyword">import</span> org.dom4j.io.XMLWriter;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SAXReaderServlet</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-built_in">super</span>.doGet(req, resp);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        postNoFixXxe(req,resp);<br><span class="hljs-comment">//        postWithFixXxe(req,resp);</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postNoFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span>&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-type">SAXReader</span> <span class="hljs-variable">saxReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> saxReader.read(req.getReader());<br>            <span class="hljs-type">XMLWriter</span> <span class="hljs-variable">xmlWriter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLWriter</span>(resp.getWriter());<br>            xmlWriter.write(doc);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postWithFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span>&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-type">SAXReader</span> <span class="hljs-variable">saxReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>            saxReader.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="hljs-literal">true</span>);<br>            saxReader.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>            saxReader.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>            saxReader.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="hljs-literal">false</span>);<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> saxReader.read(req.getReader());<br>            <span class="hljs-type">XMLWriter</span> <span class="hljs-variable">xmlWriter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLWriter</span>(resp.getWriter());<br>            xmlWriter.write(doc);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>与实验一的SAXBulider基本相同：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">saxReader<span class="hljs-selector-class">.setFeature</span>(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);<br>saxReader<span class="hljs-selector-class">.setFeature</span>(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);<br>saxReader<span class="hljs-selector-class">.setFeature</span>(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);<br>saxReader<span class="hljs-selector-class">.setFeature</span>(&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;, false);<br></code></pre></td></tr></table></figure>
<p>不再赘述，调用postNoFixXxe</p>
<p class='item-img' data-src='https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165247527.png'><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165247527.png" alt="image-20240227165247527"></p>
<p>调用postWithFixXxe</p>
<p class='item-img' data-src='https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165256461.png'><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165256461.png" alt="image-20240227165256461"></p>
<h2 id="SAXTransformerFactory解析xml"><a href="#SAXTransformerFactory解析xml" class="headerlink" title="SAXTransformerFactory解析xml"></a>SAXTransformerFactory解析xml</h2>
<p>SAXTransformerFactory解析xml，需要xslt，否则会报错，所以构造时要构造xslt。正常情况需要将xml输出，本次实验为了节省时间没有输出。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.xml.XMLConstants;<br><span class="hljs-keyword">import</span> javax.xml.transform.Result;<br><span class="hljs-keyword">import</span> javax.xml.transform.sax.SAXTransformerFactory;<br><span class="hljs-keyword">import</span> javax.xml.transform.sax.TransformerHandler;<br><span class="hljs-keyword">import</span> javax.xml.transform.stream.StreamResult;<br><span class="hljs-keyword">import</span> javax.xml.transform.stream.StreamSource;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SAXTransformerFactoryServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-built_in">super</span>.doGet(req, resp);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        postNoFixXxe(req, resp);<br><span class="hljs-comment">//        postWithFixXxe(req, resp);</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postNoFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span>&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-type">SAXTransformerFactory</span> <span class="hljs-variable">sf</span> <span class="hljs-operator">=</span> (SAXTransformerFactory) SAXTransformerFactory.newInstance();<br>            <span class="hljs-type">StreamSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamSource</span>(req.getReader());<br>            <span class="hljs-type">TransformerHandler</span> <span class="hljs-variable">transformerHandler</span> <span class="hljs-operator">=</span> sf.newTransformerHandler(source);<br>            <span class="hljs-comment">// 创建Result对象，并通过transformerHandler将目的流与其关联</span><br>            <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamResult</span>(resp.getWriter());<br>            transformerHandler.setResult(result);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postWithFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span>&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-type">SAXTransformerFactory</span> <span class="hljs-variable">sf</span> <span class="hljs-operator">=</span> (SAXTransformerFactory) SAXTransformerFactory.newInstance();<br>            sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="hljs-string">&quot;&quot;</span>);<br>            sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, <span class="hljs-string">&quot;&quot;</span>);<br>            <span class="hljs-type">StreamSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamSource</span>(req.getReader());<br>            <span class="hljs-type">TransformerHandler</span> <span class="hljs-variable">transformerHandler</span> <span class="hljs-operator">=</span> sf.newTransformerHandler(source);<br>            <span class="hljs-comment">// 创建Result对象，并通过transformerHandler将目的流与其关联</span><br>            <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamResult</span>(resp.getWriter());<br>            transformerHandler.setResult(result);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>关键代码：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">sf<span class="hljs-selector-class">.setAttribute</span>(XMLConstants.ACCESS_EXTERNAL_DTD, &quot;&quot;);<br>sf<span class="hljs-selector-class">.setAttribute</span>(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, &quot;&quot;);<br></code></pre></td></tr></table></figure>
<p>一个是禁止访问外部dtd文件；</p>
<p>另一个是禁止访问外部样式表文件：样式表用于指定 XML 数据的呈现方式，禁止访问外部样式表可以防止 XML 转换器加载恶意内容，提高安全性。</p>
<p>构造xml和xslt如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;ISO-8859-1&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">xxe</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///E://111.txt&quot;</span> &gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-meta">&lt;?xml-stylesheet type=<span class="hljs-string">&quot;text/xsl&quot;</span> href=<span class="hljs-string">&quot;E://222.xsl&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">catalog</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">catalog</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--xslt文件内容如下--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xsl:stylesheet</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0&quot;</span> <span class="hljs-attr">xmlns:xsl</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">xsl:template</span> <span class="hljs-attr">match</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>teat<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">bgcolor</span>=<span class="hljs-string">&quot;#9acd32&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;left&quot;</span>&gt;</span>File<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">xsl:for-each</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;catalog&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">xsl:value-of</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;test&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">xsl:for-each</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">xsl:template</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">xsl:stylesheet</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>构造xml请求，在未禁止外部实体情况下可以正常响应，控制台未报错：</p>
<p class='item-img' data-src='https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165915074.png'><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165915074.png" alt="image-20240227165915074"></p>
<p>修复后报错：</p>
<p class='item-img' data-src='https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165923603.png'><img src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240227165923603.png" alt="image-20240227165923603"></p>
<h2 id="TransformerFactory解析xml"><a href="#TransformerFactory解析xml" class="headerlink" title="TransformerFactory解析xml"></a>TransformerFactory解析xml</h2>
<p>这个就是Jenkins Nested View插件XXE漏洞(CVE-2021-21680)用到的xml解析工具。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.xml.XMLConstants;<br><span class="hljs-keyword">import</span> javax.xml.transform.Source;<br><span class="hljs-keyword">import</span> javax.xml.transform.Transformer;<br><span class="hljs-keyword">import</span> javax.xml.transform.TransformerException;<br><span class="hljs-keyword">import</span> javax.xml.transform.TransformerFactory;<br><span class="hljs-keyword">import</span> javax.xml.transform.stream.StreamResult;<br><span class="hljs-keyword">import</span> javax.xml.transform.stream.StreamSource;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransformerFactoryServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-built_in">super</span>.doGet(req, resp);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        postNoFixXxe(req, resp);<br><span class="hljs-comment">//        postWithFixXxe(req, resp);</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postNoFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span>&#123;<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">TransformerFactory</span> <span class="hljs-variable">tf</span> <span class="hljs-operator">=</span> TransformerFactory.newInstance();<br>                <span class="hljs-type">StreamSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamSource</span>(req.getReader());<br>                tf.newTransformer().transform(source,  <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamResult</span>(resp.getWriter()));<br>            &#125; <span class="hljs-keyword">catch</span> (TransformerException | IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postWithFixXxe</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span>&#123;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">TransformerFactory</span> <span class="hljs-variable">tf</span> <span class="hljs-operator">=</span> TransformerFactory.newInstance();<br>            <span class="hljs-type">StreamSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamSource</span>(req.getReader());<br>            tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="hljs-string">&quot;&quot;</span>);<br>            tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, <span class="hljs-string">&quot;&quot;</span>);<br>            tf.newTransformer().transform(source, <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamResult</span>(resp.getWriter()));<br>        &#125; <span class="hljs-keyword">catch</span> (TransformerException | IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>与上一个实验基本相同，不再赘述</p>
<h2 id="Unmarshaller解析xml"><a href="#Unmarshaller解析xml" class="headerlink" title="Unmarshaller解析xml"></a>Unmarshaller解析xml</h2>
<p>使用默认的解析方法不会存在XXE问题，这也是唯一一个使用默认的解析方法不会存在XXE的一个库。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">tClass</span> <span class="hljs-operator">=</span> Some.class;<br><span class="hljs-type">JAXBContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> JAXBContext.newInstance(tClass);<br><span class="hljs-type">Unmarshaller</span> <span class="hljs-variable">um</span> <span class="hljs-operator">=</span> context.createUnmarshaller();<br><span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> um.unmarshal(ResourceUtils.getPoc1());<br>tClass.cast(o);<br></code></pre></td></tr></table></figure>
<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3>
<p>基本上所有的修复都是设置禁止外部实体，但是需要注意通过setFeature或者setAttribute或者setProperty设置属性时，一定要注意在解析xml之前就设置，否则修复也是无效的。</p>
<p>Java XXE漏洞的修复或预防主要在设置禁止dtd，一般出现漏洞需要注意：</p>
<ol>
<li>是否禁止dtd或者entity</li>
<li>参数是否可控</li>
<li>传入参数格式为REST XML格式，X-RequestEntity-ContentType: application/xml</li>
</ol>
<h1>0x04 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://r17a-17.github.io/2021/09/04/Java-XXE%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">Java XXE漏洞实验及总结</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2024/02/27/Jwt%E6%94%BB%E5%87%BB%E5%AD%A6%E4%B9%A0/">← Next JWT攻击学习</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2024/02/19/THM-Persisting%20Active%20Directory/">THM-Persisting Active Directory Prev →</a></div></div></div><div id="comments"><div id="waline"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">hybcx</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">0x01 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">0x02 XXE漏洞基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XML%E6%96%87%E6%A1%A3%E7%BB%93%E6%9E%84%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">XML文档结构：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XML%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">2.2.</span> <span class="toc-text">XML示例：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DTD%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%EF%BC%9A"><span class="toc-number">2.3.</span> <span class="toc-text">DTD文档类型定义：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DTD%E4%B8%A4%E7%A7%8D%E5%BC%95%E5%85%A5%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-number">2.3.1.</span> <span class="toc-text">DTD两种引入方式：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DTD%E5%AE%9E%E4%BD%93%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-number">2.3.2.</span> <span class="toc-text">DTD实体两种方式：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84xml%E8%A7%A3%E6%9E%90%E6%96%B9%E5%BC%8F%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%9B%9B%E7%A7%8D"><span class="toc-number">2.4.</span> <span class="toc-text">常见的xml解析方式有以下四种:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">0x03 实验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SAXBuilder%E8%A7%A3%E6%9E%90xml%E5%B9%B6%E4%BF%AE%E5%A4%8D%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.1.</span> <span class="toc-text">SAXBuilder解析xml并修复漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DocumentBuilder-%E5%8E%9F%E7%94%9Fdom%E8%A7%A3%E6%9E%90xml"><span class="toc-number">3.2.</span> <span class="toc-text">DocumentBuilder(原生dom解析xml)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SAXReader%E8%A7%A3%E6%9E%90xml"><span class="toc-number">3.3.</span> <span class="toc-text">SAXReader解析xml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SAXTransformerFactory%E8%A7%A3%E6%9E%90xml"><span class="toc-number">3.4.</span> <span class="toc-text">SAXTransformerFactory解析xml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TransformerFactory%E8%A7%A3%E6%9E%90xml"><span class="toc-number">3.5.</span> <span class="toc-text">TransformerFactory解析xml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unmarshaller%E8%A7%A3%E6%9E%90xml"><span class="toc-number">3.6.</span> <span class="toc-text">Unmarshaller解析xml</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-number">3.6.1.</span> <span class="toc-text">小结：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">0x04 参考文章</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script type="module">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
window.waline = init;
</script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {if (document.querySelector('#waline'))
 waline({
   el: '#waline',
   dark: ':root[theme-mode="dark"]',
   serverURL: 'https://waline-blog-iwqdtxise-hybchenxing.vercel.app',
   path: window.location.pathname,
 });document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>